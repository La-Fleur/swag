<html>
<head><title> "EXE Menu System" by DAVID ADAMSON</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to EXEC SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0023.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
Here is a good scrolling menu bar program written in TP 5.5. The
code is very clean and well commented.
}

</i></font><font color="#FF0000"><b>program </b></font>exemenu<font color="#000080">;                                      </font><font color="#008000"><i>{ version 2.2 }



(****************************************** 1991 J.C. Kessels ****

This is freeware. No guarantees whatsoever. You may change it, use it,
copy it, anything you like.


J.C. Kessels
Philips de Goedelaan 7
5615 PN  Eindhoven
Netherlands
********************************************************************)


{$M 3000,0,0}                     { No heap, or we can't use 'exec'. }


</i></font><font color="#FF0000"><b>uses </b></font>dos<font color="#000080">;




</font><font color="#FF0000"><b>const
</b></font><font color="#008000"><i>(* English version: *)
  </i></font>StrCopyright <font color="#000080">= </font><font color="#800000">'EXEMENU v2.2, 1991 J.C. Kessels'</font><font color="#000080">;</font><font color="#008000"><i>{ Name of program. }
  </i></font>StrBusy      <font color="#000080">= </font><font color="#800000">'Busy....'</font><font color="#000080">;                       </font><font color="#008000"><i>{ Program is busy message. }
  </i></font>StrHelp      <font color="#000080">= </font><font color="#800000">'Enter=Start  ESC=Stop'</font><font color="#000080">;         </font><font color="#008000"><i>{ Bottom-left help message.}
  </i></font>StrStart     <font color="#000080">= </font><font color="#800000">'Busy starting program: '</font><font color="#000080">;        </font><font color="#008000"><i>{ Start a program message. }
  { Wrong DOS version message. }
  </i></font>StrDos <font color="#000080">= </font><font color="#800000">'Sorry, this program only works with DOS versions 3.xx and above.'</font><font color="#000080">;
  </font><font color="#008000"><i>{ Unrecognised error message. }
  </i></font>StrError     <font color="#000080">= </font><font color="#800000">'EXEMENU: unrecognised error caused program termination.'</font><font color="#000080">;
  </font>StrExit      <font color="#000080">= </font><font color="#800000">'That''s it, folks!'</font><font color="#000080">;                   </font><font color="#008000"><i>{ Exit message. }
(* Dutch version: *)
(*
  StrCopyright = 'EXEMENU v2.2, 1991 J.C. Kessels';  { Naam van het programma.}
  StrHelp      = 'Enter=Start  ESC=Stop';       { Bodem-links hulp boodschap.}
  StrBusy      = 'Bezig....';                     { Ik ben bezig boodschap.}
  { Bij het starten van een programma. }
  StrStart     = 'Bezig met starten van: ';
  { Foutboodschap als de DOS versie niet goed is. }
  StrDos = 'Sorry, dit programma werkt slechts met DOS versie 3.xx en hoger.';
  { Onbekende fout boodschap. }
  StrError     = 'EXEMENU: door onbekende fout voortijdig be‰indigd.';
  StrExit      = 'Exemenu is ge‰indigd.';        { Stop EXEMENU boodschap. }
*)

  </i></font>DirMax <font color="#000080">= </font><font color="#800000">1000</font><font color="#000080">;                    </font><font color="#008000"><i>{ Number of entries in directory array. }

</i></font><font color="#FF0000"><b>type
  </b></font>Str90 <font color="#000080">= </font><font color="#FF0000"><b>string</b></font><font color="#000080">[</font><font color="#800000">90</font><font color="#000080">];             </font><font color="#008000"><i>{ We don't need anything longer than this. }

</i></font><font color="#FF0000"><b>var
  </b></font>VidStore <font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">3999</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>char<font color="#000080">;                 </font><font color="#008000"><i>{ Video screen storage. }
  </i></font>Dir <font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font>DirMax<font color="#000080">] </font><font color="#FF0000"><b>of record  </b></font><font color="#008000"><i>{The directory is loaded into this array.}
    </i></font>attr <font color="#000080">: </font>byte<font color="#000080">;                                     </font><font color="#008000"><i>{ 1: directory, 2: file.}
    </i></font>name <font color="#000080">: </font>NameStr<font color="#000080">;                              </font><font color="#008000"><i>{ Name of file/directory. }
    </i></font>ext  <font color="#000080">: </font>ExtStr<font color="#000080">;                                </font><font color="#008000"><i>{ Extension of file. }
    </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>DirTop  <font color="#000080">: </font>word<font color="#000080">;                        </font><font color="#008000"><i>{ Last active entry in Dir array. }
  </i></font>DirHere <font color="#000080">: </font>word<font color="#000080">;                       </font><font color="#008000"><i>{ Current selection in Dir array. }
  </i></font>DirPath   <font color="#000080">: </font>pathstr<font color="#000080">;                </font><font color="#008000"><i>{ The path of the Loaded directory. }
  </i></font>OldPath   <font color="#000080">: </font>PathStr<font color="#000080">;      </font><font color="#008000"><i>{ The current directory at startup of EXEMENU. }
  </i></font>BasicPath <font color="#000080">: </font>PathStr<font color="#000080">;                </font><font color="#008000"><i>{ The path to the basic interpreter. }
  </i></font>OldCursor <font color="#000080">: </font>word<font color="#000080">;                                  </font><font color="#008000"><i>{ Saved cursor shape. }
  </i></font>xy     <font color="#000080">: </font>word<font color="#000080">;                                  </font><font color="#008000"><i>{ Cursor on the screen. }
  </i></font>colour <font color="#000080">: </font>byte<font color="#000080">;                                 </font><font color="#008000"><i>{ Colour for the screen. }
  </i></font>vidseg <font color="#000080">: </font>word<font color="#000080">;                              </font><font color="#008000"><i>{ Segment of the screen RAM. }
  </i></font>regs   <font color="#000080">: </font>registers<font color="#000080">;                        </font><font color="#008000"><i>{ Registers to call the BIOS. }
  </i></font>Inkey  <font color="#000080">: </font>word<font color="#000080">;                                   </font><font color="#008000"><i>{ The last pressed key. }
  </i></font>keyflags <font color="#000080">: </font>byte <font color="#FF0000"><b>absolute </b></font><font color="#800000">$0040</font><font color="#000080">:</font><font color="#800000">$0017</font><font color="#000080">;             </font><font color="#008000"><i>{ BIOS keyboard flags. }
  </i></font>ExitSave <font color="#000080">: </font>pointer<font color="#000080">;                         </font><font color="#008000"><i>{ Address of exit procedure. }
  </i></font>ExitMsg  <font color="#000080">: </font>Str90<font color="#000080">;                      </font><font color="#008000"><i>{ Message to display when exiting. }
  </i></font>DTA  <font color="#000080">: </font>SearchRec<font color="#000080">;                             </font><font color="#008000"><i>{ FindFirst-FindNext buffer. }

</i></font><font color="#FF0000"><b>function </b></font>Left<font color="#000080">(</font>s <font color="#000080">: </font>Str90<font color="#000080">; </font>width <font color="#000080">: </font>byte<font color="#000080">) : </font>Str90<font color="#000080">;
</font><font color="#008000"><i>{Return Width characters from input string. Add trailing spaces if necessary.}
</i></font><font color="#FF0000"><b>begin
if </b></font>width <font color="#000080">&gt; </font>length<font color="#000080">(</font>s<font color="#000080">) </font><font color="#FF0000"><b>then </b></font>Fillchar<font color="#000080">(</font>s<font color="#000080">[</font>length<font color="#000080">(</font>s<font color="#000080">)+</font><font color="#800000">1</font><font color="#000080">],</font>width<font color="#000080">-</font>length<font color="#000080">(</font>s<font color="#000080">),</font><font color="#800000">32</font><font color="#000080">);
</font>s<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">] := </font>chr<font color="#000080">(</font>width<font color="#000080">);
</font>Left <font color="#000080">:= </font>s<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>FixupDir<font color="#000080">;
</font><font color="#008000"><i>{ Fixup the DirPath string. }
</i></font><font color="#FF0000"><b>var
  </b></font>drive <font color="#000080">: </font>char<font color="#000080">;
  </font>i<font color="#000080">, </font>j <font color="#000080">: </font>word<font color="#000080">;
</font><font color="#FF0000"><b>begin
</b></font>i <font color="#000080">:= </font>pos<font color="#000080">(</font><font color="#800000">':'</font><font color="#000080">,</font>DirPath<font color="#000080">);                   </font><font color="#008000"><i>{ Strip the drive from the path. }
</i></font><font color="#FF0000"><b>if </b></font>i <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>then
  begin
  if </b></font><font color="#000080">(</font>length<font color="#000080">(</font>Dirpath<font color="#000080">) &gt; </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>Dirpath<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">] = </font><font color="#800000">'\'</font><font color="#000080">)
    </font><font color="#FF0000"><b>then </b></font>DirPath <font color="#000080">:= </font>copy<font color="#000080">(</font>OldPath<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">2</font><font color="#000080">) + </font>DirPath
    <font color="#FF0000"><b>else if </b></font>OldPath<font color="#000080">[</font>length<font color="#000080">(</font>OldPath<font color="#000080">)] = </font><font color="#800000">'\'
      </font><font color="#FF0000"><b>then </b></font>DirPath <font color="#000080">:= </font>OldPath <font color="#000080">+ </font>DirPath
      <font color="#FF0000"><b>else </b></font>DirPath <font color="#000080">:= </font>OldPath <font color="#000080">+ </font><font color="#800000">'\' </font><font color="#000080">+ </font>DirPath<font color="#000080">;
  </font>i <font color="#000080">:= </font>pos<font color="#000080">(</font><font color="#800000">':'</font><font color="#000080">,</font>DirPath<font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font>drive <font color="#000080">:= </font>DirPath<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">];
</font>delete<font color="#000080">(</font>DirPath<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font>i<font color="#000080">);

</font><font color="#FF0000"><b>while </b></font>pos<font color="#000080">(</font><font color="#800000">'..'</font><font color="#000080">,</font>DirPath<font color="#000080">) &lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>do                    </b></font><font color="#008000"><i>{ Remove embedded &quot;..&quot; }
  </i></font><font color="#FF0000"><b>begin
  </b></font>i <font color="#000080">:= </font>pos<font color="#000080">(</font><font color="#800000">'..'</font><font color="#000080">,</font>DirPath<font color="#000080">);
  </font>j <font color="#000080">:= </font>i <font color="#000080">+ </font><font color="#800000">2</font><font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font>i <font color="#000080">&gt; </font><font color="#800000">1 </font><font color="#FF0000"><b>then </b></font>dec<font color="#000080">(</font>i<font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>i <font color="#000080">&gt; </font><font color="#800000">1</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>DirPath<font color="#000080">[</font>i<font color="#000080">] = </font><font color="#800000">'\'</font><font color="#000080">) </font><font color="#FF0000"><b>then </b></font>dec<font color="#000080">(</font>i<font color="#000080">);
  </font><font color="#FF0000"><b>while </b></font><font color="#000080">(</font>i <font color="#000080">&gt; </font><font color="#800000">1</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>DirPath<font color="#000080">[</font>i<font color="#000080">] &lt;&gt; </font><font color="#800000">'\'</font><font color="#000080">) </font><font color="#FF0000"><b>do </b></font>dec<font color="#000080">(</font>i<font color="#000080">);
  </font>delete<font color="#000080">(</font>DirPath<font color="#000080">,</font>i<font color="#000080">,</font>j<font color="#000080">-</font>i<font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{ Remove embedded &quot;.\&quot; }
</i></font><font color="#FF0000"><b>while </b></font>pos<font color="#000080">(</font><font color="#800000">'.\'</font><font color="#000080">,</font>DirPath<font color="#000080">) &lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>do </b></font>delete<font color="#000080">(</font>DirPath<font color="#000080">,</font>pos<font color="#000080">(</font><font color="#800000">'.\'</font><font color="#000080">,</font>DirPath<font color="#000080">),</font><font color="#800000">2</font><font color="#000080">);

</font><font color="#FF0000"><b>if </b></font>pos<font color="#000080">(</font><font color="#800000">'\'</font><font color="#000080">,</font>DirPath<font color="#000080">) = </font><font color="#800000">0                        </font><font color="#008000"><i>{ If no subdirectories.... }
  </i></font><font color="#FF0000"><b>then </b></font>DirPath <font color="#000080">:= </font><font color="#800000">'\'
  </font><font color="#FF0000"><b>else
    begin                          </b></font><font color="#008000"><i>{ Else strip filename from the path.... }
    </i></font>i <font color="#000080">:= </font>pos<font color="#000080">(</font><font color="#800000">'.'</font><font color="#000080">,</font>DirPath<font color="#000080">);
    </font><font color="#FF0000"><b>if </b></font>i <font color="#000080">&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then
      begin
      while </b></font><font color="#000080">(</font>i <font color="#000080">&gt; </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>DirPath<font color="#000080">[</font>i<font color="#000080">] &lt;&gt; </font><font color="#800000">'\'</font><font color="#000080">) </font><font color="#FF0000"><b>do </b></font>dec<font color="#000080">(</font>i<font color="#000080">);
      </font><font color="#FF0000"><b>if </b></font>i <font color="#000080">&gt; </font><font color="#800000">0
        </font><font color="#FF0000"><b>then </b></font>DirPath <font color="#000080">:= </font>copy<font color="#000080">(</font>DirPath<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font>i<font color="#000080">)
        </font><font color="#FF0000"><b>else </b></font>DirPath <font color="#000080">:= </font><font color="#800000">'\'</font><font color="#000080">;
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>if </b></font>DirPath<font color="#000080">[</font>length<font color="#000080">(</font>DirPath<font color="#000080">)] &lt;&gt; </font><font color="#800000">'\'       </font><font color="#008000"><i>{ maybe add '\' at the end.... }
      </i></font><font color="#FF0000"><b>then </b></font>DirPath <font color="#000080">:= </font>DirPath <font color="#000080">+ </font><font color="#800000">'\'</font><font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font>DirPath <font color="#000080">:= </font>drive <font color="#000080">+ </font><font color="#800000">':' </font><font color="#000080">+ </font>DirPath<font color="#000080">;    </font><font color="#008000"><i>{ Add the drive back to the directory. }

{ Translate the Dirpath into all uppercase. }
</i></font><font color="#FF0000"><b>for </b></font>i <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>length<font color="#000080">(</font>DirPath<font color="#000080">) </font><font color="#FF0000"><b>do </b></font>DirPath<font color="#000080">[</font>i<font color="#000080">] := </font>upcase<font color="#000080">(</font>DirPath<font color="#000080">[</font>i<font color="#000080">]);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>Show<font color="#000080">(</font>s <font color="#000080">: </font>Str90<font color="#000080">);
</font><font color="#008000"><i>{ Display string &quot;s&quot; at &quot;xy&quot;, using &quot;colour&quot;. This routine uses DMA into the
  video memory. }
</i></font><font color="#FF0000"><b>begin
Inline</b></font><font color="#000080">(
  </font><font color="#800000">$8E</font><font color="#000080">/</font><font color="#800000">$06</font><font color="#000080">/&gt;</font>VIDSEG<font color="#000080">/       </font><font color="#008000"><i>{mov  es,[&gt;vidseg]   ; Fetch video segment in ES.}
  </i></font><font color="#800000">$8B</font><font color="#000080">/</font><font color="#800000">$3E</font><font color="#000080">/&gt;</font>XY<font color="#000080">/           </font><font color="#008000"><i>{mov  di,[&gt;xy]       ; Fetch video offset in DI.}
  </i></font><font color="#800000">$8A</font><font color="#000080">/</font><font color="#800000">$26</font><font color="#000080">/&gt;</font>COLOUR<font color="#000080">/       </font><font color="#008000"><i>{mov  ah,[&gt;colour]   ; Fetch video colour in AH.}
  </i></font><font color="#800000">$1E</font><font color="#000080">/                   </font><font color="#008000"><i>{push ds             ; Setup DS to stack segment.}
  </i></font><font color="#800000">$8C</font><font color="#000080">/</font><font color="#800000">$D1</font><font color="#000080">/               </font><font color="#008000"><i>{mov  cx,ss}
  </i></font><font color="#800000">$8E</font><font color="#000080">/</font><font color="#800000">$D9</font><font color="#000080">/               </font><font color="#008000"><i>{mov  ds,cx}
  </i></font><font color="#800000">$8A</font><font color="#000080">/</font><font color="#800000">$8E</font><font color="#000080">/&gt;</font>S<font color="#000080">/            </font><font color="#008000"><i>{mov  cl,[bp+&gt;s]     ; Fetch string size in CX.}
  </i></font><font color="#800000">$30</font><font color="#000080">/</font><font color="#800000">$ED</font><font color="#000080">/               </font><font color="#008000"><i>{xor  ch,ch}
  </i></font><font color="#800000">$8D</font><font color="#000080">/</font><font color="#800000">$B6</font><font color="#000080">/&gt;</font>S<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">/          </font><font color="#008000"><i>{lea  si,[bp+&gt;s+1]   ; Fetch string address in SI.}
  </i></font><font color="#800000">$E3</font><font color="#000080">/</font><font color="#800000">$04</font><font color="#000080">/               </font><font color="#008000"><i>{jcxz l2             ; Skip if zero length.}
                         {l1:}
  </i></font><font color="#800000">$AC</font><font color="#000080">/                   </font><font color="#008000"><i>{lodsb               ; Fetch character from string.}
  </i></font><font color="#800000">$AB</font><font color="#000080">/                   </font><font color="#008000"><i>{stosw               ; Show character.}
  </i></font><font color="#800000">$E2</font><font color="#000080">/</font><font color="#800000">$FC</font><font color="#000080">/               </font><font color="#008000"><i>{loop l1             ; Next character.}
                         {l2:}
  </i></font><font color="#800000">$1F</font><font color="#000080">/                   </font><font color="#008000"><i>{pop  ds             ; Restore DS.}
  </i></font><font color="#800000">$89</font><font color="#000080">/</font><font color="#800000">$3E</font><font color="#000080">/&gt;</font>XY<font color="#000080">);          </font><font color="#008000"><i>{mov  [&gt;xy],di       ; Store new XY.}
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>ShowMenu<font color="#000080">(</font><font color="#FF0000"><b>Message </b></font><font color="#000080">: </font>Str90<font color="#000080">);
</font><font color="#008000"><i>{ Display the screen, with borders, a &quot;Message&quot; in line 2, and the loaded
  directory in the rest of the screen. }
</i></font><font color="#FF0000"><b>var
  </b></font>i   <font color="#000080">: </font>word<font color="#000080">;                         </font><font color="#008000"><i>{ Work variable. }
  </i></font>s   <font color="#000080">: </font>Str90<font color="#000080">;                        </font><font color="#008000"><i>{ Work variable. }
  </i></font>pagetop <font color="#000080">: </font>word<font color="#000080">;                     </font><font color="#008000"><i>{ Top of the page in the Dir array. }
  </i></font>row     <font color="#000080">: </font>word<font color="#000080">;                     </font><font color="#008000"><i>{ The display row we are busy with. }
</i></font><font color="#FF0000"><b>begin
</b></font>xy <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;                               </font><font color="#008000"><i>{ First line. }
</i></font>colour <font color="#000080">:= </font><font color="#800000">$13</font><font color="#000080">;
</font><font color="#FF0000"><b>if </b></font>length<font color="#000080">(</font>StrCopyright<font color="#000080">) &gt; </font><font color="#800000">76
  </font><font color="#FF0000"><b>then </b></font>i <font color="#000080">:= </font><font color="#800000">76
  </font><font color="#FF0000"><b>else </b></font>i <font color="#000080">:= </font>length<font color="#000080">(</font>StrCopyright<font color="#000080">);
</font>s<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">] := </font>chr<font color="#000080">((</font><font color="#800000">76 </font><font color="#000080">- </font>i<font color="#000080">) </font><font color="#FF0000"><b>div </b></font><font color="#800000">2</font><font color="#000080">);
</font>Fillchar<font color="#000080">(</font>s<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">],</font>ord<font color="#000080">(</font>s<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">]),</font><font color="#800000">'&Iacute;'</font><font color="#000080">);
</font>Show<font color="#000080">(</font><font color="#800000">'&Eacute;'</font><font color="#000080">+</font>s<font color="#000080">+</font><font color="#800000">'&micro;'</font><font color="#000080">);
</font>colour <font color="#000080">:= </font><font color="#800000">$1B</font><font color="#000080">;
</font>Show<font color="#000080">(</font>copy<font color="#000080">(</font>StrCopyright<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font>i<font color="#000080">));
</font>colour <font color="#000080">:= </font><font color="#800000">$13</font><font color="#000080">;
</font>s<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">] := </font>chr<font color="#000080">(</font><font color="#800000">76 </font><font color="#000080">- </font>length<font color="#000080">(</font>s<font color="#000080">) - </font>length<font color="#000080">(</font>StrCopyright<font color="#000080">));
</font>Fillchar<font color="#000080">(</font>s<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">],</font>ord<font color="#000080">(</font>s<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">]),</font><font color="#800000">'&Iacute;'</font><font color="#000080">);
</font>Show<font color="#000080">(</font><font color="#800000">'&AElig;'</font><font color="#000080">+</font>s<font color="#000080">+</font><font color="#800000">'&raquo;&ordm; '</font><font color="#000080">);

</font>colour <font color="#000080">:= </font><font color="#800000">$1E</font><font color="#000080">;                                 </font><font color="#008000"><i>{ Second line. }
</i></font>Show<font color="#000080">(</font>left<font color="#000080">(</font><font color="#FF0000"><b>Message</b></font><font color="#000080">,</font><font color="#800000">76</font><font color="#000080">));

</font>colour <font color="#000080">:= </font><font color="#800000">$13</font><font color="#000080">;                                   </font><font color="#008000"><i>{ Third line. }
</i></font>Show<font color="#000080">(</font><font color="#800000">' &ordm;&Ccedil;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;¶'</font><font color="#000080">);

</font><font color="#008000"><i>{ Display all the directory entries, using the current cursor position
  to calculate the top-left of the page. }
</i></font>pagetop <font color="#000080">:= </font>DirHere <font color="#000080">- </font>DirHere <font color="#FF0000"><b>mod </b></font><font color="#800000">105 </font><font color="#000080">+ </font><font color="#800000">1</font><font color="#000080">;
</font><font color="#FF0000"><b>for </b></font>i <font color="#000080">:= </font>pagetop <font color="#FF0000"><b>to </b></font>pagetop <font color="#000080">+ </font><font color="#800000">20 </font><font color="#FF0000"><b>do
  begin
  </b></font>colour <font color="#000080">:= </font><font color="#800000">$13</font><font color="#000080">;
  </font>Show<font color="#000080">(</font><font color="#800000">'&ordm; '</font><font color="#000080">);
  </font>colour <font color="#000080">:= </font><font color="#800000">$1E</font><font color="#000080">;
  </font>row <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font><font color="#FF0000"><b>while </b></font>row <font color="#000080">&lt;= </font><font color="#800000">84 </font><font color="#FF0000"><b>do
    begin
    if </b></font>i<font color="#000080">+</font>row <font color="#000080">&lt;= </font>DirTop
      <font color="#FF0000"><b>then if </b></font>Dir<font color="#000080">[</font>i<font color="#000080">+</font>row<font color="#000080">].</font>attr <font color="#000080">= </font><font color="#800000">1
        </font><font color="#FF0000"><b>then </b></font>Show<font color="#000080">(</font>left<font color="#000080">(</font>Dir<font color="#000080">[</font>i<font color="#000080">+</font>row<font color="#000080">].</font>name<font color="#000080">,</font><font color="#800000">14</font><font color="#000080">))
        </font><font color="#FF0000"><b>else </b></font>Show<font color="#000080">(</font>left<font color="#000080">(</font>Dir<font color="#000080">[</font>i<font color="#000080">+</font>row<font color="#000080">].</font>name<font color="#000080">,</font><font color="#800000">8</font><font color="#000080">) + </font><font color="#800000">'.' </font><font color="#000080">+ </font>left<font color="#000080">(</font>Dir<font color="#000080">[</font>i<font color="#000080">+</font>row<font color="#000080">].</font>ext<font color="#000080">,</font><font color="#800000">5</font><font color="#000080">))
      </font><font color="#FF0000"><b>else </b></font>Show<font color="#000080">(</font><font color="#800000">'              '</font><font color="#000080">);
    </font>row <font color="#000080">:= </font>row <font color="#000080">+ </font><font color="#800000">21</font><font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>colour <font color="#000080">:= </font><font color="#800000">$13</font><font color="#000080">;
  </font>Show<font color="#000080">(</font><font color="#800000">'       &ordm;'</font><font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font>colour <font color="#000080">:= </font><font color="#800000">$13</font><font color="#000080">;                                      </font><font color="#008000"><i>{ Last line. }
</i></font>Show<font color="#000080">(</font><font color="#800000">'&Egrave;&Iacute;&Iacute;&micro;'</font><font color="#000080">);
</font>colour <font color="#000080">:= </font><font color="#800000">$1B</font><font color="#000080">;
</font><font color="#FF0000"><b>if </b></font>length<font color="#000080">(</font>StrHelp<font color="#000080">) &gt; </font><font color="#800000">74
  </font><font color="#FF0000"><b>then </b></font>i <font color="#000080">:= </font><font color="#800000">74
  </font><font color="#FF0000"><b>else </b></font>i <font color="#000080">:= </font>length<font color="#000080">(</font>StrHelp<font color="#000080">);
</font>Show<font color="#000080">(</font>copy<font color="#000080">(</font>StrHelp<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font>i<font color="#000080">));
</font>colour <font color="#000080">:= </font><font color="#800000">$13</font><font color="#000080">;
</font>s<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">] := </font>chr<font color="#000080">(</font><font color="#800000">74</font><font color="#000080">-</font>i<font color="#000080">);
</font>Fillchar<font color="#000080">(</font>s<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">],</font>ord<font color="#000080">(</font>s<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">]),</font><font color="#800000">'&Iacute;'</font><font color="#000080">);
</font>Show<font color="#000080">(</font><font color="#800000">'&AElig;'</font><font color="#000080">+</font>s<font color="#000080">+</font><font color="#800000">'&frac14;'</font><font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>ShowBar<font color="#000080">(</font>here <font color="#000080">: </font>word<font color="#000080">; </font>onoff <font color="#000080">: </font>boolean<font color="#000080">);
</font><font color="#008000"><i>{ Display (onoff = true) or remove (onoff = false) the cursor bar at the screen
  location that shows the &quot;here&quot; entry in the Dir array. Every entry has a
  fixed location on the screen. }
</i></font><font color="#FF0000"><b>var
  </b></font>i <font color="#000080">: </font>word<font color="#000080">;
</font><font color="#FF0000"><b>begin
</b></font>i <font color="#000080">:= </font>Here <font color="#FF0000"><b>mod </b></font><font color="#800000">105 </font><font color="#000080">- </font><font color="#800000">1</font><font color="#000080">;                </font><font color="#008000"><i>{ Calculate position on screen. }
</i></font>xy <font color="#000080">:= </font><font color="#800000">484 </font><font color="#000080">+ (</font>i <font color="#FF0000"><b>div </b></font><font color="#800000">21</font><font color="#000080">) * </font><font color="#800000">28 </font><font color="#000080">+ (</font>i <font color="#FF0000"><b>mod </b></font><font color="#800000">21</font><font color="#000080">) * </font><font color="#800000">160</font><font color="#000080">;
</font><font color="#FF0000"><b>if </b></font>onoff                              <font color="#008000"><i>{ Setup the proper colour. }
  </i></font><font color="#FF0000"><b>then </b></font>colour <font color="#000080">:= </font><font color="#800000">$70
  </font><font color="#FF0000"><b>else </b></font>colour <font color="#000080">:= </font><font color="#800000">$1E</font><font color="#000080">;
</font><font color="#FF0000"><b>if </b></font>Here <font color="#000080">&lt;= </font>DirTop                     <font color="#008000"><i>{ Display the Dir entry. }
  </i></font><font color="#FF0000"><b>then if </b></font>Dir<font color="#000080">[</font>Here<font color="#000080">].</font>attr <font color="#000080">= </font><font color="#800000">1
    </font><font color="#FF0000"><b>then </b></font>Show<font color="#000080">(</font>left<font color="#000080">(</font>Dir<font color="#000080">[</font>Here<font color="#000080">].</font>name<font color="#000080">,</font><font color="#800000">12</font><font color="#000080">))  </font><font color="#008000"><i>{ Directories without a dot. }
    </i></font><font color="#FF0000"><b>else </b></font>Show<font color="#000080">(</font>left<font color="#000080">(</font>Dir<font color="#000080">[</font>Here<font color="#000080">].</font>name<font color="#000080">,</font><font color="#800000">8</font><font color="#000080">) + </font><font color="#800000">'.' </font><font color="#000080">+ </font>left<font color="#000080">(</font>Dir<font color="#000080">[</font>Here<font color="#000080">].</font>ext<font color="#000080">,</font><font color="#800000">3</font><font color="#000080">))
  </font><font color="#FF0000"><b>else </b></font>Show<font color="#000080">(</font><font color="#800000">'            '</font><font color="#000080">);              </font><font color="#008000"><i>{ Empty entries. }
</i></font>colour <font color="#000080">:= </font><font color="#800000">$1E</font><font color="#000080">;                            </font><font color="#008000"><i>{ Reset the colour. }
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>InitVideo<font color="#000080">;
</font><font color="#008000"><i>{ Initialise the video. If not 80x25 then switch to it. Store the screen.
  Hide the cursor. }
</i></font><font color="#FF0000"><b>var
  </b></font>i <font color="#000080">: </font>byte<font color="#000080">;
</font><font color="#FF0000"><b>begin
</b></font>regs<font color="#000080">.</font>ah <font color="#000080">:= </font><font color="#800000">$0F</font><font color="#000080">;            </font><font color="#008000"><i>{ If not text mode 3 or 7, then switch to it. }
</i></font>intr<font color="#000080">(</font><font color="#800000">$10</font><font color="#000080">,</font>regs<font color="#000080">);
</font>i <font color="#000080">:= </font>regs<font color="#000080">.</font>al <font color="#FF0000"><b>and </b></font><font color="#800000">$7F</font><font color="#000080">;
</font>regs<font color="#000080">.</font>ah <font color="#000080">:= </font><font color="#800000">$03</font><font color="#000080">;            </font><font color="#008000"><i>{ Save current cursor shape. BH is active page. }
</i></font>intr<font color="#000080">(</font><font color="#800000">$10</font><font color="#000080">,</font>regs<font color="#000080">);
</font>OldCursor <font color="#000080">:= </font>regs<font color="#000080">.</font>cx<font color="#000080">;
</font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>i <font color="#000080">&lt;&gt; </font><font color="#800000">3</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>i <font color="#000080">&lt;&gt; </font><font color="#800000">7</font><font color="#000080">) </font><font color="#FF0000"><b>then
  begin
  </b></font>regs<font color="#000080">.</font>al <font color="#000080">:= </font><font color="#800000">3</font><font color="#000080">;
  </font>regs<font color="#000080">.</font>ah <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font>intr<font color="#000080">(</font><font color="#800000">$10</font><font color="#000080">,</font>regs<font color="#000080">);
  </font>i <font color="#000080">:= </font><font color="#800000">3</font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>if </b></font>i <font color="#000080">&lt;&gt; </font><font color="#800000">7                          </font><font color="#008000"><i>{ Compute video segment. }
  </i></font><font color="#FF0000"><b>then </b></font>vidseg <font color="#000080">:= </font><font color="#800000">$B800 </font><font color="#000080">+ (</font>memw<font color="#000080">[</font><font color="#800000">$0040</font><font color="#000080">:</font><font color="#800000">$004E</font><font color="#000080">] </font><font color="#FF0000"><b>shr </b></font><font color="#800000">4</font><font color="#000080">)
  </font><font color="#FF0000"><b>else </b></font>vidseg <font color="#000080">:= </font><font color="#800000">$B000 </font><font color="#000080">+ (</font>memw<font color="#000080">[</font><font color="#800000">$0040</font><font color="#000080">:</font><font color="#800000">$004E</font><font color="#000080">] </font><font color="#FF0000"><b>shr </b></font><font color="#800000">4</font><font color="#000080">);

</font>move<font color="#000080">(</font>mem<font color="#000080">[</font>vidseg<font color="#000080">:</font><font color="#800000">0</font><font color="#000080">],</font>VidStore<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">],</font><font color="#800000">4000</font><font color="#000080">);   </font><font color="#008000"><i>{ Store current screen. }

</i></font>regs<font color="#000080">.</font>cx <font color="#000080">:= </font><font color="#800000">$2000</font><font color="#000080">;                        </font><font color="#008000"><i>{ Hide cursor. }
</i></font>regs<font color="#000080">.</font>ah <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;
</font>intr<font color="#000080">(</font><font color="#800000">$10</font><font color="#000080">,</font>regs<font color="#000080">);

</font>colour <font color="#000080">:= </font><font color="#800000">$1E</font><font color="#000080">;                             </font><font color="#008000"><i>{ Reset attribute. }
</i></font>xy <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;                                   </font><font color="#008000"><i>{ Reset cursor. }
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>ResetVideo<font color="#000080">;
</font><font color="#008000"><i>{ Reset the video back to it's original contents. Show the cursor. }
</i></font><font color="#FF0000"><b>begin
</b></font>move<font color="#000080">(</font>VidStore<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">],</font>mem<font color="#000080">[</font>vidseg<font color="#000080">:</font><font color="#800000">0</font><font color="#000080">],</font><font color="#800000">4000</font><font color="#000080">);       </font><font color="#008000"><i>{ Restore screen. }

</i></font>regs<font color="#000080">.</font>cx <font color="#000080">:= </font>OldCursor<font color="#000080">;                       </font><font color="#008000"><i>{ Reset original cursor chape. }
</i></font>regs<font color="#000080">.</font>ah <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;
</font>intr<font color="#000080">(</font><font color="#800000">$10</font><font color="#000080">,</font>regs<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{$F+}
</i></font><font color="#FF0000"><b>procedure </b></font>ExitCode<font color="#000080">;
</font><font color="#008000"><i>{ Reset display upon exit. This also works for error exit's. }
</i></font><font color="#FF0000"><b>begin
</b></font>ResetVideo<font color="#000080">;                           </font><font color="#008000"><i>{ Reset the original display contents. }
</i></font><font color="#FF0000"><b>if </b></font>ExitMsg <font color="#000080">&lt;&gt; </font><font color="#800000">'' </font><font color="#FF0000"><b>then </b></font>writeln<font color="#000080">(</font>ExitMsg<font color="#000080">);    </font><font color="#008000"><i>{ Show exit message. }
</i></font>ChDir<font color="#000080">(</font>OldPath<font color="#000080">);                            </font><font color="#008000"><i>{ Restore current path. }
</i></font>ExitProc <font color="#000080">:= </font>ExitSave<font color="#000080">;        </font><font color="#008000"><i>{ Reset previous exit procedure. }
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#008000"><i>{$F-}

</i></font><font color="#FF0000"><b>procedure </b></font>LoadDir<font color="#000080">;
</font><font color="#008000"><i>{ Load the &quot;DirPath&quot; directory into memory. }
</i></font><font color="#FF0000"><b>var
  </b></font>i    <font color="#000080">: </font>word<font color="#000080">;                                  </font><font color="#008000"><i>{ Work variable. }
  </i></font>s    <font color="#000080">: </font>pathstr<font color="#000080">;                               </font><font color="#008000"><i>{ Work variable. }
  </i></font>name <font color="#000080">: </font>NameStr<font color="#000080">;                               </font><font color="#008000"><i>{ Name of current file. }
  </i></font>ext  <font color="#000080">: </font>ExtStr<font color="#000080">;                                </font><font color="#008000"><i>{ Extension of current file. }
  </i></font>attr <font color="#000080">: </font>byte<font color="#000080">;                                  </font><font color="#008000"><i>{ Attribute of current file. }
</i></font><font color="#FF0000"><b>begin
</b></font>colour <font color="#000080">:= </font><font color="#800000">$1E</font><font color="#000080">;                                  </font><font color="#008000"><i>{ Show &quot;busy&quot; message. }
</i></font>xy <font color="#000080">:= </font><font color="#800000">164</font><font color="#000080">;
</font>Show<font color="#000080">(</font>left<font color="#000080">(</font>StrBusy<font color="#000080">,</font><font color="#800000">76</font><font color="#000080">));

</font>FixupDir<font color="#000080">;                               </font><font color="#008000"><i>{ Cleanup the DirPath string. }
</i></font>DirTop <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;                            </font><font color="#008000"><i>{ Reset pointers into the Dir array.}
</i></font>DirHere <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;

</font>FindFirst<font color="#000080">(</font>DirPath<font color="#000080">+</font><font color="#800000">'*.*'</font><font color="#000080">,</font>AnyFile<font color="#000080">,</font>DTA<font color="#000080">);                 </font><font color="#008000"><i>{ Find first file. }
</i></font><font color="#FF0000"><b>while </b></font><font color="#000080">(</font>DosError <font color="#000080">= </font><font color="#800000">3</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>length<font color="#000080">(</font>DirPath<font color="#000080">) &gt; </font><font color="#800000">3</font><font color="#000080">) </font><font color="#FF0000"><b>do     </b></font><font color="#008000"><i>{ If path not found....}
  </i></font><font color="#FF0000"><b>begin
  </b></font>i <font color="#000080">:= </font>length<font color="#000080">(</font>DirPath<font color="#000080">);             </font><font color="#008000"><i>{ then strip last directory from path. }
  </i></font><font color="#FF0000"><b>if </b></font>i <font color="#000080">&gt; </font><font color="#800000">3 </font><font color="#FF0000"><b>then </b></font>dec<font color="#000080">(</font>i<font color="#000080">);
  </font><font color="#FF0000"><b>while </b></font><font color="#000080">(</font>i <font color="#000080">&gt; </font><font color="#800000">3</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>DirPath<font color="#000080">[</font>i<font color="#000080">] &lt;&gt; </font><font color="#800000">'\'</font><font color="#000080">) </font><font color="#FF0000"><b>do </b></font>dec<font color="#000080">(</font>i<font color="#000080">);
  </font>DirPath <font color="#000080">:= </font>copy<font color="#000080">(</font>DirPath<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font>i<font color="#000080">);
  </font>FindFirst<font color="#000080">(</font>DirPath<font color="#000080">+</font><font color="#800000">'*.*'</font><font color="#000080">,</font>AnyFile<font color="#000080">,</font>DTA<font color="#000080">);                 </font><font color="#008000"><i>{ And try again. }
  </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>while </b></font>DosError <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>do                                </b></font><font color="#008000"><i>{ For all the files. }
  </i></font><font color="#FF0000"><b>begin
  </b></font>attr <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>DTA<font color="#000080">.</font>attr <font color="#FF0000"><b>and </b></font>Directory<font color="#000080">) = </font>Directory
    <font color="#FF0000"><b>then
      begin                                      </b></font><font color="#008000"><i>{ Setup for directories. }
      </i></font>name <font color="#000080">:= </font>DTA<font color="#000080">.</font>name<font color="#000080">;
      </font>ext <font color="#000080">:= </font><font color="#800000">''</font><font color="#000080">;
      </font><font color="#FF0000"><b>if </b></font>DTA<font color="#000080">.</font>name <font color="#000080">&lt;&gt; </font><font color="#800000">'.' </font><font color="#FF0000"><b>then </b></font>attr <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;          </font><font color="#008000"><i>{ Ignore '.' directory. }
      </i></font><font color="#FF0000"><b>if </b></font>DTA<font color="#000080">.</font>name <font color="#000080">= </font><font color="#800000">'..' </font><font color="#FF0000"><b>then </b></font>name <font color="#000080">:= </font><font color="#800000">'..'</font><font color="#000080">;
      </font><font color="#FF0000"><b>end
    else
      begin
      for </b></font>i <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>length<font color="#000080">(</font>DTA<font color="#000080">.</font>name<font color="#000080">) </font><font color="#FF0000"><b>do  </b></font><font color="#008000"><i>{ Translate filename to lowercase. }
        </i></font><font color="#FF0000"><b>if </b></font>DTA<font color="#000080">.</font>name<font color="#000080">[</font>i<font color="#000080">] </font><font color="#FF0000"><b>IN </b></font><font color="#000080">[</font><font color="#800000">'A'</font><font color="#000080">..</font><font color="#800000">'Z'</font><font color="#000080">] </font><font color="#FF0000"><b>then
          </b></font>DTA<font color="#000080">.</font>name<font color="#000080">[</font>i<font color="#000080">] := </font>chr<font color="#000080">(</font>ord<font color="#000080">(</font>DTA<font color="#000080">.</font>name<font color="#000080">[</font>i<font color="#000080">])+</font><font color="#800000">32</font><font color="#000080">);
      </font>i <font color="#000080">:= </font>pos<font color="#000080">(</font><font color="#800000">'.'</font><font color="#000080">,</font>DTA<font color="#000080">.</font>name<font color="#000080">);       </font><font color="#008000"><i>{ Split filename in name and extension. }
      </i></font><font color="#FF0000"><b>if </b></font>i <font color="#000080">&gt; </font><font color="#800000">0
        </font><font color="#FF0000"><b>then
          begin
          </b></font>name <font color="#000080">:= </font>copy<font color="#000080">(</font>DTA<font color="#000080">.</font>name<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font>i<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">);
          </font>ext  <font color="#000080">:= </font>copy<font color="#000080">(</font>DTA<font color="#000080">.</font>name<font color="#000080">,</font>i<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">,</font>length<font color="#000080">(</font>DTA<font color="#000080">.</font>name<font color="#000080">)-</font>i<font color="#000080">);
          </font><font color="#FF0000"><b>end
        else
          begin
          </b></font>name <font color="#000080">:= </font>DTA<font color="#000080">.</font>name<font color="#000080">;
          </font>ext <font color="#000080">:= </font><font color="#800000">''</font><font color="#000080">;
          </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font><font color="#008000"><i>{ Ignore unrecognised extensions. }
      </i></font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>ext <font color="#000080">= </font><font color="#800000">'com'</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>DTA<font color="#000080">.</font>name <font color="#000080">&lt;&gt; </font><font color="#800000">'command.com'</font><font color="#000080">) </font><font color="#FF0000"><b>then </b></font>attr <font color="#000080">:= </font><font color="#800000">2</font><font color="#000080">;
      </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>ext <font color="#000080">= </font><font color="#800000">'exe'</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>DTA<font color="#000080">.</font>name <font color="#000080">&lt;&gt; </font><font color="#800000">'exemenu.exe'</font><font color="#000080">) </font><font color="#FF0000"><b>then </b></font>attr <font color="#000080">:= </font><font color="#800000">2</font><font color="#000080">;
      </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>ext <font color="#000080">= </font><font color="#800000">'bat'</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>DTA<font color="#000080">.</font>name <font color="#000080">&lt;&gt; </font><font color="#800000">'autoexec.bat'</font><font color="#000080">) </font><font color="#FF0000"><b>then </b></font>attr <font color="#000080">:= </font><font color="#800000">2</font><font color="#000080">;
      </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>ext <font color="#000080">= </font><font color="#800000">'bas'</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>BasicPath <font color="#000080">&lt;&gt; </font><font color="#800000">''</font><font color="#000080">) </font><font color="#FF0000"><b>then </b></font>attr <font color="#000080">:= </font><font color="#800000">2</font><font color="#000080">;
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#008000"><i>{ If recognised extension or directory, then load into memory. }
  </i></font><font color="#FF0000"><b>if </b></font>attr <font color="#000080">&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then
    begin
    </b></font>i <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;
    </font><font color="#FF0000"><b>while </b></font><font color="#000080">(</font>i <font color="#000080">&lt;= </font>DirTop<font color="#000080">) </font><font color="#FF0000"><b>and         </b></font><font color="#008000"><i>{ Find location where to insert (sort). }
      </i></font><font color="#000080">((</font>attr <font color="#000080">&gt; </font>Dir<font color="#000080">[</font>i<font color="#000080">].</font>attr<font color="#000080">) </font><font color="#FF0000"><b>or
      </b></font><font color="#000080">((</font>attr <font color="#000080">= </font>Dir<font color="#000080">[</font>i<font color="#000080">].</font>attr<font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>name <font color="#000080">&gt; </font>Dir<font color="#000080">[</font>i<font color="#000080">].</font>name<font color="#000080">)) </font><font color="#FF0000"><b>or
      </b></font><font color="#000080">((</font>attr <font color="#000080">= </font>Dir<font color="#000080">[</font>i<font color="#000080">].</font>attr<font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>name <font color="#000080">= </font>Dir<font color="#000080">[</font>i<font color="#000080">].</font>name<font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>ext <font color="#000080">&gt; </font>Dir<font color="#000080">[</font>i<font color="#000080">].</font>ext<font color="#000080">)))
      </font><font color="#FF0000"><b>do </b></font>inc<font color="#000080">(</font>i<font color="#000080">);
    </font><font color="#FF0000"><b>if </b></font>DirTop <font color="#000080">&lt; </font>DirMax <font color="#FF0000"><b>then </b></font>inc<font color="#000080">(</font>DirTop<font color="#000080">);
    </font><font color="#FF0000"><b>if </b></font>i <font color="#000080">&lt; </font>DirTop <font color="#FF0000"><b>then              </b></font><font color="#008000"><i>{ Move entries up, to create entry. }
      </i></font>move<font color="#000080">(</font>Dir<font color="#000080">[</font>i<font color="#000080">],</font>Dir<font color="#000080">[</font>i<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">],</font>sizeof<font color="#000080">(</font>Dir<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">]) * (</font>DirTop <font color="#000080">- </font>i<font color="#000080">));
    </font><font color="#FF0000"><b>if </b></font>i <font color="#000080">&lt;= </font>DirMax <font color="#FF0000"><b>then              </b></font><font color="#008000"><i>{ Fill the entry. }
      </i></font><font color="#FF0000"><b>begin
      </b></font>Dir<font color="#000080">[</font>i<font color="#000080">].</font>name <font color="#000080">:= </font>name<font color="#000080">;
      </font>Dir<font color="#000080">[</font>i<font color="#000080">].</font>ext  <font color="#000080">:= </font>ext<font color="#000080">;
      </font>Dir<font color="#000080">[</font>i<font color="#000080">].</font>attr <font color="#000080">:= </font>attr<font color="#000080">;
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>FindNext<font color="#000080">(</font>DTA<font color="#000080">);                           </font><font color="#008000"><i>{ Next item. }
  </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{ Analyse the results. If nothing found (maybe disk error), and if we are in a
  subdirectory, then at least add the parent directory. }
</i></font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>DirTop <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>length<font color="#000080">(</font>DirPath<font color="#000080">) &gt; </font><font color="#800000">3</font><font color="#000080">) </font><font color="#FF0000"><b>then
  begin
  </b></font>Dir<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">].</font>name <font color="#000080">:= </font><font color="#800000">'..'</font><font color="#000080">;
  </font>Dir<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">].</font>ext  <font color="#000080">:= </font><font color="#800000">''</font><font color="#000080">;
  </font>Dir<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">].</font>attr <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;
  </font>DirTop      <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>ExecuteProgram<font color="#000080">;
</font><font color="#008000"><i>{ Execute the program at &quot;DirHere&quot;. }
</i></font><font color="#FF0000"><b>var
  </b></font>ProgramPath <font color="#000080">: </font>pathstr<font color="#000080">;               </font><font color="#008000"><i>{ Path to the program to execute. }
</i></font><font color="#FF0000"><b>begin
</b></font><font color="#008000"><i>{ Return from this subroutine if there is no program at the cursor. }
</i></font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>DirHere <font color="#000080">&lt; </font><font color="#800000">1</font><font color="#000080">) </font><font color="#FF0000"><b>or </b></font><font color="#000080">(</font>DirHere <font color="#000080">&gt; </font>DirTop<font color="#000080">) </font><font color="#FF0000"><b>or </b></font><font color="#000080">(</font>Dir<font color="#000080">[</font>DirHere<font color="#000080">].</font>attr <font color="#000080">&lt;&gt; </font><font color="#800000">2</font><font color="#000080">) </font><font color="#FF0000"><b>then </b></font>exit<font color="#000080">;

</font>colour <font color="#000080">:= </font><font color="#800000">$1E</font><font color="#000080">;                           </font><font color="#008000"><i>{ Show &quot;busy&quot; message. }
</i></font>xy <font color="#000080">:= </font><font color="#800000">164</font><font color="#000080">;
</font>Show<font color="#000080">(</font>left<font color="#000080">(</font>StrBusy<font color="#000080">,</font><font color="#800000">76</font><font color="#000080">));

</font><font color="#008000"><i>{ Setup path to the program. }
</i></font>ProgramPath <font color="#000080">:= </font>DirPath <font color="#000080">+ </font>Dir<font color="#000080">[</font>DirHere<font color="#000080">].</font>name <font color="#000080">+ </font><font color="#800000">'.' </font><font color="#000080">+ </font>Dir<font color="#000080">[</font>DirHere<font color="#000080">].</font>ext<font color="#000080">;

</font>FindFirst<font color="#000080">(</font>ProgramPath<font color="#000080">,</font>AnyFile<font color="#000080">,</font>DTA<font color="#000080">); </font><font color="#008000"><i>{ Test if the path to the program exists. }
</i></font><font color="#FF0000"><b>if </b></font>DosError <font color="#000080">&lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>exit<font color="#000080">;                       </font><font color="#008000"><i>{ Exit if error. }
</i></font>ResetVideo<font color="#000080">;                                       </font><font color="#008000"><i>{ Reset the video screen. }
</i></font>writeln<font color="#000080">(</font>StrStart<font color="#000080">,</font>ProgramPath<font color="#000080">);                    </font><font color="#008000"><i>{ Show startup message. }

</i></font>ChDir<font color="#000080">(</font>copy<font color="#000080">(</font>DirPath<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font>length<font color="#000080">(</font>DirPath<font color="#000080">)-</font><font color="#800000">1</font><font color="#000080">));        </font><font color="#008000"><i>{ Change to the directory. }
</i></font>SwapVectors<font color="#000080">;                                     </font><font color="#008000"><i>{ Start program. }
</i></font><font color="#FF0000"><b>if </b></font>Dir<font color="#000080">[</font>DirHere<font color="#000080">].</font>ext <font color="#000080">= </font><font color="#800000">'bat'            </font><font color="#008000"><i>{ .BAT files trough the COMMAND.COM. }
  </i></font><font color="#FF0000"><b>then </b></font>Exec<font color="#000080">(</font>getenv<font color="#000080">(</font><font color="#800000">'COMSPEC'</font><font color="#000080">),</font><font color="#800000">'/C '</font><font color="#000080">+</font>ProgramPath<font color="#000080">)
  </font><font color="#FF0000"><b>else if </b></font>Dir<font color="#000080">[</font>DirHere<font color="#000080">].</font>ext <font color="#000080">= </font><font color="#800000">'bas'     </font><font color="#008000"><i>{ .BAS trough the basic interpreter. }
    </i></font><font color="#FF0000"><b>then </b></font>Exec<font color="#000080">(</font>BasicPath<font color="#000080">,</font>ProgramPath<font color="#000080">)
    </font><font color="#FF0000"><b>else </b></font>Exec<font color="#000080">(</font>ProgramPath<font color="#000080">,</font><font color="#800000">''</font><font color="#000080">);                </font><font color="#008000"><i>{ Others directly. }
</i></font>SwapVectors<font color="#000080">;

</font>InitVideo<font color="#000080">;                                    </font><font color="#008000"><i>{ Initialise the video. }
</i></font>ShowMenu<font color="#000080">(</font>StrBusy<font color="#000080">);                     </font><font color="#008000"><i>{ Draw screen with &quot;busy&quot; message. }

{ Reset keyboard flags. }
</i></font>keyflags <font color="#000080">:= </font>keyflags <font color="#FF0000"><b>and </b></font><font color="#800000">$0F</font><font color="#000080">;  </font><font color="#008000"><i>{Capslock, Numlock, ScrollLock and Insert off.}
</i></font>fillchar<font color="#000080">(</font>regs<font color="#000080">,</font>sizeof<font color="#000080">(</font>regs<font color="#000080">),</font><font color="#800000">#0</font><font color="#000080">);                   </font><font color="#008000"><i>{ Clear registers. }
</i></font>regs<font color="#000080">.</font>ah <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;                                     </font><font color="#008000"><i>{ Activate new setting. }
</i></font>intr<font color="#000080">(</font><font color="#800000">$16</font><font color="#000080">,</font>regs<font color="#000080">);

</font>regs<font color="#000080">.</font>ah <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;                                    </font><font color="#008000"><i>{ Clear the keyboard buffer.}
</i></font>intr<font color="#000080">(</font><font color="#800000">$16</font><font color="#000080">,</font>regs<font color="#000080">);
</font><font color="#FF0000"><b>while </b></font><font color="#000080">(</font>regs<font color="#000080">.</font>flags <font color="#FF0000"><b>and </b></font>fzero<font color="#000080">) = </font><font color="#800000">0 </font><font color="#FF0000"><b>do
  begin
  </b></font>regs<font color="#000080">.</font>ah <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font>intr<font color="#000080">(</font><font color="#800000">$16</font><font color="#000080">,</font>regs<font color="#000080">);
  </font>regs<font color="#000080">.</font>ah <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;
  </font>intr<font color="#000080">(</font><font color="#800000">$16</font><font color="#000080">,</font>regs<font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font>Inkey <font color="#000080">:= </font><font color="#800000">13</font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>var
  </b></font>i <font color="#000080">: </font>word<font color="#000080">;                                            </font><font color="#008000"><i>{ Workvariable. }
  </i></font>s <font color="#000080">: </font>Str90<font color="#000080">;                                           </font><font color="#008000"><i>{ Workvariable. }
  </i></font>OldHere<font color="#000080">, </font>OldPageTop <font color="#000080">: </font>word<font color="#000080">;         </font><font color="#008000"><i>{ Determine if cursor has moved. }

</i></font><font color="#FF0000"><b>begin
</b></font>DirPath <font color="#000080">:= </font><font color="#800000">''</font><font color="#000080">;                         </font><font color="#008000"><i>{ No directory loaded right now. }
</i></font>DirTop <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;                           </font><font color="#008000"><i>{ No directory loaded right now. }
</i></font>ExitMsg <font color="#000080">:= </font>StrError<font color="#000080">;                   </font><font color="#008000"><i>{ Reset error message. }
</i></font>getdir<font color="#000080">(</font><font color="#800000">0</font><font color="#000080">,</font>OldPath<font color="#000080">);                     </font><font color="#008000"><i>{ Save current directory. }
</i></font>ExitSave <font color="#000080">:= </font>ExitProc<font color="#000080">;                  </font><font color="#008000"><i>{ Setup exit procedure. }
</i></font>ExitProc <font color="#000080">:= @</font>ExitCode<font color="#000080">;
</font>InitVideo<font color="#000080">;                             </font><font color="#008000"><i>{ Initialise the video. }
</i></font>ShowMenu<font color="#000080">(</font>StrBusy<font color="#000080">);                     </font><font color="#008000"><i>{ Draw screen with &quot;busy&quot; message. }

</i></font><font color="#FF0000"><b>if </b></font>lo<font color="#000080">(</font>DosVersion<font color="#000080">) &lt; </font><font color="#800000">3 </font><font color="#FF0000"><b>then             </b></font><font color="#008000"><i>{ Test DOS version. }
  </i></font><font color="#FF0000"><b>begin
  </b></font>ExitMsg <font color="#000080">:= </font>StrDos<font color="#000080">;
  </font>halt<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{ Determine what directory to search for programs. Default is the current
  directory. Otherwise the first argument after EXEMENU is used as starting
  path. }
</i></font><font color="#FF0000"><b>if </b></font>paramcount <font color="#000080">= </font><font color="#800000">0
  </font><font color="#FF0000"><b>then </b></font>DirPath <font color="#000080">:= </font>OldPath
  <font color="#FF0000"><b>else </b></font>DirPath <font color="#000080">:= </font>paramstr<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">);

</font><font color="#008000"><i>{ Find the basic interpreter somewhere in the path. If not found, then basic
  programs will not be listed. }
</i></font>BasicPath <font color="#000080">:= </font>Fsearch<font color="#000080">(</font><font color="#800000">'GWBASIC.EXE'</font><font color="#000080">,</font>GetEnv<font color="#000080">(</font><font color="#800000">'PATH'</font><font color="#000080">));
</font><font color="#FF0000"><b>if </b></font>BasicPath <font color="#000080">= </font><font color="#800000">'' </font><font color="#FF0000"><b>then </b></font>BasicPath <font color="#000080">:= </font>Fsearch<font color="#000080">(</font><font color="#800000">'GWBASIC.COM'</font><font color="#000080">,</font>GetEnv<font color="#000080">(</font><font color="#800000">'PATH'</font><font color="#000080">));
</font><font color="#FF0000"><b>if </b></font>BasicPath <font color="#000080">= </font><font color="#800000">'' </font><font color="#FF0000"><b>then </b></font>BasicPath <font color="#000080">:= </font>Fsearch<font color="#000080">(</font><font color="#800000">'BASIC.EXE'</font><font color="#000080">,</font>GetEnv<font color="#000080">(</font><font color="#800000">'PATH'</font><font color="#000080">));
</font><font color="#FF0000"><b>if </b></font>BasicPath <font color="#000080">= </font><font color="#800000">'' </font><font color="#FF0000"><b>then </b></font>BasicPath <font color="#000080">:= </font>Fsearch<font color="#000080">(</font><font color="#800000">'BASIC.COM'</font><font color="#000080">,</font>GetEnv<font color="#000080">(</font><font color="#800000">'PATH'</font><font color="#000080">));
</font><font color="#FF0000"><b>if </b></font>BasicPath <font color="#000080">= </font><font color="#800000">'' </font><font color="#FF0000"><b>then </b></font>BasicPath <font color="#000080">:= </font>Fsearch<font color="#000080">(</font><font color="#800000">'BASICA.EXE'</font><font color="#000080">,</font>GetEnv<font color="#000080">(</font><font color="#800000">'PATH'</font><font color="#000080">));
</font><font color="#FF0000"><b>if </b></font>BasicPath <font color="#000080">= </font><font color="#800000">'' </font><font color="#FF0000"><b>then </b></font>BasicPath <font color="#000080">:= </font>Fsearch<font color="#000080">(</font><font color="#800000">'BASICA.COM'</font><font color="#000080">,</font>GetEnv<font color="#000080">(</font><font color="#800000">'PATH'</font><font color="#000080">));
</font><font color="#FF0000"><b>if </b></font>BasicPath <font color="#000080">&lt;&gt; </font><font color="#800000">'' </font><font color="#FF0000"><b>then </b></font>BasicPath <font color="#000080">:= </font>FExpand<font color="#000080">(</font>BasicPath<font color="#000080">);

</font>LoadDir<font color="#000080">;                               </font><font color="#008000"><i>{ Load the directory into memory. }
</i></font>ShowMenu<font color="#000080">(</font>DirPath<font color="#000080">);                     </font><font color="#008000"><i>{ Display the directory. }
</i></font>ShowBar<font color="#000080">(</font>DirHere<font color="#000080">,</font>true<font color="#000080">);                 </font><font color="#008000"><i>{ Highlight the current choice. }

{ The main loop, exited only when the user presses ESC. }
</i></font><font color="#FF0000"><b>repeat
  </b></font><font color="#008000"><i>{ Wait for a key to be pressed. Place the scancode in the Inkey variable. }
  </i></font>regs<font color="#000080">.</font>ah <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font>intr<font color="#000080">(</font><font color="#800000">$16</font><font color="#000080">,</font>regs<font color="#000080">);
  </font>Inkey <font color="#000080">:= </font>regs<font color="#000080">.</font>ax<font color="#000080">;

  </font><font color="#FF0000"><b>if </b></font>lo<font color="#000080">(</font>Inkey<font color="#000080">) = </font><font color="#800000">13 </font><font color="#FF0000"><b>then               </b></font><font color="#008000"><i>{ Process ENTER key. }
    </i></font><font color="#FF0000"><b>begin
    </b></font>ShowBar<font color="#000080">(</font>DirHere<font color="#000080">,</font>false<font color="#000080">);            </font><font color="#008000"><i>{ Remove cursor bar. }
    </i></font>s <font color="#000080">:= </font><font color="#800000">''</font><font color="#000080">;                           </font><font color="#008000"><i>{ No item stored. }
    { If cursor points to a program....}
    </i></font><font color="#FF0000"><b>if </b></font>DirHere <font color="#000080">&lt;= </font>DirTop <font color="#FF0000"><b>then if </b></font>Dir<font color="#000080">[</font>DirHere<font color="#000080">].</font>attr <font color="#000080">= </font><font color="#800000">2
      </font><font color="#FF0000"><b>then
        begin
        </b></font><font color="#008000"><i>{ Store the item to execute, so we can move the cursor back to it. }
        </i></font>s <font color="#000080">:= </font>Dir<font color="#000080">[</font>DirHere<font color="#000080">].</font>name <font color="#000080">+ </font><font color="#800000">'.' </font><font color="#000080">+ </font>Dir<font color="#000080">[</font>DirHere<font color="#000080">].</font>ext<font color="#000080">;
        </font>ExecuteProgram<font color="#000080">;                </font><font color="#008000"><i>{ Then execute the program....}
        </i></font><font color="#FF0000"><b>end
      else if </b></font>Dir<font color="#000080">[</font>DirHere<font color="#000080">].</font>name <font color="#000080">&lt;&gt; </font><font color="#800000">'..'   </font><font color="#008000"><i>{ Else goto the directory....}
        </i></font><font color="#FF0000"><b>then </b></font>DirPath <font color="#000080">:= </font>fexpand<font color="#000080">(</font>DirPath<font color="#000080">+</font>Dir<font color="#000080">[</font>DirHere<font color="#000080">].</font>name<font color="#000080">) + </font><font color="#800000">'\'
        </font><font color="#FF0000"><b>else
          begin                           </b></font><font color="#008000"><i>{ Or goto the parent directory. }
          </i></font>i <font color="#000080">:= </font>length<font color="#000080">(</font>DirPath<font color="#000080">) - </font><font color="#800000">1</font><font color="#000080">;
          </font><font color="#FF0000"><b>while </b></font><font color="#000080">(</font>i <font color="#000080">&gt;= </font><font color="#800000">1</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>DirPath<font color="#000080">[</font>i<font color="#000080">] &lt;&gt; </font><font color="#800000">'\'</font><font color="#000080">) </font><font color="#FF0000"><b>do </b></font>dec<font color="#000080">(</font>i<font color="#000080">);
          </font><font color="#008000"><i>{Store the directory we just left, so we can move the cursor to it.}
          </i></font>s <font color="#000080">:= </font>copy<font color="#000080">(</font>DirPath<font color="#000080">,</font>i<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">,</font>length<font color="#000080">(</font>DirPath<font color="#000080">)-</font>i<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">);
          </font><font color="#FF0000"><b>if </b></font>i <font color="#000080">&gt; </font><font color="#800000">0
            </font><font color="#FF0000"><b>then </b></font>DirPath <font color="#000080">:= </font>copy<font color="#000080">(</font>DirPath<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font>i<font color="#000080">)
            </font><font color="#FF0000"><b>else </b></font>DirPath <font color="#000080">:= </font><font color="#800000">'\'</font><font color="#000080">;
          </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font>LoadDir<font color="#000080">;                              </font><font color="#008000"><i>{ Reload the directory. }
    { If an item was stored, then find it, and move the cursor to it. }
    </i></font><font color="#FF0000"><b>if </b></font>s <font color="#000080">&lt;&gt; </font><font color="#800000">'' </font><font color="#FF0000"><b>then
      begin
      </b></font>DirHere <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;
      </font><font color="#FF0000"><b>if </b></font>pos<font color="#000080">(</font><font color="#800000">'.'</font><font color="#000080">,</font>s<font color="#000080">) = </font><font color="#800000">0
        </font><font color="#FF0000"><b>then while </b></font><font color="#000080">(</font>DirHere <font color="#000080">&lt; </font>DirTop<font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>Dir<font color="#000080">[</font>DirHere<font color="#000080">].</font>name <font color="#000080">&lt;&gt; </font>s<font color="#000080">) </font><font color="#FF0000"><b>do
          </b></font>inc<font color="#000080">(</font>DirHere<font color="#000080">)
        </font><font color="#FF0000"><b>else while </b></font><font color="#000080">(</font>DirHere <font color="#000080">&lt; </font>DirTop<font color="#000080">) </font><font color="#FF0000"><b>and
          </b></font><font color="#000080">(</font>Dir<font color="#000080">[</font>DirHere<font color="#000080">].</font>name <font color="#000080">+ </font><font color="#800000">'.' </font><font color="#000080">+ </font>Dir<font color="#000080">[</font>DirHere<font color="#000080">].</font>ext <font color="#000080">&lt;&gt; </font>s<font color="#000080">) </font><font color="#FF0000"><b>do </b></font>inc<font color="#000080">(</font>DirHere<font color="#000080">);
      </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>DirHere <font color="#000080">&lt;= </font>DirTop<font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(
          ((</font>pos<font color="#000080">(</font><font color="#800000">'.'</font><font color="#000080">,</font>s<font color="#000080">) = </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>and
           </b></font><font color="#000080">(</font>Dir<font color="#000080">[</font>DirHere<font color="#000080">].</font>name <font color="#000080">&lt;&gt; </font>s<font color="#000080">)) </font><font color="#FF0000"><b>or
          </b></font><font color="#000080">((</font>pos<font color="#000080">(</font><font color="#800000">'.'</font><font color="#000080">,</font>s<font color="#000080">) &gt; </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>and
           </b></font><font color="#000080">(</font>Dir<font color="#000080">[</font>DirHere<font color="#000080">].</font>name <font color="#000080">+ </font><font color="#800000">'.' </font><font color="#000080">+ </font>Dir<font color="#000080">[</font>DirHere<font color="#000080">].</font>ext <font color="#000080">&lt;&gt; </font>s<font color="#000080">)) )
        </font><font color="#FF0000"><b>then </b></font>DirHere <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font>ShowMenu<font color="#000080">(</font>DirPath<font color="#000080">);                    </font><font color="#008000"><i>{ Show the menu. }
    </i></font>ShowBar<font color="#000080">(</font>DirHere<font color="#000080">,</font>true<font color="#000080">);                </font><font color="#008000"><i>{ Show cursor bar. }
    </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#008000"><i>{ Process cursor movement keys. }
  </i></font>OldHere <font color="#000080">:= </font>DirHere<font color="#000080">; </font><font color="#008000"><i>{Remember current cursor, to determine if it has moved.}
  </i></font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>Inkey <font color="#000080">= </font><font color="#800000">$4800</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>DirHere <font color="#000080">&gt; </font><font color="#800000">1</font><font color="#000080">) </font><font color="#FF0000"><b>then </b></font>dec<font color="#000080">(</font>DirHere<font color="#000080">);        </font><font color="#008000"><i>{ arrow-up.}
  </i></font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>Inkey <font color="#000080">= </font><font color="#800000">$5000</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>DirHere <font color="#000080">&lt; </font>DirTop<font color="#000080">) </font><font color="#FF0000"><b>then </b></font>inc<font color="#000080">(</font>DirHere<font color="#000080">);   </font><font color="#008000"><i>{arrow-down.}
  </i></font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>Inkey <font color="#000080">= </font><font color="#800000">$4D00</font><font color="#000080">) </font><font color="#FF0000"><b>or </b></font><font color="#000080">(</font>lo<font color="#000080">(</font>Inkey<font color="#000080">) = </font><font color="#800000">9</font><font color="#000080">) </font><font color="#FF0000"><b>then             </b></font><font color="#008000"><i>{arrow-right or tab.}
    </i></font><font color="#FF0000"><b>if </b></font>DirHere <font color="#000080">+ </font><font color="#800000">21 </font><font color="#000080">&lt;= </font>DirTop
      <font color="#FF0000"><b>then </b></font>DirHere <font color="#000080">:= </font>DirHere <font color="#000080">+ </font><font color="#800000">21
      </font><font color="#FF0000"><b>else </b></font>DirHere <font color="#000080">:= </font>DirTop<font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>Inkey <font color="#000080">= </font><font color="#800000">$4B00</font><font color="#000080">) </font><font color="#FF0000"><b>or </b></font><font color="#000080">(</font>Inkey <font color="#000080">= </font><font color="#800000">$0F00</font><font color="#000080">) </font><font color="#FF0000"><b>then    </b></font><font color="#008000"><i>{ arrow-left or shift-tab. }
    </i></font><font color="#FF0000"><b>if </b></font>DirHere <font color="#000080">&gt; </font><font color="#800000">21
      </font><font color="#FF0000"><b>then </b></font>DirHere <font color="#000080">:= </font>DirHere <font color="#000080">- </font><font color="#800000">21
      </font><font color="#FF0000"><b>else </b></font>DirHere <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>Inkey <font color="#000080">= </font><font color="#800000">$5100</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>DirHere <font color="#000080">&lt; </font>DirTop<font color="#000080">) </font><font color="#FF0000"><b>then                   </b></font><font color="#008000"><i>{ pgdn. }
    </i></font><font color="#FF0000"><b>if </b></font>DirTop <font color="#000080">&gt; </font><font color="#800000">105
      </font><font color="#FF0000"><b>then if </b></font>DirHere <font color="#000080">+ </font><font color="#800000">105 </font><font color="#000080">&lt; </font>DirTop
        <font color="#FF0000"><b>then </b></font>DirHere <font color="#000080">:= </font>DirHere <font color="#000080">+ </font><font color="#800000">105
        </font><font color="#FF0000"><b>else </b></font>DirHere <font color="#000080">:= </font>DirTop
      <font color="#FF0000"><b>else if </b></font><font color="#000080">(</font>DirHere <font color="#000080">- </font><font color="#800000">1</font><font color="#000080">) </font><font color="#FF0000"><b>mod </b></font><font color="#800000">21 </font><font color="#000080">= </font><font color="#800000">20
        </font><font color="#FF0000"><b>then if </b></font>DirHere <font color="#000080">+ </font><font color="#800000">21 </font><font color="#000080">&lt;= </font>DirTop
          <font color="#FF0000"><b>then </b></font>DirHere <font color="#000080">:= </font>DirHere <font color="#000080">+ </font><font color="#800000">21
          </font><font color="#FF0000"><b>else </b></font>DirHere <font color="#000080">:= </font>DirTop
        <font color="#FF0000"><b>else if </b></font>DirHere <font color="#000080">- (</font>DirHere <font color="#000080">- </font><font color="#800000">1</font><font color="#000080">) </font><font color="#FF0000"><b>mod </b></font><font color="#800000">21 </font><font color="#000080">+ </font><font color="#800000">20 </font><font color="#000080">&lt; </font>DirTop
          <font color="#FF0000"><b>then </b></font>DirHere <font color="#000080">:= </font>DirHere <font color="#000080">- (</font>DirHere <font color="#000080">- </font><font color="#800000">1</font><font color="#000080">) </font><font color="#FF0000"><b>mod </b></font><font color="#800000">21 </font><font color="#000080">+ </font><font color="#800000">20
          </font><font color="#FF0000"><b>else </b></font>DirHere <font color="#000080">:= </font>DirTop<font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>Inkey <font color="#000080">= </font><font color="#800000">$4900</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>DirHere <font color="#000080">&gt; </font><font color="#800000">1</font><font color="#000080">) </font><font color="#FF0000"><b>then                        </b></font><font color="#008000"><i>{ pgup. }
    </i></font><font color="#FF0000"><b>if </b></font>DirTop <font color="#000080">&gt; </font><font color="#800000">105
      </font><font color="#FF0000"><b>then if </b></font>DirHere <font color="#000080">&gt; </font><font color="#800000">105
        </font><font color="#FF0000"><b>then </b></font>DirHere <font color="#000080">:= </font>DirHere <font color="#000080">- </font><font color="#800000">105
        </font><font color="#FF0000"><b>else </b></font>DirHere <font color="#000080">:= </font><font color="#800000">1
      </font><font color="#FF0000"><b>else if </b></font><font color="#000080">(</font>DirHere <font color="#000080">- </font><font color="#800000">1</font><font color="#000080">) </font><font color="#FF0000"><b>mod </b></font><font color="#800000">21 </font><font color="#000080">= </font><font color="#800000">0
        </font><font color="#FF0000"><b>then if </b></font>DirHere <font color="#000080">&gt; </font><font color="#800000">21
          </font><font color="#FF0000"><b>then </b></font>DirHere <font color="#000080">:= </font>DirHere <font color="#000080">- </font><font color="#800000">21
          </font><font color="#FF0000"><b>else </b></font>DirHere <font color="#000080">:= </font><font color="#800000">1
        </font><font color="#FF0000"><b>else </b></font>DirHere <font color="#000080">:= </font>DirHere <font color="#000080">- (</font>DirHere <font color="#000080">- </font><font color="#800000">1</font><font color="#000080">) </font><font color="#FF0000"><b>mod </b></font><font color="#800000">21</font><font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font>Inkey <font color="#000080">= </font><font color="#800000">$4700 </font><font color="#FF0000"><b>then </b></font>DirHere <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;                             </font><font color="#008000"><i>{ home. }
  </i></font><font color="#FF0000"><b>if </b></font>Inkey <font color="#000080">= </font><font color="#800000">$4F00 </font><font color="#FF0000"><b>then </b></font>DirHere <font color="#000080">:= </font>DirTop<font color="#000080">;                         </font><font color="#008000"><i>{ end. }
  </i></font><font color="#FF0000"><b>if </b></font>lo<font color="#000080">(</font>Inkey<font color="#000080">) &gt; </font><font color="#800000">31 </font><font color="#FF0000"><b>then                      </b></font><font color="#008000"><i>{Process a character inkey. }
    </i></font><font color="#FF0000"><b>begin
    </b></font>i <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;
    </font><font color="#FF0000"><b>while </b></font><font color="#000080">(</font>i <font color="#000080">&lt;= </font>DirTop<font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>Dir<font color="#000080">[</font>i<font color="#000080">].</font>name<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">] &lt;&gt; </font>chr<font color="#000080">(</font>lo<font color="#000080">(</font>Inkey<font color="#000080">))) </font><font color="#FF0000"><b>do </b></font>inc<font color="#000080">(</font>i<font color="#000080">);
    </font><font color="#FF0000"><b>if </b></font>i <font color="#000080">&lt;= </font>DirTop <font color="#FF0000"><b>then </b></font>DirHere <font color="#000080">:= </font>i<font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font>DirHere <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>DirHere <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;           </font><font color="#008000"><i>{ Correct for empty list. }
  { If the cursor has moved off the screen, then redraw the menu. }
  </i></font><font color="#FF0000"><b>if </b></font>OldHere <font color="#000080">- </font>OldHere <font color="#FF0000"><b>mod </b></font><font color="#800000">105 </font><font color="#000080">+ </font><font color="#800000">1 </font><font color="#000080">&lt;&gt; </font>DirHere <font color="#000080">- </font>DirHere <font color="#FF0000"><b>mod </b></font><font color="#800000">105 </font><font color="#000080">+ </font><font color="#800000">1 </font><font color="#FF0000"><b>then
    begin
    </b></font>ShowBar<font color="#000080">(</font>OldHere<font color="#000080">,</font>false<font color="#000080">);
    </font>ShowMenu<font color="#000080">(</font>DirPath<font color="#000080">);
    </font>ShowBar<font color="#000080">(</font>DirHere<font color="#000080">,</font>true<font color="#000080">);
    </font>OldHere <font color="#000080">:= </font>DirHere<font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font>OldHere <font color="#000080">&lt;&gt; </font>DirHere <font color="#FF0000"><b>then    </b></font><font color="#008000"><i>{ If the cursor has moved, then redraw it. }
    </i></font><font color="#FF0000"><b>begin
    </b></font>ShowBar<font color="#000080">(</font>OldHere<font color="#000080">,</font>false<font color="#000080">);
    </font>ShowBar<font color="#000080">(</font>DirHere<font color="#000080">,</font>true<font color="#000080">);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>until </b></font>lo<font color="#000080">(</font>Inkey<font color="#000080">) = </font><font color="#800000">27</font><font color="#000080">;                             </font><font color="#008000"><i>{ Until ESC key pressed. }

</i></font>ExitMsg <font color="#000080">:= </font>StrExit<font color="#000080">;                                   </font><font color="#008000"><i>{ Exit with message. }
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to EXEC SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0023.PAS">Original</a><b>]</b></p></body>
</html>
