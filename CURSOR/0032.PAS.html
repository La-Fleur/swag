<html>
<head><title> "Extended Cursor Handling unit" by CHAD MOORE</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to CURSOR SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0032.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code>
<font color="#008000"><i>{ Author:  Chad Moore

  I have been writing my own multipurpose units for projects for quite some
  time now, and I noticed how all of the cursor routines in the SWAG used
  BIOS calls, well, I just happened to be writing an extended display unit
  for use with my display unit, and I figured you all could enjoy my
  routines.  They may not be as optomized as they could be, but they work.
  So, in other words, rip it, steal it, use it, distribute it, etc.

  Some of them may screw up while using the Crt unit, because it keeps track
  of cursor movement itself...  (remember, I have my OWN display unit...I
  hate the Crt one)  Anyway, they all DO work, but I am not responsible for
  any damages caused by these routines.  Oh, and the routines are all based
  on 0 through whatever - 1, rather than 1 through whatever.  (the way the
  computer would do it)

  If you would like to get information on the CRTC registers (the ones I
  used for this), Mode-X, sound, XMS/EMS/conventional memory, 3-D graphics,
  and much more, I recomend this book:

  PC Underground Unconventional Programming Topics
  from Abacus...

}

{ Extended alphanumeric display unit }
</i></font><font color="#FF0000"><b>unit </b></font>XDisplay<font color="#000080">;
</font><font color="#008000"><i>{$G+} { Enable 286 instructions }

</i></font><font color="#FF0000"><b>interface

procedure </b></font>CursorOn<font color="#000080">;
  </font><font color="#008000"><i>{ turns the cursor ON }
</i></font><font color="#FF0000"><b>procedure </b></font>CursorOff<font color="#000080">;
  </font><font color="#008000"><i>{ turns the cursor OFF }
</i></font><font color="#FF0000"><b>function </b></font>CursorState <font color="#000080">: </font>Boolean<font color="#000080">;
  </font><font color="#008000"><i>{ returns TRUE if the cursor is ON }
</i></font><font color="#FF0000"><b>procedure </b></font>CursorShape<font color="#000080">( </font>StartScan<font color="#000080">, </font>EndScan <font color="#000080">: </font>Byte <font color="#000080">);
  </font><font color="#008000"><i>{ defines the cursor shape }
</i></font><font color="#FF0000"><b>function </b></font>GetCursorShape <font color="#000080">: </font>Word<font color="#000080">;
  </font><font color="#008000"><i>{ high 8 bits = startscan, low 8 bits = endscan }
</i></font><font color="#FF0000"><b>procedure </b></font>CursorPosition<font color="#000080">( </font>Column<font color="#000080">, </font>Row <font color="#000080">: </font>Byte <font color="#000080">);
  </font><font color="#008000"><i>{ positions the cursor }
</i></font><font color="#FF0000"><b>function </b></font>CursorColumn <font color="#000080">: </font>Byte<font color="#000080">;
  </font><font color="#008000"><i>{ returns the cursor column }
</i></font><font color="#FF0000"><b>function </b></font>CursorRow <font color="#000080">: </font>Byte<font color="#000080">;
  </font><font color="#008000"><i>{ returns the cursor row }

</i></font><font color="#FF0000"><b>implementation

procedure </b></font>CursorOn<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>asm
  </b></font><font color="#FF00FF">MOV   DX,03D4H        </font><font color="#008000"><i>{ CRTC index register }
  </i></font><font color="#FF00FF">MOV   AL,0AH          </font><font color="#008000"><i>{ select register 0Ah }
  </i></font><font color="#FF00FF">OUT   DX,AL
  INC   DX              </font><font color="#008000"><i>{ CRTC data register }
  </i></font><font color="#FF00FF">IN    AL,DX           </font><font color="#008000"><i>{ get status }
  </i></font><font color="#FF00FF">AND   AL,0DFH         </font><font color="#008000"><i>{ bit 5 = 0 (Cursor on) }
  </i></font><font color="#FF00FF">OUT   DX,AL
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>CursorOff<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>asm
  </b></font><font color="#FF00FF">MOV   DX,03D4H        </font><font color="#008000"><i>{ CRTC index register }
  </i></font><font color="#FF00FF">MOV   AL,0AH          </font><font color="#008000"><i>{ select register 0Ah }
  </i></font><font color="#FF00FF">OUT   DX,AL
  INC   DX              </font><font color="#008000"><i>{ CRTC data register }
  </i></font><font color="#FF00FF">IN    AL,DX           </font><font color="#008000"><i>{ get status }
  </i></font><font color="#FF00FF">OR    AL,20H          </font><font color="#008000"><i>{ bit 5 = 1 (Cursor off) }
  </i></font><font color="#FF00FF">OUT   DX,AL
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>CursorState <font color="#000080">: </font>Boolean<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>asm
  </b></font><font color="#FF00FF">MOV   DX,03D4H        </font><font color="#008000"><i>{ CRTC index register }
  </i></font><font color="#FF00FF">MOV   AL,0AH          </font><font color="#008000"><i>{ select register 0Ah }
  </i></font><font color="#FF00FF">OUT   DX,AL
  INC   DX              </font><font color="#008000"><i>{ CRTC data register }
  </i></font><font color="#FF00FF">IN    AL,DX           </font><font color="#008000"><i>{ get status }
  </i></font><font color="#FF00FF">AND   AL,20H          </font><font color="#008000"><i>{ if bit 5 = 1, cursor is off }
  </i></font><font color="#FF00FF">CMP   AL,20H          </font><font color="#008000"><i>{ is bit 5 on? }
  </i></font><font color="#FF00FF">JE    @@cursoroff
  MOV   AL,TRUE         </font><font color="#008000"><i>{ no, cursor is on }
  </i></font><font color="#FF00FF">JMP   @@done          </font><font color="#008000"><i>{ return }
</i></font><font color="#FF00FF">@@cursoroff:
  MOV   AL,FALSE        </font><font color="#008000"><i>{ yes, cursor is off }
</i></font><font color="#FF00FF">@@done:
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>CursorShape<font color="#000080">( </font>StartScan<font color="#000080">, </font>EndScan <font color="#000080">: </font>Byte <font color="#000080">); </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>asm
  </b></font><font color="#FF00FF">MOV   DX,03D4H        </font><font color="#008000"><i>{ CRTC index register }
  </i></font><font color="#FF00FF">MOV   AL,0AH          </font><font color="#008000"><i>{ select register 0Ah }
  </i></font><font color="#FF00FF">OUT   DX,AL
  INC   DX              </font><font color="#008000"><i>{ CRTC data register }
  </i></font><font color="#FF00FF">IN    AL,DX           </font><font color="#008000"><i>{ get status }
  </i></font><font color="#FF00FF">MOV   AH,StartScan
  AND   AL,0E0H         </font><font color="#008000"><i>{ clear bits 0-4 }
  </i></font><font color="#FF00FF">OR    AL,AH           </font><font color="#008000"><i>{ bits 0-4 = StartScan, save bits 5-7 }
  </i></font><font color="#FF00FF">OUT   DX,AL
  DEC   DX              </font><font color="#008000"><i>{ CRTC index register }
  </i></font><font color="#FF00FF">MOV   AL,0BH          </font><font color="#008000"><i>{ select register 0Bh }
  </i></font><font color="#FF00FF">OUT   DX,AL
  INC   DX              </font><font color="#008000"><i>{ CRTC data register }
  </i></font><font color="#FF00FF">IN    AL,DX           </font><font color="#008000"><i>{ get status }
  </i></font><font color="#FF00FF">MOV   AH,EndScan
  AND   AL,0E0H         </font><font color="#008000"><i>{ clear bits 0-4 }
  </i></font><font color="#FF00FF">OR    AL,AH           </font><font color="#008000"><i>{ bits 0-4 = EndScan, save bits 5-7 }
  </i></font><font color="#FF00FF">OUT   DX,AL
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>GetCursorShape <font color="#000080">: </font>Word<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>asm
  </b></font><font color="#FF00FF">MOV   DX,03D4H        </font><font color="#008000"><i>{ CRTC index register }
  </i></font><font color="#FF00FF">MOV   AL,0AH          </font><font color="#008000"><i>{ select register 0Ah }
  </i></font><font color="#FF00FF">OUT   DX,AL
  INC   DX              </font><font color="#008000"><i>{ CRTC data register }
  </i></font><font color="#FF00FF">IN    AL,DX           </font><font color="#008000"><i>{ get status }
  </i></font><font color="#FF00FF">AND   AL,1FH          </font><font color="#008000"><i>{ clear bits 5-7 }
  </i></font><font color="#FF00FF">MOV   AH,AL           </font><font color="#008000"><i>{ AH = startscan }
  </i></font><font color="#FF00FF">DEC   DX              </font><font color="#008000"><i>{ CRTC index register }
  </i></font><font color="#FF00FF">MOV   AL,0BH          </font><font color="#008000"><i>{ select register 0Bh }
  </i></font><font color="#FF00FF">OUT   DX,AL
  INC   DX              </font><font color="#008000"><i>{ CRTC data register }
  </i></font><font color="#FF00FF">IN    AL,DX           </font><font color="#008000"><i>{ get status }
  </i></font><font color="#FF00FF">AND   AL,1FH          </font><font color="#008000"><i>{ clear bits 5-7 }
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>CursorPosition<font color="#000080">( </font>Column<font color="#000080">, </font>Row <font color="#000080">: </font>Byte <font color="#000080">); </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>asm
  </b></font><font color="#008000"><i>{ get cursor offset into BX }
  </i></font><font color="#FF00FF">MOV   DX,03D4H        </font><font color="#008000"><i>{ CRTC index register }
  </i></font><font color="#FF00FF">MOV   AL,13H          </font><font color="#008000"><i>{ select register 13H }
  </i></font><font color="#FF00FF">OUT   DX,AL
  INC   DX              </font><font color="#008000"><i>{ CRTC data register }
  </i></font><font color="#FF00FF">IN    AL,DX
  MOV   AH,AL           </font><font color="#008000"><i>{ store row offset in AH }
  </i></font><font color="#FF00FF">DEC   DX              </font><font color="#008000"><i>{ CRTC index register }
  </i></font><font color="#FF00FF">MOV   AL,14H          </font><font color="#008000"><i>{ select register 14H }
  </i></font><font color="#FF00FF">OUT   DX,AL
  INC   DX              </font><font color="#008000"><i>{ CRTC data register }
  </i></font><font color="#FF00FF">IN    AL,DX
  SHL   AH,01H          </font><font color="#008000"><i>{ multiply by 2 }
  </i></font><font color="#FF00FF">AND   AL,40H          </font><font color="#008000"><i>{ check bit 5 for doubleword addressing }
  </i></font><font color="#FF00FF">CMP   AL,00H          </font><font color="#008000"><i>{ doubleword? }
  </i></font><font color="#FF00FF">JE    @@continue      </font><font color="#008000"><i>{ no, continue }
  </i></font><font color="#FF00FF">SHL   AH,01H          </font><font color="#008000"><i>{ yes, multiply by 2 *more* }
</i></font><font color="#FF00FF">@@continue:
                        </font><font color="#008000"><i>{ AH = row length }
  </i></font><font color="#FF00FF">SHR   AX,08H          </font><font color="#008000"><i>{ AX = row length }
  </i></font><font color="#FF00FF">MUL   Row             </font><font color="#008000"><i>{ row length * Row }
  </i></font><font color="#FF00FF">MOV   BL,Column
  XOR   BH,BH
  ADD   AX,BX           </font><font color="#008000"><i>{ + Column }
  </i></font><font color="#FF00FF">MOV   BX,AX           </font><font color="#008000"><i>{ BX = cursor offset }
  { send BX to CRTC }
  </i></font><font color="#FF00FF">DEC   DX              </font><font color="#008000"><i>{ CRTC index register }
  </i></font><font color="#FF00FF">MOV   AL,0EH          </font><font color="#008000"><i>{ select register 0EH (cursor offset HIGH) }
  </i></font><font color="#FF00FF">OUT   DX,AL
  INC   DX              </font><font color="#008000"><i>{ CRTC data register }
  </i></font><font color="#FF00FF">MOV   AL,BH           </font><font color="#008000"><i>{ get HIGH to send }
  </i></font><font color="#FF00FF">OUT   DX,AL
  DEC   DX              </font><font color="#008000"><i>{ CRTC index register }
  </i></font><font color="#FF00FF">MOV   AL,0FH          </font><font color="#008000"><i>{ select register 0FH (cursor offset LOW) }
  </i></font><font color="#FF00FF">OUT   DX,AL
  INC   DX              </font><font color="#008000"><i>{ CRTC data register }
  </i></font><font color="#FF00FF">MOV   AL,BL           </font><font color="#008000"><i>{ get LOW to send }
  </i></font><font color="#FF00FF">OUT   DX,AL
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>CursorColumn <font color="#000080">: </font>Byte<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>asm
  </b></font><font color="#008000"><i>{ get cursor offset }
  </i></font><font color="#FF00FF">MOV   DX,03D4H        </font><font color="#008000"><i>{ CRTC index register }
  </i></font><font color="#FF00FF">MOV   AL,0EH          </font><font color="#008000"><i>{ select register 0Eh }
  </i></font><font color="#FF00FF">OUT   DX,AL
  INC   DX              </font><font color="#008000"><i>{ CRTC data register }
  </i></font><font color="#FF00FF">IN    AL,DX
  SHL   AX,08H          </font><font color="#008000"><i>{ AH = high bits }
  </i></font><font color="#FF00FF">DEC   DX              </font><font color="#008000"><i>{ CRTC index register }
  </i></font><font color="#FF00FF">MOV   AL,0FH          </font><font color="#008000"><i>{ select register 0Fh }
  </i></font><font color="#FF00FF">OUT   DX,AL
  INC   DX              </font><font color="#008000"><i>{ CRTC data register }
  </i></font><font color="#FF00FF">IN    AL,DX           </font><font color="#008000"><i>{ AL = low bits }
  </i></font><font color="#FF00FF">MOV   CX,AX           </font><font color="#008000"><i>{ save cursor offset }
  { get chars per line }
  </i></font><font color="#FF00FF">DEC   DX              </font><font color="#008000"><i>{ CRTC index register }
  </i></font><font color="#FF00FF">MOV   AL,14H          </font><font color="#008000"><i>{ select register 14h }
  </i></font><font color="#FF00FF">OUT   DX,AL
  INC   DX              </font><font color="#008000"><i>{ CRTC data register }
  </i></font><font color="#FF00FF">IN    AL,DX           </font><font color="#008000"><i>{ doubleword addressing? }
  </i></font><font color="#FF00FF">MOV   BL,AL           </font><font color="#008000"><i>{ save in BL }
  </i></font><font color="#FF00FF">DEC   DX              </font><font color="#008000"><i>{ CRTC index register }
  </i></font><font color="#FF00FF">MOV   AL,13H          </font><font color="#008000"><i>{ select register 13h }
  </i></font><font color="#FF00FF">OUT   DX,AL
  INC   DX              </font><font color="#008000"><i>{ CRTC data register }
  </i></font><font color="#FF00FF">IN    AL,DX           </font><font color="#008000"><i>{ get offset between 2 lines (line width) }
  </i></font><font color="#FF00FF">SHL   AL,01H          </font><font color="#008000"><i>{ multiply by 2 }
  </i></font><font color="#FF00FF">AND   BL,40H          </font><font color="#008000"><i>{ check bit 5 for doubleword addressing }
  </i></font><font color="#FF00FF">CMP   BL,00H          </font><font color="#008000"><i>{ doubleword? }
  </i></font><font color="#FF00FF">JE    @@continue      </font><font color="#008000"><i>{ no, continue }
  </i></font><font color="#FF00FF">SHL   AL,01H          </font><font color="#008000"><i>{ multiply by 2 *more* }
</i></font><font color="#FF00FF">@@continue:             </font><font color="#008000"><i>{ AL = chars per line }
  { calculate }
  </i></font><font color="#FF00FF">XOR   AH,AH           </font><font color="#008000"><i>{ clear upper AX }
  </i></font><font color="#FF00FF">MOV   BX,AX           </font><font color="#008000"><i>{ get chars per line in BX }
  </i></font><font color="#FF00FF">XOR   DX,DX           </font><font color="#008000"><i>{ DX:AX gets ready for div }
  </i></font><font color="#FF00FF">MOV   AX,CX           </font><font color="#008000"><i>{ get cursor offset }
  </i></font><font color="#FF00FF">DIV   BX              </font><font color="#008000"><i>{ div DX = remainder, AX = answer }
  </i></font><font color="#FF00FF">MOV   AX,DX           </font><font color="#008000"><i>{ get remainder }
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>CursorRow <font color="#000080">: </font>Byte<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>asm
  </b></font><font color="#008000"><i>{ get cursor offset }
  </i></font><font color="#FF00FF">MOV   DX,03D4H        </font><font color="#008000"><i>{ CRTC index register }
  </i></font><font color="#FF00FF">MOV   AL,0EH          </font><font color="#008000"><i>{ select register 0Eh }
  </i></font><font color="#FF00FF">OUT   DX,AL
  INC   DX              </font><font color="#008000"><i>{ CRTC data register }
  </i></font><font color="#FF00FF">IN    AL,DX
  SHL   AX,08H          </font><font color="#008000"><i>{ AH = high bits }
  </i></font><font color="#FF00FF">DEC   DX              </font><font color="#008000"><i>{ CRTC index register }
  </i></font><font color="#FF00FF">MOV   AL,0FH          </font><font color="#008000"><i>{ select register 0Fh }
  </i></font><font color="#FF00FF">OUT   DX,AL
  INC   DX              </font><font color="#008000"><i>{ CRTC data register }
  </i></font><font color="#FF00FF">IN    AL,DX           </font><font color="#008000"><i>{ AL = low bits }
  </i></font><font color="#FF00FF">MOV   CX,AX           </font><font color="#008000"><i>{ save cursor offset }
  { get chars per line }
  </i></font><font color="#FF00FF">DEC   DX              </font><font color="#008000"><i>{ CRTC index register }
  </i></font><font color="#FF00FF">MOV   AL,14H          </font><font color="#008000"><i>{ select register 14h }
  </i></font><font color="#FF00FF">OUT   DX,AL
  INC   DX              </font><font color="#008000"><i>{ CRTC data register }
  </i></font><font color="#FF00FF">IN    AL,DX           </font><font color="#008000"><i>{ doubleword addressing? }
  </i></font><font color="#FF00FF">MOV   BL,AL           </font><font color="#008000"><i>{ save in BL }
  </i></font><font color="#FF00FF">DEC   DX              </font><font color="#008000"><i>{ CRTC index register }
  </i></font><font color="#FF00FF">MOV   AL,13H          </font><font color="#008000"><i>{ select register 13h }
  </i></font><font color="#FF00FF">OUT   DX,AL
  INC   DX              </font><font color="#008000"><i>{ CRTC data register }
  </i></font><font color="#FF00FF">IN    AL,DX           </font><font color="#008000"><i>{ get offset between 2 lines (line width) }
  </i></font><font color="#FF00FF">SHL   AL,01H          </font><font color="#008000"><i>{ multiply by 2 }
  </i></font><font color="#FF00FF">AND   BL,40H          </font><font color="#008000"><i>{ check bit 5 for doubleword addressing }
  </i></font><font color="#FF00FF">CMP   BL,00H          </font><font color="#008000"><i>{ doubleword? }
  </i></font><font color="#FF00FF">JE    @@continue      </font><font color="#008000"><i>{ no, continue }
  </i></font><font color="#FF00FF">SHL   AL,01H          </font><font color="#008000"><i>{ multiply by 2 *more* }
</i></font><font color="#FF00FF">@@continue:             </font><font color="#008000"><i>{ AL = chars per line }
  { calculate }
  </i></font><font color="#FF00FF">XOR   AH,AH           </font><font color="#008000"><i>{ clear upper AX }
  </i></font><font color="#FF00FF">MOV   BX,AX           </font><font color="#008000"><i>{ get chars per line in BX }
  </i></font><font color="#FF00FF">XOR   DX,DX           </font><font color="#008000"><i>{ DX:AX gets ready for div }
  </i></font><font color="#FF00FF">MOV   AX,CX           </font><font color="#008000"><i>{ get cursor offset }
  </i></font><font color="#FF00FF">DIV   BX              </font><font color="#008000"><i>{ div DX = remainder, AX = answer }
                        { returns AL }
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>end</b></font><font color="#000080">.</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to CURSOR SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0032.PAS">Original</a><b>]</b></p></body>
</html>
