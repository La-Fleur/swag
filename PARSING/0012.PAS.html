<html>
<head><title> "Infix to Postfix expression parser #2" by HARRY MARX</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to PARSING SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0012.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
&gt;      Is there a standard of &quot;best&quot; algorithm used to convert algebraic format
&gt; statements, such as a Pascal assignment statement, to a postfix format, such
&gt; as usually used inside the compiler in preparation to generating machine
&gt; language object file?

&gt;      Or, to put it another way, what is the best know way to convert
&gt;           X := 4*(Lastval + Curval)/3.0;
&gt;      to
&gt;           Lastval, Curval + 4 * 3.0 /
&gt;       ?
&gt;                                        Joel Lichtenwalner


I don't know about the best or standard, but I recently wrote a procedure
that does this without using any recursion or stacks. OK, it uses a few
array's to hold few WORD's.

What's nice about it is that it allows for only 4 temperary values to be
stored, which can be expanded to mean AX,BX,CX and DX. (You can increase this
to whatever you want) What's even nicer is that I have not been able to
write an infix expression complex enough to use more than 2 of the 4
temperary variables! It's very short, so I added it to the message (you may
flame me with your newest gem ... :)
{-----------------------------------------------------------------------}

</i></font><font color="#FF0000"><b>const

   </b></font>OpChars <font color="#000080">= [</font><font color="#800000">'+'</font><font color="#000080">,</font><font color="#800000">'-'</font><font color="#000080">,</font><font color="#800000">'/'</font><font color="#000080">,</font><font color="#800000">'*'</font><font color="#000080">]; </font><font color="#008000"><i>{These two sets must be mutually exclusive}

   </i></font>SymbolChars<font color="#000080">=[</font><font color="#800000">'a'</font><font color="#000080">..</font><font color="#800000">'z'</font><font color="#000080">,</font><font color="#800000">'A'</font><font color="#000080">..</font><font color="#800000">'Z'</font><font color="#000080">,</font><font color="#800000">'0'</font><font color="#000080">..</font><font color="#800000">'9'</font><font color="#000080">,</font><font color="#800000">'.'</font><font color="#000080">,</font><font color="#800000">'_'</font><font color="#000080">];



</font><font color="#FF0000"><b>const

   </b></font>TempVars<font color="#000080">:</font><font color="#FF0000"><b>string</b></font><font color="#000080">=</font><font color="#800000">'adcb'</font><font color="#000080">;</font><font color="#008000"><i>{The 4 temporary variables (or registers)}

</i></font><font color="#FF0000"><b>function </b></font>GetTempResult<font color="#000080">(</font>s<font color="#000080">:</font><font color="#FF0000"><b>string</b></font><font color="#000080">):</font>char<font color="#000080">;
</font><font color="#008000"><i>{Returns the best place to store the temporary result}
   </i></font><font color="#FF0000"><b>var </b></font>n<font color="#000080">,</font>c<font color="#000080">:</font>integer<font color="#000080">; </font>p<font color="#000080">:</font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">5</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">;
   </font><font color="#FF0000"><b>begin
      </b></font>c<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
      </font><font color="#FF0000"><b>for </b></font>n<font color="#000080">:=</font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>length<font color="#000080">(</font>s<font color="#000080">) </font><font color="#FF0000"><b>do if </b></font>s<font color="#000080">[</font>n<font color="#000080">] </font><font color="#FF0000"><b>in </b></font><font color="#000080">[</font><font color="#800000">'a'</font><font color="#000080">..</font><font color="#800000">'d'</font><font color="#000080">] </font><font color="#FF0000"><b>then begin
         </b></font>inc<font color="#000080">(</font>c<font color="#000080">);
         </font>p<font color="#000080">[</font>c<font color="#000080">]:=</font>n<font color="#000080">;
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>case </b></font>c <font color="#FF0000"><b>of
         </b></font><font color="#800000">0</font><font color="#000080">:</font><font color="#FF0000"><b>begin
            </b></font>GetTempResult<font color="#000080">:=</font>TempVars<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">];
            </font>delete<font color="#000080">(</font>TempVars<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">1</font><font color="#000080">);
         </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
         </font><font color="#800000">1</font><font color="#000080">:</font>GetTempResult<font color="#000080">:=</font>s<font color="#000080">[</font>p<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">]];
         </font><font color="#FF0000"><b>else begin
            for </b></font>n<font color="#000080">:=</font><font color="#800000">2 </font><font color="#FF0000"><b>to </b></font>c <font color="#FF0000"><b>do </b></font>TempVars<font color="#000080">:=</font>s<font color="#000080">[</font>p<font color="#000080">[</font>n<font color="#000080">]]+</font>TempVars<font color="#000080">;
            </font>GetTempResult<font color="#000080">:=</font>s<font color="#000080">[</font>p<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">]];
         </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
   </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>Priority<font color="#000080">(</font>s<font color="#000080">:</font><font color="#FF0000"><b>string</b></font><font color="#000080">):</font>byte<font color="#000080">;
</font><font color="#008000"><i>{Returns the oprator's priority}
   </i></font><font color="#FF0000"><b>begin
      if </b></font>length<font color="#000080">(</font>s<font color="#000080">)=</font><font color="#800000">1 </font><font color="#FF0000"><b>then
         case </b></font>s<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">] </font><font color="#FF0000"><b>of
            </b></font><font color="#800000">'+'</font><font color="#000080">,</font><font color="#800000">'-'</font><font color="#000080">:</font>Priority<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
            </font><font color="#800000">'*'</font><font color="#000080">,</font><font color="#800000">'/'</font><font color="#000080">:</font>Priority<font color="#000080">:=</font><font color="#800000">1</font><font color="#000080">;
         </font><font color="#FF0000"><b>end
      else</b></font><font color="#000080">;
   </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>Error<font color="#000080">(</font>S<font color="#000080">:</font><font color="#FF0000"><b>string</b></font><font color="#000080">);
</font><font color="#008000"><i>{Reports an error}
   </i></font><font color="#FF0000"><b>begin
      </b></font>writeln<font color="#000080">(</font><font color="#800000">';***Error***: '</font><font color="#000080">,</font>S<font color="#000080">);
      </font>Halt<font color="#000080">;
   </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>PostFix<font color="#000080">(</font>InFix<font color="#000080">:</font><font color="#FF0000"><b>string</b></font><font color="#000080">):</font><font color="#FF0000"><b>string</b></font><font color="#000080">;
   </font><font color="#FF0000"><b>var
      </b></font>Ops<font color="#000080">:</font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">255</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">;</font><font color="#008000"><i>{Allows only &lt;=255 operators in one...}
      </i></font>Pri<font color="#000080">:</font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">255</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>word<font color="#000080">;</font><font color="#008000"><i>{...expression}
      </i></font>OC<font color="#000080">,</font>n<font color="#000080">,</font>L<font color="#000080">,</font>R<font color="#000080">,</font>Shell<font color="#000080">,</font>MaxOp<font color="#000080">:</font>integer<font color="#000080">;
      </font>LS<font color="#000080">,</font>Op<font color="#000080">,</font>RS<font color="#000080">:</font><font color="#FF0000"><b>string</b></font><font color="#000080">;
   </font><font color="#FF0000"><b>begin
      </b></font>OC<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
      </font>Shell<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
      </font>MaxOp<font color="#000080">:=</font><font color="#800000">1</font><font color="#000080">;
      </font>n<font color="#000080">:=</font><font color="#800000">1</font><font color="#000080">;
      </font><font color="#FF0000"><b>while </b></font>n<font color="#000080">&lt;=</font>length<font color="#000080">(</font>InFix<font color="#000080">) </font><font color="#FF0000"><b>do begin
         if </b></font>Infix<font color="#000080">[</font>n<font color="#000080">] </font><font color="#FF0000"><b>in </b></font>OpChars <font color="#FF0000"><b>then begin
            </b></font>R<font color="#000080">:=</font>n<font color="#000080">;
            </font><font color="#FF0000"><b>while </b></font><font color="#000080">(</font>R<font color="#000080">&lt;</font>length<font color="#000080">(</font>InFix<font color="#000080">)) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>InFix<font color="#000080">[</font>R<font color="#000080">] </font><font color="#FF0000"><b>in </b></font>OpChars<font color="#000080">) </font><font color="#FF0000"><b>do </b></font>inc<font color="#000080">(</font>R<font color="#000080">);
            </font>Op<font color="#000080">:=</font>copy<font color="#000080">(</font>InFix<font color="#000080">,</font>n<font color="#000080">,</font>R<font color="#000080">-</font>n<font color="#000080">);
            </font>inc<font color="#000080">(</font>OC<font color="#000080">);
            </font>Ops<font color="#000080">[</font>OC<font color="#000080">]:=</font>n<font color="#000080">;
            </font>Pri<font color="#000080">[</font>OC<font color="#000080">]:=</font>Priority<font color="#000080">(</font>Op<font color="#000080">)+</font>Shell<font color="#000080">;
            </font><font color="#FF0000"><b>if </b></font>Pri<font color="#000080">[</font>OC<font color="#000080">]&gt;=</font>Pri<font color="#000080">[</font>MaxOp<font color="#000080">] </font><font color="#FF0000"><b>then </b></font>MaxOp<font color="#000080">:=</font>OC<font color="#000080">;
            </font>n<font color="#000080">:=</font>R<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">;
         </font><font color="#FF0000"><b>end else
         case </b></font>InFix<font color="#000080">[</font>n<font color="#000080">] </font><font color="#FF0000"><b>of
            </b></font><font color="#800000">'('</font><font color="#000080">:</font>inc<font color="#000080">(</font>Shell<font color="#000080">,</font><font color="#800000">100</font><font color="#000080">);</font><font color="#008000"><i>{Allows for 100 levels of priorities...}
            </i></font><font color="#800000">')'</font><font color="#000080">:</font>dec<font color="#000080">(</font>Shell<font color="#000080">,</font><font color="#800000">100</font><font color="#000080">);</font><font color="#008000"><i>{...for operators}
         </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;
         </font>inc<font color="#000080">(</font>n<font color="#000080">);
       </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
       </font><font color="#FF0000"><b>if </b></font>Shell<font color="#000080">&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>Error<font color="#000080">(</font><font color="#800000">'Too few &quot;)&quot;.'</font><font color="#000080">);</font><font color="#008000"><i>{Although I report this errors...}
       </i></font><font color="#FF0000"><b>if </b></font>Shell<font color="#000080">&lt;</font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>Error<font color="#000080">(</font><font color="#800000">'Too few &quot;(&quot;.'</font><font color="#000080">);</font><font color="#008000"><i>{... the procedure still works...}
                                             {...if you don't}
       </i></font><font color="#FF0000"><b>while </b></font>OC<font color="#000080">&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>do begin
          </b></font>n<font color="#000080">:=</font>Ops<font color="#000080">[</font>MaxOp<font color="#000080">]-</font><font color="#800000">1</font><font color="#000080">;  </font><font color="#008000"><i>{Read Left Parameter}
          </i></font><font color="#FF0000"><b>while </b></font><font color="#000080">(</font>n<font color="#000080">&gt;</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>and not</b></font><font color="#000080">(</font>InFix<font color="#000080">[</font>n<font color="#000080">] </font><font color="#FF0000"><b>in </b></font>SymbolChars<font color="#000080">) </font><font color="#FF0000"><b>do </b></font>dec<font color="#000080">(</font>n<font color="#000080">);
          </font>L<font color="#000080">:=</font>n<font color="#000080">;
          </font><font color="#FF0000"><b>while </b></font><font color="#000080">(</font>L<font color="#000080">&gt;</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>InFix<font color="#000080">[</font>L<font color="#000080">] </font><font color="#FF0000"><b>in </b></font>SymbolChars<font color="#000080">) </font><font color="#FF0000"><b>do </b></font>dec<font color="#000080">(</font>L<font color="#000080">);
          </font>LS<font color="#000080">:=</font>copy<font color="#000080">(</font>InFix<font color="#000080">,</font>L<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">,</font>n<font color="#000080">-</font>L<font color="#000080">);

          </font>n<font color="#000080">:=</font>Ops<font color="#000080">[</font>MaxOp<font color="#000080">]+</font><font color="#800000">1</font><font color="#000080">; </font><font color="#008000"><i>{Read Right Paramter}
          </i></font><font color="#FF0000"><b>while </b></font><font color="#000080">(</font>n<font color="#000080">&lt;=</font>length<font color="#000080">(</font>InFix<font color="#000080">)) </font><font color="#FF0000"><b>and not</b></font><font color="#000080">(</font>InFix<font color="#000080">[</font>n<font color="#000080">] </font><font color="#FF0000"><b>in </b></font>SymbolChars<font color="#000080">) </font><font color="#FF0000"><b>do </b></font>inc<font color="#000080">(</font>n<font color="#000080">);
          </font>R<font color="#000080">:=</font>n<font color="#000080">;
          </font><font color="#FF0000"><b>while </b></font><font color="#000080">(</font>R<font color="#000080">&lt;=</font>length<font color="#000080">(</font>InFix<font color="#000080">)) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>InFix<font color="#000080">[</font>R<font color="#000080">] </font><font color="#FF0000"><b>in </b></font>SymbolChars<font color="#000080">) </font><font color="#FF0000"><b>do </b></font>inc<font color="#000080">(</font>R<font color="#000080">);
          </font>RS<font color="#000080">:=</font>copy<font color="#000080">(</font>InFix<font color="#000080">,</font>n<font color="#000080">,</font>R<font color="#000080">-</font>n<font color="#000080">);
          </font><font color="#008000"><i>{PS. Only allows for 2 parameter ops.}

          </i></font>Op<font color="#000080">:=</font>GetTempResult<font color="#000080">(</font>LS<font color="#000080">+</font>RS<font color="#000080">);
          </font>writeln<font color="#000080">(</font>LS<font color="#000080">,</font>RS<font color="#000080">,</font>InFix<font color="#000080">[</font>Ops<font color="#000080">[</font>MaxOp<font color="#000080">]],</font><font color="#800000">' -&gt; '</font><font color="#000080">,</font>Op<font color="#000080">);

          </font>InFix<font color="#000080">[</font>L<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">]:=</font>Op<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">]; </font>InFix<font color="#000080">[</font>L<font color="#000080">+</font><font color="#800000">2</font><font color="#000080">]:=</font><font color="#800000">' '</font><font color="#000080">;
          </font>InFix<font color="#000080">[</font>R<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">]:=</font>Op<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">]; </font>InFix<font color="#000080">[</font>R<font color="#000080">-</font><font color="#800000">2</font><font color="#000080">]:=</font><font color="#800000">' '</font><font color="#000080">;

          </font>dec<font color="#000080">(</font>OC<font color="#000080">);
          </font><font color="#FF0000"><b>for </b></font>n<font color="#000080">:=</font>MaxOp <font color="#FF0000"><b>to </b></font>OC <font color="#FF0000"><b>do begin
             </b></font>Pri<font color="#000080">[</font>n<font color="#000080">]:=</font>Pri<font color="#000080">[</font>n<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">];
             </font>Ops<font color="#000080">[</font>n<font color="#000080">]:=</font>Ops<font color="#000080">[</font>n<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">];
          </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
          </font><font color="#FF0000"><b>if </b></font>MaxOp<font color="#000080">&gt;</font>OC <font color="#FF0000"><b>then </b></font>dec<font color="#000080">(</font>MaxOp<font color="#000080">);
          </font><font color="#FF0000"><b>while </b></font><font color="#000080">(</font>MaxOp<font color="#000080">&gt;</font><font color="#800000">1</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>Pri<font color="#000080">[</font>MaxOp<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">]&gt;</font>Pri<font color="#000080">[</font>MaxOp<font color="#000080">]) </font><font color="#FF0000"><b>do </b></font>dec<font color="#000080">(</font>MaxOp<font color="#000080">);
       </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
       </font>PostFix<font color="#000080">:=</font>Op<font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;


 </font><font color="#FF0000"><b>var </b></font>Infix<font color="#000080">:</font><font color="#FF0000"><b>string</b></font><font color="#000080">;
 </font><font color="#FF0000"><b>begin
    </b></font>Infix<font color="#000080">:=</font><font color="#800000">'(A+B)+(B/B+A*(C-D)+(E-F*G+H))'</font><font color="#000080">;
    </font>writeln<font color="#000080">(</font>InFix<font color="#000080">);
    </font>writeln<font color="#000080">(</font>PostFix<font color="#000080">(</font>InFix<font color="#000080">));
    </font>readln<font color="#000080">;
 </font><font color="#FF0000"><b>end</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to PARSING SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0012.PAS">Original</a><b>]</b></p></body>
</html>
