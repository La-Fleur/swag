<html>
<head><title> "Data Dictionary using a BTree" by UNKNOWN</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to PARSING SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0010.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#FF0000"><b>program </b></font>Dict<font color="#000080">;
</font><font color="#008000"><i>(* simple dictionary using a btree.
  The program reads in an ASCII file with one word per line and stores the
  words in an btree. A btree is something like binary tree but every node
  can have more than two descent nodes. This is done by linked list.

  This method has two advantages:
    * when a word is wrong you can easily give some proposes how the word
      is written correctly (just change the path in the tree a little)
    * bigger dict. may save space. E.g &quot;base, basicly, basement&quot; etc.
      share the same path on the first three niveaus.

  ATTENTION! I don't free any mem I've allocated. This is done by the
  heap manager (i.e. he allocates large blockes and releases them } when
  the program ends. But this can be added easily.

  Also, there is no function included that deletes words (I don't need it in
  my project). I suggest it is not that easy to add such a function but
  have a try ;-))

*)

{ $DEFINE DEBUG} { if DEBUG is defined (just erase space between &quot;{&quot; and &quot;$&quot;)
                   then some actions are logged while building the tree and
                   while searching. }

</i></font><font color="#FF0000"><b>const </b></font>debugfile <font color="#000080">= </font><font color="#800000">'dict.log'</font><font color="#000080">;     </font><font color="#008000"><i>{ log file (if needed) }
      </i></font>dictFileName <font color="#000080">= </font><font color="#800000">'dict.dat'</font><font color="#000080">;  </font><font color="#008000"><i>{ data input (words in ASCII) }

</i></font><font color="#FF0000"><b>type  </b></font>PNode     <font color="#000080">= ^</font>TNode<font color="#000080">;
      </font>TNode     <font color="#000080">= </font><font color="#FF0000"><b>record
                    </b></font>Character <font color="#000080">: </font>Char<font color="#000080">;    </font><font color="#008000"><i>{ the current character }
                    </i></font>WordEnd   <font color="#000080">: </font>Boolean<font color="#000080">; </font><font color="#008000"><i>{ is this char. the last of one word?}
                    </i></font>right<font color="#000080">,</font>down<font color="#000080">: </font>PNode<font color="#000080">;   </font><font color="#008000"><i>{ right: points to next char on the
                                                  same niveau
                                           down : points to the next char in
                                                  word }
{$IFDEF DEBUG}
                    </i></font>Level     <font color="#000080">: </font>byte<font color="#000080">;    </font><font color="#008000"><i>{ level of the tree }
{$ENDIF }
                  </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>var </b></font>BTree<font color="#000080">: </font>PNode<font color="#000080">;                       </font><font color="#008000"><i>{ our tree }
    </i></font>DictFile<font color="#000080">: </font>Text<font color="#000080">;                     </font><font color="#008000"><i>{ our ascii dictionary }
{$IFDEF DEBUG}
</i></font><font color="#FF0000"><b>var </b></font>f<font color="#000080">: </font>Text<font color="#000080">;                            </font><font color="#008000"><i>{ log file handle }
{$ENDIF }


</i></font><font color="#FF0000"><b>procedure </b></font>CreateBTree<font color="#000080">;
</font><font color="#008000"><i>{ just initalizes the tree w/ a dummy element }
</i></font><font color="#FF0000"><b>begin
  </b></font>Btree<font color="#000080">:=</font><font color="#FF0000"><b>NIL</b></font><font color="#000080">;
  </font>New<font color="#000080">(</font>Btree<font color="#000080">);
  </font>BTree<font color="#000080">^.</font>character<font color="#000080">:=</font><font color="#800000">#$1A</font><font color="#000080">; </font><font color="#008000"><i>{ #$1A is END-OF-FILE. shouldn't be used in any word }
  </i></font>BTree<font color="#000080">^.</font>right<font color="#000080">:=</font><font color="#FF0000"><b>NIL</b></font><font color="#000080">;
  </font>Btree<font color="#000080">^.</font>down<font color="#000080">:=</font><font color="#FF0000"><b>NIL</b></font><font color="#000080">;
  </font>BTree<font color="#000080">^.</font>Wordend<font color="#000080">:=</font>true<font color="#000080">;
</font><font color="#008000"><i>{$IFDEF DEBUG}
  </i></font>BTree<font color="#000080">^.</font>level<font color="#000080">:=</font><font color="#800000">1</font><font color="#000080">;
  </font>writeln<font color="#000080">(</font>f<font color="#000080">,</font><font color="#800000">'B-Tree with dummy element created.'</font><font color="#000080">);
</font><font color="#008000"><i>{$ENDIF }
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{$IFDEF DEBUG}
</i></font><font color="#FF0000"><b>function </b></font>GetNode<font color="#000080">(</font>Character<font color="#000080">: </font>Char<font color="#000080">; </font>LevelPtr<font color="#000080">: </font>PNode<font color="#000080">; </font>Level<font color="#000080">: </font>byte<font color="#000080">): </font>PNode<font color="#000080">;
</font><font color="#008000"><i>{$ELSE }
</i></font><font color="#FF0000"><b>function </b></font>GetNode<font color="#000080">(</font>Character<font color="#000080">: </font>Char<font color="#000080">; </font>LevelPtr<font color="#000080">: </font>PNode<font color="#000080">): </font>PNode<font color="#000080">;
</font><font color="#008000"><i>{$ENDIF }
{ returns the node in Level &quot;LevelPtr&quot; that contains &quot;Character&quot;.
  if there is no node, it is created }
</i></font><font color="#FF0000"><b>var </b></font>p<font color="#000080">: </font>PNode<font color="#000080">;
</font><font color="#FF0000"><b>begin
  if </b></font>levelptr<font color="#000080">=</font><font color="#FF0000"><b>NIL then begin
    </b></font>New<font color="#000080">(</font>P<font color="#000080">);
    </font>P<font color="#000080">^.</font>right<font color="#000080">:=</font><font color="#FF0000"><b>NIL</b></font><font color="#000080">;
    </font>P<font color="#000080">^.</font>down<font color="#000080">:=</font><font color="#FF0000"><b>NIL</b></font><font color="#000080">;
    </font>P<font color="#000080">^.</font>character<font color="#000080">:=</font>character<font color="#000080">;
    </font>P<font color="#000080">^.</font>WordEnd<font color="#000080">:=</font>False<font color="#000080">;
</font><font color="#008000"><i>{$IFDEF DEBUG}
    </i></font>P<font color="#000080">^.</font>Level<font color="#000080">:=</font>Level<font color="#000080">;
    </font>writeln<font color="#000080">(</font>f<font color="#000080">,</font><font color="#800000">'#New niveau-node enterd. Content of the first node: '</font><font color="#000080">+
            </font><font color="#800000">' &quot;'</font><font color="#000080">,</font>character<font color="#000080">,</font><font color="#800000">'&quot;. Level '</font><font color="#000080">,</font>level<font color="#000080">);
</font><font color="#008000"><i>{$ENDIF }
    </i></font>GetNode<font color="#000080">:=</font>p<font color="#000080">;
  </font><font color="#FF0000"><b>end else begin
    </b></font>p<font color="#000080">:=</font>levelptr<font color="#000080">;
    </font><font color="#FF0000"><b>while </b></font><font color="#000080">(</font>p<font color="#000080">^.</font>right<font color="#000080">&lt;&gt;</font><font color="#FF0000"><b>NIL</b></font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>p<font color="#000080">^.</font>character<font color="#000080">&lt;&gt;</font>Character<font color="#000080">) </font><font color="#FF0000"><b>do </b></font>p<font color="#000080">:=</font>p<font color="#000080">^.</font>right<font color="#000080">;
    </font><font color="#FF0000"><b>if </b></font>p<font color="#000080">^.</font>character<font color="#000080">=</font>character <font color="#FF0000"><b>then
    begin
      </b></font>getnode<font color="#000080">:=</font>p<font color="#000080">;
</font><font color="#008000"><i>{$IFDEF DEBUG}
      </i></font>writeln<font color="#000080">(</font>f<font color="#000080">,</font><font color="#800000">'Node &quot;'</font><font color="#000080">,</font>character<font color="#000080">,</font><font color="#800000">'&quot; found on level '</font><font color="#000080">,</font>level<font color="#000080">,</font><font color="#800000">'.'</font><font color="#000080">);
</font><font color="#008000"><i>{$ENDIF }
    </i></font><font color="#FF0000"><b>end
      else begin
        </b></font><font color="#008000"><i>{ p^.right is NIL! }
        </i></font>new<font color="#000080">(</font>p<font color="#000080">^.</font>right<font color="#000080">);
        </font>p<font color="#000080">:=</font>p<font color="#000080">^.</font>right<font color="#000080">;
        </font>p<font color="#000080">^.</font>character<font color="#000080">:=</font>character<font color="#000080">;
        </font>p<font color="#000080">^.</font>right<font color="#000080">:=</font><font color="#FF0000"><b>NIL</b></font><font color="#000080">;
        </font>p<font color="#000080">^.</font>down<font color="#000080">:=</font><font color="#FF0000"><b>nil</b></font><font color="#000080">;
        </font>p<font color="#000080">^.</font>wordend<font color="#000080">:=</font>false<font color="#000080">;
</font><font color="#008000"><i>{$IFDEF DEBUG}
        </i></font>p<font color="#000080">^.</font>level<font color="#000080">:=</font>level<font color="#000080">;
        </font>writeln<font color="#000080">(</font>f<font color="#000080">,</font><font color="#800000">'#Entered new node. Content &quot;'</font><font color="#000080">,</font>character<font color="#000080">,</font><font color="#800000">'&quot;. Level '</font><font color="#000080">,</font>level<font color="#000080">);
</font><font color="#008000"><i>{$ENDIF }
        </i></font>GetNode<font color="#000080">:=</font>p<font color="#000080">;
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{if}
  </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{ if }
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>InsertWord<font color="#000080">(</font>wort<font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">);
</font><font color="#008000"><i>{ inserts the word &quot;wort&quot; into btree }
</i></font><font color="#FF0000"><b>var </b></font>p1<font color="#000080">,</font>p2<font color="#000080">,</font>p3<font color="#000080">: </font>PNode<font color="#000080">;
    </font>i<font color="#000080">: </font>byte<font color="#000080">;
</font><font color="#FF0000"><b>begin
  if </b></font>wort<font color="#000080">=</font><font color="#800000">'' </font><font color="#FF0000"><b>then </b></font>exit<font color="#000080">;
  </font>p2<font color="#000080">:=</font>btree<font color="#000080">;
  </font><font color="#FF0000"><b>for </b></font>i<font color="#000080">:=</font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>length<font color="#000080">(</font>wort<font color="#000080">) </font><font color="#FF0000"><b>do
  begin
</b></font><font color="#008000"><i>{$IFDEF DEBUG}
    </i></font>p1<font color="#000080">:=</font>getnode<font color="#000080">(</font>wort<font color="#000080">[</font>i<font color="#000080">],</font>p2<font color="#000080">,</font>i<font color="#000080">);
</font><font color="#008000"><i>{$ELSE}
    </i></font>p1<font color="#000080">:=</font>getnode<font color="#000080">(</font>wort<font color="#000080">[</font>i<font color="#000080">],</font>p2<font color="#000080">);
</font><font color="#008000"><i>{$ENDIF}
    </i></font><font color="#FF0000"><b>if </b></font>p2<font color="#000080">=</font><font color="#FF0000"><b>NIL then </b></font>p3<font color="#000080">^.</font>down<font color="#000080">:=</font>p1<font color="#000080">;
    </font>p3<font color="#000080">:=</font>p1<font color="#000080">;
    </font>p2<font color="#000080">:=</font>p1<font color="#000080">^.</font>down<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>p1<font color="#000080">^.</font>wordend<font color="#000080">:=</font>true<font color="#000080">;
</font><font color="#008000"><i>{$IFDEF DEBUG}
  </i></font>writeln<font color="#000080">(</font>f<font color="#000080">,</font><font color="#800000">'Wort &quot;'</font><font color="#000080">,</font>wort<font color="#000080">,</font><font color="#800000">'&quot; eingetragen.'</font><font color="#000080">);
</font><font color="#008000"><i>{$ENDIF }
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>ProofWord<font color="#000080">(</font>Wort<font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">): </font>boolean<font color="#000080">;
</font><font color="#008000"><i>{ returns true if &quot;wort&quot; is in our dictionary }
</i></font><font color="#FF0000"><b>var </b></font>P1<font color="#000080">,</font>p2<font color="#000080">: </font>PNode<font color="#000080">;
    </font>I<font color="#000080">: </font>Byte<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>ProofWord<font color="#000080">:=</font>FALSE<font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font>wort<font color="#000080">=</font><font color="#800000">'' </font><font color="#FF0000"><b>then </b></font>exit<font color="#000080">;
  </font>p1<font color="#000080">:=</font>BTree<font color="#000080">;
  </font>i<font color="#000080">:=</font><font color="#800000">1</font><font color="#000080">;
</font><font color="#008000"><i>{$IFDEF DEBUG}
  </i></font>writeln<font color="#000080">(</font>f<font color="#000080">,</font><font color="#800000">'Searching for word &quot;'</font><font color="#000080">,</font>wort<font color="#000080">,</font><font color="#800000">'&quot;.'</font><font color="#000080">);
</font><font color="#008000"><i>{$ENDIF }
  </i></font><font color="#FF0000"><b>while </b></font><font color="#000080">(</font>p1<font color="#000080">&lt;&gt;</font><font color="#FF0000"><b>NIL</b></font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>length<font color="#000080">(</font>wort<font color="#000080">)&gt;=</font>i<font color="#000080">) </font><font color="#FF0000"><b>do begin
    while </b></font><font color="#000080">(</font>p1<font color="#000080">^.</font>right<font color="#000080">&lt;&gt;</font><font color="#FF0000"><b>NIL</b></font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>p1<font color="#000080">^.</font>character<font color="#000080">&lt;&gt;</font>wort<font color="#000080">[</font>i<font color="#000080">]) </font><font color="#FF0000"><b>do </b></font>p1<font color="#000080">:=</font>p1<font color="#000080">^.</font>right<font color="#000080">;
    </font><font color="#FF0000"><b>if </b></font>p1<font color="#000080">^.</font>character<font color="#000080">=</font>wort<font color="#000080">[</font>i<font color="#000080">] </font><font color="#FF0000"><b>then begin
      </b></font>inc<font color="#000080">(</font>i<font color="#000080">);
      </font>p2<font color="#000080">:=</font>p1<font color="#000080">;
      </font>p1<font color="#000080">:=</font>p1<font color="#000080">^.</font>down<font color="#000080">;
</font><font color="#008000"><i>{$IFDEF DEBUG}
      </i></font>writeln<font color="#000080">(</font>f<font color="#000080">,</font><font color="#800000">'Character &quot;'</font><font color="#000080">,</font>wort<font color="#000080">[</font>i<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">],</font><font color="#800000">'&quot; found on level '</font><font color="#000080">,</font>i<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">'.'</font><font color="#000080">);
</font><font color="#008000"><i>{$ENDIF }
    </i></font><font color="#FF0000"><b>end else </b></font>p1<font color="#000080">:=</font><font color="#FF0000"><b>NIL</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>i<font color="#000080">=</font>length<font color="#000080">(</font>wort<font color="#000080">)+</font><font color="#800000">1</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>p2<font color="#000080">^.</font>wordend<font color="#000080">) </font><font color="#FF0000"><b>then </b></font>proofword<font color="#000080">:=</font>TRUE<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>var </b></font>OldExitProcPtr<font color="#000080">: </font>Pointer<font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>MyExitProc<font color="#000080">;</font><font color="#FF0000"><b>far</b></font><font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>ExitProc<font color="#000080">:=</font>OldExitProcPtr<font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font>exitcode <font color="#000080">= </font><font color="#800000">214 </font><font color="#FF0000"><b>then </b></font>writeln<font color="#000080">(</font><font color="#800000">'Huston! We''ve got a pointer problem!'</font><font color="#000080">);
</font><font color="#008000"><i>{$IFDEF DEBUG}
  </i></font>close<font color="#000080">(</font>f<font color="#000080">);
</font><font color="#008000"><i>{$ENDIF }
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>var </b></font>s<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;

</font><font color="#FF0000"><b>begin
  </b></font>OldExitProcPtr<font color="#000080">:=</font>ExitProc<font color="#000080">;
  </font>ExitProc<font color="#000080">:=@</font>MyExitProc<font color="#000080">;
  </font><font color="#008000"><i>{$IFDEF DEBUG}
  </i></font>assign<font color="#000080">(</font>f<font color="#000080">,</font>debugfile<font color="#000080">);
  </font>rewrite<font color="#000080">(</font>f<font color="#000080">);
  </font><font color="#008000"><i>{$ENDIF }
  </i></font>assign<font color="#000080">(</font>dictfile<font color="#000080">,</font>dictfilename<font color="#000080">);
  </font>createBTree<font color="#000080">;
  </font>reset<font color="#000080">(</font>dictfile<font color="#000080">);
  </font>write<font color="#000080">(</font><font color="#800000">'Reading dictionary...'</font><font color="#000080">);
  </font><font color="#FF0000"><b>while not </b></font>eof<font color="#000080">(</font>dictfile<font color="#000080">) </font><font color="#FF0000"><b>do
  begin
    </b></font>readln<font color="#000080">(</font>dictfile<font color="#000080">,</font>s<font color="#000080">);
    </font>insertword<font color="#000080">(</font>s<font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>writeln<font color="#000080">(</font><font color="#800000">'done.'</font><font color="#000080">);
  </font>writeln<font color="#000080">(</font><font color="#800000">'Request mode. End with &quot;END&quot;!'</font><font color="#000080">);
  </font>s<font color="#000080">:=</font><font color="#800000">''</font><font color="#000080">;
  </font><font color="#FF0000"><b>repeat
    </b></font>write<font color="#000080">(</font><font color="#800000">'OK&gt;'</font><font color="#000080">);
    </font>readln<font color="#000080">(</font>s<font color="#000080">);
    </font><font color="#FF0000"><b>if </b></font>s<font color="#000080">&lt;&gt;</font><font color="#800000">'END' </font><font color="#FF0000"><b>then
      if </b></font>proofword<font color="#000080">(</font>s<font color="#000080">) </font><font color="#FF0000"><b>then </b></font>writeln<font color="#000080">(</font><font color="#800000">'Word found!'</font><font color="#000080">,</font><font color="#800000">#7</font><font color="#000080">)
                      </font><font color="#FF0000"><b>else </b></font>writeln<font color="#000080">(</font><font color="#800000">'Word not fond!'</font><font color="#000080">);

  </font><font color="#FF0000"><b>until </b></font>s<font color="#000080">=</font><font color="#800000">'END'</font><font color="#000080">;
  </font><font color="#008000"><i>{$IFDEF DEBUG}
  </i></font>close<font color="#000080">(</font>f<font color="#000080">);
  </font><font color="#008000"><i>{$ENDIF }
  </i></font>ExitProc<font color="#000080">:=</font>OldExitProcPtr<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">.=====================</font>Code ends<font color="#000080">===============================
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to PARSING SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0010.PAS">Original</a><b>]</b></p></body>
</html>
