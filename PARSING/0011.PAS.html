<html>
<head><title> "Infix to Postfix expression parser" by CLIF PENN</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to PARSING SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0011.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
I am trying to write an algorithm(in pseudocode or Pascal)  that
converts a nonparenthesized infix expression to the equivalent postfix
expression.

For example, the infix expression

3 - 6 * 7 + 2 / 4 * 5 - 8

converts to the postfix expression
------ message termination by server was premature----

but postfix notation would be:  3 6 7 * - 2 4 / + 5 * 8 -

In the program that follows, the input is a character string which is
then converted to a linked list. If numeric values are desired, the
VAL function can be used at the time the list is made.

The advantage of the linked list approach is the ease with which the
order of the terms may be rearranged. The disadvantage is the &quot;write
only&quot; looking code that results--very un-Pascal like. Hopefully, the
comments make it clearer.

The conversion of infix to postfix notation follows these rules:

1. Multiplication and division take precedence over addition and
subtraction.

2. Where operations are of equal precedence, they are performed in
sequential order from left to right.

The algorithm uses two linked lists. One is a queue, or FIFO, type
list. Each node of this list is linked to the next and each node
stores a &quot;word&quot; from the original math string in the same order as
written. The other op linked list is a short list of one or two nodes
which stores the math operations in order of their postfix execution.
In both these lists, the last node points to nil. The math list is
parsed from the front. Each operation is placed in the op list and
removed from the longer list. The longer list is relinked and the op
list is inserted in the proper position for postfix notation.

&lt;clifpenn@airmail.net&gt;   11:12PM  3/1/96
--------------------------- }

</i></font><font color="#FF0000"><b>Program </b></font>InFixToPostFix<font color="#000080">;
</font><font color="#008000"><i>{ Written in Turbo Pascal v6.0 by Clif Penn, Mar 1, 1996  }

</i></font><font color="#FF0000"><b>Uses </b></font>CRT<font color="#000080">;
</font><font color="#FF0000"><b>Label </b></font>finis<font color="#000080">;

</font><font color="#FF0000"><b>TYPE   </b></font>link <font color="#000080">= ^</font>node<font color="#000080">;   </font><font color="#008000"><i>{ link is a pointer to a node }
       </i></font>node <font color="#000080">= </font><font color="#FF0000"><b>record
            </b></font>nxt<font color="#000080">:</font>link<font color="#000080">;  </font><font color="#008000"><i>{ points to next node (or nil) }
            </i></font>dat<font color="#000080">:</font><font color="#FF0000"><b>string</b></font><font color="#000080">[</font><font color="#800000">12</font><font color="#000080">];   </font><font color="#008000"><i>{length of 12 is arbitrary}
       </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>VAR
</b></font>head<font color="#000080">, </font>p1<font color="#000080">, </font>p2<font color="#000080">, </font>op<font color="#000080">:</font>link<font color="#000080">;
</font>s<font color="#000080">, </font>postfix<font color="#000080">:</font><font color="#FF0000"><b>string</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>MakeWrdList<font color="#000080">(</font>ss<font color="#000080">:</font><font color="#FF0000"><b>string</b></font><font color="#000080">);
</font><font color="#FF0000"><b>VAR
</b></font>wrd<font color="#000080">:</font><font color="#FF0000"><b>string</b></font><font color="#000080">[</font><font color="#800000">12</font><font color="#000080">];   </font><font color="#008000"><i>{ 12 is arbitrary }
</i></font>s1<font color="#000080">, </font>s2<font color="#000080">, </font>len<font color="#000080">:</font>integer<font color="#000080">;
</font>pt1<font color="#000080">, </font>pt2<font color="#000080">:</font>link<font color="#000080">;

</font><font color="#FF0000"><b>Begin
     </b></font>pt1 <font color="#000080">:= </font><font color="#FF0000"><b>nil</b></font><font color="#000080">;
     </font>s1 <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;
     </font>len <font color="#000080">:= </font>Length<font color="#000080">(</font>ss<font color="#000080">);

     </font><font color="#FF0000"><b>While </b></font>s1 <font color="#000080">&lt; </font>len <font color="#FF0000"><b>do
     Begin
          </b></font><font color="#008000"><i>{ skip spaces }
          </i></font><font color="#FF0000"><b>While </b></font><font color="#000080">(</font>ss<font color="#000080">[</font>s1<font color="#000080">] = </font><font color="#800000">' '</font><font color="#000080">) </font><font color="#FF0000"><b>AND </b></font><font color="#000080">(</font>s1 <font color="#000080">&lt; </font>len<font color="#000080">) </font><font color="#FF0000"><b>Do </b></font>Inc<font color="#000080">(</font>s1<font color="#000080">);
          </font>s2 <font color="#000080">:= </font>s1<font color="#000080">;   </font><font color="#008000"><i>{start of word}
          { parse to next space }
          </i></font><font color="#FF0000"><b>While </b></font><font color="#000080">(</font>ss<font color="#000080">[</font>s2<font color="#000080">] &lt;&gt; </font><font color="#800000">' '</font><font color="#000080">) </font><font color="#FF0000"><b>AND </b></font><font color="#000080">(</font>s2 <font color="#000080">&lt;= </font>len<font color="#000080">) </font><font color="#FF0000"><b>Do </b></font>Inc<font color="#000080">(</font>s2<font color="#000080">);
          </font>wrd <font color="#000080">:= </font>Copy<font color="#000080">(</font>ss<font color="#000080">, </font>s1<font color="#000080">, </font>s2 <font color="#000080">- </font>s1<font color="#000080">);   </font><font color="#008000"><i>{extract wrd sans spaces}
          </i></font>s1 <font color="#000080">:= </font>s2<font color="#000080">;  </font><font color="#008000"><i>{advance string index}

          </i></font>pt2 <font color="#000080">:= </font>pt1<font color="#000080">;  </font><font color="#008000"><i>{initially pt2 to nil, normally move down list}
          </i></font>new<font color="#000080">(</font>pt1<font color="#000080">) ;   </font><font color="#008000"><i>{get address for pt1 from heap}
          </i></font><font color="#FF0000"><b>if </b></font>pt2 <font color="#000080">= </font><font color="#FF0000"><b>nil then </b></font>head <font color="#000080">:= </font>pt1<font color="#000080">;    </font><font color="#008000"><i>{head--&gt;first node}
          </i></font>pt2<font color="#000080">^.</font>nxt <font color="#000080">:= </font>pt1<font color="#000080">;      </font><font color="#008000"><i>{links old node to new}
          </i></font>pt1<font color="#000080">^.</font>nxt <font color="#000080">:= </font><font color="#FF0000"><b>nil</b></font><font color="#000080">;      </font><font color="#008000"><i>{last node in list points to nil}
          </i></font>pt1<font color="#000080">^.</font>dat <font color="#000080">:= </font>wrd<font color="#000080">;      </font><font color="#008000"><i>{stores wrd in node}
     </i></font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#008000"><i>{ After above:  pt1 and pt2 no longer used
         head--&gt;[arg1]--&gt;[op1]--&gt;[arg2]--&gt;[ .... ]--&gt;nil       }
</i></font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>ShowList<font color="#000080">;
</font><font color="#FF0000"><b>VAR </b></font>tmp<font color="#000080">:</font>link<font color="#000080">;
</font><font color="#FF0000"><b>Begin
     </b></font>tmp <font color="#000080">:= </font>head<font color="#000080">;
     </font>postfix <font color="#000080">:= </font><font color="#800000">''</font><font color="#000080">;
     </font><font color="#FF0000"><b>While </b></font>tmp <font color="#000080">&lt;&gt; </font><font color="#FF0000"><b>nil do
     begin
          </b></font>postfix <font color="#000080">:= </font>postfix <font color="#000080">+ </font>tmp<font color="#000080">^.</font>dat <font color="#000080">+ </font><font color="#800000">' '</font><font color="#000080">;  </font><font color="#008000"><i>{concatanate string}
          </i></font>tmp <font color="#000080">:= </font>tmp<font color="#000080">^.</font>nxt<font color="#000080">;  </font><font color="#008000"><i>{traverse the list head to tail}
     </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;
     </font>Writeln<font color="#000080">(</font>postfix<font color="#000080">);
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>InsertOp<font color="#000080">;
</font><font color="#008000"><i>{Inserts Op node(s) into PostFix linked list}
</i></font><font color="#FF0000"><b>Begin
     </b></font>p1<font color="#000080">^.</font>nxt <font color="#000080">:= </font>op<font color="#000080">;  </font><font color="#008000"><i>{insert op, the last op node points to nil}
     </i></font><font color="#FF0000"><b>While </b></font>p1<font color="#000080">^.</font>nxt <font color="#000080">&lt;&gt; </font><font color="#FF0000"><b>nil do </b></font>p1 <font color="#000080">:= </font>p1<font color="#000080">^.</font>nxt<font color="#000080">;
     </font>p1<font color="#000080">^.</font>nxt <font color="#000080">:= </font>p2<font color="#000080">^.</font>nxt<font color="#000080">;  </font><font color="#008000"><i>{remove p2 node from list}
     </i></font>p1 <font color="#000080">:= </font>p1<font color="#000080">^.</font>nxt<font color="#000080">;  </font><font color="#008000"><i>{last node of prev op now linked to list}
     </i></font>op <font color="#000080">:= </font>p2<font color="#000080">;       </font><font color="#008000"><i>{new op becomes p2}
     </i></font>op<font color="#000080">^.</font>nxt <font color="#000080">:= </font><font color="#FF0000"><b>nil</b></font><font color="#000080">;
     </font>p2 <font color="#000080">:= </font>p1<font color="#000080">;  </font><font color="#008000"><i>{both now point to next argument}
</i></font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>ExtendOp<font color="#000080">;
</font><font color="#008000"><i>{Extracts math symbol node from PostFix list and extends Op list}
</i></font><font color="#FF0000"><b>Begin
     </b></font>p1<font color="#000080">^.</font>nxt <font color="#000080">:= </font>p2<font color="#000080">^.</font>nxt<font color="#000080">;    </font><font color="#008000"><i>{remove p2 from list}
     </i></font>p1 <font color="#000080">:= </font>p1<font color="#000080">^.</font>nxt<font color="#000080">;         </font><font color="#008000"><i>{relink arg--&gt;arg}
     </i></font>p2<font color="#000080">^.</font>nxt <font color="#000080">:= </font>op<font color="#000080">;         </font><font color="#008000"><i>{place p2 in front of old op}
     </i></font>op <font color="#000080">:= </font>p2<font color="#000080">;              </font><font color="#008000"><i>{now op linked list has 2 nodes}
     </i></font>p2 <font color="#000080">:= </font>p1 <font color="#000080">;             </font><font color="#008000"><i>{both now point to next argument}
</i></font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>DoPostFix<font color="#000080">(</font>st<font color="#000080">:</font><font color="#FF0000"><b>string</b></font><font color="#000080">);
</font><font color="#FF0000"><b>Const
</b></font>Hi <font color="#000080">= [</font><font color="#800000">'*'</font><font color="#000080">, </font><font color="#800000">'/'</font><font color="#000080">];   </font><font color="#008000"><i>{Hi, Lo are math precedence rank of symbols}
</i></font>Lo <font color="#000080">= [</font><font color="#800000">'-'</font><font color="#000080">, </font><font color="#800000">'+'</font><font color="#000080">];

</font><font color="#FF0000"><b>Begin
     </b></font>MakeWrdList<font color="#000080">(</font>st<font color="#000080">);
     </font>p1 <font color="#000080">:= </font>head<font color="#000080">;       </font><font color="#008000"><i>{After this initialization, }
     </i></font>op <font color="#000080">:= </font><font color="#FF0000"><b>nil</b></font><font color="#000080">;        </font><font color="#008000"><i>{p1, p2, arg1 --&gt; arg2      }
     </i></font>p2 <font color="#000080">:= </font>p1<font color="#000080">^.</font>nxt<font color="#000080">;    </font><font color="#008000"><i>{op --&gt; op1 --&gt; nil         }
     </i></font>ExtendOp<font color="#000080">;

     </font><font color="#FF0000"><b>While </b></font>p2<font color="#000080">^.</font>nxt <font color="#000080">&lt;&gt; </font><font color="#FF0000"><b>nil Do    </b></font><font color="#008000"><i>{last node points to nil}
     </i></font><font color="#FF0000"><b>Begin
          </b></font>p2 <font color="#000080">:= </font>p2<font color="#000080">^.</font>nxt<font color="#000080">;  </font><font color="#008000"><i>{p2 now pointing to math operation}
          {Conditional char comparisons follow}
          </i></font><font color="#FF0000"><b>If </b></font><font color="#000080">(</font>op<font color="#000080">^.</font>dat<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">] </font><font color="#FF0000"><b>in </b></font>Hi<font color="#000080">) </font><font color="#FF0000"><b>OR </b></font><font color="#000080">(</font>p2<font color="#000080">^.</font>dat<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">] </font><font color="#FF0000"><b>in </b></font>Lo<font color="#000080">) </font><font color="#FF0000"><b>then
                </b></font>InsertOp
          <font color="#FF0000"><b>Else  </b></font>ExtendOp<font color="#000080">;
     </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
     </font>p1<font color="#000080">^.</font>nxt <font color="#000080">:= </font>op<font color="#000080">;  </font><font color="#008000"><i>{links final math operation(s)}
</i></font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>BEGIN  </b></font><font color="#008000"><i>{main program}
     </i></font>ClrScr<font color="#000080">;
     </font>Writeln<font color="#000080">(</font><font color="#800000">'Just press Enter to quit.'</font><font color="#000080">); </font>Writeln<font color="#000080">;
     </font><font color="#008000"><i>{ Example }
     </i></font>s <font color="#000080">:= </font><font color="#800000">'3 - 6 * 7 + 2 / 4 * 5 - 8'</font><font color="#000080">;

     </font>DoPostFix<font color="#000080">(</font>s<font color="#000080">);
     </font>Writeln<font color="#000080">(</font><font color="#800000">'In postfix notation, the infix string:'</font><font color="#000080">);
     </font>Writeln<font color="#000080">(</font>s<font color="#000080">, </font><font color="#800000">' becomes:'</font><font color="#000080">);
     </font>ShowList<font color="#000080">;
</font><font color="#FF0000"><b>Repeat
     </b></font>Writeln<font color="#000080">;
     </font>Writeln<font color="#000080">(</font><font color="#800000">'Infix math string (spaces between everything):'</font><font color="#000080">);
     </font>Readln<font color="#000080">(</font>s<font color="#000080">);
     </font><font color="#FF0000"><b>If </b></font>Length<font color="#000080">(</font>s<font color="#000080">) &lt; </font><font color="#800000">5 </font><font color="#FF0000"><b>then goto </b></font>finis<font color="#000080">;

     </font>DoPostFix<font color="#000080">(</font>s<font color="#000080">);
     </font>ShowList<font color="#000080">;
</font><font color="#FF0000"><b>Until </b></font>Length<font color="#000080">(</font>s<font color="#000080">) &lt; </font><font color="#800000">5</font><font color="#000080">;

</font>finis<font color="#000080">:
</font><font color="#FF0000"><b>END</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to PARSING SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0011.PAS">Original</a><b>]</b></p></body>
</html>
