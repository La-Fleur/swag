<html>
<head><title> "Small CRT Replacement" by TREVOR J. CARLSEN</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to CRT SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0009.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#FF0000"><b>Unit </b></font>sCrt<font color="#000080">;

</font><font color="#008000"><i>{

  by Trevor J Carlsen
     PO Box 568
     Port Hedland
     Western Australia 6721
     Phone -
       Voice: 61 91 732026
       Data : 61 91 732569

   This little Unit is intended to replace the Crt Unit in Programs that do
   not require many of that Units Functions.  As a result the resulting .exe
   code is much smaller.

   Released into the public domain 1989

}

</i></font><font color="#FF0000"><b>Interface

Function </b></font>KeyPressed<font color="#000080">: </font>Boolean<font color="#000080">;
  </font><font color="#008000"><i>{ Returns True if there is a keystroke waiting in the key buffer           }

</i></font><font color="#FF0000"><b>Procedure </b></font>ClrScr<font color="#000080">;
  </font><font color="#008000"><i>{ Clears the screen and homes the cursor                                   }

</i></font><font color="#FF0000"><b>Procedure </b></font>ClrKey<font color="#000080">;
  </font><font color="#008000"><i>{ Flushes the keystroke buffer                                             }

</i></font><font color="#FF0000"><b>Function </b></font>KeyWord <font color="#000080">: </font>Word<font color="#000080">;
    </font><font color="#FF0000"><b>Inline  </b></font><font color="#000080">(</font><font color="#800000">$B4</font><font color="#000080">/</font><font color="#800000">$00</font><font color="#000080">/   </font><font color="#008000"><i>{mov  ah,0}
             </i></font><font color="#800000">$CD</font><font color="#000080">/</font><font color="#800000">$16</font><font color="#000080">);  </font><font color="#008000"><i>{int  16h}
  { Waits For a keypress and returns a Word containing the scancode and      }
  { ascii code For the KeyPressed                                            }

</i></font><font color="#FF0000"><b>Function </b></font>ExtKey<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>k <font color="#000080">: </font>Char<font color="#000080">; </font><font color="#FF0000"><b>Var </b></font>s <font color="#000080">: </font>Byte<font color="#000080">): </font>Boolean<font color="#000080">;
  </font><font color="#008000"><i>{ Gets next keystroke from the keystroke buffer. if it was an Extended key }
  { (ie. Function key etc.) returns True and k contains the scan code. if a  }
  { normal key then returns False and k contains the Character and s the scan}
  { code                                                                     }

</i></font><font color="#FF0000"><b>Function </b></font>ReadKey<font color="#000080">: </font>Char<font color="#000080">;
  </font><font color="#008000"><i>{ Gets next keystroke from the buffer. if Extended key returns #0          }

</i></font><font color="#FF0000"><b>Function </b></font>NextKey<font color="#000080">: </font>Char<font color="#000080">;
  </font><font color="#008000"><i>{ Flushes the keystroke buffer and then returns the next key as ReadKey    }

</i></font><font color="#FF0000"><b>Function </b></font>PeekKey<font color="#000080">: </font>Char<font color="#000080">;
  </font><font color="#008000"><i>{ Peeks at the next keypress in the buffer without removing it             }

</i></font><font color="#FF0000"><b>Procedure </b></font>Delay<font color="#000080">(</font>s <font color="#000080">: </font>Word<font color="#000080">);
  </font><font color="#008000"><i>{ Machine independent Delay loop For s seconds                             }

</i></font><font color="#FF0000"><b>Procedure </b></font>GotoXY<font color="#000080">(</font>x<font color="#000080">,</font>y <font color="#000080">: </font>Byte<font color="#000080">);
  </font><font color="#008000"><i>{ Moves the cursor to X, y coordinates                                     }

{ -------------------------------------------------------------------------- }

</i></font><font color="#FF0000"><b>Implementation

Uses </b></font>Dos<font color="#000080">;

</font><font color="#FF0000"><b>Var
  </b></font>head <font color="#000080">: </font>Word    <font color="#FF0000"><b>Absolute </b></font><font color="#800000">$0040</font><font color="#000080">:</font><font color="#800000">$001A</font><font color="#000080">;
  </font>tail <font color="#000080">: </font>Word    <font color="#FF0000"><b>Absolute </b></font><font color="#800000">$0040</font><font color="#000080">:</font><font color="#800000">$001C</font><font color="#000080">;
  </font>time <font color="#000080">: </font>LongInt <font color="#FF0000"><b>Absolute </b></font><font color="#800000">$0040</font><font color="#000080">:</font><font color="#800000">$006C</font><font color="#000080">;
  </font>regs <font color="#000080">: </font>Registers<font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>KeyPressed<font color="#000080">: </font>Boolean<font color="#000080">;
  </font><font color="#FF0000"><b>begin
    </b></font>KeyPressed <font color="#000080">:= (</font>tail <font color="#000080">&lt;&gt; </font>head<font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>ClrScr<font color="#000080">;                                     </font><font color="#008000"><i>{ 25 line display only }
 </i></font><font color="#FF0000"><b>begin
   Inline</b></font><font color="#000080">(</font><font color="#800000">$B4</font><font color="#000080">/</font><font color="#800000">$06</font><font color="#000080">/</font><font color="#800000">$B0</font><font color="#000080">/</font><font color="#800000">$19</font><font color="#000080">/</font><font color="#800000">$B7</font><font color="#000080">/</font><font color="#800000">$07</font><font color="#000080">/</font><font color="#800000">$B5</font><font color="#000080">/</font><font color="#800000">$00</font><font color="#000080">/</font><font color="#800000">$B1</font><font color="#000080">/</font><font color="#800000">$00</font><font color="#000080">/</font><font color="#800000">$B6</font><font color="#000080">/</font><font color="#800000">$19</font><font color="#000080">/</font><font color="#800000">$B2</font><font color="#000080">/</font><font color="#800000">$4F</font><font color="#000080">/
          </font><font color="#800000">$CD</font><font color="#000080">/</font><font color="#800000">$10</font><font color="#000080">/</font><font color="#800000">$B4</font><font color="#000080">/</font><font color="#800000">$02</font><font color="#000080">/</font><font color="#800000">$B7</font><font color="#000080">/</font><font color="#800000">$00</font><font color="#000080">/</font><font color="#800000">$B2</font><font color="#000080">/</font><font color="#800000">$00</font><font color="#000080">/</font><font color="#800000">$B6</font><font color="#000080">/</font><font color="#800000">$00</font><font color="#000080">/</font><font color="#800000">$CD</font><font color="#000080">/</font><font color="#800000">$10</font><font color="#000080">);
 </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>ClrKey<font color="#000080">;
  </font><font color="#FF0000"><b>begin
    </b></font>head <font color="#000080">:= </font>tail<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>Function </b></font>ExtKey<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>k <font color="#000080">: </font>Char<font color="#000080">; </font><font color="#FF0000"><b>Var </b></font>s <font color="#000080">: </font>Byte<font color="#000080">): </font>Boolean<font color="#000080">;

  </font><font color="#FF0000"><b>Var
    </b></font>keycode <font color="#000080">: </font>Word<font color="#000080">;
    </font>al      <font color="#000080">: </font>Byte<font color="#000080">;
    </font>ah      <font color="#000080">: </font>Byte<font color="#000080">;

  </font><font color="#FF0000"><b>begin
    </b></font>ExtKey    <font color="#000080">:= </font>False<font color="#000080">;
    </font><font color="#FF0000"><b>Repeat
      </b></font>keycode <font color="#000080">:= </font>KeyWord<font color="#000080">;
      </font>al      <font color="#000080">:= </font>lo<font color="#000080">(</font>keycode<font color="#000080">);
      </font>ah      <font color="#000080">:= </font>hi<font color="#000080">(</font>keycode<font color="#000080">);
      </font><font color="#FF0000"><b>if </b></font>al <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>then begin
        </b></font>ExtKey <font color="#000080">:= </font>True<font color="#000080">;
        </font>al     <font color="#000080">:= </font>ah<font color="#000080">;
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>Until </b></font>al <font color="#000080">&lt;&gt; </font><font color="#800000">0</font><font color="#000080">;
  </font>k <font color="#000080">:= </font>chr<font color="#000080">(</font>al<font color="#000080">);
  </font>s <font color="#000080">:= </font>al<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;    </font><font color="#008000"><i>{ExtKey}

</i></font><font color="#FF0000"><b>Function </b></font>ReadKey <font color="#000080">: </font>Char<font color="#000080">;
  </font><font color="#FF0000"><b>Var
    </b></font>Key <font color="#000080">: </font>Byte<font color="#000080">;
  </font><font color="#FF0000"><b>begin
    </b></font>Key <font color="#000080">:= </font>lo<font color="#000080">(</font>KeyWord<font color="#000080">);
    </font>ReadKey <font color="#000080">:= </font>Char<font color="#000080">(</font>Key<font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>NextKey <font color="#000080">: </font>Char<font color="#000080">;
  </font><font color="#FF0000"><b>begin
    </b></font>tail <font color="#000080">:= </font>head<font color="#000080">;
    </font>NextKey <font color="#000080">:= </font>ReadKey<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>PeekKey <font color="#000080">: </font>Char<font color="#000080">;
  </font><font color="#FF0000"><b>begin
    </b></font>PeekKey <font color="#000080">:= </font>Char<font color="#000080">(</font>Mem<font color="#000080">[</font><font color="#800000">$40</font><font color="#000080">:</font>head<font color="#000080">]);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>Delay<font color="#000080">(</font>s <font color="#000080">: </font>Word<font color="#000080">);
  </font><font color="#FF0000"><b>Var
    </b></font>start    <font color="#000080">: </font>LongInt<font color="#000080">;
    </font>finished <font color="#000080">: </font>Boolean<font color="#000080">;
  </font><font color="#FF0000"><b>begin
    </b></font>start <font color="#000080">:= </font>time<font color="#000080">;
    </font><font color="#FF0000"><b>Repeat
      if </b></font>time <font color="#000080">&lt; </font>start <font color="#FF0000"><b>then    </b></font><font color="#008000"><i>{ midnight rollover occurred during the period }
        </i></font>dec<font color="#000080">(</font>start<font color="#000080">,</font><font color="#800000">$1800B0</font><font color="#000080">);
      </font>finished <font color="#000080">:= (</font>time <font color="#000080">&gt; (</font>start <font color="#000080">+ </font>s <font color="#000080">* </font><font color="#800000">18.2</font><font color="#000080">));
    </font><font color="#FF0000"><b>Until </b></font>finished<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>GotoXY<font color="#000080">(</font>x<font color="#000080">,</font>y <font color="#000080">: </font>Byte<font color="#000080">);
  </font><font color="#FF0000"><b>begin
    With </b></font>regs <font color="#FF0000"><b>do begin
      </b></font>ah <font color="#000080">:= </font><font color="#800000">$02</font><font color="#000080">;
      </font>bh <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
      </font>dh <font color="#000080">:= </font>pred<font color="#000080">(</font>y<font color="#000080">);
      </font>dl <font color="#000080">:= </font>pred<font color="#000080">(</font>x<font color="#000080">);
      </font>intr<font color="#000080">(</font><font color="#800000">$10</font><font color="#000080">,</font>regs<font color="#000080">);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{ With }
  </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;   </font><font color="#008000"><i>{ GotoXY }

</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">.
 


</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to CRT SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0009.PAS">Original</a><b>]</b></p></body>
</html>
