<html>
<head><title> "REDIRCT3.PAS" by SWAG SUPPORT TEAM</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to REDIRECT SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0005.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
MARK LEWIS

&gt;&gt; Still need a bit of help here.  I can't redirect output from a
&gt;&gt; Program when executing it from a Pascal Program!  Is there any
&gt;&gt; this from Pascal? Any help would be greatly appreciated.
&gt; if I understand you, you are using the Exec Procedure to run a
&gt; Program.  if that is the Case you won't be ablr to redirect since
&gt; this is a Function of Dos and not the Program you exec.  You will
&gt; need to run the Program through a child process in order to
&gt; perform the redirect, something like:
&gt; Exec(GetEnv('COMSPEC'),'/C MyProg.exe&gt;redirect');

one could also utilize duplicate File handles -=B-)

}
</i></font><font color="#FF0000"><b>Unit </b></font>Execute<font color="#000080">;

</font><font color="#FF0000"><b>Interface

Procedure </b></font>Exec<font color="#000080">(</font>Path<font color="#000080">, </font>CmdLine <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">);

</font><font color="#FF0000"><b>Implementation

Uses
  </b></font>Dos<font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>ExtractFileName<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>Line <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">; </font>Index <font color="#000080">: </font>Integer<font color="#000080">) : </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Var
  </b></font>Temp <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>Delete<font color="#000080">(</font>Line<font color="#000080">, </font>Index<font color="#000080">, </font><font color="#800000">1</font><font color="#000080">);
  </font><font color="#FF0000"><b>While </b></font><font color="#000080">(</font>Index <font color="#000080">&lt;= </font>Length<font color="#000080">(</font>Line<font color="#000080">)) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>Line<font color="#000080">[</font>Index<font color="#000080">] = </font><font color="#800000">' '</font><font color="#000080">) </font><font color="#FF0000"><b>Do
    </b></font>Delete<font color="#000080">(</font>Line<font color="#000080">, </font>Index<font color="#000080">, </font><font color="#800000">1</font><font color="#000080">);
  </font>Temp <font color="#000080">:= </font><font color="#800000">''</font><font color="#000080">;
  </font><font color="#FF0000"><b>While </b></font><font color="#000080">(</font>Index <font color="#000080">&lt;= </font>Length<font color="#000080">(</font>Line<font color="#000080">)) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>Line<font color="#000080">[</font>Index<font color="#000080">] &lt;&gt; </font><font color="#800000">' '</font><font color="#000080">) </font><font color="#FF0000"><b>Do
  begin
    </b></font>Temp <font color="#000080">:= </font>Temp <font color="#000080">+ </font>Line<font color="#000080">[</font>Index<font color="#000080">];
    </font>Delete<font color="#000080">(</font>Line<font color="#000080">, </font>Index<font color="#000080">, </font><font color="#800000">1</font><font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>ExtractFileName <font color="#000080">:= </font>Temp<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>CloseHandle<font color="#000080">(</font>Handle <font color="#000080">: </font>Word<font color="#000080">);
</font><font color="#FF0000"><b>Var
  </b></font>Regs <font color="#000080">: </font>Registers<font color="#000080">;
</font><font color="#FF0000"><b>begin
  With </b></font>Regs <font color="#FF0000"><b>Do
  begin
    </b></font>AH <font color="#000080">:= </font><font color="#800000">$3E</font><font color="#000080">;
    </font>BX <font color="#000080">:= </font>Handle<font color="#000080">;
    </font>MsDos<font color="#000080">(</font>Regs<font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>Duplicate<font color="#000080">(</font>SourceHandle <font color="#000080">: </font>Word<font color="#000080">;</font><font color="#FF0000"><b>Var </b></font>TargetHandle <font color="#000080">: </font>Word<font color="#000080">);
</font><font color="#FF0000"><b>Var
  </b></font>Regs <font color="#000080">: </font>Registers<font color="#000080">;
</font><font color="#FF0000"><b>begin
  With </b></font>Regs <font color="#FF0000"><b>Do
  begin
    </b></font>AH <font color="#000080">:= </font><font color="#800000">$45</font><font color="#000080">;
    </font>BX <font color="#000080">:= </font>SourceHandle<font color="#000080">;
    </font>MsDos<font color="#000080">(</font>Regs<font color="#000080">);
    </font>TargetHandle <font color="#000080">:= </font>AX<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>ForceDuplicate<font color="#000080">(</font>SourceHandle <font color="#000080">: </font>Word<font color="#000080">;</font><font color="#FF0000"><b>Var </b></font>TargetHandle <font color="#000080">: </font>Word<font color="#000080">);
</font><font color="#FF0000"><b>Var
  </b></font>Regs <font color="#000080">: </font>Registers<font color="#000080">;
</font><font color="#FF0000"><b>begin
  With </b></font>Regs <font color="#FF0000"><b>Do
  begin
    </b></font>AH <font color="#000080">:= </font><font color="#800000">$46</font><font color="#000080">;
    </font>BX <font color="#000080">:= </font>SourceHandle<font color="#000080">;
    </font>CX <font color="#000080">:= </font>TargetHandle<font color="#000080">;
    </font>MsDos<font color="#000080">(</font>Regs<font color="#000080">);
    </font>TargetHandle <font color="#000080">:= </font>AX<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>Exec<font color="#000080">(</font>Path<font color="#000080">,</font>CmdLine <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">);
</font><font color="#FF0000"><b>Var
  </b></font>StdIn<font color="#000080">,
  </font>Stdout    <font color="#000080">: </font>Word<font color="#000080">;
  </font>Index     <font color="#000080">: </font>Integer<font color="#000080">;
  </font>FName     <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">[</font><font color="#800000">80</font><font color="#000080">];
  </font>InFile<font color="#000080">,
  </font>OutFile   <font color="#000080">: </font>Text<font color="#000080">;
  </font>InHandle<font color="#000080">,
  </font>OutHandle <font color="#000080">: </font>Word<font color="#000080">;
         </font><font color="#008000"><i>{ ===============&gt;&gt;&gt;&gt; }   { change below For STDERR }
</i></font><font color="#FF0000"><b>begin
  </b></font>StdIn  <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font>StdOut <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;                    </font><font color="#008000"><i>{ change to 2 For StdErr       }
  </i></font>Duplicate<font color="#000080">(</font>StdIn<font color="#000080">, </font>InHandle<font color="#000080">);      </font><font color="#008000"><i>{ duplicate standard input     }
  </i></font>Duplicate<font color="#000080">(</font>StdOut<font color="#000080">, </font>OutHandle<font color="#000080">);    </font><font color="#008000"><i>{ duplicate standard output    }
  </i></font>Index <font color="#000080">:= </font>Pos<font color="#000080">(</font><font color="#800000">'&gt;'</font><font color="#000080">, </font>CmdLine<font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font>Index <font color="#000080">&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>Then               </b></font><font color="#008000"><i>{ check For output redirection }
  </i></font><font color="#FF0000"><b>begin
    </b></font>FName <font color="#000080">:= </font>ExtractFileName<font color="#000080">(</font>CmdLine<font color="#000080">, </font>Index<font color="#000080">);  </font><font color="#008000"><i>{ get output File name  }
    </i></font>Assign<font color="#000080">(</font>OutFile<font color="#000080">, </font>FName<font color="#000080">);                    </font><font color="#008000"><i>{ open a Text File      }
    </i></font>ReWrite<font color="#000080">(</font>OutFile<font color="#000080">);                         </font><font color="#008000"><i>{ .. For output         }
    </i></font>ForceDuplicate<font color="#000080">(</font>TextRec<font color="#000080">(</font>OutFile<font color="#000080">).</font>Handle<font color="#000080">, </font>StdOut<font color="#000080">);</font><font color="#008000"><i>{ make output same }
  </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>Index <font color="#000080">:= </font>Pos<font color="#000080">(</font><font color="#800000">'&lt;'</font><font color="#000080">, </font>CmdLine<font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font>Index <font color="#000080">&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>Then               </b></font><font color="#008000"><i>{ check For input redirection }
  </i></font><font color="#FF0000"><b>begin
    </b></font>FName <font color="#000080">:= </font>ExtractFileName<font color="#000080">(</font>CmdLine<font color="#000080">, </font>Index<font color="#000080">);  </font><font color="#008000"><i>{ get input File name  }
    </i></font>Assign<font color="#000080">(</font>InFile<font color="#000080">, </font>FName<font color="#000080">);                     </font><font color="#008000"><i>{ open a Text File     }
    </i></font>Reset<font color="#000080">(</font>InFile<font color="#000080">);                            </font><font color="#008000"><i>{ For input            }
    </i></font>ForceDuplicate<font color="#000080">(</font>TextRec<font color="#000080">(</font>InFile<font color="#000080">).</font>Handle<font color="#000080">, </font>StdIn<font color="#000080">);  </font><font color="#008000"><i>{ make input same }
  </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>Dos<font color="#000080">.</font>Exec<font color="#000080">(</font>Path<font color="#000080">, </font>CmdLine<font color="#000080">);           </font><font color="#008000"><i>{ run EXEC }
  </i></font>ForceDuplicate<font color="#000080">(</font>InHandle<font color="#000080">, </font>StdIn<font color="#000080">);   </font><font color="#008000"><i>{ put standard input back to keyboard }
  </i></font>ForceDuplicate<font color="#000080">(</font>OutHandle<font color="#000080">, </font>StdOut<font color="#000080">); </font><font color="#008000"><i>{ put standard output back to screen  }
  </i></font>CloseHandle<font color="#000080">(</font>InHandle<font color="#000080">);            </font><font color="#008000"><i>{ close the redirected input File     }
  </i></font>CloseHandle<font color="#000080">(</font>OutHandle<font color="#000080">);           </font><font color="#008000"><i>{ close the redirected output File    }
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>end</b></font><font color="#000080">.

</font><font color="#008000"><i>{===============================================================}
{
Use it exactly as you would the normal EXEC Procedure:

  Exec('MAsm.EXE','mystuff.Asm');

To activate redirection simply add the redirection symbols, etc:

  Exec('MAsm.EXE','mystuff.Asm &gt;err.lst');


One note of caution.  This routine temporarily Uses extra handles. It's
either two or four more.  The Various books I have are not clear as to
whether duplicated handles 'count' or not. My guess is yes.  if you don't
plan on redirecting STDIN then remove all the code For duplicating it to
cut your handle overhead in half.
}

</i></font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to REDIRECT SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0005.PAS">Original</a><b>]</b></p></body>
</html>
