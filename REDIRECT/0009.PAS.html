<html>
<head><title> "Redirecting PKZIP/PKUNZIP" by MARK OUELLET</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to REDIRECT SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0009.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
&gt;&gt; Program windatest;
&gt;&gt; Uses Crt;
&gt;&gt; Begin
&gt;&gt; Window(1, 15, 80, 22);
&gt;&gt; ClrScr;
&gt;&gt; SwapVectors;
&gt;&gt; Exec('C:\PKUNZIP.EXE','-V ZIPPY.ZIP');
&gt;&gt; SwapVectors;
&gt;&gt; End.

&gt;&gt; Note that this may not work for some users: your command is an
&gt;&gt; explicit path/filename, and unless PKUNZIP were in the root

SR&gt;   Although I agree about the comspec problem (and there's no $m
SR&gt; directive), I think this won't work in any case. You probably know
SR&gt; more about this than I, Mike, but I think that exec essentially sets
SR&gt; the screen to 80 by 25 and clears it. Anyway, I've never had success
SR&gt; doing this under normal TP. Gayle Davis (I think) posted a program in
SR&gt; the FIDO Pascal echo that would work, as long as the program didn't
SR&gt; use direct screen writes (which I think PKZIP does). I really can't
SR&gt; think of a way to make it work with direct writes. Well, I can, but it
SR&gt; means going into virtual 86 mode, something I wouldn't feel
SR&gt; comfortable even discussing &lt;g&gt;. I guess that's what Windows and
SR&gt; DesqView do.

SR&gt;   Of course, if you can redirect the output to a file you can then
SR&gt; print that file to the screen....  :)

    The problem is that Pkzip sends output through a different chanel than TP
uses for screen writes. Actually, if you set up a window as above, then hook
up Int29 and replace Normal Int29 code by simply using Write(register al),
then your output will go through TP's IO routines and will respect the window
coordinates. Here ya go! Written, Compiled and Tested using BP 7.x
}

{$A+ Word Align Data}
{$B+ Complete Boolean Eval}
{$D+ Debug Information}
{$E+ Numeric Processing Emulation}
{$F+ Force Far Calls}
{$G+ Generate 286 Instructions}
{$I+ Input/Output Checking}
{$L+ Local Symbol Information}
{$N+ Numeric Coprocessor}
{$O+ Overlay Code Generation}
{$P+ Open String Parameters}
{$Q+ Numerical Overflow Checking}
{$R+ Range Checking}
{$S+ Stack-Overflow Checking}
{$T+ Type-Checked Pointers}
{$V+ Var-String Checking}
{$X+ Extended Syntax}
{$Y+ Symbol Reference Imformation}
{$M 16384,0,0}
</i></font><font color="#FF0000"><b>Program </b></font>RedirExec<font color="#000080">;
</font><font color="#FF0000"><b>uses
  </b></font>dos<font color="#000080">,
  </font>crt<font color="#000080">;

 </font><font color="#008000"><i>{$F+}
 </i></font><font color="#FF0000"><b>procedure </b></font>NewInt29h<font color="#000080">(</font>Flags<font color="#000080">, </font>CS<font color="#000080">, </font>IP<font color="#000080">, </font>AX<font color="#000080">, </font>BX<font color="#000080">, </font>CX<font color="#000080">, </font>DX<font color="#000080">, </font>SI<font color="#000080">, </font>DI<font color="#000080">, </font>DS<font color="#000080">, </font>ES<font color="#000080">, </font>BP<font color="#000080">: </font>Word<font color="#000080">);
  </font>interrupt<font color="#000080">;

  </font><font color="#FF0000"><b>begin
   asm
     </b></font><font color="#FF00FF">cli
   </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
   </font>write<font color="#000080">(</font>char<font color="#000080">(</font>lo<font color="#000080">(</font>AX<font color="#000080">)));
   </font><font color="#FF0000"><b>asm
     </b></font><font color="#FF00FF">sti
   </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
 </font><font color="#008000"><i>{$F-}

</i></font><font color="#FF0000"><b>var
  </b></font>OldInt29h <font color="#000080">: </font><font color="#FF0000"><b>procedure</b></font><font color="#000080">;
  </font>X<font color="#000080">,</font>Y <font color="#000080">: </font>byte<font color="#000080">;

</font><font color="#FF0000"><b>begin
  </b></font><font color="#008000"><i>{Save the old Int29 handler adress so we can restore it}
  </i></font>getintvec<font color="#000080">(</font><font color="#800000">$29</font><font color="#000080">, @</font>OldInt29h<font color="#000080">);
  </font><font color="#008000"><i>{Set our own Int29 handler}
  </i></font>setintvec<font color="#000080">(</font><font color="#800000">$29</font><font color="#000080">, @</font>NewInt29h<font color="#000080">);
  </font><font color="#008000"><i>{Create a fancy window with border}
  </i></font>textcolor<font color="#000080">(</font>Yellow<font color="#000080">);
  </font>textbackground<font color="#000080">(</font>Blue<font color="#000080">);
  </font>clrscr<font color="#000080">;
  </font>window<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">80</font><font color="#000080">,</font><font color="#800000">20</font><font color="#000080">);
  </font>write<font color="#000080">(</font><font color="#800000">'&Eacute;'</font><font color="#000080">);
  </font><font color="#FF0000"><b>for </b></font>x <font color="#000080">:= </font><font color="#800000">2 </font><font color="#FF0000"><b>to </b></font><font color="#800000">80</font><font color="#000080">-</font><font color="#800000">1 </font><font color="#FF0000"><b>do
    </b></font>write<font color="#000080">(</font><font color="#800000">'&Iacute;'</font><font color="#000080">);
  </font>write<font color="#000080">(</font><font color="#800000">'&raquo;'</font><font color="#000080">);
  </font><font color="#FF0000"><b>for </b></font>x <font color="#000080">:= </font><font color="#800000">2 </font><font color="#FF0000"><b>to </b></font><font color="#800000">20</font><font color="#000080">-</font><font color="#800000">1 </font><font color="#FF0000"><b>do
  begin
    </b></font>write<font color="#000080">(</font><font color="#800000">'&ordm;'</font><font color="#000080">);
    </font><font color="#FF0000"><b>for </b></font>y <font color="#000080">:= </font><font color="#800000">2 </font><font color="#FF0000"><b>to </b></font><font color="#800000">80</font><font color="#000080">-</font><font color="#800000">1 </font><font color="#FF0000"><b>do
      </b></font>write<font color="#000080">(</font><font color="#800000">' '</font><font color="#000080">);
    </font>write<font color="#000080">(</font><font color="#800000">'&ordm;'</font><font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font>write<font color="#000080">(</font><font color="#800000">'&Egrave;'</font><font color="#000080">);
  </font><font color="#FF0000"><b>for </b></font>x <font color="#000080">:= </font><font color="#800000">2 </font><font color="#FF0000"><b>to </b></font><font color="#800000">80</font><font color="#000080">-</font><font color="#800000">1 </font><font color="#FF0000"><b>do
    </b></font>write<font color="#000080">(</font><font color="#800000">'&Iacute;'</font><font color="#000080">);

  </font>inc<font color="#000080">(</font>WindMax<font color="#000080">);
  </font>write<font color="#000080">(</font><font color="#800000">'&frac14;'</font><font color="#000080">);
  </font>dec<font color="#000080">(</font>WindMax<font color="#000080">);
  </font>textcolor<font color="#000080">(</font>White<font color="#000080">);
  </font>textbackground<font color="#000080">(</font>Black<font color="#000080">);
  </font><font color="#008000"><i>{ Now that the border is drawn, just reduce the window by 1 caracters on
    each side so our writes don't mess the border }
  </i></font>window<font color="#000080">(</font><font color="#800000">2</font><font color="#000080">,</font><font color="#800000">2</font><font color="#000080">,</font><font color="#800000">79</font><font color="#000080">,</font><font color="#800000">19</font><font color="#000080">);
  </font>clrscr<font color="#000080">;
  </font>swapvectors<font color="#000080">;
  </font>exec<font color="#000080">(</font><font color="#800000">'C:\UTIL\PKUNZIP.EXE'</font><font color="#000080">, </font><font color="#800000">'-v G:\DOS\NU\NU8-1.ZIP'</font><font color="#000080">);
  </font>swapvectors<font color="#000080">;
  </font>setintvec<font color="#000080">(</font><font color="#800000">$29</font><font color="#000080">, @</font>OldInt29h<font color="#000080">);    </font><font color="#008000"><i>{Restore old Int 29h}
  </i></font>window<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">80</font><font color="#000080">,</font><font color="#800000">25</font><font color="#000080">);
  </font>gotoxy<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">21</font><font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to REDIRECT SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0009.PAS">Original</a><b>]</b></p></body>
</html>
