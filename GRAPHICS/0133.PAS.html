<html>
<head><title> "X-mode Write Mode Example" by ANDREW GOLOVIN</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to GRAPHICS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0133.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code>
<font color="#008000"><i>{ Illustration on how VGA Write Mode 1 works }
{ by Andrew Golovin (2:5080/10@Fidonet)      }
{ Can be used at your own risk freely w/o    }
{ any charge                                 }
{============================================}
{ PREFACE:                                   }
{ This example illustrate posibility to save }
{ Bitmaps in unused VRam. And use VWM1 to    }
{ restore it by 4 pixels at one byte         }
{ Use arrows to move &quot;bitmap&quot; on screen.     }
{ This example _only_ illustrate this mode   }
{ Extremly needs optimization! Don't use it  }
{ as is. Just an idea.                       }

</i></font><font color="#FF0000"><b>Uses </b></font>CRT<font color="#000080">;
</font><font color="#FF0000"><b>var
  </b></font>OldMode<font color="#000080">: </font>Byte<font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>SetWriteMode<font color="#000080">(</font>Wmode<font color="#000080">: </font>Byte<font color="#000080">); </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>asm
  </b></font><font color="#FF00FF">Mov     DX,3ceh
  Mov     AL,5
  Out     DX,AL
  Inc     DX
  In      AL,DX
  And     AL,11111100b
  Or      AL,WMode
  Out     DX,AL
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>Init320x200_X<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>asm
  </b></font><font color="#FF00FF">Mov AH,0fh; Int 10h; Mov [OldMode],al; Mov AX,13h; Int 10h;
  Mov DX,3c4h; Mov AL,04h; Out DX,AL; Inc DX; In AL,DX; And AL,011110111b;
  Or AL,000000100b; Out DX,AL; Dec DX; Mov AX,0f02h; Out DX,AX;
  Mov AX,0a000h; Mov ES,AX; XOr DI,DI; Mov AX,0202h; Mov CX,8000h;
  ClD; RepNZ StoSW; Mov DX,3d4h; Mov AL,14h; Out DX,AL; Inc DX;
  In AL,DX; And AL,010111111b; Out DX,AL; Dec DX; Mov AL,017h;
  Out DX,AL; Inc DX; In AL,DX; Or AL,01000000b; Out DX,AL; Mov DX,3d4h;
  Mov AX,80; ShR AX,1; Mov AH,AL; Mov AL,13h; Out DX,AX; Ret
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>PutPixel<font color="#000080">(</font>x<font color="#000080">,</font>y<font color="#000080">: </font>Word<font color="#000080">; </font>c<font color="#000080">: </font>Byte<font color="#000080">);
  </font><font color="#FF0000"><b>begin
    asm
      </b></font><font color="#FF00FF">Mov    DX,3c4h
      Mov    AL,02
      Out    DX,AL
      Mov    AX,Y
      ShL    AX,4
      Mov    DI,AX
      ShL    AX,2
      Add    DI,AX
      Mov    AX,X
      ShR    AX,2
      Add    DI,AX
      Mov    AX,X
      And    AX,3
      Mov    CL,AL
      Mov    AL,1
      ShL    AL,CL
      Inc    DX
      Out    DX,AL
      Mov    AX,0a000h
      Mov    ES,AX
      Mov    AL,C
      StoSB
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>MaskBits<font color="#000080">(</font>BitsToMask<font color="#000080">: </font>Byte<font color="#000080">); </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>asm
    </b></font><font color="#FF00FF">Mov     DX,3ceh
    Mov     AL,8
    Mov     AH,BitsToMask
    Out     DX,AX
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>MaskPlanes<font color="#000080">(</font>PlaneToMask<font color="#000080">: </font>Byte<font color="#000080">); </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>asm
  </b></font><font color="#FF00FF">Mov     DX,3c4h
  Mov     AL,2
  Out     DX,AL
  Inc     DX
  Mov     AL,PlaneToMask
  Out     DX,AL
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>StoreBack<font color="#000080">(</font>x<font color="#000080">,</font>y<font color="#000080">,</font>w<font color="#000080">,</font>h<font color="#000080">: </font>word<font color="#000080">; </font>toAddr<font color="#000080">: </font>word<font color="#000080">);
  </font><font color="#FF0000"><b>var
    </b></font>curx<font color="#000080">,</font>cury<font color="#000080">: </font>Word<font color="#000080">;
  </font><font color="#FF0000"><b>begin
    </b></font>SetWriteMode<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">);
    </font>MaskPlanes<font color="#000080">(</font><font color="#800000">$f</font><font color="#000080">);
    </font>MaskBits<font color="#000080">(</font><font color="#800000">$ff</font><font color="#000080">);
    </font><font color="#FF0000"><b>For </b></font>CurY<font color="#000080">:=</font>Y <font color="#FF0000"><b>to </b></font>Y<font color="#000080">+</font>H <font color="#FF0000"><b>do
      </b></font>Move<font color="#000080">(</font>Mem<font color="#000080">[</font><font color="#800000">$a000</font><font color="#000080">:</font>CurY<font color="#000080">*</font><font color="#800000">80</font><font color="#000080">+</font>x<font color="#000080">],</font>Mem<font color="#000080">[</font><font color="#800000">$a000</font><font color="#000080">:</font>toAddr<font color="#000080">+(</font>CurY<font color="#000080">-</font>Y<font color="#000080">)*</font>W<font color="#000080">],</font>w<font color="#000080">);
    </font>SetWriteMode<font color="#000080">(</font><font color="#800000">0</font><font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>RestoreBack<font color="#000080">(</font>x<font color="#000080">,</font>y<font color="#000080">,</font>w<font color="#000080">,</font>h<font color="#000080">: </font>word<font color="#000080">; </font>fromAddr<font color="#000080">: </font>Word<font color="#000080">);
  </font><font color="#FF0000"><b>var
    </b></font>cury<font color="#000080">,</font>curx<font color="#000080">: </font>Word<font color="#000080">;
  </font><font color="#FF0000"><b>begin
    </b></font>SetWriteMode<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">);
    </font>MaskPlanes<font color="#000080">(</font><font color="#800000">$f</font><font color="#000080">);
    </font>MaskBits<font color="#000080">(</font><font color="#800000">$ff</font><font color="#000080">);
    </font><font color="#FF0000"><b>For </b></font>CurY<font color="#000080">:=</font>Y <font color="#FF0000"><b>to </b></font>Y<font color="#000080">+</font>H <font color="#FF0000"><b>do
      </b></font>Move<font color="#000080">(</font>Mem<font color="#000080">[</font><font color="#800000">$a000</font><font color="#000080">:</font>fromAddr<font color="#000080">+(</font>CurY<font color="#000080">-</font>Y<font color="#000080">)*</font>W<font color="#000080">],</font>Mem<font color="#000080">[</font><font color="#800000">$a000</font><font color="#000080">:</font>CurY<font color="#000080">*</font><font color="#800000">80</font><font color="#000080">+</font>x<font color="#000080">],</font>w<font color="#000080">);
    </font>SetWriteMode<font color="#000080">(</font><font color="#800000">0</font><font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>var
  </b></font>x<font color="#000080">,</font>y<font color="#000080">: </font>Word<font color="#000080">;
  </font>curx<font color="#000080">,</font>cury<font color="#000080">: </font>Word<font color="#000080">;
  </font>c<font color="#000080">: </font>Char<font color="#000080">;
</font><font color="#FF0000"><b>Begin
  </b></font>Init320x200_x<font color="#000080">;
  </font><font color="#FF0000"><b>For </b></font>x<font color="#000080">:=</font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font><font color="#800000">319 </font><font color="#FF0000"><b>do
    For </b></font>y<font color="#000080">:=</font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font><font color="#800000">199 </font><font color="#FF0000"><b>do
      </b></font>PutPixel<font color="#000080">(</font>x<font color="#000080">,</font>y<font color="#000080">,(</font>x <font color="#000080">+</font>y<font color="#000080">) </font><font color="#FF0000"><b>mod </b></font><font color="#800000">16</font><font color="#000080">+</font><font color="#800000">16</font><font color="#000080">);
  </font>StoreBack<font color="#000080">(</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">3</font><font color="#000080">,</font><font color="#800000">12</font><font color="#000080">,</font><font color="#800000">16000</font><font color="#000080">);
  </font><font color="#FF0000"><b>For </b></font>x<font color="#000080">:=</font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font><font color="#800000">11 </font><font color="#FF0000"><b>do
    For </b></font>y<font color="#000080">:=</font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font><font color="#800000">11 </font><font color="#FF0000"><b>do
      </b></font>PutPixel<font color="#000080">(</font>x<font color="#000080">,</font>y<font color="#000080">,</font>Random<font color="#000080">(</font><font color="#800000">255</font><font color="#000080">));
  </font>StoreBack<font color="#000080">(</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">3</font><font color="#000080">,</font><font color="#800000">12</font><font color="#000080">,</font><font color="#800000">16200</font><font color="#000080">);
  </font>CurX<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;</font>CurY<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
  </font><font color="#FF0000"><b>Repeat
    Repeat Until </b></font>KeyPressed<font color="#000080">;
    </font>c<font color="#000080">:=</font>ReadKey<font color="#000080">;
    </font><font color="#FF0000"><b>If </b></font>c<font color="#000080">=</font><font color="#800000">#0
       </font><font color="#FF0000"><b>then
         begin
           </b></font>RestoreBack<font color="#000080">(</font>CurX<font color="#000080">,</font>CurY<font color="#000080">,</font><font color="#800000">3</font><font color="#000080">,</font><font color="#800000">12</font><font color="#000080">,</font><font color="#800000">16000</font><font color="#000080">);
           </font>c<font color="#000080">:=</font>ReadKey<font color="#000080">;
           </font><font color="#FF0000"><b>Case </b></font>c <font color="#FF0000"><b>of
             </b></font><font color="#800000">#80</font><font color="#000080">: </font><font color="#FF0000"><b>If </b></font>CurY<font color="#000080">&lt;</font><font color="#800000">187
                     </font><font color="#FF0000"><b>then
                       </b></font>Inc<font color="#000080">(</font>CurY<font color="#000080">);
             </font><font color="#800000">#72</font><font color="#000080">: </font><font color="#FF0000"><b>If </b></font>CurY<font color="#000080">&gt;</font><font color="#800000">0
                     </font><font color="#FF0000"><b>Then
                       </b></font>Dec<font color="#000080">(</font>CurY<font color="#000080">);
             </font><font color="#800000">#75</font><font color="#000080">: </font><font color="#FF0000"><b>If </b></font>CurX<font color="#000080">&gt;</font><font color="#800000">0
                     </font><font color="#FF0000"><b>Then
                       </b></font>Dec<font color="#000080">(</font>CurX<font color="#000080">);
             </font><font color="#800000">#77</font><font color="#000080">: </font><font color="#FF0000"><b>If </b></font>CurX<font color="#000080">&lt;</font><font color="#800000">77
                     </font><font color="#FF0000"><b>Then
                       </b></font>Inc<font color="#000080">(</font>CurX<font color="#000080">);
           </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
           </font>StoreBack<font color="#000080">(</font>CurX<font color="#000080">,</font>CurY<font color="#000080">,</font><font color="#800000">3</font><font color="#000080">,</font><font color="#800000">12</font><font color="#000080">,</font><font color="#800000">16000</font><font color="#000080">);
           </font>RestoreBack<font color="#000080">(</font>CurX<font color="#000080">,</font>CurY<font color="#000080">,</font><font color="#800000">3</font><font color="#000080">,</font><font color="#800000">12</font><font color="#000080">,</font><font color="#800000">16200</font><font color="#000080">);
         </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>Until </b></font>c<font color="#000080">=</font><font color="#800000">#27</font><font color="#000080">;
  </font><font color="#FF0000"><b>asm </b></font><font color="#FF00FF">Mov al,OldMode; XOr AH,AH; Int 10h </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">.

</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to GRAPHICS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0133.PAS">Original</a><b>]</b></p></body>
</html>
