<html>
<head><title> "3D Landscape Source" by SEAN PALMER</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to GRAPHICS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0071.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
From: SEAN PALMER
Subj: 3d Landscape src
---------------------------------------------------------------------------
Check it out! Clean-room reverse-engineering of something pretty damn
similar to Comanche's patented Voxel-space technology... In Turbo!!

{by Sean Palmer}
{use I,J,K,L to look around, ESC ends}

</i></font><font color="#FF0000"><b>uses </b></font>crt<font color="#000080">;

</font><font color="#FF0000"><b>const
 </b></font>xSize<font color="#000080">=</font><font color="#800000">256</font><font color="#000080">;           </font><font color="#008000"><i>{90 degrees}
 </i></font>ySize<font color="#000080">=</font><font color="#800000">128</font><font color="#000080">;           </font><font color="#008000"><i>{60 degrees}
 </i></font>angleMask<font color="#000080">=</font>xSize<font color="#000080">*</font><font color="#800000">4</font><font color="#000080">-</font><font color="#800000">1</font><font color="#000080">; </font><font color="#008000"><i>{xSize must be power of 2 or and's won't work}
 </i></font>mapSize<font color="#000080">=</font><font color="#800000">128</font><font color="#000080">;

</font><font color="#FF0000"><b>var
 </b></font>sinTab<font color="#000080">:</font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font>angleMask<font color="#000080">]</font><font color="#FF0000"><b>of </b></font>integer<font color="#000080">;  </font><font color="#008000"><i>{sin(xyAngle)*$7FFF}
 </i></font>tanTab<font color="#000080">:</font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font>ySize<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">]</font><font color="#FF0000"><b>of </b></font>integer<font color="#000080">; </font><font color="#008000"><i>{tan(zAngle)*$7FFF}

 </i></font>map<font color="#000080">:</font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font>mapSize<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">..</font>mapSize<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">]</font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">;

</font><font color="#FF0000"><b>type
 </b></font>fixed<font color="#000080">=</font><font color="#FF0000"><b>record case </b></font>boolean <font color="#FF0000"><b>of
  </b></font>false<font color="#000080">:(</font>l<font color="#000080">:</font>longint<font color="#000080">);
  </font>true<font color="#000080">:(</font>f<font color="#000080">:</font>word<font color="#000080">;</font>i<font color="#000080">:</font>integer<font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>drawScene<font color="#000080">(</font>x<font color="#000080">,</font>y<font color="#000080">,</font>z<font color="#000080">,</font>rot<font color="#000080">:</font>integer<font color="#000080">);
</font><font color="#FF0000"><b>var </b></font>lastTan<font color="#000080">,</font>lastAngle<font color="#000080">,</font>h<font color="#000080">:</font>integer<font color="#000080">;
    </font>mapTan<font color="#000080">:</font>longint<font color="#000080">;
</font><font color="#FF0000"><b>var </b></font>scrn<font color="#000080">:</font>word<font color="#000080">;
</font><font color="#FF0000"><b>var </b></font>color<font color="#000080">,</font>height<font color="#000080">:</font>byte<font color="#000080">;
</font><font color="#FF0000"><b>var </b></font>xs<font color="#000080">,</font>ys<font color="#000080">,</font>ds<font color="#000080">:</font>longint<font color="#000080">;
</font><font color="#FF0000"><b>var </b></font>xp<font color="#000080">,</font>yp<font color="#000080">,</font>dp<font color="#000080">:</font>fixed<font color="#000080">;
</font><font color="#FF0000"><b>begin
 </b></font>fillchar<font color="#000080">(</font>mem<font color="#000080">[</font><font color="#800000">$A000</font><font color="#000080">:</font><font color="#800000">0</font><font color="#000080">],</font><font color="#800000">320</font><font color="#000080">*</font><font color="#800000">200</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">);
 </font><font color="#FF0000"><b>for </b></font>h<font color="#000080">:=</font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font>xSize<font color="#000080">-</font><font color="#800000">1 </font><font color="#FF0000"><b>do begin
  </b></font>lastAngle<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
  </font>scrn<font color="#000080">:=</font>h<font color="#000080">+</font><font color="#800000">320</font><font color="#000080">*(</font>ySize<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">);
  </font>lastTan<font color="#000080">:=</font>tanTab<font color="#000080">[</font>lastAngle<font color="#000080">];
  </font>xp<font color="#000080">.</font>i<font color="#000080">:=</font>x<font color="#000080">; </font>xp<font color="#000080">.</font>f<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
  </font>yp<font color="#000080">.</font>i<font color="#000080">:=</font>y<font color="#000080">; </font>yp<font color="#000080">.</font>f<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
  </font>dp<font color="#000080">.</font>l<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
  </font>xs<font color="#000080">:=</font>longint<font color="#000080">(</font>sinTab<font color="#000080">[(</font>h<font color="#000080">+</font>rot<font color="#000080">-(</font>xSize <font color="#FF0000"><b>shr </b></font><font color="#800000">1</font><font color="#000080">))</font><font color="#FF0000"><b>and </b></font>angleMask<font color="#000080">])*</font><font color="#800000">2</font><font color="#000080">;
  </font>ys<font color="#000080">:=</font>longint<font color="#000080">(</font>sinTab<font color="#000080">[(</font>h<font color="#000080">+</font>rot<font color="#000080">-(</font>xSize <font color="#FF0000"><b>shr </b></font><font color="#800000">1</font><font color="#000080">)+</font>xSize<font color="#000080">)</font><font color="#FF0000"><b>and </b></font>angleMask<font color="#000080">])*</font><font color="#800000">2</font><font color="#000080">; </font><font color="#008000"><i>{cos}
  </i></font>ds<font color="#000080">:=</font><font color="#800000">$FFFE</font><font color="#000080">;
  </font>inc<font color="#000080">(</font>xp<font color="#000080">.</font>l<font color="#000080">,</font>xs<font color="#000080">*</font><font color="#800000">16</font><font color="#000080">);
  </font>inc<font color="#000080">(</font>yp<font color="#000080">.</font>l<font color="#000080">,</font>ys<font color="#000080">*</font><font color="#800000">16</font><font color="#000080">);
  </font>inc<font color="#000080">(</font>dp<font color="#000080">.</font>l<font color="#000080">,</font>ds<font color="#000080">*</font><font color="#800000">16</font><font color="#000080">);
  </font><font color="#FF0000"><b>while </b></font>lastAngle<font color="#000080">&lt;</font>ySize <font color="#FF0000"><b>do begin
   </b></font>inc<font color="#000080">(</font>xp<font color="#000080">.</font>l<font color="#000080">,</font>xs<font color="#000080">*</font><font color="#800000">2</font><font color="#000080">);
   </font>inc<font color="#000080">(</font>yp<font color="#000080">.</font>l<font color="#000080">,</font>ys<font color="#000080">*</font><font color="#800000">2</font><font color="#000080">);
   </font>inc<font color="#000080">(</font>dp<font color="#000080">.</font>l<font color="#000080">,</font>ds<font color="#000080">*</font><font color="#800000">2</font><font color="#000080">);
   </font>inc<font color="#000080">(</font>xs<font color="#000080">,</font>xs <font color="#FF0000"><b>div </b></font><font color="#800000">32</font><font color="#000080">);
   </font>inc<font color="#000080">(</font>ys<font color="#000080">,</font>ys <font color="#FF0000"><b>div </b></font><font color="#800000">32</font><font color="#000080">);
   </font>inc<font color="#000080">(</font>ds<font color="#000080">,</font>ds <font color="#FF0000"><b>shr </b></font><font color="#800000">5</font><font color="#000080">);
   </font><font color="#FF0000"><b>if </b></font>word<font color="#000080">(</font>xp<font color="#000080">.</font>i<font color="#000080">)&gt;</font>mapSize<font color="#000080">-</font><font color="#800000">1 </font><font color="#FF0000"><b>then
    </b></font>break<font color="#000080">;
   </font><font color="#FF0000"><b>if </b></font>word<font color="#000080">(</font>yp<font color="#000080">.</font>i<font color="#000080">)&gt;</font>mapSize<font color="#000080">-</font><font color="#800000">1 </font><font color="#FF0000"><b>then
    </b></font>break<font color="#000080">;
   </font>height<font color="#000080">:=</font>map<font color="#000080">[</font>xp<font color="#000080">.</font>i<font color="#000080">,</font>yp<font color="#000080">.</font>i<font color="#000080">];
   </font>mapTan<font color="#000080">:=(</font>longint<font color="#000080">(</font>height<font color="#000080">-</font>z<font color="#000080">)*</font><font color="#800000">$7FFF</font><font color="#000080">)</font><font color="#FF0000"><b>div </b></font>dp<font color="#000080">.</font>i<font color="#000080">;
   </font>color<font color="#000080">:=</font><font color="#800000">32</font><font color="#000080">+(</font>z<font color="#000080">-</font>height<font color="#000080">);
   </font><font color="#FF0000"><b>while</b></font><font color="#000080">(</font>lastTan<font color="#000080">&lt;=</font>mapTan<font color="#000080">)</font><font color="#FF0000"><b>and</b></font><font color="#000080">(</font>lastAngle<font color="#000080">&lt;</font>ySize<font color="#000080">)</font><font color="#FF0000"><b>do begin
    </b></font>mem<font color="#000080">[</font><font color="#800000">$A000</font><font color="#000080">:</font>scrn<font color="#000080">]:=</font>color<font color="#000080">;
    </font>dec<font color="#000080">(</font>scrn<font color="#000080">,</font><font color="#800000">320</font><font color="#000080">);
    </font>inc<font color="#000080">(</font>lastAngle<font color="#000080">);
    </font>lastTan<font color="#000080">:=</font>tanTab<font color="#000080">[</font>lastAngle<font color="#000080">];
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
   </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
 </font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>procedure </b></font>initTables<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>i<font color="#000080">:</font>integer<font color="#000080">; </font>r<font color="#000080">:</font>real<font color="#000080">; </font><font color="#FF0000"><b>begin
 for </b></font>i<font color="#000080">:=</font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font>angleMask <font color="#FF0000"><b>do
  </b></font>sinTab<font color="#000080">[</font>i<font color="#000080">]:=</font>round<font color="#000080">(</font>sin<font color="#000080">(</font>i<font color="#000080">*</font>pi<font color="#000080">/</font><font color="#800000">512</font><font color="#000080">)*</font><font color="#800000">$7FFF</font><font color="#000080">);
 </font><font color="#FF0000"><b>for </b></font>i<font color="#000080">:=</font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font>ySize<font color="#000080">-</font><font color="#800000">1 </font><font color="#FF0000"><b>do begin
  </b></font>r<font color="#000080">:=(</font>i<font color="#000080">-</font><font color="#800000">64</font><font color="#000080">)*</font>pi<font color="#000080">/(</font><font color="#800000">3</font><font color="#000080">*</font>ySize<font color="#000080">);
  </font>tanTab<font color="#000080">[</font>i<font color="#000080">]:=</font>round<font color="#000080">(</font>sin<font color="#000080">(</font>r<font color="#000080">)/</font>cos<font color="#000080">(</font>r<font color="#000080">)*</font><font color="#800000">$7FFF</font><font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
 </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>initMap<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>x<font color="#000080">,</font>y<font color="#000080">:</font>integer<font color="#000080">; </font><font color="#FF0000"><b>begin
 for </b></font>x<font color="#000080">:=</font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font><font color="#800000">127 </font><font color="#FF0000"><b>do
  for </b></font>y<font color="#000080">:=</font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font><font color="#800000">127 </font><font color="#FF0000"><b>do
   </b></font>map<font color="#000080">[</font>x<font color="#000080">,</font>y<font color="#000080">]:=((</font>longint<font color="#000080">(</font>sinTab<font color="#000080">[(</font>y<font color="#000080">*</font><font color="#800000">21</font><font color="#000080">-</font><font color="#800000">12</font><font color="#000080">)</font><font color="#FF0000"><b>and </b></font>angleMask<font color="#000080">])+</font>sinTab<font color="#000080">[(</font>x<font color="#000080">*</font><font color="#800000">31</font><font color="#000080">+</font><font color="#800000">296</font><font color="#000080">)</font><font color="#FF0000"><b>and </b></font>angleMask<font color="#000080">]</font><font color="#FF0000"><b>div </b></font><font color="#800000">2</font><font color="#000080">)</font><font color="#FF0000"><b>shr </b></font><font color="#800000">12</font><font color="#000080">)+</font><font color="#800000">120</font><font color="#000080">;
 </font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>var </b></font>c<font color="#000080">:</font>char<font color="#000080">;
 </font>x<font color="#000080">,</font>y<font color="#000080">,</font>z<font color="#000080">,</font>r<font color="#000080">,</font>a<font color="#000080">:</font>integer<font color="#000080">;
 </font>i<font color="#000080">:</font>word<font color="#000080">;

</font><font color="#FF0000"><b>begin
 asm </b></font><font color="#FF00FF">mov ax,$13; int $10; </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
 </font>initTables<font color="#000080">;
 </font>initMap<font color="#000080">;
 </font>randomize<font color="#000080">;
 </font>x<font color="#000080">:=</font><font color="#800000">50</font><font color="#000080">+</font>random<font color="#000080">(</font><font color="#800000">29</font><font color="#000080">);
 </font>y<font color="#000080">:=</font><font color="#800000">50</font><font color="#000080">+</font>random<font color="#000080">(</font><font color="#800000">29</font><font color="#000080">);
 </font>z<font color="#000080">:=</font><font color="#800000">125</font><font color="#000080">+</font>random<font color="#000080">(</font><font color="#800000">10</font><font color="#000080">);
 </font>r<font color="#000080">:=</font>random<font color="#000080">(</font>angleMask<font color="#000080">);
 </font>a<font color="#000080">:=</font><font color="#800000">64</font><font color="#000080">;
 </font><font color="#FF0000"><b>repeat
  </b></font>drawScene<font color="#000080">(</font>x<font color="#000080">,</font>y<font color="#000080">,</font>z<font color="#000080">,</font>r<font color="#000080">);
  </font>c<font color="#000080">:=</font>upcase<font color="#000080">(</font>readkey<font color="#000080">);
  </font><font color="#FF0000"><b>case </b></font>c <font color="#FF0000"><b>of
   </b></font><font color="#800000">'I'</font><font color="#000080">:</font><font color="#FF0000"><b>if </b></font>tanTab<font color="#000080">[</font>ySize<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">]&lt;</font><font color="#800000">30000 </font><font color="#FF0000"><b>then for </b></font>i<font color="#000080">:=</font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font>ySize<font color="#000080">-</font><font color="#800000">1 </font><font color="#FF0000"><b>do </b></font>inc<font color="#000080">(</font>tanTab<font color="#000080">[</font>i<font color="#000080">],</font><font color="#800000">500</font><font color="#000080">);
   </font><font color="#800000">'K'</font><font color="#000080">:</font><font color="#FF0000"><b>if </b></font>tanTab<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">]&gt;-</font><font color="#800000">30000 </font><font color="#FF0000"><b>then for </b></font>i<font color="#000080">:=</font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font>ySize<font color="#000080">-</font><font color="#800000">1 </font><font color="#FF0000"><b>do </b></font>dec<font color="#000080">(</font>tanTab<font color="#000080">[</font>i<font color="#000080">],</font><font color="#800000">500</font><font color="#000080">);
   </font><font color="#800000">'J'</font><font color="#000080">:</font>r<font color="#000080">:=(</font>r<font color="#000080">-</font><font color="#800000">32</font><font color="#000080">)</font><font color="#FF0000"><b>and </b></font>angleMask<font color="#000080">;
   </font><font color="#800000">'L'</font><font color="#000080">:</font>r<font color="#000080">:=(</font>r<font color="#000080">+</font><font color="#800000">32</font><font color="#000080">)</font><font color="#FF0000"><b>and </b></font>angleMask<font color="#000080">;
   </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>until </b></font>c<font color="#000080">=^[;
 </font>textMode<font color="#000080">(</font>lastMode<font color="#000080">);
 </font><font color="#FF0000"><b>end</b></font><font color="#000080">.

</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to GRAPHICS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0071.PAS">Original</a><b>]</b></p></body>
</html>
