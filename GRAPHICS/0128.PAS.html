<html>
<head><title> "Another Fire Graphic" by ERIC COOLMAN</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to GRAPHICS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0128.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
AC&gt;I got my hands on Jare's fire code and thought it was pretty cool,
AC&gt;so I made my own fire program. Although it didn't turn out like I
AC&gt;thought it would (like Jare's) what I have is (at least I think so)
AC&gt;something that looks more realistic.

This is kinda funny... just the other day I was looking at Jare's fire
code, and did an 80x50 textmode version of it in C.  I did a quick and
dirty conversion of it to Pascal so I could post it here for you
(don't you feel special? &lt;G&gt;).  The pascal version came out a bit
slower then my C version, although they are very similar. I haven't
figured out why though... most times I try this, both come out close
to the same speed.

(********************************************************************
 Fire by Eric Coolman (aka. Digitar/SKP), Simple Minded Software
 Much like Jare's (VangelisTeam) fire, but uses 80x50x16 text mode
 rather than 320x200x256 (which was &quot;tweaked&quot; to look like 80x50
 text mode).  Reference : FIRE.TXT by Phil Carlisle (aka Zoombapup,
 CodeX) from PC Game Programmer's Encyclopedia (PCGPE10.ZIP) by Mark
 Feldman and contributers (thanks for the great reads guys!).
 Compiler : Turbo Pascal 6.0
 Released to public domain, July 30, 1994.

 NOTE: FirePalette will not get loaded if running under DESQview
       with &quot;VIRTUALIZE TEXTMODE&quot; on (which will stop any palette
       manipulation).  To fix, go into setup for the DOSBOX, and
       under &quot;VIRTUALIZE TEXT/GRAPHICS&quot; mode, and set it to &quot;N&quot;.
       Also for DV, set &quot;WRITES DIRECT TO SCREEN&quot; to &quot;Y&quot;es.
********************************************************************)
}

</i></font><font color="#FF0000"><b>Program </b></font>tFire<font color="#000080">;

</font><font color="#FF0000"><b>const
    </b></font>MAXX <font color="#000080">= </font><font color="#800000">80</font><font color="#000080">;
    </font>MAXY <font color="#000080">= </font><font color="#800000">50</font><font color="#000080">;
    </font><font color="#008000"><i>{ Our gradient firepalette (white/yellow/red/orange/slate/black) }
    </i></font>FirePal <font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">3</font><font color="#000080">*</font><font color="#800000">16</font><font color="#000080">-</font><font color="#800000">1</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte <font color="#000080">=
      </font><font color="#008000"><i>{       [ HUES ]       }
      {  RED    GREEN   BLUE }
      {  ===    =====   ==== }
      </i></font><font color="#000080">(                                               </font><font color="#008000"><i>{ Normal Color }
         </i></font><font color="#800000">0</font><font color="#000080">,     </font><font color="#800000">0</font><font color="#000080">,      </font><font color="#800000">0</font><font color="#000080">,                            </font><font color="#008000"><i>{ BLACK        }
         </i></font><font color="#800000">0</font><font color="#000080">,     </font><font color="#800000">5</font><font color="#000080">,      </font><font color="#800000">3</font><font color="#000080">,                            </font><font color="#008000"><i>{ BLUE         }
         </i></font><font color="#800000">0</font><font color="#000080">,     </font><font color="#800000">6</font><font color="#000080">,      </font><font color="#800000">7</font><font color="#000080">,                            </font><font color="#008000"><i>{ GREEN        }
         </i></font><font color="#800000">0</font><font color="#000080">,     </font><font color="#800000">7</font><font color="#000080">,      </font><font color="#800000">9</font><font color="#000080">,                            </font><font color="#008000"><i>{ CYAN         }
         </i></font><font color="#800000">0</font><font color="#000080">,     </font><font color="#800000">8</font><font color="#000080">,      </font><font color="#800000">11</font><font color="#000080">,                           </font><font color="#008000"><i>{ RED          }
         </i></font><font color="#800000">0</font><font color="#000080">,     </font><font color="#800000">9</font><font color="#000080">,      </font><font color="#800000">12</font><font color="#000080">,                           </font><font color="#008000"><i>{ MAGENTA      }
         </i></font><font color="#800000">63</font><font color="#000080">,    </font><font color="#800000">13</font><font color="#000080">,     </font><font color="#800000">0</font><font color="#000080">,                            </font><font color="#008000"><i>{ BROWN        }
         </i></font><font color="#800000">60</font><font color="#000080">,    </font><font color="#800000">4</font><font color="#000080">,      </font><font color="#800000">4</font><font color="#000080">,                            </font><font color="#008000"><i>{ LIGHTGRAY    }
         </i></font><font color="#800000">63</font><font color="#000080">,    </font><font color="#800000">58</font><font color="#000080">,     </font><font color="#800000">21</font><font color="#000080">,                           </font><font color="#008000"><i>{ DARKGRAY     }
         </i></font><font color="#800000">63</font><font color="#000080">,    </font><font color="#800000">59</font><font color="#000080">,     </font><font color="#800000">0</font><font color="#000080">,                            </font><font color="#008000"><i>{ LIGHTBLUE    }
         </i></font><font color="#800000">63</font><font color="#000080">,    </font><font color="#800000">60</font><font color="#000080">,     </font><font color="#800000">0</font><font color="#000080">,                            </font><font color="#008000"><i>{ LIGHTGREEN   }
         </i></font><font color="#800000">63</font><font color="#000080">,    </font><font color="#800000">60</font><font color="#000080">,     </font><font color="#800000">0</font><font color="#000080">,                            </font><font color="#008000"><i>{ LIGHTCYAN    }
         </i></font><font color="#800000">63</font><font color="#000080">,    </font><font color="#800000">61</font><font color="#000080">,     </font><font color="#800000">30</font><font color="#000080">,                           </font><font color="#008000"><i>{ LIGHTRED     }
         </i></font><font color="#800000">63</font><font color="#000080">,    </font><font color="#800000">55</font><font color="#000080">,     </font><font color="#800000">42</font><font color="#000080">,                           </font><font color="#008000"><i>{ LIGHTMAGENTA }
         </i></font><font color="#800000">63</font><font color="#000080">,    </font><font color="#800000">60</font><font color="#000080">,     </font><font color="#800000">55</font><font color="#000080">,                           </font><font color="#008000"><i>{ YELLOW       }
         </i></font><font color="#800000">63</font><font color="#000080">,    </font><font color="#800000">63</font><font color="#000080">,     </font><font color="#800000">63                            </font><font color="#008000"><i>{ WHITE        }
     </i></font><font color="#000080">);

</font><font color="#FF0000"><b>type
     </b></font>ColorArray <font color="#000080">= </font><font color="#FF0000"><b>array </b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font>MAXX<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">, </font><font color="#800000">0</font><font color="#000080">..</font>MAXY<font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Byte<font color="#000080">;
</font><font color="#FF0000"><b>var
    </b></font>FireImage <font color="#000080">: </font>ColorArray<font color="#000080">;
    </font>CUR       <font color="#000080">: </font>Word<font color="#000080">;                                </font><font color="#008000"><i>{ working color }
    </i></font>x<font color="#000080">, </font>y      <font color="#000080">: </font>Byte<font color="#000080">;                             </font><font color="#008000"><i>{ general counters }

(*
 Sets video mode.  If mode is 64d (40h), 8x8 ROM font will be loaded
 and 80x50 textmode will be activated.  Any other value will set
 mode normally.
*)
</i></font><font color="#FF0000"><b>procedure </b></font>VidMode<font color="#000080">(</font>mode <font color="#000080">: </font>byte<font color="#000080">); </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>asm
     </b></font><font color="#FF00FF">cmp  mode, 40h                      </font><font color="#008000"><i>{ (64d) want 80x50/43 mode? }
     </i></font><font color="#FF00FF">jnz  @normalset
     mov  ax,1112h                </font><font color="#008000"><i>{ set 8 point font as current font }
     </i></font><font color="#FF00FF">mov  bl,00h
     jmp  @MakeItSo                                            </font><font color="#008000"><i>{ ;-) }
   </i></font><font color="#FF00FF">@normalset:
     mov  ah, 00h
     mov  al, mode
   @MakeItSo:
     int  10h
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{ grabs and dumps keypress...returns 1 if a key was hit, else 0 }
</i></font><font color="#FF0000"><b>function </b></font>KbGrab <font color="#000080">: </font>boolean<font color="#000080">;
</font><font color="#FF0000"><b>var
    </b></font>WasHit <font color="#000080">: </font>boolean<font color="#000080">;
</font><font color="#FF0000"><b>begin
    </b></font>WasHit <font color="#000080">:= </font>False<font color="#000080">;

    </font><font color="#FF0000"><b>asm
        </b></font><font color="#FF00FF">mov ax, 0100h
        int 16h
        lahf
        test ah, 40h
        jnz @done
        inc WasHit
        mov ax, 0000h                  </font><font color="#008000"><i>{ grab the key they hit .... }
        </i></font><font color="#FF00FF">int 16h
      @done:
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font>KbGrab <font color="#000080">:= </font>WasHit<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>(*********************************************************************
 sets only color indexes normally used in textmode (16 of 'em).
 Note the heavy use of ternary operator there... what that means
 is - indexes 7 to 15 (dark gray to white) are actually indexes
 55 to 63, and index 6 (dark brown) is actually 20d (14h) because
 it uses the secondary hues so that it doesn't look too much like
 red.  The rest (0,1,2,4,5,7) are as expected.
*********************************************************************)
</i></font><font color="#FF0000"><b>procedure </b></font>SetFirePal<font color="#000080">;
</font><font color="#FF0000"><b>var
  </b></font>i<font color="#000080">, </font>j <font color="#000080">: </font>Byte<font color="#000080">;
</font><font color="#FF0000"><b>begin
   for </b></font>i<font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font><font color="#800000">16 </font><font color="#FF0000"><b>do                               </b></font><font color="#008000"><i>{ for each index }
     </i></font><font color="#FF0000"><b>begin
       if </b></font>i <font color="#000080">&lt;= </font><font color="#800000">7 </font><font color="#FF0000"><b>then begin if </b></font>i <font color="#000080">= </font><font color="#800000">6 </font><font color="#FF0000"><b>then </b></font>j <font color="#000080">:= </font><font color="#800000">20 </font><font color="#FF0000"><b>else </b></font>j <font color="#000080">:= </font>i<font color="#000080">; </font><font color="#FF0000"><b>end
       else </b></font>j <font color="#000080">:= </font>i<font color="#000080">+</font><font color="#800000">48</font><font color="#000080">;
       </font>port<font color="#000080">[</font><font color="#800000">$3c8</font><font color="#000080">] := </font>j<font color="#000080">;                             </font><font color="#008000"><i>{ Send the index }
       </i></font>port<font color="#000080">[</font><font color="#800000">$3c9</font><font color="#000080">] := </font>FirePal<font color="#000080">[</font>i<font color="#000080">*</font><font color="#800000">3</font><font color="#000080">];                    </font><font color="#008000"><i>{ Send the red }
       </i></font>port<font color="#000080">[</font><font color="#800000">$3c9</font><font color="#000080">] := </font>FirePal<font color="#000080">[</font>i<font color="#000080">*</font><font color="#800000">3</font><font color="#000080">+</font><font color="#800000">1</font><font color="#000080">];                </font><font color="#008000"><i>{ Send the green }
       </i></font>port<font color="#000080">[</font><font color="#800000">$3c9</font><font color="#000080">] := </font>FirePal<font color="#000080">[</font>i<font color="#000080">*</font><font color="#800000">3</font><font color="#000080">+</font><font color="#800000">2</font><font color="#000080">];                 </font><font color="#008000"><i>{ Send the blue }
    </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#008000"><i>(*********************************************************************
  +----+-----+----+ Table to left are screen ofs's surrounding CUR(0).
  |-81 | -80 |-79 | That we will take average of. 80 is for width of
  +----+-----+----+ screen in chars in textmode (also width of our
  | -1 | CUR | +1 | screen buffer).  The calculated average will be
  +----+-----+----+ assigned to spot '-80' to move the fire upwards,
  |+79 | +80 |+81 | and decremented to fade it out (like a plasma
  +----+-----+----+ effect somewhat).
*********************************************************************)
</i></font><font color="#FF0000"><b>procedure </b></font>DoFire<font color="#000080">;
</font><font color="#FF0000"><b>begin</b></font><font color="#000080">;
    </font><font color="#008000"><i>{ start at [1,1] or above because 0,0 doesn't have 8 surrounding }
    { stop x at 78 or less for the same reason (ending y doesn't     }
    { matter cause we are setting max y randomly anyways).           }
    { (starting y can be set to 8 to give room for a scroller).      }
     </i></font><font color="#FF0000"><b>for </b></font>y <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>MAXY <font color="#FF0000"><b>do
       for </b></font>x <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>MAXX<font color="#000080">-</font><font color="#800000">1 </font><font color="#FF0000"><b>do
         begin
          </b></font><font color="#008000"><i>{ get average of 8 surrounding colors              (-ofs-) }
          </i></font>CUR <font color="#000080">:= (  </font>FireImage<font color="#000080">[</font>x<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">][</font>y<font color="#000080">]         </font><font color="#008000"><i>{ direct to left  (-1) }
                  </i></font><font color="#000080">+ </font>FireImage<font color="#000080">[</font>x<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">][</font>y<font color="#000080">]         </font><font color="#008000"><i>{ direct to right (+1) }
                  </i></font><font color="#000080">+ </font>FireImage<font color="#000080">[</font>x<font color="#000080">][</font>y<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">]         </font><font color="#008000"><i>{ direct above   (-80) }
                  </i></font><font color="#000080">+ </font>FireImage<font color="#000080">[</font>x<font color="#000080">][</font>y<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">]         </font><font color="#008000"><i>{ direct below   (+80) }
                  </i></font><font color="#000080">+ </font>FireImage<font color="#000080">[</font>x<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">][</font>y<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">]       </font><font color="#008000"><i>{ above to left  (-81) }
                  </i></font><font color="#000080">+ </font>FireImage<font color="#000080">[</font>x<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">][</font>y<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">]       </font><font color="#008000"><i>{ below to right (+81) }
                  </i></font><font color="#000080">+ </font>FireImage<font color="#000080">[</font>x<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">][</font>y<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">]       </font><font color="#008000"><i>{ above to right (-79) }
                  </i></font><font color="#000080">+ </font>FireImage<font color="#000080">[</font>x<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">][</font>y<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">]       </font><font color="#008000"><i>{ below to left  (+79) }
                </i></font><font color="#000080">) </font><font color="#FF0000"><b>shr </b></font><font color="#800000">3</font><font color="#000080">;                      </font><font color="#008000"><i>{ divide by 8          }
         </i></font>Dec<font color="#000080">(</font>CUR<font color="#000080">);                            </font><font color="#008000"><i>{ make fire fade out   }
         { notice below is assigning the average CUR to (CUR-1 line) }
         { ... this keeps fire moving in upward direction.           }
         </i></font>FireImage<font color="#000080">[</font>x<font color="#000080">][</font>y<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">] := </font>CUR<font color="#000080">;                       </font><font color="#008000"><i>{ set color }
         </i></font>mem<font color="#000080">[</font><font color="#800000">$b800</font><font color="#000080">:</font>y<font color="#000080">*</font><font color="#800000">160</font><font color="#000080">+(</font>x <font color="#FF0000"><b>shl </b></font><font color="#800000">1</font><font color="#000080">)+</font><font color="#800000">1</font><font color="#000080">] := </font>FireImage<font color="#000080">[</font>x<font color="#000080">][</font>y<font color="#000080">];
       </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

       </font><font color="#008000"><i>{ Randomly set last line of fire... This keeps the fire going }
      </i></font><font color="#FF0000"><b>for </b></font>x <font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font><font color="#800000">80 </font><font color="#FF0000"><b>do
         </b></font>FireImage<font color="#000080">[</font>x<font color="#000080">][</font><font color="#800000">49</font><font color="#000080">] := (</font>random<font color="#000080">(</font><font color="#800000">255</font><font color="#000080">)+</font><font color="#800000">1</font><font color="#000080">);
      </font><font color="#008000"><i>{ second last line also to give fire some more height. }
      </i></font><font color="#FF0000"><b>for </b></font>x <font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font><font color="#800000">80 </font><font color="#FF0000"><b>do
         </b></font>FireImage<font color="#000080">[</font>x<font color="#000080">][</font><font color="#800000">48</font><font color="#000080">] := (</font>random<font color="#000080">(</font><font color="#800000">255</font><font color="#000080">)+</font><font color="#800000">1</font><font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>begin
   </b></font>VidMode<font color="#000080">(</font><font color="#800000">$03</font><font color="#000080">);                     </font><font color="#008000"><i>{ 80x25 mode (to clear screen) }
   </i></font>VidMode<font color="#000080">(</font><font color="#800000">$40</font><font color="#000080">);                                       </font><font color="#008000"><i>{ 80x50 mode }

   </i></font>SetFirePal<font color="#000080">;

  </font><font color="#008000"><i>{ change to hi-intense background so we have 16 bg colors to }
  { work with.                                                 }
  </i></font><font color="#FF0000"><b>asm
      </b></font><font color="#FF00FF">mov ax, 1003h                                 </font><font color="#008000"><i>{ blinking attr }
      </i></font><font color="#FF00FF">mov bx, 0000h            </font><font color="#008000"><i>{ 0=HiIntBackground, 1=Blinking Attr }
      </i></font><font color="#FF00FF">int 10h
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#008000"><i>{ clear fire image }
  </i></font>fillchar<font color="#000080">(</font>FireImage<font color="#000080">, </font>sizeof<font color="#000080">(</font>FireImage<font color="#000080">), </font><font color="#800000">63</font><font color="#000080">);     </font><font color="#008000"><i>{ fill with white }

  </i></font><font color="#FF0000"><b>for </b></font>x <font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font><font color="#800000">80 </font><font color="#FF0000"><b>do          </b></font><font color="#008000"><i>{ set up last line to start the fire }
    </i></font>FireImage<font color="#000080">[</font>x<font color="#000080">][</font><font color="#800000">49</font><font color="#000080">] := (</font>random<font color="#000080">(</font><font color="#800000">255</font><font color="#000080">)+</font><font color="#800000">1</font><font color="#000080">);

  </font><font color="#FF0000"><b>repeat </b></font>DoFire<font color="#000080">; </font><font color="#FF0000"><b>until </b></font>KbGrab<font color="#000080">;

  </font>VidMode<font color="#000080">(</font><font color="#800000">$03</font><font color="#000080">);                                        </font><font color="#008000"><i>{ 80x25 mode }
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to GRAPHICS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0128.PAS">Original</a><b>]</b></p></body>
</html>
