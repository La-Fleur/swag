<html>
<head><title> "Wormhole" by BAS VAN GAALEN</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to GRAPHICS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0159.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{ Turbo Pascal version 7.0 directive settings }
{$a+,b-,d+,e+,f-,g+,i+,l+,n-,o-,p-,q-,r-,s+,t-,v+,x+}

{ if you have a 386 or better 'uncomment' the next line }
{-$define cpu386}

</i></font><font color="#FF0000"><b>program </b></font>wormhole<font color="#000080">;
</font><font color="#008000"><i>{ Asm-version of Wormhole, by Bas van Gaalen, Holland, PD }
</i></font><font color="#FF0000"><b>uses
  </b></font>crt<font color="#000080">;
</font><font color="#FF0000"><b>const
  </b></font>vidseg<font color="#000080">:</font>word<font color="#000080">=</font><font color="#800000">$a000</font><font color="#000080">;
  </font>divd<font color="#000080">=</font><font color="#800000">128</font><font color="#000080">;
  </font>astep<font color="#000080">=</font><font color="#800000">6</font><font color="#000080">;
  </font>xst<font color="#000080">=</font><font color="#800000">4</font><font color="#000080">;
  </font>yst<font color="#000080">=</font><font color="#800000">5</font><font color="#000080">;
</font><font color="#FF0000"><b>var
  </b></font>sintab<font color="#000080">:</font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">449</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>integer<font color="#000080">;
  </font>stab<font color="#000080">,</font>ctab<font color="#000080">:</font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">255</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>integer<font color="#000080">;
  </font>virscr<font color="#000080">:</font>pointer<font color="#000080">;
  </font>virseg<font color="#000080">:</font>word<font color="#000080">;
  </font>lstep<font color="#000080">:</font>byte<font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>setpal<font color="#000080">(</font>col<font color="#000080">,</font>r<font color="#000080">,</font>g<font color="#000080">,</font>b <font color="#000080">: </font>byte<font color="#000080">); </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>asm
  </b></font><font color="#FF00FF">mov dx,03c8h
  mov al,col
  out dx,al
  inc dx
  mov al,r
  out dx,al
  mov al,g
  out dx,al
  mov al,b
  out dx,al
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>drawpolar<font color="#000080">(</font>xo<font color="#000080">,</font>yo<font color="#000080">,</font>r<font color="#000080">,</font>a<font color="#000080">:</font>word<font color="#000080">; </font>c<font color="#000080">:</font>byte<font color="#000080">; </font>lvseg<font color="#000080">:</font>word<font color="#000080">); </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>asm
  </b></font><font color="#FF00FF">mov es,lvseg

  mov bx,a
  add bx,a
  mov cx,word ptr sintab[bx]
  add bx,2*90
  mov ax,word ptr sintab[bx]
  mul r
  mov bx,divd
  xor dx,dx
  cwd
  idiv bx
  add ax,xo
  add ax,160
  cmp ax,320
  ja @out
  mov si,ax

  mov ax,cx
  mul r
  mov bx,divd
  xor dx,dx
  cwd
  idiv bx
  add ax,yo
  add ax,100
  cmp ax,200
  ja @out

  shl ax,6
  mov di,ax
  shl ax,2
  add di,ax
  add di,si
  mov al,c
  mov [es:di],al
 @out:
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>cls<font color="#000080">(</font>lvseg<font color="#000080">:</font>word<font color="#000080">); </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>asm
  </b></font><font color="#FF00FF">mov es,[lvseg]
  xor di,di
  xor ax,ax
</font><font color="#008000"><i>{$ifdef cpu386}
  </i></font><font color="#FF00FF">mov cx,320*200/4
  rep
  db $66; stosw
</font><font color="#008000"><i>{$else}
  </i></font><font color="#FF00FF">mov cx,320*200/2
  rep stosw
</font><font color="#008000"><i>{$endif}
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>flip<font color="#000080">(</font>src<font color="#000080">,</font>dst<font color="#000080">:</font>word<font color="#000080">); </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>asm
  </b></font><font color="#FF00FF">push ds
  mov ax,[dst]
  mov es,ax
  mov ax,[src]
  mov ds,ax
  xor si,si
  xor di,di
</font><font color="#008000"><i>{$ifdef cpu386}
  </i></font><font color="#FF00FF">mov cx,320*200/4
  rep
  db $66; movsw
</font><font color="#008000"><i>{$else}
  </i></font><font color="#FF00FF">mov cx,320*200/2
  rep movsw
</font><font color="#008000"><i>{$endif}
  </i></font><font color="#FF00FF">pop ds
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>retrace<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>asm
  </b></font><font color="#FF00FF">mov dx,03dah
 @vert1:
  in al,dx
  test al,8
  jnz @vert1
 @vert2:
  in al,dx
  test al,8
  jz @vert2
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>var </b></font>x<font color="#000080">,</font>y<font color="#000080">,</font>i<font color="#000080">,</font>j<font color="#000080">:</font>word<font color="#000080">; </font>c<font color="#000080">:</font>byte<font color="#000080">;
</font><font color="#FF0000"><b>begin
  asm </b></font><font color="#FF00FF">mov ax,13h; int 10h; </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>for </b></font>i<font color="#000080">:=</font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font><font color="#800000">255 </font><font color="#FF0000"><b>do begin
    </b></font>ctab<font color="#000080">[</font>i<font color="#000080">]:=</font>round<font color="#000080">(</font>cos<font color="#000080">(</font>pi<font color="#000080">*</font>i<font color="#000080">/</font><font color="#800000">128</font><font color="#000080">)*</font><font color="#800000">60</font><font color="#000080">);
    </font>stab<font color="#000080">[</font>i<font color="#000080">]:=</font>round<font color="#000080">(</font>sin<font color="#000080">(</font>pi<font color="#000080">*</font>i<font color="#000080">/</font><font color="#800000">128</font><font color="#000080">)*</font><font color="#800000">45</font><font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>for </b></font>i<font color="#000080">:=</font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font><font color="#800000">449 </font><font color="#FF0000"><b>do </b></font>sintab<font color="#000080">[</font>i<font color="#000080">]:=</font>round<font color="#000080">(</font>sin<font color="#000080">(</font><font color="#800000">2</font><font color="#000080">*</font>pi<font color="#000080">*</font>i<font color="#000080">/</font><font color="#800000">360</font><font color="#000080">)*</font>divd<font color="#000080">);
  </font>getmem<font color="#000080">(</font>virscr<font color="#000080">,</font><font color="#800000">64000</font><font color="#000080">);
  </font>virseg<font color="#000080">:=</font>seg<font color="#000080">(</font>virscr<font color="#000080">^);
  </font>cls<font color="#000080">(</font>virseg<font color="#000080">);
  </font>x<font color="#000080">:=</font><font color="#800000">30</font><font color="#000080">; </font>y<font color="#000080">:=</font><font color="#800000">90</font><font color="#000080">;
  </font><font color="#FF0000"><b>repeat
    </b></font><font color="#008000"><i>{retrace;}
    </i></font>c<font color="#000080">:=</font><font color="#800000">22</font><font color="#000080">; </font>lstep<font color="#000080">:=</font><font color="#800000">2</font><font color="#000080">; </font>j<font color="#000080">:=</font><font color="#800000">10</font><font color="#000080">;
    </font><font color="#FF0000"><b>while </b></font>j<font color="#000080">&lt;</font><font color="#800000">220 </font><font color="#FF0000"><b>do begin
      </b></font>i<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
      </font><font color="#FF0000"><b>while </b></font>i<font color="#000080">&lt;</font><font color="#800000">360 </font><font color="#FF0000"><b>do begin
        </b></font>drawpolar<font color="#000080">(</font>ctab<font color="#000080">[(</font>x<font color="#000080">+(</font><font color="#800000">200</font><font color="#000080">-</font>j<font color="#000080">)) </font><font color="#FF0000"><b>mod </b></font><font color="#800000">255</font><font color="#000080">],</font>stab<font color="#000080">[(</font>y<font color="#000080">+(</font><font color="#800000">200</font><font color="#000080">-</font>j<font color="#000080">)) </font><font color="#FF0000"><b>mod
</b></font><font color="#800000">255</font><font color="#000080">],</font>j<font color="#000080">,</font>i<font color="#000080">,</font>c<font color="#000080">,</font>virseg<font color="#000080">);
        </font>inc<font color="#000080">(</font>i<font color="#000080">,</font>astep<font color="#000080">);
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font>inc<font color="#000080">(</font>j<font color="#000080">,</font>lstep<font color="#000080">);
      </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>j <font color="#FF0000"><b>mod </b></font><font color="#800000">5</font><font color="#000080">)=</font><font color="#800000">0 </font><font color="#FF0000"><b>then begin </b></font>inc<font color="#000080">(</font>lstep<font color="#000080">); </font>inc<font color="#000080">(</font>c<font color="#000080">); </font><font color="#FF0000"><b>if </b></font>c<font color="#000080">&gt;</font><font color="#800000">31 </font><font color="#FF0000"><b>then </b></font>c<font color="#000080">:=</font><font color="#800000">22</font><font color="#000080">; </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font>x<font color="#000080">:=</font>xst<font color="#000080">+</font>x <font color="#FF0000"><b>mod </b></font><font color="#800000">255</font><font color="#000080">;
    </font>y<font color="#000080">:=</font>yst<font color="#000080">+</font>y <font color="#FF0000"><b>mod </b></font><font color="#800000">255</font><font color="#000080">;
    </font>flip<font color="#000080">(</font>virseg<font color="#000080">,</font>vidseg<font color="#000080">);
    </font>cls<font color="#000080">(</font>virseg<font color="#000080">);
  </font><font color="#FF0000"><b>until </b></font>keypressed<font color="#000080">;
  </font><font color="#FF0000"><b>while </b></font>keypressed <font color="#FF0000"><b>do </b></font>readkey<font color="#000080">;
  </font>freemem<font color="#000080">(</font>virscr<font color="#000080">,</font><font color="#800000">64000</font><font color="#000080">);
  </font>textmode<font color="#000080">(</font>lastmode<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">.

</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to GRAPHICS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0159.PAS">Original</a><b>]</b></p></body>
</html>
