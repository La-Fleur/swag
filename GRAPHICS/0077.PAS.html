<html>
<head><title> "Writing Text in Graphics" by SWAG SUPPORT TEAM</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to GRAPHICS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0077.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>(*
Write a unit, that assigns an text file to the Graphics Screen and then
assign output with this proc, then use rewrite(output) and you can
use write/writeln in Graphics mode as well. Don't forget
Assign(output,'');rewrite(output) or
CrtAssign(output);rewrite(output) when back in Text Mode!
You can even implement read/readln in graphics mode, but this is more
 complicated.
One difference to text mode: use MoveTo instead of GotoXY!

I've neither my unit nor the TP manual available just now,
but it works like this (output only!):
*)
</i></font><font color="#FF0000"><b>unit </b></font>GrpWrite<font color="#000080">;

</font><font color="#FF0000"><b>interface

uses </b></font>Graph<font color="#000080">,</font>Dos<font color="#000080">,</font>BGIFont<font color="#000080">,</font>BGIDriv<font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>GraphAssign<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>F<font color="#000080">:</font>text<font color="#000080">);

</font><font color="#FF0000"><b>implementation
</b></font><font color="#008000"><i>{$R-,S-}

</i></font><font color="#FF0000"><b>var
  </b></font>GraphDriver<font color="#000080">, </font>GraphMode<font color="#000080">, </font>Error <font color="#000080">: </font>integer<font color="#000080">;
  </font>a <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>Abort<font color="#000080">(</font>Msg <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">);
</font><font color="#FF0000"><b>begin
  </b></font>Writeln<font color="#000080">(</font>Msg<font color="#000080">, </font><font color="#800000">': '</font><font color="#000080">, </font>GraphErrorMsg<font color="#000080">(</font>GraphResult<font color="#000080">));
  </font>Halt<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{$F+} {DO NOT FORGET}

</i></font><font color="#FF0000"><b>function </b></font>GraphFlush<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>F<font color="#000080">:</font>TextRec<font color="#000080">):</font>integer<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>GraphFlush <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>GraphClose<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>F<font color="#000080">:</font>TextRec<font color="#000080">):</font>integer<font color="#000080">;
 </font><font color="#FF0000"><b>begin
   </b></font>GraphClose <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
 </font><font color="#FF0000"><b>end</b></font><font color="#000080">;       </font><font color="#008000"><i>{There's nothing to close}


</i></font><font color="#FF0000"><b>function </b></font>GraphWrite<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>F<font color="#000080">:</font>TextRec<font color="#000080">):</font>integer<font color="#000080">;
 </font><font color="#FF0000"><b>var
  </b></font>s <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
  </font>P <font color="#000080">: </font>word<font color="#000080">;
 </font><font color="#FF0000"><b>begin
 with </b></font>F <font color="#FF0000"><b>do
 begin
   </b></font>P <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
   </font><font color="#FF0000"><b>while </b></font>P<font color="#000080">&lt;</font>BufPos <font color="#FF0000"><b>do
   begin
     </b></font>OutText<font color="#000080">(</font>BufPtr<font color="#000080">^[</font>P<font color="#000080">]);
     </font>Inc<font color="#000080">(</font>P<font color="#000080">);
   </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
   </font>BufPos <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
 </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#008000"><i>{               (may need more than one OutText...)}
  (*... {Clear buffer}*)
  </i></font>GraphWrite <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
 </font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>function </b></font>GraphOpen<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>F<font color="#000080">:</font>TextRec<font color="#000080">):</font>integer<font color="#000080">;
 </font><font color="#FF0000"><b>begin
   </b></font><font color="#008000"><i>{ Register all the drivers }
  </i></font><font color="#FF0000"><b>if </b></font>RegisterBGIdriver<font color="#000080">(@</font>CGADriverProc<font color="#000080">) &lt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then
    </b></font>Abort<font color="#000080">(</font><font color="#800000">'CGA'</font><font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font>RegisterBGIdriver<font color="#000080">(@</font>EGAVGADriverProc<font color="#000080">) &lt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then
    </b></font>Abort<font color="#000080">(</font><font color="#800000">'EGA/VGA'</font><font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font>RegisterBGIdriver<font color="#000080">(@</font>HercDriverProc<font color="#000080">) &lt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then
    </b></font>Abort<font color="#000080">(</font><font color="#800000">'Herc'</font><font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font>RegisterBGIdriver<font color="#000080">(@</font>ATTDriverProc<font color="#000080">) &lt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then
    </b></font>Abort<font color="#000080">(</font><font color="#800000">'AT&amp;T'</font><font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font>RegisterBGIdriver<font color="#000080">(@</font>PC3270DriverProc<font color="#000080">) &lt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then
    </b></font>Abort<font color="#000080">(</font><font color="#800000">'PC 3270'</font><font color="#000080">);


  </font><font color="#008000"><i>{ Register all the fonts }
  </i></font><font color="#FF0000"><b>if </b></font>RegisterBGIfont<font color="#000080">(@</font>GothicFontProc<font color="#000080">) &lt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then
    </b></font>Abort<font color="#000080">(</font><font color="#800000">'Gothic'</font><font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font>RegisterBGIfont<font color="#000080">(@</font>SansSerifFontProc<font color="#000080">) &lt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then
    </b></font>Abort<font color="#000080">(</font><font color="#800000">'SansSerif'</font><font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font>RegisterBGIfont<font color="#000080">(@</font>SmallFontProc<font color="#000080">) &lt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then
    </b></font>Abort<font color="#000080">(</font><font color="#800000">'Small'</font><font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font>RegisterBGIfont<font color="#000080">(@</font>TriplexFontProc<font color="#000080">) &lt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then
    </b></font>Abort<font color="#000080">(</font><font color="#800000">'Triplex'</font><font color="#000080">);

  </font>GraphDriver <font color="#000080">:= </font>Detect<font color="#000080">;                  </font><font color="#008000"><i>{ autodetect the hardware }
  </i></font>InitGraph<font color="#000080">(</font>GraphDriver<font color="#000080">, </font>GraphMode<font color="#000080">, </font><font color="#800000">''</font><font color="#000080">);  </font><font color="#008000"><i>{ activate graphics }
  </i></font><font color="#FF0000"><b>if </b></font>GraphResult <font color="#000080">&lt;&gt; </font>grOk <font color="#FF0000"><b>then             </b></font><font color="#008000"><i>{ any errors? }
  </i></font><font color="#FF0000"><b>begin
    </b></font>Writeln<font color="#000080">(</font><font color="#800000">'Graphics init error: '</font><font color="#000080">, </font>GraphErrorMsg<font color="#000080">(</font>GraphDriver<font color="#000080">));
    </font>Halt<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>with </b></font>F <font color="#FF0000"><b>do
  begin
  </b></font>Closefunc<font color="#000080">:=@</font>GraphClose<font color="#000080">;
  </font>InOutFunc<font color="#000080">:=@</font>GraphWrite<font color="#000080">;
  </font>FlushFunc<font color="#000080">:=@</font>GraphFlush<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>GraphOpen <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
</font><font color="#008000"><i>(*  ... {Initialisations, see your TP manual}*)
 </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#008000"><i>{$F-}
</i></font><font color="#FF0000"><b>procedure </b></font>GraphAssign<font color="#000080">;
 </font><font color="#FF0000"><b>begin
  with </b></font>TextRec<font color="#000080">(</font>F<font color="#000080">) </font><font color="#FF0000"><b>do
   begin
     </b></font>Mode <font color="#000080">:= </font>fmClosed<font color="#000080">;
     </font>BufSize <font color="#000080">:= </font>SizeOf<font color="#000080">(</font>Buffer<font color="#000080">);
     </font>BufPtr <font color="#000080">:= @</font>Buffer<font color="#000080">;
     </font>Name<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">] := </font><font color="#800000">#0</font><font color="#000080">;
     </font>OpenFunc<font color="#000080">:= @</font>GraphOpen<font color="#000080">;
    </font><font color="#008000"><i>{You can make some initialisations already here}
   </i></font><font color="#FF0000"><b>end
 end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">.
=================</font>WRTGRTST<font color="#000080">.</font>PAS follows<font color="#000080">==================
</font><font color="#008000"><i>{$A+,B-,D+,E+,F-,G-,I+,L+,N-,O-,P-,Q-,R-,S+,T-,V+,X+,Y+}
{$M 16384,0,655360}
</i></font><font color="#FF0000"><b>uses </b></font>Crt<font color="#000080">,
     </font>Graph<font color="#000080">,     </font><font color="#008000"><i>{ library of graphics routines }
     </i></font>GrWrite<font color="#000080">;
</font><font color="#FF0000"><b>var
  </b></font>GraphDriver<font color="#000080">, </font>GraphMode<font color="#000080">, </font>Error <font color="#000080">: </font>integer<font color="#000080">;
  </font>a <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
  </font>GrOutput<font color="#000080">:</font>Text<font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>Abort<font color="#000080">(</font>Msg <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">);
</font><font color="#FF0000"><b>begin
  </b></font>Writeln<font color="#000080">(</font>Msg<font color="#000080">, </font><font color="#800000">': '</font><font color="#000080">, </font>GraphErrorMsg<font color="#000080">(</font>GraphResult<font color="#000080">));
  </font>Halt<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>begin
 </b></font>GraphAssign<font color="#000080">(</font>Output<font color="#000080">);  </font><font color="#008000"><i>{Standard output to graphics screen}
 {$I-}
 </i></font>rewrite<font color="#000080">(</font>Output<font color="#000080">); </font><font color="#008000"><i>{actually calls GraphOpen}
  {$I+}
 </i></font><font color="#FF0000"><b>if </b></font>IoResult <font color="#000080">&lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>halt<font color="#000080">;

</font><font color="#008000"><i>(* ....*)
 </i></font>MoveTo<font color="#000080">(</font><font color="#800000">65</font><font color="#000080">,</font><font color="#800000">90</font><font color="#000080">);
 </font>a <font color="#000080">:= </font><font color="#800000">'this is a string'</font><font color="#000080">;
 </font>write<font color="#000080">(</font><font color="#800000">'this is an embedded string'</font><font color="#000080">);   </font><font color="#008000"><i>{write to graphics screen}
 </i></font>MoveTo<font color="#000080">(</font><font color="#800000">65</font><font color="#000080">,</font><font color="#800000">120</font><font color="#000080">);
 </font>write<font color="#000080">(</font><font color="#800000">' and this is the second'</font><font color="#000080">);
 </font>Close<font color="#000080">(</font>Output<font color="#000080">); </font><font color="#008000"><i>{nothing shows on the screen until this is executed}
 </i></font>ReadLn<font color="#000080">(</font>a<font color="#000080">);
 </font>CloseGraph<font color="#000080">;
 </font><font color="#008000"><i>{Standard output to text screen}
 </i></font>Assign<font color="#000080">(</font>output<font color="#000080">,</font><font color="#800000">''</font><font color="#000080">);
 </font>rewrite<font color="#000080">(</font>output<font color="#000080">);
 </font>GotoXY<font color="#000080">(</font><font color="#800000">5</font><font color="#000080">,</font><font color="#800000">20</font><font color="#000080">); </font><font color="#008000"><i>{THIS WORKS}
 </i></font>write<font color="#000080">(</font>a<font color="#000080">);</font><font color="#008000"><i>{nothing happens here}             {write to textscreen}
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">.

</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to GRAPHICS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0077.PAS">Original</a><b>]</b></p></body>
</html>
