<html>
<head><title> "GIF DECODER" by ARNE DE BRUIJN</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to GRAPHICS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0201.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code>
<font color="#008000"><i>{Well, I've also written (rewritten from something in SWAG) a GIF decoder, but
converted it to ASM, so it's quite fast :-)I know GIF should be ignored, but I
wanted to write an asm version, after understanding the LZW algorithm, to see
how fast it could be (however it isn't much optimized). }

</i></font><font color="#000080">=== </font>UNGIF<font color="#000080">.</font>PAS
<font color="#008000"><i>{ Decode a standard 320x200, non interlaced, no local color map GIF }
{ Arne de Bruijn, 1995, PD }
{$G+}
</i></font><font color="#FF0000"><b>const </b></font>MaxBufSize<font color="#000080">=</font><font color="#800000">32768</font><font color="#000080">;
</font><font color="#FF0000"><b>var
 </b></font>H<font color="#000080">:</font><font color="#FF0000"><b>file</b></font><font color="#000080">;
 </font>BufPtr<font color="#000080">,</font>CPtr<font color="#000080">:</font>pointer<font color="#000080">; </font>BufEnd<font color="#000080">:</font>word<font color="#000080">; </font><font color="#008000"><i>{ Read data pointers }
 </i></font>WasLastBlock<font color="#000080">:</font>boolean<font color="#000080">;
 </font>MYBuf<font color="#000080">,</font>MBPtr<font color="#000080">:</font>pointer<font color="#000080">; </font>MBEnd<font color="#000080">:</font>word<font color="#000080">;  </font><font color="#008000"><i>{ Unblocked data pointers }

</i></font><font color="#FF0000"><b>procedure </b></font>ReadBuf<font color="#000080">;
</font><font color="#008000"><i>{ Read from file into BufPtr and set CPtr the begin buffer, and BufEnd to end
}</i></font><font color="#FF0000"><b>var
 </b></font>BufSize<font color="#000080">:</font>word<font color="#000080">;
</font><font color="#FF0000"><b>begin
 </b></font>CPtr<font color="#000080">:=</font>BufPtr<font color="#000080">;
 </font>BlockRead<font color="#000080">(</font>H<font color="#000080">,</font>BufPtr<font color="#000080">^,</font>MaxBufSize<font color="#000080">,</font>BufSize<font color="#000080">);
 </font>BufEnd<font color="#000080">:=</font>word<font color="#000080">(</font>BufPtr<font color="#000080">)+</font>BufSize<font color="#000080">;
 </font>WasLastBlock<font color="#000080">:=</font>BufSize<font color="#000080">&lt;</font>MaxBufSize<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>UnBlock<font color="#000080">;
</font><font color="#008000"><i>{ Convert &lt;1 byte blocklen&gt; &lt;block&gt; stream in CPtr-BufEnd to }
{ 'normal' stream in MyBuf }
</i></font><font color="#FF0000"><b>const
 </b></font>InBlockLast<font color="#000080">:</font>byte<font color="#000080">=</font><font color="#800000">0</font><font color="#000080">;
</font><font color="#FF0000"><b>var
 </b></font>InBlock<font color="#000080">:</font>word<font color="#000080">;
</font><font color="#FF0000"><b>begin
 </b></font>InBlock<font color="#000080">:=</font>InBlockLast<font color="#000080">;
 </font>InBlockLast<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
 </font>MBPtr<font color="#000080">:=</font>MyBuf<font color="#000080">;
 </font><font color="#FF0000"><b>repeat
  if </b></font>word<font color="#000080">(</font>CPtr<font color="#000080">)+</font>InBlock<font color="#000080">&gt;</font>BufEnd <font color="#FF0000"><b>then
   begin
    </b></font>InBlockLast<font color="#000080">:=</font>InBlock<font color="#000080">;
    </font>InBlock<font color="#000080">:=</font>BufEnd<font color="#000080">-</font>word<font color="#000080">(</font>CPtr<font color="#000080">);
    </font>Dec<font color="#000080">(</font>InBlockLast<font color="#000080">,</font>InBlock<font color="#000080">);
   </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>Move<font color="#000080">(</font>CPtr<font color="#000080">^,</font>MBPtr<font color="#000080">^,</font>InBlock<font color="#000080">);
  </font>Inc<font color="#000080">(</font>word<font color="#000080">(</font>CPtr<font color="#000080">),</font>InBlock<font color="#000080">); </font>Inc<font color="#000080">(</font>word<font color="#000080">(</font>MBPtr<font color="#000080">),</font>InBlock<font color="#000080">);
  </font>InBlock<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font>word<font color="#000080">(</font>CPtr<font color="#000080">)&lt;</font>BufEnd <font color="#FF0000"><b>then
   begin
    </b></font>InBlock<font color="#000080">:=</font>byte<font color="#000080">(</font>CPtr<font color="#000080">^); </font>Inc<font color="#000080">(</font>word<font color="#000080">(</font>CPtr<font color="#000080">));
   </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
 </font><font color="#FF0000"><b>until </b></font><font color="#000080">(</font>InBlock<font color="#000080">=</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>word<font color="#000080">(</font>CPtr<font color="#000080">)=</font>BufEnd<font color="#000080">);
 </font>MBEnd<font color="#000080">:=</font>word<font color="#000080">(</font>MBPtr<font color="#000080">);
 </font>MBPtr<font color="#000080">:=</font>MyBuf<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>DecodeGIF<font color="#000080">(</font>XOff<font color="#000080">,</font>YOff<font color="#000080">,</font>XLen<font color="#000080">,</font>YLen<font color="#000080">:</font>word<font color="#000080">; </font>IBits<font color="#000080">:</font>byte<font color="#000080">);
</font><font color="#008000"><i>{ XOff,YOff,XLen,YLen ignored }
</i></font><font color="#FF0000"><b>var
 </b></font>MaxCode<font color="#000080">,</font>OldCode<font color="#000080">,</font>FirstItem<font color="#000080">,</font>FreeItem<font color="#000080">,</font>InCode<font color="#000080">,</font>LastCode<font color="#000080">:</font>word<font color="#000080">;
 </font>StartCodeSize<font color="#000080">,</font>CodeSize<font color="#000080">:</font>byte<font color="#000080">;
 </font>PixelBuf<font color="#000080">:</font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">1023</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">;
 </font>HashVal<font color="#000080">:</font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">4095</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">;
 </font>HashPrev<font color="#000080">:</font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">4095</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>word<font color="#000080">;
 </font>VioP<font color="#000080">:</font>pointer<font color="#000080">;
 </font>MBitMask<font color="#000080">:</font>byte<font color="#000080">; </font>MMBPtr<font color="#000080">:</font>pointer<font color="#000080">; </font>MMBEnd<font color="#000080">:</font>word<font color="#000080">;
 </font>L<font color="#000080">:</font>longint<font color="#000080">;
</font><font color="#FF0000"><b>begin
 </b></font>StartCodeSize<font color="#000080">:=</font>byte<font color="#000080">(</font>CPtr<font color="#000080">^); </font>Inc<font color="#000080">(</font>word<font color="#000080">(</font>CPtr<font color="#000080">));
 </font>FirstItem<font color="#000080">:=</font><font color="#800000">1 </font><font color="#FF0000"><b>shl </b></font>StartCodeSize<font color="#000080">; </font>Inc<font color="#000080">(</font>StartCodeSize<font color="#000080">);
 </font>GetMem<font color="#000080">(</font>MyBuf<font color="#000080">,</font>MaxBufSize<font color="#000080">); </font>UnBlock<font color="#000080">;
 </font><font color="#008000"><i>{ Copy vars to local vars, so they can be accessed if ds is modified }
 </i></font>LastCode<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">; </font>VioP<font color="#000080">:=</font>ptr<font color="#000080">(</font><font color="#800000">$a000</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">); </font>MBitMask<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">; </font>MMBPtr<font color="#000080">:=</font>MBPtr<font color="#000080">; </font>MMBEnd<font color="#000080">:=</font>MBEnd<font color="#000080">;
 </font><font color="#FF0000"><b>asm
  </b></font><font color="#FF00FF">push ds
  push ss; pop es;
 @DoClr:
  mov cl,StartCodeSize   </font><font color="#008000"><i>{ Initialize vars }
  </i></font><font color="#FF00FF">mov [CodeSize],cl; mov ax,1; shl ax,cl; mov [MaxCode],ax
  mov ax,[FirstItem]; add ax,2; mov [FreeItem],ax
  mov [OldCode],-1
 @LoopIt:                </font><font color="#008000"><i>{ Start loop }
  </i></font><font color="#FF00FF">lds si,MMBPtr
  lea di,PixelBuf
  mov ax,[si]; mov dx,[si+2]
 @ReLdCont:
  mov cl,[MBitMask]      </font><font color="#008000"><i>{ Get CodeSize bits }
  </i></font><font color="#FF00FF">mov bx,-1; shr bx,cl; shr ax,cl; not bx
  ror dx,cl; mov ch,CodeSize
  and bx,dx; or ax,bx
  xor bx,bx; add cl,ch; mov bl,cl; and cl,7; shr bx,3; add si,bx
  cmp si,[MMBEnd]; jae @Reload   </font><font color="#008000"><i>{ Buffer empty? Yes -&gt; Reload }
  </i></font><font color="#FF00FF">mov word ptr [MMBPtr],si; mov [MBitMask],cl
  mov cl,ch; mov bx,1; shl bx,cl; dec bx; and ax,bx
  mov cx,[FirstItem]     </font><font color="#008000"><i>{ Is it a clear code }
  </i></font><font color="#FF00FF">sub cx,ax; je @DoClr   </font><font color="#008000"><i>{ Yes -&gt; Initialize vars }
  </i></font><font color="#FF00FF">inc cx; je @</font><font color="#FF0000"><b>End        </b></font><font color="#008000"><i>{ Is it an end code (=clear code +1) ?  Yes -&gt; End}
  </i></font>mov <font color="#000080">[</font>InCode<font color="#000080">],</font>ax
  cmp ax<font color="#000080">,[</font>FreeItem<font color="#000080">]      </font><font color="#008000"><i>{ Is it an unknown code ? }
  </i></font>jb <font color="#000080">@</font>Known
  mov ax<font color="#000080">,[</font>OldCode<font color="#000080">]       </font><font color="#008000"><i>{ Append last code to output, and use prev code }
  </i></font>mov cl<font color="#000080">,</font>byte ptr <font color="#000080">[</font>LastCode<font color="#000080">]
  </font>mov es<font color="#000080">:[</font>di<font color="#000080">],</font>cl<font color="#000080">; </font>inc di
 <font color="#000080">@</font>Known<font color="#000080">:
  </font>mov si<font color="#000080">,</font>ax
 <font color="#000080">@</font>ScanCode<font color="#000080">:              </font><font color="#008000"><i>{ Scan through codes loop }
  </i></font>cmp si<font color="#000080">,[</font>FirstItem<font color="#000080">]     </font><font color="#008000"><i>{ Is it a normal code? (= 1 output byte) }
  </i></font>jb <font color="#000080">@</font>EndPut             <font color="#008000"><i>{ Yes -&gt; end loop }
  </i></font>cmp si<font color="#000080">,[</font>FreeItem<font color="#000080">]      </font><font color="#008000"><i>{ Is it an unknown code? }
  </i></font>jae <font color="#000080">@</font>Abort             <font color="#008000"><i>{ Yes -&gt; abort }
  </i></font>mov al<font color="#000080">,</font>byte ptr <font color="#000080">[</font>HashVal<font color="#000080">+</font>si<font color="#000080">]
  </font>mov es<font color="#000080">:[</font>di<font color="#000080">],</font>al<font color="#000080">; </font>inc di
  <font color="#FF0000"><b>shl </b></font>si<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">; </font>mov si<font color="#000080">,</font>word ptr <font color="#000080">[</font>HashPrev<font color="#000080">+</font>si<font color="#000080">]
  </font>jmp <font color="#000080">@</font>ScanCode
 <font color="#000080">@</font>EndPut<font color="#000080">:
  </font>mov ax<font color="#000080">,</font>si<font color="#000080">; </font>mov <font color="#000080">[</font>LastCode<font color="#000080">],</font>ax
  mov es<font color="#000080">:[</font>di<font color="#000080">],</font>al<font color="#000080">; </font>inc di
  cmp byte ptr <font color="#000080">[</font>OldCode<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">],</font><font color="#800000">255</font><font color="#000080">; </font>je <font color="#000080">@</font>SkipStore
  mov si<font color="#000080">,[</font>FreeItem<font color="#000080">];
  </font>cmp si<font color="#000080">,</font><font color="#800000">4095</font><font color="#000080">; </font>ja <font color="#000080">@</font>SkipStore
  mov byte ptr <font color="#000080">[</font>HashVal<font color="#000080">+</font>si<font color="#000080">],</font>al
  mov ax<font color="#000080">,[</font>OldCode<font color="#000080">]
  </font>mov bx<font color="#000080">,</font>si<font color="#000080">; </font><font color="#FF0000"><b>shl </b></font>si<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">; </font>mov word ptr <font color="#000080">[</font>HashPrev<font color="#000080">+</font>si<font color="#000080">],</font>ax
  inc bx<font color="#000080">; </font>mov <font color="#000080">[</font>FreeItem<font color="#000080">],</font>bx
 <font color="#000080">@</font>SkipStore<font color="#000080">:             </font><font color="#008000"><i>{ Check if codesize must be incremented }
  </i></font>cmp bx<font color="#000080">,[</font>MaxCode<font color="#000080">]; </font>jb <font color="#000080">@</font>NoNewCode
  cmp <font color="#000080">[</font>CodeSize<font color="#000080">],</font><font color="#800000">12</font><font color="#000080">; </font>jae <font color="#000080">@</font>NoNewCode
  inc <font color="#000080">[</font>CodeSize<font color="#000080">]; </font><font color="#FF0000"><b>shl </b></font><font color="#000080">[</font>MaxCode<font color="#000080">],</font><font color="#800000">1
 </font><font color="#000080">@</font>NoNewCode<font color="#000080">:
  </font>mov ax<font color="#000080">,[</font>InCode<font color="#000080">]; </font>mov <font color="#000080">[</font>OldCode<font color="#000080">],</font>ax
  lea cx<font color="#000080">,</font>PixelBuf        <font color="#008000"><i>{ Write stored output to screen }
  </i></font>neg cx<font color="#000080">; </font>add cx<font color="#000080">,</font>di
  lds si<font color="#000080">,</font>VioP
 <font color="#000080">@</font>PutIt<font color="#000080">:
  </font>dec di                 <font color="#008000"><i>{ Output stored reversed }
  </i></font>mov al<font color="#000080">,</font>es<font color="#000080">:[</font>di<font color="#000080">]; </font>mov <font color="#000080">[</font>si<font color="#000080">],</font>al
  inc si<font color="#000080">; </font>dec cx
  jnz <font color="#000080">@</font>PutIt
  mov word ptr <font color="#000080">[</font>VioP<font color="#000080">],</font>si
  jmp <font color="#000080">@</font>LoopIt
 <font color="#000080">@</font>Abort<font color="#000080">:                 </font><font color="#008000"><i>{ Labels here to allow short jumps }
 </i></font><font color="#000080">@</font><font color="#FF0000"><b>End</b></font><font color="#000080">:
  </font>jmp <font color="#000080">@</font>REnd
 <font color="#000080">@</font>Reload<font color="#000080">:
  </font>mov si<font color="#000080">,</font>word ptr <font color="#000080">[</font>MMBPtr<font color="#000080">]; </font>mov bx<font color="#000080">,[</font>MMBEnd<font color="#000080">]; </font>sub bx<font color="#000080">,</font>si
  mov ax<font color="#000080">,[</font>si<font color="#000080">]; </font>add si<font color="#000080">,</font><font color="#800000">2
  </font>mov word ptr <font color="#000080">[</font>L<font color="#000080">],</font>ax    <font color="#008000"><i>{ Save last 4 bytes of buffer }
  </i></font>mov ax<font color="#000080">,[</font>si<font color="#000080">]; </font>mov word ptr <font color="#000080">[</font>L<font color="#000080">+</font><font color="#800000">2</font><font color="#000080">],</font>ax
  pop ds
  cmp <font color="#000080">[</font>WasLastBlock<font color="#000080">],</font><font color="#800000">0   </font><font color="#008000"><i>{ Already at eof? }
  </i></font>jne <font color="#000080">@</font>AbortNoPop        <font color="#008000"><i>{ Yes -&gt; Abort }
  </i></font>push bx
  call ReadBuf
  call Unblock
  mov ax<font color="#000080">,[</font>MBEnd<font color="#000080">]; </font>mov <font color="#000080">[</font>MMBEnd<font color="#000080">],</font>ax
  mov si<font color="#000080">,</font>word ptr <font color="#000080">[</font>MBPtr<font color="#000080">]
  </font>pop bx
  push ds
  mov ds<font color="#000080">,</font>word ptr <font color="#000080">[</font>MMBPtr<font color="#000080">+</font><font color="#800000">2</font><font color="#000080">]
  </font>push ss<font color="#000080">; </font>pop es        <font color="#008000"><i>{ Overwrite temp buf (L) with new values }
  </i></font>lea di<font color="#000080">,</font>L               <font color="#008000"><i>{ at the right place }
  </i></font>add di<font color="#000080">,</font>bx<font color="#000080">; </font>mov ax<font color="#000080">,</font>si<font color="#000080">; </font>sub ax<font color="#000080">,</font>bx<font color="#000080">; </font>mov cx<font color="#000080">,</font><font color="#800000">4</font><font color="#000080">; </font>sub cx<font color="#000080">,</font>bx
  cld<font color="#000080">;  </font>rep movsb
  mov si<font color="#000080">,</font>ax              <font color="#008000"><i>{ Initialize vars for @ReLDCont }
  </i></font>lea di<font color="#000080">,</font>PixelBuf
  mov ax<font color="#000080">,</font>word ptr <font color="#000080">[</font>L<font color="#000080">]; </font>mov dx<font color="#000080">,</font>word ptr <font color="#000080">[</font>L<font color="#000080">+</font><font color="#800000">2</font><font color="#000080">]
  </font>jmp <font color="#000080">@</font>ReLDCont
 <font color="#000080">@</font>REnd<font color="#000080">:
  </font>pop ds
 <font color="#000080">@</font>AbortNoPop<font color="#000080">:
 </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
 </font>FreeMem<font color="#000080">(</font>MyBuf<font color="#000080">,</font>MaxBufSize<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>type
 </b></font>TGifID<font color="#000080">=</font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">5</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>char<font color="#000080">;
 </font>TGifScrDesc<font color="#000080">=</font><font color="#FF0000"><b>record </b></font>ScrWidth<font color="#000080">,</font>ScrHeight<font color="#000080">:</font>word<font color="#000080">; </font>Misc<font color="#000080">,</font>Background<font color="#000080">,</font>Zero<font color="#000080">:</font>byte<font color="#000080">; </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>const </b></font>GifID<font color="#000080">:</font>TGifID<font color="#000080">=</font><font color="#800000">'GIF87a'</font><font color="#000080">;
</font><font color="#FF0000"><b>var
 </b></font>IBits<font color="#000080">,</font>I<font color="#000080">,</font>Misc<font color="#000080">:</font>byte<font color="#000080">;
 </font>IWidth<font color="#000080">,</font>IHeight<font color="#000080">,</font>IColors<font color="#000080">:</font>word<font color="#000080">; </font>XOff<font color="#000080">,</font>YOff<font color="#000080">,</font>XLen<font color="#000080">,</font>YLen<font color="#000080">:</font>word<font color="#000080">;
 </font>GifPal<font color="#000080">:</font>pointer<font color="#000080">;
</font><font color="#FF0000"><b>begin
 if </b></font>ParamCount<font color="#000080">=</font><font color="#800000">0 </font><font color="#FF0000"><b>then begin </b></font>WriteLn<font color="#000080">(</font><font color="#800000">'Specify filename!'</font><font color="#000080">); </font>Halt<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">); </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
 </font>assign<font color="#000080">(</font>H<font color="#000080">,</font>ParamStr<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">)); </font>reset<font color="#000080">(</font>H<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">);
 </font><font color="#FF0000"><b>if </b></font>IOResult<font color="#000080">&lt;&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>then begin </b></font>WriteLn<font color="#000080">(</font><font color="#800000">'Open error'</font><font color="#000080">); </font>Halt<font color="#000080">; </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
 </font>GetMem<font color="#000080">(</font>BufPtr<font color="#000080">,</font>MaxBufSize<font color="#000080">); </font>ReadBuf<font color="#000080">;
 </font><font color="#FF0000"><b>if </b></font>TGifID<font color="#000080">(</font>BufPtr<font color="#000080">^)&lt;&gt;</font>GifID <font color="#FF0000"><b>then begin </b></font>WriteLn<font color="#000080">(</font><font color="#800000">'Bad image!'</font><font color="#000080">); </font>Halt<font color="#000080">; </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
 </font>Inc<font color="#000080">(</font>word<font color="#000080">(</font>CPtr<font color="#000080">),</font>SizeOf<font color="#000080">(</font>TGifID<font color="#000080">));
 </font>IWidth<font color="#000080">:=</font>TGifScrDesc<font color="#000080">(</font>CPtr<font color="#000080">^).</font>ScrWidth<font color="#000080">; </font>IHeight<font color="#000080">:=</font>TGifScrDesc<font color="#000080">(</font>CPtr<font color="#000080">^).</font>ScrHeight<font color="#000080">;
 </font>IBits<font color="#000080">:=</font>TGifScrDesc<font color="#000080">(</font>CPtr<font color="#000080">^).</font>Misc <font color="#FF0000"><b>and </b></font><font color="#800000">7</font><font color="#000080">+</font><font color="#800000">1</font><font color="#000080">; </font>IColors<font color="#000080">:=</font><font color="#800000">1 </font><font color="#FF0000"><b>shl </b></font>IBits<font color="#000080">;
 </font>IWidth<font color="#000080">:=</font>TGifScrDesc<font color="#000080">(</font>CPtr<font color="#000080">^).</font>ScrWidth<font color="#000080">;
 </font><font color="#FF0000"><b>if </b></font>TGifScrDesc<font color="#000080">(</font>CPtr<font color="#000080">^).</font>Misc <font color="#FF0000"><b>and </b></font><font color="#800000">128</font><font color="#000080">&lt;&gt;</font><font color="#800000">128 </font><font color="#FF0000"><b>then
  begin </b></font>WriteLn<font color="#000080">(</font><font color="#800000">'No GCT in GIF!'</font><font color="#000080">); </font>Halt<font color="#000080">; </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
 </font>Inc<font color="#000080">(</font>word<font color="#000080">(</font>CPtr<font color="#000080">),</font>SizeOf<font color="#000080">(</font>TGifScrDesc<font color="#000080">));
 </font><font color="#FF0000"><b>asm
  </b></font><font color="#FF00FF">mov ax,13h; int 10h  </font><font color="#008000"><i>{ Enter graphics mode }
  </i></font><font color="#FF00FF">cld                  
  push ds
  mov ax,IColors; mov cx,ax; add ax,ax; add cx,ax  </font><font color="#008000"><i>{ cx:=IColors*3 }
  </i></font><font color="#FF00FF">lds si,CPtr
  mov dx,3c8h; xor al,al; out dx,al; inc dx        </font><font color="#008000"><i>{ Set port, start color }
 </i></font><font color="#FF00FF">@AdjCol: lodsb; shr al,2; out dx,al; loop @AdjCol </font><font color="#008000"><i>{ Set palette }
  </i></font><font color="#FF00FF">pop ds
 </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
 </font>Inc<font color="#000080">(</font>word<font color="#000080">(</font>CPtr<font color="#000080">),</font>IColors<font color="#000080">*</font><font color="#800000">3</font><font color="#000080">);
 </font><font color="#FF0000"><b>repeat
  </b></font>I<font color="#000080">:=</font>byte<font color="#000080">(</font>CPtr<font color="#000080">^); </font>Inc<font color="#000080">(</font>word<font color="#000080">(</font>CPtr<font color="#000080">));
  </font><font color="#FF0000"><b>if </b></font>I<font color="#000080">=</font><font color="#800000">44 </font><font color="#FF0000"><b>then begin
    </b></font>XOff<font color="#000080">:=</font>word<font color="#000080">(</font>CPtr<font color="#000080">^);</font>Inc<font color="#000080">(</font>word<font color="#000080">(</font>CPtr<font color="#000080">),</font><font color="#800000">2</font><font color="#000080">); </font>YOff<font color="#000080">:=</font>word<font color="#000080">(</font>CPtr<font color="#000080">^);</font>Inc<font color="#000080">(</font>word<font color="#000080">(</font>CPtr<font color="#000080">),</font><font color="#800000">2</font><font color="#000080">);
    </font>XLen<font color="#000080">:=</font>word<font color="#000080">(</font>CPtr<font color="#000080">^);</font>Inc<font color="#000080">(</font>word<font color="#000080">(</font>CPtr<font color="#000080">),</font><font color="#800000">2</font><font color="#000080">); </font>YLen<font color="#000080">:=</font>word<font color="#000080">(</font>CPtr<font color="#000080">^);</font>Inc<font color="#000080">(</font>word<font color="#000080">(</font>CPtr<font color="#000080">),</font><font color="#800000">2</font><font color="#000080">);
    </font>Misc<font color="#000080">:=</font>byte<font color="#000080">(</font>CPtr<font color="#000080">^);</font>Inc<font color="#000080">(</font>word<font color="#000080">(</font>CPtr<font color="#000080">),</font><font color="#800000">1</font><font color="#000080">);
    </font>DecodeGIF<font color="#000080">(</font>XOff<font color="#000080">,</font>YOff<font color="#000080">,</font>XLen<font color="#000080">,</font>YLen<font color="#000080">,</font>IBits<font color="#000080">);
   </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
 </font><font color="#FF0000"><b>until </b></font><font color="#000080">(</font>I<font color="#000080">&lt;&gt;</font><font color="#800000">44</font><font color="#000080">) </font><font color="#FF0000"><b>or </b></font><font color="#000080">(</font>word<font color="#000080">(</font>CPtr<font color="#000080">)&gt;=</font>BufEnd<font color="#000080">);
 </font>Close<font color="#000080">(</font>H<font color="#000080">);
 </font>FreeMem<font color="#000080">(</font>BufPtr<font color="#000080">,</font>MaxBufSize<font color="#000080">);
 </font><font color="#FF0000"><b>asm </b></font><font color="#FF00FF">mov ah,0; int 16h; </font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{ Wait for key }
 </i></font><font color="#FF0000"><b>asm </b></font><font color="#FF00FF">mov ax,3; int 10h; </font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{ Set text mode }
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to GRAPHICS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0201.PAS">Original</a><b>]</b></p></body>
</html>
