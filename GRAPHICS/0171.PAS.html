<html>
<head><title> "BMP File Format" by KRIS VANDERMOTTEN</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to GRAPHICS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0171.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
&gt; Who has information on the BMP format?

I do :-)
}

</i></font><font color="#FF0000"><b>Unit </b></font>BGIDrv<font color="#000080">;
</font><font color="#008000"><i>{ Mee linken van grafische drivers in een applicatie }
</i></font><font color="#FF0000"><b>interface
implementation
Uses </b></font>Graph<font color="#000080">;
</font><font color="#FF0000"><b>procedure </b></font>EgaVgaDriverProc<font color="#000080">; </font><font color="#FF0000"><b>external</b></font><font color="#000080">;
</font><font color="#008000"><i>{$L EGAVGA.OBJ }
</i></font><font color="#FF0000"><b>Begin
 </b></font><font color="#008000"><i>{ This links in the EGA and VGA drivers }
 </i></font>RegisterBGIdriver<font color="#000080">(@</font>EGAVGADriverProc<font color="#000080">);
</font><font color="#FF0000"><b>End</b></font><font color="#000080">.

</font><font color="#FF0000"><b>Unit </b></font>bmp<font color="#000080">;         </font><font color="#008000"><i>{ V 1.02}
{ changes :
  V 1.00 : - initial implementation
  V 1.01 : - graphics must be opened and closed by the calling application
           - BGI Drivers now linked in by a seperate unit 'BGIDrv'
           - a few small optimizations
  V 1.02 : - major bug fixed
           - text output now uses OutText (not Writeln)
}

{$ifdef DEBUG} {$D+,R+,S+,Q+,I+}
{$else} {$R-,S-,Q-,I-,B-} {$endif}
</i></font><font color="#FF0000"><b>interface

Procedure </b></font>BMPDisplay<font color="#000080">(</font><font color="#FF0000"><b>const </b></font>FileName<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">);
</font><font color="#008000"><i>{ This procedure takes the name of an existing file as input, and tries
  to show the contents of the file on screen.
  In this implementation, an error message will be written to the screen
  if something goes wrong. Otherwise, the screen is cleared and the bitmap
  is schown. The procedure then returns. It is thus YOUR responsibility to
  set and close the graphics mode, after you have spent some time doing
  something (hopefully usefull), while the user was watching the bitmap.
}
</i></font><font color="#FF0000"><b>implementation
Uses </b></font>BgiDrv<font color="#000080">,</font>Graph<font color="#000080">;

</font><font color="#FF0000"><b>Type
 </b></font>TBitMapHeader <font color="#000080">=
  </font><font color="#FF0000"><b>Record
   </b></font>bfType <font color="#000080">:             </font>Word<font color="#000080">;
   </font>bfSize <font color="#000080">:             </font>LongInt<font color="#000080">;
   </font>bfReserved <font color="#000080">:         </font>LongInt<font color="#000080">;     </font><font color="#008000"><i>{Moet 0 zijn}
   </i></font>bfOffBits <font color="#000080">:          </font>LongInt<font color="#000080">;
   </font>biSize <font color="#000080">:             </font>LongInt<font color="#000080">;
   </font>biWidth <font color="#000080">:            </font>LongInt<font color="#000080">;
   </font>biHeight <font color="#000080">:           </font>LongInt<font color="#000080">;
   </font>biPlanes <font color="#000080">:           </font>Word<font color="#000080">;        </font><font color="#008000"><i>{Moet 1 zijn}
   </i></font>biBitCount <font color="#000080">:         </font>Word<font color="#000080">;        </font><font color="#008000"><i>{1,4,8,24}
   </i></font>biCompression <font color="#000080">:      </font>LongInt<font color="#000080">;
   </font>biSizeImage <font color="#000080">:        </font>LongInt<font color="#000080">;     </font><font color="#008000"><i>{in bytes}
   </i></font>biXPelsPerMeter <font color="#000080">:    </font>LongInt<font color="#000080">;
   </font>biYPelsPerMeter <font color="#000080">:    </font>LongInt<font color="#000080">;
   </font>biClrUsed <font color="#000080">:          </font>LongInt<font color="#000080">;
   </font>biClrImportant <font color="#000080">:     </font>LongInt<font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

 </font>TRGBQuad <font color="#000080">=
  </font><font color="#FF0000"><b>Record
   </b></font>rgbBlue<font color="#000080">,
   </font>rgbGreen<font color="#000080">,
   </font>rgbRed<font color="#000080">,
   </font>rgbReserved <font color="#000080">:        </font>Byte<font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Type </b></font>TByteArray <font color="#000080">= </font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">50000</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>Display1 <font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>f <font color="#000080">: </font><font color="#FF0000"><b>File</b></font><font color="#000080">; </font><font color="#FF0000"><b>const </b></font>BitMapHeader <font color="#000080">: </font>TBitMapHeader<font color="#000080">);
</font><font color="#FF0000"><b>Begin
 </b></font>OutText <font color="#000080">(</font><font color="#800000">'24 bit color not supported yet.'</font><font color="#000080">);
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>Display4 <font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>f <font color="#000080">: </font><font color="#FF0000"><b>File</b></font><font color="#000080">; </font><font color="#FF0000"><b>const </b></font>BitMapHeader <font color="#000080">: </font>TBitMapHeader<font color="#000080">);
</font><font color="#FF0000"><b>Var </b></font>i<font color="#000080">,</font>j <font color="#000080">: </font>Integer<font color="#000080">;
</font><font color="#FF0000"><b>Var </b></font>RGBQuad <font color="#000080">: </font>TRGBQuad<font color="#000080">;
</font><font color="#FF0000"><b>Var </b></font>TwoPixel <font color="#000080">: </font>Byte<font color="#000080">;
</font><font color="#FF0000"><b>Var </b></font>Black <font color="#000080">: </font>Byte<font color="#000080">;
</font><font color="#FF0000"><b>Var </b></font>Line <font color="#000080">: ^</font>TByteArray<font color="#000080">;
</font><font color="#FF0000"><b>Var </b></font>number <font color="#000080">: </font>Word<font color="#000080">;
</font><font color="#FF0000"><b>Var </b></font>BeginX<font color="#000080">,</font>BeginY<font color="#000080">,</font>EindY <font color="#000080">: </font>Integer<font color="#000080">;
    </font>CurrentX<font color="#000080">: </font>Integer<font color="#000080">;
</font><font color="#FF0000"><b>Begin
 If </b></font>GetMaxColor <font color="#000080">&lt; </font><font color="#800000">15 </font><font color="#FF0000"><b>then
  Begin
   </b></font>OutText <font color="#000080">(</font><font color="#800000">'This machine does not support 4 bit color.'</font><font color="#000080">);
   </font>Exit<font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

 </font>Black <font color="#000080">:= </font><font color="#800000">16</font><font color="#000080">;
 </font><font color="#FF0000"><b>With </b></font>BitMapHeader <font color="#FF0000"><b>do
  begin
   For </b></font>i<font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font><font color="#800000">15 </font><font color="#FF0000"><b>do
    Begin
     </b></font>BlockRead<font color="#000080">(</font>f<font color="#000080">,</font>RGBQuad<font color="#000080">,</font>SizeOf<font color="#000080">(</font>RGBQuad<font color="#000080">));
     </font><font color="#FF0000"><b>If </b></font><font color="#000080">(</font>LongInt<font color="#000080">(</font>RGBQuad<font color="#000080">)=</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>then </b></font>Black <font color="#000080">:= </font>i<font color="#000080">;
     </font><font color="#FF0000"><b>With </b></font>RGBQuad <font color="#FF0000"><b>do
      </b></font>SetRGBPalette<font color="#000080">(</font>i<font color="#000080">, </font>rgbRed <font color="#FF0000"><b>shr </b></font><font color="#800000">2</font><font color="#000080">, </font>rgbGreen <font color="#FF0000"><b>shr </b></font><font color="#800000">2</font><font color="#000080">, </font>rgbBlue <font color="#FF0000"><b>shr </b></font><font color="#800000">2</font><font color="#000080">);
     </font>SetPalette<font color="#000080">(</font>i<font color="#000080">,</font>i<font color="#000080">);
    </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

   </font>Number <font color="#000080">:= (</font>biWidth <font color="#FF0000"><b>div </b></font><font color="#800000">2 </font><font color="#000080">+ </font><font color="#800000">3</font><font color="#000080">) </font><font color="#FF0000"><b>and not </b></font><font color="#800000">3</font><font color="#000080">;
   </font>BeginX <font color="#000080">:= (</font>GetMaxX <font color="#000080">- </font>biWidth<font color="#000080">) </font><font color="#FF0000"><b>div </b></font><font color="#800000">2</font><font color="#000080">;
   </font>BeginY <font color="#000080">:= </font>GetMaxY <font color="#000080">- (</font>GetMaxY <font color="#000080">- </font>biHeight<font color="#000080">) </font><font color="#FF0000"><b>div </b></font><font color="#800000">2</font><font color="#000080">;
   </font>EindY <font color="#000080">:= </font>BeginY<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">-</font>biHeight<font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

 </font>GetMem <font color="#000080">(</font>Line<font color="#000080">,</font>number<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">);
 </font><font color="#FF0000"><b>For </b></font>j<font color="#000080">:=</font>BeginY <font color="#FF0000"><b>downto </b></font>EindY <font color="#FF0000"><b>do
  Begin
   </b></font>BlockRead<font color="#000080">(</font>f<font color="#000080">,</font>Line<font color="#000080">^[</font><font color="#800000">1</font><font color="#000080">],</font>number<font color="#000080">);
   </font>CurrentX <font color="#000080">:= </font>BeginX<font color="#000080">;
   </font><font color="#FF0000"><b>For </b></font>i<font color="#000080">:=</font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>number <font color="#FF0000"><b>do
    Begin
     </b></font>TwoPixel <font color="#000080">:= </font>Line<font color="#000080">^[</font>i<font color="#000080">];
     </font><font color="#FF0000"><b>If </b></font>TwoPixel <font color="#FF0000"><b>shr </b></font><font color="#800000">4 </font><font color="#000080">&lt;&gt; </font>Black <font color="#FF0000"><b>then </b></font><font color="#008000"><i>{verspil niet nutteloos tijd}
      </i></font>PutPixel<font color="#000080">(</font>CurrentX<font color="#000080">,</font>j<font color="#000080">,</font>TwoPixel <font color="#FF0000"><b>shr </b></font><font color="#800000">4</font><font color="#000080">);
     </font>Inc<font color="#000080">(</font>CurrentX<font color="#000080">);
     </font><font color="#FF0000"><b>If </b></font>TwoPixel <font color="#FF0000"><b>and </b></font><font color="#800000">15 </font><font color="#000080">&lt;&gt; </font>Black <font color="#FF0000"><b>then
      </b></font>PutPixel<font color="#000080">(</font>CurrentX<font color="#000080">,</font>j<font color="#000080">,</font>TwoPixel <font color="#FF0000"><b>and </b></font><font color="#800000">15</font><font color="#000080">);
     </font>Inc<font color="#000080">(</font>CurrentX<font color="#000080">);
    </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
 </font>FreeMem <font color="#000080">(</font>Line<font color="#000080">,</font>number<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">);
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>Display8 <font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>f <font color="#000080">: </font><font color="#FF0000"><b>File</b></font><font color="#000080">; </font><font color="#FF0000"><b>const </b></font>BitMapHeader <font color="#000080">: </font>TBitMapHeader<font color="#000080">);
</font><font color="#FF0000"><b>Begin
 </b></font>OutText <font color="#000080">(</font><font color="#800000">'8 bit color not supported yet.'</font><font color="#000080">);
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>Display24 <font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>f <font color="#000080">: </font><font color="#FF0000"><b>File</b></font><font color="#000080">; </font><font color="#FF0000"><b>const </b></font>BitMapHeader <font color="#000080">: </font>TBitMapHeader<font color="#000080">);
</font><font color="#FF0000"><b>Begin
 </b></font>OutText <font color="#000080">(</font><font color="#800000">'24 bit color not supported.'</font><font color="#000080">);
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>BMPDisplay<font color="#000080">(</font><font color="#FF0000"><b>const </b></font>FileName<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">);
</font><font color="#FF0000"><b>Var </b></font>f<font color="#000080">: </font><font color="#FF0000"><b>File</b></font><font color="#000080">;
    </font>BitMapHeader <font color="#000080">: </font>TBitMapHeader<font color="#000080">;
</font><font color="#FF0000"><b>Begin
 </b></font>Assign<font color="#000080">(</font>f<font color="#000080">,</font>FileName<font color="#000080">);
 </font>FileMode <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">; </font><font color="#008000"><i>{Read Only}
 </i></font>Reset<font color="#000080">(</font>f<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">);
 </font>FileMode <font color="#000080">:= </font><font color="#800000">2</font><font color="#000080">; </font><font color="#008000"><i>{Default}

 </i></font><font color="#FF0000"><b>If </b></font>IOResult<font color="#000080">&lt;&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>Then
  Begin
   </b></font>OutText <font color="#000080">(</font><font color="#800000">'File doesn''t exist'</font><font color="#000080">);
   </font>Close<font color="#000080">(</font>f<font color="#000080">);
   </font>Exit<font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

 </font>BlockRead<font color="#000080">(</font>f<font color="#000080">,</font>BitMapHeader<font color="#000080">,</font>SizeOf<font color="#000080">(</font>BitMapHeader<font color="#000080">));
 </font><font color="#FF0000"><b>With </b></font>BitMapHeader <font color="#FF0000"><b>do
  Begin
   If </b></font><font color="#000080">(</font>bfType<font color="#000080">&lt;&gt;</font><font color="#800000">19778</font><font color="#000080">) </font><font color="#FF0000"><b>or </b></font><font color="#000080">(</font>bfReserved<font color="#000080">&lt;&gt;</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>or </b></font><font color="#000080">(</font>biPlanes<font color="#000080">&lt;&gt;</font><font color="#800000">1</font><font color="#000080">) </font><font color="#FF0000"><b>then
    Begin
     </b></font>OutText <font color="#000080">(</font><font color="#800000">'Not a valid Windows BitMap File.'</font><font color="#000080">);
     </font>Close<font color="#000080">(</font>f<font color="#000080">);
     </font>Exit<font color="#000080">;
    </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
   </font><font color="#FF0000"><b>If </b></font>biCompression<font color="#000080">&lt;&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>Then
    Begin
     </b></font>OutText <font color="#000080">(</font><font color="#800000">'Cannot read compressed files.'</font><font color="#000080">);
     </font>Close<font color="#000080">(</font>f<font color="#000080">);
     </font>Exit<font color="#000080">;
    </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
   </font>ClearDevice<font color="#000080">;
   </font><font color="#FF0000"><b>Case </b></font>biBitCount <font color="#FF0000"><b>of
    </b></font><font color="#800000">1  </font><font color="#000080">: </font>Display1  <font color="#000080">(</font>f<font color="#000080">, </font>BitMapHeader<font color="#000080">);
    </font><font color="#800000">4  </font><font color="#000080">: </font>Display4  <font color="#000080">(</font>f<font color="#000080">, </font>BitMapHeader<font color="#000080">);
    </font><font color="#800000">8  </font><font color="#000080">: </font>Display8  <font color="#000080">(</font>f<font color="#000080">, </font>BitMapHeader<font color="#000080">);
    </font><font color="#800000">24 </font><font color="#000080">: </font>Display24 <font color="#000080">(</font>f<font color="#000080">, </font>BitMapHeader<font color="#000080">);
   </font><font color="#FF0000"><b>else
    Begin
     </b></font>OutText <font color="#000080">(</font><font color="#800000">'Not a valid Windows BitMap File.'</font><font color="#000080">);
     </font>Close<font color="#000080">(</font>f<font color="#000080">);
     </font>Exit<font color="#000080">;
    </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
   </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
 </font>Close<font color="#000080">(</font>f<font color="#000080">);
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to GRAPHICS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0171.PAS">Original</a><b>]</b></p></body>
</html>
