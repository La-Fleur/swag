<html>
<head><title> "MODE 13H Graphics Unit" by BERNIE PALLEK</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to GRAPHICS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0072.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
From: BERNIE PALLEK
Subj: GRAF_13H.PAS
---------------------------------------------------------------------------
}
(**************************************************)
(*                                                *)
(*         GRAPHICS ROUTINES FOR MODE 13H         *)
(*         ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~         *)
(*        320x200x256 (linearly-addressed)        *)
(*  Collected from routines in the Public Domain  *)
(*          Assembled by Bernie Pallek            *)
(*                                                *)
(**************************************************)

{ DISCLAIMER: Use this unit at your own risk.  I will not be liable
              for anything negative resulting from use of this unit. }

</i></font><font color="#FF0000"><b>UNIT </b></font>Graf_13h<font color="#000080">;

</font><font color="#FF0000"><b>INTERFACE

CONST
  </b></font>Color <font color="#000080">: </font>Byte <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">;

</font><font color="#FF0000"><b>TYPE
  </b></font>RGBPalette <font color="#000080">= </font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">767</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Byte<font color="#000080">;

</font><font color="#FF0000"><b>FUNCTION  </b></font>GetVideoMode <font color="#000080">: </font>Byte<font color="#000080">;
</font><font color="#FF0000"><b>PROCEDURE </b></font>SetVideoMode<font color="#000080">(</font>desiredVideoMode <font color="#000080">: </font>Byte<font color="#000080">);
</font><font color="#FF0000"><b>FUNCTION  </b></font>GetPixel<font color="#000080">(</font>pix2get_x<font color="#000080">, </font>pix2get_y <font color="#000080">: </font>Word<font color="#000080">) : </font>Byte<font color="#000080">;
</font><font color="#FF0000"><b>PROCEDURE </b></font>SetPixel<font color="#000080">(</font>pix2set_x<font color="#000080">, </font>pix2set_y <font color="#000080">: </font>Word<font color="#000080">; </font>pix2set_c <font color="#000080">: </font>Byte<font color="#000080">);
</font><font color="#FF0000"><b>PROCEDURE </b></font>Ellipse<font color="#000080">(</font>exc<font color="#000080">, </font>eyc<font color="#000080">, </font>ea<font color="#000080">, </font>eb <font color="#000080">: </font>Integer<font color="#000080">);
</font><font color="#FF0000"><b>PROCEDURE </b></font>Line<font color="#000080">(</font>lnx1<font color="#000080">, </font>lny1<font color="#000080">, </font>lnx2<font color="#000080">, </font>lny2 <font color="#000080">: </font>Integer<font color="#000080">);
</font><font color="#FF0000"><b>PROCEDURE </b></font>GetPalette<font color="#000080">(</font>index2get <font color="#000080">: </font>Byte<font color="#000080">; </font><font color="#FF0000"><b>VAR </b></font>r_inte<font color="#000080">, </font>g_inte<font color="#000080">, </font>b_inte <font color="#000080">: </font>Byte<font color="#000080">);
</font><font color="#FF0000"><b>PROCEDURE </b></font>SetPalette<font color="#000080">(</font>index2set<font color="#000080">, </font>r_inte<font color="#000080">, </font>g_inte<font color="#000080">, </font>b_inte <font color="#000080">: </font>Byte<font color="#000080">);
</font><font color="#FF0000"><b>PROCEDURE </b></font>BurstSetPalette<font color="#000080">(</font>burstPalette <font color="#000080">: </font>RGBPalette<font color="#000080">);
</font><font color="#FF0000"><b>PROCEDURE </b></font>ScaleBitmap<font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>bmp2scale<font color="#000080">; </font>bwidth<font color="#000080">, </font>bheight <font color="#000080">: </font>Byte<font color="#000080">;
  </font>bstrtx<font color="#000080">, </font>bstrty<font color="#000080">, </font>bendx<font color="#000080">, </font>bendy <font color="#000080">: </font>Word<font color="#000080">);
</font><font color="#FF0000"><b>PROCEDURE </b></font>WaitForRetrace<font color="#000080">;
</font><font color="#FF0000"><b>PROCEDURE </b></font>ClearScr<font color="#000080">;


</font><font color="#FF0000"><b>IMPLEMENTATION


</b></font><font color="#008000"><i>{ private type used by ScaleBitmap() }
</i></font><font color="#FF0000"><b>TYPE
  </b></font>Fixed <font color="#000080">= </font><font color="#FF0000"><b>RECORD CASE </b></font>Boolean <font color="#FF0000"><b>OF
    </b></font>True  <font color="#000080">: (</font>w <font color="#000080">: </font>LongInt<font color="#000080">);
    </font>False <font color="#000080">: (</font>f<font color="#000080">, </font>i <font color="#000080">: </font>Word<font color="#000080">);
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>FUNCTION </b></font>GetVideoMode <font color="#000080">: </font>Byte<font color="#000080">;
</font><font color="#FF0000"><b>VAR
  </b></font>tempVMode <font color="#000080">: </font>Byte<font color="#000080">;
</font><font color="#FF0000"><b>BEGIN
  ASM
    </b></font><font color="#FF00FF">mov ah,$0f
    int $10
    mov tempvmode,al
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
  </font>GetVideoMode <font color="#000080">:= </font>tempVMode<font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>PROCEDURE </b></font>SetVideoMode<font color="#000080">(</font>desiredVideoMode <font color="#000080">: </font>Byte<font color="#000080">);
</font><font color="#008000"><i>{ desiredVideoMode = $03 : 80x25 colour text
                     $13 : 320x200x256 monoplaned
                           video data from $A000:0000 to $A000:FFFF
}
</i></font><font color="#FF0000"><b>BEGIN
  ASM
    </b></font><font color="#FF00FF">mov ah,0
    mov al,desiredvideomode;
    int $10
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>FUNCTION </b></font>GetPixel<font color="#000080">(</font>pix2get_x<font color="#000080">, </font>pix2get_y <font color="#000080">: </font>Word<font color="#000080">) : </font>Byte<font color="#000080">;
</font><font color="#FF0000"><b>BEGIN
  </b></font>GetPixel <font color="#000080">:= </font>Mem<font color="#000080">[</font><font color="#800000">$A000 </font><font color="#000080">: </font>pix2get_y <font color="#000080">* </font><font color="#800000">320 </font><font color="#000080">+ </font>pix2get_x<font color="#000080">];
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>PROCEDURE </b></font>SetPixel<font color="#000080">(</font>pix2set_x<font color="#000080">, </font>pix2set_y <font color="#000080">: </font>Word<font color="#000080">; </font>pix2set_c <font color="#000080">: </font>Byte<font color="#000080">);
</font><font color="#FF0000"><b>BEGIN
  </b></font>Mem<font color="#000080">[</font><font color="#800000">$A000 </font><font color="#000080">: </font>pix2set_y <font color="#000080">* </font><font color="#800000">320 </font><font color="#000080">+ </font>pix2set_x<font color="#000080">] := </font>pix2set_c<font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#008000"><i>{ originally by Sean Palmer, I just mangled it  :^) }
</i></font><font color="#FF0000"><b>PROCEDURE </b></font>Ellipse<font color="#000080">(</font>exc<font color="#000080">, </font>eyc<font color="#000080">, </font>ea<font color="#000080">, </font>eb <font color="#000080">: </font>Integer<font color="#000080">);
</font><font color="#FF0000"><b>VAR
  </b></font>elx<font color="#000080">, </font>ely <font color="#000080">: </font>Integer<font color="#000080">;
  </font>aa<font color="#000080">, </font>aa2<font color="#000080">, </font>bb<font color="#000080">, </font>bb2<font color="#000080">, </font>d<font color="#000080">, </font>dx<font color="#000080">, </font>dy <font color="#000080">: </font>LongInt<font color="#000080">;
</font><font color="#FF0000"><b>BEGIN
  </b></font>elx <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">; </font>ely <font color="#000080">:= </font>eb<font color="#000080">; </font>aa <font color="#000080">:= </font>LongInt<font color="#000080">(</font>ea<font color="#000080">) * </font>ea<font color="#000080">; </font>aa2 <font color="#000080">:= </font><font color="#800000">2 </font><font color="#000080">* </font>aa<font color="#000080">;
  </font>bb <font color="#000080">:= </font>LongInt<font color="#000080">(</font>eb<font color="#000080">) * </font>eb<font color="#000080">; </font>bb2 <font color="#000080">:= </font><font color="#800000">2 </font><font color="#000080">* </font>bb<font color="#000080">;
  </font>d <font color="#000080">:= </font>bb <font color="#000080">- </font>aa <font color="#000080">* </font>eb <font color="#000080">+ </font>aa <font color="#FF0000"><b>DIV </b></font><font color="#800000">4</font><font color="#000080">; </font>dx <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">; </font>dy <font color="#000080">:= </font>aa2 <font color="#000080">* </font>eb<font color="#000080">;
  </font>SetPixel<font color="#000080">(</font>exc<font color="#000080">, </font>eyc <font color="#000080">- </font>ely<font color="#000080">, </font>Color<font color="#000080">); </font>SetPixel<font color="#000080">(</font>exc<font color="#000080">, </font>eyc <font color="#000080">+ </font>ely<font color="#000080">, </font>Color<font color="#000080">);
  </font>SetPixel<font color="#000080">(</font>exc <font color="#000080">- </font>ea<font color="#000080">, </font>eyc<font color="#000080">, </font>Color<font color="#000080">); </font>SetPixel<font color="#000080">(</font>exc <font color="#000080">+ </font>ea<font color="#000080">, </font>eyc<font color="#000080">, </font>Color<font color="#000080">);

  </font><font color="#FF0000"><b>WHILE </b></font><font color="#000080">(</font>dx <font color="#000080">&lt; </font>dy<font color="#000080">) </font><font color="#FF0000"><b>DO BEGIN
    IF </b></font><font color="#000080">(</font>d <font color="#000080">&gt; </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>THEN BEGIN </b></font>Dec<font color="#000080">(</font>ely<font color="#000080">); </font>Dec<font color="#000080">(</font>dy<font color="#000080">, </font>aa2<font color="#000080">); </font>Dec<font color="#000080">(</font>d<font color="#000080">, </font>dy<font color="#000080">); </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
    </font>Inc<font color="#000080">(</font>elx<font color="#000080">); </font>Inc<font color="#000080">(</font>dx<font color="#000080">, </font>bb2<font color="#000080">); </font>Inc<font color="#000080">(</font>d<font color="#000080">, </font>bb <font color="#000080">+ </font>dx<font color="#000080">);
    </font>SetPixel<font color="#000080">(</font>exc <font color="#000080">+ </font>elx<font color="#000080">, </font>eyc <font color="#000080">+ </font>ely<font color="#000080">, </font>Color<font color="#000080">);
    </font>SetPixel<font color="#000080">(</font>exc <font color="#000080">- </font>elx<font color="#000080">, </font>eyc <font color="#000080">+ </font>ely<font color="#000080">, </font>Color<font color="#000080">);
    </font>SetPixel<font color="#000080">(</font>exc <font color="#000080">+ </font>elx<font color="#000080">, </font>eyc <font color="#000080">- </font>ely<font color="#000080">, </font>Color<font color="#000080">);
    </font>SetPixel<font color="#000080">(</font>exc <font color="#000080">- </font>elx<font color="#000080">, </font>eyc <font color="#000080">- </font>ely<font color="#000080">, </font>Color<font color="#000080">);
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
  </font>Inc<font color="#000080">(</font>d<font color="#000080">, (</font><font color="#800000">3 </font><font color="#000080">* (</font>aa <font color="#000080">- </font>bb<font color="#000080">) </font><font color="#FF0000"><b>DIV </b></font><font color="#800000">2 </font><font color="#000080">- (</font>dx <font color="#000080">+ </font>dy<font color="#000080">)) </font><font color="#FF0000"><b>DIV </b></font><font color="#800000">2</font><font color="#000080">);
  </font><font color="#FF0000"><b>WHILE </b></font><font color="#000080">(</font>ely <font color="#000080">&gt; </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>DO BEGIN
    IF </b></font><font color="#000080">(</font>d <font color="#000080">&lt; </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>THEN BEGIN </b></font>Inc<font color="#000080">(</font>elx<font color="#000080">); </font>Inc<font color="#000080">(</font>dx<font color="#000080">, </font>bb2<font color="#000080">); </font>Inc<font color="#000080">(</font>d<font color="#000080">, </font>bb <font color="#000080">+ </font>dx<font color="#000080">); </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
    </font>Dec<font color="#000080">(</font>ely<font color="#000080">); </font>Dec<font color="#000080">(</font>dy<font color="#000080">, </font>aa2<font color="#000080">); </font>Inc<font color="#000080">(</font>d<font color="#000080">, </font>aa <font color="#000080">- </font>dy<font color="#000080">);
    </font>SetPixel<font color="#000080">(</font>exc <font color="#000080">+ </font>elx<font color="#000080">, </font>eyc <font color="#000080">+ </font>ely<font color="#000080">, </font>Color<font color="#000080">);
    </font>SetPixel<font color="#000080">(</font>exc <font color="#000080">- </font>elx<font color="#000080">, </font>eyc <font color="#000080">+ </font>ely<font color="#000080">, </font>Color<font color="#000080">);
    </font>SetPixel<font color="#000080">(</font>exc <font color="#000080">+ </font>elx<font color="#000080">, </font>eyc <font color="#000080">- </font>ely<font color="#000080">, </font>Color<font color="#000080">);
    </font>SetPixel<font color="#000080">(</font>exc <font color="#000080">- </font>elx<font color="#000080">, </font>eyc <font color="#000080">- </font>ely<font color="#000080">, </font>Color<font color="#000080">);
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#008000"><i>{ originally by Sean Palmer, I just mangled it }
</i></font><font color="#FF0000"><b>PROCEDURE </b></font>Line<font color="#000080">(</font>lnx1<font color="#000080">, </font>lny1<font color="#000080">, </font>lnx2<font color="#000080">, </font>lny2 <font color="#000080">: </font>Integer<font color="#000080">);
</font><font color="#FF0000"><b>VAR
  </b></font>lndd<font color="#000080">, </font>lndx<font color="#000080">, </font>lndy<font color="#000080">, </font>lnai<font color="#000080">, </font>lnbi<font color="#000080">, </font>lnxi<font color="#000080">, </font>lnyi <font color="#000080">: </font>Integer<font color="#000080">;
</font><font color="#FF0000"><b>BEGIN
  IF </b></font><font color="#000080">(</font>lnx1 <font color="#000080">&lt; </font>lnx2<font color="#000080">) </font><font color="#FF0000"><b>THEN BEGIN </b></font>lnxi <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">; </font>lndx <font color="#000080">:= </font>lnx2 <font color="#000080">- </font>lnx1<font color="#000080">;
  </font><font color="#FF0000"><b>END ELSE BEGIN </b></font>lnxi <font color="#000080">:= (-</font><font color="#800000">1</font><font color="#000080">); </font>lndx <font color="#000080">:= </font>lnx1 <font color="#000080">- </font>lnx2<font color="#000080">; </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>lny1 <font color="#000080">&lt; </font>lny2<font color="#000080">) </font><font color="#FF0000"><b>THEN BEGIN </b></font>lnyi <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">; </font>lndy <font color="#000080">:= </font>lny2 <font color="#000080">- </font>lny1<font color="#000080">;
  </font><font color="#FF0000"><b>END ELSE BEGIN </b></font>lnyi <font color="#000080">:= (-</font><font color="#800000">1</font><font color="#000080">); </font>lndy <font color="#000080">:= </font>lny1 <font color="#000080">- </font>lny2<font color="#000080">; </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
  </font>SetPixel<font color="#000080">(</font>lnx1<font color="#000080">, </font>lny1<font color="#000080">, </font>Color<font color="#000080">);
  </font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>lndx <font color="#000080">&gt; </font>lndy<font color="#000080">) </font><font color="#FF0000"><b>THEN BEGIN </b></font>lnai <font color="#000080">:= (</font>lndy <font color="#000080">- </font>lndx<font color="#000080">) * </font><font color="#800000">2</font><font color="#000080">;
    </font>lnbi <font color="#000080">:= </font>lndy <font color="#000080">* </font><font color="#800000">2</font><font color="#000080">;
    </font>lndd <font color="#000080">:= </font>lnbi <font color="#000080">- </font>lndx<font color="#000080">;
    </font><font color="#FF0000"><b>REPEAT IF </b></font><font color="#000080">(</font>lndd <font color="#000080">&gt;= </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>THEN BEGIN </b></font>Inc<font color="#000080">(</font>lny1<font color="#000080">, </font>lnyi<font color="#000080">);
      </font>Inc<font color="#000080">(</font>lndd<font color="#000080">, </font>lnai<font color="#000080">); </font><font color="#FF0000"><b>END ELSE </b></font>Inc<font color="#000080">(</font>lndd<font color="#000080">, </font>lnbi<font color="#000080">);
      </font>Inc<font color="#000080">(</font>lnx1<font color="#000080">, </font>lnxi<font color="#000080">); </font>SetPixel<font color="#000080">(</font>lnx1<font color="#000080">, </font>lny1<font color="#000080">, </font>Color<font color="#000080">);
    </font><font color="#FF0000"><b>UNTIL </b></font><font color="#000080">(</font>lnx1 <font color="#000080">= </font>lnx2<font color="#000080">);
  </font><font color="#FF0000"><b>END ELSE BEGIN </b></font>lnai <font color="#000080">:= (</font>lndx <font color="#000080">- </font>lndy<font color="#000080">) * </font><font color="#800000">2</font><font color="#000080">; </font>lnbi <font color="#000080">:= </font>lndx <font color="#000080">* </font><font color="#800000">2</font><font color="#000080">;
    </font>lndd <font color="#000080">:= </font>lnbi <font color="#000080">- </font>lndy<font color="#000080">;
    </font><font color="#FF0000"><b>REPEAT IF </b></font><font color="#000080">(</font>lndd <font color="#000080">&gt;= </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>THEN BEGIN </b></font>Inc<font color="#000080">(</font>lnx1<font color="#000080">, </font>lnxi<font color="#000080">);
      </font>Inc<font color="#000080">(</font>lndd<font color="#000080">, </font>lnai<font color="#000080">); </font><font color="#FF0000"><b>END ELSE </b></font>Inc<font color="#000080">(</font>lndd<font color="#000080">, </font>lnbi<font color="#000080">);
      </font>Inc<font color="#000080">(</font>lny1<font color="#000080">, </font>lnyi<font color="#000080">); </font>SetPixel<font color="#000080">(</font>lnx1<font color="#000080">, </font>lny1<font color="#000080">, </font>Color<font color="#000080">);
    </font><font color="#FF0000"><b>UNTIL </b></font><font color="#000080">(</font>lny1 <font color="#000080">= </font>lny2<font color="#000080">);
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>PROCEDURE </b></font>GetPalette<font color="#000080">(</font>index2get <font color="#000080">: </font>Byte<font color="#000080">; </font><font color="#FF0000"><b>VAR </b></font>r_inte<font color="#000080">, </font>g_inte<font color="#000080">, </font>b_inte <font color="#000080">: </font>Byte<font color="#000080">);
</font><font color="#008000"><i>{ returns the r, g, and b values of a palette index }
</i></font><font color="#FF0000"><b>BEGIN
  </b></font>Port<font color="#000080">[</font><font color="#800000">$3C7</font><font color="#000080">] := </font>index2get<font color="#000080">;
  </font>r_inte <font color="#000080">:= </font>Port<font color="#000080">[</font><font color="#800000">$3C9</font><font color="#000080">];
  </font>g_inte <font color="#000080">:= </font>Port<font color="#000080">[</font><font color="#800000">$3C9</font><font color="#000080">];
  </font>b_inte <font color="#000080">:= </font>Port<font color="#000080">[</font><font color="#800000">$3C9</font><font color="#000080">];
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>PROCEDURE </b></font>SetPalette<font color="#000080">(</font>index2set<font color="#000080">, </font>r_inte<font color="#000080">, </font>g_inte<font color="#000080">, </font>b_inte <font color="#000080">: </font>Byte<font color="#000080">);
</font><font color="#008000"><i>{ sets the r, g, and b values of a palette index }
</i></font><font color="#FF0000"><b>BEGIN
  </b></font>Port<font color="#000080">[</font><font color="#800000">$3C8</font><font color="#000080">] := </font>index2set<font color="#000080">;
  </font>Port<font color="#000080">[</font><font color="#800000">$3C9</font><font color="#000080">] := </font>r_inte<font color="#000080">;
  </font>Port<font color="#000080">[</font><font color="#800000">$3C9</font><font color="#000080">] := </font>g_inte<font color="#000080">;
  </font>Port<font color="#000080">[</font><font color="#800000">$3C9</font><font color="#000080">] := </font>b_inte<font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>PROCEDURE </b></font>BurstSetPalette<font color="#000080">(</font>burstPalette <font color="#000080">: </font>RGBPalette<font color="#000080">);
</font><font color="#FF0000"><b>VAR
  </b></font>burstCount <font color="#000080">: </font>Word<font color="#000080">;
</font><font color="#FF0000"><b>BEGIN
  </b></font>Port<font color="#000080">[</font><font color="#800000">$3C8</font><font color="#000080">] := </font><font color="#800000">0</font><font color="#000080">;
  </font><font color="#FF0000"><b>FOR </b></font>burstCount <font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>TO </b></font><font color="#800000">767 </font><font color="#FF0000"><b>DO </b></font>Port<font color="#000080">[</font><font color="#800000">$3C9</font><font color="#000080">] := </font>burstPalette<font color="#000080">[</font>burstCount<font color="#000080">];
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#008000"><i>{ originally by Sean Palmer, I just mangled it }
</i></font><font color="#FF0000"><b>PROCEDURE </b></font>ScaleBitmap<font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>bmp2scale<font color="#000080">; </font>bwidth<font color="#000080">, </font>bheight <font color="#000080">: </font>Byte<font color="#000080">;
  </font>bstrtx<font color="#000080">, </font>bstrty<font color="#000080">, </font>bendx<font color="#000080">, </font>bendy <font color="#000080">: </font>Word<font color="#000080">);
</font><font color="#008000"><i>{ - bmp2scale is an array [0..bwidth, 0..bheight] of byte      }
{   which contains the original bitmap                         }
{ - bwidth and bheight are the actual width - 1 and the actual }
{   height - 1 of the normal bitmap                            }
{ - bstrtx and bstrty are the x and y values for the upper-    }
{   left-hand corner of the scaled bitmap                      }
{ - bendx and bendy are the lower-right-hand corner of the     }
{   scaled version of the original bitmap                      }
{ - eg. to paste an unscaled version of a bitmap that is 64x64 }
{   pixels in size in the top left-hand corner of the screen,  }
{   fill the array with data and call:                         }
{     ScaleBitmap(bitmap, 64, 64, 0, 0, 63, 63);               }
{ - to create an array for the bitmap, make it like this:      }
{     VAR myBitmap : Array[0..bmpHeight, 0..bmpWidth] of Byte; }
{   where bmpHeight is the actual height of the normal-size    }
{   bitmap less one, and bmpWidth is the actual width less one }
</i></font><font color="#FF0000"><b>VAR
  </b></font>bmp_sx<font color="#000080">, </font>bmp_sy<font color="#000080">, </font>bmp_cy <font color="#000080">: </font>Fixed<font color="#000080">;
  </font>bmp_s<font color="#000080">, </font>bmp_w<font color="#000080">, </font>bmp_h    <font color="#000080">: </font>Word<font color="#000080">;

</font><font color="#FF0000"><b>BEGIN
  </b></font>bmp_w <font color="#000080">:= </font>bendx <font color="#000080">- </font>bstrtx <font color="#000080">+ </font><font color="#800000">1</font><font color="#000080">; </font>bmp_h <font color="#000080">:= </font>bendy <font color="#000080">- </font>bstrty <font color="#000080">+ </font><font color="#800000">1</font><font color="#000080">;
  </font>bmp_sx<font color="#000080">.</font>w <font color="#000080">:= </font>bwidth <font color="#000080">* </font><font color="#800000">$10000 </font><font color="#FF0000"><b>DIV </b></font>bmp_w<font color="#000080">;
  </font>bmp_sy<font color="#000080">.</font>w <font color="#000080">:= </font>bheight <font color="#000080">* </font><font color="#800000">$10000 </font><font color="#FF0000"><b>DIV </b></font>bmp_h<font color="#000080">;
  </font>bmp_s <font color="#000080">:= </font><font color="#800000">320 </font><font color="#000080">- </font>bmp_w<font color="#000080">; </font>bmp_cy<font color="#000080">.</font>w <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font><font color="#FF0000"><b>ASM
    </b></font><font color="#FF00FF">push ds; mov ds,word ptr bmp2scale + 2;
    mov ax,$a000; mov es,ax; cld; mov ax,320;
    mul bstrty; add ax,bstrtx; mov di,ax;
   @l2:
    mov ax,bmp_cy.i; mul bwidth; mov bx,ax;
    add bx,word ptr bmp2scale;
    mov cx,bmp_w; mov si,0; mov dx,bmp_sx.f;
   @l:
    mov al,[bx]; stosb; add si,dx; adc bx,bmp_sx.i;
    loop @l;
    add di,bmp_s; mov ax,bmp_sy.f; mov bx,bmp_sy.i;
    add bmp_cy.f,ax; adc bmp_cy.i,bx;
    dec word ptr bmp_h; jnz @l2; pop ds;
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>PROCEDURE </b></font>WaitForRetrace<font color="#000080">;
</font><font color="#008000"><i>{ waits for a vertical retrace to reduce flicker }
</i></font><font color="#FF0000"><b>BEGIN
  REPEAT UNTIL </b></font><font color="#000080">(</font>Port<font color="#000080">[</font><font color="#800000">$3DA</font><font color="#000080">] </font><font color="#FF0000"><b>AND </b></font><font color="#800000">8</font><font color="#000080">) = </font><font color="#800000">8</font><font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>PROCEDURE </b></font>ClearScr<font color="#000080">;
</font><font color="#FF0000"><b>BEGIN
  </b></font>FillChar<font color="#000080">(</font>Mem<font color="#000080">[</font><font color="#800000">$A000</font><font color="#000080">:</font><font color="#800000">0000</font><font color="#000080">], </font><font color="#800000">64000</font><font color="#000080">, </font><font color="#800000">0</font><font color="#000080">);
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>END</b></font><font color="#000080">.  </font><font color="#008000"><i>{ of unit }

</i></font>That<font color="#800000">'s it!  It'</font>s <font color="#FF0000"><b>not </b></font>complete<font color="#000080">, </font>but it<font color="#800000">'s meant as a starter for all who are
</font>interested <font color="#FF0000"><b>in </b></font>VGA graphics<font color="#000080">.  </font>Happy programming<font color="#000080">!

</font>Bernie<font color="#000080">.


--- </font>Maximus<font color="#000080">/</font><font color="#800000">2 2.01</font>wb
 <font color="#000080">* </font>Origin<font color="#000080">: * </font>idiot savant <font color="#000080">* +</font><font color="#800000">1 905 935 6628 </font><font color="#000080">* (</font><font color="#800000">1</font><font color="#000080">:</font><font color="#800000">247</font><font color="#000080">/</font><font color="#800000">128</font><font color="#000080">)
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to GRAPHICS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0072.PAS">Original</a><b>]</b></p></body>
</html>
