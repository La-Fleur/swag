<html>
<head><title> "JPEG/JFIF Height & Width" by RENE VAN HOORN</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to GRAPHICS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0142.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
&gt; I've asked this question before, in several message areas, but
&gt; have still to get an answer.. I need to be able to get the size
&gt; and colors from a JPEG/JFIF image file.. Nothing more, nothing
&gt; less... Structures would do, regardless of language (C, Asm,
&gt; Pas, Basic). Anyone?

Here it is (not fully tested, only extracts height and width of the picture!)
}

</i></font><font color="#FF0000"><b>Procedure </b></font>GetJpegInfo<font color="#000080">(</font>FName <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">; </font><font color="#FF0000"><b>VAR </b></font>IsJpeg<font color="#000080">: </font>Boolean<font color="#000080">; </font><font color="#FF0000"><b>VAR </b></font>Height<font color="#000080">,
                            </font>Width <font color="#000080">: </font>Word<font color="#000080">);

</font><font color="#008000"><i>{Checks if file FName is a (true) JPEG/JFIF file and extracts
 height and width (in pixels) of the picture}
</i></font><font color="#FF0000"><b>Const
  </b></font>JFIFS <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">[</font><font color="#800000">4</font><font color="#000080">] = </font><font color="#800000">#$FF </font><font color="#000080">+ </font><font color="#800000">#$D8 </font><font color="#000080">+ </font><font color="#800000">#$FF </font><font color="#000080">+ </font><font color="#800000">#$E0</font><font color="#000080">;
          </font><font color="#008000"><i>{JFIF marker: $FF SOI $FF App0}

</i></font><font color="#FF0000"><b>Var </b></font>F <font color="#000080">: </font><font color="#FF0000"><b>File</b></font><font color="#000080">;
    </font>ReadS <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
    </font>ARead <font color="#000080">: </font>Word<font color="#000080">;
    </font>Count <font color="#000080">: </font>Integer<font color="#000080">;

</font><font color="#FF0000"><b>begin
   </b></font>Assign<font color="#000080">(</font>F<font color="#000080">,</font>FName<font color="#000080">);
   </font>Reset<font color="#000080">(</font>F<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">);
   </font>Blockread<font color="#000080">(</font>F<font color="#000080">, </font>ReadS<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">], </font><font color="#800000">255</font><font color="#000080">, </font>Aread<font color="#000080">);
   </font>ReadS<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">] := </font>Chr<font color="#000080">(</font>Aread<font color="#000080">);
   </font>Close<font color="#000080">(</font>F<font color="#000080">);

   </font>IsJpeg <font color="#000080">:= </font>FALSE<font color="#000080">;

   </font><font color="#008000"><i>{Search for JFIF marker in first 255 bytes of the file.
    If NOT found, then you can safely assume the file isn't
    a (real) JPEG/JFIF file}

   </i></font><font color="#FF0000"><b>if </b></font>Pos<font color="#000080">(</font>JFIFS<font color="#000080">, </font>ReadS<font color="#000080">) &gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then
      begin
      If </b></font><font color="#000080">(</font>Copy<font color="#000080">(</font>ReadS<font color="#000080">, </font>Pos<font color="#000080">(</font>JFIFS<font color="#000080">,</font>ReadS<font color="#000080">)+</font>Length<font color="#000080">(</font>JFIFS<font color="#000080">)+</font><font color="#800000">2</font><font color="#000080">,</font><font color="#800000">5</font><font color="#000080">) = </font><font color="#800000">'JFIF'</font><font color="#000080">+</font><font color="#800000">#0</font><font color="#000080">) </font><font color="#FF0000"><b>then
         begin

         </b></font><font color="#008000"><i>{We have a JPEG/JFIF File!}

         </i></font>IsJpeg <font color="#000080">:= </font>TRUE<font color="#000080">;

         </font><font color="#008000"><i>{Search for SOF marker}

         </i></font>Count <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
         </font><font color="#FF0000"><b>Repeat
          </b></font>inc<font color="#000080">(</font>Count<font color="#000080">);
         </font><font color="#FF0000"><b>Until </b></font><font color="#000080">(</font>Count <font color="#000080">&gt; </font>length<font color="#000080">(</font>ReadS<font color="#000080">)) </font><font color="#FF0000"><b>OR
               </b></font><font color="#000080">(</font>ReadS<font color="#000080">[</font>Count<font color="#000080">] </font><font color="#FF0000"><b>in </b></font><font color="#000080">[</font><font color="#800000">#192</font><font color="#000080">..</font><font color="#800000">#207</font><font color="#000080">]);
         </font><font color="#FF0000"><b>if </b></font>Count <font color="#000080">&lt;= </font>Length<font color="#000080">(</font>ReadS<font color="#000080">) </font><font color="#FF0000"><b>then
            begin
           </b></font><font color="#008000"><i>{ ReadS[Count] = first SOF marker
             Count + 1 = length high byte  \ length of APP0 data!
             Count + 2 = length low byte   /
             Count + 3 = data precision    - colors (?)
             Count + 4 = height high byte  \ heigth of picture
             Count + 5 = height low byte   /
             Count + 6 = width high byte   \ width of picture
             Count + 7 = width low byte    /
           }
            </i></font>Height <font color="#000080">:= </font>Word<font color="#000080">(</font>Ord<font color="#000080">(</font>ReadS<font color="#000080">[</font>Count<font color="#000080">+</font><font color="#800000">4</font><font color="#000080">])*</font><font color="#800000">256</font><font color="#000080">) + </font>Ord<font color="#000080">(</font>ReadS<font color="#000080">[</font>Count<font color="#000080">+</font><font color="#800000">5</font><font color="#000080">]);
            </font>Width  <font color="#000080">:= </font>Word<font color="#000080">(</font>Ord<font color="#000080">(</font>ReadS<font color="#000080">[</font>Count<font color="#000080">+</font><font color="#800000">6</font><font color="#000080">])*</font><font color="#800000">256</font><font color="#000080">) + </font>ord<font color="#000080">(</font>ReadS<font color="#000080">[</font>Count<font color="#000080">+</font><font color="#800000">7</font><font color="#000080">]);
            </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
         </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to GRAPHICS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0142.PAS">Original</a><b>]</b></p></body>
</html>
