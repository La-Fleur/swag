<html>
<head><title> "Faster Sprites" by PIETER KIRKHAM</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to GRAPHICS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0094.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
  For the people who requested a faster sprite drawing program, here it is.
This program is just Bas van Gaalen's sprite program with a few modifications
to make it run quicker.  I am currently working on this program, so that it
will be able to handle more sprites than one..

------------------- CUT HERE ----------------------
}

</i></font><font color="#FF0000"><b>PROGRAM </b></font>Game_sprites<font color="#000080">;
</font><font color="#008000"><i>{ By Bas van Gaalen, Holland, PD }
{$G+}

</i></font><font color="#FF0000"><b>USES </b></font>crt<font color="#000080">;

</font><font color="#FF0000"><b>CONST </b></font>w<font color="#000080">=</font><font color="#800000">16</font><font color="#000080">; </font>h<font color="#000080">=</font><font color="#800000">16</font><font color="#000080">; </font>sega000<font color="#000080">= </font><font color="#800000">$0A000</font><font color="#000080">;

</font><font color="#FF0000"><b>TYPE
  </b></font>SPRBUF <font color="#000080">= </font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">256</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Byte<font color="#000080">;

</font><font color="#FF0000"><b>VAR
  </b></font>Bckbuf<font color="#000080">,</font>Sprite <font color="#000080">: </font>SPRBUF<font color="#000080">;
  </font>px<font color="#000080">,</font>py <font color="#000080">: </font>Word<font color="#000080">;
  </font>CCOS<font color="#000080">,</font>CSIN <font color="#000080">: </font><font color="#FF0000"><b>Array </b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">360</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>WORD<font color="#000080">;

</font><font color="#FF0000"><b>CONST
  </b></font>SegS <font color="#000080">: </font>Word <font color="#000080">= </font>SEG<font color="#000080">(</font>Sprite<font color="#000080">);
  </font>OfsS <font color="#000080">: </font>Word <font color="#000080">= </font>OFS<font color="#000080">(</font>Sprite<font color="#000080">);
  </font>SegB <font color="#000080">: </font>Word <font color="#000080">= </font>SEG<font color="#000080">(</font>BckBuf<font color="#000080">);
  </font>OfsB <font color="#000080">: </font>Word <font color="#000080">= </font>OFS<font color="#000080">(</font>BckBuf<font color="#000080">);


</font><font color="#FF0000"><b>PROCEDURE </b></font>setpal<font color="#000080">(</font>col<font color="#000080">,</font>r<font color="#000080">,</font>g<font color="#000080">,</font>b <font color="#000080">: </font>byte<font color="#000080">); </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>ASM
  </b></font><font color="#FF00FF">mov dx,03c8h
  mov al,col
  out dx,al
  inc dx
  mov al,r
  out dx,al
  mov al,g
  out dx,al
  mov al,b
  out dx,al
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>PROCEDURE </b></font>retrace<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>ASM
  </b></font><font color="#FF00FF">mov  dx,03dah
@l2:
  in   al,dx
  test al,8
  jz   @l2
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>PROCEDURE </b></font>putsprite<font color="#000080">(</font>x<font color="#000080">,</font>y<font color="#000080">:</font>word<font color="#000080">);
</font><font color="#FF0000"><b>BEGIN
  ASM
    </b></font><font color="#FF00FF">CLI
    PUSH DS
    MOV  AX,0A000h
    MOV  ES,AX
    MOV  DS,SegB
    MOV  AX,PY
    SHL  AX,6
    MOV  DI,AX
    SHL  AX,2
    ADD  DI,AX
    ADD  DI,PX
    MOV  DX,1010h
    MOV  AX,OfsB
    MOV  SI,AX
    XOR  AX,AX
@1:
    MOV  AL,[DS:SI]     </font><font color="#008000"><i>{ Display the sprite buffer over the old sprite }
    </i></font><font color="#FF00FF">MOV  [ES:DI],AL
    INC  DI
    INC  SI
    DEC  DL
    JNZ  @1
    ADD  DI,304
    MOV  DL,16
    DEC  DH
    JNZ  @1
    MOV  AX,Y
    SHL  AX,6
    MOV  DI,AX
    SHL  AX,2
    ADD  DI,AX
    ADD  DI,X
    MOV  DX,1010h
    MOV  AX,OfsB
    MOV  SI,AX
    XOR  AX,AX
@2:                           </font><font color="#008000"><i>{ Store the background into the Sprite Buffer }
    </i></font><font color="#FF00FF">MOV  AL,[ES:DI]
    MOV  [DS:SI],AL
    INC  DI
    INC  SI
    DEC  DL
    JNZ  @2
    ADD  DI,304
    MOV  DL,16
    DEC  DH
    JNZ  @2
    MOV  AX,Y
    SHL  AX,6
    MOV  DI,AX
    SHL  AX,2
    ADD  DI,AX
    ADD  DI,X
    MOV  DX,1010h
    MOV  AX,OfsS
    MOV  SI,AX
    XOR  AX,AX
@3:
    CMP  [DS:SI],AH      </font><font color="#008000"><i>{ Display the Sprite at it's new location }
    </i></font><font color="#FF00FF">JZ   @4
    MOV  AL,[DS:SI]
    MOV  [ES:DI],AL
@4:
    INC  DI
    INC  SI
    DEC  DL
    JNZ  @3
    ADD  DI,304
    MOV  DL,16
    DEC  DH
    JNZ  @3
    POP  DS
    STI
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
  </font>px<font color="#000080">:=</font>x<font color="#000080">; </font>py<font color="#000080">:=</font>y<font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#008000"><i>(* This procedure I added to speed up the rotation used when displaying the
sprite.  This is not nessary, but usefull *)

</i></font><font color="#FF0000"><b>PROCEDURE </b></font>Calc_Cos_Sin<font color="#000080">;
</font><font color="#FF0000"><b>VAR </b></font>I <font color="#000080">: </font>word<font color="#000080">;
</font><font color="#FF0000"><b>BEGIN
  FOR </b></font>I <font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font><font color="#800000">360 </font><font color="#FF0000"><b>DO
  BEGIN
    </b></font>CCOS<font color="#000080">[</font>I<font color="#000080">] := </font>ROUND<font color="#000080">(</font>COS<font color="#000080">(</font>PI<font color="#000080">*</font>I<font color="#000080">/</font><font color="#800000">180</font><font color="#000080">)*</font><font color="#800000">150</font><font color="#000080">);
    </font>CSIN<font color="#000080">[</font>I<font color="#000080">] := </font>ROUND<font color="#000080">(</font>SIN<font color="#000080">(</font>PI<font color="#000080">*</font>I<font color="#000080">/</font><font color="#800000">180</font><font color="#000080">)*</font><font color="#800000">75</font><font color="#000080">);
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>var </b></font>i<font color="#000080">,</font>j<font color="#000080">:</font>word<font color="#000080">;

</font><font color="#FF0000"><b>BEGIN
  ASM
    </b></font><font color="#FF00FF">mov ax,13h
    int 10h
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
  </font>Calc_Cos_Sin<font color="#000080">;
  </font><font color="#FF0000"><b>for </b></font>i<font color="#000080">:=</font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font><font color="#800000">255 </font><font color="#FF0000"><b>do </b></font>setpal<font color="#000080">(</font>i<font color="#000080">,</font><font color="#800000">255</font><font color="#000080">-</font>i <font color="#FF0000"><b>div </b></font><font color="#800000">6</font><font color="#000080">,</font><font color="#800000">255</font><font color="#000080">-</font>i <font color="#FF0000"><b>div </b></font><font color="#800000">4</font><font color="#000080">,</font><font color="#800000">20</font><font color="#000080">);
  </font>fillchar<font color="#000080">(</font>bckbuf<font color="#000080">,</font>sizeof<font color="#000080">(</font>bckbuf<font color="#000080">),</font><font color="#800000">0</font><font color="#000080">);
  </font><font color="#008000"><i>{ create background }
  </i></font><font color="#FF0000"><b>for </b></font>i<font color="#000080">:=</font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font><font color="#800000">319 </font><font color="#FF0000"><b>do
    for </b></font>j<font color="#000080">:=</font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font><font color="#800000">199 </font><font color="#FF0000"><b>do
      </b></font>mem<font color="#000080">[</font>sega000<font color="#000080">:</font>j<font color="#000080">*</font><font color="#800000">320</font><font color="#000080">+</font>i<font color="#000080">]:=</font>round<font color="#000080">(</font><font color="#800000">5</font><font color="#000080">+</font><font color="#800000">0.4</font><font color="#000080">*</font>i<font color="#000080">+</font><font color="#800000">0.4</font><font color="#000080">*</font>j<font color="#000080">)+</font>random<font color="#000080">(</font><font color="#800000">10</font><font color="#000080">);
  </font><font color="#008000"><i>{ create random sprite }
  </i></font>randomize<font color="#000080">;
  </font><font color="#FF0000"><b>for </b></font>i<font color="#000080">:=</font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font><font color="#800000">256 </font><font color="#FF0000"><b>do
    </b></font>sprite<font color="#000080">[</font>i<font color="#000080">]:=</font>random<font color="#000080">(</font><font color="#800000">255</font><font color="#000080">);
  </font><font color="#008000"><i>{ clear middle part }
  </i></font><font color="#FF0000"><b>for </b></font>i<font color="#000080">:=</font><font color="#800000">6 </font><font color="#FF0000"><b>to </b></font><font color="#800000">10 </font><font color="#FF0000"><b>do
    for </b></font>j<font color="#000080">:=</font><font color="#800000">6 </font><font color="#FF0000"><b>to </b></font><font color="#800000">10 </font><font color="#FF0000"><b>do
      </b></font>sprite<font color="#000080">[</font>j<font color="#000080">*</font>w<font color="#000080">+</font>i<font color="#000080">]:=</font><font color="#800000">0</font><font color="#000080">;
  </font>i<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
  </font><font color="#008000"><i>{ save first old backup screen }
  </i></font>px<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">; </font>py<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;

</font><font color="#008000"><i>(*  The following assembly code is required to save the sprites background when
it is first displayed.  I am still trying to figure how to incorperate this
into the main assembly code for displaying the sprite *)

  </i></font><font color="#FF0000"><b>ASM
    </b></font><font color="#FF00FF">CLI
    PUSH BP
    PUSH DS

    MOV  AX,SegA000
    MOV  ES,AX
    MOV  DS,SegB

    MOV  AX,0
    SHL  AX,6
    MOV  DI,AX
    SHL  AX,2
    ADD  DI,AX
    ADD  DI,0

    MOV  DX,1010h
    MOV  AX,OfsB
    MOV  BP,AX
    XOR  AX,AX
@2:
    MOV  AL,[ES:DI]
    MOV  [DS:BP],AL
    INC  DI
    INC  BP
    DEC  DL
    JNZ  @2
    ADD  DI,304
    MOV  DL,16
    DEC  DH
    JNZ  @2

    POP  DS
    POP  BP
    STI
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
  </font><font color="#008000"><i>{ move sprite over background }
  </i></font><font color="#FF0000"><b>repeat
    </b></font>retrace<font color="#000080">;
    </font>putsprite<font color="#000080">(</font><font color="#800000">150</font><font color="#000080">+</font>CCOS<font color="#000080">[</font>I<font color="#000080">],</font><font color="#800000">100</font><font color="#000080">+</font>CSIN<font color="#000080">[</font>I<font color="#000080">]);
    </font>i<font color="#000080">:=</font><font color="#800000">1</font><font color="#000080">+</font>i <font color="#FF0000"><b>mod </b></font><font color="#800000">360</font><font color="#000080">;
  </font><font color="#FF0000"><b>until </b></font>keypressed<font color="#000080">;
  </font><font color="#FF0000"><b>ASM
    </b></font><font color="#FF00FF">mov ax,3h
    int 10h
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">.

</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to GRAPHICS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0094.PAS">Original</a><b>]</b></p></body>
</html>
