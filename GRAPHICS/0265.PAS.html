<html>
<head><title> "Grab Screen Image and Save to Disk" by LANDON RABERN</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to GRAPHICS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0265.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
I am sending a unit which I have made that lets you get an image off the
screen, put an image on the screen, save an image to disk, load it off
the disk, and scale the object as well.  I would like to contribute this
unit to swag.

thanks

}
{Landon Rabern 1997
{This unit has procedures for getting an image, putting an image, saving an
image to disk, and scaling an image 
It works pretty well but it isn't optimised, so if you optimise it please
send me a copy}
</i></font><font color="#FF0000"><b>unit </b></font>picunit<font color="#000080">;

</font><font color="#FF0000"><b>interface

uses </b></font>crt<font color="#000080">;

</font><font color="#FF0000"><b>type
    </b></font>Tpic<font color="#000080">=</font><font color="#FF0000"><b>record
               </b></font>xs<font color="#000080">,</font>ys<font color="#000080">:</font>word<font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font>Upic<font color="#000080">=</font><font color="#FF0000"><b>record
               </b></font>xs<font color="#000080">,</font>ys<font color="#000080">:</font>word<font color="#000080">;
               </font>data<font color="#000080">:</font>pointer<font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>getpic<font color="#000080">(</font>x1<font color="#000080">,</font>y1<font color="#000080">,</font>x2<font color="#000080">,</font>y2<font color="#000080">:</font>integer<font color="#000080">;</font><font color="#FF0000"><b>var </b></font>bitmap<font color="#000080">:</font>Upic<font color="#000080">;</font>where<font color="#000080">:</font>word<font color="#000080">);
</font><font color="#FF0000"><b>procedure </b></font>putpic<font color="#000080">(</font>x<font color="#000080">,</font>y<font color="#000080">:</font>word<font color="#000080">;</font>pic<font color="#000080">:</font>Upic<font color="#000080">;</font>where<font color="#000080">:</font>word<font color="#000080">);
</font><font color="#FF0000"><b>procedure </b></font>putcpic<font color="#000080">(</font>x<font color="#000080">,</font>y<font color="#000080">:</font>word<font color="#000080">;</font>pic<font color="#000080">:</font>Upic<font color="#000080">;</font>where<font color="#000080">:</font>word<font color="#000080">);
</font><font color="#FF0000"><b>procedure </b></font>savetopic<font color="#000080">(</font>x1<font color="#000080">,</font>y1<font color="#000080">,</font>x2<font color="#000080">,</font>y2<font color="#000080">:</font>word<font color="#000080">;</font>fn<font color="#000080">:</font><font color="#FF0000"><b>string</b></font><font color="#000080">;</font>where<font color="#000080">:</font>word<font color="#000080">);
</font><font color="#FF0000"><b>procedure </b></font>savepic<font color="#000080">(</font>pic<font color="#000080">:</font>Upic<font color="#000080">;</font>fn<font color="#000080">:</font><font color="#FF0000"><b>string</b></font><font color="#000080">);
</font><font color="#FF0000"><b>procedure </b></font>loadpic<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>pic<font color="#000080">:</font>Upic<font color="#000080">;</font>fn<font color="#000080">:</font><font color="#FF0000"><b>string</b></font><font color="#000080">);
</font><font color="#FF0000"><b>procedure </b></font>scalepic<font color="#000080">(</font>ox<font color="#000080">,</font>oy<font color="#000080">:</font>word<font color="#000080">;</font>pic<font color="#000080">:</font>Upic<font color="#000080">;</font>sc<font color="#000080">:</font>real<font color="#000080">;</font>where<font color="#000080">:</font>word<font color="#000080">);
</font><font color="#FF0000"><b>procedure </b></font>disposepic<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>pic<font color="#000080">:</font>Upic<font color="#000080">);


</font><font color="#FF0000"><b>implementation


procedure </b></font>getpic<font color="#000080">(</font>x1<font color="#000080">,</font>y1<font color="#000080">,</font>x2<font color="#000080">,</font>y2<font color="#000080">:</font>integer<font color="#000080">;</font><font color="#FF0000"><b>var </b></font>bitmap<font color="#000080">:</font>Upic<font color="#000080">;</font>where<font color="#000080">:</font>word<font color="#000080">);
</font><font color="#FF0000"><b>var
   </b></font>i<font color="#000080">,</font>line<font color="#000080">,</font>off<font color="#000080">:</font>word<font color="#000080">;
</font><font color="#FF0000"><b>begin
     </b></font>line<font color="#000080">:=</font>x1<font color="#000080">+</font>y1<font color="#000080">*</font><font color="#800000">320</font><font color="#000080">;
     </font>off<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
     </font>bitmap<font color="#000080">.</font>xs<font color="#000080">:=</font>abs<font color="#000080">(</font>x1<font color="#000080">-</font>x2<font color="#000080">);
     </font>bitmap<font color="#000080">.</font>ys<font color="#000080">:=</font>abs<font color="#000080">(</font>y1<font color="#000080">-</font>y2<font color="#000080">);
     </font>getmem<font color="#000080">(</font>bitmap<font color="#000080">.</font>data<font color="#000080">,</font>bitmap<font color="#000080">.</font>xs<font color="#000080">*</font>bitmap<font color="#000080">.</font>ys<font color="#000080">);
     </font><font color="#FF0000"><b>for </b></font>i<font color="#000080">:=</font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>bitmap<font color="#000080">.</font>ys <font color="#FF0000"><b>do begin
         </b></font>move<font color="#000080">(</font>mem<font color="#000080">[</font>where<font color="#000080">:</font>line<font color="#000080">],</font>mem<font color="#000080">[</font>seg<font color="#000080">(</font>bitmap<font color="#000080">.</font>data<font color="#000080">^):</font>off<font color="#000080">],</font>bitmap<font color="#000080">.</font>xs<font color="#000080">);
         </font>inc<font color="#000080">(</font>line<font color="#000080">,</font><font color="#800000">320</font><font color="#000080">);
         </font>inc<font color="#000080">(</font>off<font color="#000080">,</font>bitmap<font color="#000080">.</font>xs<font color="#000080">);
     </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>putpic<font color="#000080">(</font>x<font color="#000080">,</font>y<font color="#000080">:</font>word<font color="#000080">;</font>pic<font color="#000080">:</font>Upic<font color="#000080">;</font>where<font color="#000080">:</font>word<font color="#000080">);
</font><font color="#FF0000"><b>var
   </b></font>i<font color="#000080">,</font>off<font color="#000080">,</font>line<font color="#000080">:</font>word<font color="#000080">;

</font><font color="#FF0000"><b>begin
     </b></font>line<font color="#000080">:=</font>x<font color="#000080">+</font><font color="#800000">320</font><font color="#000080">*</font>y<font color="#000080">;
     </font>off<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
     </font><font color="#FF0000"><b>for </b></font>i<font color="#000080">:=</font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>pic<font color="#000080">.</font>ys <font color="#FF0000"><b>do begin
         </b></font>move<font color="#000080">(</font>mem<font color="#000080">[</font>seg<font color="#000080">(</font>pic<font color="#000080">.</font>data<font color="#000080">^):</font>ofs<font color="#000080">(</font>pic<font color="#000080">.</font>data<font color="#000080">^)+</font>off<font color="#000080">],</font>mem<font color="#000080">[</font>where<font color="#000080">:</font>line<font color="#000080">],</font>pic<font color="#000080">.</font>xs<font color="#000080">);
         </font>inc<font color="#000080">(</font>line<font color="#000080">,</font><font color="#800000">320</font><font color="#000080">);
         </font>inc<font color="#000080">(</font>off<font color="#000080">,</font>pic<font color="#000080">.</font>xs<font color="#000080">);
     </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>putcpic<font color="#000080">(</font>x<font color="#000080">,</font>y<font color="#000080">:</font>word<font color="#000080">;</font>pic<font color="#000080">:</font>Upic<font color="#000080">;</font>where<font color="#000080">:</font>word<font color="#000080">);
</font><font color="#FF0000"><b>var
   </b></font>i<font color="#000080">,</font>j<font color="#000080">,</font>off<font color="#000080">,</font>line<font color="#000080">:</font>word<font color="#000080">;
   </font>c<font color="#000080">:</font>byte<font color="#000080">;
</font><font color="#FF0000"><b>begin
     </b></font>line<font color="#000080">:=</font>x<font color="#000080">+</font><font color="#800000">320</font><font color="#000080">*</font>y<font color="#000080">;
     </font>off<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
     </font><font color="#FF0000"><b>for </b></font>i<font color="#000080">:=</font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>pic<font color="#000080">.</font>ys <font color="#FF0000"><b>do begin
         for </b></font>j<font color="#000080">:=</font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font>pic<font color="#000080">.</font>xs<font color="#000080">-</font><font color="#800000">1 </font><font color="#FF0000"><b>do begin
             </b></font>c<font color="#000080">:=</font>mem<font color="#000080">[</font>seg<font color="#000080">(</font>pic<font color="#000080">.</font>data<font color="#000080">^):</font>ofs<font color="#000080">(</font>pic<font color="#000080">.</font>data<font color="#000080">^)+</font>off<font color="#000080">];
             </font><font color="#FF0000"><b>if </b></font>c<font color="#000080">&lt;&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>then
                </b></font>mem<font color="#000080">[</font>where<font color="#000080">:</font>line<font color="#000080">+</font>j<font color="#000080">]:=</font>c<font color="#000080">;
             </font>inc<font color="#000080">(</font>off<font color="#000080">);
         </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
         </font>inc<font color="#000080">(</font>line<font color="#000080">,</font><font color="#800000">320</font><font color="#000080">);
     </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>savetopic<font color="#000080">(</font>x1<font color="#000080">,</font>y1<font color="#000080">,</font>x2<font color="#000080">,</font>y2<font color="#000080">:</font>word<font color="#000080">;</font>fn<font color="#000080">:</font><font color="#FF0000"><b>string</b></font><font color="#000080">;</font>where<font color="#000080">:</font>word<font color="#000080">);
</font><font color="#FF0000"><b>var
   </b></font>f<font color="#000080">:</font><font color="#FF0000"><b>file of </b></font>Tpic<font color="#000080">;
   </font>f2<font color="#000080">:</font><font color="#FF0000"><b>file</b></font><font color="#000080">;
   </font>a<font color="#000080">:</font>Upic<font color="#000080">;
   </font>b<font color="#000080">:</font>Tpic<font color="#000080">;
</font><font color="#FF0000"><b>begin
     </b></font>getpic<font color="#000080">(</font>x1<font color="#000080">,</font>y1<font color="#000080">,</font>x2<font color="#000080">,</font>y2<font color="#000080">,</font>a<font color="#000080">,</font>where<font color="#000080">);
     </font>b<font color="#000080">.</font>xs<font color="#000080">:=</font>a<font color="#000080">.</font>xs<font color="#000080">;
     </font>b<font color="#000080">.</font>ys<font color="#000080">:=</font>a<font color="#000080">.</font>ys<font color="#000080">;
     </font>assign<font color="#000080">(</font>f<font color="#000080">,</font>fn<font color="#000080">);
     </font>assign<font color="#000080">(</font>f2<font color="#000080">,</font>fn<font color="#000080">);
     </font>rewrite<font color="#000080">(</font>f<font color="#000080">);
     </font>write<font color="#000080">(</font>f<font color="#000080">,</font>b<font color="#000080">);
     </font>close<font color="#000080">(</font>f<font color="#000080">);
     </font>reset<font color="#000080">(</font>f2<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">);
     </font>seek<font color="#000080">(</font>f2<font color="#000080">,</font><font color="#800000">4</font><font color="#000080">);
     </font>blockwrite<font color="#000080">(</font>f2<font color="#000080">,</font>a<font color="#000080">.</font>data<font color="#000080">^,</font>a<font color="#000080">.</font>xs<font color="#000080">*</font>a<font color="#000080">.</font>ys<font color="#000080">);
     </font>close<font color="#000080">(</font>f2<font color="#000080">);
     </font>disposepic<font color="#000080">(</font>a<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>savepic<font color="#000080">(</font>pic<font color="#000080">:</font>Upic<font color="#000080">;</font>fn<font color="#000080">:</font><font color="#FF0000"><b>string</b></font><font color="#000080">);
</font><font color="#FF0000"><b>var
   </b></font>f<font color="#000080">:</font><font color="#FF0000"><b>file of </b></font>Tpic<font color="#000080">;
   </font>f2<font color="#000080">:</font><font color="#FF0000"><b>file</b></font><font color="#000080">;
   </font>b<font color="#000080">:</font>Tpic<font color="#000080">;
</font><font color="#FF0000"><b>begin
     </b></font>assign<font color="#000080">(</font>f<font color="#000080">,</font>fn<font color="#000080">);
     </font>assign<font color="#000080">(</font>f2<font color="#000080">,</font>fn<font color="#000080">);
     </font>b<font color="#000080">.</font>xs<font color="#000080">:=</font>pic<font color="#000080">.</font>xs<font color="#000080">;
     </font>b<font color="#000080">.</font>ys<font color="#000080">:=</font>pic<font color="#000080">.</font>ys<font color="#000080">;
     </font>rewrite<font color="#000080">(</font>f<font color="#000080">);
     </font>write<font color="#000080">(</font>f<font color="#000080">,</font>b<font color="#000080">);
     </font>close<font color="#000080">(</font>f<font color="#000080">);
     </font>reset<font color="#000080">(</font>f2<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">);
     </font>seek<font color="#000080">(</font>f2<font color="#000080">,</font><font color="#800000">4</font><font color="#000080">);
     </font>blockwrite<font color="#000080">(</font>f2<font color="#000080">,</font>pic<font color="#000080">.</font>data<font color="#000080">^,</font>pic<font color="#000080">.</font>xs<font color="#000080">*</font>pic<font color="#000080">.</font>ys<font color="#000080">);
     </font>close<font color="#000080">(</font>f2<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>loadpic<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>pic<font color="#000080">:</font>Upic<font color="#000080">;</font>fn<font color="#000080">:</font><font color="#FF0000"><b>string</b></font><font color="#000080">);
</font><font color="#FF0000"><b>var
   </b></font>f<font color="#000080">:</font><font color="#FF0000"><b>file of </b></font>Tpic<font color="#000080">;
   </font>f2<font color="#000080">:</font><font color="#FF0000"><b>file</b></font><font color="#000080">;
   </font>b<font color="#000080">:</font>Tpic<font color="#000080">;
</font><font color="#FF0000"><b>begin
     </b></font>assign<font color="#000080">(</font>f<font color="#000080">,</font>fn<font color="#000080">);
     </font>assign<font color="#000080">(</font>f2<font color="#000080">,</font>fn<font color="#000080">);
     </font>reset<font color="#000080">(</font>f<font color="#000080">);
     </font>read<font color="#000080">(</font>f<font color="#000080">,</font>b<font color="#000080">);
     </font>close<font color="#000080">(</font>f<font color="#000080">);
     </font>pic<font color="#000080">.</font>xs<font color="#000080">:=</font>b<font color="#000080">.</font>xs<font color="#000080">;
     </font>pic<font color="#000080">.</font>ys<font color="#000080">:=</font>b<font color="#000080">.</font>ys<font color="#000080">;
     </font>getmem<font color="#000080">(</font>pic<font color="#000080">.</font>data<font color="#000080">,</font>pic<font color="#000080">.</font>xs<font color="#000080">*</font>pic<font color="#000080">.</font>ys<font color="#000080">);
     </font>reset<font color="#000080">(</font>f2<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">);
     </font>seek<font color="#000080">(</font>f2<font color="#000080">,</font><font color="#800000">4</font><font color="#000080">);
     </font>blockread<font color="#000080">(</font>f2<font color="#000080">,</font>pic<font color="#000080">.</font>data<font color="#000080">^,</font>pic<font color="#000080">.</font>xs<font color="#000080">*</font>pic<font color="#000080">.</font>ys<font color="#000080">);
     </font>close<font color="#000080">(</font>f2<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>scalepic<font color="#000080">(</font>ox<font color="#000080">,</font>oy<font color="#000080">:</font>word<font color="#000080">;</font>pic<font color="#000080">:</font>Upic<font color="#000080">;</font>sc<font color="#000080">:</font>real<font color="#000080">;</font>where<font color="#000080">:</font>word<font color="#000080">);
</font><font color="#FF0000"><b>var
   </b></font>x<font color="#000080">,</font>y<font color="#000080">,</font>wo<font color="#000080">,</font>off<font color="#000080">:</font>integer<font color="#000080">;
   </font>yscalei<font color="#000080">,</font>xscales<font color="#000080">,</font>yscales<font color="#000080">,</font>xscalei<font color="#000080">,</font>sc2<font color="#000080">,</font>sc3<font color="#000080">:</font>real<font color="#000080">;
   </font>data<font color="#000080">:</font>byte<font color="#000080">;
</font><font color="#FF0000"><b>begin
     </b></font>off<font color="#000080">:=</font>ox<font color="#000080">+</font>oy<font color="#000080">*</font><font color="#800000">320</font><font color="#000080">;
     </font>wo<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
     </font>data<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
     </font>yscalei<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
     </font>sc2<font color="#000080">:=</font>sc<font color="#000080">*</font>pic<font color="#000080">.</font>xs<font color="#000080">;
     </font>sc3<font color="#000080">:=</font>sc<font color="#000080">*</font>pic<font color="#000080">.</font>ys<font color="#000080">;
     </font>yscales<font color="#000080">:=</font>pic<font color="#000080">.</font>ys<font color="#000080">/</font>sc3<font color="#000080">;
     </font>xscales<font color="#000080">:=</font>pic<font color="#000080">.</font>xs<font color="#000080">/</font>sc2<font color="#000080">;
     </font><font color="#FF0000"><b>for </b></font>y<font color="#000080">:=</font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font>trunc<font color="#000080">(</font>sc3<font color="#000080">)-</font><font color="#800000">1 </font><font color="#FF0000"><b>do begin
         </b></font>xscalei<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
         </font><font color="#FF0000"><b>for </b></font>x<font color="#000080">:=</font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font>trunc<font color="#000080">(</font>sc2<font color="#000080">)-</font><font color="#800000">1 </font><font color="#FF0000"><b>do begin
             </b></font>data<font color="#000080">:=</font>mem<font color="#000080">[</font>seg<font color="#000080">(</font>pic<font color="#000080">.</font>data<font color="#000080">^):</font>ofs<font color="#000080">(</font>pic<font color="#000080">.</font>data<font color="#000080">^)+</font>wo<font color="#000080">+</font>trunc<font color="#000080">(</font>xscalei<font color="#000080">)];
             </font><font color="#FF0000"><b>if </b></font>data<font color="#000080">&lt;&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>mem<font color="#000080">[</font>where<font color="#000080">:</font>off<font color="#000080">+</font>x<font color="#000080">]:=</font>data<font color="#000080">;
             </font>xscalei<font color="#000080">:=</font>xscalei<font color="#000080">+</font>xscales<font color="#000080">;
         </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
         </font>yscalei<font color="#000080">:=</font>yscalei<font color="#000080">+</font>yscales<font color="#000080">;
         </font>inc<font color="#000080">(</font>off<font color="#000080">,</font><font color="#800000">320</font><font color="#000080">);
         </font>wo<font color="#000080">:=</font>pic<font color="#000080">.</font>xs<font color="#000080">*</font>trunc<font color="#000080">(</font>yscalei<font color="#000080">);
     </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>procedure </b></font>disposepic<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>pic<font color="#000080">:</font>Upic<font color="#000080">);
</font><font color="#FF0000"><b>begin
     if </b></font>pic<font color="#000080">.</font>data<font color="#000080">=</font><font color="#FF0000"><b>nil then </b></font>exit
     <font color="#FF0000"><b>else </b></font>freemem<font color="#000080">(</font>pic<font color="#000080">.</font>data<font color="#000080">,</font>pic<font color="#000080">.</font>xs<font color="#000080">*</font>pic<font color="#000080">.</font>ys<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>end</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to GRAPHICS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0265.PAS">Original</a><b>]</b></p></body>
</html>
