<html>
<head><title> "7 Segment clock" by WIM VAN DER VEGT</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to GRAPHICS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0084.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
Here's the source of a seven segment display useful to place at the end
of your autoexec if you also have the habit of turning your computer on
long before using it or want an expensive clock (works then best on a
66Mhz DX2 or Pentium).


The BGI_01 unit just links in the BGI driver. If removed you'll have to
supply EGAVGA.BGI in the current directory (Or get the source of the
unit from a previous message).


Start it with SEGMENT 15 and a bright yellow clock will appear.


-------------------------&lt;cut here

{---------------------------------------------------------}
{  Project : Seven Segment Display                        }
{  Auteur  : Ir. G.W. van der Vegt                        }
{---------------------------------------------------------}
{  Datum .tijd  Revisie                                   }
{  901025.2000  Creatie.                                  }
{---------------------------------------------------------}

</i></font><font color="#FF0000"><b>PROGRAM </b></font>Segment<font color="#000080">(</font>INPUT<font color="#000080">,</font>OUTPUT<font color="#000080">);

</font><font color="#FF0000"><b>USES
  </b></font>CRT<font color="#000080">,
  </font>DOS<font color="#000080">,
  </font>GRAPH<font color="#000080">,
  </font>BGI_01<font color="#000080">;

</font><font color="#FF0000"><b>VAR
  </b></font>cl <font color="#000080">: </font>INTEGER<font color="#000080">;

</font><font color="#008000"><i>{---------------------------------------------------------}
{----Routine to display ASCII as seven segment LED display}
{---------------------------------------------------------}

</i></font><font color="#FF0000"><b>PROCEDURE </b></font>Segments<font color="#000080">(</font>nch<font color="#000080">,</font>och <font color="#000080">: </font>CHAR<font color="#000080">;</font>xc<font color="#000080">,</font>yc <font color="#000080">: </font>INTEGER<font color="#000080">;</font>scale <font color="#000080">: </font>REAL<font color="#000080">);

</font><font color="#008000"><i>{---------------------------------------------------------}
{----Types &amp; const for graphical LED segment definition   }
{---------------------------------------------------------}

</i></font><font color="#FF0000"><b>TYPE
  </b></font>seg <font color="#000080">= </font><font color="#FF0000"><b>ARRAY</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">7</font><font color="#000080">] </font><font color="#FF0000"><b>OF </b></font>Pointtype<font color="#000080">;

</font><font color="#FF0000"><b>CONST
  </b></font>Ver   <font color="#000080">: </font>seg <font color="#000080">= ((</font>x <font color="#000080">:   </font><font color="#800000">1</font><font color="#000080">; </font>y <font color="#000080">:   </font><font color="#800000">0</font><font color="#000080">),(</font>x <font color="#000080">:   </font><font color="#800000">0</font><font color="#000080">; </font>y <font color="#000080">:   </font><font color="#800000">1</font><font color="#000080">),
                 (</font>x <font color="#000080">:   </font><font color="#800000">0</font><font color="#000080">; </font>y <font color="#000080">:   </font><font color="#800000">9</font><font color="#000080">),(</font>x <font color="#000080">:   </font><font color="#800000">1</font><font color="#000080">; </font>y <font color="#000080">:  </font><font color="#800000">10</font><font color="#000080">),
                 (</font>x <font color="#000080">:   </font><font color="#800000">2</font><font color="#000080">; </font>y <font color="#000080">:   </font><font color="#800000">9</font><font color="#000080">),(</font>x <font color="#000080">:   </font><font color="#800000">2</font><font color="#000080">; </font>y <font color="#000080">:   </font><font color="#800000">1</font><font color="#000080">),
                 (</font>x <font color="#000080">:   </font><font color="#800000">1</font><font color="#000080">; </font>y <font color="#000080">:   </font><font color="#800000">0</font><font color="#000080">)                  );

  </font>Hor   <font color="#000080">: </font>seg <font color="#000080">= ((</font>x <font color="#000080">:   </font><font color="#800000">0</font><font color="#000080">; </font>y <font color="#000080">:   </font><font color="#800000">1</font><font color="#000080">),(</font>x <font color="#000080">:   </font><font color="#800000">1</font><font color="#000080">; </font>y <font color="#000080">:   </font><font color="#800000">0</font><font color="#000080">),
                 (</font>x <font color="#000080">:   </font><font color="#800000">9</font><font color="#000080">; </font>y <font color="#000080">:   </font><font color="#800000">0</font><font color="#000080">),(</font>x <font color="#000080">:  </font><font color="#800000">10</font><font color="#000080">; </font>y <font color="#000080">:   </font><font color="#800000">1</font><font color="#000080">),
                 (</font>x <font color="#000080">:   </font><font color="#800000">9</font><font color="#000080">; </font>y <font color="#000080">:   </font><font color="#800000">2</font><font color="#000080">),(</font>x <font color="#000080">:   </font><font color="#800000">1</font><font color="#000080">; </font>y <font color="#000080">:   </font><font color="#800000">2</font><font color="#000080">),
                 (</font>x <font color="#000080">:   </font><font color="#800000">0</font><font color="#000080">; </font>y <font color="#000080">:   </font><font color="#800000">1</font><font color="#000080">)                  );

  </font>DPdot <font color="#000080">: </font>seg <font color="#000080">= ((</font>x <font color="#000080">:   </font><font color="#800000">1</font><font color="#000080">; </font>y <font color="#000080">:   </font><font color="#800000">1</font><font color="#000080">),(</font>x <font color="#000080">:   </font><font color="#800000">2</font><font color="#000080">; </font>y <font color="#000080">:   </font><font color="#800000">0</font><font color="#000080">),
                 (</font>x <font color="#000080">:   </font><font color="#800000">2</font><font color="#000080">; </font>y <font color="#000080">:   </font><font color="#800000">1</font><font color="#000080">),(</font>x <font color="#000080">:   </font><font color="#800000">2</font><font color="#000080">; </font>y <font color="#000080">:   </font><font color="#800000">2</font><font color="#000080">),
                 (</font>x <font color="#000080">:   </font><font color="#800000">1</font><font color="#000080">; </font>y <font color="#000080">:   </font><font color="#800000">2</font><font color="#000080">),(</font>x <font color="#000080">:   </font><font color="#800000">0</font><font color="#000080">; </font>y <font color="#000080">:   </font><font color="#800000">2</font><font color="#000080">),
                 (</font>x <font color="#000080">:   </font><font color="#800000">1</font><font color="#000080">; </font>y <font color="#000080">:   </font><font color="#800000">1</font><font color="#000080">)                   );

  </font>SCDot <font color="#000080">: </font>seg <font color="#000080">= ((</font>x <font color="#000080">:   </font><font color="#800000">4</font><font color="#000080">; </font>y <font color="#000080">:   </font><font color="#800000">4</font><font color="#000080">),(</font>x <font color="#000080">:   </font><font color="#800000">4</font><font color="#000080">; </font>y <font color="#000080">:   </font><font color="#800000">6</font><font color="#000080">),
                 (</font>x <font color="#000080">:   </font><font color="#800000">6</font><font color="#000080">; </font>y <font color="#000080">:   </font><font color="#800000">6</font><font color="#000080">),(</font>x <font color="#000080">:   </font><font color="#800000">6</font><font color="#000080">; </font>y <font color="#000080">:   </font><font color="#800000">4</font><font color="#000080">),
                 (</font>x <font color="#000080">:   </font><font color="#800000">4</font><font color="#000080">; </font>y <font color="#000080">:   </font><font color="#800000">4</font><font color="#000080">),(</font>x <font color="#000080">:   </font><font color="#800000">4</font><font color="#000080">; </font>y <font color="#000080">:   </font><font color="#800000">4</font><font color="#000080">),
                 (</font>x <font color="#000080">:   </font><font color="#800000">4</font><font color="#000080">; </font>y <font color="#000080">:   </font><font color="#800000">4</font><font color="#000080">)                   );

</font><font color="#FF0000"><b>Type
  </b></font>dir  <font color="#000080">= (</font>vertical<font color="#000080">,</font>horizontal<font color="#000080">,</font>decimal<font color="#000080">,</font>dot<font color="#000080">);

</font><font color="#008000"><i>{---------------------------------------------------------}
{----Routine to hide/display a segment                    }
{---------------------------------------------------------}

</i></font><font color="#FF0000"><b>PROCEDURE </b></font>Dispsegm<font color="#000080">(</font>dir <font color="#000080">: </font>dir<font color="#000080">;</font>show <font color="#000080">: </font>BOOLEAN<font color="#000080">; </font>m<font color="#000080">,</font>dx<font color="#000080">,</font>dy <font color="#000080">: </font>REAL<font color="#000080">);

</font><font color="#FF0000"><b>VAR
  </b></font>segm <font color="#000080">: </font>seg<font color="#000080">;
  </font>i    <font color="#000080">: </font>INTEGER<font color="#000080">;

</font><font color="#FF0000"><b>BEGIN
  CASE </b></font>dir <font color="#FF0000"><b>OF
    </b></font>vertical   <font color="#000080">: </font>segm<font color="#000080">:=</font>ver<font color="#000080">;
    </font>horizontal <font color="#000080">: </font>segm<font color="#000080">:=</font>hor<font color="#000080">;
    </font>decimal    <font color="#000080">: </font>segm<font color="#000080">:=</font>DPdot<font color="#000080">;
    </font>dot        <font color="#000080">: </font>segm<font color="#000080">:=</font>SCdot<font color="#000080">;
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>FOR </b></font>i<font color="#000080">:=</font><font color="#800000">1 </font><font color="#FF0000"><b>TO </b></font><font color="#800000">7 </font><font color="#FF0000"><b>DO
    BEGIN
      </b></font>segm<font color="#000080">[</font>i<font color="#000080">].</font>x<font color="#000080">:=</font>TRUNC<font color="#000080">((</font>segm<font color="#000080">[</font>i<font color="#000080">].</font>x<font color="#000080">+</font>dx<font color="#000080">)*</font>m<font color="#000080">)+</font>xc<font color="#000080">;
      </font>segm<font color="#000080">[</font>i<font color="#000080">].</font>y<font color="#000080">:=</font>TRUNC<font color="#000080">((</font>segm<font color="#000080">[</font>i<font color="#000080">].</font>y<font color="#000080">+</font>dy<font color="#000080">)*</font>m<font color="#000080">)+</font>yc<font color="#000080">;
    </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>IF </b></font>show
    <font color="#FF0000"><b>THEN </b></font>setfillstyle<font color="#000080">(</font>solidfill<font color="#000080">,</font>cl<font color="#000080">)
    </font><font color="#FF0000"><b>ELSE </b></font>setfillstyle<font color="#000080">(</font>solidfill<font color="#000080">,</font>black<font color="#000080">);

  </font>Fillpoly<font color="#000080">(</font><font color="#800000">7</font><font color="#000080">,</font>segm<font color="#000080">);
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#008000"><i>{---------------------------------------------------------}
{----Types &amp; Const for 7 segment display codes definitions}
{---------------------------------------------------------}

</i></font><font color="#FF0000"><b>TYPE
  </b></font>leds  <font color="#000080">= (</font>a<font color="#000080">,</font>b<font color="#000080">,</font>c<font color="#000080">,</font>d<font color="#000080">,</font>e<font color="#000080">,</font>f<font color="#000080">,</font>g<font color="#000080">,</font>dp<font color="#000080">,</font>dl<font color="#000080">,</font>dh<font color="#000080">);
  </font>offst <font color="#000080">= </font><font color="#FF0000"><b>RECORD
            </b></font>dx<font color="#000080">,</font>dy <font color="#000080">: </font>REAL<font color="#000080">;
            </font>d     <font color="#000080">: </font>dir<font color="#000080">;
          </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
  </font>disp  <font color="#000080">= </font><font color="#FF0000"><b>SET OF </b></font>leds<font color="#000080">;

</font><font color="#FF0000"><b>CONST
  </b></font>rel <font color="#000080">: </font><font color="#FF0000"><b>ARRAY</b></font><font color="#000080">[</font>leds<font color="#000080">] </font><font color="#FF0000"><b>OF </b></font>offst <font color="#000080">=
        ((</font>dx <font color="#000080">: </font><font color="#800000">1.0</font><font color="#000080">;</font>dy <font color="#000080">: </font><font color="#800000">0.0</font><font color="#000080">; </font>d <font color="#000080">: </font>horizontal<font color="#000080">),
         (</font>dx <font color="#000080">: </font><font color="#800000">0.0</font><font color="#000080">;</font>dy <font color="#000080">: </font><font color="#800000">1.0</font><font color="#000080">; </font>d <font color="#000080">: </font>vertical  <font color="#000080">),
         (</font>dx <font color="#000080">: </font><font color="#800000">0.0</font><font color="#000080">;</font>dy <font color="#000080">:</font><font color="#800000">11.0</font><font color="#000080">; </font>d <font color="#000080">: </font>vertical  <font color="#000080">),
         (</font>dx <font color="#000080">: </font><font color="#800000">1.0</font><font color="#000080">;</font>dy <font color="#000080">:</font><font color="#800000">20.0</font><font color="#000080">; </font>d <font color="#000080">: </font>horizontal<font color="#000080">),
         (</font>dx <font color="#000080">:</font><font color="#800000">10.0</font><font color="#000080">;</font>dy <font color="#000080">:</font><font color="#800000">11.0</font><font color="#000080">; </font>d <font color="#000080">: </font>vertical  <font color="#000080">),
         (</font>dx <font color="#000080">:</font><font color="#800000">10.0</font><font color="#000080">;</font>dy <font color="#000080">: </font><font color="#800000">1.0</font><font color="#000080">; </font>d <font color="#000080">: </font>vertical  <font color="#000080">),
         (</font>dx <font color="#000080">: </font><font color="#800000">1.0</font><font color="#000080">;</font>dy <font color="#000080">:</font><font color="#800000">10.0</font><font color="#000080">; </font>d <font color="#000080">: </font>horizontal<font color="#000080">),
         (</font>dx <font color="#000080">:</font><font color="#800000">11.0</font><font color="#000080">;</font>dy <font color="#000080">:</font><font color="#800000">21.0</font><font color="#000080">; </font>d <font color="#000080">: </font>decimal   <font color="#000080">),
         (</font>dx <font color="#000080">: </font><font color="#800000">1.0</font><font color="#000080">;</font>dy <font color="#000080">: </font><font color="#800000">1.0</font><font color="#000080">; </font>d <font color="#000080">: </font>dot       <font color="#000080">),
         (</font>dx <font color="#000080">: </font><font color="#800000">1.0</font><font color="#000080">;</font>dy <font color="#000080">:</font><font color="#800000">11.0</font><font color="#000080">; </font>d <font color="#000080">: </font>dot       <font color="#000080">));

</font><font color="#008000"><i>{---------------------------------------------------------}
{----Routine to convert ASCII to 7 segments               }
{---------------------------------------------------------}

</i></font><font color="#FF0000"><b>PROCEDURE </b></font>Calcleds<font color="#000080">(</font>ch <font color="#000080">: </font>CHAR<font color="#000080">;</font><font color="#FF0000"><b>VAR </b></font>sseg <font color="#000080">: </font>disp<font color="#000080">);

</font><font color="#FF0000"><b>BEGIN
  CASE </b></font>ch <font color="#FF0000"><b>OF
    </b></font><font color="#800000">'0' </font><font color="#000080">: </font>sseg<font color="#000080">:=[</font>a<font color="#000080">,</font>b<font color="#000080">,</font>c<font color="#000080">,</font>d<font color="#000080">,</font>e<font color="#000080">,</font>f<font color="#000080">];
    </font><font color="#800000">'1' </font><font color="#000080">: </font>sseg<font color="#000080">:=[</font>e<font color="#000080">,</font>f<font color="#000080">];
    </font><font color="#800000">'2' </font><font color="#000080">: </font>sseg<font color="#000080">:=[</font>a<font color="#000080">,</font>c<font color="#000080">,</font>d<font color="#000080">,</font>f<font color="#000080">,</font>g<font color="#000080">];
    </font><font color="#800000">'3' </font><font color="#000080">: </font>sseg<font color="#000080">:=[</font>a<font color="#000080">,</font>d<font color="#000080">,</font>e<font color="#000080">,</font>f<font color="#000080">,</font>g<font color="#000080">];
    </font><font color="#800000">'4' </font><font color="#000080">: </font>sseg<font color="#000080">:=[</font>b<font color="#000080">,</font>e<font color="#000080">,</font>f<font color="#000080">,</font>g<font color="#000080">];
    </font><font color="#800000">'5' </font><font color="#000080">: </font>sseg<font color="#000080">:=[</font>a<font color="#000080">,</font>b<font color="#000080">,</font>d<font color="#000080">,</font>e<font color="#000080">,</font>g<font color="#000080">];
    </font><font color="#800000">'6' </font><font color="#000080">: </font>sseg<font color="#000080">:=[</font>a<font color="#000080">,</font>b<font color="#000080">,</font>c<font color="#000080">,</font>d<font color="#000080">,</font>e<font color="#000080">,</font>g<font color="#000080">];
    </font><font color="#800000">'7' </font><font color="#000080">: </font>sseg<font color="#000080">:=[</font>a<font color="#000080">,</font>e<font color="#000080">,</font>f<font color="#000080">];
    </font><font color="#800000">'8' </font><font color="#000080">: </font>sseg<font color="#000080">:=[</font>a<font color="#000080">,</font>b<font color="#000080">,</font>c<font color="#000080">,</font>d<font color="#000080">,</font>e<font color="#000080">,</font>f<font color="#000080">,</font>g<font color="#000080">];
    </font><font color="#800000">'9' </font><font color="#000080">: </font>sseg<font color="#000080">:=[</font>a<font color="#000080">,</font>b<font color="#000080">,</font>d<font color="#000080">,</font>e<font color="#000080">,</font>f<font color="#000080">,</font>g<font color="#000080">];
    </font><font color="#800000">'-' </font><font color="#000080">: </font>sseg<font color="#000080">:=[</font>g<font color="#000080">];
    </font><font color="#800000">'-' </font><font color="#000080">: </font>sseg<font color="#000080">:=[</font>d<font color="#000080">];
    </font><font color="#800000">'^' </font><font color="#000080">: </font>sseg<font color="#000080">:=[</font>a<font color="#000080">];
    </font><font color="#800000">':' </font><font color="#000080">: </font>sseg<font color="#000080">:=[</font>dl<font color="#000080">,</font>dh<font color="#000080">];
    </font><font color="#800000">'&eth;' </font><font color="#000080">: </font>sseg<font color="#000080">:=[</font>a<font color="#000080">,</font>d<font color="#000080">,</font>g<font color="#000080">];
    </font><font color="#800000">'.' </font><font color="#000080">: </font>sseg<font color="#000080">:=[</font>dp<font color="#000080">];
  </font><font color="#FF0000"><b>ELSE </b></font>sseg<font color="#000080">:=[];
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>VAR
  </b></font>led     <font color="#000080">: </font>leds<font color="#000080">;
  </font>oseg<font color="#000080">,
  </font>nseg<font color="#000080">,
  </font>offseg<font color="#000080">,
  </font>onseg   <font color="#000080">: </font>disp<font color="#000080">;

</font><font color="#FF0000"><b>BEGIN
  </b></font>Setcolor<font color="#000080">(</font>DarkGray<font color="#000080">);

  </font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>nch<font color="#000080">=</font><font color="#800000">#0</font><font color="#000080">) </font><font color="#FF0000"><b>AND </b></font><font color="#000080">(</font>och<font color="#000080">=</font><font color="#800000">#0</font><font color="#000080">)
    </font><font color="#FF0000"><b>THEN
      BEGIN
        </b></font>offseg<font color="#000080">:=[</font>a<font color="#000080">,</font>b<font color="#000080">,</font>c<font color="#000080">,</font>d<font color="#000080">,</font>e<font color="#000080">,</font>f<font color="#000080">,</font>g<font color="#000080">,</font>dp<font color="#000080">,</font>dl<font color="#000080">,</font>dh<font color="#000080">];
        </font>onseg <font color="#000080">:=[];
      </font><font color="#FF0000"><b>END
    ELSE
      BEGIN
        </b></font>Calcleds<font color="#000080">(</font>och<font color="#000080">,</font>oseg<font color="#000080">);
        </font>Calcleds<font color="#000080">(</font>nch<font color="#000080">,</font>nseg<font color="#000080">);

        </font>onseg <font color="#000080">:=</font>nseg<font color="#000080">-</font>oseg<font color="#000080">-</font>oseg<font color="#000080">*</font>nseg<font color="#000080">;    </font><font color="#008000"><i>{----Leds to turn on }
        </i></font>offseg<font color="#000080">:=</font>oseg<font color="#000080">-</font>nseg<font color="#000080">-</font>oseg<font color="#000080">*</font>nseg<font color="#000080">;    </font><font color="#008000"><i>{----Leds to turn off}
      </i></font><font color="#FF0000"><b>END</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>FOR </b></font>led<font color="#000080">:=</font>a <font color="#FF0000"><b>TO </b></font>dh <font color="#FF0000"><b>DO
    WITH </b></font>rel<font color="#000080">[</font>led<font color="#000080">] </font><font color="#FF0000"><b>DO
      BEGIN
        IF </b></font>led <font color="#FF0000"><b>IN  </b></font>onseg <font color="#FF0000"><b>THEN </b></font>Dispsegm<font color="#000080">(</font>d<font color="#000080">, </font>true<font color="#000080">,</font>scale<font color="#000080">,</font>dx<font color="#000080">,</font>dy<font color="#000080">);
        </font><font color="#FF0000"><b>IF </b></font>led <font color="#FF0000"><b>IN </b></font>offseg <font color="#FF0000"><b>THEN </b></font>Dispsegm<font color="#000080">(</font>d<font color="#000080">,</font>false<font color="#000080">,</font>scale<font color="#000080">,</font>dx<font color="#000080">,</font>dy<font color="#000080">);
      </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#008000"><i>{---------------------------------------------------------}
{----Prints error msg &amp; halts program                     }
{---------------------------------------------------------}

</i></font><font color="#FF0000"><b>PROCEDURE </b></font>Error<font color="#000080">(</font>s <font color="#000080">: </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">);

</font><font color="#FF0000"><b>BEGIN
  </b></font>CLRSCR<font color="#000080">;
  </font>WRITELN<font color="#000080">;
  </font>WRITELN<font color="#000080">(</font><font color="#800000">'SYNTAX : Segment &lt;color&gt;'</font><font color="#000080">);
  </font>WRITELN<font color="#000080">;
  </font>WRITELN<font color="#000080">(</font><font color="#800000">'ERROR    '</font><font color="#000080">,</font>s<font color="#000080">);
  </font>WRITELN<font color="#000080">;
  </font>HALT<font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#008000"><i>{---------------------------------------------------------}
{----Main Program                                         }
{---------------------------------------------------------}

</i></font><font color="#FF0000"><b>VAR
  </b></font>tmp<font color="#000080">,
  </font>h<font color="#000080">,</font>m<font color="#000080">,</font>s<font color="#000080">,</font>ms <font color="#000080">: </font>WORD<font color="#000080">;
  </font>i<font color="#000080">,</font>e      <font color="#000080">: </font>INTEGER<font color="#000080">;

  </font>c1<font color="#000080">,</font>c2<font color="#000080">,</font>c3 <font color="#000080">: </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">[</font><font color="#800000">2</font><font color="#000080">];

  </font>olds<font color="#000080">,
  </font>news     <font color="#000080">: </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">;

  </font>grdriver<font color="#000080">,
  </font>grmode<font color="#000080">,
  </font>errcode <font color="#000080">: </font>INTEGER<font color="#000080">;

  </font>r       <font color="#000080">: </font>REGISTERS<font color="#000080">;
  </font>oldstate<font color="#000080">: </font>BYTE<font color="#000080">;

</font><font color="#008000"><i>{---------------------------------------------------------}

</i></font><font color="#FF0000"><b>BEGIN

  </b></font>Grdriver<font color="#000080">:=</font>detect<font color="#000080">;
  </font>DetectGraph<font color="#000080">(</font>grdriver<font color="#000080">,</font>grmode<font color="#000080">);

</font><font color="#008000"><i>{----Allow segment color to be chosen by user}
  </i></font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>PARAMCOUNT<font color="#000080">=</font><font color="#800000">1</font><font color="#000080">)
    </font><font color="#FF0000"><b>THEN
      BEGIN
        </b></font>VAL<font color="#000080">(</font>PARAMSTR<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">),</font>cl<font color="#000080">,</font>e<font color="#000080">);
        </font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>e<font color="#000080">&lt;&gt;</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>THEN </b></font>Error<font color="#000080">(</font><font color="#800000">'Incorrcet Parameter'</font><font color="#000080">);
      </font><font color="#FF0000"><b>END
    ELSE
      CASE </b></font>grdriver <font color="#FF0000"><b>OF
        </b></font>mcga<font color="#000080">,
        </font>egamono <font color="#000080">: </font>cl<font color="#000080">:=</font><font color="#800000">1</font><font color="#000080">;
        </font>ega64   <font color="#000080">: </font>cl<font color="#000080">:=</font><font color="#800000">3</font><font color="#000080">;
        </font>ega<font color="#000080">,
        </font>vga     <font color="#000080">: </font>cl<font color="#000080">:=</font><font color="#800000">15</font><font color="#000080">;
      </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>CASE </b></font>grdriver <font color="#FF0000"><b>OF
    </b></font>mcga    <font color="#000080">: </font><font color="#FF0000"><b>IF NOT </b></font><font color="#000080">(</font>cl <font color="#FF0000"><b>IN </b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">])
                </font><font color="#FF0000"><b>THEN </b></font>Error<font color="#000080">(</font><font color="#800000">'With MCGA only color 1 is allowed'</font><font color="#000080">);
    </font>ega64   <font color="#000080">: </font><font color="#FF0000"><b>IF NOT </b></font><font color="#000080">(</font>cl <font color="#FF0000"><b>IN </b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">3</font><font color="#000080">])
                </font><font color="#FF0000"><b>THEN </b></font>Error<font color="#000080">(</font><font color="#800000">'With 64 K EGA only colors 1..4 are allowed'</font><font color="#000080">);
    </font>egamono <font color="#000080">: </font><font color="#FF0000"><b>IF NOT </b></font><font color="#000080">(</font>cl <font color="#FF0000"><b>IN </b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">])
                </font><font color="#FF0000"><b>THEN </b></font>Error<font color="#000080">(</font><font color="#800000">'With EGA mono only color 1 is allowed'</font><font color="#000080">);
    </font>ega     <font color="#000080">: </font><font color="#FF0000"><b>IF NOT </b></font><font color="#000080">(</font>cl <font color="#FF0000"><b>IN </b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">15</font><font color="#000080">])
                </font><font color="#FF0000"><b>THEN </b></font>Error<font color="#000080">(</font><font color="#800000">'With 256 K EGA only colors 1..15 are allowed'</font><font color="#000080">);
    </font>vga     <font color="#000080">: </font><font color="#FF0000"><b>IF NOT </b></font><font color="#000080">(</font>cl <font color="#FF0000"><b>IN </b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">15</font><font color="#000080">])
                </font><font color="#FF0000"><b>THEN </b></font>Error<font color="#000080">(</font><font color="#800000">'With VGA only colors 1..15 are allowed'</font><font color="#000080">);
  </font><font color="#FF0000"><b>ELSE </b></font>Error<font color="#000080">(</font><font color="#800000">'Graphics Adapter NOT Supported'</font><font color="#000080">);
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

  </font>Initgraph<font color="#000080">(</font>grdriver<font color="#000080">,</font>grmode<font color="#000080">,</font><font color="#800000">''</font><font color="#000080">);
  </font>errcode<font color="#000080">:=</font>Graphresult<font color="#000080">;

  </font>news<font color="#000080">:=</font><font color="#800000">'        '</font><font color="#000080">;
  </font>olds<font color="#000080">:=</font><font color="#800000">'        '</font><font color="#000080">;

  </font><font color="#FF0000"><b>FOR </b></font>i<font color="#000080">:=</font><font color="#800000">1 </font><font color="#FF0000"><b>TO </b></font>LENGTH<font color="#000080">(</font>news<font color="#000080">) </font><font color="#FF0000"><b>DO </b></font>Segments<font color="#000080">(</font><font color="#800000">#0</font><font color="#000080">,</font><font color="#800000">#0</font><font color="#000080">,</font><font color="#800000">80</font><font color="#000080">*(</font>i<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">),</font><font color="#800000">80</font><font color="#000080">,</font><font color="#800000">6.0</font><font color="#000080">);

  </font>r<font color="#000080">.</font>ah<font color="#000080">:=</font><font color="#800000">$02</font><font color="#000080">;
  </font>INTR<font color="#000080">(</font><font color="#800000">$16</font><font color="#000080">,</font>r<font color="#000080">);

  </font><font color="#FF0000"><b>REPEAT
    </b></font>oldstate<font color="#000080">:=</font>r<font color="#000080">.</font>al<font color="#000080">;

    </font>GETTIME<font color="#000080">(</font>h<font color="#000080">,</font>m<font color="#000080">,</font>s<font color="#000080">,</font>ms<font color="#000080">);

    </font>STR<font color="#000080">(</font>h<font color="#000080">:</font><font color="#800000">2</font><font color="#000080">,</font>c1<font color="#000080">);
    </font>STR<font color="#000080">(</font>m<font color="#000080">:</font><font color="#800000">2</font><font color="#000080">,</font>c2<font color="#000080">);
    </font>STR<font color="#000080">(</font>s<font color="#000080">:</font><font color="#800000">2</font><font color="#000080">,</font>c3<font color="#000080">);

    </font><font color="#FF0000"><b>IF </b></font>Odd<font color="#000080">(</font>s<font color="#000080">)
      </font><font color="#FF0000"><b>THEN </b></font>news<font color="#000080">:=</font>c1<font color="#000080">+</font><font color="#800000">':'</font><font color="#000080">+</font>c2<font color="#000080">+</font><font color="#800000">':'</font><font color="#000080">+</font>c3
      <font color="#FF0000"><b>ELSE </b></font>news<font color="#000080">:=</font>c1<font color="#000080">+</font><font color="#800000">' '</font><font color="#000080">+</font>c2<font color="#000080">+</font><font color="#800000">' '</font><font color="#000080">+</font>c3<font color="#000080">;

    </font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>news<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">]=</font><font color="#800000">' '</font><font color="#000080">) </font><font color="#FF0000"><b>THEN </b></font>news<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">]:=</font><font color="#800000">'0'</font><font color="#000080">;
    </font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>news<font color="#000080">[</font><font color="#800000">4</font><font color="#000080">]=</font><font color="#800000">' '</font><font color="#000080">) </font><font color="#FF0000"><b>THEN </b></font>news<font color="#000080">[</font><font color="#800000">4</font><font color="#000080">]:=</font><font color="#800000">'0'</font><font color="#000080">;
    </font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>news<font color="#000080">[</font><font color="#800000">7</font><font color="#000080">]=</font><font color="#800000">' '</font><font color="#000080">) </font><font color="#FF0000"><b>THEN </b></font>news<font color="#000080">[</font><font color="#800000">7</font><font color="#000080">]:=</font><font color="#800000">'0'</font><font color="#000080">;

  </font><font color="#008000"><i>{----Write only the changed segments in all displays}
    </i></font><font color="#FF0000"><b>FOR </b></font>i<font color="#000080">:=</font><font color="#800000">1 </font><font color="#FF0000"><b>TO </b></font>LENGTH<font color="#000080">(</font>news<font color="#000080">) </font><font color="#FF0000"><b>DO </b></font>Segments<font color="#000080">(</font>news<font color="#000080">[</font>i<font color="#000080">],</font>olds<font color="#000080">[</font>i<font color="#000080">],</font><font color="#800000">80</font><font color="#000080">*(</font>i<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">),</font><font color="#800000">80</font><font color="#000080">,</font><font color="#800000">6.0</font><font color="#000080">);

    </font>olds<font color="#000080">:=</font>news<font color="#000080">;

    </font>Delay<font color="#000080">(</font><font color="#800000">100</font><font color="#000080">);

</font><font color="#008000"><i>{----Not only wait for normal keypressed but also for
     shift/alt/ctrl or insert/numlock/scrollock keys pressed}
    </i></font>r<font color="#000080">.</font>ah<font color="#000080">:=</font><font color="#800000">$02</font><font color="#000080">;
    </font>INTR<font color="#000080">(</font><font color="#800000">$16</font><font color="#000080">,</font>r<font color="#000080">);

  </font><font color="#FF0000"><b>UNTIL </b></font><font color="#000080">(</font>r<font color="#000080">.</font>al<font color="#000080">&lt;&gt;</font>oldstate<font color="#000080">) </font><font color="#FF0000"><b>OR </b></font><font color="#000080">(</font>KEYPRESSED <font color="#FF0000"><b>AND </b></font><font color="#000080">(</font>READKEY<font color="#000080">&lt;&gt;</font><font color="#800000">#255</font><font color="#000080">));

  </font>Closegraph<font color="#000080">;

</font><font color="#FF0000"><b>END</b></font><font color="#000080">. </font><font color="#008000"><i>{of segment}


</i></font><font color="#000080">&gt; </font>I would like <font color="#FF0000"><b>to </b></font>include a clock <font color="#FF0000"><b>in </b></font>my current project which will be
<font color="#000080">&gt; </font>updated once a minute<font color="#000080">.  </font>Instead <font color="#FF0000"><b>of </b></font>constantly checking the computer<font color="#800000">'s clock
</font><font color="#000080">&gt; </font><font color="#FF0000"><b>and </b></font>waiting <font color="#FF0000"><b>for </b></font>it <font color="#FF0000"><b>to </b></font>change<font color="#000080">, </font>I would like <font color="#FF0000"><b>to </b></font>use an interrupt<font color="#000080">.

</font>This one has even a hot key handler<font color="#000080">.  </font><font color="#FF0000"><b>If </b></font>you want <font color="#FF0000"><b>to </b></font>update it once per
minute<font color="#000080">, </font>bump a counter within the interrupt <font color="#800000">1</font>Ch handler till it reaches the
value <font color="#800000">60</font><font color="#000080">*</font><font color="#800000">18.2.  </font><font color="#FF0000"><b>Then </b></font>refresh the screen<font color="#000080">.
}

</font><font color="#FF0000"><b>Program </b></font>Clock<font color="#000080">;

</font><font color="#008000"><i>{$G+,R-,S-,M 1024, 0, 0 }

</i></font><font color="#FF0000"><b>uses
  </b></font>Dos<font color="#000080">;

</font><font color="#FF0000"><b>Const
  </b></font>x           <font color="#000080">= </font><font color="#800000">71</font><font color="#000080">;                   </font><font color="#008000"><i>{ x location on screen }
  </i></font>y           <font color="#000080">= </font><font color="#800000">1</font><font color="#000080">;                    </font><font color="#008000"><i>{ y location on screen }
  </i></font>Keyboard    <font color="#000080">= </font><font color="#800000">9</font><font color="#000080">;                    </font><font color="#008000"><i>{ Hardware keyboard interrupt }
  </i></font>TimerTick   <font color="#000080">= </font><font color="#800000">$1C</font><font color="#000080">;                  </font><font color="#008000"><i>{ Gets called 18.2 / second }
  </i></font>VideoOffset <font color="#000080">= </font><font color="#800000">160 </font><font color="#000080">* (</font>y <font color="#000080">- </font><font color="#800000">1</font><font color="#000080">) + </font><font color="#800000">2 </font><font color="#000080">* </font>x<font color="#000080">;</font><font color="#008000"><i>{ Offset in display memory }
  </i></font>yellow      <font color="#000080">= </font><font color="#800000">14</font><font color="#000080">;
  </font>blue        <font color="#000080">= </font><font color="#800000">1</font><font color="#000080">;
  </font>attribute   <font color="#000080">= </font>blue <font color="#000080">* </font><font color="#800000">16 </font><font color="#000080">+ </font>yellow<font color="#000080">;   </font><font color="#008000"><i>{ Clock colours }
  </i></font>VideoBase   <font color="#000080">: </font>Word <font color="#000080">= </font><font color="#800000">$B800</font><font color="#000080">;         </font><font color="#008000"><i>{ Segment of display memory }
  </i></font>ActiveFlag  <font color="#000080">: </font>ShortInt <font color="#000080">= -</font><font color="#800000">1</font><font color="#000080">;        </font><font color="#008000"><i>{ 0: on, -1: off }

</i></font><font color="#FF0000"><b>Var
  </b></font>OrgInt9<font color="#000080">,                             </font><font color="#008000"><i>{ Saved interrupt 9 vector }
  </i></font>OrgInt1Ch <font color="#000080">: </font>Pointer<font color="#000080">;              </font><font color="#008000"><i>{ Saved interrupt 1Ch vector }
  </i></font>VideoMode <font color="#000080">: </font>Byte <font color="#FF0000"><b>absolute </b></font><font color="#800000">$0000</font><font color="#000080">:</font><font color="#800000">$0449</font><font color="#000080">;

</font><font color="#008000"><i>{ Display a string using Dos services (avoid WriteLn, save memory) }

</i></font><font color="#FF0000"><b>Procedure </b></font>DisplayString<font color="#000080">(</font>s <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">); </font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;

</font><font color="#FF0000"><b>ASM
  </b></font><font color="#FF00FF">PUSH   DS
  XOR    CX, CX
  LDS    SI, s
  LODSB
  MOV    CL, AL
  JCXZ   @EmptyString
  CLD
 @NextChar:
  LODSB
  XCHG   AX, DX
  MOV    AH, 2
  INT    21h
  LOOP   @NextChar
 @EmptyString:
  POP    DS
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{ Returns True if a real time clock could be found }
</i></font><font color="#FF0000"><b>Function </b></font>HasRTClock <font color="#000080">: </font>Boolean<font color="#000080">; </font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;

</font><font color="#FF0000"><b>ASM
  </b></font><font color="#FF00FF">XOR    AL, AL
  MOV    AH, 2
  INT    1Ah
  JC     @NoRTClock
  INC    AX
 @NoRTCLock:
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{ Release Dos environment }
</i></font><font color="#FF0000"><b>Procedure </b></font>ReleaseEnvironment<font color="#000080">; </font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>ASM
  </b></font><font color="#FF00FF">MOV    ES, [PrefixSeg]
  MOV    ES, ES:[002Ch]
  MOV    AH, 49h
  INT    21h
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{ INT 9 handler intercepting Alt-F11 }
</i></font><font color="#FF0000"><b>Procedure </b></font>ToggleClock<font color="#000080">; </font>Interrupt<font color="#000080">; </font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Const
  </b></font>F11      <font color="#000080">= </font><font color="#800000">$57</font><font color="#000080">;                  </font><font color="#008000"><i>{ 'F11' make code }
  </i></font>BiosSeg  <font color="#000080">= </font><font color="#800000">$40</font><font color="#000080">;                  </font><font color="#008000"><i>{ Segment of BIOS data area }
  </i></font>AltMask  <font color="#000080">= </font><font color="#800000">$08</font><font color="#000080">;                  </font><font color="#008000"><i>{ Bitmask of Alt key }
  </i></font>KbdFlags <font color="#000080">= </font><font color="#800000">$17</font><font color="#000080">;                  </font><font color="#008000"><i>{ Byte showing keyboard status }

</i></font><font color="#FF0000"><b>ASM
  </b></font><font color="#FF00FF">STI
  IN     AL, 60h

 </font><font color="#008000"><i>{ F11 pressed? }
  </i></font><font color="#FF00FF">CMP    AL, F11
  JNE    @PassThru

 </font><font color="#008000"><i>{ Alt-key pressed? }
  </i></font><font color="#FF00FF">PUSH   BiosSeg
  POP    ES
  MOV    AL, ES:[KbdFlags]
  AND    AL, AltMask
  CMP    AL, AltMask
  JNE    @PassThru

 </font><font color="#008000"><i>{ Flip status flag, force EOI and leave routine }
  </i></font><font color="#FF00FF">NOT    [ActiveFlag]
  IN     AL, 61h
  MOV    AH, AL
  OR     AL, 80h
  OUT    61h, AL
  MOV    AL, AH
  OUT    61h, AL
  CLI
  MOV    AL, 20h
  OUT    20h, AL
  STI
  JMP    @Exit

 @PassThru:
  CLI
  PUSHF
  CALL   DWord Ptr [OrgInt9]
 @Exit:
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;  </font><font color="#008000"><i>{ ToggleClock }

{ Convert a packed BCD byte to ASCII character }
</i></font><font color="#FF0000"><b>Procedure </b></font>Digit<font color="#000080">; </font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>ASM
  </b></font><font color="#FF00FF">PUSH   AX
  CALL   @HiNibble
  POP    AX
  CALL   @LoNibble
  RETN

 @HiNibble:
  SHR    AL, 4
  JMP    @MakeAscii
 @LoNibble:
  AND    AL, 0Fh
 @MakeAscii:
  OR     AL, '0'
  STOSW
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{ INT 1Ch handler that displays a clock on the right hand side of the screen }
</i></font><font color="#FF0000"><b>Procedure </b></font>DisplayClock<font color="#000080">; </font>Interrupt<font color="#000080">; </font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>ASM
  </b></font><font color="#FF00FF">CMP    [ActiveFlag], 0
  JNE    @Exit
  CLD
  MOV    AH, 2
  INT    1Ah
  MOV    ES, [VideoBase]
  MOV    DI, VideoOffset
  MOV    AH, attribute
  MOV    AL, CH
  CALL   Digit
  MOV    AL, ':'
  STOSW
  MOV    AL, CL
  CALL   Digit
  MOV    AL, ':'
  STOSW
  MOV    AL, DH
  CALL   Digit
  PUSHF
  CALL   DWord Ptr [OrgInt1Ch]
 @Exit:
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Begin
  If </b></font>VideoMode <font color="#000080">= </font><font color="#800000">7 </font><font color="#FF0000"><b>Then
    </b></font>VideoBase <font color="#000080">:= </font><font color="#800000">$B000</font><font color="#000080">;
  </font>GetIntVec<font color="#000080">(</font>TimerTick<font color="#000080">, </font>OrgInt1Ch<font color="#000080">);
  </font>SetIntVec<font color="#000080">(</font>TimerTick<font color="#000080">, @</font>DisplayClock<font color="#000080">);
  </font>GetIntVec<font color="#000080">(</font>Keyboard<font color="#000080">, </font>OrgInt9<font color="#000080">);
  </font>SetIntVec<font color="#000080">(</font>Keyboard<font color="#000080">, @</font>ToggleClock<font color="#000080">);
  </font>SwapVectors<font color="#000080">;
  </font>ReleaseEnvironment<font color="#000080">;
  </font>DisplayString<font color="#000080">(</font><font color="#800000">'CLOCK installed.  &lt;Alt-F11&gt; toggles on/off'</font><font color="#000080">);
  </font>Keep<font color="#000080">(</font><font color="#800000">0</font><font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to GRAPHICS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0084.PAS">Original</a><b>]</b></p></body>
</html>
