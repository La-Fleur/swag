<html>
<head><title> "Transparent PutImage" by SEAN PALMER</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to GRAPHICS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0041.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
From: SEAN PALMER
Subj: transparent putimage
}

</i></font><font color="#FF0000"><b>Procedure </b></font>PutImg<font color="#000080">(</font>x<font color="#000080">,</font>y <font color="#000080">: </font>integer<font color="#000080">;</font><font color="#FF0000"><b>Var </b></font>Img<font color="#000080">);
</font><font color="#FF0000"><b>type
 </b></font>AList <font color="#000080">= </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">$FFFF</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Byte<font color="#000080">; </font><font color="#008000"><i>{1-based arrays are slower than 0-based}
</i></font><font color="#FF0000"><b>var
 </b></font>APtr <font color="#000080">:</font> AList<font color="#000080">;                   </font><font color="#008000"><i>{I found a very fast way to do this: WITH}
 </i></font>j<font color="#000080">,</font>i<font color="#000080">,</font>Width<font color="#000080">,</font>Height<font color="#000080">,</font>Counter <font color="#000080">: </font>Word<font color="#000080">;
</font><font color="#FF0000"><b>begin
 </b></font>Aptr<font color="#000080">:=@</font>Img<font color="#000080">;
 </font>Width<font color="#000080">:=(</font>Aptr<font color="#000080">[</font><font color="#800000">2</font><font color="#000080">] </font><font color="#FF0000"><b>SHL </b></font><font color="#800000">8</font><font color="#000080">) + </font>Aptr<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">]+</font><font color="#800000">1</font><font color="#000080">;  </font><font color="#008000"><i>{these +1's that 1-based arrays }
 </i></font>Height<font color="#000080">:=(</font>Aptr<font color="#000080">[</font><font color="#800000">4</font><font color="#000080">] </font><font color="#FF0000"><b>SHL </b></font><font color="#800000">8</font><font color="#000080">) + </font>Aptr<font color="#000080">[</font><font color="#800000">3</font><font color="#000080">]+</font><font color="#800000">1</font><font color="#000080">;  </font><font color="#008000"><i>{ require make for slower code}
 </i></font>Counter<font color="#000080">:=</font><font color="#800000">5</font><font color="#000080">;
 </font><font color="#FF0000"><b>For </b></font>j<font color="#000080">:=</font>y <font color="#FF0000"><b>to </b></font><font color="#000080">(</font>y<font color="#000080">+</font>height<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">) </font><font color="#FF0000"><b>do begin  </b></font><font color="#008000"><i>{try pre-calculating the offset instead}
  </i></font><font color="#FF0000"><b>for </b></font>i<font color="#000080">:=</font>x <font color="#FF0000"><b>to </b></font><font color="#000080">(</font>x<font color="#000080">+</font>width<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">) </font><font color="#FF0000"><b>do begin
   case </b></font>Aptr<font color="#000080">[</font>Counter<font color="#000080">] </font><font color="#FF0000"><b>of          </b></font><font color="#008000"><i>{CASE is probably not the way to do this}
    </i></font><font color="#800000">0</font><font color="#000080">:; </font><font color="#008000"><i>(* do nothing *)
    </i></font><font color="#FF0000"><b>else </b></font>_mcgaScreen<font color="#000080">[</font>j<font color="#000080">,</font>i<font color="#000080">]:=</font>Aptr<font color="#000080">[</font>Counter<font color="#000080">]; </font><font color="#008000"><i>(* plot it *)
    </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;
   </font>Inc<font color="#000080">(</font>Counter<font color="#000080">);
   </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
 </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font>ok<font color="#000080">, </font>here<font color="#800000">'s my try:

</font><font color="#FF0000"><b>type </b></font>pWord<font color="#000080">=</font>word<font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>putImg<font color="#000080">(</font>x<font color="#000080">,</font>y<font color="#000080">:</font>integer<font color="#000080">;</font><font color="#FF0000"><b>var </b></font>image<font color="#000080">);
</font><font color="#FF0000"><b>var
 </b></font>anImg<font color="#000080">:</font><font color="#FF0000"><b>record </b></font>img<font color="#000080">:</font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">$FFF7</font><font color="#000080">]</font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">; </font><font color="#FF0000"><b>end absolute </b></font>image<font color="#000080">;
 </font>aScrn<font color="#000080">:</font><font color="#FF0000"><b>record </b></font>scrn<font color="#000080">:</font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">$FFF7</font><font color="#000080">]</font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">; </font><font color="#FF0000"><b>end absolute </b></font><font color="#800000">$A000</font><font color="#000080">:</font><font color="#800000">0000</font><font color="#000080">;
 </font>width<font color="#000080">,</font>height<font color="#000080">,</font>counter<font color="#000080">,</font>offs<font color="#000080">,</font>src<font color="#000080">:</font>word<font color="#000080">;
</font><font color="#FF0000"><b>begin
 </b></font>width<font color="#000080">:=</font>pWord<font color="#000080">(@</font>anImg<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">])</font><font color="#000080">;
 </font>height<font color="#000080">:=</font>pWord<font color="#000080">(@</font>anImg<font color="#000080">[</font><font color="#800000">2</font><font color="#000080">])</font><font color="#000080">;
 </font>offs<font color="#000080">:=</font>y<font color="#000080">*</font><font color="#800000">320</font><font color="#000080">+</font>x<font color="#000080">;
 </font>src<font color="#000080">:=</font><font color="#800000">4</font><font color="#000080">;   </font><font color="#008000"><i>{skip width, height}
 </i></font><font color="#FF0000"><b>with </b></font>aScrn<font color="#000080">,</font>anImg <font color="#FF0000"><b>do repeat
  </b></font>counter<font color="#000080">:=</font>width<font color="#000080">;
  </font><font color="#FF0000"><b>repeat
   if </b></font>img<font color="#000080">[</font>src<font color="#000080">]&lt;&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>scrn<font color="#000080">[</font>offs<font color="#000080">]:=</font>img<font color="#000080">[</font>src<font color="#000080">];
   </font>inc<font color="#000080">(</font>src<font color="#000080">);
   </font>inc<font color="#000080">(</font>offs<font color="#000080">);
   </font>dec<font color="#000080">(</font>counter<font color="#000080">);
   </font><font color="#FF0000"><b>until </b></font>counter<font color="#000080">=</font><font color="#800000">0</font><font color="#000080">;
  </font>inc<font color="#000080">(</font>offs<font color="#000080">,</font><font color="#800000">320</font><font color="#000080">-</font>width<font color="#000080">);
  </font>dec<font color="#000080">(</font>height<font color="#000080">);
  </font><font color="#FF0000"><b>until </b></font>height<font color="#000080">=</font><font color="#800000">0</font><font color="#000080">;
 </font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font>Those arrays<font color="#000080">-</font>pretending<font color="#000080">-</font><font color="#FF0000"><b>to</b></font><font color="#000080">-</font>be<font color="#000080">-</font>records above so they<font color="#800000">'ll work with the WITH
</font>statement should <font color="#FF0000"><b>end </b></font>up making BP keep the address <font color="#FF0000"><b>in </b></font>registers<font color="#000080">, </font>making it
faster<font color="#000080">. </font><font color="#FF0000"><b>In </b></font>any <font color="#FF0000"><b>case </b></font>it won<font color="#800000">'t be slower than yours. I'</font>d appreciate you
timing them <font color="#FF0000"><b>and </b></font>letting me know the results<font color="#000080">. </font>Actually<font color="#000080">, </font>let me know <font color="#FF0000"><b>if </b></font>it
even compiles <font color="#FF0000"><b>and </b></font>works<font color="#000080">... </font><font color="#800000">8</font><font color="#000080">)
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to GRAPHICS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0041.PAS">Original</a><b>]</b></p></body>
</html>
