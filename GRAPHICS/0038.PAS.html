<html>
<head><title> "Loading Images from Disk" by STEFAN XENOS</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to GRAPHICS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0038.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
STEFAN XENOS

&gt; I am able to load an image into a buffer and display it with PutImage ect.,
&gt; but I would like to load the image from disk instead of with getimage.

Name: ImageStuff.Pas
Purpose: ImageStuff is a unit for storing bitmaps in dynamic variables and
         writing them to disk.
Progger: Stefan Xenos

This unit is public domain.}

</i></font><font color="#FF0000"><b>Unit </b></font>ImageStuff<font color="#000080">;

</font><font color="#FF0000"><b>interface

Uses
 </b></font>Graph<font color="#000080">;

</font><font color="#FF0000"><b>Type
  </b></font>Image <font color="#000080">= </font><font color="#FF0000"><b>Record
    </b></font>BitMap <font color="#000080">: </font>Pointer<font color="#000080">;
    </font>Size   <font color="#000080">: </font>Word<font color="#000080">;
 </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>Get<font color="#000080">(</font>X1<font color="#000080">, </font>Y1<font color="#000080">, </font>X2<font color="#000080">, </font>Y2 <font color="#000080">: </font>Word<font color="#000080">; </font><font color="#FF0000"><b>Var </b></font>aImage <font color="#000080">: </font>Image<font color="#000080">);
</font><font color="#FF0000"><b>Procedure </b></font>Put<font color="#000080">(</font>X<font color="#000080">, </font>Y <font color="#000080">: </font>Word<font color="#000080">; </font>aImage <font color="#000080">: </font>Image<font color="#000080">; </font>BitBlt <font color="#000080">: </font>Word<font color="#000080">);
</font><font color="#FF0000"><b>Procedure </b></font>Kill<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>aImage <font color="#000080">: </font>Image<font color="#000080">);
</font><font color="#FF0000"><b>Procedure </b></font>Save<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>F <font color="#000080">: </font><font color="#FF0000"><b>File</b></font><font color="#000080">; </font>aImage <font color="#000080">: </font>Image<font color="#000080">);
</font><font color="#FF0000"><b>Procedure </b></font>Load<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>F <font color="#000080">: </font><font color="#FF0000"><b>File</b></font><font color="#000080">; </font><font color="#FF0000"><b>Var </b></font>aImage <font color="#000080">: </font>Image<font color="#000080">);

</font><font color="#FF0000"><b>implementation

Procedure </b></font>Get<font color="#000080">(</font>X1<font color="#000080">, </font>Y1<font color="#000080">, </font>X2<font color="#000080">, </font>Y2 <font color="#000080">: </font>Word<font color="#000080">; </font><font color="#FF0000"><b>Var </b></font>aImage <font color="#000080">: </font>Image<font color="#000080">);
</font><font color="#008000"><i>{Clips an image from the screen and store it in a dynamic variable}
</i></font><font color="#FF0000"><b>Begin
  </b></font>aImage<font color="#000080">.</font>bitmap <font color="#000080">:= </font><font color="#FF0000"><b>nil</b></font><font color="#000080">;
  </font>aImage<font color="#000080">.</font>size   <font color="#000080">:= </font>ImageSize<font color="#000080">(</font>X1<font color="#000080">, </font>Y1<font color="#000080">, </font>X2<font color="#000080">, </font>Y2<font color="#000080">);
  </font>GetMem<font color="#000080">(</font>aImage<font color="#000080">.</font>BitMap<font color="#000080">,</font>aImage<font color="#000080">.</font>Size<font color="#000080">);    </font><font color="#008000"><i>{Ask for some memory}
  </i></font>GetImage<font color="#000080">(</font>X1<font color="#000080">, </font>Y1<font color="#000080">, </font>X2<font color="#000080">, </font>Y2<font color="#000080">, </font>aImage<font color="#000080">.</font>BitMap<font color="#000080">^); </font><font color="#008000"><i>{Copy the image}
</i></font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>Put<font color="#000080">(</font>X<font color="#000080">, </font>Y <font color="#000080">: </font>Word<font color="#000080">; </font>aImage <font color="#000080">: </font>Image<font color="#000080">; </font>BitBlt <font color="#000080">: </font>Word<font color="#000080">);
</font><font color="#FF0000"><b>Begin
  </b></font>PutImage<font color="#000080">(</font>X<font color="#000080">, </font>Y<font color="#000080">, </font>aImage<font color="#000080">.</font>BitMap<font color="#000080">^, </font>BitBlt<font color="#000080">);   </font><font color="#008000"><i>{Display image}
</i></font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>Kill<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>aImage <font color="#000080">: </font>Image<font color="#000080">);
</font><font color="#008000"><i>{Frees up the memory used by an unwanted image}
</i></font><font color="#FF0000"><b>Begin
  </b></font>FreeMem <font color="#000080">(</font>aImage<font color="#000080">.</font>BitMap<font color="#000080">, </font>aImage<font color="#000080">.</font>Size<font color="#000080">); </font><font color="#008000"><i>{Free up memory used by image}
  </i></font>aImage<font color="#000080">.</font>Size   <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font>aImage<font color="#000080">.</font>BitMap <font color="#000080">:= </font><font color="#FF0000"><b>Nil</b></font><font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>Save<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>F <font color="#000080">: </font><font color="#FF0000"><b>File</b></font><font color="#000080">; </font>aImage <font color="#000080">: </font>Image<font color="#000080">);
</font><font color="#008000"><i>{Saves an image to disk. File MUST already be opened for write}
</i></font><font color="#FF0000"><b>Begin
  </b></font>BlockWrite<font color="#000080">(</font>F<font color="#000080">, </font>aImage<font color="#000080">.</font>Size<font color="#000080">, </font><font color="#800000">2</font><font color="#000080">);             </font><font color="#008000"><i>{Store the image's size so that
                                            it may be correctly loaded later}
  </i></font>BlockWrite<font color="#000080">(</font>F<font color="#000080">, </font>aImage<font color="#000080">.</font>BitMap<font color="#000080">^, </font>aImage<font color="#000080">.</font>Size<font color="#000080">); </font><font color="#008000"><i>{Write image itself to disk}
</i></font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>Load <font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>F <font color="#000080">: </font><font color="#FF0000"><b>File</b></font><font color="#000080">; </font><font color="#FF0000"><b>Var </b></font>aImage <font color="#000080">: </font>Image<font color="#000080">);
</font><font color="#008000"><i>{Loads an image off disk and stores it in a dynamic variable}
</i></font><font color="#FF0000"><b>Begin
 </b></font>BlockRead<font color="#000080">(</font>F<font color="#000080">, </font>aImage<font color="#000080">.</font>Size<font color="#000080">, </font><font color="#800000">2</font><font color="#000080">);              </font><font color="#008000"><i>{Find out how big the image is}
 </i></font>GetMem<font color="#000080">(</font>aImage<font color="#000080">.</font>BitMap<font color="#000080">, </font>aImage<font color="#000080">.</font>Size<font color="#000080">);        </font><font color="#008000"><i>{Allocate memory for it}
 </i></font>BlockRead<font color="#000080">(</font>F<font color="#000080">, </font>aImage<font color="#000080">.</font>BitMap<font color="#000080">^, </font>aImage<font color="#000080">.</font>Size<font color="#000080">)  </font><font color="#008000"><i>{Load the image}
</i></font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Begin
End</b></font><font color="#000080">.

</font><font color="#008000"><i>{
Here's some source which should help you figure out how to use the unit I
just sent.
}

{By Stefan Xenos}
</i></font><font color="#FF0000"><b>Program </b></font>ImageTest<font color="#000080">;

</font><font color="#FF0000"><b>Uses
  </b></font>Graph<font color="#000080">,
  </font>ImageStuff<font color="#000080">;

</font><font color="#FF0000"><b>Var
  </b></font>Pic      <font color="#000080">: </font>Image<font color="#000080">;
  </font>LineNum  <font color="#000080">: </font>Byte<font color="#000080">;
  </font>DataFile <font color="#000080">: </font><font color="#FF0000"><b>File</b></font><font color="#000080">;
  </font>GrDriver<font color="#000080">,
  </font>GrMode   <font color="#000080">: </font>Integer<font color="#000080">;

</font><font color="#FF0000"><b>Const
 </b></font>FileName <font color="#000080">= </font><font color="#800000">'IMAGE.DAT'</font><font color="#000080">;
 </font>MaxLines <font color="#000080">= </font><font color="#800000">200</font><font color="#000080">;

</font><font color="#FF0000"><b>Begin
 </b></font><font color="#008000"><i>{Initialise}
 </i></font>DetectGraph<font color="#000080">(</font>GrDriver<font color="#000080">, </font>GrMode<font color="#000080">);
 </font>InitGraph<font color="#000080">(</font>GrDriver<font color="#000080">, </font>GrMode<font color="#000080">, </font><font color="#800000">''</font><font color="#000080">);
 </font>Randomize<font color="#000080">;

 </font><font color="#008000"><i>{Draw some lines}
 </i></font><font color="#FF0000"><b>For </b></font>LineNum <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>MaxLines <font color="#FF0000"><b>do
 begin
   </b></font>setColor<font color="#000080">(</font>random <font color="#000080">(</font>maxcolors<font color="#000080">));
   </font>line<font color="#000080">(</font>random<font color="#000080">(</font>getmaxx<font color="#000080">), </font>random<font color="#000080">(</font>getmaxy<font color="#000080">), </font>random<font color="#000080">(</font>getmaxx<font color="#000080">), </font>random<font color="#000080">(</font>getmaxy<font color="#000080">));
 </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

 </font><font color="#008000"><i>{Copy image from screen}
 </i></font>Get<font color="#000080">(</font><font color="#800000">100</font><font color="#000080">, </font><font color="#800000">100</font><font color="#000080">, </font><font color="#800000">150</font><font color="#000080">, </font><font color="#800000">150</font><font color="#000080">, </font>Pic<font color="#000080">);

 </font>readLn<font color="#000080">;

 </font><font color="#008000"><i>{Clear screen}
 </i></font>ClearDevice<font color="#000080">;

 </font><font color="#008000"><i>{Display image}
 </i></font>Put<font color="#000080">(</font><font color="#800000">100</font><font color="#000080">, </font><font color="#800000">100</font><font color="#000080">, </font>Pic<font color="#000080">, </font>NormalPut<font color="#000080">);

 </font>readLn<font color="#000080">;

 </font><font color="#008000"><i>{Clear screen}
 </i></font>ClearDevice<font color="#000080">;

 </font><font color="#008000"><i>{Save image to disk}
 </i></font>Assign<font color="#000080">(</font>DataFile<font color="#000080">, </font>FileName<font color="#000080">);
 </font>Rewrite<font color="#000080">(</font>DataFile<font color="#000080">, </font><font color="#800000">1</font><font color="#000080">);
 </font>Save<font color="#000080">(</font>DataFile<font color="#000080">, </font>Pic<font color="#000080">);
 </font>Close<font color="#000080">(</font>DataFile<font color="#000080">);

 </font><font color="#008000"><i>{Kill image}
 </i></font>Kill<font color="#000080">(</font>pic<font color="#000080">);

 </font><font color="#008000"><i>{Load image from disk}
 </i></font>Assign<font color="#000080">(</font>DataFile<font color="#000080">, </font>FileName<font color="#000080">);
 </font>Reset<font color="#000080">(</font>DataFile<font color="#000080">, </font><font color="#800000">1</font><font color="#000080">);
 </font>Load<font color="#000080">(</font>DataFile<font color="#000080">, </font>pic<font color="#000080">);
 </font>Close<font color="#000080">(</font>DataFile<font color="#000080">);

 </font><font color="#008000"><i>{Display image}
 </i></font>Put<font color="#000080">(</font><font color="#800000">200</font><font color="#000080">, </font><font color="#800000">200</font><font color="#000080">, </font>Pic<font color="#000080">, </font>NormalPut<font color="#000080">);

 </font>readLn<font color="#000080">;

 </font>CloseGraph<font color="#000080">;
 </font>WriteLn<font color="#000080">(</font>Pic<font color="#000080">.</font>size<font color="#000080">);
</font><font color="#FF0000"><b>End</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to GRAPHICS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0038.PAS">Original</a><b>]</b></p></body>
</html>
