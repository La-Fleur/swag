<html>
<head><title> "View PCX File" by NORMAN YEN</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to GRAPHICS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0030.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{===========================================================================
Date: 08-23-93 (08:26)
From: NORMAN YEN
Subj: RE: .PCX AND COMM ROUTINE
---------------------------------------------------------------------------

 MB&gt; I heard something in this echo about someone having Pascal source to
 MB&gt; view .PCX
 MB&gt; files and I would appreciate if they would re-post the source if it's
 MB&gt; not too
 MB&gt; long or tell me where I can get it.  I am also looking for some good
 MB&gt; COMM routines for Pascal, anyone have any or no where I can get some?

        The routine I have will only work with 320x200x256c images.
Hope it helps!

Norman

{
        For all those Pascal programmers who just want something simple
        to display a 320x200x256 colour PCX file on the screen here it is.
        This was a direct translation from the C source code of PCXVIEW
        written by Lee Hamel (Patch), Avalanche coder.  I removed the
        inline assembly code so that you beginners can see what was going
        on behind those routines.

                                                      Norman Yen
                                                      Infinite Dreams BBS
                                                      August 11, 1993
}

</i></font><font color="#FF0000"><b>type </b></font>pcxheader_rec<font color="#000080">=</font><font color="#FF0000"><b>record
     </b></font>manufacturer<font color="#000080">: </font>byte<font color="#000080">;
     </font>version<font color="#000080">: </font>byte<font color="#000080">;
     </font>encoding<font color="#000080">: </font>byte<font color="#000080">;
     </font>bits_per_pixel<font color="#000080">: </font>byte<font color="#000080">;
     </font>xmin<font color="#000080">, </font>ymin<font color="#000080">: </font>word<font color="#000080">;
     </font>xmax<font color="#000080">, </font>ymax<font color="#000080">: </font>word<font color="#000080">;
     </font>hres<font color="#000080">: </font>word<font color="#000080">;
     </font>vres<font color="#000080">: </font>word<font color="#000080">;
     </font>palette<font color="#000080">: </font><font color="#FF0000"><b>array </b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">47</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">;
     </font>reserved<font color="#000080">: </font>byte<font color="#000080">;
     </font>colour_planes<font color="#000080">: </font>byte<font color="#000080">;
     </font>bytes_per_line<font color="#000080">: </font>word<font color="#000080">;
     </font>palette_type<font color="#000080">: </font>word<font color="#000080">;
     </font>filler<font color="#000080">: </font><font color="#FF0000"><b>array </b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">57</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">;
     </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>var </b></font>header<font color="#000080">: </font>pcxheader_rec<font color="#000080">;
    </font>width<font color="#000080">, </font>depth<font color="#000080">: </font>word<font color="#000080">;
    </font>bytes<font color="#000080">: </font>word<font color="#000080">;
    </font>palette<font color="#000080">: </font><font color="#FF0000"><b>array </b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">767</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">;
    </font>f<font color="#000080">: </font><font color="#FF0000"><b>file</b></font><font color="#000080">;
    </font>c<font color="#000080">: </font>byte<font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>Read_PCX_Line<font color="#000080">(</font>vidoffset<font color="#000080">: </font>word<font color="#000080">);
</font><font color="#FF0000"><b>var </b></font>c<font color="#000080">, </font>run<font color="#000080">: </font>byte<font color="#000080">;
    </font>n<font color="#000080">: </font>integer<font color="#000080">;
    </font>w<font color="#000080">: </font>word<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>n<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
  </font><font color="#FF0000"><b>while </b></font><font color="#000080">(</font>n <font color="#000080">&lt; </font>bytes<font color="#000080">) </font><font color="#FF0000"><b>do
  begin
    </b></font>blockread <font color="#000080">(</font>f<font color="#000080">, </font>c<font color="#000080">, </font><font color="#800000">1</font><font color="#000080">);

    </font><font color="#008000"><i>{ if it's a run of bytes field }
    </i></font><font color="#FF0000"><b>if </b></font><font color="#000080">((</font>c <font color="#FF0000"><b>and </b></font><font color="#800000">192</font><font color="#000080">)=</font><font color="#800000">192</font><font color="#000080">) </font><font color="#FF0000"><b>then
    begin

      </b></font><font color="#008000"><i>{ and off the high bits }
      </i></font>run<font color="#000080">:=</font>c <font color="#FF0000"><b>and </b></font><font color="#800000">63</font><font color="#000080">;

      </font><font color="#008000"><i>{ get the run byte }
      </i></font>blockread <font color="#000080">(</font>f<font color="#000080">, </font>c<font color="#000080">, </font><font color="#800000">1</font><font color="#000080">);
      </font>n<font color="#000080">:=</font>n<font color="#000080">+</font>run<font color="#000080">;
      </font><font color="#FF0000"><b>for </b></font>w<font color="#000080">:=</font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font>run<font color="#000080">-</font><font color="#800000">1 </font><font color="#FF0000"><b>do
      begin
        </b></font>mem <font color="#000080">[</font><font color="#800000">$a000</font><font color="#000080">:</font>vidoffset<font color="#000080">]:=</font>c<font color="#000080">;
        </font>inc <font color="#000080">(</font>vidoffset<font color="#000080">);
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>end else
    begin
      </b></font>n<font color="#000080">:=</font>n<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">;
      </font>mem <font color="#000080">[</font><font color="#800000">$a000</font><font color="#000080">:</font>vidoffset<font color="#000080">]:=</font>c<font color="#000080">;
      </font>inc <font color="#000080">(</font>vidoffset<font color="#000080">);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>Unpack_PCX_File<font color="#000080">;
</font><font color="#FF0000"><b>var </b></font>i<font color="#000080">: </font>integer<font color="#000080">;
</font><font color="#FF0000"><b>begin
  for </b></font>i<font color="#000080">:=</font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font><font color="#800000">767 </font><font color="#FF0000"><b>do
    </b></font>palette <font color="#000080">[</font>i<font color="#000080">]:=</font>palette <font color="#000080">[</font>i<font color="#000080">] </font><font color="#FF0000"><b>shr </b></font><font color="#800000">2</font><font color="#000080">;
  </font><font color="#FF0000"><b>asm
    </b></font><font color="#FF00FF">mov ax,13h
    int 10h
    mov ax,1012h
    xor bx,bx
    mov cx,256
    mov dx,offset palette
    int 10h
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>for </b></font>i<font color="#000080">:=</font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font>depth<font color="#000080">-</font><font color="#800000">1 </font><font color="#FF0000"><b>do
    </b></font>Read_PCX_Line <font color="#000080">(</font>i<font color="#000080">*</font><font color="#800000">320</font><font color="#000080">);
  </font><font color="#FF0000"><b>asm
    </b></font><font color="#FF00FF">xor ax,ax
    int 16h
    mov ax,03h
    int 10h
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>begin
  if </b></font><font color="#000080">(</font>paramcount <font color="#000080">&gt; </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>then
  begin
    </b></font>assign <font color="#000080">(</font>f<font color="#000080">, </font>paramstr <font color="#000080">(</font><font color="#800000">1</font><font color="#000080">));
    </font>reset <font color="#000080">(</font>f<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">);
    </font>blockread <font color="#000080">(</font>f<font color="#000080">, </font>header<font color="#000080">, </font>sizeof <font color="#000080">(</font>header<font color="#000080">));
    </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>header<font color="#000080">.</font>manufacturer<font color="#000080">=</font><font color="#800000">10</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>header<font color="#000080">.</font>version<font color="#000080">=</font><font color="#800000">5</font><font color="#000080">) </font><font color="#FF0000"><b>and
       </b></font><font color="#000080">(</font>header<font color="#000080">.</font>bits_per_pixel<font color="#000080">=</font><font color="#800000">8</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>header<font color="#000080">.</font>colour_planes<font color="#000080">=</font><font color="#800000">1</font><font color="#000080">) </font><font color="#FF0000"><b>then
    begin
      </b></font>seek <font color="#000080">(</font>f<font color="#000080">, </font>filesize <font color="#000080">(</font>f<font color="#000080">)-</font><font color="#800000">769</font><font color="#000080">);
      </font>blockread <font color="#000080">(</font>f<font color="#000080">, </font>c<font color="#000080">, </font><font color="#800000">1</font><font color="#000080">);
      </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>c<font color="#000080">=</font><font color="#800000">12</font><font color="#000080">) </font><font color="#FF0000"><b>then
      begin
        </b></font>blockread <font color="#000080">(</font>f<font color="#000080">, </font>palette<font color="#000080">, </font><font color="#800000">768</font><font color="#000080">);
        </font>seek <font color="#000080">(</font>f<font color="#000080">, </font><font color="#800000">128</font><font color="#000080">);
        </font>width<font color="#000080">:=</font>header<font color="#000080">.</font>xmax<font color="#000080">-</font>header<font color="#000080">.</font>xmin<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">;
        </font>depth<font color="#000080">:=</font>header<font color="#000080">.</font>ymax<font color="#000080">-</font>header<font color="#000080">.</font>ymin<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">;
        </font>bytes<font color="#000080">:=</font>header<font color="#000080">.</font>bytes_per_line<font color="#000080">;
        </font>Unpack_PCX_File<font color="#000080">;
      </font><font color="#FF0000"><b>end else </b></font>writeln <font color="#000080">(</font><font color="#800000">'Error reading palette.'</font><font color="#000080">);
    </font><font color="#FF0000"><b>end else </b></font>writeln <font color="#000080">(</font><font color="#800000">'Not a 256 colour PCX file.'</font><font color="#000080">);
    </font>close <font color="#000080">(</font>f<font color="#000080">);
  </font><font color="#FF0000"><b>end else </b></font>writeln <font color="#000080">(</font><font color="#800000">'No file name specified.'</font><font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">.

</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to GRAPHICS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0030.PAS">Original</a><b>]</b></p></body>
</html>
