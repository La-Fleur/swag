<html>
<head><title> "FAST Mode 13h Line Draw" by SEAN PALMER</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to GRAPHICS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0006.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
===========================================================================
 BBS: Beta Connection
Date: 08-20-93 (09:59)             Number: 2208
From: SEAN PALMER                  Refer#: NONE
  To: ALL                           Recvd: NO  
Subj: FAST mode 13h Li (Part 1)      Conf: (232) T_Pascal_R
---------------------------------------------------------------------------
Hey! Here's THE fastest mode 13h bresenham's line drawing function ever.
(I think...prove me wrong, please!!)

It's written for TP 6 or better, uses BASM. If you don't know assembly, just
put it in a unit and don't worry about how it works. If you do, fine.
Some good optimizations in there...

Have fun! If anyone wants the mostly-pascal equivalent, let me know.
It's still fast.

{by Sean Palmer}
{public domain}

</i></font><font color="#FF0000"><b>var </b></font>color<font color="#000080">:</font>byte<font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>line<font color="#000080">(</font>x<font color="#000080">,</font>y<font color="#000080">,</font>x2<font color="#000080">,</font>y2<font color="#000080">:</font>word<font color="#000080">);</font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;</font><font color="#FF0000"><b>asm </b></font><font color="#008000"><i>{mode 13}
 </i></font><font color="#FF00FF">mov ax,$A000
 mov es,ax
 mov bx,x
 mov ax,y
 mov cx,x2
 mov si,y2
 cmp ax,si
 jbe @NO_SWAP   </font><font color="#008000"><i>{always draw downwards}
 </i></font><font color="#FF00FF">xchg bx,cx
 xchg ax,si
@NO_SWAP:
 sub si,ax         </font><font color="#008000"><i>{yd (pos)}
 </i></font><font color="#FF00FF">sub cx,bx         </font><font color="#008000"><i>{xd (+/-)}
 </i></font><font color="#FF00FF">cld               </font><font color="#008000"><i>{set up direction flag}
 </i></font><font color="#FF00FF">jns @H_ABS
 neg cx      </font><font color="#008000"><i>{make x positive}
 </i></font><font color="#FF00FF">std
@H_ABS:
 mov di,320
 mul di
 mov di,ax
 add di,bx   </font><font color="#008000"><i>{di:adr}
 </i></font><font color="#FF00FF">or si,si
 jnz @NOT_H
</font><font color="#008000"><i>{horizontal line}
 </i></font><font color="#FF00FF">cld
 mov al,color
 inc cx
 rep stosb
 jmp @EXIT
@NOT_H:
 or cx,cx
 jnz @NOT_V
</font><font color="#008000"><i>{vertical line}
 </i></font><font color="#FF00FF">cld
 mov al,color
 mov cx,si
 inc cx
 mov bx,320-1
@VLINE_LOOP:
 stosb
 add di,bx
 loop @VLINE_LOOP
 jmp @EXIT
@NOT_V:
 cmp cx,si    </font><font color="#008000"><i>{which is greater distance?}
 </i></font><font color="#FF00FF">lahf         </font><font color="#008000"><i>{then store flags}
 </i></font><font color="#FF00FF">ja @H_IND
 xchg cx,si   </font><font color="#008000"><i>{swap for redundant calcs}
</i></font><font color="#FF00FF">@H_IND:
 mov dx,si    </font><font color="#008000"><i>{inc2 (adjustment when decision var rolls over)}
 </i></font><font color="#FF00FF">sub dx,cx
 shl dx,1
 shl si,1     </font><font color="#008000"><i>{inc1 (step for decision var)}
 </i></font><font color="#FF00FF">mov bx,si    </font><font color="#008000"><i>{decision var, tells when we need to go secondary direction}
 </i></font><font color="#FF00FF">sub bx,cx
 inc cx
 push bp      </font><font color="#008000"><i>{need another register to hold often-used constant}
 </i></font><font color="#FF00FF">mov bp,320
 mov al,color
 sahf         </font><font color="#008000"><i>{restore flags}
 </i></font><font color="#FF00FF">jb @DIAG_V
</font><font color="#008000"><i>{mostly-horizontal diagonal line}
 </i></font><font color="#FF00FF">or bx,bx     </font><font color="#008000"><i>{set flags initially, set at end of loop for other iterations}
</i></font><font color="#FF00FF">@LH:
 stosb        </font><font color="#008000"><i>{plot and move x, doesn't affect flags}
 </i></font><font color="#FF00FF">jns @SH      </font><font color="#008000"><i>{decision var rollover in bx?}
 </i></font><font color="#FF00FF">add bx,si
 loop @LH   </font><font color="#008000"><i>{doesn't affect flags}
 </i></font><font color="#FF00FF">jmp @X
@SH:
 add di,bp
 add bx,dx
 loop @LH   </font><font color="#008000"><i>{doesn't affect flags}
 </i></font><font color="#FF00FF">jmp @X
@DIAG_V:
</font><font color="#008000"><i>{mostly-vertical diagonal line}
 </i></font><font color="#FF00FF">or bx,bx    </font><font color="#008000"><i>{set flags initially, set at end of loop for other iterations}
</i></font><font color="#FF00FF">@LV:
 mov es:[di],al   </font><font color="#008000"><i>{plot, doesn't affect flags}
 </i></font><font color="#FF00FF">jns @SV          </font><font color="#008000"><i>{decision var rollover in bx?}
 </i></font><font color="#FF00FF">add di,bp        </font><font color="#008000"><i>{update y coord}
 </i></font><font color="#FF00FF">add bx,si
 loop @LV         </font><font color="#008000"><i>{doesn't affect flags}
 </i></font><font color="#FF00FF">jmp @X
@SV:
 scasb   </font><font color="#008000"><i>{sure this is superfluous but it's a quick way to inc/dec x coord!}
 </i></font><font color="#FF00FF">add di,bp        </font><font color="#008000"><i>{update y coord}
 </i></font><font color="#FF00FF">add bx,dx
 loop @LV         </font><font color="#008000"><i>{doesn't affect flags}
</i></font><font color="#FF00FF">@X:
 pop bp
@EXIT:
 </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>var </b></font>k<font color="#000080">,</font>i<font color="#000080">,</font>j<font color="#000080">:</font>word<font color="#000080">;
</font><font color="#FF0000"><b>begin
 asm </b></font><font color="#FF00FF">mov ax,$13; int $10; </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
 </font><font color="#FF0000"><b>for </b></font>k<font color="#000080">:=</font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font><font color="#800000">31 </font><font color="#FF0000"><b>do begin
  </b></font>i<font color="#000080">:=</font>k<font color="#000080">*</font><font color="#800000">10</font><font color="#000080">;
  </font>j<font color="#000080">:=</font>k<font color="#000080">*</font><font color="#800000">6</font><font color="#000080">;
  </font>color<font color="#000080">:=</font><font color="#800000">14</font><font color="#000080">;
  </font>line<font color="#000080">(</font><font color="#800000">159</font><font color="#000080">,</font><font color="#800000">99</font><font color="#000080">,</font>i<font color="#000080">,</font><font color="#800000">0</font><font color="#000080">);
  </font>color<font color="#000080">:=</font><font color="#800000">13</font><font color="#000080">;
  </font>line<font color="#000080">(</font><font color="#800000">160</font><font color="#000080">,</font><font color="#800000">99</font><font color="#000080">,</font><font color="#800000">319</font><font color="#000080">,</font>j<font color="#000080">);
  </font>color<font color="#000080">:=</font><font color="#800000">12</font><font color="#000080">;
  </font>line<font color="#000080">(</font><font color="#800000">160</font><font color="#000080">,</font><font color="#800000">100</font><font color="#000080">,</font><font color="#800000">319</font><font color="#000080">-</font>i<font color="#000080">,</font><font color="#800000">199</font><font color="#000080">);
  </font>color<font color="#000080">:=</font><font color="#800000">11</font><font color="#000080">;
  </font>line<font color="#000080">(</font><font color="#800000">159</font><font color="#000080">,</font><font color="#800000">100</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">199</font><font color="#000080">-</font>j<font color="#000080">);
  </font>i<font color="#000080">:=</font>k<font color="#000080">*</font><font color="#800000">9</font><font color="#000080">;
  </font>j<font color="#000080">:=</font>k<font color="#000080">*</font><font color="#800000">5</font><font color="#000080">;
  </font>color<font color="#000080">:=</font><font color="#800000">6</font><font color="#000080">;
  </font>line<font color="#000080">(</font>i<font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">159</font><font color="#000080">,</font><font color="#800000">99</font><font color="#000080">);
  </font>color<font color="#000080">:=</font><font color="#800000">5</font><font color="#000080">;
  </font>line<font color="#000080">(</font><font color="#800000">319</font><font color="#000080">,</font>j<font color="#000080">,</font><font color="#800000">160</font><font color="#000080">,</font><font color="#800000">99</font><font color="#000080">);
  </font>color<font color="#000080">:=</font><font color="#800000">4</font><font color="#000080">;
  </font>line<font color="#000080">(</font><font color="#800000">319</font><font color="#000080">-</font>i<font color="#000080">,</font><font color="#800000">199</font><font color="#000080">,</font><font color="#800000">160</font><font color="#000080">,</font><font color="#800000">100</font><font color="#000080">);
  </font>color<font color="#000080">:=</font><font color="#800000">3</font><font color="#000080">;
  </font>line<font color="#000080">(</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">199</font><font color="#000080">-</font>j<font color="#000080">,</font><font color="#800000">159</font><font color="#000080">,</font><font color="#800000">100</font><font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
 </font>Readln<font color="#000080">;
 </font><font color="#FF0000"><b>asm </b></font><font color="#FF00FF">mov ax,3; int $10; </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
 </font><font color="#FF0000"><b>end</b></font><font color="#000080">.

... </font>I<font color="#800000">'m not unemployed, I'</font>m indefinitely leisured<font color="#000080">.
</font>___ Blue Wave<font color="#000080">/</font>QWK v2<font color="#000080">.</font><font color="#800000">12
</font><font color="#000080">---
 * </font>deltaComm Online <font color="#800000">919</font><font color="#000080">-</font><font color="#800000">481</font><font color="#000080">-</font><font color="#800000">9399 </font><font color="#000080">- </font><font color="#800000">10 </font>lines
 <font color="#000080">* </font>PostLink<font color="#000080">(</font>tm<font color="#000080">) </font>v1<font color="#000080">.</font><font color="#800000">06  </font>DELTA <font color="#000080">(</font><font color="#800000">#22</font><font color="#000080">) : </font>RelayNet<font color="#000080">(</font>tm<font color="#000080">) </font>HUB

</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to GRAPHICS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0006.PAS">Original</a><b>]</b></p></body>
</html>
