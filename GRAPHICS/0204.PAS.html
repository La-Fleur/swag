<html>
<head><title> "BGI Get/Put Unit" by UDO JUERSS</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to GRAPHICS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0204.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{This 2 procedures work with standard VGA (640x480x16). I did this about
 4 years ago to get higher speed of handling images. There are two
 restictions: 1. only NormalPut is done. (no such parameter for PutImageX8)
              2. the x-position must be X mod 8 = 0.
 For static images I use them often, because they are more than 4 times
 faster then the BGI originals. The function ImageSize can be used to get the
 required size of image.

 Dec. 13, 1995, Udo Juerss, 57078 Siegen, Germany, CompuServe [101364,526]}

</i></font><font color="#FF0000"><b>procedure </b></font>GetImageX8<font color="#000080">(</font>X1<font color="#000080">,</font>Y1<font color="#000080">,</font>X2<font color="#000080">,</font>Y2<font color="#000080">:</font>Integer<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>OP<font color="#000080">); </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>var
  </b></font>XLen<font color="#000080">,</font>YLen <font color="#000080">: </font>Word<font color="#000080">;

</font><font color="#FF0000"><b>asm
    </b></font><font color="#FF00FF">push ds                              </font><font color="#008000"><i>{Verwendete Segmentregister sichern}
    </i></font><font color="#FF00FF">push es
    les  di,[OP]                                  </font><font color="#008000"><i>{ES:DI = Zeiger auf Bitmap}
    </i></font><font color="#FF00FF">mov  ax,X2
    mov  bx,X1
    and  ax,0FFF8h
    add  ax,8
    and  bx,0FFF8h
    sub  ax,bx                                 </font><font color="#008000"><i>{AX = horizontale Punktanzahl}
    </i></font><font color="#FF00FF">push ax
    stosw      </font><font color="#008000"><i>{Als Information f|r GetImage diesen Wert in Bitmap speichern}
    </i></font><font color="#FF00FF">mov  ax,Y2
    sub  ax,Y1                                   </font><font color="#008000"><i>{AX = vertikale Punktanzahl}
    </i></font><font color="#FF00FF">mov  YLen,ax                            </font><font color="#008000"><i>{F|r spdteren Zdhlwert speichern}
    </i></font><font color="#FF00FF">stosw      </font><font color="#008000"><i>{Als Information f|r GetImage diesen Wert in Bitmap speichern}
    </i></font><font color="#FF00FF">pop  ax
    shr  ax,3
    mov  XLen,ax
    mov  bx,X1
    shr  bx,3
    mov  si,Y1
    shl  si,4
    mov  cx,si
    shl  si,2
    add  si,cx
    add  si,bx                                   </font><font color="#008000"><i>{SI = BPR * Y1 + (X1 shl 8)}
    </i></font><font color="#FF00FF">mov  ds,SegA000                                   </font><font color="#008000"><i>{DS = Video Basissegment}
    </i></font><font color="#FF00FF">mov  dx,03CEh                     </font><font color="#008000"><i>{DX = Graphics Controller Command Port}
    </i></font><font color="#FF00FF">mov  al,4                                    </font><font color="#008000"><i>{Read-Map Register anwdhlen}
    </i></font><font color="#FF00FF">out  dx,al
    inc  dx                              </font><font color="#008000"><i>{DX = Graphics Controller Data Port}
    </i></font><font color="#FF00FF">mov  bx,YLen                                         </font><font color="#008000"><i>{BX = Anzahl Zeilen}
    </i></font><font color="#FF00FF">mov  cx,XLen                                         </font><font color="#008000"><i>{CX = Anzahl  Bytes}

</i></font><font color="#FF00FF">@1: mov  al,3                                       </font><font color="#008000"><i>{Maske f|r Plane 3 laden}

</i></font><font color="#FF00FF">@2: out  dx,al                            </font><font color="#008000"><i>{Plane f|r Lesezugriff selektieren}
    </i></font><font color="#FF00FF">push si                                   </font><font color="#008000"><i>{Quelloffset auf Stack sichern}
    </i></font><font color="#FF00FF">push cx                                </font><font color="#008000"><i>{Repetierzdhler auf Stack sichern}
    </i></font><font color="#FF00FF">rep  movsb                                        </font><font color="#008000"><i>{Kopiervorgang starten}
    </i></font><font color="#FF00FF">pop  cx                                      </font><font color="#008000"><i>{Repetierzdhler zur|ckholen}
    </i></font><font color="#FF00FF">pop  si                                         </font><font color="#008000"><i>{Quelloffset zur|ckholen}
    </i></font><font color="#FF00FF">dec  al                                </font><font color="#008000"><i>{AL = AL - 1 ndchste untere Plane}
    </i></font><font color="#FF00FF">jnl  @2                           </font><font color="#008000"><i>{Wenn AL nicht &lt; 0, dann weiter bei @2}
    </i></font><font color="#FF00FF">add  si,80                         </font><font color="#008000"><i>{Quelloffset auf ndchste Zeile setzen}
    </i></font><font color="#FF00FF">dec  bx                                              </font><font color="#008000"><i>{Vertikalzdhler - 1}
    </i></font><font color="#FF00FF">jnl  @1                              </font><font color="#008000"><i>{Wenn nicht &lt; 0, dann ndchste Zeile}

    </i></font><font color="#FF00FF">pop  es                          </font><font color="#008000"><i>{Verwendete Segmentregister zur|ckholen}
    </i></font><font color="#FF00FF">pop  ds
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#008000"><i>{---------------------------------------------------------------------------}

</i></font><font color="#FF0000"><b>procedure </b></font>PutImageX8<font color="#000080">(</font>XOfs<font color="#000080">,</font>YOfs<font color="#000080">:</font>Integer<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>IP<font color="#000080">); </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>var
  </b></font>XLen<font color="#000080">,</font>YLen <font color="#000080">: </font>Word<font color="#000080">;

</font><font color="#FF0000"><b>asm
    </b></font><font color="#FF00FF">push  ds                             </font><font color="#008000"><i>{Verwendete Segmentregister sichern}
    </i></font><font color="#FF00FF">push  es

    mov  es,SegA000                          </font><font color="#008000"><i>{Basis Videosegment A000h laden}

    </i></font><font color="#FF00FF">push ds                                                      </font><font color="#008000"><i>{DS sichern}
    </i></font><font color="#FF00FF">lds  si,[IP]                                  </font><font color="#008000"><i>{DS:SI = Zeiger auf Bitmap}
    </i></font><font color="#FF00FF">lodsw                                </font><font color="#008000"><i>{1. Wort = Anzahl Punkte horizontal}
    </i></font><font color="#FF00FF">shr  ax,3                    </font><font color="#008000"><i>{AX = Anzahl Bytes von horizontalen Punkten}
    </i></font><font color="#FF00FF">mov  XLen,ax             </font><font color="#008000"><i>{Laufvariable f|r Anzahl horizontale Scanzyklen}
    </i></font><font color="#FF00FF">lodsw                         </font><font color="#008000"><i>{2. Wort = Anzahl Zeilen (Punkte vertikal)}
    </i></font><font color="#FF00FF">mov  YLen,ax              </font><font color="#008000"><i>{Laufvariable f|r Anzahl vertikaler Scanzyklen}
    </i></font><font color="#FF00FF">mov  di,ds                                           </font><font color="#008000"><i>{DS in DI speichern}
    </i></font><font color="#FF00FF">pop  ds                         </font><font color="#008000"><i>{DS zur|ckholen um Maskenarrays zu laden}
    </i></font><font color="#FF00FF">mov  ax,YOfs
    shl  ax,4
    mov  bx,ax
    shl  ax,2
    add  ax,bx
    mov  bx,XOfs                  </font><font color="#008000"><i>{CX = Offset linker Punkt vom Zeilenanfang}
    </i></font><font color="#FF00FF">shr  bx,3
    add  ax,bx                                  </font><font color="#008000"><i>{Speicheradresse von 1.Punkt}
    </i></font><font color="#FF00FF">mov  ds,di                                       </font><font color="#008000"><i>{DI wieder zur|ck in DS}
    </i></font><font color="#FF00FF">mov  di,ax      </font><font color="#008000"><i>{Zielregister auf Speicheradresse von 1.Punkt einstellen}

    </i></font><font color="#FF00FF">mov  dx,03C4h                               </font><font color="#008000"><i>{DX = Sequenzer Command Port}
    </i></font><font color="#FF00FF">mov  al,2                                </font><font color="#008000"><i>{Das Map-Mask Register anwdhlen}
    </i></font><font color="#FF00FF">out  dx,al
    inc  dx                                        </font><font color="#008000"><i>{DX = Sequnezer Data Port}

    </i></font><font color="#FF00FF">mov  bx,YLen                                         </font><font color="#008000"><i>{BX = Anzahl Zeilen}
    </i></font><font color="#FF00FF">mov  cx,XLen                                         </font><font color="#008000"><i>{CX = Anzahl  Bytes}

</i></font><font color="#FF00FF">@1: mov  al,8                       </font><font color="#008000"><i>{Maske f|r 3. Plane im Map-Mask Register}

</i></font><font color="#FF00FF">@2: out  dx,al
    push di                                           </font><font color="#008000"><i>{Quelloffset auf Stack}
    </i></font><font color="#FF00FF">push cx                                       </font><font color="#008000"><i>{Laufregister CX auf Stack}
    </i></font><font color="#FF00FF">rep  movsb                                        </font><font color="#008000"><i>{Kopiervorgang starten}
    </i></font><font color="#FF00FF">pop  cx                                        </font><font color="#008000"><i>{Laufregister zur|ckholen}
    </i></font><font color="#FF00FF">pop  di                                         </font><font color="#008000"><i>{Quelloffset zur|ckholen}
    </i></font><font color="#FF00FF">shr  al,1                              </font><font color="#008000"><i>{Maske f|r ndchste Plane erzeugen}
    </i></font><font color="#FF00FF">jnz  @2            </font><font color="#008000"><i>{Wenn AL &gt; 0, dann die gleiche Zeile nochmal kopieren}
    </i></font><font color="#FF00FF">add  di,80                            </font><font color="#008000"><i>{Offset f|r ndchste Zeile addieren}
    </i></font><font color="#FF00FF">dec  bx                                   </font><font color="#008000"><i>{Vertikalzdhler dekrementieren}
    </i></font><font color="#FF00FF">jnl  @1                           </font><font color="#008000"><i>{Wenn BX nicht &lt; 0, dann weiter bei @1}

    </i></font><font color="#FF00FF">dec  dx                                     </font><font color="#008000"><i>{DX = Sequenzer Command Port}
    </i></font><font color="#FF00FF">mov  ax,0F02h         </font><font color="#008000"><i>{Map-Mask Register Normalzustand alle Planes aktiv}
    </i></font><font color="#FF00FF">out  dx,ax

    pop  es                                     </font><font color="#008000"><i>{Segmentregister zur|ckholen}
    </i></font><font color="#FF00FF">pop  ds

</font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#008000"><i>{---------------------------------------------------------------------------}
</i></font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to GRAPHICS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0204.PAS">Original</a><b>]</b></p></body>
</html>
