<html>
<head><title> "Another Quick PutImage" by DAVID CORDER</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to GRAPHICS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0183.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{ &Eacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&raquo;
  &ordm; &deg;&deg;Proc&deg;&deg;&deg;&deg;&deg;&deg;&deg;&deg;&deg;&deg;&deg;&deg;&deg;&deg;&deg;&deg; PutPic &deg;&deg;&deg;&deg;&deg;&deg;&deg;&deg;&deg;&deg;&deg;&deg;&deg;&deg;&deg;&deg;&deg;&deg;&deg;&deg;&deg;&deg;&deg;&deg;&deg;&deg;&deg;&deg;&deg;&deg;&deg;&deg;&deg;&deg;&deg;&deg;&deg;&deg; &ordm;
  &Egrave;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&frac14;}
</i></font><font color="#FF0000"><b>Procedure </b></font>PutPic<font color="#000080">(</font>X<font color="#000080">: </font>Word<font color="#000080">;</font>Y<font color="#000080">:</font>Byte<font color="#000080">;</font><font color="#FF0000"><b>VAR </b></font>sprt<font color="#000080">;</font>W<font color="#000080">,</font>H<font color="#000080">:</font>Byte<font color="#000080">;</font>Where<font color="#000080">:</font>Word<font color="#000080">); </font><font color="#FF0000"><b>ASSEMBLER</b></font><font color="#000080">;
  </font><font color="#008000"><i>{W=Width of sprite, H=Height Sprt=an array of pixels}
  { This puts an sprite, EXCEPT it's color 0 (black) pixels, onto the screen
    &quot;where&quot;(VAddr1/VGA etc.), at position X,Y }
</i></font><font color="#FF0000"><b>label
  </b></font>_Redraw<font color="#000080">, </font>_DrawLoop<font color="#000080">, </font>_Exit<font color="#000080">, </font>_LineLoop<font color="#000080">, </font>_NextLine<font color="#000080">, </font>_Ignore<font color="#000080">;

</font><font color="#FF0000"><b>asm
    </b></font><font color="#FF00FF">push  ds     </font><font color="#008000"><i>{ Save DS for later }
    </i></font><font color="#FF00FF">and   bl, 0
    mov   es, where   </font><font color="#008000"><i>{Move segment address of Where into ES:DI's segment}
    </i></font><font color="#FF00FF">lds   si, Sprt    </font><font color="#008000"><i>{ loads the address of Sprt into DS:SI }
    </i></font><font color="#FF00FF">mov   di, x       </font><font color="#008000"><i>{ Move x location into DI }

    {Work out (y*320)+x}
    </i></font><font color="#FF00FF">mov   bh, y       </font><font color="#008000"><i>{ bx = y*256 }
    </i></font><font color="#FF00FF">mov   ax, bx      </font><font color="#008000"><i>{ make another copy of y in ax}
    </i></font><font color="#FF00FF">shr   ax, 2       </font><font color="#008000"><i>{ y2 = y2 * 64}
    </i></font><font color="#FF00FF">add   bx, ax      </font><font color="#008000"><i>{ Work out y location : y = y1+y2 (y=y*320) }
    </i></font><font color="#FF00FF">add   di, bx      </font><font color="#008000"><i>{ finalise location  (Y*320)+X }

    </i></font><font color="#FF00FF">mov   ah, H       </font><font color="#008000"><i>{ ah = Height of sprite }
    </i></font><font color="#FF00FF">cld               </font><font color="#008000"><i>{Clear direction flag (DI inc's)}
    </i></font><font color="#FF00FF">and   ch, 0
    mov   al, W       </font><font color="#008000"><i>{Move in width }
    {Register usage:
           AX = HHWW
           BX = Comparison of byte
           CX = Across counter
           DX = 'Pushed' DI}
</i></font><font color="#FF00FF">_DrawLoop:
    mov   dx,di        </font><font color="#008000"><i>{ Store offset for later }
    </i></font><font color="#FF00FF">mov   cl,al       </font><font color="#008000"><i>{ move width into CX }
</i></font><font color="#FF00FF">_LineLoop:
    mov   bl,byte ptr [si]
    or    bl,bl       </font><font color="#008000"><i>{ checks if zero }
    </i></font><font color="#FF00FF">jz    _Ignore     </font><font color="#008000"><i>{if Color=0 then ignore it}
    </i></font><font color="#FF00FF">movsb
    loop   _LineLoop   </font><font color="#008000"><i>{Repeat CX times (Repeat for the width of sprite)}
    </i></font><font color="#FF00FF">jmp    _NextLine   </font><font color="#008000"><i>{Then go on to next line}

</i></font><font color="#FF00FF">_Ignore:
    inc    si          </font><font color="#008000"><i>{DS:SI = Sprite Array (inc SI = Next pixel)}
    </i></font><font color="#FF00FF">inc    di          </font><font color="#008000"><i>{Inc Mem locs ES:DI = incr. target location}
    </i></font><font color="#FF00FF">loop  _LineLoop    </font><font color="#008000"><i>{Continues reading the line}

</i></font><font color="#FF00FF">_NextLine:
    mov   di,dx        </font><font color="#008000"><i>{Restore x/y Vid.mem loc.}
    </i></font><font color="#FF00FF">dec   ah           </font><font color="#008000"><i>{Decrease height (Move down a line)}
    </i></font><font color="#FF00FF">jz    _Exit        </font><font color="#008000"><i>{If Height=0(Reached end of sprite) then exit }
    </i></font><font color="#FF00FF">add   di,140h      </font><font color="#008000"><i>{else : di = Move to next line in Vid.Mem }
    </i></font><font color="#FF00FF">jmp   _DrawLoop    </font><font color="#008000"><i>{Jump back to the draw loop}

</i></font><font color="#FF00FF">_Exit:
    pop   ds     </font><font color="#008000"><i>{ Restore DS }
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to GRAPHICS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0183.PAS">Original</a><b>]</b></p></body>
</html>
