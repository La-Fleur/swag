<html>
<head><title> "Yet another PCX viewer" by JANI ALANEN</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to GRAPHICS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0203.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{ here's a unit to view PCX-files in 320x200x256 }

</i></font><font color="#FF0000"><b>UNIT </b></font>PCX<font color="#000080">;

</font><font color="#FF0000"><b>INTERFACE

USES </b></font>crt<font color="#000080">;

</font><font color="#FF0000"><b>PROCEDURE </b></font>DoPCXPalette<font color="#000080">;
</font><font color="#FF0000"><b>FUNCTION </b></font>LoadPCX  <font color="#000080">(</font>Filename<font color="#000080">:</font><font color="#FF0000"><b>String</b></font><font color="#000080">; </font>Where<font color="#000080">:</font>Word<font color="#000080">):</font>Boolean<font color="#000080">;
  </font><font color="#008000"><i>{ Load a PCX file to the screen &quot;where&quot;
    Dopal = True sets up the correct PCX pallette, otherwise it leaves
            the pallette alone }

</i></font><font color="#FF0000"><b>VAR </b></font>Palette<font color="#000080">: </font><font color="#FF0000"><b>ARRAY</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">767</font><font color="#000080">] </font><font color="#FF0000"><b>OF </b></font>Byte<font color="#000080">;
    </font>loop1<font color="#000080">:</font>Word<font color="#000080">;
</font><font color="#FF0000"><b>IMPLEMENTATION


PROCEDURE </b></font>DoPal<font color="#000080">(</font>Col<font color="#000080">,</font>R<font color="#000080">,</font>G<font color="#000080">,</font>B <font color="#000080">: </font>Byte<font color="#000080">); </font><font color="#FF0000"><b>ASSEMBLER</b></font><font color="#000080">; </font><font color="#FF0000"><b>ASM
   </b></font><font color="#FF00FF">mov    dx,3c8h
   mov    al,[col]
   out    dx,al
   inc    dx
   mov    al,[r]
   out    dx,al
   mov    al,[g]
   out    dx,al
   mov    al,[b]
   out    dx,al
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>PROCEDURE </b></font>DoPCXPalette<font color="#000080">;
</font><font color="#FF0000"><b>BEGIN
  FOR </b></font>loop1<font color="#000080">:=</font><font color="#800000">0 </font><font color="#FF0000"><b>TO </b></font><font color="#800000">255 </font><font color="#FF0000"><b>DO
      </b></font>DoPal <font color="#000080">(</font>loop1<font color="#000080">,</font>palette<font color="#000080">[</font>loop1<font color="#000080">*</font><font color="#800000">3</font><font color="#000080">] </font><font color="#FF0000"><b>shr </b></font><font color="#800000">2</font><font color="#000080">,</font>palette<font color="#000080">[</font>loop1<font color="#000080">*</font><font color="#800000">3</font><font color="#000080">+</font><font color="#800000">1</font><font color="#000080">] </font><font color="#FF0000"><b>shr </b></font><font color="#800000">2</font><font color="#000080">,
            </font>palette<font color="#000080">[</font>loop1<font color="#000080">*</font><font color="#800000">3</font><font color="#000080">+</font><font color="#800000">2</font><font color="#000080">] </font><font color="#FF0000"><b>shr </b></font><font color="#800000">2</font><font color="#000080">);
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>FUNCTION </b></font>LoadPCX <font color="#000080">(</font>Filename<font color="#000080">:</font><font color="#FF0000"><b>String</b></font><font color="#000080">; </font>Where<font color="#000080">:</font>Word<font color="#000080">):</font>Boolean<font color="#000080">; </font><font color="#FF0000"><b>VAR </b></font>f<font color="#000080">:</font><font color="#FF0000"><b>File</b></font><font color="#000080">;
    </font>Res<font color="#000080">:</font>Word<font color="#000080">;
    </font>Temp<font color="#000080">:</font>Pointer<font color="#000080">;
</font><font color="#FF0000"><b>BEGIN
    </b></font>Assign <font color="#000080">(</font>f<font color="#000080">,</font>Filename<font color="#000080">);
    </font>Reset <font color="#000080">(</font>f<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">);
    </font>Seek<font color="#000080">(</font>f<font color="#000080">,</font>FileSize<font color="#000080">(</font>f<font color="#000080">)-</font><font color="#800000">768</font><font color="#000080">);
    </font>BlockRead<font color="#000080">(</font>f<font color="#000080">,</font>Palette<font color="#000080">,</font><font color="#800000">768</font><font color="#000080">);
    </font>Seek<font color="#000080">(</font>f<font color="#000080">,</font><font color="#800000">128</font><font color="#000080">);
    </font>GetMem <font color="#000080">(</font>Temp<font color="#000080">,</font><font color="#800000">65535</font><font color="#000080">);
    </font>BlockRead <font color="#000080">(</font>f<font color="#000080">,</font>Temp<font color="#000080">^,</font><font color="#800000">65535</font><font color="#000080">,</font>Res<font color="#000080">);
  </font><font color="#FF0000"><b>ASM
    </b></font><font color="#FF00FF">push ds
    mov  ax,where
    mov  es,ax
    xor  di,di
    xor  ch,ch
    lds  si,temp
@Loop1 :
    lodsb
    mov  bl,al
    and  bl,$c0
    cmp  bl,$c0
    jne  @Single

    mov  cl,al
    and  cl,$3f
    lodsb
    rep  stosb
    jmp  @Fin
@Single :
    stosb
@Fin :
    cmp  di,63999
    jbe  @Loop1
    pop  ds
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
  </font>FreeMem <font color="#000080">(</font>Temp<font color="#000080">,</font><font color="#800000">65535</font><font color="#000080">);
  </font>Close <font color="#000080">(</font>f<font color="#000080">);
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>BEGIN

END</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to GRAPHICS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0203.PAS">Original</a><b>]</b></p></body>
</html>
