<html>
<head><title> "Super Palette Unit" by RICK HAINES</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to GRAPHICS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0180.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
&gt;&gt; Could someone please explain to me about VGA palette fading and
&gt;&gt; rotating?  I am writing a small screensaver program, and want to rotate
&gt;&gt; the palette and fade a little.  Any help would be greatly appreciated.

&gt;First, a few questions for you.  Do you know how to access the Palette?  Do
&gt;you know how the VGA Palette is set up?  If not, I can help you understand i
&gt;&amp; manipulate it.

JR&gt;Once you know the above, fading &amp; rotating is pretty easy.  Fading is just
JR&gt;decrementing the values in the palette slowly while rotating is just moving
JR&gt;all the values in the palette forward or backward.


Here is some source for Fadeing, Cycling, and Rotating the palette.  It
probably doesn't have the procedures you need for a Screensaver, but I
figure you will be able to understand it and write you own procedures
using the code provided.  (I have tested the code and find that it works
almost perfectly on my machine (there's a little &quot;snow&quot; at the top) but
I make no guarantees that it will work for anyone elses).

If you need a Demo program that uses this unit, just ask, I have one.


{ ********************************************************** }
{ ********************** Palette Unit ********************** }
{ ********************************************************** }
{ **************** Written by: Rick Haines ***************** }
{ ********************************************************** }
{ ***************** Last Revised 11/28/94 ****************** }
{ ********************************************************** }

</i></font><font color="#FF0000"><b>Unit </b></font>Palette<font color="#000080">;

</font><font color="#008000"><i>{ ********************************************************** }
{ *********************** REMINDER!: *********************** }
{ ************* The first color in the palette ************* }
{ **************** is the background color! **************** }
{ ********************************************************** }

</i></font><font color="#FF0000"><b>Interface

 Type
  </b></font>RGBColor <font color="#000080">= </font><font color="#FF0000"><b>Record
    </b></font>R<font color="#000080">, </font>G<font color="#000080">, </font>B <font color="#000080">: </font>Byte<font color="#000080">;
   </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
  </font>RGBPalette <font color="#000080">= </font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">255</font><font color="#000080">] </font><font color="#FF0000"><b>Of </b></font>RGBColor<font color="#000080">;

 </font><font color="#FF0000"><b>Procedure </b></font>WaitForVRT<font color="#000080">;                                       </font><font color="#008000"><i>{ Wait For Verticl}

 </i></font><font color="#FF0000"><b>Procedure </b></font>FadeInColor<font color="#000080">(</font>ColorNum   <font color="#000080">: </font>Byte<font color="#000080">);                   </font><font color="#008000"><i>{ Fade In a specif}
 </i></font><font color="#FF0000"><b>Procedure </b></font>FadeOutColor<font color="#000080">(</font>ColorNum  <font color="#000080">: </font>Byte<font color="#000080">);                   </font><font color="#008000"><i>{ Fade Out a speci}
 </i></font><font color="#FF0000"><b>Procedure </b></font>RestoreColor<font color="#000080">(</font>ColorNum  <font color="#000080">: </font>Byte<font color="#000080">);                   </font><font color="#008000"><i>{ Fade In Color im}
 </i></font><font color="#FF0000"><b>Procedure </b></font>BlackOutColor<font color="#000080">(</font>ColorNum <font color="#000080">: </font>Byte<font color="#000080">);                   </font><font color="#008000"><i>{ Fade Out Color i}
 </i></font><font color="#FF0000"><b>Procedure </b></font>CycleColor<font color="#000080">(</font>ColorNum<font color="#000080">, </font>Red<font color="#000080">, </font>Green<font color="#000080">, </font>Blue  <font color="#000080">: </font>Byte<font color="#000080">);   </font><font color="#008000"><i>{ Cycle color into}
 </i></font><font color="#FF0000"><b>Procedure </b></font>ChangeColor<font color="#000080">(</font>ColorNum<font color="#000080">, </font>Red<font color="#000080">, </font>Green<font color="#000080">, </font>Blue <font color="#000080">: </font>Byte<font color="#000080">);   </font><font color="#008000"><i>{ Change color int}
 </i></font><font color="#FF0000"><b>Procedure </b></font>CopyColor<font color="#000080">(</font>Num      <font color="#000080">: </font>Byte<font color="#000080">; </font><font color="#FF0000"><b>Var </b></font>Color <font color="#000080">: </font>RGBColor<font color="#000080">); </font><font color="#008000"><i>{ Load a copy of C}
 </i></font><font color="#FF0000"><b>Procedure </b></font>GetCopyOfColor<font color="#000080">(</font>Num <font color="#000080">: </font>Byte<font color="#000080">; </font><font color="#FF0000"><b>Var </b></font>Color <font color="#000080">: </font>RGBColor<font color="#000080">); </font><font color="#008000"><i>{ Get a Copy of Co}

 </i></font><font color="#FF0000"><b>Procedure </b></font>GetPalette<font color="#000080">;                                </font><font color="#008000"><i>{ Load the default Palett}
 </i></font><font color="#FF0000"><b>Procedure </b></font>CyclePalette<font color="#000080">;                              </font><font color="#008000"><i>{ Cycle from one Palette }
 </i></font><font color="#FF0000"><b>Procedure </b></font>FadeInPalette<font color="#000080">;                             </font><font color="#008000"><i>{ Fade Palette in slowly }
 </i></font><font color="#FF0000"><b>Procedure </b></font>FadeOutPalette<font color="#000080">;                            </font><font color="#008000"><i>{ Fade Palette out slowly}
 </i></font><font color="#FF0000"><b>Procedure </b></font>RestorePalette<font color="#000080">;                            </font><font color="#008000"><i>{ Fade Palette in immedia}
 </i></font><font color="#FF0000"><b>Procedure </b></font>BlackOutPalette<font color="#000080">;                           </font><font color="#008000"><i>{ Fade Palette out immedi}
 </i></font><font color="#FF0000"><b>Procedure </b></font>LoadPalette<font color="#000080">(</font>PalName <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">);             </font><font color="#008000"><i>{ Load a palette         }
 </i></font><font color="#FF0000"><b>Procedure </b></font>SavePalette<font color="#000080">(</font>PalName <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">);             </font><font color="#008000"><i>{ Save the palette that i}
 </i></font><font color="#FF0000"><b>Procedure </b></font>CyclePaletteToColor<font color="#000080">(</font>ColorNum  <font color="#000080">: </font>Byte<font color="#000080">);     </font><font color="#008000"><i>{ Cycle entire Palette Co}
 </i></font><font color="#FF0000"><b>Procedure </b></font>ChangePaletteToColor<font color="#000080">(</font>ColorNum <font color="#000080">: </font>Byte<font color="#000080">);     </font><font color="#008000"><i>{ Change entire Palette C}
 </i></font><font color="#FF0000"><b>Procedure </b></font>CopyPalette<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>NewPal    <font color="#000080">: </font>RGBPalette<font color="#000080">);   </font><font color="#008000"><i>{ Load palette already in}
 </i></font><font color="#FF0000"><b>Procedure </b></font>GetCopyOfPalette<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>Copy <font color="#000080">: </font>RGBPalette<font color="#000080">);   </font><font color="#008000"><i>{ Incase you don't want t}

 </i></font><font color="#FF0000"><b>Procedure </b></font>CyclePart<font color="#000080">(</font>FirstC<font color="#000080">, </font>LastC <font color="#000080">: </font>Byte<font color="#000080">);                   </font><font color="#008000"><i>{ Cycle from one }
 </i></font><font color="#FF0000"><b>Procedure </b></font>FadeInPart<font color="#000080">(</font>FirstC<font color="#000080">, </font>LastC   <font color="#000080">: </font>Byte<font color="#000080">);                </font><font color="#008000"><i>{ Fade Part in sl}
 </i></font><font color="#FF0000"><b>Procedure </b></font>FadeOutPart<font color="#000080">(</font>FirstC<font color="#000080">, </font>LastC  <font color="#000080">: </font>Byte<font color="#000080">);                </font><font color="#008000"><i>{ Fade Part out s}
 </i></font><font color="#FF0000"><b>Procedure </b></font>RestorePart<font color="#000080">(</font>FirstC<font color="#000080">, </font>LastC  <font color="#000080">: </font>Byte<font color="#000080">);                </font><font color="#008000"><i>{ Fade Part in im}
 </i></font><font color="#FF0000"><b>Procedure </b></font>BlackOutPart<font color="#000080">(</font>FirstC<font color="#000080">, </font>LastC <font color="#000080">: </font>Byte<font color="#000080">);                </font><font color="#008000"><i>{ Fade Part out i}
 </i></font><font color="#FF0000"><b>Procedure </b></font>RotatePartForward<font color="#000080">(</font>FirstC<font color="#000080">, </font>LastC  <font color="#000080">: </font>Byte<font color="#000080">);          </font><font color="#008000"><i>{ Rotate Part For}
 </i></font><font color="#FF0000"><b>Procedure </b></font>RotatePartBackward<font color="#000080">(</font>FirstC<font color="#000080">, </font>LastC <font color="#000080">: </font>Byte<font color="#000080">);          </font><font color="#008000"><i>{ Rotate Part Bac}
 </i></font><font color="#FF0000"><b>Procedure </b></font>CyclePartToColor<font color="#000080">(</font>FirstC<font color="#000080">, </font>LastC<font color="#000080">, </font>ColorNum  <font color="#000080">: </font>Byte<font color="#000080">); </font><font color="#008000"><i>{ Cycle Part Colo}
 </i></font><font color="#FF0000"><b>Procedure </b></font>ChangePartToColor<font color="#000080">(</font>FirstC<font color="#000080">, </font>LastC<font color="#000080">, </font>ColorNum <font color="#000080">: </font>Byte<font color="#000080">); </font><font color="#008000"><i>{ Change Part Col}

</i></font><font color="#FF0000"><b>Implementation
 Uses </b></font>MostUsed<font color="#000080">;

 </font><font color="#FF0000"><b>Const
  </b></font>PalRange <font color="#000080">= </font><font color="#800000">$03C6</font><font color="#000080">;
  </font>ReadPal  <font color="#000080">= </font><font color="#800000">$03C7</font><font color="#000080">;
  </font>WritePal <font color="#000080">= </font><font color="#800000">$03C8</font><font color="#000080">;
  </font>PalData  <font color="#000080">= </font><font color="#800000">$03C9</font><font color="#000080">;
  </font>VRTPort  <font color="#000080">= </font><font color="#800000">$03DA</font><font color="#000080">;

 </font><font color="#FF0000"><b>Var
  </b></font>APalette<font color="#000080">,
  </font>BackUpP  <font color="#000080">: </font>RGBPalette<font color="#000080">;
  </font>ExColor  <font color="#000080">: </font>RGBColor<font color="#000080">;
  </font>First<font color="#000080">,
  </font>Last<font color="#000080">,
  </font>I<font color="#000080">, </font>II<font color="#000080">, </font>Z <font color="#000080">: </font>Byte<font color="#000080">;

 </font><font color="#FF0000"><b>Procedure </b></font>WaitForVRT<font color="#000080">; </font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>Asm                  </b></font><font color="#008000"><i>{ Wait for Verticle Retrace so that }
   </i></font><font color="#FF00FF">Mov     DX, VRTPort </font><font color="#008000"><i>{ &quot;snow&quot; is avoided                 }
  </i></font><font color="#FF00FF">@VRT:
   In      AL, DX
   Test    AL, 8
   JNZ     @VRT        </font><font color="#008000"><i>{ Wait until Verticle Retrace starts }
  </i></font><font color="#FF00FF">@NoVRT:
   In      AL, DX
   Test    AL, 8
   JZ      @NoVRT      </font><font color="#008000"><i>{ Wait until Verticle Retrace Ends   }
  </i></font><font color="#FF0000"><b>End</b></font><font color="#000080">;

 </font><font color="#FF0000"><b>Procedure </b></font>WriteColor<font color="#000080">(</font>ColorNum <font color="#000080">: </font>Byte<font color="#000080">); </font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>Asm

 </b></font><font color="#008000"><i>{ Initialization Stuff }

   </i></font><font color="#FF00FF">Mov SI, Offset APalette </font><font color="#008000"><i>{ DS:SI := @APalette        }

   </i></font><font color="#FF00FF">Xor CH, CH
   Mov CL, ColorNum        </font><font color="#008000"><i>{ CX := ColorNum            }
   </i></font><font color="#FF00FF">Mov AX, CX
   ShL AX, 1               </font><font color="#008000"><i>{ Use a Shift by Two and an }
   </i></font><font color="#FF00FF">Add CX, AX              </font><font color="#008000"><i>{ Add to Multiply by 3      }
   </i></font><font color="#FF00FF">Add SI, CX              </font><font color="#008000"><i>{ Adjust Offset of APalette }

   </i></font><font color="#FF00FF">Mov DX, PalRange        </font><font color="#008000"><i>{ DX := Palette Range Port  }
   </i></font><font color="#FF00FF">Mov AX, 0FFh            </font><font color="#008000"><i>{ AX := Range is All Colors }
   </i></font><font color="#FF00FF">Out DX, AX              </font><font color="#008000"><i>{ Write AX To Port DX       }

   </i></font><font color="#FF00FF">Call WaitForVRT;        </font><font color="#008000"><i>{ Wait for Verticle ReTrace }

 { Write the color to Ports }

   </i></font><font color="#FF00FF">Mov DX, WritePal        </font><font color="#008000"><i>{ DX := Color To Write Port      }
   </i></font><font color="#FF00FF">Mov AL, ColorNum        </font><font color="#008000"><i>{ AL := Color To Write           }
   </i></font><font color="#FF00FF">Out DX, AL              </font><font color="#008000"><i>{ Tell It We Want to Write Color }
   </i></font><font color="#FF00FF">Mov DX, PalData         </font><font color="#008000"><i>{ DX := Palette Data Port        }
   </i></font><font color="#FF00FF">Mov AL, [SI]            </font><font color="#008000"><i>{ AL := APalette[ColorNum].R     }
   </i></font><font color="#FF00FF">Out DX, AL              </font><font color="#008000"><i>{ Write it                       }
   </i></font><font color="#FF00FF">Inc SI                  </font><font color="#008000"><i>{ Inc Offset                     }
   </i></font><font color="#FF00FF">Mov AL, [SI]            </font><font color="#008000"><i>{ AL := APalette[ColorNum].G     }
   </i></font><font color="#FF00FF">Out DX, AL              </font><font color="#008000"><i>{ Write it                       }
   </i></font><font color="#FF00FF">Inc SI                  </font><font color="#008000"><i>{ Inc Offset                     }
   </i></font><font color="#FF00FF">Mov AL, [SI]            </font><font color="#008000"><i>{ AL := APalette[ColorNum].G     }
   </i></font><font color="#FF00FF">Out DX, AL              </font><font color="#008000"><i>{ Write it                       }
  </i></font><font color="#FF0000"><b>End</b></font><font color="#000080">;

 </font><font color="#FF0000"><b>Procedure </b></font>FadeInColor<font color="#000080">(</font>ColorNum <font color="#000080">: </font>Byte<font color="#000080">);
  </font><font color="#FF0000"><b>Begin
   For </b></font>I <font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>To </b></font><font color="#800000">63 </font><font color="#FF0000"><b>Do
    With </b></font>APalette<font color="#000080">[</font>ColorNum<font color="#000080">] </font><font color="#FF0000"><b>Do
     Begin
      If </b></font>R <font color="#000080">&lt; </font>BackUpP<font color="#000080">[</font>ColorNum<font color="#000080">].</font>R <font color="#FF0000"><b>Then </b></font>Inc<font color="#000080">(</font>R<font color="#000080">);
      </font><font color="#FF0000"><b>If </b></font>G <font color="#000080">&lt; </font>BackUpP<font color="#000080">[</font>ColorNum<font color="#000080">].</font>G <font color="#FF0000"><b>Then </b></font>Inc<font color="#000080">(</font>G<font color="#000080">);
      </font><font color="#FF0000"><b>If </b></font>B <font color="#000080">&lt; </font>BackUpP<font color="#000080">[</font>ColorNum<font color="#000080">].</font>B <font color="#FF0000"><b>Then </b></font>Inc<font color="#000080">(</font>B<font color="#000080">);
      </font>WriteColor<font color="#000080">(</font>ColorNum<font color="#000080">);
     </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

 </font><font color="#FF0000"><b>Procedure </b></font>FadeOutColor<font color="#000080">(</font>ColorNum <font color="#000080">: </font>Byte<font color="#000080">);
  </font><font color="#FF0000"><b>Begin
   For </b></font>I <font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>To </b></font><font color="#800000">63 </font><font color="#FF0000"><b>Do
    With </b></font>APalette<font color="#000080">[</font>ColorNum<font color="#000080">] </font><font color="#FF0000"><b>Do
     Begin
      If </b></font>R <font color="#000080">&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>Then </b></font>Dec<font color="#000080">(</font>R<font color="#000080">);
      </font><font color="#FF0000"><b>If </b></font>G <font color="#000080">&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>Then </b></font>Dec<font color="#000080">(</font>G<font color="#000080">);
      </font><font color="#FF0000"><b>If </b></font>B <font color="#000080">&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>Then </b></font>Dec<font color="#000080">(</font>B<font color="#000080">);
      </font>WriteColor<font color="#000080">(</font>ColorNum<font color="#000080">);
     </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

 </font><font color="#FF0000"><b>Procedure </b></font>RestoreColor<font color="#000080">(</font>ColorNum <font color="#000080">: </font>Byte<font color="#000080">);
  </font><font color="#FF0000"><b>Begin
   </b></font>APalette<font color="#000080">[</font>ColorNum<font color="#000080">] := </font>BackUpP<font color="#000080">[</font>ColorNum<font color="#000080">];
   </font>WriteColor<font color="#000080">(</font>ColorNum<font color="#000080">);
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

 </font><font color="#FF0000"><b>Procedure </b></font>BlackOutColor<font color="#000080">(</font>ColorNum <font color="#000080">: </font>Byte<font color="#000080">);
  </font><font color="#FF0000"><b>Begin
   With </b></font>APalette<font color="#000080">[</font>ColorNum<font color="#000080">] </font><font color="#FF0000"><b>Do
    Begin
     </b></font>R <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
     </font>G <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
     </font>B <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
    </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
   </font>WriteColor<font color="#000080">(</font>ColorNum<font color="#000080">);
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

 </font><font color="#FF0000"><b>Procedure </b></font>CopyColor<font color="#000080">(</font>Num <font color="#000080">: </font>Byte<font color="#000080">; </font><font color="#FF0000"><b>Var </b></font>Color <font color="#000080">: </font>RGBColor<font color="#000080">);
  </font><font color="#FF0000"><b>Begin
   With </b></font>BackUpP<font color="#000080">[</font>Num<font color="#000080">] </font><font color="#FF0000"><b>Do
    Begin
     </b></font>R <font color="#000080">:= </font>Color<font color="#000080">.</font>R<font color="#000080">;
     </font>G <font color="#000080">:= </font>Color<font color="#000080">.</font>G<font color="#000080">;
     </font>B <font color="#000080">:= </font>Color<font color="#000080">.</font>B<font color="#000080">;
    </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

 </font><font color="#FF0000"><b>Procedure </b></font>CycleColor<font color="#000080">(</font>ColorNum<font color="#000080">, </font>Red<font color="#000080">, </font>Green<font color="#000080">, </font>Blue <font color="#000080">: </font>Byte<font color="#000080">);
  </font><font color="#FF0000"><b>Begin
   For </b></font>I <font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>To </b></font><font color="#800000">63 </font><font color="#FF0000"><b>Do
    With </b></font>APalette<font color="#000080">[</font>ColorNum<font color="#000080">] </font><font color="#FF0000"><b>Do
     Begin
      If </b></font>R <font color="#000080">&lt; </font>Red   <font color="#FF0000"><b>Then </b></font>Inc<font color="#000080">(</font>R<font color="#000080">);
      </font><font color="#FF0000"><b>If </b></font>G <font color="#000080">&lt; </font>Green <font color="#FF0000"><b>Then </b></font>Inc<font color="#000080">(</font>G<font color="#000080">);
      </font><font color="#FF0000"><b>If </b></font>B <font color="#000080">&lt; </font>Blue  <font color="#FF0000"><b>Then </b></font>Inc<font color="#000080">(</font>B<font color="#000080">);
      </font><font color="#FF0000"><b>If </b></font>R <font color="#000080">&gt; </font>Red   <font color="#FF0000"><b>Then </b></font>Dec<font color="#000080">(</font>R<font color="#000080">);
      </font><font color="#FF0000"><b>If </b></font>G <font color="#000080">&gt; </font>Green <font color="#FF0000"><b>Then </b></font>Dec<font color="#000080">(</font>G<font color="#000080">);
      </font><font color="#FF0000"><b>If </b></font>B <font color="#000080">&gt; </font>Blue  <font color="#FF0000"><b>Then </b></font>Dec<font color="#000080">(</font>B<font color="#000080">);
      </font>WriteColor<font color="#000080">(</font>ColorNum<font color="#000080">);
     </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

 </font><font color="#FF0000"><b>Procedure </b></font>ChangeColor<font color="#000080">(</font>ColorNum<font color="#000080">, </font>Red<font color="#000080">, </font>Green<font color="#000080">, </font>Blue <font color="#000080">: </font>Byte<font color="#000080">);
  </font><font color="#FF0000"><b>Begin
   With </b></font>BackUpP<font color="#000080">[</font>ColorNum<font color="#000080">] </font><font color="#FF0000"><b>Do
    Begin
     </b></font>R <font color="#000080">:= </font>Red<font color="#000080">;
     </font>G <font color="#000080">:= </font>Green<font color="#000080">;
     </font>B <font color="#000080">:= </font>Blue<font color="#000080">;
    </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

 </font><font color="#FF0000"><b>Procedure </b></font>GetCopyOfColor<font color="#000080">(</font>Num <font color="#000080">: </font>Byte<font color="#000080">; </font><font color="#FF0000"><b>Var </b></font>Color <font color="#000080">: </font>RGBColor<font color="#000080">);
  </font><font color="#FF0000"><b>Begin
   With </b></font>BackUpP<font color="#000080">[</font>Num<font color="#000080">] </font><font color="#FF0000"><b>Do
    Begin
     </b></font>Color<font color="#000080">.</font>R <font color="#000080">:= </font>R<font color="#000080">;
     </font>Color<font color="#000080">.</font>G <font color="#000080">:= </font>G<font color="#000080">;
     </font>Color<font color="#000080">.</font>B <font color="#000080">:= </font>B<font color="#000080">;
    </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

 </font><font color="#FF0000"><b>Procedure </b></font>GetPalette<font color="#000080">; </font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>Asm

 </b></font><font color="#008000"><i>{ Initialization Stuff }

   </i></font><font color="#FF00FF">Mov DI, Offset BackUpP  </font><font color="#008000"><i>{ DS:DI := @BackUpP         }

   </i></font><font color="#FF00FF">Xor CX, CX              </font><font color="#008000"><i>{ CL := 0 (Counter)         }

   </i></font><font color="#FF00FF">Mov DX, PalRange        </font><font color="#008000"><i>{ DX := Palette Range Port  }
   </i></font><font color="#FF00FF">Mov AX, 0FFh            </font><font color="#008000"><i>{ AX := Range is All Colors }
   </i></font><font color="#FF00FF">Out DX, AX              </font><font color="#008000"><i>{ Write AX To Port DX       }

   </i></font><font color="#FF00FF">Call WaitForVRT;        </font><font color="#008000"><i>{ Wait for Verticle ReTrace }

 { Now Get the Entire Palette From Ports }

  </i></font><font color="#FF00FF">@MainLoop:
   Mov DX, ReadPal         </font><font color="#008000"><i>{ DX := Color To Read Port           }
   </i></font><font color="#FF00FF">Mov AL, CL              </font><font color="#008000"><i>{ AL := CL (Current Color)           }
   </i></font><font color="#FF00FF">Out DX, AL              </font><font color="#008000"><i>{ Tell It We Want to Read Color # CL }
   </i></font><font color="#FF00FF">Mov DX, PalData         </font><font color="#008000"><i>{ DX := Palette Data Port            }

   </i></font><font color="#FF00FF">In  AL, DX              </font><font color="#008000"><i>{ Read Red            }
   </i></font><font color="#FF00FF">Mov [DI], AL            </font><font color="#008000"><i>{ BackUpP[CL].R := AL }
   </i></font><font color="#FF00FF">Inc DI                  </font><font color="#008000"><i>{ Inc Offset          }
   </i></font><font color="#FF00FF">In  AL, DX              </font><font color="#008000"><i>{ Read Green          }
   </i></font><font color="#FF00FF">Mov [DI], AL            </font><font color="#008000"><i>{ BackUpP[CL].G := AL }
   </i></font><font color="#FF00FF">Inc DI                  </font><font color="#008000"><i>{ Inc Offset          }
   </i></font><font color="#FF00FF">In  AL, DX              </font><font color="#008000"><i>{ Read Blue           }
   </i></font><font color="#FF00FF">Mov [DI], AL            </font><font color="#008000"><i>{ BackUpP[CL].B := AL }
   </i></font><font color="#FF00FF">Inc DI                  </font><font color="#008000"><i>{ Inc Offset          }
   </i></font><font color="#FF00FF">Inc CX                  </font><font color="#008000"><i>{ Inc Counter         }
   </i></font><font color="#FF00FF">Cmp CX, 256             </font><font color="#008000"><i>{ Are We Done?        }
   </i></font><font color="#FF00FF">JNE @MainLoop           </font><font color="#008000"><i>{ No?  Then Loop      }

 { Now Do APalette := BackUpP }

   </i></font><font color="#FF00FF">Mov SI, Offset BackUpP  </font><font color="#008000"><i>{ DS:SI := @BackUpP      }
   </i></font><font color="#FF00FF">Mov DI, DS
   Mov ES, DI
   Mov DI, Offset APalette </font><font color="#008000"><i>{ ES:DI := @APalette     }
   </i></font><font color="#FF00FF">Mov CX, 256*3           </font><font color="#008000"><i>{ How many bytes to copy }
   </i></font><font color="#FF00FF">Shr CX, 1               </font><font color="#008000"><i>{ Div by 2 for Words     }
   </i></font><font color="#FF00FF">ClD                     </font><font color="#008000"><i>{ Go downward in memory  }
   </i></font><font color="#FF00FF">Rep MovSW               </font><font color="#008000"><i>{ Move It                }
  </i></font><font color="#FF0000"><b>End</b></font><font color="#000080">;

 </font><font color="#FF0000"><b>Procedure </b></font>WritePalette<font color="#000080">; </font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>Asm

  </b></font><font color="#008000"><i>{ Initialization Stuff }
   </i></font><font color="#FF00FF">Mov SI, Offset APalette </font><font color="#008000"><i>{ DS:SI := @APalette        }
   </i></font><font color="#FF00FF">Xor CX, CX              </font><font color="#008000"><i>{ CX := 0 (Counter)         }

   </i></font><font color="#FF00FF">Mov DX, PalRange        </font><font color="#008000"><i>{ DX := Palette Range Port  }
   </i></font><font color="#FF00FF">Mov AX, 0FFh            </font><font color="#008000"><i>{ AX := Range is All Colors }
   </i></font><font color="#FF00FF">Out DX, AX              </font><font color="#008000"><i>{ Write AX To Port DX       }

   </i></font><font color="#FF00FF">Call WaitForVRT;        </font><font color="#008000"><i>{ Wait for Verticle ReTrace }

 { Now write Entire Palette to Ports }

  </i></font><font color="#FF00FF">@MainLoop:

   Mov DX, WritePal        </font><font color="#008000"><i>{ DX := Color To Write Port           }
   </i></font><font color="#FF00FF">Mov AL, CL              </font><font color="#008000"><i>{ AL := CL (Current Color)            }
   </i></font><font color="#FF00FF">Out DX, AL              </font><font color="#008000"><i>{ Tell It We Want to Write Color # CL }
   </i></font><font color="#FF00FF">Mov DX, PalData         </font><font color="#008000"><i>{ DX := Palette Data Port             }

   </i></font><font color="#FF00FF">Mov AL, [SI]            </font><font color="#008000"><i>{ AL := APalette[CL].R                }
   </i></font><font color="#FF00FF">Out DX, AL              </font><font color="#008000"><i>{ Write it                            }
   </i></font><font color="#FF00FF">Inc SI                  </font><font color="#008000"><i>{ Inc Offset                          }
   </i></font><font color="#FF00FF">Mov AL, [SI]            </font><font color="#008000"><i>{ AL := APalette[CL].R                }
   </i></font><font color="#FF00FF">Out DX, AL              </font><font color="#008000"><i>{ Write it                            }
   </i></font><font color="#FF00FF">Inc SI                  </font><font color="#008000"><i>{ Inc Offset                          }
   </i></font><font color="#FF00FF">Mov AL, [SI]            </font><font color="#008000"><i>{ AL := APalette[CL].G                }
   </i></font><font color="#FF00FF">Out DX, AL              </font><font color="#008000"><i>{ Write it                            }
   </i></font><font color="#FF00FF">Inc SI                  </font><font color="#008000"><i>{ Inc Offset                          }
   </i></font><font color="#FF00FF">Inc CX                  </font><font color="#008000"><i>{ Inc Counter                         }
   </i></font><font color="#FF00FF">Cmp CX, 256             </font><font color="#008000"><i>{ Are We Done?                        }
   </i></font><font color="#FF00FF">JNE @MainLoop           </font><font color="#008000"><i>{ No?  Then Loop                      }
  </i></font><font color="#FF0000"><b>End</b></font><font color="#000080">;

 </font><font color="#FF0000"><b>Procedure </b></font>CyclePalette<font color="#000080">;
  </font><font color="#FF0000"><b>Begin
   For </b></font>I <font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>To </b></font><font color="#800000">63 </font><font color="#FF0000"><b>Do
    Begin
     For </b></font>II <font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>To </b></font><font color="#800000">255 </font><font color="#FF0000"><b>Do With </b></font>APalette<font color="#000080">[</font>II<font color="#000080">] </font><font color="#FF0000"><b>Do
      Begin
       If </b></font>R <font color="#000080">&lt; </font>BackUpP<font color="#000080">[</font>II<font color="#000080">].</font>R <font color="#FF0000"><b>Then </b></font>Inc<font color="#000080">(</font>R<font color="#000080">)
        </font><font color="#FF0000"><b>Else If </b></font>R <font color="#000080">&gt; </font>BackUpP<font color="#000080">[</font>II<font color="#000080">].</font>R <font color="#FF0000"><b>Then </b></font>Dec<font color="#000080">(</font>R<font color="#000080">);
       </font><font color="#FF0000"><b>If </b></font>G <font color="#000080">&lt; </font>BackUpP<font color="#000080">[</font>II<font color="#000080">].</font>G <font color="#FF0000"><b>Then </b></font>Inc<font color="#000080">(</font>G<font color="#000080">)
        </font><font color="#FF0000"><b>Else If </b></font>G <font color="#000080">&gt; </font>BackUpP<font color="#000080">[</font>II<font color="#000080">].</font>G <font color="#FF0000"><b>Then </b></font>Dec<font color="#000080">(</font>G<font color="#000080">);
       </font><font color="#FF0000"><b>If </b></font>B <font color="#000080">&lt; </font>BackUpP<font color="#000080">[</font>II<font color="#000080">].</font>B <font color="#FF0000"><b>Then </b></font>Inc<font color="#000080">(</font>B<font color="#000080">)
        </font><font color="#FF0000"><b>Else If </b></font>B <font color="#000080">&gt; </font>BackUpP<font color="#000080">[</font>II<font color="#000080">].</font>B <font color="#FF0000"><b>Then </b></font>Dec<font color="#000080">(</font>B<font color="#000080">);
      </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
     </font>WritePalette<font color="#000080">;
    </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

 </font><font color="#FF0000"><b>Procedure </b></font>FadeInPalette<font color="#000080">;
  </font><font color="#FF0000"><b>Begin
   For </b></font>I <font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>To </b></font><font color="#800000">63 </font><font color="#FF0000"><b>Do
    Begin
     For </b></font>II <font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>To </b></font><font color="#800000">255 </font><font color="#FF0000"><b>Do With </b></font>APalette<font color="#000080">[</font>II<font color="#000080">] </font><font color="#FF0000"><b>Do
      Begin
       If </b></font>R <font color="#000080">&lt; </font>BackUpP<font color="#000080">[</font>II<font color="#000080">].</font>R <font color="#FF0000"><b>Then </b></font>Inc<font color="#000080">(</font>R<font color="#000080">);
       </font><font color="#FF0000"><b>If </b></font>G <font color="#000080">&lt; </font>BackUpP<font color="#000080">[</font>II<font color="#000080">].</font>G <font color="#FF0000"><b>Then </b></font>Inc<font color="#000080">(</font>G<font color="#000080">);
       </font><font color="#FF0000"><b>If </b></font>B <font color="#000080">&lt; </font>BackUpP<font color="#000080">[</font>II<font color="#000080">].</font>B <font color="#FF0000"><b>Then </b></font>Inc<font color="#000080">(</font>B<font color="#000080">);
      </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
     </font>WritePalette<font color="#000080">;
    </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

 </font><font color="#FF0000"><b>Procedure </b></font>FadeOutPalette<font color="#000080">;
  </font><font color="#FF0000"><b>Begin
   For </b></font>I <font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>To </b></font><font color="#800000">63 </font><font color="#FF0000"><b>Do
    Begin
     For </b></font>II <font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>To </b></font><font color="#800000">255 </font><font color="#FF0000"><b>Do With </b></font>APalette<font color="#000080">[</font>II<font color="#000080">] </font><font color="#FF0000"><b>Do
      Begin
       If </b></font>R <font color="#000080">&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>Then </b></font>Dec<font color="#000080">(</font>R<font color="#000080">);
       </font><font color="#FF0000"><b>If </b></font>G <font color="#000080">&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>Then </b></font>Dec<font color="#000080">(</font>G<font color="#000080">);
       </font><font color="#FF0000"><b>If </b></font>B <font color="#000080">&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>Then </b></font>Dec<font color="#000080">(</font>B<font color="#000080">);
      </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
     </font>WritePalette<font color="#000080">;
    </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

 </font><font color="#FF0000"><b>Procedure </b></font>RestorePalette<font color="#000080">;
  </font><font color="#FF0000"><b>Begin
   </b></font>APalette <font color="#000080">:= </font>BackUpP<font color="#000080">;
   </font>WritePalette<font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

 </font><font color="#FF0000"><b>Procedure </b></font>BlackOutPalette<font color="#000080">; </font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>Asm
   </b></font><font color="#FF00FF">Mov DI, DS
   Mov ES, DI               </font><font color="#008000"><i>{ ES contains segment of Palette }
   </i></font><font color="#FF00FF">Mov DI, Offset APalette; </font><font color="#008000"><i>{ DI contains offset of Palette  }
   </i></font><font color="#FF00FF">Mov CX, 256*3            </font><font color="#008000"><i>{ CX = how many bytes to write   }
   </i></font><font color="#FF00FF">ShR CX, 1                </font><font color="#008000"><i>{ Divide by 2 for how many words }
   </i></font><font color="#FF00FF">Mov AX, 0                </font><font color="#008000"><i>{ Word to write to memory        }
   </i></font><font color="#FF00FF">ClD                      </font><font color="#008000"><i>{ Go downward in memory          }
   </i></font><font color="#FF00FF">Rep StoSW                </font><font color="#008000"><i>{ Write it all to memory         }
   </i></font><font color="#FF00FF">Call WritePalette;       </font><font color="#008000"><i>{ Write the Palette              }
  </i></font><font color="#FF0000"><b>End</b></font><font color="#000080">;

 </font><font color="#FF0000"><b>Procedure </b></font>LoadPalette<font color="#000080">(</font>PalName <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">);
  </font><font color="#FF0000"><b>Var
   </b></font>PalFile <font color="#000080">: </font><font color="#FF0000"><b>File</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>Begin
   </b></font>PalName <font color="#000080">:= </font>PalName <font color="#000080">+ </font><font color="#800000">'.PAL'</font><font color="#000080">;
   </font><font color="#FF0000"><b>If Not </b></font>FileExists<font color="#000080">(</font>PalName<font color="#000080">) </font><font color="#FF0000"><b>Then </b></font>Exit<font color="#000080">;
   </font>Assign<font color="#000080">(</font>PalFile<font color="#000080">, </font>PalName<font color="#000080">);
   </font>Reset<font color="#000080">(</font>PalFile<font color="#000080">, </font><font color="#800000">3</font><font color="#000080">);
   </font><font color="#FF0000"><b>For </b></font>I <font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>To </b></font><font color="#800000">255 </font><font color="#FF0000"><b>Do
    Begin
     If </b></font>EoF<font color="#000080">(</font>PalFile<font color="#000080">) </font><font color="#FF0000"><b>Then </b></font>Break<font color="#000080">;
     </font>BlockRead<font color="#000080">(</font>PalFile<font color="#000080">, </font>BackUpP<font color="#000080">[</font>I<font color="#000080">], </font><font color="#800000">1</font><font color="#000080">);
    </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
   </font>Close<font color="#000080">(</font>PalFile<font color="#000080">);
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

 </font><font color="#FF0000"><b>Procedure </b></font>SavePalette<font color="#000080">(</font>PalName <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">);
  </font><font color="#FF0000"><b>Var
   </b></font>PalFile <font color="#000080">: </font><font color="#FF0000"><b>File</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>Begin
   If </b></font>Length<font color="#000080">(</font>PalName<font color="#000080">) &gt; </font><font color="#800000">8 </font><font color="#FF0000"><b>Then </b></font>Exit<font color="#000080">;
   </font>PalName <font color="#000080">:= </font>PalName <font color="#000080">+ </font><font color="#800000">'.PAL'</font><font color="#000080">;
   </font>Assign<font color="#000080">(</font>PalFile<font color="#000080">, </font>PalName<font color="#000080">);
   </font>ReWrite<font color="#000080">(</font>PalFile<font color="#000080">, </font><font color="#800000">3</font><font color="#000080">);
   </font><font color="#FF0000"><b>For </b></font>I <font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>To </b></font><font color="#800000">255 </font><font color="#FF0000"><b>Do </b></font>BlockWrite<font color="#000080">(</font>PalFile<font color="#000080">, </font>BackUpP<font color="#000080">[</font>I<font color="#000080">], </font><font color="#800000">1</font><font color="#000080">);
   </font>Close<font color="#000080">(</font>PalFile<font color="#000080">);
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

 </font><font color="#FF0000"><b>Procedure </b></font>CyclePaletteToColor<font color="#000080">(</font>ColorNum <font color="#000080">: </font>Byte<font color="#000080">);
  </font><font color="#FF0000"><b>Begin
   For </b></font>I <font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>To </b></font><font color="#800000">63 </font><font color="#FF0000"><b>Do
    Begin
     For </b></font>II <font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>To </b></font><font color="#800000">255 </font><font color="#FF0000"><b>Do With </b></font>APalette<font color="#000080">[</font>II<font color="#000080">] </font><font color="#FF0000"><b>Do
      Begin
       If </b></font>R <font color="#000080">&lt; </font>BackUpP<font color="#000080">[</font>ColorNum<font color="#000080">].</font>R <font color="#FF0000"><b>Then </b></font>Inc<font color="#000080">(</font>R<font color="#000080">)
        </font><font color="#FF0000"><b>Else If </b></font>R <font color="#000080">&gt; </font>BackUpP<font color="#000080">[</font>ColorNum<font color="#000080">].</font>R <font color="#FF0000"><b>Then </b></font>Dec<font color="#000080">(</font>R<font color="#000080">);
       </font><font color="#FF0000"><b>If </b></font>G <font color="#000080">&lt; </font>BackUpP<font color="#000080">[</font>ColorNum<font color="#000080">].</font>G <font color="#FF0000"><b>Then </b></font>Inc<font color="#000080">(</font>G<font color="#000080">)
        </font><font color="#FF0000"><b>Else If </b></font>G <font color="#000080">&gt; </font>BackUpP<font color="#000080">[</font>ColorNum<font color="#000080">].</font>G <font color="#FF0000"><b>Then </b></font>Dec<font color="#000080">(</font>G<font color="#000080">);
       </font><font color="#FF0000"><b>If </b></font>B <font color="#000080">&lt; </font>BackUpP<font color="#000080">[</font>ColorNum<font color="#000080">].</font>B <font color="#FF0000"><b>Then </b></font>Inc<font color="#000080">(</font>B<font color="#000080">)
        </font><font color="#FF0000"><b>Else If </b></font>B <font color="#000080">&gt; </font>BackUpP<font color="#000080">[</font>ColorNum<font color="#000080">].</font>B <font color="#FF0000"><b>Then </b></font>Dec<font color="#000080">(</font>B<font color="#000080">);
      </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
     </font>WritePalette<font color="#000080">;
    </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

 </font><font color="#FF0000"><b>Procedure </b></font>ChangePaletteToColor<font color="#000080">(</font>ColorNum <font color="#000080">: </font>Byte<font color="#000080">);
  </font><font color="#FF0000"><b>Begin
   For </b></font>I <font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>To </b></font><font color="#800000">255 </font><font color="#FF0000"><b>Do With </b></font>APalette<font color="#000080">[</font>I<font color="#000080">] </font><font color="#FF0000"><b>Do
    Begin
     </b></font>R <font color="#000080">:= </font>BackUpP<font color="#000080">[</font>ColorNum<font color="#000080">].</font>R<font color="#000080">;
     </font>G <font color="#000080">:= </font>BackUpP<font color="#000080">[</font>ColorNum<font color="#000080">].</font>G<font color="#000080">;
     </font>B <font color="#000080">:= </font>BackUpP<font color="#000080">[</font>ColorNum<font color="#000080">].</font>B<font color="#000080">;
    </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
   </font>WritePalette<font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

 </font><font color="#FF0000"><b>Procedure </b></font>CopyPalette<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>NewPal <font color="#000080">: </font>RGBPalette<font color="#000080">);
  </font><font color="#FF0000"><b>Begin
   </b></font>BackUpP <font color="#000080">:= </font>NewPal<font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

 </font><font color="#FF0000"><b>Procedure </b></font>GetCopyOfPalette<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>Copy <font color="#000080">: </font>RGBPalette<font color="#000080">);
  </font><font color="#FF0000"><b>Begin
   </b></font>Copy <font color="#000080">:= </font>BackUpP<font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

 </font><font color="#FF0000"><b>Procedure </b></font>WritePart<font color="#000080">; </font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>Asm

  </b></font><font color="#008000"><i>{ Initialization Stuff }

   </i></font><font color="#FF00FF">Mov SI, Offset APalette </font><font color="#008000"><i>{ DS:SI := @APalette        }
   </i></font><font color="#FF00FF">Xor BH, BH
   Mov BL, [First]
   Mov DI, BX
   ShL BX, 1
   Add DI, BX              </font><font color="#008000"><i>{ Mult By 3 Quick           }
   </i></font><font color="#FF00FF">Add SI, DI              </font><font color="#008000"><i>{ Adjust Offset             }

   </i></font><font color="#FF00FF">Xor CH, CH
   Mov CL, [First]         </font><font color="#008000"><i>{ CX := First (Counter)     }
   </i></font><font color="#FF00FF">Xor BH, BH
   Mov BL, [Last]          </font><font color="#008000"><i>{ BX := Last Color          }
   </i></font><font color="#FF00FF">Inc BX

   Mov DX, PalRange        </font><font color="#008000"><i>{ DX := Palette Range Port  }
   </i></font><font color="#FF00FF">Mov AX, 0FFh            </font><font color="#008000"><i>{ AX := Range is All Colors }
   </i></font><font color="#FF00FF">Out DX, AX              </font><font color="#008000"><i>{ Write AX To Port DX       }

   </i></font><font color="#FF00FF">Call WaitForVRT;        </font><font color="#008000"><i>{ Wait for Verticle ReTrace }

 { Now write Palette to Ports }

  </i></font><font color="#FF00FF">@MainLoop:

   Mov DX, WritePal        </font><font color="#008000"><i>{ DX := Color To Write Port           }
   </i></font><font color="#FF00FF">Mov AL, CL              </font><font color="#008000"><i>{ AL := CL (Current Color)            }
   </i></font><font color="#FF00FF">Out DX, AL              </font><font color="#008000"><i>{ Tell It We Want to Write Color # CL }
   </i></font><font color="#FF00FF">Mov DX, PalData         </font><font color="#008000"><i>{ DX := Palette Data Port             }

   </i></font><font color="#FF00FF">Mov AL, [SI]            </font><font color="#008000"><i>{ AL := APalette[CL].R                }
   </i></font><font color="#FF00FF">Out DX, AL              </font><font color="#008000"><i>{ Write it                            }
   </i></font><font color="#FF00FF">Inc SI                  </font><font color="#008000"><i>{ Inc Offset                          }
   </i></font><font color="#FF00FF">Mov AL, [SI]            </font><font color="#008000"><i>{ AL := APalette[CL].R                }
   </i></font><font color="#FF00FF">Out DX, AL              </font><font color="#008000"><i>{ Write it                            }
   </i></font><font color="#FF00FF">Inc SI                  </font><font color="#008000"><i>{ Inc Offset                          }
   </i></font><font color="#FF00FF">Mov AL, [SI]            </font><font color="#008000"><i>{ AL := APalette[CL].G                }
   </i></font><font color="#FF00FF">Out DX, AL              </font><font color="#008000"><i>{ Write it                            }
   </i></font><font color="#FF00FF">Inc SI                  </font><font color="#008000"><i>{ Inc Offset                          }
   </i></font><font color="#FF00FF">Inc CX                  </font><font color="#008000"><i>{ Inc Counter                         }
   </i></font><font color="#FF00FF">Cmp CX, BX              </font><font color="#008000"><i>{ Are We Done?                        }
   </i></font><font color="#FF00FF">JNE @MainLoop           </font><font color="#008000"><i>{ No?  Then Loop                      }
  </i></font><font color="#FF0000"><b>End</b></font><font color="#000080">;

 </font><font color="#FF0000"><b>Procedure </b></font>CyclePart<font color="#000080">(</font>FirstC<font color="#000080">, </font>LastC <font color="#000080">: </font>Byte<font color="#000080">);
  </font><font color="#FF0000"><b>Begin
   </b></font>First <font color="#000080">:= </font>FirstC<font color="#000080">; </font>Last <font color="#000080">:= </font>LastC<font color="#000080">;
   </font><font color="#FF0000"><b>For </b></font>I <font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>To </b></font><font color="#800000">63 </font><font color="#FF0000"><b>Do
    Begin
     For </b></font>II <font color="#000080">:= </font>First <font color="#FF0000"><b>To </b></font>Last <font color="#FF0000"><b>Do With </b></font>APalette<font color="#000080">[</font>II<font color="#000080">] </font><font color="#FF0000"><b>Do
      Begin
       If </b></font>R <font color="#000080">&lt; </font>BackUpP<font color="#000080">[</font>II<font color="#000080">].</font>R <font color="#FF0000"><b>Then </b></font>Inc<font color="#000080">(</font>R<font color="#000080">)
        </font><font color="#FF0000"><b>Else If </b></font>R <font color="#000080">&gt; </font>BackUpP<font color="#000080">[</font>II<font color="#000080">].</font>R <font color="#FF0000"><b>Then </b></font>Dec<font color="#000080">(</font>R<font color="#000080">);
       </font><font color="#FF0000"><b>If </b></font>G <font color="#000080">&lt; </font>BackUpP<font color="#000080">[</font>II<font color="#000080">].</font>G <font color="#FF0000"><b>Then </b></font>Inc<font color="#000080">(</font>G<font color="#000080">)
        </font><font color="#FF0000"><b>Else If </b></font>G <font color="#000080">&gt; </font>BackUpP<font color="#000080">[</font>II<font color="#000080">].</font>G <font color="#FF0000"><b>Then </b></font>Dec<font color="#000080">(</font>G<font color="#000080">);
       </font><font color="#FF0000"><b>If </b></font>B <font color="#000080">&lt; </font>BackUpP<font color="#000080">[</font>II<font color="#000080">].</font>B <font color="#FF0000"><b>Then </b></font>Inc<font color="#000080">(</font>B<font color="#000080">)
        </font><font color="#FF0000"><b>Else If </b></font>B <font color="#000080">&gt; </font>BackUpP<font color="#000080">[</font>II<font color="#000080">].</font>B <font color="#FF0000"><b>Then </b></font>Dec<font color="#000080">(</font>B<font color="#000080">);
      </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
     </font>WritePart<font color="#000080">;
    </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

 </font><font color="#FF0000"><b>Procedure </b></font>FadeInPart<font color="#000080">(</font>FirstC<font color="#000080">, </font>LastC <font color="#000080">: </font>Byte<font color="#000080">);
  </font><font color="#FF0000"><b>Begin
   </b></font>First <font color="#000080">:= </font>FirstC<font color="#000080">; </font>Last <font color="#000080">:= </font>LastC<font color="#000080">;
   </font><font color="#FF0000"><b>For </b></font>I <font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>To </b></font><font color="#800000">63 </font><font color="#FF0000"><b>Do
    Begin
     For </b></font>II <font color="#000080">:= </font>First <font color="#FF0000"><b>To </b></font>Last <font color="#FF0000"><b>Do With </b></font>APalette<font color="#000080">[</font>II<font color="#000080">] </font><font color="#FF0000"><b>Do
      Begin
       If </b></font>R <font color="#000080">&lt; </font>BackUpP<font color="#000080">[</font>II<font color="#000080">].</font>R <font color="#FF0000"><b>Then </b></font>Inc<font color="#000080">(</font>R<font color="#000080">);
       </font><font color="#FF0000"><b>If </b></font>G <font color="#000080">&lt; </font>BackUpP<font color="#000080">[</font>II<font color="#000080">].</font>G <font color="#FF0000"><b>Then </b></font>Inc<font color="#000080">(</font>G<font color="#000080">);
       </font><font color="#FF0000"><b>If </b></font>B <font color="#000080">&lt; </font>BackUpP<font color="#000080">[</font>II<font color="#000080">].</font>B <font color="#FF0000"><b>Then </b></font>Inc<font color="#000080">(</font>B<font color="#000080">);
      </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
     </font>WritePart<font color="#000080">;
    </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

 </font><font color="#FF0000"><b>Procedure </b></font>FadeOutPart<font color="#000080">(</font>FirstC<font color="#000080">, </font>LastC <font color="#000080">: </font>Byte<font color="#000080">);
  </font><font color="#FF0000"><b>Begin
   </b></font>First <font color="#000080">:= </font>FirstC<font color="#000080">; </font>Last <font color="#000080">:= </font>LastC<font color="#000080">;
   </font><font color="#FF0000"><b>For </b></font>I <font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>To </b></font><font color="#800000">63 </font><font color="#FF0000"><b>Do
    Begin
     For </b></font>II <font color="#000080">:= </font>First <font color="#FF0000"><b>To </b></font>Last <font color="#FF0000"><b>Do With </b></font>APalette<font color="#000080">[</font>II<font color="#000080">] </font><font color="#FF0000"><b>Do
      Begin
       If </b></font>R <font color="#000080">&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>Then </b></font>Dec<font color="#000080">(</font>R<font color="#000080">);
       </font><font color="#FF0000"><b>If </b></font>G <font color="#000080">&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>Then </b></font>Dec<font color="#000080">(</font>G<font color="#000080">);
       </font><font color="#FF0000"><b>If </b></font>B <font color="#000080">&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>Then </b></font>Dec<font color="#000080">(</font>B<font color="#000080">);
      </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
     </font>WritePart<font color="#000080">;
    </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

 </font><font color="#FF0000"><b>Procedure </b></font>RestorePart<font color="#000080">(</font>FirstC<font color="#000080">, </font>LastC <font color="#000080">: </font>Byte<font color="#000080">);
  </font><font color="#FF0000"><b>Begin
   </b></font>First <font color="#000080">:= </font>FirstC<font color="#000080">; </font>Last <font color="#000080">:= </font>LastC<font color="#000080">;
   </font><font color="#FF0000"><b>For </b></font>I <font color="#000080">:= </font>First <font color="#FF0000"><b>To </b></font>Last <font color="#FF0000"><b>Do </b></font>APalette<font color="#000080">[</font>I<font color="#000080">] := </font>BackUpP<font color="#000080">[</font>I<font color="#000080">];
   </font>WritePart<font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

 </font><font color="#FF0000"><b>Procedure </b></font>BlackOutPart<font color="#000080">(</font>FirstC<font color="#000080">, </font>LastC <font color="#000080">: </font>Byte<font color="#000080">); </font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>Asm
   </b></font><font color="#FF00FF">Mov BL, [FirstC]
   Mov [First], BL
   Mov BL, [LastC]
   Mov [Last], BL

   Mov DI, DS
   Mov ES, DI               </font><font color="#008000"><i>{ ES contains segment of Palette }
   </i></font><font color="#FF00FF">Mov DI, Offset APalette; </font><font color="#008000"><i>{ DI contains offset of Palette  }
   </i></font><font color="#FF00FF">Xor BH, BH
   Mov BL, [First]
   Mov CX, BX
   ShL CX, 1
   Add BX, CX               </font><font color="#008000"><i>{ Mult By 3 Quick                }
   </i></font><font color="#FF00FF">Add DI, BX               </font><font color="#008000"><i>{ Adjust Offset Of Palette       }

   </i></font><font color="#FF00FF">Xor BH, BH
   Mov BL, [Last]
   Xor CH, CH
   Mov CL, [First]
   Sub BX, CX               </font><font color="#008000"><i>{ Get Num Of Bytes to Write in CX}
   </i></font><font color="#FF00FF">Mov CX, BX
   ShL CX, 1
   Mov AX, 0                </font><font color="#008000"><i>{ Word to write to memory        }
   </i></font><font color="#FF00FF">ClD                      </font><font color="#008000"><i>{ Go downward in memory          }
   </i></font><font color="#FF00FF">Rep StoSB                </font><font color="#008000"><i>{ Write it all to memory         }
   </i></font><font color="#FF00FF">Call WritePart;          </font><font color="#008000"><i>{ Write the Palette              }
  </i></font><font color="#FF0000"><b>End</b></font><font color="#000080">;

 </font><font color="#FF0000"><b>Procedure </b></font>CyclePartToColor<font color="#000080">(</font>FirstC<font color="#000080">, </font>LastC<font color="#000080">, </font>ColorNum <font color="#000080">: </font>Byte<font color="#000080">);
  </font><font color="#FF0000"><b>Begin
   </b></font>First <font color="#000080">:= </font>FirstC<font color="#000080">; </font>Last <font color="#000080">:= </font>LastC<font color="#000080">;
   </font><font color="#FF0000"><b>For </b></font>I <font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>To </b></font><font color="#800000">63 </font><font color="#FF0000"><b>Do
    Begin
     For </b></font>II <font color="#000080">:= </font>FirstC <font color="#FF0000"><b>To </b></font>LastC <font color="#FF0000"><b>Do With </b></font>APalette<font color="#000080">[</font>II<font color="#000080">] </font><font color="#FF0000"><b>Do
      Begin
       If </b></font>R <font color="#000080">&lt; </font>BackUpP<font color="#000080">[</font>ColorNum<font color="#000080">].</font>R <font color="#FF0000"><b>Then </b></font>Inc<font color="#000080">(</font>R<font color="#000080">)
        </font><font color="#FF0000"><b>Else If </b></font>R <font color="#000080">&gt; </font>BackUpP<font color="#000080">[</font>ColorNum<font color="#000080">].</font>R <font color="#FF0000"><b>Then </b></font>Dec<font color="#000080">(</font>R<font color="#000080">);
       </font><font color="#FF0000"><b>If </b></font>G <font color="#000080">&lt; </font>BackUpP<font color="#000080">[</font>ColorNum<font color="#000080">].</font>G <font color="#FF0000"><b>Then </b></font>Inc<font color="#000080">(</font>G<font color="#000080">)
        </font><font color="#FF0000"><b>Else If </b></font>G <font color="#000080">&gt; </font>BackUpP<font color="#000080">[</font>ColorNum<font color="#000080">].</font>G <font color="#FF0000"><b>Then </b></font>Dec<font color="#000080">(</font>G<font color="#000080">);
       </font><font color="#FF0000"><b>If </b></font>B <font color="#000080">&lt; </font>BackUpP<font color="#000080">[</font>ColorNum<font color="#000080">].</font>B <font color="#FF0000"><b>Then </b></font>Inc<font color="#000080">(</font>B<font color="#000080">)
        </font><font color="#FF0000"><b>Else If </b></font>B <font color="#000080">&gt; </font>BackUpP<font color="#000080">[</font>ColorNum<font color="#000080">].</font>B <font color="#FF0000"><b>Then </b></font>Dec<font color="#000080">(</font>B<font color="#000080">);
      </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
     </font>WritePart<font color="#000080">;
    </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

 </font><font color="#FF0000"><b>Procedure </b></font>ChangePartToColor<font color="#000080">(</font>FirstC<font color="#000080">, </font>LastC<font color="#000080">, </font>ColorNum <font color="#000080">: </font>Byte<font color="#000080">);
  </font><font color="#FF0000"><b>Begin
   </b></font>First <font color="#000080">:= </font>FirstC<font color="#000080">; </font>Last <font color="#000080">:= </font>LastC<font color="#000080">;
   </font><font color="#FF0000"><b>For </b></font>I <font color="#000080">:= </font>First <font color="#FF0000"><b>To </b></font>Last <font color="#FF0000"><b>Do With </b></font>APalette<font color="#000080">[</font>I<font color="#000080">] </font><font color="#FF0000"><b>Do
    Begin
     </b></font>R <font color="#000080">:= </font>BackUpP<font color="#000080">[</font>ColorNum<font color="#000080">].</font>R<font color="#000080">;
     </font>G <font color="#000080">:= </font>BackUpP<font color="#000080">[</font>ColorNum<font color="#000080">].</font>G<font color="#000080">;
     </font>B <font color="#000080">:= </font>BackUpP<font color="#000080">[</font>ColorNum<font color="#000080">].</font>B<font color="#000080">;
    </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
   </font>WritePart<font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

 </font><font color="#FF0000"><b>Procedure </b></font>RotatePartForward<font color="#000080">(</font>FirstC<font color="#000080">, </font>LastC <font color="#000080">: </font>Byte<font color="#000080">);
  </font><font color="#FF0000"><b>Begin
   </b></font>First <font color="#000080">:= </font>FirstC<font color="#000080">; </font>Last <font color="#000080">:= </font>LastC<font color="#000080">;
   </font>ExColor <font color="#000080">:= </font>APalette<font color="#000080">[</font>Last<font color="#000080">];
   </font><font color="#FF0000"><b>For </b></font>I <font color="#000080">:= </font>Last <font color="#FF0000"><b>DownTo </b></font>First<font color="#000080">+</font><font color="#800000">1 </font><font color="#FF0000"><b>Do </b></font>APalette<font color="#000080">[</font>I<font color="#000080">] := </font>APalette<font color="#000080">[</font>I<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">];
   </font>APalette<font color="#000080">[</font>First<font color="#000080">] := </font>ExColor<font color="#000080">;
   </font>WritePart<font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

 </font><font color="#FF0000"><b>Procedure </b></font>RotatePartBackward<font color="#000080">(</font>FirstC<font color="#000080">, </font>LastC <font color="#000080">: </font>Byte<font color="#000080">);
  </font><font color="#FF0000"><b>Begin
   </b></font>First <font color="#000080">:= </font>FirstC<font color="#000080">; </font>Last <font color="#000080">:= </font>LastC<font color="#000080">;
   </font>ExColor <font color="#000080">:= </font>APalette<font color="#000080">[</font>First<font color="#000080">];
   </font><font color="#FF0000"><b>For </b></font>I <font color="#000080">:= </font>First <font color="#FF0000"><b>To </b></font>Last<font color="#000080">-</font><font color="#800000">1 </font><font color="#FF0000"><b>Do </b></font>APalette<font color="#000080">[</font>I<font color="#000080">] := </font>APalette<font color="#000080">[</font>I<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">];
   </font>APalette<font color="#000080">[</font>Last<font color="#000080">] := </font>ExColor<font color="#000080">;
   </font>WritePart<font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>End</b></font><font color="#000080">.

</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to GRAPHICS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0180.PAS">Original</a><b>]</b></p></body>
</html>
