<html>
<head><title> "Draing Circles in Mode-X" by RICK HAINES</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to GRAPHICS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0175.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
&gt;Can someone post code for drawing a circle in Mode-X?

Here is a Circle procedure that will work in all Graphic modes (it's
even pretty fast...), as long as you have a putpixel procedure that
works.  It only works up until a radius of 50 or so, after that holes
start appearing.  I know why it happens, but I'm too lazy to fix it.

(This code is just cut and pasted from other units, so I have not
tested it.  It should work though...).
}

</i></font><font color="#FF0000"><b>Unit </b></font>Circle<font color="#000080">;

</font><font color="#FF0000"><b>Interface

 Const
</b></font><font color="#008000"><i>{ Fixed Math Const }
  </i></font>ShiftFixed <font color="#000080">= </font><font color="#800000">16</font><font color="#000080">;

</font><font color="#008000"><i>{ Mode X (320x240) PutPixel Const }
  </i></font>PlaneWidth <font color="#000080">= </font><font color="#800000">80</font><font color="#000080">;     </font><font color="#008000"><i>{ Width of each plane in bytes        }
  </i></font>ScreenSeg  <font color="#000080">= </font><font color="#800000">$A000</font><font color="#000080">;  </font><font color="#008000"><i>{ Segment of Display Memory In Mode X }
  </i></font>MapMask    <font color="#000080">= </font><font color="#800000">$02</font><font color="#000080">;    </font><font color="#008000"><i>{ Index in SC of Map Mask register    }
  </i></font>SCIndex    <font color="#000080">= </font><font color="#800000">$03C4</font><font color="#000080">;  </font><font color="#008000"><i>{ Sequence Controller Index           }

 </i></font><font color="#FF0000"><b>Var
  </b></font>SinTable<font color="#000080">,                             </font><font color="#008000"><i>{ Sin Table with 16 bits of Accuracy }
  </i></font>CosTable <font color="#000080">: </font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">360</font><font color="#000080">] </font><font color="#FF0000"><b>Of </b></font>FixedT<font color="#000080">;   </font><font color="#008000"><i>{ Cos Table with 16 bits of Accuracy }
  </i></font>Color    <font color="#000080">: </font>Byte                       <font color="#008000"><i>{ Color of Circle to be drawn        }

 </i></font><font color="#FF0000"><b>Procedure </b></font>PutPixel<font color="#000080">;                    </font><font color="#008000"><i>{ PutPixel Procedure from DDJ }
 </i></font><font color="#FF0000"><b>Procedure </b></font>Circle<font color="#000080">(</font>X<font color="#000080">, </font>Y<font color="#000080">, </font>Radius <font color="#000080">: </font>Word<font color="#000080">); </font><font color="#008000"><i>{ My Circle Procedure         }

</i></font><font color="#FF0000"><b>Implementation

 Procedure </b></font>InitSinCosTables<font color="#000080">;
  </font><font color="#FF0000"><b>Var
   </b></font>I      <font color="#000080">: </font>Word<font color="#000080">;
   </font>Radian <font color="#000080">: </font>Real<font color="#000080">;
  </font><font color="#FF0000"><b>Begin
   For </b></font>I <font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>To </b></font><font color="#800000">360 </font><font color="#FF0000"><b>Do
    Begin
     </b></font>Radian <font color="#000080">:= </font>I <font color="#000080">* </font><font color="#800000">3.1415926535 </font><font color="#000080">/ </font><font color="#800000">180</font><font color="#000080">;
     </font>SinTable<font color="#000080">[</font>I<font color="#000080">] := </font>Trunc<font color="#000080">(</font>Sin<font color="#000080">(</font>Radian<font color="#000080">) * </font><font color="#800000">65536</font><font color="#000080">);
     </font>CosTable<font color="#000080">[</font>I<font color="#000080">] := </font>Trunc<font color="#000080">(</font>Cos<font color="#000080">(</font>Radian<font color="#000080">) * </font><font color="#800000">65536</font><font color="#000080">);
    </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

 </font><font color="#FF0000"><b>Procedure </b></font>PutPixel<font color="#000080">(</font>X<font color="#000080">, </font>Y <font color="#000080">: </font>Word<font color="#000080">); </font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>Asm
   </b></font><font color="#FF00FF">Mov  AX, PlaneWidth
   Mul  [Y]                </font><font color="#008000"><i>{ offset of pixel's scan line in page         }
   </i></font><font color="#FF00FF">Mov  DI, [X]
   ShR  DI, 2              </font><font color="#008000"><i>{ X/4 = offset of pixel in scan line          }
   </i></font><font color="#FF00FF">Add  DI, AX             </font><font color="#008000"><i>{ offset of pixel in page                     }

   </i></font><font color="#FF00FF">Mov  AX, ScreenSeg
   Mov  ES, AX             </font><font color="#008000"><i>{ point ES:DI to the pixel's address          }

   </i></font><font color="#FF00FF">Mov  CL, Byte Ptr [X]
   And  CL, 011b           </font><font color="#008000"><i>{ CL = pixel's plane                          }
   </i></font><font color="#FF00FF">Mov  AX, 0100h+MapMask  </font><font color="#008000"><i>{ AL = index in SC of Map Mask reg            }
   </i></font><font color="#FF00FF">ShL  AH, CL             </font><font color="#008000"><i>{ set only the bit for the pixel's plane to 1 }
   </i></font><font color="#FF00FF">Mov  DX, SCIndex        </font><font color="#008000"><i>{ set the Map Mask to enable only the         }
   </i></font><font color="#FF00FF">Out  DX, AX             </font><font color="#008000"><i>{ pixel's plane                               }

   </i></font><font color="#FF00FF">Mov  AL, [Color]
   Mov  ES:[DI], AL        </font><font color="#008000"><i>{ draw the pixel in the desired color         }
  </i></font><font color="#FF0000"><b>End</b></font><font color="#000080">;

 </font><font color="#FF0000"><b>Procedure </b></font>Circle<font color="#000080">(</font>X<font color="#000080">, </font>Y<font color="#000080">, </font>Radius <font color="#000080">: </font>Word<font color="#000080">);
  </font><font color="#FF0000"><b>Var
   </b></font>XC<font color="#000080">, </font>YC <font color="#000080">: </font>Word<font color="#000080">;
  </font><font color="#FF0000"><b>Begin
   For </b></font>I <font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>To </b></font><font color="#800000">360 </font><font color="#FF0000"><b>Do
    Begin
     </b></font>XC <font color="#000080">:= </font>X <font color="#000080">+ (</font>Radius <font color="#000080">* </font>CosTable<font color="#000080">[</font>I<font color="#000080">] </font><font color="#FF0000"><b>ShR </b></font>ShiftFixed<font color="#000080">);
     </font>YC <font color="#000080">:= </font>Y <font color="#000080">+ (</font>Radius <font color="#000080">* </font>SinTable<font color="#000080">[</font>I<font color="#000080">] </font><font color="#FF0000"><b>ShR </b></font>ShiftFixed<font color="#000080">);
     </font>PutPixel<font color="#000080">(</font>XC<font color="#000080">, </font>YC<font color="#000080">);
    </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Begin
 </b></font>InitSinCosTables<font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">.

</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to GRAPHICS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0175.PAS">Original</a><b>]</b></p></body>
</html>
