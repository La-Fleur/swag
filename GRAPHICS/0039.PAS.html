<html>
<head><title> "Another QUICK PutImage" by SEAN PALMER</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to GRAPHICS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0039.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>(*
SEAN PALMER

&gt; there is simple method of masking color 0 so it won't be displayed.
&gt; An assembly language routine based around this:

Procedure PutImg(x, y : Integer; Var Img);
Type
  AList = Array[1..$FFFF] of Byte; {1-based Arrays are slower than 0-based}
Var
  APtr    : ^AList; {I found a very fast way to do this: With}
  j, i,
  Width,
  Height,
  Counter : Word;
begin
  Aptr    := @Img;
  Width   := (Aptr^[2] SHL 8) + Aptr^[1] + 1; {these +1's that 1-based Arrays }
  Height  := (Aptr^[4] SHL 8) + Aptr^[3] + 1; { require make For slower code}
  Counter := 5;
  For j := y to (y + height - 1) do
  begin  {try pre-calculating the offset instead}
    For i := x to (x + width - 1) do
    begin
      Case Aptr^[Counter] of {CASE is probably not the way to do this}
        0:; { do nothing }
      else _mcgaScreen[j, i] := Aptr^[Counter]; { plot it }
      end;
      Inc(Counter);
    end;
  end;
end;

ok, here's my try:
*)

</i></font><font color="#FF0000"><b>Type
  </b></font>pWord <font color="#000080">= ^</font>Word<font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>putImg<font color="#000080">(</font>x<font color="#000080">, </font>y <font color="#000080">: </font>Integer<font color="#000080">; </font><font color="#FF0000"><b>Var </b></font>image<font color="#000080">);
</font><font color="#FF0000"><b>Var
  </b></font>anImg <font color="#000080">: </font><font color="#FF0000"><b>Record
    </b></font>img <font color="#000080">: </font><font color="#FF0000"><b>Array </b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">$FFF7</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Byte<font color="#000080">;
  </font><font color="#FF0000"><b>end Absolute </b></font>image<font color="#000080">;

  </font>aScrn <font color="#000080">: </font><font color="#FF0000"><b>Record
    </b></font>scrn <font color="#000080">: </font><font color="#FF0000"><b>Array </b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">$FFF7</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Byte<font color="#000080">;
  </font><font color="#FF0000"><b>end Absolute </b></font><font color="#800000">$A000 </font><font color="#000080">: </font><font color="#800000">0000</font><font color="#000080">;

  </font>width<font color="#000080">,
  </font>height<font color="#000080">,
  </font>counter<font color="#000080">,
  </font>offs<font color="#000080">, </font>src <font color="#000080">: </font>Word<font color="#000080">;

</font><font color="#FF0000"><b>begin
  </b></font>width  <font color="#000080">:= </font>pWord<font color="#000080">(@</font>anImg<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">])^;
  </font>height <font color="#000080">:= </font>pWord<font color="#000080">(@</font>anImg<font color="#000080">[</font><font color="#800000">2</font><font color="#000080">])^;
  </font>offs   <font color="#000080">:= </font>y <font color="#000080">* </font><font color="#800000">320 </font><font color="#000080">+ </font>x<font color="#000080">;
  </font>src    <font color="#000080">:= </font><font color="#800000">4</font><font color="#000080">;   </font><font color="#008000"><i>{skip width, height}
  </i></font><font color="#FF0000"><b>With </b></font>aScrn<font color="#000080">, </font>anImg <font color="#FF0000"><b>do
  Repeat
    </b></font>counter <font color="#000080">:= </font>width<font color="#000080">;
    </font><font color="#FF0000"><b>Repeat
      if </b></font>img<font color="#000080">[</font>src<font color="#000080">] &lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then
        </b></font>scrn<font color="#000080">[</font>offs<font color="#000080">] := </font>img<font color="#000080">[</font>src<font color="#000080">];
      </font>inc<font color="#000080">(</font>src<font color="#000080">);
      </font>inc<font color="#000080">(</font>offs<font color="#000080">);
      </font>dec<font color="#000080">(</font>counter<font color="#000080">);
    </font><font color="#FF0000"><b>Until </b></font>counter <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">;
    </font>inc<font color="#000080">(</font>offs<font color="#000080">, </font><font color="#800000">320 </font><font color="#000080">- </font>width<font color="#000080">);
    </font>dec<font color="#000080">(</font>height<font color="#000080">);
  </font><font color="#FF0000"><b>Until </b></font>height <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{
Those Arrays-pretending-to-be-Records above so they'll work With the With
statement should end up making BP keep the address in Registers, making it
faster. In any Case it won't be slower than yours. I'd appreciate you
timing them and letting me know the results. Actually, let me know if it
even compiles and works... 8)

But Really, man, if you're writing Graphics routines you Really have to
go For assembly. Pascal don't cut it. (c doesn't either...)
}
</i></font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to GRAPHICS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0039.PAS">Original</a><b>]</b></p></body>
</html>
