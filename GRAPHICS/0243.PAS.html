<html>
<head><title> "Magnify glass moving over ANY background" by JACO VAN NIEKERK</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to GRAPHICS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0243.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{Magnify glass moving over ANY background, needs 386 machine}
{Jaco van Niekerk, jvn@rkw.rau.ac.za}
{Mail me if you have any questions/ideas/comments about this code}
</i></font><font color="#FF0000"><b>program </b></font>magnify_glass<font color="#000080">;
</font><font color="#FF0000"><b>uses </b></font>crt<font color="#000080">;

</font><font color="#FF0000"><b>const </b></font>r <font color="#000080">: </font>byte <font color="#000080">= </font><font color="#800000">40</font><font color="#000080">;                  </font><font color="#008000"><i>{radius of sphere}
      </i></font>h <font color="#000080">: </font>integer <font color="#000080">= </font><font color="#800000">20</font><font color="#000080">;               </font><font color="#008000"><i>{distace from plane to focus point}
      </i></font>d <font color="#000080">: </font>byte <font color="#000080">= </font><font color="#800000">80</font><font color="#000080">;                  </font><font color="#008000"><i>{diameter of magnify glass}

</i></font><font color="#FF0000"><b>var </b></font>offs <font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">22500</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>integer<font color="#000080">; </font><font color="#008000"><i>{150x150}
    </i></font>b<font color="#000080">, </font>v <font color="#000080">: </font>pointer<font color="#000080">;

</font><font color="#008000"><i>{This is the easiest mouse routines available!}
</i></font><font color="#FF0000"><b>function </b></font>initmouse<font color="#000080">: </font>word<font color="#000080">;</font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#008000"><i>{Initialize mouse driver}
</i></font><font color="#FF0000"><b>asm </b></font><font color="#FF00FF">mov ax, 0h; int 33h; </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>showmousecursor<font color="#000080">;</font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#008000"><i>{Instruct BIOS to show mouse cursor}
</i></font><font color="#FF0000"><b>asm </b></font><font color="#FF00FF">mov ax, 01h; int 33h; </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>hidemousecursor<font color="#000080">;</font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#008000"><i>{Instruct BIOS to hide mouse cursor}
</i></font><font color="#FF0000"><b>asm </b></font><font color="#FF00FF">mov ax, 02h; int 33h; </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>getmousepos <font color="#000080">(</font><font color="#FF0000"><b>var </b></font>x<font color="#000080">, </font>y<font color="#000080">, </font>button<font color="#000080">: </font>word<font color="#000080">);
</font><font color="#008000"><i>{Return the current location of the mouse}
</i></font><font color="#FF0000"><b>var </b></font>x1<font color="#000080">, </font>y1<font color="#000080">, </font>b <font color="#000080">: </font>word<font color="#000080">;
</font><font color="#FF0000"><b>begin
     Asm </b></font><font color="#FF00FF">mov ax, 03h; int 33h; mov [b], bx; mov [x1], cx; mov [y1], dx; </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
     </font>x<font color="#000080">:=</font>x1<font color="#000080">; </font>y<font color="#000080">:=</font>y1<font color="#000080">; </font>button <font color="#000080">:= </font>b<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>setmousewindow <font color="#000080">(</font>X1<font color="#000080">, </font>Y1<font color="#000080">, </font>X2<font color="#000080">, </font>Y2<font color="#000080">: </font>Word<font color="#000080">);</font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#008000"><i>{Set the mouse window}
</i></font><font color="#FF0000"><b>asm </b></font><font color="#FF00FF">mov ax, 07h; mov cx,[x1]; mov dx,[x2]; int 33h; inc ax;
    mov cx,[y1]; mov dx,[y2]; int 33h; </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>copyw<font color="#000080">(</font>source <font color="#000080">: </font>pointer<font color="#000080">; </font>dest <font color="#000080">: </font>pointer<font color="#000080">; </font>cnt <font color="#000080">: </font>word<font color="#000080">);</font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>asm </b></font><font color="#008000"><i>{copy [cnt] words from [source] to [dest]}
   </i></font><font color="#FF00FF">les di, [dest]    </font><font color="#008000"><i>{[dest] moves into [es:di]}
   </i></font><font color="#FF00FF">push ds           </font><font color="#008000"><i>{ds must be preserved}
   </i></font><font color="#FF00FF">lds si, [source]  </font><font color="#008000"><i>{[source] moves into [ds:di]}
   </i></font><font color="#FF00FF">mov cx, [cnt]     </font><font color="#008000"><i>{cx &lt;- [cnt] : number of words to move}
   </i></font><font color="#FF00FF">cld               </font><font color="#008000"><i>{clear the direction flag, si will increment}
   </i></font><font color="#FF00FF">rep movsw         </font><font color="#008000"><i>{copies cx words from source to destination}
   </i></font><font color="#FF00FF">pop ds            </font><font color="#008000"><i>{restore ds to it's original state}
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>cls<font color="#000080">(</font>dest <font color="#000080">: </font>pointer<font color="#000080">);</font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>asm
   </b></font><font color="#FF00FF">les di, [dest]
   mov cx, 16000
   xor ax, ax
   db $66; rep stosw
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>calc_mask<font color="#000080">; </font><font color="#008000"><i>{a bit of maths!}
{this calculates the pixel mask, to optimize the speed}
</i></font><font color="#FF0000"><b>var </b></font>x<font color="#000080">, </font>y<font color="#000080">, </font>z <font color="#000080">: </font>integer<font color="#000080">;
    </font>ux<font color="#000080">, </font>uy <font color="#000080">: </font>integer<font color="#000080">;
    </font>sx<font color="#000080">, </font>sy <font color="#000080">: </font>integer<font color="#000080">;
</font><font color="#FF0000"><b>begin
     for </b></font>y<font color="#000080">:=</font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font>d <font color="#FF0000"><b>do
         for </b></font>x<font color="#000080">:=</font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font>d <font color="#FF0000"><b>do
         begin
              </b></font>ux<font color="#000080">:=</font>x <font color="#000080">- </font>d <font color="#FF0000"><b>div </b></font><font color="#800000">2</font><font color="#000080">;
              </font>uy<font color="#000080">:=</font>y <font color="#000080">- </font>d <font color="#FF0000"><b>div </b></font><font color="#800000">2</font><font color="#000080">;
              </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>ux<font color="#000080">*</font>ux<font color="#000080">+</font>uy<font color="#000080">*</font>uy <font color="#000080">&lt; </font>r<font color="#000080">*</font>r<font color="#000080">) </font><font color="#FF0000"><b>then </b></font><font color="#008000"><i>{point is defined on sphere}
              </i></font><font color="#FF0000"><b>begin
                   </b></font>z<font color="#000080">:=</font>round<font color="#000080">(</font>sqrt<font color="#000080">(</font>r<font color="#000080">*</font>r<font color="#000080">-</font>ux<font color="#000080">*</font>ux<font color="#000080">-</font>uy<font color="#000080">*</font>uy<font color="#000080">));
                   </font>sx<font color="#000080">:=</font>round<font color="#000080">((</font>h<font color="#000080">-</font>z<font color="#000080">)*(</font>ux<font color="#000080">/</font>z<font color="#000080">)); </font><font color="#008000"><i>{took me 2 hours to work, these}
                   </i></font>sy<font color="#000080">:=</font>round<font color="#000080">((</font>h<font color="#000080">-</font>z<font color="#000080">)*(</font>uy<font color="#000080">/</font>z<font color="#000080">)); </font><font color="#008000"><i>{two formulas out!!!}
                   {point on &quot;s phere&quot;}
                   </i></font>offs<font color="#000080">[</font>x<font color="#000080">+</font>y<font color="#000080">*</font>d<font color="#000080">]:=</font>sy<font color="#000080">*</font><font color="#800000">320</font><font color="#000080">+</font>sx<font color="#000080">;
              </font><font color="#FF0000"><b>end else </b></font>offs<font color="#000080">[</font>x<font color="#000080">+</font>y<font color="#000080">*</font>d<font color="#000080">]:=</font><font color="#800000">0</font><font color="#000080">;
         </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>construct<font color="#000080">(</font>xp<font color="#000080">, </font>yp <font color="#000080">: </font>word<font color="#000080">);
</font><font color="#008000"><i>{if you want to optimize the code, do it in this procedure, since it}
{does all the main thingies, please send me a copy then too ;)  }
</i></font><font color="#FF0000"><b>var </b></font>seg1<font color="#000080">, </font>ofs1<font color="#000080">, </font>seg2<font color="#000080">, </font>ofs2 <font color="#000080">: </font>word<font color="#000080">;
    </font>x<font color="#000080">, </font>y <font color="#000080">: </font>word<font color="#000080">;
    </font>vp<font color="#000080">, </font>hp <font color="#000080">: </font>word<font color="#000080">;
    </font>ux<font color="#000080">, </font>uy <font color="#000080">: </font>integer<font color="#000080">;
</font><font color="#FF0000"><b>begin
     </b></font>seg1<font color="#000080">:=</font>seg<font color="#000080">(</font>b<font color="#000080">^); </font>ofs1<font color="#000080">:=</font>ofs<font color="#000080">(</font>b<font color="#000080">^);
     </font>seg2<font color="#000080">:=</font>seg<font color="#000080">(</font>v<font color="#000080">^); </font>ofs2<font color="#000080">:=</font>ofs<font color="#000080">(</font>v<font color="#000080">^);
     </font>copyw<font color="#000080">(</font>b<font color="#000080">,</font>v<font color="#000080">,</font><font color="#800000">32000</font><font color="#000080">);
     </font><font color="#FF0000"><b>for </b></font>y<font color="#000080">:=</font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font>d <font color="#FF0000"><b>do
         for </b></font>x<font color="#000080">:=</font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font>d <font color="#FF0000"><b>do
         begin
              </b></font>ux<font color="#000080">:=</font>x <font color="#000080">- </font>d <font color="#FF0000"><b>div </b></font><font color="#800000">2</font><font color="#000080">;
              </font>uy<font color="#000080">:=</font>y <font color="#000080">- </font>d <font color="#FF0000"><b>div </b></font><font color="#800000">2</font><font color="#000080">;
              </font>vp<font color="#000080">:=</font>y<font color="#000080">+</font>yp<font color="#000080">+</font>offs<font color="#000080">[</font>y<font color="#000080">*</font>d<font color="#000080">+</font>x<font color="#000080">] </font><font color="#FF0000"><b>div </b></font><font color="#800000">320</font><font color="#000080">;
              </font>hp<font color="#000080">:=</font>x<font color="#000080">+</font>xp<font color="#000080">+</font>offs<font color="#000080">[</font>y<font color="#000080">*</font>d<font color="#000080">+</font>x<font color="#000080">] </font><font color="#FF0000"><b>mod </b></font><font color="#800000">320</font><font color="#000080">;
              </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>vp<font color="#000080">&lt;</font><font color="#800000">200</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>vp<font color="#000080">&gt;</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>xp<font color="#000080">&lt;</font><font color="#800000">320</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>xp<font color="#000080">&gt;</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>and
                 </b></font><font color="#000080">(</font>sqr<font color="#000080">(</font>r<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">)&gt; </font>ux<font color="#000080">*</font>ux<font color="#000080">+</font>uy<font color="#000080">*</font>uy<font color="#000080">) </font><font color="#FF0000"><b>then
              begin
                 </b></font>mem<font color="#000080">[</font>seg2<font color="#000080">:</font>ofs2<font color="#000080">+(</font>y<font color="#000080">+</font>yp<font color="#000080">)*</font><font color="#800000">320</font><font color="#000080">+</font>x<font color="#000080">+</font>xp<font color="#000080">]:=
                    </font>mem<font color="#000080">[</font>seg1<font color="#000080">:(</font>ofs1<font color="#000080">+</font>vp<font color="#000080">*</font><font color="#800000">320</font><font color="#000080">+</font>hp<font color="#000080">)];
              </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
         </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
     </font>copyw<font color="#000080">(</font>v<font color="#000080">,</font>ptr<font color="#000080">(</font><font color="#800000">$a000</font><font color="#000080">,</font><font color="#800000">000</font><font color="#000080">),</font><font color="#800000">32000</font><font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>background<font color="#000080">;
</font><font color="#008000"><i>{replace this with any background, of your choice, even a dynamic }
{background, like a fire or plasma, just remember to copy it to b^}
</i></font><font color="#FF0000"><b>var </b></font>i<font color="#000080">, </font>j <font color="#000080">: </font>integer<font color="#000080">;
</font><font color="#FF0000"><b>begin
     </b></font>directvideo<font color="#000080">:=</font>false<font color="#000080">;
     </font>writeln<font color="#000080">; </font>writeln<font color="#000080">; </font>writeln<font color="#000080">; </font>writeln<font color="#000080">;
     </font>textcolor<font color="#000080">(</font><font color="#800000">15</font><font color="#000080">);
     </font>writeln<font color="#000080">(</font><font color="#800000">'  This is a test. Please feel free'</font><font color="#000080">);
     </font>writeln<font color="#000080">(</font><font color="#800000">'  to do anything you wish with this'</font><font color="#000080">);
     </font>writeln<font color="#000080">(</font><font color="#800000">'  code, but please do give credit'</font><font color="#000080">);
     </font>writeln<font color="#000080">(</font><font color="#800000">'  where credit is due.'</font><font color="#000080">);
     </font>writeln<font color="#000080">;
     </font>writeln<font color="#000080">(</font><font color="#800000">'  Real programmers, do!'</font><font color="#000080">);
     </font>writeln<font color="#000080">;
     </font>writeln<font color="#000080">(</font><font color="#800000">'  J v Niekerk (jvn@rkw.rau.ac.za)'</font><font color="#000080">);
     </font>writeln<font color="#000080">;
     </font>writeln<font color="#000080">(</font><font color="#800000">' O, yes, if nothing is happening,'</font><font color="#000080">);
     </font>writeln<font color="#000080">(</font><font color="#800000">' now try moving your mouse around!!'</font><font color="#000080">);
     </font>directvideo<font color="#000080">:=</font>true<font color="#000080">;

     </font><font color="#FF0000"><b>for </b></font>i<font color="#000080">:=</font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font><font color="#800000">319 </font><font color="#FF0000"><b>do
         for </b></font>j<font color="#000080">:=</font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font><font color="#800000">199 </font><font color="#FF0000"><b>do
             if </b></font>mem<font color="#000080">[</font><font color="#800000">$a000</font><font color="#000080">:</font><font color="#800000">320</font><font color="#000080">*</font>j<font color="#000080">+</font>i<font color="#000080">]=</font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>mem<font color="#000080">[</font><font color="#800000">$a000</font><font color="#000080">:</font><font color="#800000">320</font><font color="#000080">*</font>j<font color="#000080">+</font>i<font color="#000080">]:=((</font>i<font color="#000080">+</font>j<font color="#000080">) </font><font color="#FF0000"><b>mod </b></font><font color="#800000">10</font><font color="#000080">)+</font><font color="#800000">20</font><font color="#000080">;

     </font>copyw<font color="#000080">(</font>ptr<font color="#000080">(</font><font color="#800000">$a000</font><font color="#000080">,</font><font color="#800000">000</font><font color="#000080">),</font>b<font color="#000080">,</font><font color="#800000">32000</font><font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>var </b></font>deg <font color="#000080">: </font>real<font color="#000080">;
    </font>x<font color="#000080">, </font>y<font color="#000080">, </font>but <font color="#000080">: </font>word<font color="#000080">;

</font><font color="#FF0000"><b>begin
     </b></font>clrscr<font color="#000080">;
     </font>getmem<font color="#000080">(</font>v<font color="#000080">,</font><font color="#800000">64000</font><font color="#000080">); </font>getmem<font color="#000080">(</font>b<font color="#000080">,</font><font color="#800000">64000</font><font color="#000080">);

     </font><font color="#FF0000"><b>asm
        </b></font><font color="#FF00FF">mov ax, 13h
        int 10h
     </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

     </font>background<font color="#000080">;
     </font>calc_mask<font color="#000080">;
     </font>initmouse<font color="#000080">;
     </font>setmousewindow<font color="#000080">(</font><font color="#800000">5</font><font color="#000080">,</font><font color="#800000">5</font><font color="#000080">,</font><font color="#800000">315</font><font color="#000080">-</font>d<font color="#000080">, </font><font color="#800000">200</font><font color="#000080">-</font>d<font color="#000080">);

     </font><font color="#FF0000"><b>repeat
           </b></font>getmousepos<font color="#000080">(</font>x<font color="#000080">, </font>y<font color="#000080">, </font>but<font color="#000080">);
           </font>construct<font color="#000080">(</font>x<font color="#000080">,</font>y<font color="#000080">);
     </font><font color="#FF0000"><b>until </b></font>but<font color="#000080">=</font><font color="#800000">1</font><font color="#000080">;

     </font>freemem<font color="#000080">(</font>v<font color="#000080">, </font><font color="#800000">64000</font><font color="#000080">);
     </font>freemem<font color="#000080">(</font>b<font color="#000080">, </font><font color="#800000">64000</font><font color="#000080">);
     </font><font color="#FF0000"><b>asm
        </b></font><font color="#FF00FF">mov ax, 03h
        int 10h
     </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">.

</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to GRAPHICS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0243.PAS">Original</a><b>]</b></p></body>
</html>
