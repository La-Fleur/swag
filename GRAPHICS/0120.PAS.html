<html>
<head><title> "plasma" by JONAS MALMSTEN</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to GRAPHICS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0120.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
Yesterday I saw Bas' plasma routine. Real nice! But... a little slow I thought
so I improved it. Another thing, Bas, the bouble buffer didn't work on my
et4000, the bplptr never changed in your mode.

Well, enjoy this new routine!
}

</i></font><font color="#FF0000"><b>program </b></font>plasma<font color="#000080">;

</font><font color="#008000"><i>{ bigscreenplasma, by Bas van Gaalen &amp; Sven van Heel, Holland, PD   }
{ Improved by GEM, Sweden (convertion to asm --&gt; many times faster) }

</i></font><font color="#FF0000"><b>uses
  </b></font>crt<font color="#000080">;

</font><font color="#FF0000"><b>const
  </b></font>vidseg<font color="#000080">:</font>word<font color="#000080">=</font><font color="#800000">$a000</font><font color="#000080">;

</font><font color="#FF0000"><b>var
  </b></font>stab1<font color="#000080">,</font>stab2<font color="#000080">:</font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">255</font><font color="#000080">+</font><font color="#800000">80</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">;
  </font>x<font color="#000080">:</font>word<font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>setpal<font color="#000080">(</font>c<font color="#000080">,</font>r<font color="#000080">,</font>g<font color="#000080">,</font>b<font color="#000080">:</font>byte<font color="#000080">); </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>asm
   </b></font><font color="#FF00FF">mov dx,3c8h
   mov al,[c]
   out dx,al
   inc dx
   mov al,[r]
   out dx,al
   mov al,[g]
   out dx,al
   mov al,[b]
   out dx,al
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>begin
  asm
     </b></font><font color="#FF00FF">mov ax,0013h
     int 10h
     mov dx,03c4h
     mov ax,0604h
     out dx,ax
     mov dx,03d4h
     mov ax,4609h
     out dx,ax
     mov ax,0014h
     out dx,ax
     mov ax,0e317h
     out dx,ax
     mov es,vidseg
     xor di,di
     xor ax,ax
     mov cx,16000
     rep stosw
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>for </b></font>x<font color="#000080">:=</font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font><font color="#800000">63 </font><font color="#FF0000"><b>do begin
    </b></font>setpal<font color="#000080">(</font>x<font color="#000080">,</font>x <font color="#FF0000"><b>div </b></font><font color="#800000">4</font><font color="#000080">,</font>x <font color="#FF0000"><b>div </b></font><font color="#800000">2</font><font color="#000080">,</font>x<font color="#000080">);
    </font>setpal<font color="#000080">(</font><font color="#800000">127</font><font color="#000080">-</font>x<font color="#000080">,</font>x <font color="#FF0000"><b>div </b></font><font color="#800000">4</font><font color="#000080">,</font>x <font color="#FF0000"><b>div </b></font><font color="#800000">2</font><font color="#000080">,</font>x<font color="#000080">);
    </font>setpal<font color="#000080">(</font><font color="#800000">127</font><font color="#000080">+</font>x<font color="#000080">,</font><font color="#800000">20</font><font color="#000080">+</font>x <font color="#FF0000"><b>div </b></font><font color="#800000">4</font><font color="#000080">,</font>x <font color="#FF0000"><b>div </b></font><font color="#800000">2</font><font color="#000080">,</font>x<font color="#000080">);
    </font>setpal<font color="#000080">(</font><font color="#800000">254</font><font color="#000080">-</font>x<font color="#000080">,</font><font color="#800000">20</font><font color="#000080">+</font>x <font color="#FF0000"><b>div </b></font><font color="#800000">4</font><font color="#000080">,</font>x <font color="#FF0000"><b>div </b></font><font color="#800000">2</font><font color="#000080">,</font>x<font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>for </b></font>x<font color="#000080">:=</font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font><font color="#800000">255</font><font color="#000080">+</font><font color="#800000">80 </font><font color="#FF0000"><b>do begin
    </b></font>stab1<font color="#000080">[</font>x<font color="#000080">]:=</font>round<font color="#000080">(</font>sin<font color="#000080">(</font><font color="#800000">2</font><font color="#000080">*</font>pi<font color="#000080">*</font>x<font color="#000080">/</font><font color="#800000">255</font><font color="#000080">)*</font><font color="#800000">128</font><font color="#000080">)+</font><font color="#800000">128</font><font color="#000080">;
    </font>stab2<font color="#000080">[</font>x<font color="#000080">]:=</font>round<font color="#000080">(</font>cos<font color="#000080">(</font><font color="#800000">2</font><font color="#000080">*</font>pi<font color="#000080">*</font>x<font color="#000080">/</font><font color="#800000">255</font><font color="#000080">)*</font><font color="#800000">128</font><font color="#000080">)+</font><font color="#800000">128</font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>asm
     </b></font><font color="#FF00FF">mov cl,50
     mov ch,90
     mov es,vidseg
     push bp
   @main:

</font><font color="#008000"><i>{     mov dx,3c8h    (* For checking rastertime *)
     xor al,al
     out dx,al
     inc dx
     out dx,al
     out dx,al
     out dx,al}

     </i></font><font color="#FF00FF">mov dx,3dah
   @vert1:
     in al,dx
     test al,8
     jz @vert1
   @vert2:
     in al,dx
     test al,8
     jnz @vert2

     mov dx,3dah    </font><font color="#008000"><i>(* This is kinda rediculous! *)
   </i></font><font color="#FF00FF">@vert1b:         </font><font color="#008000"><i>(* I have to insert another vbl to slow it down.... *)
     </i></font><font color="#FF00FF">in al,dx
     test al,8
     jz @vert1b
   @vert2b:
     in al,dx
     test al,8
     jnz @vert2b

</font><font color="#008000"><i>{     mov dx,3c8h    (* For checking rastertime *)
     xor al,al
     out dx,al
     mov al,30
     inc dx
     out dx,al
     out dx,al
     out dx,al}

     </i></font><font color="#FF00FF">inc cl
     inc ch
     xor di,di
     mov bp,di
   @loooooop:
     mov si,offset stab1
     mov bx,bp
     add bl,cl
     mov dl,[si+bx]
     xor dh,dh
     mov bl,ch
     mov al,[si+bx]
     add si,dx
     mov bx,bp
     add bl,al
     mov bl,[bx+offset stab2]
     mov bh,bl
     mov dx,40
   @again:
     lodsw
     add ax,bx
     stosw
     dec dx
     jnz @again
     cmp si,offset stab1[256]
     jb @1
     sub si,256
   @1:
     inc bp
     cmp bp,58
     jne @loooooop
     in al,60h
     cmp al,1
     jne @main
     pop bp
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>textmode<font color="#000080">(</font>lastmode<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">.

</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to GRAPHICS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0120.PAS">Original</a><b>]</b></p></body>
</html>
