<html>
<head><title> "Get close RGB color palette" by SCOTT TUNSTALL</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to GRAPHICS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0275.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
============================================================

PROGRAM : CLOSECOL.PAS

AUTHOR  : SCOTT TUNSTALL B.Sc

PURPOSE : Get the colour which has specified RGB values from
          the VGA palette.
          If no colour with specified values exists, return
          the nearest colour.


NOTES   :

I seem to recall AGES ago that someone wanted a routine
that would find the colour CLOSEST to a specified RGB
value.

This might help, although I've not tested it extensively.
Tests seem to show it works OK tho'.


Oh yeah. It needs KOJAKVGA (preferably V3) to work as is,
but it won't be too difficult for smart cookies to work out
whats going on, if they want to convert the code to their
units.




DISCLAIMER:

The standard stuff follows:

Unless you're a proud CGA/EGA card user ;), this unit
shouldn't break your PC. 

However, the rule is: use this code AT YOUR OWN RISK.

If you use this code in any programs, please mention my name
in the credits. An ad for KOJAKVGA 3.3 would be nice too ;)

Have fun folks!
------------------------------------------------------------
}


</i></font><font color="#FF0000"><b>program </b></font>CloseCol<font color="#000080">;

</font><font color="#FF0000"><b>uses </b></font>kojakvga<font color="#000080">, </font>crt<font color="#000080">;





</font><font color="#008000"><i>{
As the function name implies, this gets the palette entry which
contains RGB values closest to those specified.
(C) 1997 Crap explanations ;)


Expects: R,G,B component values to look for;
         Red component must be in range 0-63
         Same applies for Green and Blue.

         Values above 63 are reset to (Value MOD 64) !
         This is due to the limitations of the VGA DAC I'm afraid.


Returns: index (0-255) of closest or matching colour.
}


</i></font><font color="#FF0000"><b>function </b></font>GetClosestVGAColour<font color="#000080">(</font>SearchRed<font color="#000080">,</font>SearchGreen<font color="#000080">,</font>SearchBlue<font color="#000080">:</font>byte<font color="#000080">) : </font>byte<font color="#000080">;
</font><font color="#FF0000"><b>var </b></font>bestindex<font color="#000080">, </font>currRed<font color="#000080">, </font>currGreen<font color="#000080">, </font>currBlue<font color="#000080">, </font>colourcount<font color="#000080">: </font>byte<font color="#000080">;
    </font>distred<font color="#000080">, </font>distgreen<font color="#000080">, </font>distblue<font color="#000080">,
    </font>bestdistred<font color="#000080">, </font>bestdistgreen<font color="#000080">, </font>bestdistblue<font color="#000080">: </font>integer<font color="#000080">;
    </font>RGBTotal<font color="#000080">, </font>BestRGBTotal<font color="#000080">: </font>word<font color="#000080">;

</font><font color="#FF0000"><b>begin
     </b></font>bestindex<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
     </font>distred<font color="#000080">:=</font><font color="#800000">255</font><font color="#000080">;              </font><font color="#008000"><i>{ Distance of red from SearchRed value }
     </i></font>distgreen<font color="#000080">:=</font><font color="#800000">255</font><font color="#000080">;
     </font>distblue<font color="#000080">:=</font><font color="#800000">255</font><font color="#000080">;

     </font>bestdistred<font color="#000080">:=</font><font color="#800000">255</font><font color="#000080">;
     </font>bestdistgreen<font color="#000080">:=</font><font color="#800000">255</font><font color="#000080">;
     </font>bestdistblue<font color="#000080">:=</font><font color="#800000">255</font><font color="#000080">;
     </font>BestRGBTotal<font color="#000080">:=</font><font color="#800000">255</font><font color="#000080">+</font><font color="#800000">255</font><font color="#000080">+</font><font color="#800000">255</font><font color="#000080">; </font><font color="#008000"><i>{ R,G,B summed }


     { Iterate (love that word!) through all palette entries }

     </i></font><font color="#FF0000"><b>for </b></font>colourcount<font color="#000080">:=</font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font><font color="#800000">255 </font><font color="#FF0000"><b>do
         begin
         </b></font><font color="#008000"><i>{ Read colour from VGA adaptor directly. }

         </i></font>GetRGB<font color="#000080">(</font>colourcount<font color="#000080">,</font>currRed<font color="#000080">,</font>currGreen<font color="#000080">,</font>currBlue<font color="#000080">);


         </font><font color="#008000"><i>{ Compute Red/Green and Blue distances }

         </i></font>distred<font color="#000080">:=</font>abs<font color="#000080">(</font>CurrRed<font color="#000080">-</font>SearchRed<font color="#000080">);
         </font>distgreen<font color="#000080">:=</font>abs<font color="#000080">(</font>CurrGreen<font color="#000080">-</font>SearchGreen<font color="#000080">);
         </font>distblue<font color="#000080">:=</font>abs<font color="#000080">(</font>CurrBlue<font color="#000080">-</font>SearchBlue<font color="#000080">);

         </font><font color="#008000"><i>{ The lower the sum of RGB distances, the closer
           the colour is to what was required }

         </i></font>RGBTotal<font color="#000080">:=</font>distred<font color="#000080">+</font>distgreen<font color="#000080">+</font>distblue<font color="#000080">;
         </font><font color="#FF0000"><b>If </b></font>RGBTotal <font color="#000080">&lt;= </font>BestRGBTotal <font color="#FF0000"><b>Then
         Begin
            </b></font>BestIndex<font color="#000080">:=</font>ColourCount<font color="#000080">;

            </font><font color="#008000"><i>{ If we've got a perfect match, i.e. the
              total colour distance is 0, then
              break the loop }

            </i></font><font color="#FF0000"><b>If </b></font>RGBTotal <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>Then
               </b></font>break
            <font color="#FF0000"><b>else
                </b></font>BestRGBTotal<font color="#000080">:=</font>RGBTotal<font color="#000080">;


         </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
     </font><font color="#FF0000"><b>end</b></font><font color="#000080">;


     </font><font color="#008000"><i>{ And return the closest colour's palette index }

     </i></font>getClosestVGAColour<font color="#000080">:=</font>BestIndex<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;








</font><font color="#008000"><i>{ Support function to display red, green, blue values at X,Y in
  colour printcolour }

</i></font><font color="#FF0000"><b>procedure </b></font>PrintRGB<font color="#000080">(</font>x<font color="#000080">:</font>word<font color="#000080">; </font>y<font color="#000080">, </font>printcolour<font color="#000080">, </font>r<font color="#000080">,</font>g<font color="#000080">,</font>b<font color="#000080">: </font>byte<font color="#000080">);
</font><font color="#FF0000"><b>var </b></font>NumStr<font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">[</font><font color="#800000">3</font><font color="#000080">];
    </font>Builtstr<font color="#000080">:</font><font color="#FF0000"><b>string</b></font><font color="#000080">[</font><font color="#800000">30</font><font color="#000080">];
</font><font color="#FF0000"><b>begin
    </b></font>str<font color="#000080">(</font>r<font color="#000080">, </font>BuiltStr<font color="#000080">);
    </font>str<font color="#000080">(</font>g<font color="#000080">, </font>NumStr<font color="#000080">);
    </font>BuiltStr<font color="#000080">:=</font>BuiltStr<font color="#000080">+</font><font color="#800000">','</font><font color="#000080">+</font>NumStr<font color="#000080">;
    </font>str<font color="#000080">(</font>b<font color="#000080">, </font>NumStr<font color="#000080">);
    </font>BuiltStr<font color="#000080">:=</font>BuiltStr<font color="#000080">+</font><font color="#800000">','</font><font color="#000080">+</font>NumStr<font color="#000080">;
    </font>UseColour<font color="#000080">(</font>printcolour<font color="#000080">);
    </font>PrintAt<font color="#000080">(</font>x<font color="#000080">,</font>y<font color="#000080">,</font>BuiltStr<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;










</font><font color="#008000"><i>{ Test. You input your required RGB values and the system shows
  two blocks which should be nearly - or even better,
  ** exactly ** - the same colour shade.
}



</i></font><font color="#FF0000"><b>var </b></font>MyRed<font color="#000080">, </font>MyGreen<font color="#000080">, </font>MyBlue<font color="#000080">,             </font><font color="#008000"><i>{ RGB of colour to look for }
    </i></font>FoundRed<font color="#000080">, </font>FoundGreen<font color="#000080">, </font>FoundBlue<font color="#000080">,    </font><font color="#008000"><i>{ RGB of closest colour }
    </i></font>OurColour<font color="#000080">, </font>FillColour<font color="#000080">: </font>byte<font color="#000080">;        </font><font color="#008000"><i>{ Indexes for drawing }


</i></font><font color="#FF0000"><b>begin
     </b></font>Writeln<font color="#000080">(</font><font color="#800000">'What [VGA] R,G,B values are you looking for ? '</font><font color="#000080">);
     </font>Write<font color="#000080">(</font><font color="#800000">'Red   (0-63) '</font><font color="#000080">); </font>Readln<font color="#000080">(</font>MyRed<font color="#000080">);
     </font>Write<font color="#000080">(</font><font color="#800000">'Green (0-63) '</font><font color="#000080">); </font>Readln<font color="#000080">(</font>MyGreen<font color="#000080">);
     </font>Write<font color="#000080">(</font><font color="#800000">'Blue  (0-63) '</font><font color="#000080">); </font>Readln<font color="#000080">(</font>MyBlue<font color="#000080">);


     </font>InitVGAMode<font color="#000080">;
     </font>OurColour<font color="#000080">:=</font>GetClosestVGAColour<font color="#000080">(</font>MyRed<font color="#000080">, </font>MyGreen<font color="#000080">, </font>MyBlue<font color="#000080">);


     </font><font color="#FF0000"><b>If </b></font>OurColour <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>Then
        </b></font>FillColour<font color="#000080">:= </font><font color="#800000">1
     </font><font color="#FF0000"><b>Else
         </b></font>FillColour<font color="#000080">:= </font>OurColour <font color="#000080">-</font><font color="#800000">1</font><font color="#000080">;

     </font>SetRGB<font color="#000080">(</font>FillColour<font color="#000080">,</font>MyRed<font color="#000080">,</font>MyGreen<font color="#000080">,</font>MyBlue<font color="#000080">);

     </font><font color="#008000"><i>{ Display colour looked for }

     </i></font>PrintRGB<font color="#000080">(</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font>FillColour<font color="#000080">, </font>MyRed<font color="#000080">, </font>MyGreen<font color="#000080">, </font>MyBlue<font color="#000080">);
     </font>FillArea<font color="#000080">(</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">16</font><font color="#000080">,</font><font color="#800000">158</font><font color="#000080">,</font><font color="#800000">199</font><font color="#000080">, </font>FillColour<font color="#000080">);

     </font><font color="#008000"><i>{ Display closest colour }

     </i></font>GetRGB<font color="#000080">(</font>OurColour<font color="#000080">, </font>FoundRed<font color="#000080">, </font>FoundGreen<font color="#000080">, </font>FoundBlue<font color="#000080">);
     </font>PrintRGB<font color="#000080">(</font><font color="#800000">160</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">, </font>OurColour<font color="#000080">, </font>FoundRed<font color="#000080">, </font>FoundGreen<font color="#000080">, </font>FoundBlue<font color="#000080">);
     </font>FillArea<font color="#000080">(</font><font color="#800000">161</font><font color="#000080">,</font><font color="#800000">16</font><font color="#000080">,</font><font color="#800000">319</font><font color="#000080">,</font><font color="#800000">199</font><font color="#000080">,</font>OurColour<font color="#000080">);


     </font><font color="#008000"><i>{ And do I have to explain what this does? }

     </i></font><font color="#FF0000"><b>repeat until </b></font>keypressed<font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">.


</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to GRAPHICS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0275.PAS">Original</a><b>]</b></p></body>
</html>
