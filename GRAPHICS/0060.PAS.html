<html>
<head><title> "Poly Drawing" by SEAN PALMER</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to GRAPHICS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0060.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>(*
&gt; It's not that slow. I can get about 60 good-sized
&gt; poly's in a second on my dinky 386sx-20. It also does
&gt; ^ ^ ^^ ^^ ^^^^^^^^^^^^^^^^^^^^^^^^
&gt; I don't know what a good speed is for polyfills, but this sounds quite
&gt; good! Thanks heaps (and stacks?  :^) for the post!

You're welcome. I just now converted it to 99% assembler, 386+, just gotta
test it out.

&gt; One question to follow:

&gt; {  fillWord(mem[$A000:0],64000,0);  {clear}
&gt; ^^^                                ^stick closer (&quot;}&quot;) here

&gt; You'll probably recognize the above as the main routine of the polygon
&gt; fill snippet (the tester part).  Please note the part I under-careted
&gt; (or -caretted).  There is no closing comment before the next opening
&gt; comment. Should the closer be placed where indicated by me?  Or
&gt; was the opener a typo?
&gt; Not a big deal, but I want this to work so I can be impressed!  :^)

It works like that, at least in TP/BP. The open comment in effect keeps the
compiler from ever seeing the next open brace. So the second brace's closing
brace actually closes the first one. A trick I learned since I started at
deltaComm. No, I actually wanted that commented out, because clearing the
screen between each one slows it down.

Actually, I noticed a strange behaviour in the fill, where if you have one
vertex = (x,y) and the next vertex = (x+40,y+1) then you'll end up with a dot
on one line and the next line entirely filled. Not what was intended. I came up
with a fix for it:

It basically just centers the stairstep zigzag by adding half a step before it
starts.
*)

</i></font><font color="#FF0000"><b>function </b></font>lSar<font color="#000080">(</font>L<font color="#000080">:</font>longint<font color="#000080">):</font>longint<font color="#000080">;</font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;</font><font color="#FF0000"><b>asm
 </b></font><font color="#FF00FF">db $66; mov ax,L       </font><font color="#008000"><i>{mov eax,L}
 </i></font><font color="#FF00FF">db $66; sar ax,1       </font><font color="#008000"><i>{sar eax,1}
 </i></font><font color="#FF00FF">db $66,$0F,$A4,$C2,$10 </font><font color="#008000"><i>{shld edx,eax,16}
 </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>procedure </b></font>draw<font color="#000080">(</font>color<font color="#000080">:</font>byte<font color="#000080">);
</font><font color="#FF0000"><b>var </b></font>i<font color="#000080">,</font>l<font color="#000080">,</font>r<font color="#000080">,</font>lv<font color="#000080">,</font>rv<font color="#000080">,</font>top<font color="#000080">,</font>bottom<font color="#000080">,</font>topVert<font color="#000080">:</font>integer<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>lstep<font color="#000080">,</font>lpos<font color="#000080">,</font>rstep<font color="#000080">,</font>rpos<font color="#000080">:</font>fixed<font color="#000080">;
</font><font color="#FF0000"><b>var </b></font>ldest<font color="#000080">,</font>rdest<font color="#000080">:</font>tPoint<font color="#000080">; </font><font color="#FF0000"><b>begin
 </b></font><font color="#008000"><i>{find top and bottom vertices}
 </i></font>topVert<font color="#000080">:=</font>numVerts<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">;
 </font>top<font color="#000080">:=</font>vertex<font color="#000080">[</font>topVert<font color="#000080">].</font>y<font color="#000080">; </font>bottom<font color="#000080">:=</font>top<font color="#000080">;
 </font><font color="#FF0000"><b>for </b></font>i<font color="#000080">:=</font>numVerts<font color="#000080">-</font><font color="#800000">2 </font><font color="#FF0000"><b>downto </b></font><font color="#800000">0 </font><font color="#FF0000"><b>do
   if </b></font><font color="#000080">(</font>vertex<font color="#000080">[</font>i<font color="#000080">].</font>Y <font color="#000080">&lt; </font>top<font color="#000080">) </font><font color="#FF0000"><b>then begin
    </b></font>top<font color="#000080">:=</font>vertex<font color="#000080">[</font>i<font color="#000080">].</font>Y<font color="#000080">;
    </font>topVert<font color="#000080">:=</font>i<font color="#000080">;
    </font><font color="#FF0000"><b>end
   else if </b></font><font color="#000080">(</font>vertex<font color="#000080">[</font>i<font color="#000080">].</font>Y <font color="#000080">&gt; </font>bottom<font color="#000080">) </font><font color="#FF0000"><b>then
    </b></font>bottom<font color="#000080">:=</font>vertex<font color="#000080">[</font>i<font color="#000080">].</font>Y<font color="#000080">;
 </font><font color="#FF0000"><b>if </b></font>bottom<font color="#000080">&gt;</font>maxY <font color="#FF0000"><b>then </b></font>bottom<font color="#000080">:=</font>maxY<font color="#000080">;       </font><font color="#008000"><i>{clip bottom}
 </i></font><font color="#FF0000"><b>if </b></font>top<font color="#000080">&gt;</font>bottom <font color="#FF0000"><b>then </b></font>exit<font color="#000080">;
 </font>lv<font color="#000080">:=</font>topVert<font color="#000080">; </font>rv<font color="#000080">:=</font>topVert<font color="#000080">;
 </font>ldest<font color="#000080">:=</font>vertex<font color="#000080">[</font>topVert<font color="#000080">]; </font>rdest<font color="#000080">:=</font>ldest<font color="#000080">;
 </font>i<font color="#000080">:=</font>top<font color="#000080">;
 </font><font color="#FF0000"><b>repeat
  if </b></font>i<font color="#000080">&lt;</font>bottom <font color="#FF0000"><b>then begin

</b></font><font color="#008000"><i>{
^^^^^^^^^^^^^^^^^^^^^^^^^ keep from getting wierd effects from the
                          adjustment on the last row.
}
   </i></font><font color="#FF0000"><b>if </b></font>i<font color="#000080">&gt;=</font>ldest<font color="#000080">.</font>y <font color="#FF0000"><b>then begin
    </b></font>lpos<font color="#000080">.</font>f<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">; </font>lpos<font color="#000080">.</font>i<font color="#000080">:=</font>ldest<font color="#000080">.</font>x<font color="#000080">;
    </font>dec<font color="#000080">(</font>lv<font color="#000080">); </font><font color="#FF0000"><b>if </b></font>lv<font color="#000080">&lt;</font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>lv<font color="#000080">:=</font>numVerts<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">;
    </font>ldest<font color="#000080">:=</font>vertex<font color="#000080">[</font>lv<font color="#000080">];
    </font><font color="#FF0000"><b>if </b></font>ldest<font color="#000080">.</font>y<font color="#000080">=</font>i <font color="#FF0000"><b>then begin
      if </b></font>ldest<font color="#000080">.</font>x<font color="#000080">&lt;</font>lpos<font color="#000080">.</font>i <font color="#FF0000"><b>then </b></font>lpos<font color="#000080">.</font>i<font color="#000080">:=</font>ldest<font color="#000080">.</font>x<font color="#000080">;
      </font>lstep<font color="#000080">.</font>l<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
      </font><font color="#FF0000"><b>end
    else begin
      </b></font>lstep<font color="#000080">.</font>l<font color="#000080">:=</font>fixedDiv<font color="#000080">(</font>ldest<font color="#000080">.</font>x<font color="#000080">-</font>lpos<font color="#000080">.</font>i<font color="#000080">,</font>ldest<font color="#000080">.</font>y<font color="#000080">-</font>i<font color="#000080">);
      </font>inc<font color="#000080">(</font>lpos<font color="#000080">.</font>l<font color="#000080">,</font>lSar<font color="#000080">(</font>lstep<font color="#000080">.</font>l<font color="#000080">));

      ^^^^^^^^^^^^^^^^^^^^^^^^^^  </font>Center the stairstep pattern

      <font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
   </font><font color="#FF0000"><b>if </b></font>i<font color="#000080">&gt;=</font>rdest<font color="#000080">.</font>y <font color="#FF0000"><b>then begin
    </b></font>rpos<font color="#000080">.</font>f<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">; </font>rpos<font color="#000080">.</font>i<font color="#000080">:=</font>rdest<font color="#000080">.</font>x<font color="#000080">;
    </font>inc<font color="#000080">(</font>rv<font color="#000080">); </font><font color="#FF0000"><b>if </b></font>rv<font color="#000080">&gt;=</font>numVerts <font color="#FF0000"><b>then </b></font>rv<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
    </font>rdest<font color="#000080">:=</font>vertex<font color="#000080">[</font>rv<font color="#000080">];
    </font><font color="#FF0000"><b>if </b></font>rdest<font color="#000080">.</font>y<font color="#000080">=</font>i <font color="#FF0000"><b>then begin
      if </b></font>rdest<font color="#000080">.</font>x<font color="#000080">&gt;</font>rpos<font color="#000080">.</font>i <font color="#FF0000"><b>then </b></font>rpos<font color="#000080">.</font>i<font color="#000080">:=</font>rdest<font color="#000080">.</font>x<font color="#000080">;
      </font>rstep<font color="#000080">.</font>l<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
      </font><font color="#FF0000"><b>end
    else begin
      </b></font>rstep<font color="#000080">.</font>l<font color="#000080">:=</font>fixedDiv<font color="#000080">(</font>rdest<font color="#000080">.</font>x<font color="#000080">-</font>rpos<font color="#000080">.</font>i<font color="#000080">,</font>rdest<font color="#000080">.</font>y<font color="#000080">-</font>i<font color="#000080">);
      </font>inc<font color="#000080">(</font>rpos<font color="#000080">.</font>l<font color="#000080">,</font>lSar<font color="#000080">(</font>rStep<font color="#000080">.</font>l<font color="#000080">));

      ^^^^^^^^^^^^^^^^^^^^^^^^^^  </font>Center the stairstep pattern

      <font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
   </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font>i<font color="#000080">&gt;=</font>minY <font color="#FF0000"><b>then begin                             </b></font><font color="#008000"><i>{clip top}
   </i></font><font color="#FF0000"><b>if </b></font>lpos<font color="#000080">.</font>i<font color="#000080">&gt;</font>minX <font color="#FF0000"><b>then </b></font>l<font color="#000080">:=</font>lpos<font color="#000080">.</font>i <font color="#FF0000"><b>else </b></font>l<font color="#000080">:=</font>minX<font color="#000080">;      </font><font color="#008000"><i>{clip left}
   </i></font><font color="#FF0000"><b>if </b></font>rpos<font color="#000080">.</font>i<font color="#000080">&lt;</font>maxX <font color="#FF0000"><b>then </b></font>r<font color="#000080">:=</font>rpos<font color="#000080">.</font>i <font color="#FF0000"><b>else </b></font>r<font color="#000080">:=</font>maxX<font color="#000080">;      </font><font color="#008000"><i>{clip right}
   </i></font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>l<font color="#000080">&lt;=</font>r<font color="#000080">) </font><font color="#FF0000"><b>then
    </b></font>fillWord<font color="#000080">(</font>mem<font color="#000080">[</font><font color="#800000">$A000</font><font color="#000080">:</font>i<font color="#000080">*</font><font color="#800000">320</font><font color="#000080">+</font>l<font color="#000080">],</font>r<font color="#000080">-</font>l<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">,</font>color<font color="#000080">);
   </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>inc<font color="#000080">(</font>lpos<font color="#000080">.</font>l<font color="#000080">,</font>lstep<font color="#000080">.</font>l<font color="#000080">);
  </font>inc<font color="#000080">(</font>rpos<font color="#000080">.</font>l<font color="#000080">,</font>rstep<font color="#000080">.</font>l<font color="#000080">);
  </font>inc<font color="#000080">(</font>i<font color="#000080">);
  </font><font color="#FF0000"><b>until </b></font>i<font color="#000080">&gt;</font>bottom<font color="#000080">;
 </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to GRAPHICS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0060.PAS">Original</a><b>]</b></p></body>
</html>
