<html>
<head><title> "Loading 256 Color Bitmaps" by KRISJANIS GALE</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to GRAPHICS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0150.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
For all who are interested:
}
{------------------------------------------------------------------------}
{  HOW TO READ A .BMP FILE!                                              }
{------------------------------------------------------------------------}
</i></font><font color="#FF0000"><b>procedure </b></font>LoadBMP<font color="#000080">(</font>dx<font color="#000080">:</font>integer<font color="#000080">;</font>dy<font color="#000080">:</font>byte<font color="#000080">;</font>usepal<font color="#000080">:</font>boolean<font color="#000080">;</font>filestr<font color="#000080">:</font><font color="#FF0000"><b>string</b></font><font color="#000080">);
  </font><font color="#008000"><i>{Loads a 256-color .BMP file directly onto}
  {the screen at point x,y; K.Gale, 8/23/94}
  {added option to use or not use the saved palette; 8/24/94}
</i></font><font color="#FF0000"><b>var
   </b></font>cel<font color="#000080">:</font>text<font color="#000080">;
   </font>inchar<font color="#000080">:</font>char<font color="#000080">;
   </font>instr<font color="#000080">:</font><font color="#FF0000"><b>string</b></font><font color="#000080">[</font><font color="#800000">4</font><font color="#000080">];
   </font>y<font color="#000080">,</font>r<font color="#000080">,</font>g<font color="#000080">,</font>b<font color="#000080">,</font>ymax<font color="#000080">:</font>byte<font color="#000080">;
   </font>x<font color="#000080">,</font>xmax<font color="#000080">:</font>integer<font color="#000080">;
</font><font color="#FF0000"><b>const
     </b></font>bmpheader<font color="#000080">=</font><font color="#800000">18</font><font color="#000080">;
</font><font color="#FF0000"><b>begin
     </b></font>x<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;</font>y<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
     </font>assign<font color="#000080">(</font>cel<font color="#000080">,</font>filestr<font color="#000080">);
     </font>reset<font color="#000080">(</font>cel<font color="#000080">);
     </font><font color="#FF0000"><b>for </b></font>x<font color="#000080">:=</font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>bmpheader <font color="#FF0000"><b>do
         </b></font>read<font color="#000080">(</font>cel<font color="#000080">,</font>inchar<font color="#000080">);
     </font>x<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
     </font>read<font color="#000080">(</font>cel<font color="#000080">,</font>instr<font color="#000080">);
     </font>xmax<font color="#000080">:=</font>ord<font color="#000080">(</font>instr<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">])+(</font>ord<font color="#000080">(</font>instr<font color="#000080">[</font><font color="#800000">2</font><font color="#000080">])*</font><font color="#800000">256</font><font color="#000080">)
          +(</font>ord<font color="#000080">(</font>instr<font color="#000080">[</font><font color="#800000">2</font><font color="#000080">])*</font><font color="#800000">256</font><font color="#000080">*</font><font color="#800000">256</font><font color="#000080">)+(</font>ord<font color="#000080">(</font>instr<font color="#000080">[</font><font color="#800000">3</font><font color="#000080">])*</font><font color="#800000">256</font><font color="#000080">*</font><font color="#800000">256</font><font color="#000080">*</font><font color="#800000">256</font><font color="#000080">)-</font><font color="#800000">1</font><font color="#000080">;
     </font>read<font color="#000080">(</font>cel<font color="#000080">,</font>instr<font color="#000080">);
     </font>ymax<font color="#000080">:=</font>ord<font color="#000080">(</font>instr<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">])+(</font>ord<font color="#000080">(</font>instr<font color="#000080">[</font><font color="#800000">2</font><font color="#000080">])*</font><font color="#800000">256</font><font color="#000080">)
          +(</font>ord<font color="#000080">(</font>instr<font color="#000080">[</font><font color="#800000">2</font><font color="#000080">])*</font><font color="#800000">256</font><font color="#000080">*</font><font color="#800000">256</font><font color="#000080">)+(</font>ord<font color="#000080">(</font>instr<font color="#000080">[</font><font color="#800000">3</font><font color="#000080">])*</font><font color="#800000">256</font><font color="#000080">*</font><font color="#800000">256</font><font color="#000080">*</font><font color="#800000">256</font><font color="#000080">)-</font><font color="#800000">1</font><font color="#000080">;
     </font><font color="#FF0000"><b>for </b></font>x<font color="#000080">:=</font><font color="#800000">27 </font><font color="#FF0000"><b>to </b></font><font color="#800000">54 </font><font color="#FF0000"><b>do
         </b></font>read<font color="#000080">(</font>cel<font color="#000080">,</font>inchar<font color="#000080">);
     </font>x<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
     </font><font color="#FF0000"><b>if </b></font>usepal<font color="#000080">&lt;&gt;</font>false <font color="#FF0000"><b>then
        begin
             for </b></font>y<font color="#000080">:=</font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font><font color="#800000">255 </font><font color="#FF0000"><b>do
                 </b></font>pal<font color="#000080">(</font>y<font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">);
             </font>y<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
             </font><font color="#FF0000"><b>while </b></font>x<font color="#000080">&lt;=</font><font color="#800000">255 </font><font color="#FF0000"><b>do
             begin
                  </b></font>read<font color="#000080">(</font>cel<font color="#000080">,</font>instr<font color="#000080">);
                  </font>r<font color="#000080">:=</font>ord<font color="#000080">(</font>instr<font color="#000080">[</font><font color="#800000">3</font><font color="#000080">]) </font><font color="#FF0000"><b>div </b></font><font color="#800000">4</font><font color="#000080">;
                  </font>g<font color="#000080">:=</font>ord<font color="#000080">(</font>instr<font color="#000080">[</font><font color="#800000">2</font><font color="#000080">]) </font><font color="#FF0000"><b>div </b></font><font color="#800000">4</font><font color="#000080">;
                  </font>b<font color="#000080">:=</font>ord<font color="#000080">(</font>instr<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">]) </font><font color="#FF0000"><b>div </b></font><font color="#800000">4</font><font color="#000080">;
                  </font>pal<font color="#000080">(</font>x<font color="#000080">,</font>r<font color="#000080">,</font>g<font color="#000080">,</font>b<font color="#000080">);
                  </font>inc<font color="#000080">(</font>x<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">)
             </font><font color="#FF0000"><b>end
        end
     else
         for </b></font>x<font color="#000080">:=</font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font><font color="#800000">255 </font><font color="#FF0000"><b>do
             </b></font>read<font color="#000080">(</font>cel<font color="#000080">,</font>instr<font color="#000080">);
     </font>x<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
     </font><font color="#FF0000"><b>while </b></font><font color="#000080">(</font>y<font color="#000080">&lt;=</font>ymax<font color="#000080">) </font><font color="#FF0000"><b>do
     begin
          </b></font>read<font color="#000080">(</font>cel<font color="#000080">,</font>inchar<font color="#000080">);
          </font>putpixel<font color="#000080">(</font>dx<font color="#000080">+</font>x<font color="#000080">,</font>dy<font color="#000080">+(</font>ymax<font color="#000080">-</font>y<font color="#000080">),</font>ord<font color="#000080">(</font>inchar<font color="#000080">),</font>vga<font color="#000080">);
          </font><font color="#FF0000"><b>if </b></font>x<font color="#000080">&lt;</font>xmax <font color="#FF0000"><b>then
             </b></font>inc<font color="#000080">(</font>x<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">)
          </font><font color="#FF0000"><b>else
              begin
                   </b></font>inc<font color="#000080">(</font>y<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">);
                   </font>x<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
              </font><font color="#FF0000"><b>end
     end</b></font><font color="#000080">;
     </font>close<font color="#000080">(</font>cel<font color="#000080">)
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#008000"><i>{------------------------------------------------------------------------}

</i></font>There<font color="#000080">...
</font>never mind the putpixel <font color="#FF0000"><b>procedure </b></font>call<font color="#000080">...
</font>you <font color="#FF0000"><b>DO NOT </b></font>have that <font color="#FF0000"><b>procedure</b></font><font color="#000080">.  </font>I use a gfx <font color="#FF0000"><b>unit </b></font>that
a friend <font color="#FF0000"><b>of </b></font>mine wrote <font color="#FF0000"><b>and </b></font>so<font color="#000080">, </font>you will have <font color="#FF0000"><b>to </b></font>substitute
the proper <font color="#FF0000"><b>procedure </b></font>call <font color="#FF0000"><b>for </b></font>putting a pixel <font color="#FF0000"><b>on </b></font>the screen<font color="#000080">.

</font>Furthermore<font color="#000080">, </font>this will ONLY work <font color="#FF0000"><b>for </b></font><font color="#800000">256</font><font color="#000080">-</font>color <font color="#000080">.</font>BMP files<font color="#000080">.
</font>Lastly<font color="#000080">, </font>the <font color="#000080">&quot;</font>usepal<font color="#000080">&quot; </font>boolean switch <font color="#FF0000"><b>is for </b></font>those cases when
you want <font color="#FF0000"><b>to </b></font>preserve an already defined palette<font color="#000080">, </font>rather than
having the <font color="#000080">.</font>BMP re<font color="#000080">-</font>define all <font color="#FF0000"><b>of </b></font>those colors<font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to GRAPHICS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0150.PAS">Original</a><b>]</b></p></body>
</html>
