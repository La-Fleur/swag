<html>
<head><title> "Load and display 256 color bitmaps" by SWAG SUPPORT TEAM</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to GRAPHICS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0234.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#FF0000"><b>program </b></font>loadbmp<font color="#000080">;

</font><font color="#008000"><i>{ only 256 colors }

</i></font><font color="#FF0000"><b>uses </b></font>dos<font color="#000080">,</font>crt<font color="#000080">,</font>graph<font color="#000080">;

</font><font color="#008000"><i>{ the driver is include in &quot;play256.zip&quot; on my pascal-homepage }
{ http://quintus.universal.nl/users/dickmann/pascal.htm }

</i></font><font color="#FF0000"><b>var
  </b></font>regs                  <font color="#000080">:</font>registers<font color="#000080">;
  </font>maxx<font color="#000080">,</font>maxy<font color="#000080">,</font>p<font color="#000080">,</font>x<font color="#000080">,</font>y       <font color="#000080">:</font>integer<font color="#000080">;
  </font>f                     <font color="#000080">:</font><font color="#FF0000"><b>file</b></font><font color="#000080">;
  </font>header                <font color="#000080">:</font><font color="#FF0000"><b>record
                           </b></font>bm<font color="#000080">:</font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">1</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>char<font color="#000080">;
                           </font>groottebestand       <font color="#000080">:</font>longint<font color="#000080">;
                           </font>reserve              <font color="#000080">:</font>longint<font color="#000080">;
                           </font>offset               <font color="#000080">:</font>longint<font color="#000080">;
                           </font>groottebeeldinfo     <font color="#000080">:</font>longint<font color="#000080">;
                         </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>beeldinfo             <font color="#000080">:</font><font color="#FF0000"><b>record
                           </b></font>breedte<font color="#000080">,</font>hoogte       <font color="#000080">:</font>longint<font color="#000080">;
                           </font>vlakken<font color="#000080">,</font>bitsperpixel <font color="#000080">:</font>word<font color="#000080">;
                           </font>hor<font color="#000080">,</font>ver              <font color="#000080">:</font>longint<font color="#000080">;
                           </font>aantalkleuren        <font color="#000080">:</font>longint<font color="#000080">;
                         </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>bytesperlijn<font color="#000080">,</font>oudpos   <font color="#000080">:</font>longint<font color="#000080">;
  </font>rgbi                  <font color="#000080">:</font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">256</font><font color="#000080">] </font><font color="#FF0000"><b>of record </b></font>bb<font color="#000080">,</font>gg<font color="#000080">,</font>rr<font color="#000080">,</font>ii <font color="#000080">:</font>byte<font color="#000080">;</font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>rgb                   <font color="#000080">:</font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">256</font><font color="#000080">] </font><font color="#FF0000"><b>of record </b></font>r<font color="#000080">,</font>g<font color="#000080">,</font>b <font color="#000080">:</font>byte<font color="#000080">;</font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>lijn                  <font color="#000080">:</font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">1024</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">;


</font><font color="#FF0000"><b>procedure </b></font>load_bmp<font color="#000080">(</font>xx<font color="#000080">,</font>yy <font color="#000080">:</font>integer<font color="#000080">;</font>filenaam <font color="#000080">:</font><font color="#FF0000"><b>string</b></font><font color="#000080">);

</font><font color="#FF0000"><b>procedure </b></font>set256palette<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>rgb_buffer<font color="#000080">);

</font><font color="#FF0000"><b>begin
  with </b></font>regs <font color="#FF0000"><b>do begin
    </b></font>ax <font color="#000080">:=</font><font color="#800000">$1012</font><font color="#000080">;
    </font>bx <font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
    </font>cx <font color="#000080">:=</font><font color="#800000">256</font><font color="#000080">;
    </font>es <font color="#000080">:=</font>seg<font color="#000080">(</font>rgb_buffer<font color="#000080">);
    </font>dx <font color="#000080">:=</font>ofs<font color="#000080">(</font>rgb_buffer<font color="#000080">);
    </font>intr<font color="#000080">(</font><font color="#800000">$10</font><font color="#000080">,</font>regs<font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>begin
  </b></font>maxx <font color="#000080">:=</font>getmaxx<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">;</font>maxy <font color="#000080">:=</font>getmaxy<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">;
  </font>assign<font color="#000080">(</font>f<font color="#000080">,</font>filenaam<font color="#000080">+</font><font color="#800000">'.bmp'</font><font color="#000080">);
  </font><font color="#008000"><i>{$I-} </i></font>reset<font color="#000080">(</font>f<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">); </font><font color="#008000"><i>{$I+}
  </i></font><font color="#FF0000"><b>if </b></font>ioresult <font color="#000080">=</font><font color="#800000">0 </font><font color="#FF0000"><b>then begin
    </b></font>blockread<font color="#000080">(</font>f<font color="#000080">,</font>header<font color="#000080">,</font>sizeof<font color="#000080">(</font>header<font color="#000080">));
    </font>fillchar<font color="#000080">(</font>beeldinfo<font color="#000080">,</font>sizeof<font color="#000080">(</font>beeldinfo<font color="#000080">),</font><font color="#800000">0</font><font color="#000080">);
    </font>blockread<font color="#000080">(</font>f<font color="#000080">,</font>beeldinfo<font color="#000080">,</font>header<font color="#000080">.</font>groottebeeldinfo <font color="#000080">-</font><font color="#800000">4</font><font color="#000080">);
    </font><font color="#FF0000"><b>with </b></font>beeldinfo<font color="#000080">,</font>header <font color="#FF0000"><b>do begin
      </b></font>bytesperlijn <font color="#000080">:=</font>breedte <font color="#000080">*</font>bitsperpixel<font color="#000080">;
      </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>bytesperlijn <font color="#FF0000"><b>and </b></font><font color="#800000">31</font><font color="#000080">) =</font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>bytesperlijn <font color="#000080">:=</font>bytesperlijn <font color="#FF0000"><b>shr </b></font><font color="#800000">3
        </font><font color="#FF0000"><b>else </b></font>bytesperlijn <font color="#000080">:=</font>succ<font color="#000080">(</font>bytesperlijn <font color="#FF0000"><b>shr </b></font><font color="#800000">5</font><font color="#000080">)</font><font color="#FF0000"><b>shl </b></font><font color="#800000">2</font><font color="#000080">;
      </font><font color="#FF0000"><b>if </b></font>aantalkleuren <font color="#000080">=</font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>aantalkleuren <font color="#000080">:=</font><font color="#800000">1 </font><font color="#FF0000"><b>shl </b></font>bitsperpixel<font color="#000080">;

      </font><font color="#FF0000"><b>if </b></font>bitsperpixel <font color="#000080">&lt;&gt;</font><font color="#800000">8 </font><font color="#FF0000"><b>then </b></font>exit<font color="#000080">;
      </font>blockread<font color="#000080">(</font>f<font color="#000080">,</font>rgbi<font color="#000080">,</font><font color="#800000">4</font><font color="#000080">*</font>aantalkleuren<font color="#000080">);
      </font><font color="#FF0000"><b>for </b></font>p <font color="#000080">:=</font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>aantalkleuren <font color="#FF0000"><b>do with </b></font>rgb<font color="#000080">[</font>p<font color="#000080">],</font>rgbi<font color="#000080">[</font>p<font color="#000080">] </font><font color="#FF0000"><b>do begin
        </b></font>r <font color="#000080">:=</font>rr <font color="#FF0000"><b>shr </b></font><font color="#800000">2</font><font color="#000080">;
        </font>g <font color="#000080">:=</font>gg <font color="#FF0000"><b>shr </b></font><font color="#800000">2</font><font color="#000080">;
        </font>b <font color="#000080">:=</font>bb <font color="#FF0000"><b>shr </b></font><font color="#800000">2</font><font color="#000080">;
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font>set256palette<font color="#000080">(</font>rgb<font color="#000080">);

      </font><font color="#FF0000"><b>with </b></font>header<font color="#000080">,</font>beeldinfo <font color="#FF0000"><b>do begin
        if </b></font>hoogte <font color="#000080">&lt;= </font>maxy <font color="#FF0000"><b>then </b></font>oudpos <font color="#000080">:=</font>offset
          <font color="#FF0000"><b>else </b></font>oudpos <font color="#000080">:=</font>offset <font color="#000080">+</font>bytesperlijn <font color="#000080">*(</font>hoogte <font color="#000080">-</font>maxy<font color="#000080">);
        </font><font color="#FF0000"><b>if </b></font>breedte <font color="#000080">&lt; </font>maxx <font color="#FF0000"><b>then </b></font>maxx <font color="#000080">:=</font>breedte<font color="#000080">;
        </font><font color="#FF0000"><b>if </b></font>hoogte <font color="#000080">&lt;</font>maxy <font color="#FF0000"><b>then </b></font>maxy <font color="#000080">:=</font>hoogte<font color="#000080">;
        </font><font color="#FF0000"><b>for </b></font>y <font color="#000080">:=</font>yy<font color="#000080">+(</font>maxy<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">) </font><font color="#FF0000"><b>downto </b></font>yy <font color="#FF0000"><b>do begin
          </b></font>seek<font color="#000080">(</font>f<font color="#000080">,</font>oudpos<font color="#000080">);
          </font>blockread<font color="#000080">(</font>f<font color="#000080">,</font>lijn<font color="#000080">,</font>maxx<font color="#000080">);
          </font><font color="#FF0000"><b>for </b></font>x <font color="#000080">:=</font>xx <font color="#FF0000"><b>to </b></font><font color="#000080">(</font>maxx<font color="#000080">)+</font>xx <font color="#FF0000"><b>do </b></font>putpixel<font color="#000080">(</font>x<font color="#000080">,</font>y<font color="#000080">,</font>lijn<font color="#000080">[</font>x<font color="#000080">-</font>xx<font color="#000080">]);
          </font>inc<font color="#000080">(</font>oudpos<font color="#000080">,</font>bytesperlijn<font color="#000080">);
        </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

      </font>close<font color="#000080">(</font>f<font color="#000080">);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>Setvideo<font color="#000080">(</font>scherm <font color="#000080">:</font>byte<font color="#000080">);

</font><font color="#FF0000"><b>var  </b></font>AutoDetect <font color="#000080">: </font>pointer<font color="#000080">;  </font>GrMd<font color="#000080">,</font>GrDr  <font color="#000080">: </font>integer<font color="#000080">;

</font><font color="#008000"><i>{$F+}
</i></font><font color="#FF0000"><b>function </b></font>DetectVGA0 <font color="#000080">: </font>Integer<font color="#000080">;
</font><font color="#FF0000"><b>begin </b></font>detectvga0 <font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;</font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>function </b></font>DetectVGA1 <font color="#000080">: </font>Integer<font color="#000080">;
</font><font color="#FF0000"><b>begin </b></font>detectvga1 <font color="#000080">:=</font><font color="#800000">1</font><font color="#000080">;</font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>function </b></font>DetectVGA2 <font color="#000080">: </font>Integer<font color="#000080">;
</font><font color="#FF0000"><b>begin </b></font>detectvga2 <font color="#000080">:=</font><font color="#800000">2</font><font color="#000080">;</font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>function </b></font>DetectVGA3 <font color="#000080">: </font>Integer<font color="#000080">;
</font><font color="#FF0000"><b>begin </b></font>detectvga3 <font color="#000080">:=</font><font color="#800000">3</font><font color="#000080">;</font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>function </b></font>DetectVGA4 <font color="#000080">: </font>Integer<font color="#000080">;
</font><font color="#FF0000"><b>begin </b></font>detectvga4 <font color="#000080">:=</font><font color="#800000">4</font><font color="#000080">;</font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#008000"><i>{$F-}

</i></font><font color="#FF0000"><b>begin
  </b></font>AutoDetect <font color="#000080">:= @</font>DetectVGA2<font color="#000080">;
  </font><font color="#FF0000"><b>case </b></font>scherm <font color="#FF0000"><b>of
    </b></font><font color="#800000">0</font><font color="#000080">:</font>AutoDetect <font color="#000080">:= @</font>DetectVGA0<font color="#000080">;
    </font><font color="#800000">1</font><font color="#000080">:</font>AutoDetect <font color="#000080">:= @</font>DetectVGA1<font color="#000080">;
    </font><font color="#800000">2</font><font color="#000080">:</font>AutoDetect <font color="#000080">:= @</font>DetectVGA2<font color="#000080">;
    </font><font color="#800000">3</font><font color="#000080">:</font>AutoDetect <font color="#000080">:= @</font>DetectVGA3<font color="#000080">;
    </font><font color="#800000">4</font><font color="#000080">:</font>AutoDetect <font color="#000080">:= @</font>DetectVGA4<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>GrDr <font color="#000080">:= </font>InstallUserDriver<font color="#000080">(</font><font color="#800000">'SVGA256'</font><font color="#000080">,</font>AutoDetect<font color="#000080">);
  </font>GrDr <font color="#000080">:= </font>Detect<font color="#000080">;
  </font>InitGraph<font color="#000080">(</font>GrDr<font color="#000080">,</font>GrMd<font color="#000080">,</font><font color="#800000">''</font><font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>begin
  </b></font>setvideo<font color="#000080">(</font><font color="#800000">2</font><font color="#000080">);
     </font><font color="#008000"><i>{ 0 = 320x200 / 1 = 640x400 / 2 = 640x480 }
     { 3 = 800x600 / 4 = 1024x768 pixels }

  </i></font>load_bmp<font color="#000080">(</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">'demo'</font><font color="#000080">);   </font><font color="#008000"><i>{ no extension }
  </i></font>readln<font color="#000080">;
  </font>closegraph<font color="#000080">;
  </font>halt<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">.</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to GRAPHICS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0234.PAS">Original</a><b>]</b></p></body>
</html>
