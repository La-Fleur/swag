<html>
<head><title> "TP7.0 source of fastest known ellipse" by GERD.PLATL@SIEMENS.AT</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to GRAPHICS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0264.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{  Hi

Many of fast ellipse drawing routines uses two loops
to draw a part of an ellipse curve, first from 0 to 45
degrees and second from 45 to 90 degrees. But there is
an algorithm that uses only one loop. I think, that's
the shortest and fastest way to draw ellipses on raster
screens.

If you know about a better ellipse drawing algorithm
send me your hints !
                    ;-) Gerd

Email: gerd.platl@siemens.at
--------------------------------------------------------
{$A+,B+,G-,I-,O-,V-,D-,L-,Q-,R-,S-,E-,N-  TP 7.0 Opt.}

</i></font><font color="#FF0000"><b>program </b></font>FastEllipseDrawingDemo<font color="#000080">;    </font><font color="#008000"><i>{02-04-96,04-08-97}

</i></font><font color="#FF0000"><b>uses  </b></font>Crt<font color="#000080">, </font>Dos<font color="#000080">;

</font><font color="#FF0000"><b>const </b></font>maxX <font color="#000080">= </font><font color="#800000">319</font><font color="#000080">;
      </font>maxY <font color="#000080">= </font><font color="#800000">199</font><font color="#000080">;           </font><font color="#008000"><i>{video mode 19: 320x200/256}
</i></font><font color="#FF0000"><b>var   </b></font>v<font color="#000080">:</font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font>maxY<font color="#000080">,</font><font color="#800000">0</font><font color="#000080">..</font>maxX<font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte <font color="#FF0000"><b>absolute </b></font><font color="#800000">$A000</font><font color="#000080">:</font><font color="#800000">0</font><font color="#000080">;
</font><font color="#008000"><i>{
procedure PutPixel (x,y: integer; color: byte);
begin  v[y,x] := color; end;
}
</i></font><font color="#FF0000"><b>procedure </b></font>PutPixel <font color="#000080">(</font>x<font color="#000080">,</font>y<font color="#000080">: </font>integer<font color="#000080">; </font>color<font color="#000080">: </font>byte<font color="#000080">); </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>asm
  </b></font><font color="#FF00FF">mov ax,0A000h
  mov es,ax        </font><font color="#008000"><i>{es = $A000}
  </i></font><font color="#FF00FF">mov ax,y
  shl ax,6
  mov bx,ax        </font><font color="#008000"><i>{bx = y * 64}
  </i></font><font color="#FF00FF">shl ax,1
  shl ax,1         </font><font color="#008000"><i>{ax = y * 256}
  </i></font><font color="#FF00FF">add bx,ax        </font><font color="#008000"><i>{bx = y * 320}
  </i></font><font color="#FF00FF">add bx,x         </font><font color="#008000"><i>{bx = y * 320 + x}
  </i></font><font color="#FF00FF">mov al,color     </font><font color="#008000"><i>{load color}
  </i></font><font color="#FF00FF">mov es:[bx],al   </font><font color="#008000"><i>{set point}
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>DrawEllipse <font color="#000080">(</font>mx<font color="#000080">,</font>my<font color="#000080">, </font>a<font color="#000080">,</font>b<font color="#000080">, </font>color<font color="#000080">: </font>integer<font color="#000080">);

</font><font color="#FF0000"><b>var   </b></font>x<font color="#000080">,  </font>mx1<font color="#000080">,</font>mx2<font color="#000080">,  </font>my1<font color="#000080">,</font>my2<font color="#000080">: </font>integer<font color="#000080">;
      </font>aq<font color="#000080">,</font>bq<font color="#000080">, </font>dx<font color="#000080">,</font>dy<font color="#000080">, </font>r<font color="#000080">,</font>rx<font color="#000080">,</font>ry<font color="#000080">: </font>longint<font color="#000080">;

</font><font color="#FF0000"><b>begin
  </b></font>PutPixel <font color="#000080">(</font>mx <font color="#000080">+ </font>a<font color="#000080">, </font>my<font color="#000080">, </font>color<font color="#000080">);
  </font>PutPixel <font color="#000080">(</font>mx <font color="#000080">- </font>a<font color="#000080">, </font>my<font color="#000080">, </font>color<font color="#000080">);

  </font>mx1 <font color="#000080">:= </font>mx <font color="#000080">- </font>a<font color="#000080">;   </font>my1 <font color="#000080">:= </font>my<font color="#000080">;
  </font>mx2 <font color="#000080">:= </font>mx <font color="#000080">+ </font>a<font color="#000080">;   </font>my2 <font color="#000080">:= </font>my<font color="#000080">;

  </font>aq <font color="#000080">:= </font>longint <font color="#000080">(</font>a<font color="#000080">) * </font>a<font color="#000080">;        </font><font color="#008000"><i>{calc sqr}
  </i></font>bq <font color="#000080">:= </font>longint <font color="#000080">(</font>b<font color="#000080">) * </font>b<font color="#000080">;
  </font>dx <font color="#000080">:= </font>aq <font color="#FF0000"><b>shl </b></font><font color="#800000">1</font><font color="#000080">;               </font><font color="#008000"><i>{dx := 2 * a * a}
  </i></font>dy <font color="#000080">:= </font>bq <font color="#FF0000"><b>shl </b></font><font color="#800000">1</font><font color="#000080">;               </font><font color="#008000"><i>{dy := 2 * b * b}
  </i></font>r  <font color="#000080">:= </font>a <font color="#000080">* </font>bq<font color="#000080">;                 </font><font color="#008000"><i>{r  := a * b * b}
  </i></font>rx <font color="#000080">:= </font>r <font color="#FF0000"><b>shl </b></font><font color="#800000">1</font><font color="#000080">;                </font><font color="#008000"><i>{rx := 2 * a * b * b}
  </i></font>ry <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;                      </font><font color="#008000"><i>{because y = 0}
  </i></font>x <font color="#000080">:= </font>a<font color="#000080">;

  </font><font color="#FF0000"><b>while </b></font>x <font color="#000080">&gt; </font><font color="#800000">0
  </font><font color="#FF0000"><b>do begin
    if </b></font>r <font color="#000080">&gt; </font><font color="#800000">0
    </font><font color="#FF0000"><b>then begin                  </b></font><font color="#008000"><i>{ y + 1 }
      </i></font>inc <font color="#000080">(</font>my1<font color="#000080">);   </font>dec <font color="#000080">(</font>my2<font color="#000080">);
      </font>inc <font color="#000080">(</font>ry<font color="#000080">, </font>dx<font color="#000080">);             </font><font color="#008000"><i>{ry = dx * y}
      </i></font>dec <font color="#000080">(</font>r<font color="#000080">, </font>ry<font color="#000080">);              </font><font color="#008000"><i>{r = r - dx + y}
    </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>if </b></font>r <font color="#000080">&lt;= </font><font color="#800000">0
    </font><font color="#FF0000"><b>then begin                  </b></font><font color="#008000"><i>{ x - 1 }
      </i></font>dec <font color="#000080">(</font>x<font color="#000080">);
      </font>inc <font color="#000080">(</font>mx1<font color="#000080">);   </font>dec <font color="#000080">(</font>mx2<font color="#000080">);
      </font>dec <font color="#000080">(</font>rx<font color="#000080">, </font>dy<font color="#000080">);             </font><font color="#008000"><i>{rx = dy * x}
      </i></font>inc <font color="#000080">(</font>r<font color="#000080">, </font>rx<font color="#000080">);              </font><font color="#008000"><i>{r = r + dy * x}
    </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font>PutPixel <font color="#000080">(</font>mx1<font color="#000080">, </font>my1<font color="#000080">, </font>color<font color="#000080">);
    </font>PutPixel <font color="#000080">(</font>mx1<font color="#000080">, </font>my2<font color="#000080">, </font>color<font color="#000080">);
    </font>PutPixel <font color="#000080">(</font>mx2<font color="#000080">, </font>my1<font color="#000080">, </font>color<font color="#000080">);
    </font>PutPixel <font color="#000080">(</font>mx2<font color="#000080">, </font>my2<font color="#000080">, </font>color<font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>var    </b></font>a<font color="#000080">,</font>b<font color="#000080">: </font>integer<font color="#000080">;   </font>r<font color="#000080">: </font>registers<font color="#000080">;

</font><font color="#FF0000"><b>begin
  </b></font>r<font color="#000080">.</font>ax<font color="#000080">:=</font><font color="#800000">$13</font><font color="#000080">;   </font>Intr<font color="#000080">(</font><font color="#800000">$10</font><font color="#000080">,</font>r<font color="#000080">);
  </font><font color="#FF0000"><b>repeat
    </b></font>a <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">+</font>Random <font color="#000080">(</font><font color="#800000">100</font><font color="#000080">);
    </font>b <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">+</font>Random <font color="#000080">(</font><font color="#800000">99</font><font color="#000080">);
    </font>DrawEllipse <font color="#000080">(</font>a <font color="#000080">+ </font>Random <font color="#000080">(</font>maxX <font color="#000080">- </font><font color="#800000">2 </font><font color="#000080">* </font>a<font color="#000080">),
                 </font>b <font color="#000080">+ </font>Random <font color="#000080">(</font>maxY <font color="#000080">- </font><font color="#800000">2 </font><font color="#000080">* </font>b<font color="#000080">), </font>a<font color="#000080">,</font>b<font color="#000080">,
                 </font><font color="#800000">1 </font><font color="#000080">+ </font>Random <font color="#000080">(</font><font color="#800000">255</font><font color="#000080">));
  </font><font color="#FF0000"><b>until </b></font>keypressed<font color="#000080">;
  </font>TextMode<font color="#000080">(</font><font color="#800000">3</font><font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to GRAPHICS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0264.PAS">Original</a><b>]</b></p></body>
</html>
