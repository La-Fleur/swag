<html>
<head><title> "Misc Graphic Functions" by GREG ESTABROOKS</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to GRAPHICS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0068.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#FF0000"><b>UNIT </b></font>GrStuff<font color="#000080">;       </font><font color="#008000"><i>{  Misc Graphic Functions, Last Updated  Nov 11/93 }
                    {  Copyright (C), Greg Estabrooks, 1993            }

</i></font><font color="#FF0000"><b>INTERFACE
</b></font><font color="#008000"><i>(***********************************************************************)

</i></font><font color="#FF0000"><b>FUNCTION </b></font>MonitorType <font color="#000080">:</font>BYTE<font color="#000080">;               </font><font color="#008000"><i>{  Determines Monitor In Use  }
</i></font><font color="#FF0000"><b>PROCEDURE </b></font>SetVidMode<font color="#000080">( </font>Mode <font color="#000080">:</font>BYTE <font color="#000080">);       </font><font color="#008000"><i>{  Set video mode             }
</i></font><font color="#FF0000"><b>PROCEDURE </b></font>SetPage<font color="#000080">( </font>Page <font color="#000080">:</font>BYTE <font color="#000080">);          </font><font color="#008000"><i>{  Set current screen page    }
</i></font><font color="#FF0000"><b>PROCEDURE </b></font>BiosPutPix<font color="#000080">( </font>Col<font color="#000080">,</font>Page <font color="#000080">:</font>BYTE<font color="#000080">;</font>X<font color="#000080">,</font>Y <font color="#000080">:</font>WORD <font color="#000080">); </font><font color="#008000"><i>{ Plot pixel at X,Y   }
</i></font><font color="#FF0000"><b>FUNCTION </b></font>TSeng <font color="#000080">:</font>BOOLEAN<font color="#000080">;        </font><font color="#008000"><i>{  Determine if graph card a TSENG labs }
</i></font><font color="#FF0000"><b>FUNCTION </b></font>GetVideoMode <font color="#000080">:</font>BYTE<font color="#000080">;
                      </font><font color="#008000"><i>{  Routine to determine current video mode        }
</i></font><font color="#FF0000"><b>PROCEDURE </b></font>Set80x30Mode<font color="#000080">;
</font><font color="#FF0000"><b>PROCEDURE </b></font>DrawBar<font color="#000080">( </font>X1<font color="#000080">,</font>Y1<font color="#000080">,</font>X2<font color="#000080">,</font>Y2 <font color="#000080">:</font>WORD<font color="#000080">; </font>Color <font color="#000080">:</font>BYTE <font color="#000080">);
</font><font color="#FF0000"><b>PROCEDURE </b></font>SetColor<font color="#000080">( </font>Color2Set<font color="#000080">, </font>Red<font color="#000080">, </font>Green<font color="#000080">, </font>Blue <font color="#000080">:</font>BYTE <font color="#000080">);
</font><font color="#FF0000"><b>PROCEDURE </b></font>GetColor<font color="#000080">( </font>Color2Get <font color="#000080">:</font>BYTE<font color="#000080">; </font><font color="#FF0000"><b>VAR </b></font>Red<font color="#000080">,</font>Green<font color="#000080">,</font>Blue <font color="#000080">:</font>BYTE <font color="#000080">);

</font><font color="#FF0000"><b>IMPLEMENTATION
</b></font><font color="#008000"><i>(***********************************************************************)
</i></font><font color="#FF0000"><b>FUNCTION </b></font>MonitorType <font color="#000080">:</font>BYTE<font color="#000080">; </font><font color="#FF0000"><b>ASSEMBLER</b></font><font color="#000080">;
                           </font><font color="#008000"><i>{  Determines Type of Monitor In Use.        }
</i></font><font color="#FF0000"><b>ASM
  </b></font><font color="#FF00FF">Mov AH,$1A                    </font><font color="#008000"><i>{  Function Determine Display Code      }
  </i></font><font color="#FF00FF">Mov AL,0                      </font><font color="#008000"><i>{  AL,0 = Read Code  AL,1 = Set Code    }
  </i></font><font color="#FF00FF">Int $10                       </font><font color="#008000"><i>{  Call Dos                             }
  </i></font><font color="#FF00FF">Mov AL,BL;                    </font><font color="#008000"><i>{  Move result to proper register       }
        {  0 - no Display       4 - Ega Standard Color     7 - VGA MONO }
        {  1 - MDA              5 - Ega MonoChrome         8 - VGA      }
        {  2 - CGA              6 - PGA                                 }
</i></font><font color="#FF0000"><b>END</b></font><font color="#000080">;</font><font color="#008000"><i>{MonitorType}

</i></font><font color="#FF0000"><b>PROCEDURE </b></font>SetVidMode<font color="#000080">( </font>Mode <font color="#000080">:</font>BYTE <font color="#000080">); </font><font color="#FF0000"><b>ASSEMBLER</b></font><font color="#000080">;
                </font><font color="#008000"><i>{  Routine to set video mode                            }
</i></font><font color="#FF0000"><b>ASM
  </b></font><font color="#FF00FF">Mov AH,00                     </font><font color="#008000"><i>{  Function to set mode                 }
  </i></font><font color="#FF00FF">Mov AL,Mode                   </font><font color="#008000"><i>{  Mode to change to                    }
  </i></font><font color="#FF00FF">Int $10                       </font><font color="#008000"><i>{  Call dos                             }
</i></font><font color="#FF0000"><b>END</b></font><font color="#000080">;</font><font color="#008000"><i>{SetVidMode}

</i></font><font color="#FF0000"><b>PROCEDURE </b></font>SetPage<font color="#000080">( </font>Page <font color="#000080">:</font>BYTE <font color="#000080">); </font><font color="#FF0000"><b>ASSEMBLER</b></font><font color="#000080">;
                </font><font color="#008000"><i>{  Routine to change screen pages                       }
</i></font><font color="#FF0000"><b>ASM
  </b></font><font color="#FF00FF">Mov AH,$05                    </font><font color="#008000"><i>{  Function to change pages             }
  </i></font><font color="#FF00FF">Mov AL,Page                   </font><font color="#008000"><i>{  Page to change to                    }
  </i></font><font color="#FF00FF">Int $10                       </font><font color="#008000"><i>{  Call dos                             }
</i></font><font color="#FF0000"><b>END</b></font><font color="#000080">;</font><font color="#008000"><i>{SetPage}

</i></font><font color="#FF0000"><b>PROCEDURE </b></font>BiosPutPix<font color="#000080">( </font>Col<font color="#000080">,</font>Page <font color="#000080">:</font>BYTE<font color="#000080">; </font>X<font color="#000080">,</font>Y <font color="#000080">:</font>WORD <font color="#000080">); </font><font color="#FF0000"><b>ASSEMBLER</b></font><font color="#000080">;
                </font><font color="#008000"><i>{  Routine to plot a pixel on the screen using INT 10h. }
</i></font><font color="#FF0000"><b>ASM
  </b></font><font color="#FF00FF">Mov AH,$0C                    </font><font color="#008000"><i>{  Function to plot a pixel             }
  </i></font><font color="#FF00FF">Mov AL,Col                    </font><font color="#008000"><i>{  Color to make it                     }
  </i></font><font color="#FF00FF">Mov BH,Page;                  </font><font color="#008000"><i>{  Page to write it to                  }
  </i></font><font color="#FF00FF">Mov CX,X                      </font><font color="#008000"><i>{  Column to put it at                  }
  </i></font><font color="#FF00FF">Mov DX,Y                      </font><font color="#008000"><i>{  Row to place it                      }
  </i></font><font color="#FF00FF">Int $10                       </font><font color="#008000"><i>{  call dos                             }
</i></font><font color="#FF0000"><b>END</b></font><font color="#000080">;</font><font color="#008000"><i>{BiosPutPix}

</i></font><font color="#FF0000"><b>FUNCTION </b></font>TSeng <font color="#000080">:</font>BOOLEAN<font color="#000080">;
                </font><font color="#008000"><i>{  Routine to determine if Graphics card is a TSENG labs}
</i></font><font color="#FF0000"><b>VAR
        </b></font>Old<font color="#000080">,</font>New <font color="#000080">:</font>BYTE<font color="#000080">;
</font><font color="#FF0000"><b>BEGIN
  </b></font>Old <font color="#000080">:= </font>Port<font color="#000080">[</font><font color="#800000">$3CD</font><font color="#000080">];            </font><font color="#008000"><i>{  Save original card register value    }
  </i></font>Port<font color="#000080">[</font><font color="#800000">$3CD</font><font color="#000080">] := </font><font color="#800000">$55</font><font color="#000080">;            </font><font color="#008000"><i>{  change it                            }
  </i></font>New <font color="#000080">:= </font>Port<font color="#000080">[</font><font color="#800000">$3CD</font><font color="#000080">];            </font><font color="#008000"><i>{  read in new value                    }
  </i></font>Port<font color="#000080">[</font><font color="#800000">$3CD</font><font color="#000080">] := </font>Old<font color="#000080">;            </font><font color="#008000"><i>{  restore old value                    }
  </i></font>TSENG <font color="#000080">:= ( </font>New <font color="#000080">= </font><font color="#800000">$55 </font><font color="#000080">);       </font><font color="#008000"><i>{  if value same as what we sent (TRUE) }
</i></font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>FUNCTION </b></font>GetVideoMode <font color="#000080">:</font>BYTE<font color="#000080">; </font><font color="#FF0000"><b>ASSEMBLER</b></font><font color="#000080">;
                      </font><font color="#008000"><i>{  Routine to determine current video mode        }
</i></font><font color="#FF0000"><b>ASM
  </b></font><font color="#FF00FF">Mov AX,$0F00                  </font><font color="#008000"><i>{  SubFunction Return Video Info        }
  </i></font><font color="#FF00FF">Int $10                       </font><font color="#008000"><i>{  Call Dos                             }
</i></font><font color="#FF0000"><b>END</b></font><font color="#000080">;</font><font color="#008000"><i>{GetVideoMode}

</i></font><font color="#FF0000"><b>PROCEDURE </b></font>Set80x30Mode<font color="#000080">;
</font><font color="#FF0000"><b>VAR </b></font>CrtcReg<font color="#000080">:</font><font color="#FF0000"><b>ARRAY</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">8</font><font color="#000080">] </font><font color="#FF0000"><b>OF </b></font>WORD<font color="#000080">;
    </font>Offset <font color="#000080">:</font>WORD<font color="#000080">;
    </font>I<font color="#000080">,</font>Data <font color="#000080">:</font>BYTE<font color="#000080">;
</font><font color="#FF0000"><b>BEGIN
  </b></font>CrtcReg<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">]:=</font><font color="#800000">$0C11</font><font color="#000080">;           </font><font color="#008000"><i>{Vertical Display End (unprotect regs. 0-7)}
  </i></font>CrtcReg<font color="#000080">[</font><font color="#800000">2</font><font color="#000080">]:=</font><font color="#800000">$0D06</font><font color="#000080">;           </font><font color="#008000"><i>{Vertical Total}
  </i></font>CrtcReg<font color="#000080">[</font><font color="#800000">3</font><font color="#000080">]:=</font><font color="#800000">$3E07</font><font color="#000080">;           </font><font color="#008000"><i>{Overflow}
  </i></font>CrtcReg<font color="#000080">[</font><font color="#800000">4</font><font color="#000080">]:=</font><font color="#800000">$EA10</font><font color="#000080">;           </font><font color="#008000"><i>{Vertical Retrace Start}
  </i></font>CrtcReg<font color="#000080">[</font><font color="#800000">5</font><font color="#000080">]:=</font><font color="#800000">$8C11</font><font color="#000080">;           </font><font color="#008000"><i>{Vertical Retrace End (&amp; protect regs. 0-7)}
  </i></font>CrtcReg<font color="#000080">[</font><font color="#800000">6</font><font color="#000080">]:=</font><font color="#800000">$DF12</font><font color="#000080">;           </font><font color="#008000"><i>{Vertical Display Enable End}
  </i></font>CrtcReg<font color="#000080">[</font><font color="#800000">7</font><font color="#000080">]:=</font><font color="#800000">$E715</font><font color="#000080">;           </font><font color="#008000"><i>{Start Vertical Blanking}
  </i></font>CrtcReg<font color="#000080">[</font><font color="#800000">8</font><font color="#000080">]:=</font><font color="#800000">$0616</font><font color="#000080">;           </font><font color="#008000"><i>{End Vertical Blanking}

  </i></font>MemW<font color="#000080">[</font><font color="#800000">$0040</font><font color="#000080">:</font><font color="#800000">$004C</font><font color="#000080">]:=</font><font color="#800000">8192</font><font color="#000080">;     </font><font color="#008000"><i>{Change page size in bytes}
  </i></font>Mem<font color="#000080">[</font><font color="#800000">$0040</font><font color="#000080">:</font><font color="#800000">$0084</font><font color="#000080">]:=</font><font color="#800000">29</font><font color="#000080">;        </font><font color="#008000"><i>{Change page length}
  </i></font>Offset<font color="#000080">:=</font>MemW<font color="#000080">[</font><font color="#800000">$0040</font><font color="#000080">:</font><font color="#800000">$0063</font><font color="#000080">];   </font><font color="#008000"><i>{Base of CRTRC}
  </i></font><font color="#FF0000"><b>ASM
    </b></font><font color="#FF00FF">Cli                        </font><font color="#008000"><i>{Clear Interrupts}
  </i></font><font color="#FF0000"><b>END</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>FOR </b></font>I<font color="#000080">:=</font><font color="#800000">1 </font><font color="#FF0000"><b>TO </b></font><font color="#800000">8 </font><font color="#FF0000"><b>DO
    </b></font>PortW<font color="#000080">[</font>Offset<font color="#000080">]:=</font>CrtcReg<font color="#000080">[</font>i<font color="#000080">]; </font><font color="#008000"><i>{Load Registers}

  </i></font>Data<font color="#000080">:=</font>PORT<font color="#000080">[</font><font color="#800000">$03CC</font><font color="#000080">];
  </font>Data<font color="#000080">:=</font>Data <font color="#FF0000"><b>AND </b></font><font color="#800000">$33</font><font color="#000080">;
  </font>Data<font color="#000080">:=</font>Data <font color="#FF0000"><b>OR </b></font><font color="#800000">$C4</font><font color="#000080">;
  </font>PORT<font color="#000080">[</font><font color="#800000">$03c2</font><font color="#000080">]:=</font>Data<font color="#000080">;
  </font><font color="#FF0000"><b>ASM
   </b></font><font color="#FF00FF">Sti                         </font><font color="#008000"><i>{Set Interrupts}
   </i></font><font color="#FF00FF">Mov AH,12h                  </font><font color="#008000"><i>{Select alternate printing routine}
   </i></font><font color="#FF00FF">Mov BL,20h
   Int 10h
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>{Of Procedure}

</i></font><font color="#FF0000"><b>PROCEDURE </b></font>DrawBar<font color="#000080">( </font>X1<font color="#000080">,</font>Y1<font color="#000080">,</font>X2<font color="#000080">,</font>Y2 <font color="#000080">:</font>WORD<font color="#000080">; </font>Color <font color="#000080">:</font>BYTE <font color="#000080">);
                   </font><font color="#008000"><i>{ Bar drawing routine. Specifically set up for mode  }
                   { 13h. Much faster than the BGI one.                 }
</i></font><font color="#FF0000"><b>VAR
   </b></font>Row     <font color="#000080">:</font>WORD<font color="#000080">;
</font><font color="#FF0000"><b>BEGIN
  FOR </b></font>Row <font color="#000080">:= </font>Y1 <font color="#FF0000"><b>TO </b></font>Y2 <font color="#FF0000"><b>DO
    </b></font>FillChar<font color="#000080">(</font>MEM<font color="#000080">[</font><font color="#800000">$A000</font><font color="#000080">:(</font><font color="#800000">320</font><font color="#000080">*</font>Row<font color="#000080">)+</font>X1<font color="#000080">],</font>X2<font color="#000080">-</font>X1<font color="#000080">,</font>Color<font color="#000080">);
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;


</font><font color="#FF0000"><b>PROCEDURE </b></font>SetColor<font color="#000080">( </font>Color2Set<font color="#000080">, </font>Red<font color="#000080">, </font>Green<font color="#000080">, </font>Blue <font color="#000080">:</font>BYTE <font color="#000080">);
                    </font><font color="#008000"><i>{ Routine to Change the palette value of Color2Set. }
</i></font><font color="#FF0000"><b>BEGIN
    </b></font>PORT<font color="#000080">[</font><font color="#800000">$3C8</font><font color="#000080">] := </font>Color2Set<font color="#000080">;
    </font>PORT<font color="#000080">[</font><font color="#800000">$3C9</font><font color="#000080">] := </font>Red<font color="#000080">;
    </font>PORT<font color="#000080">[</font><font color="#800000">$3C9</font><font color="#000080">] := </font>Green<font color="#000080">;
    </font>PORT<font color="#000080">[</font><font color="#800000">$3C9</font><font color="#000080">] := </font>Blue<font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>PROCEDURE </b></font>GetColor<font color="#000080">( </font>Color2Get <font color="#000080">:</font>BYTE<font color="#000080">; </font><font color="#FF0000"><b>VAR </b></font>Red<font color="#000080">,</font>Green<font color="#000080">,</font>Blue <font color="#000080">:</font>BYTE <font color="#000080">);
                    </font><font color="#008000"><i>{ Routine to determine the Palette value of Color2Get}
</i></font><font color="#FF0000"><b>BEGIN
    </b></font>PORT<font color="#000080">[</font><font color="#800000">$3C8</font><font color="#000080">] := </font>Color2Get<font color="#000080">;
    </font>Red <font color="#000080">:= </font>PORT<font color="#000080">[</font><font color="#800000">$3C9</font><font color="#000080">];
    </font>Green <font color="#000080">:= </font>PORT<font color="#000080">[</font><font color="#800000">$3C9</font><font color="#000080">];
    </font>Blue <font color="#000080">:= </font>PORT<font color="#000080">[</font><font color="#800000">$3C9</font><font color="#000080">];
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>BEGIN
END</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to GRAPHICS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0068.PAS">Original</a><b>]</b></p></body>
</html>
