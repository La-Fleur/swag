<html>
<head><title> "Show Mono PCX file" by ROB HARBERS</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to GRAPHICS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0158.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#FF0000"><b>Program </b></font>Display<font color="#000080">;

</font><font color="#FF0000"><b>Uses </b></font>Crt<font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>loadpcx<font color="#000080">(</font>fname<font color="#000080">:</font><font color="#FF0000"><b>string</b></font><font color="#000080">);
</font><font color="#FF0000"><b>var </b></font>f             <font color="#000080">: </font><font color="#FF0000"><b>file </b></font><font color="#000080">;
    </font>buf           <font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">16</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">;
    </font>pcxdata<font color="#000080">,</font>palet <font color="#000080">: </font>pointer <font color="#000080">;
    </font>pcxlen        <font color="#000080">: </font>word<font color="#000080">;

</font><font color="#FF0000"><b>begin
   </b></font>assign<font color="#000080">(</font>f<font color="#000080">,</font>fname<font color="#000080">);
   </font><font color="#008000"><i>{$I-}
   </i></font>reset<font color="#000080">(</font>f<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">);
   </font><font color="#FF0000"><b>if </b></font>ioresult<font color="#000080">&lt;&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>exit<font color="#000080">; </font><font color="#008000"><i>{ couldnt open file}
   </i></font>blockread<font color="#000080">(</font>f<font color="#000080">,</font>buf<font color="#000080">,</font><font color="#800000">16</font><font color="#000080">);
   </font><font color="#FF0000"><b>if </b></font>ioresult<font color="#000080">&lt;&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>exit<font color="#000080">; </font><font color="#008000"><i>{ Read error }
   </i></font><font color="#FF0000"><b>if </b></font>buf<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">]&lt;&gt;</font><font color="#800000">$0a </font><font color="#FF0000"><b>then </b></font>exit<font color="#000080">;  </font><font color="#008000"><i>{no pcx file}
   </i></font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>buf<font color="#000080">[</font><font color="#800000">2</font><font color="#000080">]&lt;&gt;</font><font color="#800000">5</font><font color="#000080">) </font><font color="#FF0000"><b>or </b></font><font color="#000080">(</font>buf<font color="#000080">[</font><font color="#800000">4</font><font color="#000080">]&lt;&gt;</font><font color="#800000">8</font><font color="#000080">) </font><font color="#FF0000"><b>then </b></font>exit<font color="#000080">; </font><font color="#008000"><i>{no 256 colors}
   </i></font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>buf<font color="#000080">[</font><font color="#800000">13</font><font color="#000080">]&lt;&gt;</font><font color="#800000">$40</font><font color="#000080">) </font><font color="#FF0000"><b>or </b></font><font color="#000080">(</font>buf<font color="#000080">[</font><font color="#800000">14</font><font color="#000080">]&lt;&gt;</font><font color="#800000">$01</font><font color="#000080">) </font><font color="#FF0000"><b>or </b></font><font color="#000080">(</font>buf<font color="#000080">[</font><font color="#800000">15</font><font color="#000080">]&lt;&gt;</font><font color="#800000">$c8</font><font color="#000080">) </font><font color="#FF0000"><b>or </b></font><font color="#000080">(</font>buf<font color="#000080">[</font><font color="#800000">16</font><font color="#000080">]&lt;&gt;</font><font color="#800000">0</font><font color="#000080">)
   </font><font color="#FF0000"><b>then </b></font>Exit<font color="#000080">;

   </font>pcxlen<font color="#000080">:=</font>filesize<font color="#000080">(</font>f<font color="#000080">)-</font><font color="#800000">128</font><font color="#000080">-</font><font color="#800000">768</font><font color="#000080">;
   </font>getmem<font color="#000080">(</font>pcxdata<font color="#000080">,</font>pcxlen<font color="#000080">);
   </font>seek<font color="#000080">(</font>f<font color="#000080">,</font><font color="#800000">128</font><font color="#000080">);
   </font>blockread<font color="#000080">(</font>f<font color="#000080">,</font>pcxdata<font color="#000080">^,</font>pcxlen<font color="#000080">);
   </font><font color="#FF0000"><b>if </b></font>ioresult<font color="#000080">&lt;&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>exit<font color="#000080">;
   </font><font color="#008000"><i>{$I+}
{---- read body ----}
   </i></font><font color="#FF0000"><b>asm
     </b></font><font color="#FF00FF">push ds
     Mov DI,$A000
     Mov ES,DI
     And Di,0
     lds si,pcxdata
     mov bx,di
     add bx,64000
@nextpcxbyte:
     mov al,[si]
     inc si
     mov cl,al
     and cl,$c0
     cmp cl,$c0
     je @herhaling
     mov cl,1
@verder:
     rep stosb
     cmp di,bx
     je @</font><font color="#FF0000"><b>end
     </b></font>jmp <font color="#000080">@</font>nextpcxbyte
<font color="#000080">@</font>herhaling<font color="#000080">:
     </font>mov cl<font color="#000080">,</font>al
     <font color="#FF0000"><b>and </b></font>cl<font color="#000080">,</font><font color="#800000">$3f
     </font>mov al<font color="#000080">,[</font>si<font color="#000080">] ; </font>inc si
     jmp <font color="#000080">@</font>verder
<font color="#000080">@</font><font color="#FF0000"><b>end</b></font><font color="#000080">: </font>pop ds
   <font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{-------- read palette --------}
      </i></font>seek<font color="#000080">(</font>f<font color="#000080">,</font>filesize<font color="#000080">(</font>f<font color="#000080">)-</font><font color="#800000">768</font><font color="#000080">);
      </font>GetMem<font color="#000080">(</font>palet<font color="#000080">,</font><font color="#800000">768</font><font color="#000080">);
      </font>blockread<font color="#000080">(</font>f<font color="#000080">,</font>palet<font color="#000080">^,</font><font color="#800000">768</font><font color="#000080">);
      </font><font color="#FF0000"><b>if </b></font>ioresult<font color="#000080">&lt;&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>exit<font color="#000080">;
      </font><font color="#FF0000"><b>asm
        </b></font><font color="#FF00FF">les di,palet
           mov ax,768
        mov cl,2
       @1:
        shr es:[di],cl
        inc di
        dec ax
           jnz @1
        mov ax,$1012
        mov bx,0
        mov cx,255;
        les dx,palet
        int $10
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
   </font>close<font color="#000080">(</font>f<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Begin

  Asm </b></font><font color="#FF00FF">Mov AX,$13; Int $10 </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>IF </b></font>Paramcount <font color="#000080">&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>THEN
     BEGIN
     </b></font>LoadPcx<font color="#000080">(</font>ParamStr<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">));
     </font>ReadLn<font color="#000080">;
     </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>Asm </b></font><font color="#FF00FF">Mov AX,$3; Int $10 </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>End</b></font><font color="#000080">.

</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to GRAPHICS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0158.PAS">Original</a><b>]</b></p></body>
</html>
