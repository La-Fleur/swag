<html>
<head><title> "Graphics In Assembler" by JANI ALANEN</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to GRAPHICS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0195.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
 AL&gt; Does anyone have any basic graphics routines in assembler that I
 AL&gt; could learn from. ie. graphics mode asm
 AL&gt; int 13h
 AL&gt; mov DX, ??
 AL&gt; end

That would be something like:
        ASM
           mov  ax,0013h
           int  10h
        END;


Here's some routines I've been using for awhile:
------------------------------ CUT --------------------------------------- }
{                   A simple
graphics unit.                           }{ Routines by Denthor of Asphyxia,
Vassago and Cenor of Fata Morgana. } {          Feel free to use these
routines. Have fun!                 }
</i></font><font color="#FF0000"><b>UNIT </b></font>GFX<font color="#000080">;

</font><font color="#FF0000"><b>INTERFACE

USES </b></font>Crt<font color="#000080">;

</font><font color="#FF0000"><b>CONST </b></font>VGA <font color="#000080">= </font><font color="#800000">$A000</font><font color="#000080">;

</font><font color="#FF0000"><b>TYPE Virtual </b></font><font color="#000080">= </font><font color="#FF0000"><b>Array </b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">64000</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">;  </font><font color="#008000"><i>{ The size of our Virtual Screen }
     </i></font>VirtPtr <font color="#000080">= ^</font><font color="#FF0000"><b>Virtual</b></font><font color="#000080">;                  </font><font color="#008000"><i>{ Pointer to the virtual screen }

</i></font><font color="#FF0000"><b>PROCEDURE </b></font>Paint<font color="#000080">( </font>StartPoint<font color="#000080">,</font>EndPoint <font color="#000080">, </font>From<font color="#000080">, </font>Dest <font color="#000080">: </font>Word <font color="#000080">);
   </font><font color="#008000"><i>{ Paints screen over another one, doesn't handle color 0 }
</i></font><font color="#FF0000"><b>PROCEDURE </b></font>ScrollUp<font color="#000080">(</font>Where<font color="#000080">:</font>Word<font color="#000080">);
   </font><font color="#008000"><i>{ Scrolls screen up, fast with virtualscreen }
</i></font><font color="#FF0000"><b>PROCEDURE </b></font>ScrollUp2<font color="#000080">(</font>Where<font color="#000080">:</font>Word<font color="#000080">);
   </font><font color="#008000"><i>{ Scrolls screen up, faster when virtualscreen are not used }
</i></font><font color="#FF0000"><b>PROCEDURE </b></font>ShutDown<font color="#000080">;
   </font><font color="#008000"><i>{ This frees the memory used by the virtual screen }
</i></font><font color="#FF0000"><b>PROCEDURE </b></font>SetUpVirtual<font color="#000080">;
   </font><font color="#008000"><i>{ This sets up the memory needed for the virtual screen }
</i></font><font color="#FF0000"><b>PROCEDURE </b></font>Cls <font color="#000080">(</font>Where<font color="#000080">:</font>word<font color="#000080">;</font>Col <font color="#000080">: </font>Byte<font color="#000080">);
   </font><font color="#008000"><i>{ This clears the screen to the specified color }
</i></font><font color="#FF0000"><b>PROCEDURE </b></font>Flip <font color="#000080">(</font>source<font color="#000080">,</font>dest<font color="#000080">:</font>Word<font color="#000080">);
  </font><font color="#008000"><i>{ This copies the entire screen at &quot;source&quot; to destination }
</i></font><font color="#FF0000"><b>PROCEDURE </b></font>Pal <font color="#000080">(</font>Col<font color="#000080">,</font>R<font color="#000080">,</font>G<font color="#000080">,</font>B <font color="#000080">: </font>Byte<font color="#000080">);
  </font><font color="#008000"><i>{ This sets the Red, Green and Blue values of a certain color }
</i></font><font color="#FF0000"><b>PROCEDURE </b></font>GetPal <font color="#000080">(</font>Col <font color="#000080">: </font>Byte<font color="#000080">; </font><font color="#FF0000"><b>Var </b></font>R<font color="#000080">,</font>G<font color="#000080">,</font>B <font color="#000080">: </font>Byte<font color="#000080">);
  </font><font color="#008000"><i>{ This gets the Red, Green and Blue values of a certain color }
</i></font><font color="#FF0000"><b>PROCEDURE </b></font>Putpixel <font color="#000080">(</font>X<font color="#000080">,</font>Y <font color="#000080">: </font>Integer<font color="#000080">; </font>Col <font color="#000080">: </font>Byte<font color="#000080">; </font>where<font color="#000080">:</font>word<font color="#000080">);
  </font><font color="#008000"><i>{ This puts pixel directly to memory, fast }
</i></font><font color="#FF0000"><b>FUNCTION  </b></font>Getpixel <font color="#000080">(</font>X<font color="#000080">,</font>Y <font color="#000080">: </font>Integer<font color="#000080">; </font>where<font color="#000080">:</font>word<font color="#000080">):</font>byte<font color="#000080">;
  </font><font color="#008000"><i>{ This gets color of pixel from memory, fast }
</i></font><font color="#FF0000"><b>PROCEDURE </b></font>SetMCGA<font color="#000080">;
  </font><font color="#008000"><i>{ This procedure gets you into 320x200x256 mode. }
</i></font><font color="#FF0000"><b>PROCEDURE </b></font>SetText<font color="#000080">;
  </font><font color="#008000"><i>{ This procedure returns you to text mode.  }
</i></font><font color="#FF0000"><b>PROCEDURE </b></font>WaitRetrace<font color="#000080">;
  </font><font color="#008000"><i>{ Waits fo vertical retrace }

</i></font><font color="#FF0000"><b>VAR    </b></font>Virscr <font color="#000080">: </font>VirtPtr<font color="#000080">;                      </font><font color="#008000"><i>{ 1st Virtual Screen }
       </i></font>VirScr2 <font color="#000080">: </font>VirtPtr<font color="#000080">;                     </font><font color="#008000"><i>{ 2nd Virtual Screen }
       </i></font>VirScr3 <font color="#000080">: </font>VirtPtr<font color="#000080">;                     </font><font color="#008000"><i>{ 3rd Virtual Screen }
       </i></font>VirtualScreen1  <font color="#000080">: </font>word<font color="#000080">;                </font><font color="#008000"><i>{ Virtual Screen 1. seg }
       </i></font>VirtualScreen2 <font color="#000080">: </font>Word<font color="#000080">;                 </font><font color="#008000"><i>{ Virtual Screen 2. seg }
       </i></font>VirtualScreen3 <font color="#000080">: </font>Word<font color="#000080">;                 </font><font color="#008000"><i>{ Virtual Screen 3. seg }

       </i></font>Palette<font color="#000080">,</font>Palette2 <font color="#000080">: </font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">255</font><font color="#000080">,</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">3</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Byte<font color="#000080">;
       </font>Scr_Ofs <font color="#000080">: </font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">199</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Word<font color="#000080">;

</font><font color="#FF0000"><b>IMPLEMENTATION

PROCEDURE </b></font>Paint<font color="#000080">( </font>StartPoint<font color="#000080">,</font>EndPoint <font color="#000080">, </font>From<font color="#000080">, </font>Dest <font color="#000080">: </font>Word <font color="#000080">); </font><font color="#FF0000"><b>BEGIN</b></font><font color="#000080">;
      </font>StartPoint<font color="#000080">:=</font>StartPoint<font color="#000080">*</font><font color="#800000">320</font><font color="#000080">;
      </font>EndPoint<font color="#000080">:=</font>EndPoint<font color="#000080">*</font><font color="#800000">320</font><font color="#000080">-</font>StartPoint<font color="#000080">;
      </font><font color="#FF0000"><b>ASM
         </b></font><font color="#FF00FF">push    ds
         mov     ax, From
         mov     es, ax
         mov     ax, Dest
         mov     ds, ax
         mov     di, EndPoint
         mov     Cx, StartPoint
      @Looppi:
         mov     Al, Es:[Di]
         cmp     Al, 0
         jz      @Ohi
         mov     Ds:[di], Al
      @Ohi:
         inc     di
         loop    @Looppi
         pop     ds
     </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>PROCEDURE </b></font>ScrollUp<font color="#000080">(</font>Where<font color="#000080">:</font>Word<font color="#000080">); </font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">; </font><font color="#FF0000"><b>ASM
        </b></font><font color="#FF00FF">push    ds
        mov     ax, [Where]
        mov     es, ax
        mov     ax, [Where]
        mov     ds, ax
        mov     Si, 320
        mov     di, 0
        mov     cx, 31840
        rep     movsw
        pop     ds
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>PROCEDURE </b></font>ScrollUp2<font color="#000080">(</font>Where<font color="#000080">:</font>Word<font color="#000080">); </font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">; </font><font color="#FF0000"><b>ASM
        </b></font><font color="#FF00FF">push    ds
        mov     ax, [Where]
        mov     es, ax
        mov     ax, [Where]
        mov     ds, ax
        mov     Si, 320
        mov     di, 0
        mov     cx,15920
        db      0F3h, 66h, 0A5h
        pop     ds
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>ShutDown<font color="#000080">;
   </font><font color="#008000"><i>{ This frees the memory used by the virtual screen }
</i></font><font color="#FF0000"><b>BEGIN
  </b></font>FreeMem <font color="#000080">(</font>VirScr<font color="#000080">,</font><font color="#800000">64000</font><font color="#000080">);
  </font>FreeMem <font color="#000080">(</font>VirScr2<font color="#000080">,</font><font color="#800000">64000</font><font color="#000080">);
  </font>FreeMem <font color="#000080">(</font>VirScr3<font color="#000080">,</font><font color="#800000">64000</font><font color="#000080">);
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;


</font><font color="#FF0000"><b>Procedure </b></font>SetUpVirtual<font color="#000080">;
   </font><font color="#008000"><i>{ This sets up the memory needed for the virtual screen }
</i></font><font color="#FF0000"><b>BEGIN
  </b></font>GetMem <font color="#000080">(</font>VirScr<font color="#000080">,</font><font color="#800000">64000</font><font color="#000080">);
  </font>VirtualScreen1 <font color="#000080">:= </font>seg <font color="#000080">(</font>virscr<font color="#000080">^);
  </font>GetMem <font color="#000080">(</font>VirScr2<font color="#000080">,</font><font color="#800000">64000</font><font color="#000080">);
  </font>VirtualScreen2 <font color="#000080">:= </font>seg <font color="#000080">(</font>virscr2<font color="#000080">^);
  </font>GetMem <font color="#000080">(</font>VirScr3<font color="#000080">,</font><font color="#800000">64000</font><font color="#000080">);
  </font>VirtualScreen3 <font color="#000080">:= </font>seg <font color="#000080">(</font>virscr3<font color="#000080">^);
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>Cls <font color="#000080">(</font>Where<font color="#000080">:</font>word<font color="#000080">;</font>Col <font color="#000080">: </font>Byte<font color="#000080">); </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
   </font><font color="#008000"><i>{ This clears the screen to the specified color }
</i></font><font color="#FF0000"><b>asm
   </b></font><font color="#FF00FF">push    es
   mov     cx, 32000;
   mov     es,[where]
   xor     di,di
   mov     al,[col]
   mov     ah,al
   rep     stosw
   pop     es
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>flip<font color="#000080">(</font>source<font color="#000080">,</font>dest<font color="#000080">:</font>Word<font color="#000080">); </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
  </font><font color="#008000"><i>{ This copies the entire screen at &quot;source&quot; to destination }
</i></font><font color="#FF0000"><b>asm
  </b></font><font color="#FF00FF">push    ds
  mov     ax, [Dest]
  mov     es, ax
  mov     ax, [Source]
  mov     ds, ax
  xor     si, si
  xor     di, di
  mov     cx, 32000
  rep     movsw
  pop     ds
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>Pal<font color="#000080">(</font>Col<font color="#000080">,</font>R<font color="#000080">,</font>G<font color="#000080">,</font>B <font color="#000080">: </font>Byte<font color="#000080">); </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
  </font><font color="#008000"><i>{ This sets the Red, Green and Blue values of a certain color }
</i></font><font color="#FF0000"><b>asm
   </b></font><font color="#FF00FF">mov    dx,3c8h
   mov    al,[col]
   out    dx,al
   inc    dx
   mov    al,[r]
   out    dx,al
   mov    al,[g]
   out    dx,al
   mov    al,[b]
   out    dx,al
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>GetPal<font color="#000080">(</font>Col <font color="#000080">: </font>Byte<font color="#000080">; </font><font color="#FF0000"><b>Var </b></font>R<font color="#000080">,</font>G<font color="#000080">,</font>B <font color="#000080">: </font>Byte<font color="#000080">);
  </font><font color="#008000"><i>{ This gets the Red, Green and Blue values of a certain color }
</i></font><font color="#FF0000"><b>Var
   </b></font>rr<font color="#000080">,</font>gg<font color="#000080">,</font>bb <font color="#000080">: </font>Byte<font color="#000080">;
</font><font color="#FF0000"><b>Begin
   asm
      </b></font><font color="#FF00FF">mov    dx,3c7h
      mov    al,col
      out    dx,al

      add    dx,2

      in     al,dx
      mov    [rr],al
      in     al,dx
      mov    [gg],al
      in     al,dx
      mov    [bb],al
   </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
   </font>r <font color="#000080">:= </font>rr<font color="#000080">;
   </font>g <font color="#000080">:= </font>gg<font color="#000080">;
   </font>b <font color="#000080">:= </font>bb<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>Putpixel <font color="#000080">(</font>X<font color="#000080">,</font>Y <font color="#000080">: </font>Integer<font color="#000080">; </font>Col <font color="#000080">: </font>Byte<font color="#000080">; </font>where<font color="#000080">:</font>word<font color="#000080">); </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
  </font><font color="#008000"><i>{ This puts a pixel on the screen by writing directly to memory. }
</i></font><font color="#FF0000"><b>asm
   </b></font><font color="#FF00FF">mov  ax,where
   mov  es,ax
   mov  bx,[y]
   shl  bx,1
   mov  di,word ptr [Scr_Ofs + bx]
   add  di,[x]
   mov  al,[col]
   mov  es:[di],al
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>Getpixel <font color="#000080">(</font>X<font color="#000080">,</font>Y <font color="#000080">: </font>Integer<font color="#000080">; </font>where<font color="#000080">:</font>word<font color="#000080">):</font>byte<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
  </font><font color="#008000"><i>{ This puts a pixel on the screen by writing directly to memory. }
</i></font><font color="#FF0000"><b>asm
   </b></font><font color="#FF00FF">mov  ax,where
   mov  es,ax
   mov  bx,[y]
   shl  bx,1
   mov  di,word ptr [Scr_Ofs + bx]
   add  di,[x]
   mov  al,es:[di]
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>SetMCGA<font color="#000080">;  </font><font color="#008000"><i>{ This procedure gets you into 320x200x256 mode. } </i></font><font color="#FF0000"><b>BEGIN
  asm
     </b></font><font color="#FF00FF">mov        ax,0013h
     int        10h
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>SetText<font color="#000080">;  </font><font color="#008000"><i>{ This procedure returns you to text mode.  } </i></font><font color="#FF0000"><b>BEGIN
  asm
     </b></font><font color="#FF00FF">mov        ax,0003h
     int        10h
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>WaitRetrace<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
  </font><font color="#008000"><i>{  This waits for a vertical retrace to reduce snow on the screen }
</i></font><font color="#FF0000"><b>label
  </b></font>l1<font color="#000080">, </font>l2<font color="#000080">;
</font><font color="#FF0000"><b>asm
    </b></font><font color="#FF00FF">mov dx,3DAh
l1:
    in al,dx
    and al,08h
    jnz l1
l2:
    in al,dx
    and al,08h
    jz  l2
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>VAR </b></font>Loop1<font color="#000080">:</font>integer<font color="#000080">;

</font><font color="#FF0000"><b>BEGIN
  For </b></font>Loop1 <font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font><font color="#800000">199 </font><font color="#FF0000"><b>do
    </b></font>Scr_Ofs<font color="#000080">[</font>Loop1<font color="#000080">] := </font>Loop1 <font color="#000080">* </font><font color="#800000">320</font><font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to GRAPHICS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0195.PAS">Original</a><b>]</b></p></body>
</html>
