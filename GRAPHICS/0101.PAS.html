<html>
<head><title> "GIF Viewing" by SEAN WENZEL</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to GRAPHICS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0101.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#FF0000"><b>unit </b></font>GifUtil<font color="#000080">;
</font><font color="#008000"><i>{ GifUtl.pas - (c)Copyright 1993 Sean Wenzel
        Users are given the right to use/modify and distribute this source code as
        long as credit is given where due.  I would also ask that anyone who makes
        use of this source/program drop me a line at my CompuServe address of
        71736,1245.  Just curious...

        The unit was written using Borland Pascal v7.0 but I think it should work
        with Turbo Pascal down to 5.5 at the most (or least?).
        This unit has only been tested on my system - an Everex Tempo 386DX
        with its built in SVGA adapter.  If anyone finds/fixes any bugs please
        let me know. (Feel free to send a copy of any code too)
        I have also only tested 3 or 4 256,16, and 2 color interlaced and non-
        interlaced images. (was enough for my needs)


        Some of the code is very loosely based on DECODER.C (availble online)
        so credit should be given to Steven A. Bennett and Steve Wilhite

        The unit is set up to use BGI256.BGI (inlcuded) which is available on CIS
        in the BPASCAL forum library.  The graphics initialization tries to start
        up in 640 by 480 mode.  If an error occurs it'll go down to 320x200
        automatically (well - it should).  For higher res modes change the variable
        GraphMode in the InitGraphics procedure to 3 for 800x600 and 4 for 1024x768.

        A sample program (GIF.PAS) is provided to demostrate the use of this unit.
        Basically declare a pointer to the TGIF object then initialize it using a
        line such as TheGif := New(PGif, Init('agif'));  You can then check
        TheGif^.Status for any errors and/or view the GIF headers and ColorTables.
        To switch to Graphics mode and show the GIF image use TheGif^.Decode(True)
        True tells it to beep when done(or boop if some sort of error occured).  
        When finished use Dispose(TheGif, Done) to switch back to textmode and get 
        rid of the object.


        If anyone cares to speed up the image decoding I'd suggest writing
        TGIF.NextCode in assembler.  The routine is the most heavily called in the
        unit while decoding and on my sytem took up about 5 seconds out of 12 when
        I profiled it. (send me a copy if you can)

        I have practically commented every line so that the source should be very
        readable and easy to follow.  Great for learning about GIF's and LZW 
        decompression.


        Any problems or suggestions drop me a line

        Good luck...
                                                        -Sean

        (almost forgot)
        &quot;The Graphics Interchange Format(c) is the Copyright property of
         CompuServe Incorporated. GIF(sm) is a Service Mark property of
         CompuServe Incorporated.&quot;

}


{$R-}   {       range checking off }  { Put them on if you like but it slows down the}
{$S-} { stack checking off }  { decoding  (almost doubles it!) }
{$I-} { i/o checking off }

</i></font><font color="#FF0000"><b>interface

uses </b></font>Objects<font color="#000080">;

</font><font color="#FF0000"><b>type
        </b></font>TDataSubBlock <font color="#000080">= </font><font color="#FF0000"><b>record
                </b></font>Size<font color="#000080">: </font>byte<font color="#000080">;     </font><font color="#008000"><i>{ size of the block -- 0 to 255 }
                </i></font>Data<font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">255</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">; </font><font color="#008000"><i>{ the data }
        </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>const
        </b></font>BlockTerminator<font color="#000080">: </font>byte <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">; </font><font color="#008000"><i>{ terminates stream of data blocks }

</i></font><font color="#FF0000"><b>type
        </b></font>THeader <font color="#000080">= </font><font color="#FF0000"><b>record
                </b></font>Signature<font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">2</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>char<font color="#000080">; </font><font color="#008000"><i>{ contains 'GIF' }
                </i></font>Version<font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">2</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>char<font color="#000080">;   </font><font color="#008000"><i>{ '87a' or '89a' }
        </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

        </font>TLogicalScreenDescriptor <font color="#000080">= </font><font color="#FF0000"><b>record
                </b></font>ScreenWidth<font color="#000080">: </font>word<font color="#000080">;              </font><font color="#008000"><i>{ logical screen width }
                </i></font>ScreenHeight<font color="#000080">: </font>word<font color="#000080">;  </font><font color="#008000"><i>{ logical screen height }
                </i></font>PackedFields<font color="#000080">: </font>byte<font color="#000080">;     </font><font color="#008000"><i>{ packed fields - see below }
                </i></font>BackGroundColorIndex<font color="#000080">: </font>byte<font color="#000080">;     </font><font color="#008000"><i>{ index to global color table }
                </i></font>AspectRatio<font color="#000080">: </font>byte<font color="#000080">;      </font><font color="#008000"><i>{ actual ratio = (AspectRatio + 15) / 64 }
        </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>const
</b></font><font color="#008000"><i>{ logical screen descriptor packed field masks }
        </i></font>lsdGlobalColorTable <font color="#000080">= </font><font color="#800000">$80</font><font color="#000080">;  </font><font color="#008000"><i>{ set if global color table follows L.S.D. }
        </i></font>lsdColorResolution <font color="#000080">= </font><font color="#800000">$70</font><font color="#000080">;               </font><font color="#008000"><i>{ Color resolution - 3 bits }
        </i></font>lsdSort <font color="#000080">= </font><font color="#800000">$08</font><font color="#000080">;                                                  </font><font color="#008000"><i>{ set if global color table is sorted - 1 bit }
        </i></font>lsdColorTableSize <font color="#000080">= </font><font color="#800000">$07</font><font color="#000080">;                </font><font color="#008000"><i>{ size of global color table - 3 bits }
                                                                                                                        { Actual size = 2^value+1    - value is 3 bits }

</i></font><font color="#FF0000"><b>type
        </b></font>TColorItem <font color="#000080">= </font><font color="#FF0000"><b>record     </b></font><font color="#008000"><i>{ one item a a color table }
                </i></font>Red<font color="#000080">: </font>byte<font color="#000080">;
                </font>Green<font color="#000080">: </font>byte<font color="#000080">;
                </font>Blue<font color="#000080">: </font>byte<font color="#000080">;
        </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

        </font>TColorTable <font color="#000080">= </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">255</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>TColorItem<font color="#000080">;      </font><font color="#008000"><i>{ the color table }

</i></font><font color="#FF0000"><b>const
        </b></font>ImageSeperator<font color="#000080">: </font>byte <font color="#000080">= </font><font color="#800000">$2C</font><font color="#000080">;

</font><font color="#FF0000"><b>type
        </b></font>TImageDescriptor <font color="#000080">= </font><font color="#FF0000"><b>record
                </b></font>Seperator<font color="#000080">: </font>byte<font color="#000080">;                         </font><font color="#008000"><i>{ fixed value of ImageSeperator }
                </i></font>ImageLeftPos<font color="#000080">: </font>word<font color="#000080">; </font><font color="#008000"><i>{Column in pixels in respect to left edge of logical screen }
                </i></font>ImageTopPos<font color="#000080">: </font>word<font color="#000080">;</font><font color="#008000"><i>{row in pixels in respect to top of logical screen }
                </i></font>ImageWidth<font color="#000080">: </font>word<font color="#000080">;       </font><font color="#008000"><i>{ width of image in pixels }
                </i></font>ImageHeight<font color="#000080">: </font>word<font color="#000080">;      </font><font color="#008000"><i>{ height of image in pixels }
                </i></font>PackedFields<font color="#000080">: </font>byte<font color="#000080">; </font><font color="#008000"><i>{ see below }
        </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>const
        </b></font><font color="#008000"><i>{ image descriptor bit masks }
                </i></font>idLocalColorTable <font color="#000080">= </font><font color="#800000">$80</font><font color="#000080">; </font><font color="#008000"><i>{ set if a local color table follows }
                </i></font>idInterlaced <font color="#000080">= </font><font color="#800000">$40</font><font color="#000080">;                      </font><font color="#008000"><i>{ set if image is interlaced }
                </i></font>idSort <font color="#000080">= </font><font color="#800000">$20</font><font color="#000080">;                                            </font><font color="#008000"><i>{ set if color table is sorted }
                </i></font>idReserved <font color="#000080">= </font><font color="#800000">$0C</font><font color="#000080">;                                </font><font color="#008000"><i>{ reserved - must be set to $00 }
                </i></font>idColorTableSize <font color="#000080">= </font><font color="#800000">$07</font><font color="#000080">;  </font><font color="#008000"><i>{ size of color table as above }

        </i></font>Trailer<font color="#000080">: </font>byte <font color="#000080">= </font><font color="#800000">$3B</font><font color="#000080">;    </font><font color="#008000"><i>{ indicates the end of the GIF data stream }

{ other extension blocks not currently supported by this unit
        - Graphic Control extension
        - Comment extension           I'm not sure what will happen if these blocks
        - Plain text extension        are encountered but it'll be interesting
        - application extension }

</i></font><font color="#FF0000"><b>const
        </b></font>ExtensionIntroducer<font color="#000080">: </font>byte <font color="#000080">= </font><font color="#800000">$21</font><font color="#000080">;
        </font>MAXSCREENWIDTH <font color="#000080">= </font><font color="#800000">800</font><font color="#000080">;

</font><font color="#FF0000"><b>type
        </b></font>TExtensionBlock <font color="#000080">= </font><font color="#FF0000"><b>record
                </b></font>Introducer<font color="#000080">: </font>byte<font color="#000080">;                               </font><font color="#008000"><i>{ fixed value of ExtensionIntroducer }
                </i></font>ExtensionLabel<font color="#000080">: </font>byte<font color="#000080">;
                </font>BlockSize<font color="#000080">: </font>byte<font color="#000080">;
        </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

        </font>PCodeItem <font color="#000080">= ^</font>TCodeItem<font color="#000080">;
        </font>TCodeItem <font color="#000080">= </font><font color="#FF0000"><b>record
                </b></font>Code1<font color="#000080">, </font>Code2<font color="#000080">: </font>byte<font color="#000080">;
        </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>const
        </b></font>MAXCODES <font color="#000080">= </font><font color="#800000">4095</font><font color="#000080">;        </font><font color="#008000"><i>{ the maximum number of different codes 0 inclusive }



</i></font><font color="#FF0000"><b>type
        </b></font><font color="#008000"><i>{ This is the actual gif object }
        </i></font>PGif <font color="#000080">= ^</font>TGif<font color="#000080">;
        </font>TGif <font color="#000080">= </font><font color="#FF0000"><b>object</b></font><font color="#000080">(</font>TObject<font color="#000080">)
                </font>Stream<font color="#000080">: </font>PBufStream<font color="#000080">;                                                                     </font><font color="#008000"><i>{ the file stream for the gif file }
                </i></font>Header<font color="#000080">: </font>THeader<font color="#000080">;                                                                                </font><font color="#008000"><i>{ gif file header }
                </i></font>LogicalScreen<font color="#000080">: </font>TLogicalScreenDescriptor<font color="#000080">;  </font><font color="#008000"><i>{ gif screen descriptor }
                </i></font>GlobalColorTable<font color="#000080">: </font>TColorTable<font color="#000080">;            </font><font color="#008000"><i>{ global color table }
                </i></font>LocalColorTable<font color="#000080">: </font>TColorTable<font color="#000080">;             </font><font color="#008000"><i>{ local color table }
                </i></font>ImageDescriptor<font color="#000080">: </font>TImageDescriptor<font color="#000080">;        </font><font color="#008000"><i>{ image descriptor }
                </i></font>UseLocalColors<font color="#000080">: </font>boolean<font color="#000080">;                  </font><font color="#008000"><i>{ true if local colors in use }
                </i></font>Interlaced<font color="#000080">: </font>boolean<font color="#000080">;                      </font><font color="#008000"><i>{ true if image is interlaced }
                </i></font>LZWCodeSize<font color="#000080">: </font>byte<font color="#000080">;                       </font><font color="#008000"><i>{ minimum size of the LZW codes in bits }
                </i></font>ImageData<font color="#000080">: </font>TDataSubBlock<font color="#000080">;                </font><font color="#008000"><i>{ variable to store incoming gif data }
                </i></font>TableSize<font color="#000080">: </font>word<font color="#000080">;                                                 </font><font color="#008000"><i>{ number of entrys in the color table }
                </i></font>BitsLeft<font color="#000080">, </font>BytesLeft<font color="#000080">: </font>integer<font color="#000080">;</font><font color="#008000"><i>{ bits left in byte - bytes left in block }
                </i></font>BadCodeCount<font color="#000080">: </font>word<font color="#000080">;          </font><font color="#008000"><i>{ bad code counter }
                </i></font>CurrCodeSize<font color="#000080">: </font>integer<font color="#000080">;       </font><font color="#008000"><i>{ Current size of code in bits }
                </i></font>ClearCode<font color="#000080">: </font>integer<font color="#000080">;          </font><font color="#008000"><i>{ Clear code value }
                </i></font>EndingCode<font color="#000080">: </font>integer<font color="#000080">;         </font><font color="#008000"><i>{ ending code value }
                </i></font>Slot<font color="#000080">: </font>word<font color="#000080">;                                     </font><font color="#008000"><i>{ position that the next new code is to be added }
                </i></font>TopSlot<font color="#000080">: </font>word<font color="#000080">;      </font><font color="#008000"><i>{ highest slot position for the current code size }
                </i></font>HighCode<font color="#000080">: </font>word<font color="#000080">;     </font><font color="#008000"><i>{ highest code that does not require decoding }
                </i></font>NextByte<font color="#000080">: </font>integer<font color="#000080">;      </font><font color="#008000"><i>{ the index to the next byte in the datablock array }
                </i></font>CurrByte<font color="#000080">: </font>byte<font color="#000080">;                 </font><font color="#008000"><i>{ the current byte }
                </i></font>DecodeStack<font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font>MAXCODES<font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">; </font><font color="#008000"><i>{ stack for the decoded codes }
                </i></font>Prefix<font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font>MAXCODES<font color="#000080">] </font><font color="#FF0000"><b>of </b></font>word<font color="#000080">;                     </font><font color="#008000"><i>{ array for code prefixes }
                </i></font>Suffix<font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font>MAXCODES<font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">;             </font><font color="#008000"><i>{ array for code suffixes }
                </i></font>LineBuffer<font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font>MAXSCREENWIDTH<font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">; </font><font color="#008000"><i>{ array for buffer line output }
                </i></font>CurrentX<font color="#000080">, </font>CurrentY<font color="#000080">: </font>integer<font color="#000080">;                                            </font><font color="#008000"><i>{ current screen locations }
                </i></font>Status<font color="#000080">: </font>word<font color="#000080">;                                                         </font><font color="#008000"><i>{ status of the decode }
                </i></font>InterlacePass<font color="#000080">: </font>byte<font color="#000080">;    </font><font color="#008000"><i>{ interlace pass number }
                </i></font><font color="#FF0000"><b>constructor </b></font>Init<font color="#000080">(</font>AGIFName<font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">);
                </font><font color="#FF0000"><b>destructor </b></font>Done<font color="#000080">; </font><font color="#FF0000"><b>virtual</b></font><font color="#000080">;
                </font><font color="#FF0000"><b>procedure </b></font>Error<font color="#000080">(</font>What<font color="#000080">: </font>integer<font color="#000080">);
                </font><font color="#FF0000"><b>procedure </b></font>InitCompressionStream<font color="#000080">;        </font><font color="#008000"><i>{ initializes info for decode }
                </i></font><font color="#FF0000"><b>procedure </b></font>ReadSubBlock<font color="#000080">;                          </font><font color="#008000"><i>{ reads a data subblock from the stream }
                </i></font><font color="#FF0000"><b>function </b></font>NextCode<font color="#000080">: </font>word<font color="#000080">;                                        </font><font color="#008000"><i>{ returns the next available code }
                </i></font><font color="#FF0000"><b>procedure </b></font>Decode<font color="#000080">(</font>Beep<font color="#000080">: </font>boolean<font color="#000080">);        </font><font color="#008000"><i>{ the actual LZW decoding routine }
                </i></font><font color="#FF0000"><b>procedure </b></font>DrawLine<font color="#000080">;                     </font><font color="#008000"><i>{ writes the drawline buffer to screen }
                </i></font><font color="#FF0000"><b>procedure </b></font>InitGraphics<font color="#000080">;                 </font><font color="#008000"><i>{ Initializes Graphics mode }
        </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>const
</b></font><font color="#008000"><i>{ error constants }
        </i></font>geNoError <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">;                          </font><font color="#008000"><i>{ no errors found }
        </i></font>geNoFile <font color="#000080">= </font><font color="#800000">1</font><font color="#000080">;         </font><font color="#008000"><i>{ gif file not found }
        </i></font>geNotGIF <font color="#000080">= </font><font color="#800000">2</font><font color="#000080">;         </font><font color="#008000"><i>{ file is not a gif file }
        </i></font>geNoGlobalColor <font color="#000080">= </font><font color="#800000">3</font><font color="#000080">;  </font><font color="#008000"><i>{ no Global Color table found }
        </i></font>geImagePreceded <font color="#000080">= </font><font color="#800000">4</font><font color="#000080">;  </font><font color="#008000"><i>{ image descriptor preceeded by other unknown data }
        </i></font>geEmptyBlock <font color="#000080">= </font><font color="#800000">5</font><font color="#000080">;                       </font><font color="#008000"><i>{ Block has no data }
        </i></font>geUnExpectedEOF <font color="#000080">= </font><font color="#800000">6</font><font color="#000080">;  </font><font color="#008000"><i>{ unexpected EOF }
        </i></font>geBadCodeSize <font color="#000080">= </font><font color="#800000">7</font><font color="#000080">;    </font><font color="#008000"><i>{ bad code size }
        </i></font>geBadCode <font color="#000080">= </font><font color="#800000">8</font><font color="#000080">;                          </font><font color="#008000"><i>{ Bad code was found }
        </i></font>geBitSizeOverflow <font color="#000080">= </font><font color="#800000">9</font><font color="#000080">; </font><font color="#008000"><i>{ bit size went beyond 12 bits }

</i></font><font color="#FF0000"><b>implementation

uses </b></font>Graph<font color="#000080">, </font>Crt<font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>Power<font color="#000080">(</font>A<font color="#000080">, </font>N<font color="#000080">: </font>real<font color="#000080">): </font>real<font color="#000080">;       </font><font color="#008000"><i>{ returns A raised to the power of N }
</i></font><font color="#FF0000"><b>begin
        </b></font>Power <font color="#000080">:= </font>exp<font color="#000080">(</font>N <font color="#000080">* </font>ln<font color="#000080">(</font>A<font color="#000080">));
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#008000"><i>{ TGif }
</i></font><font color="#FF0000"><b>constructor </b></font>TGif<font color="#000080">.</font>Init<font color="#000080">(</font>AGIFName<font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">);
</font><font color="#FF0000"><b>begin
        inherited </b></font>Init<font color="#000080">;
        </font><font color="#FF0000"><b>if </b></font>Pos<font color="#000080">(</font><font color="#800000">'.'</font><font color="#000080">,</font>AGifName<font color="#000080">) = </font><font color="#800000">0 </font><font color="#FF0000"><b>then     </b></font><font color="#008000"><i>{ if the filename has no extension add one }
                </i></font>AGifName <font color="#000080">:= </font>AGifName <font color="#000080">+ </font><font color="#800000">'.gif'</font><font color="#000080">;
        </font>Stream <font color="#000080">:= </font>New<font color="#000080">(</font>PBufStream<font color="#000080">, </font>Init<font color="#000080">(</font>AGifName<font color="#000080">, </font>stOpen<font color="#000080">, </font><font color="#800000">2048</font><font color="#000080">));
        </font>Stream<font color="#000080">^.</font>Read<font color="#000080">(</font>Header<font color="#000080">, </font>sizeof<font color="#000080">(</font>Header<font color="#000080">));                                           </font><font color="#008000"><i>{ read the header }
        </i></font><font color="#FF0000"><b>if </b></font>Header<font color="#000080">.</font>Signature <font color="#000080">&lt;&gt; </font><font color="#800000">'GIF' </font><font color="#FF0000"><b>then </b></font>Error<font color="#000080">(</font>geNotGIF<font color="#000080">);                              </font><font color="#008000"><i>{ is vaild signature }
        </i></font>Stream<font color="#000080">^.</font>Read<font color="#000080">(</font>LogicalScreen<font color="#000080">, </font>sizeof<font color="#000080">(</font>LogicalScreen<font color="#000080">));
        </font><font color="#FF0000"><b>if </b></font>LogicalScreen<font color="#000080">.</font>PackedFields <font color="#FF0000"><b>and </b></font>lsdGlobalColorTable <font color="#000080">= </font>lsdGlobalColorTable <font color="#FF0000"><b>then
        begin
                </b></font>TableSize <font color="#000080">:= </font>trunc<font color="#000080">(</font>Power<font color="#000080">(</font><font color="#800000">2</font><font color="#000080">,(</font>LogicalScreen<font color="#000080">.</font>PackedFields <font color="#FF0000"><b>and </b></font>lsdColorTableSize<font color="#000080">)+</font><font color="#800000">1</font><font color="#000080">));
                </font>Stream<font color="#000080">^.</font>Read<font color="#000080">(</font>GlobalColorTable<font color="#000080">, </font>TableSize<font color="#000080">*</font>sizeof<font color="#000080">(</font>TColorItem<font color="#000080">)); </font><font color="#008000"><i>{ read Global Color Table }
        </i></font><font color="#FF0000"><b>end
        else
                </b></font>Error<font color="#000080">(</font>geNoGlobalColor<font color="#000080">);
        </font>Stream<font color="#000080">^.</font>Read<font color="#000080">(</font>ImageDescriptor<font color="#000080">, </font>sizeof<font color="#000080">(</font>ImageDescriptor<font color="#000080">)); </font><font color="#008000"><i>{ read image descriptor }
        </i></font><font color="#FF0000"><b>if </b></font>ImageDescriptor<font color="#000080">.</font>Seperator <font color="#000080">&lt;&gt; </font>ImageSeperator <font color="#FF0000"><b>then                     </b></font><font color="#008000"><i>{ verify that it is the descriptor }
                </i></font>Error<font color="#000080">(</font>geImagePreceded<font color="#000080">);
        </font><font color="#FF0000"><b>if </b></font>ImageDescriptor<font color="#000080">.</font>PackedFields <font color="#FF0000"><b>and </b></font>idLocalColorTable <font color="#000080">= </font>idLocalColorTable <font color="#FF0000"><b>then
        begin                                                               </b></font><font color="#008000"><i>{ if local color table }
                </i></font>TableSize <font color="#000080">:= </font>trunc<font color="#000080">(</font>Power<font color="#000080">(</font><font color="#800000">2</font><font color="#000080">,(</font>ImageDescriptor<font color="#000080">.</font>PackedFields <font color="#FF0000"><b>and </b></font>idColorTableSize<font color="#000080">)+</font><font color="#800000">1</font><font color="#000080">));
                </font>Stream<font color="#000080">^.</font>Read<font color="#000080">(</font>LocalColorTable<font color="#000080">, </font>TableSize<font color="#000080">*</font>sizeof<font color="#000080">(</font>TColorItem<font color="#000080">)); </font><font color="#008000"><i>{ read Local Color Table }
                </i></font>UseLocalColors <font color="#000080">:= </font>True<font color="#000080">;
        </font><font color="#FF0000"><b>end
        else
                </b></font>UseLocalColors <font color="#000080">:= </font>false<font color="#000080">;
        </font><font color="#FF0000"><b>if </b></font>ImageDescriptor<font color="#000080">.</font>PackedFields <font color="#FF0000"><b>and </b></font>idInterlaced <font color="#000080">= </font>idInterlaced <font color="#FF0000"><b>then
        begin
                </b></font>Interlaced <font color="#000080">:= </font>true<font color="#000080">;
                </font>InterlacePass <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
        </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
        </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>Stream <font color="#000080">= </font><font color="#FF0000"><b>nil</b></font><font color="#000080">) </font><font color="#FF0000"><b>or </b></font><font color="#000080">(</font>Stream<font color="#000080">^.</font>Status <font color="#000080">&lt;&gt; </font>stOk<font color="#000080">) </font><font color="#FF0000"><b>then</b></font><font color="#008000"><i>{ check for stream error }
                </i></font>Error<font color="#000080">(</font>geNoFile<font color="#000080">);
        </font>Status <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>destructor </b></font>TGif<font color="#000080">.</font>Done<font color="#000080">;
</font><font color="#FF0000"><b>begin
        </b></font>CloseGraph<font color="#000080">;
        </font>TextMode<font color="#000080">(</font>LastMode<font color="#000080">);
        </font><font color="#FF0000"><b>if </b></font>Stream <font color="#000080">&lt;&gt; </font><font color="#FF0000"><b>nil then
                </b></font>Dispose<font color="#000080">(</font>Stream<font color="#000080">, </font>Done<font color="#000080">);
        </font><font color="#FF0000"><b>inherited </b></font>Done<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>TGif<font color="#000080">.</font>Error<font color="#000080">(</font>What<font color="#000080">: </font>integer<font color="#000080">);
</font><font color="#FF0000"><b>begin
        </b></font>Status <font color="#000080">:= </font>What<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>TGif<font color="#000080">.</font>InitCompressionStream<font color="#000080">;
</font><font color="#FF0000"><b>var
        </b></font>I<font color="#000080">: </font>integer<font color="#000080">;
</font><font color="#FF0000"><b>begin
        </b></font>InitGraphics<font color="#000080">;                           </font><font color="#008000"><i>{ Initialize the graphics display }
        </i></font>Stream<font color="#000080">^.</font>Read<font color="#000080">(</font>LZWCodeSize<font color="#000080">, </font>sizeof<font color="#000080">(</font>byte<font color="#000080">));</font><font color="#008000"><i>{ get minimum code size }
        </i></font><font color="#FF0000"><b>if not </b></font><font color="#000080">(</font>LZWCodeSize <font color="#FF0000"><b>in </b></font><font color="#000080">[</font><font color="#800000">2</font><font color="#000080">..</font><font color="#800000">9</font><font color="#000080">]) </font><font color="#FF0000"><b>then     </b></font><font color="#008000"><i>{ valid code sizes 2-9 bits }
                </i></font>Error<font color="#000080">(</font>geBadCodeSize<font color="#000080">);

        </font>CurrCodeSize <font color="#000080">:= </font>succ<font color="#000080">(</font>LZWCodeSize<font color="#000080">); </font><font color="#008000"><i>{ set the initial code size }
        </i></font>ClearCode <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>shl </b></font>LZWCodeSize<font color="#000080">;    </font><font color="#008000"><i>{ set the clear code }
        </i></font>EndingCode <font color="#000080">:= </font>succ<font color="#000080">(</font>ClearCode<font color="#000080">);     </font><font color="#008000"><i>{ set the ending code }
        </i></font>HighCode <font color="#000080">:= </font>pred<font color="#000080">(</font>ClearCode<font color="#000080">);                     </font><font color="#008000"><i>{ set the highest code not needing decoding }
        </i></font>BytesLeft <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;                    </font><font color="#008000"><i>{ clear other variables }
        </i></font>BitsLeft <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
        </font>CurrentX <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
        </font>CurrentY <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>TGif<font color="#000080">.</font>ReadSubBlock<font color="#000080">;
</font><font color="#FF0000"><b>begin
        </b></font>Stream<font color="#000080">^.</font>Read<font color="#000080">(</font>ImageData<font color="#000080">.</font>Size<font color="#000080">, </font>sizeof<font color="#000080">(</font>ImageData<font color="#000080">.</font>Size<font color="#000080">)); </font><font color="#008000"><i>{ get the data block size }
        </i></font><font color="#FF0000"><b>if </b></font>ImageData<font color="#000080">.</font>Size <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>Error<font color="#000080">(</font>geEmptyBlock<font color="#000080">); </font><font color="#008000"><i>{ check for empty block }
        </i></font>Stream<font color="#000080">^.</font>Read<font color="#000080">(</font>ImageData<font color="#000080">.</font>Data<font color="#000080">, </font>ImageData<font color="#000080">.</font>Size<font color="#000080">);   </font><font color="#008000"><i>{ read in the block }
        </i></font>NextByte <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;                                  </font><font color="#008000"><i>{ reset next byte }
        </i></font>BytesLeft <font color="#000080">:= </font>ImageData<font color="#000080">.</font>Size<font color="#000080">;                                                                            </font><font color="#008000"><i>{ reset bytes left }
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>const
        </b></font>CodeMask<font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">12</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>longint <font color="#000080">= (  </font><font color="#008000"><i>{ bit masks for use with Next code }
                </i></font><font color="#800000">0</font><font color="#000080">,
                </font><font color="#800000">$0001</font><font color="#000080">, </font><font color="#800000">$0003</font><font color="#000080">,
                </font><font color="#800000">$0007</font><font color="#000080">, </font><font color="#800000">$000F</font><font color="#000080">,
                </font><font color="#800000">$001F</font><font color="#000080">, </font><font color="#800000">$003F</font><font color="#000080">,
                </font><font color="#800000">$007F</font><font color="#000080">, </font><font color="#800000">$00FF</font><font color="#000080">,
                </font><font color="#800000">$01FF</font><font color="#000080">, </font><font color="#800000">$03FF</font><font color="#000080">,
                </font><font color="#800000">$07FF</font><font color="#000080">, </font><font color="#800000">$0FFF</font><font color="#000080">);

</font><font color="#FF0000"><b>function </b></font>TGif<font color="#000080">.</font>NextCode<font color="#000080">: </font>word<font color="#000080">; </font><font color="#008000"><i>{ returns a code of the proper bit size }
</i></font><font color="#FF0000"><b>var
        </b></font>Ret<font color="#000080">: </font>longint<font color="#000080">;                          </font><font color="#008000"><i>{ temporary return value }
</i></font><font color="#FF0000"><b>begin
        if </b></font>BitsLeft <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>then                                                                            </b></font><font color="#008000"><i>{ any bits left in byte ? }
        </i></font><font color="#FF0000"><b>begin                                   </b></font><font color="#008000"><i>{ any bytes left }
                </i></font><font color="#FF0000"><b>if </b></font>BytesLeft <font color="#000080">&lt;= </font><font color="#800000">0 </font><font color="#FF0000"><b>then                                                          </b></font><font color="#008000"><i>{ if not get another block }
                        </i></font>ReadSubBlock<font color="#000080">;
                        </font>CurrByte <font color="#000080">:= </font>ImageData<font color="#000080">.</font>Data<font color="#000080">[</font>NextByte<font color="#000080">]; </font><font color="#008000"><i>{ get a byte }
                </i></font>inc<font color="#000080">(</font>NextByte<font color="#000080">);                        </font><font color="#008000"><i>{ set the next byte index }
                </i></font>BitsLeft <font color="#000080">:= </font><font color="#800000">8</font><font color="#000080">;                        </font><font color="#008000"><i>{ set bits left in the byte }
                </i></font>dec<font color="#000080">(</font>BytesLeft<font color="#000080">);                       </font><font color="#008000"><i>{ decrement the bytes left counter }
        </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;
        </font>ret <font color="#000080">:= </font>CurrByte <font color="#FF0000"><b>shr </b></font><font color="#000080">(</font><font color="#800000">8 </font><font color="#000080">- </font>BitsLeft<font color="#000080">);                     </font><font color="#008000"><i>{ shift off any previosly used bits}
        </i></font><font color="#FF0000"><b>while </b></font>CurrCodeSize <font color="#000080">&gt; </font>BitsLeft <font color="#FF0000"><b>do        </b></font><font color="#008000"><i>{ need more bits ? }
        </i></font><font color="#FF0000"><b>begin
                if </b></font>BytesLeft <font color="#000080">&lt;= </font><font color="#800000">0 </font><font color="#FF0000"><b>then                                                          </b></font><font color="#008000"><i>{ any bytes left in block ? }
                        </i></font>ReadSubBlock<font color="#000080">;                       </font><font color="#008000"><i>{ if not read in another block }
                </i></font>CurrByte <font color="#000080">:= </font>ImageData<font color="#000080">.</font>Data<font color="#000080">[</font>NextByte<font color="#000080">]; </font><font color="#008000"><i>{ get another byte }
                </i></font>inc<font color="#000080">(</font>NextByte<font color="#000080">);                        </font><font color="#008000"><i>{ increment NextByte counter }
                </i></font>ret <font color="#000080">:= </font>ret <font color="#FF0000"><b>or </b></font><font color="#000080">(</font>CurrByte <font color="#FF0000"><b>shl </b></font>BitsLeft<font color="#000080">);</font><font color="#008000"><i>{ add the remaining bits to the return value }
                </i></font>BitsLeft <font color="#000080">:= </font>BitsLeft <font color="#000080">+ </font><font color="#800000">8</font><font color="#000080">;                                               </font><font color="#008000"><i>{ set bit counter }
                </i></font>dec<font color="#000080">(</font>BytesLeft<font color="#000080">);                     </font><font color="#008000"><i>{ decrement bytesleft counter }
        </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;
        </font>BitsLeft <font color="#000080">:= </font>BitsLeft <font color="#000080">- </font>CurrCodeSize<font color="#000080">;  </font><font color="#008000"><i>{ subtract the code size from bitsleft }
        </i></font>ret <font color="#000080">:= </font>ret <font color="#FF0000"><b>and </b></font>CodeMask<font color="#000080">[</font>CurrCodeSize<font color="#000080">];</font><font color="#008000"><i>{ mask off the right number of bits }
        </i></font>NextCode <font color="#000080">:= </font>ret<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{ this procedure initializes the graphics mode and actually decodes the
        GIF image }
</i></font><font color="#FF0000"><b>procedure </b></font>TGif<font color="#000080">.</font>Decode<font color="#000080">(</font>Beep<font color="#000080">: </font>boolean<font color="#000080">);
</font><font color="#FF0000"><b>var
        </b></font>SP<font color="#000080">: </font>integer<font color="#000080">; </font><font color="#008000"><i>{ index to the decode stack }

{ local procedure that decodes a code and puts it on the decode stack }
</i></font><font color="#FF0000"><b>procedure </b></font>DecodeCode<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>Code<font color="#000080">: </font>word<font color="#000080">);
</font><font color="#FF0000"><b>begin
        while </b></font>Code <font color="#000080">&gt; </font>HighCode <font color="#FF0000"><b>do </b></font><font color="#008000"><i>{ rip thru the prefix list placing suffixes }
        </i></font><font color="#FF0000"><b>begin                    </b></font><font color="#008000"><i>{ onto the decode stack }
                </i></font>DecodeStack<font color="#000080">[</font>SP<font color="#000080">] := </font>Suffix<font color="#000080">[</font>Code<font color="#000080">]; </font><font color="#008000"><i>{ put the suffix on the decode stack }
                </i></font>inc<font color="#000080">(</font>SP<font color="#000080">);                         </font><font color="#008000"><i>{ increment decode stack index }
                </i></font>Code <font color="#000080">:= </font>Prefix<font color="#000080">[</font>Code<font color="#000080">];            </font><font color="#008000"><i>{ get the new prefix }
        </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;
        </font>DecodeStack<font color="#000080">[</font>SP<font color="#000080">] := </font>Code<font color="#000080">;        </font><font color="#008000"><i>{ put the last code onto the decode stack }
        </i></font>inc<font color="#000080">(</font>SP<font color="#000080">);                                                                        </font><font color="#008000"><i>{ increment the decode stack index }
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>var
        </b></font>TempOldCode<font color="#000080">, </font>OldCode<font color="#000080">: </font>word<font color="#000080">;
        </font>BufCnt<font color="#000080">: </font>word<font color="#000080">;           </font><font color="#008000"><i>{ line buffer counter }
        </i></font>Code<font color="#000080">, </font>C<font color="#000080">: </font>word<font color="#000080">;
        </font>CurrBuf<font color="#000080">: </font>word<font color="#000080">;  </font><font color="#008000"><i>{ line buffer index }
</i></font><font color="#FF0000"><b>begin
        </b></font>InitGraphics<font color="#000080">;                                                   </font><font color="#008000"><i>{ Initialize the graphics mode and RGB palette }
        </i></font>InitCompressionStream<font color="#000080">;    </font><font color="#008000"><i>{ Initialize decoding paramaters }
        </i></font>OldCode <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
        </font>SP <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
        </font>BufCnt <font color="#000080">:= </font>ImageDescriptor<font color="#000080">.</font>ImageWidth<font color="#000080">; </font><font color="#008000"><i>{ set the Image Width }
        </i></font>CurrBuf <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;

        </font>C <font color="#000080">:= </font>NextCode<font color="#000080">;                                          </font><font color="#008000"><i>{ get the initial code - should be a clear code }
        </i></font><font color="#FF0000"><b>while </b></font>C <font color="#000080">&lt;&gt; </font>EndingCode <font color="#FF0000"><b>do  </b></font><font color="#008000"><i>{ main loop until ending code is found }
        </i></font><font color="#FF0000"><b>begin
                if </b></font>C <font color="#000080">= </font>ClearCode <font color="#FF0000"><b>then   </b></font><font color="#008000"><i>{ code is a clear code - so clear }
                </i></font><font color="#FF0000"><b>begin
                        </b></font>CurrCodeSize <font color="#000080">:= </font>LZWCodeSize <font color="#000080">+ </font><font color="#800000">1</font><font color="#000080">;</font><font color="#008000"><i>{ reset the code size }
                        </i></font>Slot <font color="#000080">:= </font>EndingCode <font color="#000080">+ </font><font color="#800000">1</font><font color="#000080">;                                 </font><font color="#008000"><i>{ set slot for next new code }
                        </i></font>TopSlot <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>shl </b></font>CurrCodeSize<font color="#000080">;  </font><font color="#008000"><i>{ set max slot number }
                        </i></font><font color="#FF0000"><b>while </b></font>C <font color="#000080">= </font>ClearCode <font color="#FF0000"><b>do
                                </b></font>C <font color="#000080">:= </font>NextCode<font color="#000080">;                  </font><font color="#008000"><i>{ read until all clear codes gone - shouldn't happen }
                        </i></font><font color="#FF0000"><b>if </b></font>C <font color="#000080">= </font>EndingCode <font color="#FF0000"><b>then
                        begin
                                </b></font>Error<font color="#000080">(</font>geBadCode<font color="#000080">);   </font><font color="#008000"><i>{ ending code after a clear code }
                                </i></font>break<font color="#000080">;                                                  </font><font color="#008000"><i>{ this also should never happen }
                        </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;
                        </font><font color="#FF0000"><b>if </b></font>C <font color="#000080">&gt;= </font>Slot <font color="#008000"><i>{ if the code is beyond preset codes then set to zero }
                                </i></font><font color="#FF0000"><b>then </b></font>c <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
                        </font>OldCode <font color="#000080">:= </font>C<font color="#000080">;
                        </font>DecodeStack<font color="#000080">[</font>sp<font color="#000080">] := </font>C<font color="#000080">;                                   </font><font color="#008000"><i>{ output code to decoded stack }
                        </i></font>inc<font color="#000080">(</font>SP<font color="#000080">);                                                </font><font color="#008000"><i>{ increment decode stack index }
                </i></font><font color="#FF0000"><b>end
                else   </b></font><font color="#008000"><i>{ the code is not a clear code or an ending code so it must }
                </i></font><font color="#FF0000"><b>begin  </b></font><font color="#008000"><i>{ be a code code - so decode the code }
                        </i></font>Code <font color="#000080">:= </font>C<font color="#000080">;
                        </font><font color="#FF0000"><b>if </b></font>Code <font color="#000080">&lt; </font>Slot <font color="#FF0000"><b>then     </b></font><font color="#008000"><i>{ is the code in the table? }
                        </i></font><font color="#FF0000"><b>begin
                                </b></font>DecodeCode<font color="#000080">(</font>Code<font color="#000080">);                               </font><font color="#008000"><i>{ decode the code }
                                </i></font><font color="#FF0000"><b>if </b></font>Slot <font color="#000080">&lt;= </font>TopSlot <font color="#FF0000"><b>then
                                begin                                           </b></font><font color="#008000"><i>{ add the new code to the table }
                                        </i></font>Suffix<font color="#000080">[</font>Slot<font color="#000080">] := </font>Code<font color="#000080">;                   </font><font color="#008000"><i>{ make the suffix }
                                        </i></font>PreFix<font color="#000080">[</font>slot<font color="#000080">] := </font>OldCode<font color="#000080">;        </font><font color="#008000"><i>{ the previous code - a link to the data }
                                        </i></font>inc<font color="#000080">(</font>Slot<font color="#000080">);                                                              </font><font color="#008000"><i>{ increment slot number }
                                        </i></font>OldCode <font color="#000080">:= </font>C<font color="#000080">;                                                   </font><font color="#008000"><i>{ set oldcode }
                                </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;
                                </font><font color="#FF0000"><b>if </b></font>Slot <font color="#000080">&gt;= </font>TopSlot <font color="#FF0000"><b>then </b></font><font color="#008000"><i>{ have reached the top slot for bit size }
                                </i></font><font color="#FF0000"><b>begin                   </b></font><font color="#008000"><i>{ increment code bit size }
                                        </i></font><font color="#FF0000"><b>if </b></font>CurrCodeSize <font color="#000080">&lt; </font><font color="#800000">12 </font><font color="#FF0000"><b>then </b></font><font color="#008000"><i>{ new bit size not too big? }
                                        </i></font><font color="#FF0000"><b>begin
                                                </b></font>TopSlot <font color="#000080">:= </font>TopSlot <font color="#FF0000"><b>shl </b></font><font color="#800000">1</font><font color="#000080">;       </font><font color="#008000"><i>{ new top slot }
                                                </i></font>inc<font color="#000080">(</font>CurrCodeSize<font color="#000080">)                                       </font><font color="#008000"><i>{ new code size }
                                        </i></font><font color="#FF0000"><b>end
                                        else
                                                </b></font>Error<font color="#000080">(</font>geBitSizeOverflow<font color="#000080">); </font><font color="#008000"><i>{ encoder made a boo boo }
                                </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;
                        </font><font color="#FF0000"><b>end
                        else
                        begin           </b></font><font color="#008000"><i>{ the code is not in the table }
                                </i></font><font color="#FF0000"><b>if </b></font>Code <font color="#000080">&lt;&gt; </font>Slot <font color="#FF0000"><b>then                    </b></font><font color="#008000"><i>{ code is not the next available slot }
                                        </i></font>Error<font color="#000080">(</font>geBadCode<font color="#000080">);  </font><font color="#008000"><i>{ so error out }

                                { the code does not exist so make a new entry in the code table
                                 and then translate the new code }
                                </i></font>TempOldCode <font color="#000080">:= </font>OldCode<font color="#000080">;  </font><font color="#008000"><i>{ make a copy of the old code }
                                </i></font><font color="#FF0000"><b>while </b></font>OldCode <font color="#000080">&gt; </font>HighCode <font color="#FF0000"><b>do </b></font><font color="#008000"><i>{ translate the old code and place it }
                                </i></font><font color="#FF0000"><b>begin                                   </b></font><font color="#008000"><i>{ on the decode stack }
                                        </i></font>DecodeStack<font color="#000080">[</font>SP<font color="#000080">] := </font>Suffix<font color="#000080">[</font>OldCode<font color="#000080">]; </font><font color="#008000"><i>{ do the suffix }
                                        </i></font>OldCode <font color="#000080">:= </font>Prefix<font color="#000080">[</font>OldCode<font color="#000080">];         </font><font color="#008000"><i>{ get next prefix }
                                </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;
                                </font>DecodeStack<font color="#000080">[</font>SP<font color="#000080">] := </font>OldCode<font color="#000080">;     </font><font color="#008000"><i>{ put the code onto the decode stack }
                                                                                                                                                { but DO NOT increment stack index }
                                { the decode stack is not incremented because because we are only
                                        translating the oldcode to get the first character }
                                </i></font><font color="#FF0000"><b>if </b></font>Slot <font color="#000080">&lt;= </font>TopSlot <font color="#FF0000"><b>then
                                begin                 </b></font><font color="#008000"><i>{ make new code entry }
                                        </i></font>Suffix<font color="#000080">[</font>Slot<font color="#000080">] := </font>OldCode<font color="#000080">;                 </font><font color="#008000"><i>{ first char of old code }
                                        </i></font>Prefix<font color="#000080">[</font>Slot<font color="#000080">] := </font>TempOldCode<font color="#000080">; </font><font color="#008000"><i>{ link to the old code prefix }
                                        </i></font>inc<font color="#000080">(</font>Slot<font color="#000080">);                   </font><font color="#008000"><i>{ increment slot }
                                </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;
                                </font><font color="#FF0000"><b>if </b></font>Slot <font color="#000080">&gt;= </font>TopSlot <font color="#FF0000"><b>then </b></font><font color="#008000"><i>{ slot is too big }
                                </i></font><font color="#FF0000"><b>begin                   </b></font><font color="#008000"><i>{ increment code size }
                                        </i></font><font color="#FF0000"><b>if </b></font>CurrCodeSize <font color="#000080">&lt; </font><font color="#800000">12 </font><font color="#FF0000"><b>then
                                        begin
                                                </b></font>TopSlot <font color="#000080">:= </font>TopSlot <font color="#FF0000"><b>shl </b></font><font color="#800000">1</font><font color="#000080">;       </font><font color="#008000"><i>{ new top slot }
                                                </i></font>inc<font color="#000080">(</font>CurrCodeSize<font color="#000080">)                                       </font><font color="#008000"><i>{ new code size }
                                        </i></font><font color="#FF0000"><b>end
                                        else
                                                </b></font>Error<font color="#000080">(</font>geBitSizeOverFlow<font color="#000080">);
                                </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
                                </font>DecodeCode<font color="#000080">(</font>Code<font color="#000080">); </font><font color="#008000"><i>{ now that the table entry exists decode it }
                                </i></font>OldCode <font color="#000080">:= </font>C<font color="#000080">;     </font><font color="#008000"><i>{ set the new old code }
                        </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;
                </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
                </font><font color="#008000"><i>{ the decoded string is on the decode stack so pop it off and put it
                 into the line buffer }
                </i></font><font color="#FF0000"><b>while </b></font>SP <font color="#000080">&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>do
                begin
                        </b></font>dec<font color="#000080">(</font>SP<font color="#000080">);
                        </font>LineBuffer<font color="#000080">[</font>CurrBuf<font color="#000080">] := </font>DecodeStack<font color="#000080">[</font>SP<font color="#000080">];
                        </font>inc<font color="#000080">(</font>CurrBuf<font color="#000080">);
                        </font>dec<font color="#000080">(</font>BufCnt<font color="#000080">);
                        </font><font color="#FF0000"><b>if </b></font>BufCnt <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>then  </b></font><font color="#008000"><i>{ is the line full ? }
                        </i></font><font color="#FF0000"><b>begin
                                </b></font>DrawLine<font color="#000080">;
                                </font>CurrBuf <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
                                </font>BufCnt <font color="#000080">:= </font>ImageDescriptor<font color="#000080">.</font>ImageWidth<font color="#000080">;
                        </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
                </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
        </font>C <font color="#000080">:= </font>NextCode<font color="#000080">;  </font><font color="#008000"><i>{ get the next code and go at is some more }
        </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;            </font><font color="#008000"><i>{ now that wasn't all that bad was it? }
        </i></font><font color="#FF0000"><b>if </b></font>Beep <font color="#FF0000"><b>then
                if </b></font>Status <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>then
                begin
                        </b></font>Sound<font color="#000080">(</font><font color="#800000">660</font><font color="#000080">);     </font><font color="#008000"><i>{ Beep if status is ok }
                        </i></font>Delay<font color="#000080">(</font><font color="#800000">50</font><font color="#000080">);
                        </font>NoSound<font color="#000080">;
                </font><font color="#FF0000"><b>end
                else
                begin
                        </b></font>Sound<font color="#000080">(</font><font color="#800000">110</font><font color="#000080">); </font><font color="#008000"><i>{ Boop if status is not ok }
                        </i></font>Delay<font color="#000080">(</font><font color="#800000">200</font><font color="#000080">);
                        </font>NoSound<font color="#000080">;
                </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>TGif<font color="#000080">.</font>DrawLine<font color="#000080">;
</font><font color="#FF0000"><b>var
        </b></font>I<font color="#000080">: </font>integer<font color="#000080">;
</font><font color="#FF0000"><b>begin
        for </b></font>I <font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font>ImageDescriptor<font color="#000080">.</font>ImageWidth <font color="#FF0000"><b>do
                </b></font>PutPixel<font color="#000080">(</font>I<font color="#000080">, </font>CurrentY<font color="#000080">, </font>LineBuffer<font color="#000080">[</font>I<font color="#000080">]);
        </font>inc<font color="#000080">(</font>CurrentY<font color="#000080">);

        </font><font color="#FF0000"><b>if </b></font>InterLaced <font color="#FF0000"><b>then     </b></font><font color="#008000"><i>{ Interlace support }
        </i></font><font color="#FF0000"><b>begin
                case </b></font>InterlacePass <font color="#FF0000"><b>of
                        </b></font><font color="#800000">0</font><font color="#000080">: </font>CurrentY <font color="#000080">:= </font>CurrentY <font color="#000080">+ </font><font color="#800000">7</font><font color="#000080">;
                        </font><font color="#800000">1</font><font color="#000080">: </font>CurrentY <font color="#000080">:= </font>CurrentY <font color="#000080">+ </font><font color="#800000">7</font><font color="#000080">;
                        </font><font color="#800000">2</font><font color="#000080">: </font>CurrentY <font color="#000080">:= </font>CurrentY <font color="#000080">+ </font><font color="#800000">3</font><font color="#000080">;
                        </font><font color="#800000">3</font><font color="#000080">: </font>CurrentY <font color="#000080">:= </font>CurrentY <font color="#000080">+ </font><font color="#800000">1</font><font color="#000080">;
                </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
                </font><font color="#FF0000"><b>if </b></font>CurrentY <font color="#000080">&gt;= </font>ImageDescriptor<font color="#000080">.</font>ImageHeight <font color="#FF0000"><b>then
                begin
                        </b></font>inc<font color="#000080">(</font>InterLacePass<font color="#000080">);
                        </font><font color="#FF0000"><b>case </b></font>InterLacePass <font color="#FF0000"><b>of
                                </b></font><font color="#800000">1</font><font color="#000080">: </font>CurrentY <font color="#000080">:= </font><font color="#800000">4</font><font color="#000080">;
                                </font><font color="#800000">2</font><font color="#000080">: </font>CurrentY <font color="#000080">:= </font><font color="#800000">2</font><font color="#000080">;
                                </font><font color="#800000">3</font><font color="#000080">: </font>CurrentY <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;
                        </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
                </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
        </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>TGif<font color="#000080">.</font>InitGraphics<font color="#000080">;
</font><font color="#FF0000"><b>var
        </b></font>GraphDriver<font color="#000080">: </font>integer<font color="#000080">;
        </font>GraphMode<font color="#000080">: </font>integer<font color="#000080">;
        </font>ErrorCode<font color="#000080">: </font>integer<font color="#000080">;
        </font>I<font color="#000080">: </font>integer<font color="#000080">;
</font><font color="#FF0000"><b>begin
        </b></font>GraphDriver <font color="#000080">:= </font>InstallUserDriver<font color="#000080">(</font><font color="#800000">'bgi256'</font><font color="#000080">, </font><font color="#FF0000"><b>nil</b></font><font color="#000080">);
        </font>GraphMode <font color="#000080">:= </font><font color="#800000">2</font><font color="#000080">;
        </font>InitGraph<font color="#000080">(</font>GraphDriver<font color="#000080">, </font>GraphMode<font color="#000080">, </font><font color="#800000">'\dealer\bin'</font><font color="#000080">);
        </font>ErrorCode <font color="#000080">:= </font>GraphResult<font color="#000080">;
        </font><font color="#FF0000"><b>if </b></font>ErrorCode <font color="#000080">&lt;&gt; </font>grOk <font color="#FF0000"><b>then
        begin
                </b></font>Writeln<font color="#000080">(</font><font color="#800000">'Graphics Error: '</font><font color="#000080">, </font>GraphErrorMsg<font color="#000080">(</font>ErrorCode<font color="#000080">));
                </font>Halt<font color="#000080">(</font><font color="#800000">99</font><font color="#000080">);
        </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

        </font><font color="#008000"><i>{ the following loop sets up the RGB palette }
        </i></font><font color="#FF0000"><b>if not </b></font>UseLocalColors <font color="#FF0000"><b>then
                for </b></font>I <font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font>TableSize <font color="#000080">- </font><font color="#800000">1 </font><font color="#FF0000"><b>do
                        </b></font>SetRGBPalette<font color="#000080">(</font>I<font color="#000080">, </font>GlobalColorTable<font color="#000080">[</font>I<font color="#000080">].</font>Red <font color="#FF0000"><b>div </b></font><font color="#800000">4</font><font color="#000080">, </font>GlobalColorTable<font color="#000080">[</font>i<font color="#000080">].</font>Green
                                <font color="#FF0000"><b>div </b></font><font color="#800000">4</font><font color="#000080">, </font>GlobalColorTable<font color="#000080">[</font>I<font color="#000080">].</font>Blue <font color="#FF0000"><b>div </b></font><font color="#800000">4</font><font color="#000080">)
        </font><font color="#FF0000"><b>else
                for </b></font>I <font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font>TableSize <font color="#000080">- </font><font color="#800000">1 </font><font color="#FF0000"><b>do
                        </b></font>SetRGBPalette<font color="#000080">(</font>I<font color="#000080">, </font>LocalColorTable<font color="#000080">[</font>I<font color="#000080">].</font>Red <font color="#FF0000"><b>div </b></font><font color="#800000">4</font><font color="#000080">, </font>LocalColorTable<font color="#000080">[</font>i<font color="#000080">].</font>Green
                                <font color="#FF0000"><b>div </b></font><font color="#800000">4</font><font color="#000080">, </font>LocalColorTable<font color="#000080">[</font>I<font color="#000080">].</font>Blue <font color="#FF0000"><b>div </b></font><font color="#800000">4</font><font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>end</b></font><font color="#000080">.

</font><font color="#008000"><i>{ --------------------------   DEMO PROGRAM  ------------------ }

</i></font><font color="#FF0000"><b>program </b></font>Gif<font color="#000080">;
</font><font color="#008000"><i>{ GifUtil sample program
        (c)Copyright 1993 Sean Wenzel
        Users are given the right to freely use and distibute the source code at
        will as long a credit is given where due }

</i></font><font color="#FF0000"><b>uses </b></font>GifUtil<font color="#000080">, </font>CRT<font color="#000080">, </font>Dos<font color="#000080">;

</font><font color="#FF0000"><b>var
        </b></font>A<font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
        </font>TheGif<font color="#000080">: </font>PGif<font color="#000080">;
        </font>Hours<font color="#000080">, </font>Minutes<font color="#000080">, </font>Seconds<font color="#000080">, </font>Sec100<font color="#000080">: </font>word<font color="#000080">;
        </font>H<font color="#000080">, </font>M<font color="#000080">, </font>S<font color="#000080">, </font>S100<font color="#000080">: </font>word<font color="#000080">;
</font><font color="#FF0000"><b>begin
        </b></font>Writeln<font color="#000080">(</font><font color="#800000">'Sample program for using GIFUTIL.PAS unit'</font><font color="#000080">);
        </font>Writeln<font color="#000080">(</font><font color="#800000">'(c) Copyright 1993 Sean Wenzel'</font><font color="#000080">);
        </font>Writeln<font color="#000080">(</font><font color="#800000">''</font><font color="#000080">);

        </font><font color="#FF0000"><b>if </b></font>ParamCount <font color="#000080">&lt;&gt; </font><font color="#800000">1 </font><font color="#FF0000"><b>then
        begin
                </b></font>Writeln<font color="#000080">(</font><font color="#800000">'use: C:&gt;gif &lt;gifname&gt;[.gif] to run...'</font><font color="#000080">);
                </font>Exit<font color="#000080">;
        </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
        </font>TheGif <font color="#000080">:= </font>New<font color="#000080">(</font>PGif<font color="#000080">, </font>Init<font color="#000080">(</font>paramstr<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">)));

        </font>GetTime<font color="#000080">(</font>Hours<font color="#000080">, </font>Minutes<font color="#000080">, </font>Seconds<font color="#000080">, </font>Sec100<font color="#000080">);
        </font>TheGif<font color="#000080">^.</font>Decode<font color="#000080">(</font>True<font color="#000080">);
        </font>GetTime<font color="#000080">(</font>H<font color="#000080">, </font>M<font color="#000080">, </font>S<font color="#000080">, </font>S100<font color="#000080">);
        </font>Readln<font color="#000080">(</font>A<font color="#000080">);
        </font>Dispose<font color="#000080">(</font>TheGif<font color="#000080">, </font>Done<font color="#000080">);

        </font>Writeln<font color="#000080">(</font><font color="#800000">'Start: '</font><font color="#000080">,</font>Hours<font color="#000080">,</font><font color="#800000">':'</font><font color="#000080">,</font>Minutes<font color="#000080">,</font><font color="#800000">':'</font><font color="#000080">,</font>Seconds<font color="#000080">,</font><font color="#800000">':'</font><font color="#000080">,</font>Sec100<font color="#000080">);
        </font>Writeln<font color="#000080">(</font><font color="#800000">' Stop: '</font><font color="#000080">,</font>H<font color="#000080">,</font><font color="#800000">':'</font><font color="#000080">,</font>M<font color="#000080">,</font><font color="#800000">':'</font><font color="#000080">,</font>S<font color="#000080">,</font><font color="#800000">':'</font><font color="#000080">,</font>S100<font color="#000080">);
        </font><font color="#FF0000"><b>while not</b></font><font color="#000080">(</font>KeyPressed<font color="#000080">) </font><font color="#FF0000"><b>do</b></font><font color="#000080">;

        </font>writeln<font color="#000080">(</font><font color="#800000">'&quot;The Graphics Interchange Format(c) is the Copyright property of'</font><font color="#000080">);
        </font>writeln<font color="#000080">(</font><font color="#800000">'CompuServe Incorporated. GIF(sm) is a Service Mark property of '</font><font color="#000080">);
        </font>writeln<font color="#000080">(</font><font color="#800000">'CompuServe Incorporated.&quot;'</font><font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">.</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to GRAPHICS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0101.PAS">Original</a><b>]</b></p></body>
</html>
