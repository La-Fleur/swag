<html>
<head><title> "Simple 320x200x256 graphi" by CHRIS AUSTIN</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to GRAPHICS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0197.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code>
<font color="#FF0000"><b>Unit </b></font>Graphic<font color="#000080">;
</font><font color="#008000"><i>{Graphics routines Chris Austin and SWAG}
</i></font><font color="#FF0000"><b>Interface
Var </b></font>ScrBase <font color="#000080">: </font>Word<font color="#000080">;
  </font><font color="#FF0000"><b>Procedure </b></font>VideoMode <font color="#000080">( </font>Mode <font color="#000080">: </font>Byte <font color="#000080">);
  </font><font color="#FF0000"><b>Procedure </b></font>SetColor <font color="#000080">( </font>Color<font color="#000080">, </font>Red<font color="#000080">, </font>Green<font color="#000080">, </font>Blue <font color="#000080">: </font>Byte <font color="#000080">);
  </font><font color="#FF0000"><b>Procedure </b></font>Pset<font color="#000080">(</font>X<font color="#000080">,</font>Y<font color="#000080">,</font>C <font color="#000080">: </font>Word<font color="#000080">);
  </font><font color="#FF0000"><b>Procedure </b></font>Line<font color="#000080">(</font>x<font color="#000080">,</font>y<font color="#000080">,</font>x2<font color="#000080">,</font>y2<font color="#000080">:</font>word<font color="#000080">; </font>color<font color="#000080">:</font>byte<font color="#000080">);
  </font><font color="#FF0000"><b>Procedure </b></font>WaitRetrace<font color="#000080">;
</font><font color="#FF0000"><b>implementation

    Procedure </b></font>WaitRetrace<font color="#000080">; </font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>Asm
        </b></font><font color="#FF00FF">mov     dx,3dah
@L1:
        in      al,dx
        test    al,08h
        jne     @L1
@L2:
        in      al,dx
        test    al,08h
        je      @L2
      </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>Procedure </b></font>VideoMode <font color="#000080">( </font>Mode <font color="#000080">: </font>Byte <font color="#000080">);
    </font><font color="#FF0000"><b>Begin </b></font><font color="#008000"><i>{ VideoMode }
      </i></font><font color="#FF0000"><b>Asm
        </b></font><font color="#FF00FF">Mov  AH,00
        Mov  AL,Mode
        Int  10h
      </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>End</b></font><font color="#000080">;  </font><font color="#008000"><i>{ VideoMode }

  </i></font><font color="#FF0000"><b>Procedure </b></font>SetColor <font color="#000080">( </font>Color<font color="#000080">, </font>Red<font color="#000080">, </font>Green<font color="#000080">, </font>Blue <font color="#000080">: </font>Byte <font color="#000080">);
    </font><font color="#FF0000"><b>Begin </b></font><font color="#008000"><i>{ SetColor }
      </i></font>Port<font color="#000080">[</font><font color="#800000">$3C8</font><font color="#000080">] := </font>Color<font color="#000080">;
      </font>Port<font color="#000080">[</font><font color="#800000">$3C9</font><font color="#000080">] := </font>Red<font color="#000080">;
      </font>Port<font color="#000080">[</font><font color="#800000">$3C9</font><font color="#000080">] := </font>Green<font color="#000080">;
      </font>Port<font color="#000080">[</font><font color="#800000">$3C9</font><font color="#000080">] := </font>Blue<font color="#000080">;
    </font><font color="#FF0000"><b>End</b></font><font color="#000080">;  </font><font color="#008000"><i>{ SetColor }

</i></font><font color="#FF0000"><b>procedure </b></font>Pset<font color="#000080">(</font>X<font color="#000080">,</font>Y<font color="#000080">,</font>C <font color="#000080">: </font>Word<font color="#000080">);
</font><font color="#FF0000"><b>begin
</b></font>Mem<font color="#000080">[</font><font color="#800000">$0A000</font><font color="#000080">+</font>Y<font color="#000080">*</font><font color="#800000">320</font><font color="#000080">+</font>X<font color="#000080">] := </font>C<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>line<font color="#000080">(</font>x<font color="#000080">,</font>y<font color="#000080">,</font>x2<font color="#000080">,</font>y2<font color="#000080">:</font>word<font color="#000080">; </font>color<font color="#000080">:</font>byte<font color="#000080">);</font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;</font><font color="#FF0000"><b>asm </b></font><font color="#008000"><i>{mode 13}
 </i></font><font color="#FF00FF">mov ax,$A000
 mov es,ax
 mov bx,x
 mov ax,y
 mov cx,x2
 mov si,y2
 cmp ax,si
 jbe @NO_SWAP   </font><font color="#008000"><i>{always draw downwards}
 </i></font><font color="#FF00FF">xchg bx,cx
 xchg ax,si
@NO_SWAP:
 sub si,ax         </font><font color="#008000"><i>{yd (pos)}
 </i></font><font color="#FF00FF">sub cx,bx         </font><font color="#008000"><i>{xd (+/-)}
 </i></font><font color="#FF00FF">cld               </font><font color="#008000"><i>{set up direction flag}
 </i></font><font color="#FF00FF">jns @H_ABS
 neg cx      </font><font color="#008000"><i>{make x positive}
 </i></font><font color="#FF00FF">std
@H_ABS:
 mov di,320
 mul di
 mov di,ax
 add di,bx   </font><font color="#008000"><i>{di:adr}
 </i></font><font color="#FF00FF">or si,si
 jnz @NOT_H
</font><font color="#008000"><i>{horizontal line}
 </i></font><font color="#FF00FF">cld
 mov al,color
 inc cx
 rep stosb
 jmp @EXIT
@NOT_H:
 or cx,cx
 jnz @NOT_V
</font><font color="#008000"><i>{vertical line}
 </i></font><font color="#FF00FF">cld
 mov al,color
 mov cx,si
 inc cx
 mov bx,320-1
@VLINE_LOOP:
 stosb
 add di,bx
 loop @VLINE_LOOP
 jmp @EXIT
@NOT_V:
 cmp cx,si    </font><font color="#008000"><i>{which is greater distance?}
 </i></font><font color="#FF00FF">lahf         </font><font color="#008000"><i>{then store flags}
 </i></font><font color="#FF00FF">ja @H_IND
 xchg cx,si   </font><font color="#008000"><i>{swap for redundant calcs}
</i></font><font color="#FF00FF">@H_IND:
 mov dx,si    </font><font color="#008000"><i>{inc2 (adjustment when decision var rolls over)}
 </i></font><font color="#FF00FF">sub dx,cx
 shl dx,1
 shl si,1     </font><font color="#008000"><i>{inc1 (step for decision var)}
 </i></font><font color="#FF00FF">mov bx,si    </font><font color="#008000"><i>{decision var, tells when we need to go secondary direction}
 </i></font><font color="#FF00FF">sub bx,cx
 inc cx
 push bp      </font><font color="#008000"><i>{need another register to hold often-used constant}
 </i></font><font color="#FF00FF">mov bp,320
 mov al,color
 sahf         </font><font color="#008000"><i>{restore flags}
 </i></font><font color="#FF00FF">jb @DIAG_V
</font><font color="#008000"><i>{mostly-horizontal diagonal line}
 </i></font><font color="#FF00FF">or bx,bx     </font><font color="#008000"><i>{set flags initially, set at end of loop for other iterations}
</i></font><font color="#FF00FF">@LH:
 stosb        </font><font color="#008000"><i>{plot and move x, doesn't affect flags}
 </i></font><font color="#FF00FF">jns @SH      </font><font color="#008000"><i>{decision var rollover in bx?}
 </i></font><font color="#FF00FF">add bx,si
 loop @LH   </font><font color="#008000"><i>{doesn't affect flags}
 </i></font><font color="#FF00FF">jmp @X
@SH:
 add di,bp
 add bx,dx
 loop @LH   </font><font color="#008000"><i>{doesn't affect flags}
 </i></font><font color="#FF00FF">jmp @X
@DIAG_V:
</font><font color="#008000"><i>{mostly-vertical diagonal line}
 </i></font><font color="#FF00FF">or bx,bx    </font><font color="#008000"><i>{set flags initially, set at end of loop for other iterations}
</i></font><font color="#FF00FF">@LV:
 mov es:[di],al   </font><font color="#008000"><i>{plot, doesn't affect flags}
 </i></font><font color="#FF00FF">jns @SV          </font><font color="#008000"><i>{decision var rollover in bx?}
 </i></font><font color="#FF00FF">add di,bp        </font><font color="#008000"><i>{update y coord}
 </i></font><font color="#FF00FF">add bx,si
 loop @LV         </font><font color="#008000"><i>{doesn't affect flags}
 </i></font><font color="#FF00FF">jmp @X
@SV:
 scasb   </font><font color="#008000"><i>{sure this is superfluous but it's a quick way to inc/dec x coord!}
 </i></font><font color="#FF00FF">add di,bp        </font><font color="#008000"><i>{update y coord}
 </i></font><font color="#FF00FF">add bx,dx
 loop @LV         </font><font color="#008000"><i>{doesn't affect flags}
</i></font><font color="#FF00FF">@X:
 pop bp
@EXIT:
 </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>End</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to GRAPHICS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0197.PAS">Original</a><b>]</b></p></body>
</html>
