<html>
<head><title> "Fast Polygons" by DAAN DE HAAS</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to GRAPHICS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0108.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
This unit draws polygons fast. It draws only polygons which are monotone
vertical. That means only polygons which you can fill with continues horizontal
lines. Fortunately that are the polygons which are mostly used in 3d graphics.
}

{*****************************************************************}
{* UnitName    : FASTPOLY.PAS                                    *}
{* Purpose     : Draw monotone vertical polygons fast            *}
{* Version     : 1.5                                             *}
{* Author      : Daan de Haas                                    *}
{* Date        : 20/10/1993                                      *}
{* Last update :  9/06/1994                                      *}
{* Language    : Borland Turbo Pascal 7.0                        *}
{* Fidonet     : Daan de Haas (2:500/104.6141)                   *}
{* Internet    : Daan.de.Haas@p6141.f104.n500.z2.fidonet.org     *}
{*****************************************************************}

{* VGA mode $13 and 386 processor *}
{* Literatur : Dr Dobb's XSharp   *}

{$R-,S-,Q-,I-}

</i></font><font color="#FF0000"><b>UNIT </b></font>FastPoly<font color="#000080">;

</font><font color="#008000"><i>{**************************} </i></font><font color="#FF0000"><b>INTERFACE </b></font><font color="#008000"><i>{**************************}

</i></font><font color="#FF0000"><b>TYPE
  </b></font>PPoint <font color="#000080">= ^</font>TPoint<font color="#000080">;
  </font>TPoint <font color="#000080">= </font><font color="#FF0000"><b>RECORD
             </b></font>x<font color="#000080">,</font>y<font color="#000080">:</font>integer<font color="#000080">;
           </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
  </font>PPolygon <font color="#000080">= ^</font>TPolygon<font color="#000080">;
  </font>PPointsList <font color="#000080">= ^</font>TPointsList<font color="#000080">;
  </font>TPointsList <font color="#000080">= </font><font color="#FF0000"><b>ARRAY</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">9999</font><font color="#000080">] </font><font color="#FF0000"><b>OF </b></font>TPoint<font color="#000080">;
  </font>TPolygon <font color="#000080">= </font><font color="#FF0000"><b>RECORD
               </b></font>length<font color="#000080">,</font>color<font color="#000080">:</font>word<font color="#000080">;
               </font>PointPtr<font color="#000080">:</font>PPointsList<font color="#000080">;
             </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
  </font>PHLine <font color="#000080">= ^</font>THLine<font color="#000080">;
  </font>THLine <font color="#000080">= </font><font color="#FF0000"><b>RECORD
             </b></font>XStart<font color="#000080">,</font>XEnd<font color="#000080">:</font>word<font color="#000080">;
           </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
  </font>PHLineArray <font color="#000080">= ^</font>THLineArray<font color="#000080">;
  </font>THLineArray <font color="#000080">= </font><font color="#FF0000"><b>ARRAY</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">9999</font><font color="#000080">] </font><font color="#FF0000"><b>OF </b></font>THLine<font color="#000080">;
  </font>THLineList <font color="#000080">= </font><font color="#FF0000"><b>RECORD
                 </b></font>length<font color="#000080">,</font>YStart<font color="#000080">:</font>integer<font color="#000080">;
                 </font>HLinePtr <font color="#000080">: </font>PHLineArray<font color="#000080">;
               </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>PROCEDURE </b></font>HLine<font color="#000080">(</font>x1<font color="#000080">,</font>y1<font color="#000080">,</font>x2<font color="#000080">:</font>word<font color="#000080">; </font>color<font color="#000080">:</font>word<font color="#000080">);
</font><font color="#FF0000"><b>PROCEDURE </b></font>InitPoly<font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>p<font color="#000080">:</font>TPolygon<font color="#000080">; </font>len<font color="#000080">,</font>col<font color="#000080">:</font>word<font color="#000080">);
</font><font color="#FF0000"><b>PROCEDURE </b></font>DonePoly<font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>p<font color="#000080">:</font>TPolygon<font color="#000080">);
</font><font color="#FF0000"><b>PROCEDURE </b></font>FillMonotoneVerticalPolygon<font color="#000080">(</font>XOffset<font color="#000080">,</font>YOffset<font color="#000080">:</font>word<font color="#000080">;
                                      </font>VertexList<font color="#000080">:</font>TPolygon<font color="#000080">);

</font><font color="#FF0000"><b>CONST
  </b></font>MaxX<font color="#000080">=</font><font color="#800000">320</font><font color="#000080">;
  </font>MaxY<font color="#000080">=</font><font color="#800000">200</font><font color="#000080">;
  </font>VidSegment<font color="#000080">=</font><font color="#800000">$A000</font><font color="#000080">;

</font><font color="#008000"><i>{************************} </i></font><font color="#FF0000"><b>IMPLEMENTATION </b></font><font color="#008000"><i>{***********************}

</i></font><font color="#FF0000"><b>PROCEDURE </b></font>HLine<font color="#000080">; </font><font color="#FF0000"><b>ASSEMBLER</b></font><font color="#000080">;
</font><font color="#FF0000"><b>ASM
  </b></font><font color="#FF00FF">mov ax,x1             </font><font color="#008000"><i>{ x1 &lt; x2 }
  </i></font><font color="#FF00FF">cmp ax,x2
  jl  @@skip1
  je  @@lijnexit
  xchg ax,x2
  mov  x1,ax
@@skip1:
  mov ax,maxX           </font><font color="#008000"><i>{ calculate y1*maxX+x1 }
  </i></font><font color="#FF00FF">mul y1
  add ax,x1
@@1:
  mov di,ax             </font><font color="#008000"><i>{ dx=segment, di=offset }
  </i></font><font color="#FF00FF">mov ax,VidSegment

@@skip2:
  cld                   </font><font color="#008000"><i>{ forward direction }
  </i></font><font color="#FF00FF">mov cx,x2
  sub cx,x1
  inc cx                </font><font color="#008000"><i>{ cx = number of pixels in line }
  </i></font><font color="#FF00FF">mov dx,di
  add dx,cx
  mov es,ax             </font><font color="#008000"><i>{ load segment register }
  </i></font><font color="#FF00FF">mov ax,color          </font><font color="#008000"><i>{ get color into 386 register eax }
  </i></font><font color="#FF00FF">mov ah,al
  mov dx,ax
  db  $66,$c1,$e0,$10   </font><font color="#008000"><i>{ shl eax,16 (386 code) }
  </i></font><font color="#FF00FF">mov ax,dx
  test di,00000011b
  jz @@skip             </font><font color="#008000"><i>{ test for doubleword border, if so jump }
</i></font><font color="#FF00FF">@@waitdd:
  mov  es:[di],al       </font><font color="#008000"><i>{ put one pixel }
  </i></font><font color="#FF00FF">inc  di               </font><font color="#008000"><i>{ di:=next pixel address }
  </i></font><font color="#FF00FF">test di,00000011b     </font><font color="#008000"><i>{ doubleword border  ? }
  </i></font><font color="#FF00FF">loopnz @@waitdd       </font><font color="#008000"><i>{ stop if cx=0 or zeroflag 1 }
  </i></font><font color="#FF00FF">or  cx,cx             </font><font color="#008000"><i>{ cx=0 ? }
  </i></font><font color="#FF00FF">jz  @@lijnexit        </font><font color="#008000"><i>{ if so, line is ready }
  </i></font><font color="#FF00FF">cmp cx,4              </font><font color="#008000"><i>{ is a stosd possible ? }
  </i></font><font color="#FF00FF">jl  @@waitdd          </font><font color="#008000"><i>{ no, then pixel after pixel }
</i></font><font color="#FF00FF">@@skip:
  mov  dx,cx
  shr  cx,2
  db   $f3,$66,$AB      </font><font color="#008000"><i>{ rep stosd (386 code) }
  </i></font><font color="#FF00FF">mov  cx,dx
  and cx,00000011b      </font><font color="#008000"><i>{ line finished ? }
  </i></font><font color="#FF00FF">jnz @@waitdd
@@lijnexit:
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>PROCEDURE </b></font>ScanEdge<font color="#000080">(</font>x1<font color="#000080">,</font>y1<font color="#000080">,</font>x2<font color="#000080">,</font>y2<font color="#000080">,</font>SetXStart<font color="#000080">,</font>SkipFirst<font color="#000080">:</font>integer<font color="#000080">;
                   </font><font color="#FF0000"><b>VAR </b></font>EdgePointPtr<font color="#000080">:</font>PHLineArray<font color="#000080">); </font><font color="#FF0000"><b>ASSEMBLER</b></font><font color="#000080">;
</font><font color="#008000"><i>{ Scan converts an edge from (X1,Y1) to (X2,Y2), not including the
 point at (X2,Y2). If SkipFirst == 1, the point at (X1,Y1) isn't
 drawn; if SkipFirst == 0, it is. For each scan line, the pixel
 closest to the scanned edge without being to the left of the scanned
 edge is chosen. Uses an all-integer approach for speed &amp; precision.

 Edges must not go bottom to top; that is, Y1 must be &lt;= Y2.
 Updates the pointer pointed to by EdgePointPtr to point to the next
 free entry in the array of HLine structures. }

</i></font><font color="#FF0000"><b>VAR
  </b></font>AdvanceAmt<font color="#000080">,</font>Height<font color="#000080">:</font>word<font color="#000080">;

</font><font color="#FF0000"><b>ASM
 </b></font><font color="#FF00FF">les di,EdgePointPtr
 les di,es:[di]  </font><font color="#008000"><i>{ point to the HLine array }
 </i></font><font color="#FF00FF">cmp SetXStart,1      </font><font color="#008000"><i>{ set the XStart field of each HLine
     { struc? }
 </i></font><font color="#FF00FF">jz @@HLinePtrSet  </font><font color="#008000"><i>{ yes, DI points to the first XStart }
 </i></font><font color="#FF00FF">add di,2   </font><font color="#008000"><i>{ no, point to the XEnd field of the }
     {  first HLine struc }
</i></font><font color="#FF00FF">@@HLinePtrSet:
 mov bx,Y2
 sub bx,Y1         </font><font color="#008000"><i>{ edge height }
 </i></font><font color="#FF00FF">jle @@ToScanEdgeExit</font><font color="#008000"><i>{ guard against 0-length &amp; horz edges }
 </i></font><font color="#FF00FF">mov Height,bx </font><font color="#008000"><i>{ Height = Y2 - Y1 }
 </i></font><font color="#FF00FF">sub cx,cx  </font><font color="#008000"><i>{ assume ErrorTerm starts at 0 (true if }
                                {  we're moving right as we draw) }
 </i></font><font color="#FF00FF">mov dx,1  </font><font color="#008000"><i>{ assume AdvanceAmt = 1 (move right) }
 </i></font><font color="#FF00FF">mov ax,X2
 sub ax,X1           </font><font color="#008000"><i>{ DeltaX = X2 - X1 }
        </i></font><font color="#FF00FF">jz      @@IsVertical   </font><font color="#008000"><i>{ it's a vertical edge--special case it }
 </i></font><font color="#FF00FF">jns @@SetAdvanceAmt </font><font color="#008000"><i>{ DeltaX &gt;= 0 }
 </i></font><font color="#FF00FF">mov cx,1  </font><font color="#008000"><i>{ DeltaX &lt; 0 (move left as we draw) }
 </i></font><font color="#FF00FF">sub cx,bx  </font><font color="#008000"><i>{ ErrorTerm = -Height + 1 }
 </i></font><font color="#FF00FF">neg dx  </font><font color="#008000"><i>{ AdvanceAmt = -1 (move left) }
        </i></font><font color="#FF00FF">neg     ax              </font><font color="#008000"><i>{ Width = abs(DeltaX) }
</i></font><font color="#FF00FF">@@SetAdvanceAmt:
 mov AdvanceAmt,dx
</font><font color="#008000"><i>{ Figure out whether the edge is diagonal, X-major (more horizontal), }
{ or Y-major (more vertical) and handle appropriately. }
 </i></font><font color="#FF00FF">cmp ax,bx  </font><font color="#008000"><i>{ if Width==Height, it's a diagonal edge }
 </i></font><font color="#FF00FF">jz @@IsDiagonal </font><font color="#008000"><i>{ it's a diagonal edge--special case }
 </i></font><font color="#FF00FF">jb @@YMajor </font><font color="#008000"><i>{ it's a Y-major (more vertical) edge }
    { it's an X-major (more horz) edge }
        </i></font><font color="#FF00FF">sub     dx,dx           </font><font color="#008000"><i>{ prepare DX:AX (Width) for division }
        </i></font><font color="#FF00FF">div     bx  </font><font color="#008000"><i>{ Width/Height }
    { DX = error term advance per scan line }
 </i></font><font color="#FF00FF">mov si,ax  </font><font color="#008000"><i>{ SI = minimum # of pixels to advance X }
    { on each scan line }
        </i></font><font color="#FF00FF">test    AdvanceAmt,8000h </font><font color="#008000"><i>{ move left or right? }
        </i></font><font color="#FF00FF">jz      @@XMajorAdvanceAmtSet   </font><font color="#008000"><i>{ right, already set }
        </i></font><font color="#FF00FF">neg     si              </font><font color="#008000"><i>{ left, negate the distance to advance }
    { on each scan line }
</i></font><font color="#FF00FF">@@XMajorAdvanceAmtSet:
 mov ax,X1  </font><font color="#008000"><i>{ starting X coordinate }
        </i></font><font color="#FF00FF">cmp     SkipFirst,1 </font><font color="#008000"><i>{ skip the first point? }
        </i></font><font color="#FF00FF">jz @@XMajorSkipEntry  </font><font color="#008000"><i>{ yes }
</i></font><font color="#FF00FF">@@XMajorLoop:
 mov es:[di],ax  </font><font color="#008000"><i>{ store the current X value }
 </i></font><font color="#FF00FF">add di,4     </font><font color="#008000"><i>{ point to the next HLine struc }
</i></font><font color="#FF00FF">@@XMajorSkipEntry:
 add ax,si  </font><font color="#008000"><i>{ set X for the next scan line }
 </i></font><font color="#FF00FF">add cx,dx  </font><font color="#008000"><i>{ advance error term }
 </i></font><font color="#FF00FF">jle @@XMajorNoAdvance </font><font color="#008000"><i>{ not time for X coord to advance one }
    { extra }
 </i></font><font color="#FF00FF">add ax,AdvanceAmt </font><font color="#008000"><i>{ advance X coord one extra }
        </i></font><font color="#FF00FF">sub     cx,Height     </font><font color="#008000"><i>{ adjust error term back }
</i></font><font color="#FF00FF">@@XMajorNoAdvance:
        dec     bx  </font><font color="#008000"><i>{ count off this scan line }
        </i></font><font color="#FF00FF">jnz     @@XMajorLoop
 jmp @@ScanEdgeDone
@@ToScanEdgeExit:
 jmp @@ScanEdgeExit
@@IsVertical:
 mov ax,X1 </font><font color="#008000"><i>{ starting (and only) X coordinate }
 </i></font><font color="#FF00FF">sub bx,SkipFirst </font><font color="#008000"><i>{ loop count = Height - SkipFirst }
        </i></font><font color="#FF00FF">jz      @@ScanEdgeExit  </font><font color="#008000"><i>{ no scan lines left after skipping 1st }
</i></font><font color="#FF00FF">@@VerticalLoop:
 mov es:[di],ax  </font><font color="#008000"><i>{ store the current X value }
 </i></font><font color="#FF00FF">add di,4 </font><font color="#008000"><i>{ point to the next HLine struc }
 </i></font><font color="#FF00FF">dec bx  </font><font color="#008000"><i>{ count off this scan line }
 </i></font><font color="#FF00FF">jnz @@VerticalLoop
 jmp @@ScanEdgeDone
@@IsDiagonal:
 mov ax,X1 </font><font color="#008000"><i>{ starting X coordinate }
        </i></font><font color="#FF00FF">cmp     SkipFirst,1 </font><font color="#008000"><i>{ skip the first point? }
 </i></font><font color="#FF00FF">jz @@DiagonalSkipEntry </font><font color="#008000"><i>{ yes }
</i></font><font color="#FF00FF">@@DiagonalLoop:
 mov es:[di],ax  </font><font color="#008000"><i>{ store the current X value }
 </i></font><font color="#FF00FF">add di,4 </font><font color="#008000"><i>{ point to the next HLine struc }
</i></font><font color="#FF00FF">@@DiagonalSkipEntry:
 add ax,dx  </font><font color="#008000"><i>{ advance the X coordinate }
 </i></font><font color="#FF00FF">dec bx  </font><font color="#008000"><i>{ count off this scan line }
 </i></font><font color="#FF00FF">jnz @@DiagonalLoop
 jmp @@ScanEdgeDone

@@YMajor:
 push bp </font><font color="#008000"><i>{ preserve stack frame pointer }
 </i></font><font color="#FF00FF">mov si,X1  </font><font color="#008000"><i>{ starting X coordinate }
        </i></font><font color="#FF00FF">cmp     SkipFirst,1 </font><font color="#008000"><i>{ skip the first point? }
 </i></font><font color="#FF00FF">mov bp,bx </font><font color="#008000"><i>{ put Height in BP for error term calcs }
        </i></font><font color="#FF00FF">jz @@YMajorSkipEntry </font><font color="#008000"><i>{ yes, skip the first point }
</i></font><font color="#FF00FF">@@YMajorLoop:
 mov es:[di],si </font><font color="#008000"><i>{ store the current X value }
 </i></font><font color="#FF00FF">add di,4 </font><font color="#008000"><i>{ point to the next HLine struc }
</i></font><font color="#FF00FF">@@YMajorSkipEntry:
 add cx,ax  </font><font color="#008000"><i>{ advance the error term }
 </i></font><font color="#FF00FF">jle @@YMajorNoAdvance </font><font color="#008000"><i>{ not time for X coord to advance }
 </i></font><font color="#FF00FF">add si,dx  </font><font color="#008000"><i>{ advance the X coordinate }
        </i></font><font color="#FF00FF">sub     cx,bp  </font><font color="#008000"><i>{ adjust error term back }
</i></font><font color="#FF00FF">@@YMajorNoAdvance:
        dec     bx  </font><font color="#008000"><i>{ count off this scan line }
        </i></font><font color="#FF00FF">jnz     @@YMajorLoop
 pop bp  </font><font color="#008000"><i>{ restore stack frame pointer }
</i></font><font color="#FF00FF">@@ScanEdgeDone:
 cmp SetXStart,1 </font><font color="#008000"><i>{ were we working with XStart field? }
 </i></font><font color="#FF00FF">jz @@UpdateHLinePtr </font><font color="#008000"><i>{ yes, DI points to the next XStart  }
 </i></font><font color="#FF00FF">sub di,2  </font><font color="#008000"><i>{ no, point back to the XStart field }
</i></font><font color="#FF00FF">@@UpdateHLinePtr:
        mov     bx,word ptr EdgePointPtr </font><font color="#008000"><i>{ point to pointer to HLine array }
 </i></font><font color="#FF00FF">mov ss:[bx],di  </font><font color="#008000"><i>{ update caller's HLine array pointer }
</i></font><font color="#FF00FF">@@ScanEdgeExit:
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>PROCEDURE </b></font>DrawHorizontalLineList<font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>list<font color="#000080">:</font>THLineList<font color="#000080">; </font>color<font color="#000080">:</font>word<font color="#000080">); </font><font color="#FF0000"><b>ASSEMBLER</b></font><font color="#000080">;
</font><font color="#FF0000"><b>ASM
  </b></font><font color="#FF00FF">les si,list
  mov cx,es:[si]                </font><font color="#008000"><i>{ cx = number of lines }
  </i></font><font color="#FF00FF">mov ax,es:[si+2]              </font><font color="#008000"><i>{ ax = startY }
  </i></font><font color="#FF00FF">les si,es:[si+4]              </font><font color="#008000"><i>{ es:si points to pointlist }
</i></font><font color="#FF00FF">@@loop:
  mov bx,es:[si]                </font><font color="#008000"><i>{ get startX }
  </i></font><font color="#FF00FF">mov dx,es:[si+2]              </font><font color="#008000"><i>{ get endX }
  </i></font><font color="#FF00FF">push cx                       </font><font color="#008000"><i>{ save registers }
  </i></font><font color="#FF00FF">push ax
  push si
  push es

  push bx                       </font><font color="#008000"><i>{ draw horizontal line }
  </i></font><font color="#FF00FF">push ax
  push dx
  mov  dx,color                 </font><font color="#008000"><i>{ get color }
  </i></font><font color="#FF00FF">push dx
  call HLine

  pop es                        </font><font color="#008000"><i>{ restore registers }
  </i></font><font color="#FF00FF">pop si
  pop ax
  pop cx
  inc ax                        </font><font color="#008000"><i>{ y:=y+1 }
  </i></font><font color="#FF00FF">add si,4                      </font><font color="#008000"><i>{ next points }
  </i></font><font color="#FF00FF">loop @@loop                   </font><font color="#008000"><i>{ if length=0 then stop }
</i></font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>PROCEDURE </b></font>FillMonotoneVerticalPolygon<font color="#000080">;
</font><font color="#FF0000"><b>VAR
  </b></font>i<font color="#000080">,</font>MinIndex<font color="#000080">,</font>MaxIndex<font color="#000080">,</font>MinPoint_y<font color="#000080">,</font>MaxPoint_y<font color="#000080">,</font>NextIndex<font color="#000080">,
  </font>CurrentIndex<font color="#000080">,</font>PreviousIndex<font color="#000080">:</font>integer<font color="#000080">;
  </font>WorkingHLineList<font color="#000080">:</font>THLineList<font color="#000080">;
  </font>EdgePointPtr<font color="#000080">:</font>PHLineArray<font color="#000080">;
  </font>VertexPtr<font color="#000080">:</font>PPointsList<font color="#000080">;
</font><font color="#FF0000"><b>BEGIN
  IF </b></font>VertexList<font color="#000080">.</font>Length<font color="#000080">=</font><font color="#800000">0 </font><font color="#FF0000"><b>THEN </b></font>Exit<font color="#000080">;
  </font>VertexPtr<font color="#000080">:=</font>VertexList<font color="#000080">.</font>PointPtr<font color="#000080">;
  </font>MaxPoint_y<font color="#000080">:=</font>VertexPtr<font color="#000080">^[</font><font color="#800000">0</font><font color="#000080">].</font>y<font color="#000080">;
  </font>MinPoint_y<font color="#000080">:=</font>MaxPoint_y<font color="#000080">;
  </font>MinIndex<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
  </font>MaxIndex<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
  </font><font color="#FF0000"><b>FOR </b></font>i<font color="#000080">:=</font><font color="#800000">1 </font><font color="#FF0000"><b>TO </b></font>VertexList<font color="#000080">.</font>Length<font color="#000080">-</font><font color="#800000">1 </font><font color="#FF0000"><b>DO
    WITH </b></font>VerTexPtr<font color="#000080">^[</font>i<font color="#000080">] </font><font color="#FF0000"><b>DO
      IF </b></font>y<font color="#000080">&lt;</font>MinPoint_y <font color="#FF0000"><b>THEN
        BEGIN
          </b></font>MinPoint_y<font color="#000080">:=</font>y<font color="#000080">;
          </font>MinIndex<font color="#000080">:=</font>i<font color="#000080">;
        </font><font color="#FF0000"><b>END
      ELSE
        IF </b></font>y<font color="#000080">&gt;</font>MaxPoint_y <font color="#FF0000"><b>THEN
          BEGIN
            </b></font>MaxPoint_y<font color="#000080">:=</font>y<font color="#000080">;
            </font>MaxIndex<font color="#000080">:=</font>i<font color="#000080">;
          </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>WITH </b></font>WorkingHLineList <font color="#FF0000"><b>DO
    BEGIN
      </b></font>length<font color="#000080">:=</font>MaxPoint_y<font color="#000080">-</font>MinPoint_y<font color="#000080">;
      </font><font color="#FF0000"><b>IF </b></font>length<font color="#000080">&lt;=</font><font color="#800000">0 </font><font color="#FF0000"><b>THEN </b></font>Exit<font color="#000080">;
      </font>YStart<font color="#000080">:=</font>YOffset<font color="#000080">+</font>MinPoint_y<font color="#000080">;
      </font>GetMem<font color="#000080">(</font>HLinePtr<font color="#000080">,</font>SizeOf<font color="#000080">(</font>THLine<font color="#000080">)*</font>length<font color="#000080">);
      </font>EdgePointPtr<font color="#000080">:=</font>HLinePtr<font color="#000080">;
    </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
  </font>CurrentIndex<font color="#000080">:=</font>MinIndex<font color="#000080">;
  </font>PreviousIndex<font color="#000080">:=</font>MinIndex<font color="#000080">;
  </font><font color="#FF0000"><b>REPEAT
    </b></font>CurrentIndex<font color="#000080">:=(</font>CurrentIndex<font color="#000080">+</font>VertexList<font color="#000080">.</font>length<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">) </font><font color="#FF0000"><b>MOD </b></font>VertexList<font color="#000080">.</font>length<font color="#000080">;
    </font>ScanEdge<font color="#000080">(</font>VertexPtr<font color="#000080">^[</font>PreviousIndex<font color="#000080">].</font>x<font color="#000080">+</font>XOffset<font color="#000080">,
             </font>VertexPtr<font color="#000080">^[</font>PreviousIndex<font color="#000080">].</font>y<font color="#000080">,
             </font>VertexPtr<font color="#000080">^[</font>CurrentIndex<font color="#000080">].</font>x<font color="#000080">+</font>XOffset<font color="#000080">,
             </font>VertexPtr<font color="#000080">^[</font>CurrentIndex<font color="#000080">].</font>y<font color="#000080">,
             </font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font>EdgePointPtr<font color="#000080">);
    </font>PreviousIndex<font color="#000080">:=</font>CurrentIndex<font color="#000080">;
  </font><font color="#FF0000"><b>UNTIL </b></font>CurrentIndex<font color="#000080">=</font>MaxIndex<font color="#000080">;
  </font>EdgePointPtr<font color="#000080">:=</font>WorkingHLineList<font color="#000080">.</font>HLinePtr<font color="#000080">;
  </font>CurrentIndex<font color="#000080">:=</font>MinIndex<font color="#000080">;
  </font>PreviousIndex<font color="#000080">:=</font>MinIndex<font color="#000080">;
  </font><font color="#FF0000"><b>REPEAT
    </b></font>CurrentIndex<font color="#000080">:=(</font>CurrentIndex<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">) </font><font color="#FF0000"><b>MOD </b></font>VertexList<font color="#000080">.</font>length<font color="#000080">;
    </font>ScanEdge<font color="#000080">(</font>VertexPtr<font color="#000080">^[</font>PreviousIndex<font color="#000080">].</font>x<font color="#000080">+</font>XOffset<font color="#000080">,
             </font>VertexPtr<font color="#000080">^[</font>PreviousIndex<font color="#000080">].</font>y<font color="#000080">,
             </font>VertexPtr<font color="#000080">^[</font>CurrentIndex<font color="#000080">].</font>x<font color="#000080">+</font>XOffset<font color="#000080">,
             </font>VertexPtr<font color="#000080">^[</font>CurrentIndex<font color="#000080">].</font>y<font color="#000080">,
             </font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font>EdgePointPtr<font color="#000080">);
    </font>PreviousIndex<font color="#000080">:=</font>CurrentIndex<font color="#000080">;
  </font><font color="#FF0000"><b>UNTIL </b></font>CurrentIndex<font color="#000080">=</font>MaxIndex<font color="#000080">;
  </font>DrawHorizontalLineList<font color="#000080">(</font>WorkingHLineList<font color="#000080">,</font>VertexList<font color="#000080">.</font>color<font color="#000080">);
  </font><font color="#FF0000"><b>WITH </b></font>WorkingHLineList <font color="#FF0000"><b>DO </b></font>FreeMem<font color="#000080">(</font>HLinePtr<font color="#000080">,</font>SizeOf<font color="#000080">(</font>THLine<font color="#000080">)*</font>length<font color="#000080">);
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>PROCEDURE </b></font>InitPoly<font color="#000080">;
</font><font color="#FF0000"><b>BEGIN
  WITH </b></font>p <font color="#FF0000"><b>DO
    BEGIN
      </b></font>length<font color="#000080">:=</font>len<font color="#000080">;
      </font>color<font color="#000080">:=</font>col<font color="#000080">;
      </font><font color="#008000"><i>{ No Error checking !}
      </i></font>GetMem<font color="#000080">(</font>PointPtr<font color="#000080">,</font>len<font color="#000080">*</font>SizeOf<font color="#000080">(</font>TPoint<font color="#000080">));
    </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>PROCEDURE </b></font>DonePoly<font color="#000080">;
</font><font color="#FF0000"><b>BEGIN
  WITH </b></font>p <font color="#FF0000"><b>DO
    BEGIN
      IF </b></font>PointPtr<font color="#000080">&lt;&gt;</font><font color="#FF0000"><b>NIL THEN </b></font>FreeMem<font color="#000080">(</font>PointPtr<font color="#000080">,</font>length<font color="#000080">*</font>SizeOf<font color="#000080">(</font>TPoint<font color="#000080">));
      </font>PointPtr<font color="#000080">:=</font><font color="#FF0000"><b>NIL</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>END</b></font><font color="#000080">.

</font><font color="#008000"><i>{*****************************************************************}
{* ProgramName : FASTPOL.PAS                                     *}
{* Purpose     : Demonstration of unit FastPoly                  *}
{* Version     : 1.0                                             *}
{* Author      : Daan de Haas                                    *}
{* Date        : 9 jun 1994                                      *}
{* Last update : 9 jun 1994                                      *}
{* Language    : Borland Pascal 7.0                              *}
{* Fidonet     : Daan de Haas (2:500/104.6141)                   *}
{* Internet    : Daan.de.Haas@p6141.f104.n500.z2.fidonet.org     *}
{*****************************************************************}

{$R-,I-,Q-,S-}

</i></font><font color="#FF0000"><b>USES
  </b></font>Crt<font color="#000080">, </font>FastPoly<font color="#000080">;

</font><font color="#FF0000"><b>PROCEDURE </b></font>SetVideo<font color="#000080">(</font>m<font color="#000080">:</font>word<font color="#000080">); </font><font color="#FF0000"><b>ASSEMBLER</b></font><font color="#000080">;
</font><font color="#FF0000"><b>ASM
  </b></font><font color="#FF00FF">mov ax,m
  int $10
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>PROCEDURE </b></font>Polydemo<font color="#000080">;
</font><font color="#FF0000"><b>VAR
  </b></font>p1<font color="#000080">,</font>p2<font color="#000080">:</font>TPolygon<font color="#000080">;
</font><font color="#FF0000"><b>BEGIN
  </b></font>InitPoly<font color="#000080">(</font>p1<font color="#000080">,</font><font color="#800000">6</font><font color="#000080">,</font>YELLOW<font color="#000080">);
  </font>p1<font color="#000080">.</font>PointPtr<font color="#000080">^[</font><font color="#800000">0</font><font color="#000080">].</font>X<font color="#000080">:=</font><font color="#800000">10</font><font color="#000080">;
  </font>p1<font color="#000080">.</font>PointPtr<font color="#000080">^[</font><font color="#800000">0</font><font color="#000080">].</font>Y<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
  </font>p1<font color="#000080">.</font>PointPtr<font color="#000080">^[</font><font color="#800000">1</font><font color="#000080">].</font>X<font color="#000080">:=</font><font color="#800000">20</font><font color="#000080">;
  </font>p1<font color="#000080">.</font>PointPtr<font color="#000080">^[</font><font color="#800000">1</font><font color="#000080">].</font>Y<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
  </font>p1<font color="#000080">.</font>PointPtr<font color="#000080">^[</font><font color="#800000">2</font><font color="#000080">].</font>X<font color="#000080">:=</font><font color="#800000">30</font><font color="#000080">;
  </font>p1<font color="#000080">.</font>PointPtr<font color="#000080">^[</font><font color="#800000">2</font><font color="#000080">].</font>Y<font color="#000080">:=</font><font color="#800000">10</font><font color="#000080">;
  </font>p1<font color="#000080">.</font>PointPtr<font color="#000080">^[</font><font color="#800000">3</font><font color="#000080">].</font>X<font color="#000080">:=</font><font color="#800000">20</font><font color="#000080">;
  </font>p1<font color="#000080">.</font>PointPtr<font color="#000080">^[</font><font color="#800000">3</font><font color="#000080">].</font>Y<font color="#000080">:=</font><font color="#800000">20</font><font color="#000080">;
  </font>p1<font color="#000080">.</font>PointPtr<font color="#000080">^[</font><font color="#800000">4</font><font color="#000080">].</font>X<font color="#000080">:=</font><font color="#800000">10</font><font color="#000080">;
  </font>p1<font color="#000080">.</font>PointPtr<font color="#000080">^[</font><font color="#800000">4</font><font color="#000080">].</font>Y<font color="#000080">:=</font><font color="#800000">20</font><font color="#000080">;
  </font>p1<font color="#000080">.</font>PointPtr<font color="#000080">^[</font><font color="#800000">5</font><font color="#000080">].</font>X<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
  </font>p1<font color="#000080">.</font>PointPtr<font color="#000080">^[</font><font color="#800000">5</font><font color="#000080">].</font>Y<font color="#000080">:=</font><font color="#800000">10</font><font color="#000080">;
  </font>InitPoly<font color="#000080">(</font>p2<font color="#000080">,</font><font color="#800000">6</font><font color="#000080">,</font>BLUE<font color="#000080">);
  </font>p2<font color="#000080">.</font>PointPtr<font color="#000080">^[</font><font color="#800000">0</font><font color="#000080">].</font>X<font color="#000080">:=</font><font color="#800000">10</font><font color="#000080">;
  </font>p2<font color="#000080">.</font>PointPtr<font color="#000080">^[</font><font color="#800000">0</font><font color="#000080">].</font>Y<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
  </font>p2<font color="#000080">.</font>PointPtr<font color="#000080">^[</font><font color="#800000">1</font><font color="#000080">].</font>X<font color="#000080">:=</font><font color="#800000">20</font><font color="#000080">;
  </font>p2<font color="#000080">.</font>PointPtr<font color="#000080">^[</font><font color="#800000">1</font><font color="#000080">].</font>Y<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
  </font>p2<font color="#000080">.</font>PointPtr<font color="#000080">^[</font><font color="#800000">2</font><font color="#000080">].</font>X<font color="#000080">:=</font><font color="#800000">30</font><font color="#000080">;
  </font>p2<font color="#000080">.</font>PointPtr<font color="#000080">^[</font><font color="#800000">2</font><font color="#000080">].</font>Y<font color="#000080">:=</font><font color="#800000">10</font><font color="#000080">;
  </font>p2<font color="#000080">.</font>PointPtr<font color="#000080">^[</font><font color="#800000">3</font><font color="#000080">].</font>X<font color="#000080">:=</font><font color="#800000">20</font><font color="#000080">;
  </font>p2<font color="#000080">.</font>PointPtr<font color="#000080">^[</font><font color="#800000">3</font><font color="#000080">].</font>Y<font color="#000080">:=</font><font color="#800000">20</font><font color="#000080">;
  </font>p2<font color="#000080">.</font>PointPtr<font color="#000080">^[</font><font color="#800000">4</font><font color="#000080">].</font>X<font color="#000080">:=</font><font color="#800000">10</font><font color="#000080">;
  </font>p2<font color="#000080">.</font>PointPtr<font color="#000080">^[</font><font color="#800000">4</font><font color="#000080">].</font>Y<font color="#000080">:=</font><font color="#800000">20</font><font color="#000080">;
  </font>p2<font color="#000080">.</font>PointPtr<font color="#000080">^[</font><font color="#800000">5</font><font color="#000080">].</font>X<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
  </font>p2<font color="#000080">.</font>PointPtr<font color="#000080">^[</font><font color="#800000">5</font><font color="#000080">].</font>Y<font color="#000080">:=</font><font color="#800000">10</font><font color="#000080">;
  </font><font color="#FF0000"><b>REPEAT
    </b></font>FillMonotoneVerticalPolygon<font color="#000080">(</font>Random<font color="#000080">(</font>MaxX<font color="#000080">-</font><font color="#800000">35</font><font color="#000080">),</font>Random<font color="#000080">(</font>MaxY<font color="#000080">-</font><font color="#800000">25</font><font color="#000080">),</font>p1<font color="#000080">);
    </font>FillMonotoneVerticalPolygon<font color="#000080">(</font>Random<font color="#000080">(</font>MaxX<font color="#000080">-</font><font color="#800000">35</font><font color="#000080">),</font>Random<font color="#000080">(</font>MaxY<font color="#000080">-</font><font color="#800000">25</font><font color="#000080">),</font>p2<font color="#000080">);
  </font><font color="#FF0000"><b>UNTIL </b></font>KeyPressed<font color="#000080">;
  </font>ReadKey<font color="#000080">;
  </font>DonePoly<font color="#000080">(</font>p1<font color="#000080">);
  </font>DonePoly<font color="#000080">(</font>p2<font color="#000080">);
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>BEGIN
  </b></font>ClrScr<font color="#000080">;
  </font>Randomize<font color="#000080">;
  </font>SetVideo<font color="#000080">(</font><font color="#800000">$13</font><font color="#000080">);
  </font>PolyDemo<font color="#000080">;
  </font>SetVideo<font color="#000080">(</font><font color="#800000">3</font><font color="#000080">);
</font><font color="#FF0000"><b>END</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to GRAPHICS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0108.PAS">Original</a><b>]</b></p></body>
</html>
