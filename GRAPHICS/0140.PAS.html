<html>
<head><title> "Gouraud Shading" by JOHN HOWARD</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to GRAPHICS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0140.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
Here is the GOURAUD shading include file that came with Surface Modeler 3.0:
}
</i></font><font color="#FF0000"><b>procedure </b></font>GOURAUD<font color="#000080">;
</font><font color="#008000"><i>{ Make a surface model drawing of the object with Gouraud interpolation
  of surface shading }

</i></font><font color="#FF0000"><b>var </b></font>Node<font color="#000080">:                      </font>word<font color="#000080">;          </font><font color="#008000"><i>{ node # }
    </i></font>Surf<font color="#000080">:                      </font>word<font color="#000080">;          </font><font color="#008000"><i>{ surface # }
    </i></font>Shade<font color="#000080">:                     </font>real<font color="#000080">;          </font><font color="#008000"><i>{ shade of surface }
    </i></font>Shade2<font color="#000080">:                    </font>real<font color="#000080">;          </font><font color="#008000"><i>{ shade of 2nd side of surface }
    </i></font>Vert<font color="#000080">:                      </font>integer<font color="#000080">;       </font><font color="#008000"><i>{ vertex # }
    </i></font>Interp<font color="#000080">:                    </font>boolean<font color="#000080">;       </font><font color="#008000"><i>{ flag interpolated shading }
    </i></font>User_abort<font color="#000080">:                </font>boolean<font color="#000080">;       </font><font color="#008000"><i>{ did the user abort? }
    </i></font>ch<font color="#000080">:                        </font>char<font color="#000080">;
</font><font color="#008000"><i>{$ifndef BIGMEM}
    </i></font>Shades<font color="#000080">: </font>nodearray<font color="#000080">;
      </font><font color="#008000"><i>{ shade at each node }
    </i></font>Surfmin<font color="#000080">, </font>Surfmax<font color="#000080">: </font>surfaces<font color="#000080">;
      </font><font color="#008000"><i>{ surface minimum &amp; maximum (Ztran) }
    </i></font>Nshades<font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font>MAXNODES<font color="#000080">] </font><font color="#FF0000"><b>of </b></font>integer<font color="#000080">;
      </font><font color="#008000"><i>{ # shades to average per node }
    </i></font>Sshade<font color="#000080">: </font>surfaces<font color="#000080">;
      </font><font color="#008000"><i>{ shade at each surface }
{$endif}
</i></font><font color="#FF0000"><b>label </b></font>ABORTTEXT<font color="#000080">,                              </font><font color="#008000"><i>{ text-mode abort }
      </i></font>ABORTGRPH<font color="#000080">;                              </font><font color="#008000"><i>{ graphics-mode abort }

</i></font><font color="#FF0000"><b>begin
</b></font><font color="#008000"><i>{$ifdef BIGMEM}
</i></font><font color="#FF0000"><b>with </b></font>ptrh<font color="#000080">^ </font><font color="#FF0000"><b>do with </b></font>ptri<font color="#000080">^ </font><font color="#FF0000"><b>do with </b></font>ptrj<font color="#000080">^ </font><font color="#FF0000"><b>do
with </b></font>ptra<font color="#000080">^ </font><font color="#FF0000"><b>do with </b></font>ptrb<font color="#000080">^ </font><font color="#FF0000"><b>do with </b></font>ptrc<font color="#000080">^ </font><font color="#FF0000"><b>do
with </b></font>ptrd<font color="#000080">^ </font><font color="#FF0000"><b>do with </b></font>ptre<font color="#000080">^ </font><font color="#FF0000"><b>do with </b></font>ptrf<font color="#000080">^ </font><font color="#FF0000"><b>do
with </b></font>ptrh<font color="#000080">^ </font><font color="#FF0000"><b>do with </b></font>ptri<font color="#000080">^ </font><font color="#FF0000"><b>do with </b></font>ptrj<font color="#000080">^ </font><font color="#FF0000"><b>do
with </b></font>ptrk<font color="#000080">^ </font><font color="#FF0000"><b>do with </b></font>ptrl<font color="#000080">^ </font><font color="#FF0000"><b>do with </b></font>ptrm<font color="#000080">^ </font><font color="#FF0000"><b>do with </b></font>ptrn<font color="#000080">^ </font><font color="#FF0000"><b>do
begin
</b></font><font color="#008000"><i>{$endif}

  </i></font>perf_start<font color="#000080">;
  </font>User_abort <font color="#000080">:= </font>TRUE<font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>checkey<font color="#000080">) </font><font color="#FF0000"><b>then goto </b></font>ABORTTEXT<font color="#000080">;
</font><font color="#008000"><i>{$ifndef NOSHADOW}
  </i></font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>Shadowing<font color="#000080">) </font><font color="#FF0000"><b>then begin
    </b></font>shadows <font color="#000080">(</font>Shades<font color="#000080">);
    </font><font color="#FF0000"><b>for </b></font>Node <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>Nnodes <font color="#FF0000"><b>do
      </b></font>Nshades<font color="#000080">[</font>Node<font color="#000080">] := </font><font color="#800000">0</font><font color="#000080">;
  </font><font color="#FF0000"><b>end else
</b></font><font color="#008000"><i>{$else}
  </i></font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>Shadowing<font color="#000080">) </font><font color="#FF0000"><b>then
    </b></font>writeln <font color="#000080">(</font><font color="#800000">'Error: Shadows not implemented in this version'</font><font color="#000080">)
  </font><font color="#FF0000"><b>else
</b></font><font color="#008000"><i>{$endif}
    </i></font><font color="#FF0000"><b>for </b></font>Node <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>Nnodes <font color="#FF0000"><b>do begin
      </b></font>Shades<font color="#000080">[</font>Node<font color="#000080">] := </font><font color="#800000">0.0</font><font color="#000080">;
      </font>Nshades<font color="#000080">[</font>Node<font color="#000080">] := </font><font color="#800000">0</font><font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>Viewchanged<font color="#000080">) </font><font color="#FF0000"><b>or </b></font><font color="#000080">(</font>Shadowing<font color="#000080">) </font><font color="#FF0000"><b>then begin
    if </b></font><font color="#000080">(</font>checkey<font color="#000080">) </font><font color="#FF0000"><b>then goto </b></font>ABORTTEXT<font color="#000080">;
    </font>menumsg <font color="#000080">(</font><font color="#800000">'Transforming to 2-D...'</font><font color="#000080">);
</font><font color="#008000"><i>{ Transform from 3-D to 2-D coordinates }
    </i></font>setorigin<font color="#000080">;
    </font><font color="#FF0000"><b>for </b></font>Node <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>Nnodes <font color="#FF0000"><b>do
      </b></font>perspect <font color="#000080">(</font>Xworld<font color="#000080">[</font>Node<font color="#000080">], </font>Yworld<font color="#000080">[</font>Node<font color="#000080">], </font>Zworld<font color="#000080">[</font>Node<font color="#000080">],
                </font>Xtran<font color="#000080">[</font>Node<font color="#000080">],  </font>Ytran<font color="#000080">[</font>Node<font color="#000080">],  </font>Ztran<font color="#000080">[</font>Node<font color="#000080">]);

</font><font color="#008000"><i>{ Set plotting limits and normalize transformed coords to screen coords }
    </i></font>perspect <font color="#000080">(</font>Xfocal<font color="#000080">, </font>Yfocal<font color="#000080">, </font>Zfocal<font color="#000080">, </font>Xfotran<font color="#000080">, </font>Yfotran<font color="#000080">, </font>Zfotran<font color="#000080">);
    </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font><font color="#FF0000"><b>not </b></font>setnormal <font color="#000080">(</font>Xfotran<font color="#000080">, </font>Yfotran<font color="#000080">, </font>XYmax<font color="#000080">)) </font><font color="#FF0000"><b>then begin
      </b></font>menumsg <font color="#000080">(</font><font color="#800000">'Warning: Focal point outside data limits.'</font><font color="#000080">);
      </font>writeln<font color="#000080">;
      </font>write   <font color="#000080">(</font><font color="#800000">'  Press any key ...'</font><font color="#000080">);
      </font>ch <font color="#000080">:= </font>readkey<font color="#000080">;
    </font><font color="#008000"><i>{ Erase the previous message }
      </i></font>menumsg <font color="#000080">(</font><font color="#800000">''</font><font color="#000080">);
      </font>writeln<font color="#000080">;
      </font>write <font color="#000080">(</font><font color="#800000">'                          '</font><font color="#000080">);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

    </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>checkey<font color="#000080">) </font><font color="#FF0000"><b>then goto </b></font>ABORTTEXT<font color="#000080">;
</font><font color="#008000"><i>{ Normalize all the nodes }
    </i></font><font color="#FF0000"><b>for </b></font>Node <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>Nnodes <font color="#FF0000"><b>do
      </b></font>normalize <font color="#000080">(</font>Xtran<font color="#000080">[</font>Node<font color="#000080">], </font>Ytran<font color="#000080">[</font>Node<font color="#000080">], </font>Xfotran<font color="#000080">, </font>Yfotran<font color="#000080">, </font>XYmax<font color="#000080">);
    </font><font color="#008000"><i>{ Initialize all nodal shades to zero }

    </i></font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>checkey<font color="#000080">) </font><font color="#FF0000"><b>then goto </b></font>ABORTTEXT<font color="#000080">;
    </font>menumsg <font color="#000080">(</font><font color="#800000">'Sorting surfaces...'</font><font color="#000080">);
    </font>minmax <font color="#000080">(</font>Surfmin<font color="#000080">, </font>Surfmax<font color="#000080">, </font>Nsurf<font color="#000080">);
    </font>shelsurf <font color="#000080">(</font>Surfmin<font color="#000080">, </font>Surfmax<font color="#000080">, </font>Nsurf<font color="#000080">);
    </font>Viewchanged <font color="#000080">:= </font>FALSE<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{ if Viewchanged }

  </i></font>setshade<font color="#000080">;                            </font><font color="#008000"><i>{ Setup for shading calculations }

{ Compute the cumulative shading at every node (sum the shades due to
  all surrounding surfaces) }
  </i></font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>checkey<font color="#000080">) </font><font color="#FF0000"><b>then goto </b></font>ABORTTEXT<font color="#000080">;
  </font>menumsg <font color="#000080">(</font><font color="#800000">'Computing shades...'</font><font color="#000080">);
  </font><font color="#FF0000"><b>for </b></font>Surf <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>Nsurf <font color="#FF0000"><b>do begin
    if </b></font><font color="#000080">(</font>Nsides <font color="#000080">= </font><font color="#800000">2</font><font color="#000080">) </font><font color="#FF0000"><b>then begin
      </b></font><font color="#008000"><i>{ Use only the side of the surface with the brightest shade }
      </i></font>Shade <font color="#000080">:= </font>Shading <font color="#000080">(</font>Surf<font color="#000080">, </font><font color="#800000">1</font><font color="#000080">);
      </font>Shade2 <font color="#000080">:= </font>Shading <font color="#000080">(</font>Surf<font color="#000080">, </font><font color="#800000">2</font><font color="#000080">);
      </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>Shade2 <font color="#000080">&gt; </font>Shade<font color="#000080">) </font><font color="#FF0000"><b>then
        </b></font>Shade <font color="#000080">:= </font>Shade2<font color="#000080">;
    </font><font color="#FF0000"><b>end else
      </b></font>Shade <font color="#000080">:= </font>Shading <font color="#000080">(</font>Surf<font color="#000080">, </font><font color="#800000">1</font><font color="#000080">);
    </font><font color="#008000"><i>{ Surface shade }
    </i></font>Sshade<font color="#000080">[</font>Surf<font color="#000080">] := </font>Shade<font color="#000080">;
    </font><font color="#008000"><i>{ Nodal shade }
    </i></font><font color="#FF0000"><b>for </b></font>Vert <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>Nvert<font color="#000080">[</font>Surf<font color="#000080">] </font><font color="#FF0000"><b>do begin
      </b></font>Node <font color="#000080">:= </font>konnec <font color="#000080">(</font>Surf<font color="#000080">, </font>Vert<font color="#000080">);
      </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>Shade <font color="#000080">&gt;= </font><font color="#800000">0.0</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>Shades<font color="#000080">[</font>Node<font color="#000080">] &gt;= </font><font color="#800000">0.0</font><font color="#000080">) </font><font color="#FF0000"><b>then begin
        </b></font>Shades<font color="#000080">[</font>Node<font color="#000080">] := </font>Shades<font color="#000080">[</font>Node<font color="#000080">] + </font>Shade<font color="#000080">;
        </font>Nshades<font color="#000080">[</font>Node<font color="#000080">] := </font>Nshades<font color="#000080">[</font>Node<font color="#000080">] + </font><font color="#800000">1</font><font color="#000080">;
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{ for Vert }
  </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{ for Surf }

  </i></font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>checkey<font color="#000080">) </font><font color="#FF0000"><b>then goto </b></font>ABORTTEXT<font color="#000080">;
</font><font color="#008000"><i>{ Now average out the nodal shading }
  </i></font><font color="#FF0000"><b>for </b></font>Node <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>Nnodes <font color="#FF0000"><b>do
    if </b></font><font color="#000080">(</font>Nshades<font color="#000080">[</font>Node<font color="#000080">] &gt; </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>then
      </b></font>Shades<font color="#000080">[</font>Node<font color="#000080">] := </font>Shades<font color="#000080">[</font>Node<font color="#000080">] / </font>Nshades<font color="#000080">[</font>Node<font color="#000080">];

</font><font color="#008000"><i>{$ifdef USE_IFF}
  </i></font>menumsg <font color="#000080">(</font><font color="#800000">'Plotting...'</font><font color="#000080">);
</font><font color="#008000"><i>{$endif}

{ Now plot all the surfaces, with Gouraud shading }
  </i></font>setgmode <font color="#000080">(</font>Nmatl<font color="#000080">);
  </font><font color="#FF0000"><b>for </b></font>Surf <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>Nsurf <font color="#FF0000"><b>do begin
    if </b></font><font color="#000080">(</font>Sshade<font color="#000080">[</font>Surf<font color="#000080">] &gt;= </font><font color="#800000">0.0</font><font color="#000080">) </font><font color="#FF0000"><b>then begin
      </b></font>Interp <font color="#000080">:= </font>TRUE<font color="#000080">;
      </font><font color="#008000"><i>{ If any nodal shade varies from the average (surface) shade by more
        than Epsilon, then don't use interpolated shading (unless the node
        is in a shadow, in which case you should interpolate anyway) }
      </i></font><font color="#FF0000"><b>for </b></font>Vert <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>Nvert<font color="#000080">[</font>Surf<font color="#000080">] </font><font color="#FF0000"><b>do begin
        </b></font>Node <font color="#000080">:= </font>konnec <font color="#000080">(</font>Surf<font color="#000080">, </font>Vert<font color="#000080">);
        </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>abs<font color="#000080">(</font>Shades<font color="#000080">[</font>Node<font color="#000080">] - </font>Sshade<font color="#000080">[</font>Surf<font color="#000080">]) &gt; </font>Epsilon<font color="#000080">) </font><font color="#FF0000"><b>and
           </b></font><font color="#000080">(</font>Shades<font color="#000080">[</font>Node<font color="#000080">] &gt;= </font><font color="#800000">0.0</font><font color="#000080">) </font><font color="#FF0000"><b>then
          </b></font>Interp <font color="#000080">:= </font>FALSE<font color="#000080">;
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>Interp<font color="#000080">) </font><font color="#FF0000"><b>then
        </b></font>intrfill <font color="#000080">(</font>Surf<font color="#000080">, </font>Matl<font color="#000080">[</font>Surf<font color="#000080">], </font>Shades<font color="#000080">)
      </font><font color="#FF0000"><b>else
        </b></font>fillsurf <font color="#000080">(</font>Surf<font color="#000080">, </font>Matl<font color="#000080">[</font>Surf<font color="#000080">], </font>Sshade<font color="#000080">[</font>Surf<font color="#000080">]);
      </font><font color="#008000"><i>{ Show border of surface, if requested }
      </i></font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>ShowAllBorders <font color="#000080">&gt; </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>then
        </b></font>border <font color="#000080">(</font>Surf<font color="#000080">, </font>Matl<font color="#000080">[</font>Surf<font color="#000080">]);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{ if Sshade }
    </i></font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>grafstat<font color="#000080">) </font><font color="#FF0000"><b>then goto </b></font>ABORTGRPH<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{ for Surf }
  </i></font>drawaxes <font color="#000080">(</font>Xfotran<font color="#000080">, </font>Yfotran<font color="#000080">, </font>XYmax<font color="#000080">);

  </font>perf_stop <font color="#000080">(</font><font color="#800000">5</font><font color="#000080">);

</font><font color="#008000"><i>{$ifdef USE_IFF}
  </i></font>menumsg <font color="#000080">(</font><font color="#800000">'Saving IFF...'</font><font color="#000080">);
  </font>saveiff <font color="#000080">(</font>Filemask <font color="#000080">+ </font><font color="#800000">'.IFF'</font><font color="#000080">, </font>VGApal<font color="#000080">);
</font><font color="#008000"><i>{$else}
  { Wait for user keypress to continue }
  </i></font>continue<font color="#000080">;
</font><font color="#008000"><i>{$endif}
  </i></font>User_abort <font color="#000080">:= </font>FALSE<font color="#000080">;

  </font>ABORTGRPH<font color="#000080">:
  </font>exgraphic<font color="#000080">;
  </font>ABORTTEXT<font color="#000080">:
  </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>User_abort<font color="#000080">) </font><font color="#FF0000"><b>then
    </b></font>perf_stop <font color="#000080">(</font><font color="#800000">0</font><font color="#000080">);
</font><font color="#008000"><i>{$ifdef BIGMEM}
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{with}
{$endif}
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{procedure GOURAUD }
</i></font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to GRAPHICS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0140.PAS">Original</a><b>]</b></p></body>
</html>
