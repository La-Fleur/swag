<html>
<head><title> "Yet another FIRE routine" by GERHARD PIRAN</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to GRAPHICS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0241.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{$A+,B+,D-,E-,F-,G+,I-,L-,N-,O-,P-,Q-,R-,S-,T-,V-,X+,Y-}
{$M 20000,0,0}

{Burn V1.0: the original fireroutine was made by
 Frank Jan Sorensen alias Frank Patxi (fjs@lab.jt.dk)}

{Burn V2.0: interaction, speedup and sparks
            added by Gerhard Piran}

</i></font><font color="#FF0000"><b>Program </b></font>Burn2<font color="#000080">;           </font><font color="#008000"><i>{12.12.95}

</i></font><font color="#FF0000"><b>uses  </b></font>Dos<font color="#000080">, </font>Crt<font color="#000080">;

</font><font color="#FF0000"><b>var   </b></font>regs<font color="#000080">: </font>Registers<font color="#000080">;
      </font>pic<font color="#000080">: </font>integer<font color="#000080">;      </font><font color="#008000"><i>{drawn pictures}

{********************************************************}
</i></font><font color="#FF0000"><b>procedure </b></font>SetVideoMode <font color="#000080">(</font>vMode<font color="#000080">: </font>byte<font color="#000080">);

</font><font color="#FF0000"><b>begin
  </b></font>regs<font color="#000080">.</font>ax <font color="#000080">:= </font>vMode<font color="#000080">;      </font><font color="#008000"><i>{Bit 7 = 1: RAM nicht l”schen}
  </i></font>Intr <font color="#000080">(</font><font color="#800000">$10</font><font color="#000080">,</font>regs<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#008000"><i>{--------------------------------------------------------}
</i></font><font color="#FF0000"><b>function </b></font>GetVideoMode<font color="#000080">: </font>byte<font color="#000080">;

</font><font color="#FF0000"><b>begin
  </b></font>regs<font color="#000080">.</font>ah <font color="#000080">:= </font><font color="#800000">$0F</font><font color="#000080">;
  </font>intr <font color="#000080">(</font><font color="#800000">$10</font><font color="#000080">, </font>regs<font color="#000080">);
  </font>GetVideoMode <font color="#000080">:= </font>regs<font color="#000080">.</font>al<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#008000"><i>{*********************************************************}
</i></font><font color="#FF0000"><b>type  </b></font>ColorValue <font color="#000080">= </font><font color="#FF0000"><b>record </b></font>R<font color="#000080">,</font>G<font color="#000080">,</font>B<font color="#000080">: </font>byte<font color="#000080">; </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font>VGAPaletteType <font color="#000080">= </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">255</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>ColorValue<font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>ReadPal <font color="#000080">(</font><font color="#FF0000"><b>var </b></font>pal<font color="#000080">: </font>VGAPaletteType<font color="#000080">);

</font><font color="#FF0000"><b>begin
  </b></font>regs<font color="#000080">.</font>AX <font color="#000080">:= </font><font color="#800000">$1017</font><font color="#000080">;
  </font>regs<font color="#000080">.</font>BX <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font>regs<font color="#000080">.</font>CX <font color="#000080">:= </font><font color="#800000">256</font><font color="#000080">;
  </font>regs<font color="#000080">.</font>ES <font color="#000080">:= </font>Seg<font color="#000080">(</font>pal<font color="#000080">);
  </font>regs<font color="#000080">.</font>DX <font color="#000080">:= </font>Ofs<font color="#000080">(</font>pal<font color="#000080">);
  </font><font color="#FF0000"><b>repeat until </b></font>Port<font color="#000080">[</font><font color="#800000">$03DA</font><font color="#000080">] </font><font color="#FF0000"><b>And </b></font><font color="#800000">$08 </font><font color="#000080">= </font><font color="#800000">$08</font><font color="#000080">; </font><font color="#008000"><i>{Wait for rescan}
  </i></font>Intr <font color="#000080">(</font><font color="#800000">$10</font><font color="#000080">,</font>regs<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#008000"><i>{--------------------------------------------------------}
</i></font><font color="#FF0000"><b>procedure </b></font>WritePal <font color="#000080">(</font><font color="#FF0000"><b>var </b></font>pal<font color="#000080">: </font>VGAPaletteType<font color="#000080">);

</font><font color="#FF0000"><b>begin
  </b></font>regs<font color="#000080">.</font>AX <font color="#000080">:= </font><font color="#800000">$1012</font><font color="#000080">;
  </font>regs<font color="#000080">.</font>BX <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font>regs<font color="#000080">.</font>CX <font color="#000080">:= </font><font color="#800000">256</font><font color="#000080">;
  </font>regs<font color="#000080">.</font>ES <font color="#000080">:= </font>Seg<font color="#000080">(</font>pal<font color="#000080">);
  </font>regs<font color="#000080">.</font>DX <font color="#000080">:= </font>Ofs<font color="#000080">(</font>pal<font color="#000080">);
  </font><font color="#FF0000"><b>repeat until </b></font>Port<font color="#000080">[</font><font color="#800000">$03DA</font><font color="#000080">] </font><font color="#FF0000"><b>and </b></font><font color="#800000">$08 </font><font color="#000080">= </font><font color="#800000">$08</font><font color="#000080">; </font><font color="#008000"><i>{Wait for rescan}
  </i></font>Intr<font color="#000080">(</font><font color="#800000">$10</font><font color="#000080">,</font>regs<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#008000"><i>{*********************************************************}
{ Convert HSI (Hue, Saturation, Intensity) -&gt; RGB }
{---------------------------------------------------------}
</i></font><font color="#FF0000"><b>procedure </b></font>Hsi2Rgb <font color="#000080">(</font>H<font color="#000080">, </font>S<font color="#000080">, </font>I<font color="#000080">: </font>Real<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>C<font color="#000080">: </font>ColorValue<font color="#000080">);

</font><font color="#FF0000"><b>var   </b></font>T<font color="#000080">, </font>Rv<font color="#000080">, </font>Gv<font color="#000080">, </font>Bv<font color="#000080">: </font>Real<font color="#000080">;

</font><font color="#FF0000"><b>begin
  </b></font>T  <font color="#000080">:= </font>H<font color="#000080">;
  </font>Rv <font color="#000080">:= </font><font color="#800000">1 </font><font color="#000080">+ </font>S <font color="#000080">* </font>Sin<font color="#000080">(</font>T <font color="#000080">- </font><font color="#800000">2 </font><font color="#000080">* </font>Pi <font color="#000080">/ </font><font color="#800000">3</font><font color="#000080">);
  </font>Gv <font color="#000080">:= </font><font color="#800000">1 </font><font color="#000080">+ </font>S <font color="#000080">* </font>Sin<font color="#000080">(</font>T<font color="#000080">);
  </font>Bv <font color="#000080">:= </font><font color="#800000">1 </font><font color="#000080">+ </font>S <font color="#000080">* </font>Sin<font color="#000080">(</font>T <font color="#000080">+ </font><font color="#800000">2 </font><font color="#000080">* </font>Pi <font color="#000080">/ </font><font color="#800000">3</font><font color="#000080">);
  </font>T  <font color="#000080">:= </font><font color="#800000">63.999 </font><font color="#000080">* </font>I <font color="#000080">/ </font><font color="#800000">2</font><font color="#000080">;
  </font>c<font color="#000080">.</font>R <font color="#000080">:= </font>trunc<font color="#000080">(</font>Rv <font color="#000080">* </font>T<font color="#000080">);
  </font>c<font color="#000080">.</font>G <font color="#000080">:= </font>trunc<font color="#000080">(</font>Gv <font color="#000080">* </font>T<font color="#000080">);
  </font>c<font color="#000080">.</font>B <font color="#000080">:= </font>trunc<font color="#000080">(</font>Bv <font color="#000080">* </font>T<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#008000"><i>{*********************************************************}
{ fast pixel drawing for graphic mode 320x200x256
{---------------------------------------------------------}
</i></font><font color="#FF0000"><b>procedure </b></font>PutPixel <font color="#000080">(</font>x<font color="#000080">,</font>y<font color="#000080">: </font>integer<font color="#000080">; </font>c<font color="#000080">: </font>byte<font color="#000080">); </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
 </font><font color="#FF0000"><b>asm
  </b></font><font color="#FF00FF">mov ax,y
  mov bx,ax
  shl ax,8
  shl bx,6
  add bx,ax
  add bx,x
  mov ax,0a000h
  mov es,ax
  mov al,c
  mov es:[bx],al
 </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#008000"><i>{--------------------------------------------------------}
</i></font><font color="#FF0000"><b>function </b></font>GetPixel <font color="#000080">(</font>x<font color="#000080">,</font>y<font color="#000080">: </font>integer<font color="#000080">): </font>byte<font color="#000080">;

</font><font color="#FF0000"><b>begin
 asm
  </b></font><font color="#FF00FF">mov ax,y
  mov bx,ax
  shl ax,8
  shl bx,6
  add bx,ax
  add bx,x
  mov ax,0a000h
  mov es,ax
  mov al,es:[bx]
  mov @result,al
 </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#008000"><i>{********************************************************}
</i></font><font color="#FF0000"><b>procedure </b></font>Info<font color="#000080">;

</font><font color="#FF0000"><b>begin
  </b></font>ClrScr<font color="#000080">;
  </font>WriteLn<font color="#000080">(</font><font color="#800000">'Burn V 2.0,   a hot burning stuff'#13#10</font><font color="#000080">);
  </font>WriteLn<font color="#000080">(</font><font color="#800000">'commands: '#13#10
         </font><font color="#000080">+</font><font color="#800000">'    ?     this help'#13#10
         </font><font color="#000080">+</font><font color="#800000">'   + -    change width'#13#10
         </font><font color="#000080">+</font><font color="#800000">'    C     clear base fire'#13#10
         </font><font color="#000080">+</font><font color="#800000">'    W     give water into fire'#13#10
         </font><font color="#000080">+</font><font color="#800000">'    P     draw palette'#13#10
         </font><font color="#000080">+</font><font color="#800000">'    A     animate values on/off'</font><font color="#000080">);
  </font>WriteLn<font color="#000080">(</font><font color="#800000">'  space   random values'#13#10
         </font><font color="#000080">+</font><font color="#800000">'  cursor  edit values'#13#10
         </font><font color="#000080">+</font><font color="#800000">'   ESC    exit demo'#13#10</font><font color="#000080">);
  </font>WriteLn<font color="#000080">(</font><font color="#800000">'values 1: decrease root of flame'#13#10
         </font><font color="#000080">+</font><font color="#800000">'       2: how far flames go up'#13#10
         </font><font color="#000080">+</font><font color="#800000">'       3: more or less fire'#13#10
         </font><font color="#000080">+</font><font color="#800000">'       4: smooth root of flame'#13#10
         </font><font color="#000080">+</font><font color="#800000">'       5: limit of start burning'#13#10
         </font><font color="#000080">+</font><font color="#800000">'       6: burnability (wood..gaz)'#13#10
         </font><font color="#000080">+</font><font color="#800000">'       7: sparks'#13#10
         </font><font color="#000080">+</font><font color="#800000">'       8: new flames'#13#10
         </font><font color="#000080">+</font><font color="#800000">'       9: put water into fire'#13#10</font><font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#008000"><i>{********************************************************}
</i></font><font color="#FF0000"><b>const </b></font>maxPar <font color="#000080">= </font><font color="#800000">9</font><font color="#000080">;
      </font>actPar<font color="#000080">: </font>integer <font color="#000080">= </font><font color="#800000">1</font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>StartBurning <font color="#000080">(</font>xl<font color="#000080">,</font>yl<font color="#000080">: </font>integer<font color="#000080">);

</font><font color="#FF0000"><b>type  </b></font>tPar <font color="#000080">= </font><font color="#FF0000"><b>record </b></font>min<font color="#000080">, </font>max<font color="#000080">, </font>value<font color="#000080">: </font>integer <font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>const </b></font>par<font color="#000080">: </font><font color="#FF0000"><b>array </b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font>maxPar<font color="#000080">] </font><font color="#FF0000"><b>of </b></font>tPar
      <font color="#000080">=((</font>min<font color="#000080">:  </font><font color="#800000">0</font><font color="#000080">;   </font>max<font color="#000080">: </font><font color="#800000">50</font><font color="#000080">;   </font>value<font color="#000080">: </font><font color="#800000">10</font><font color="#000080">)   </font><font color="#008000"><i>{0: rootRand}
       </i></font><font color="#000080">,(</font>min<font color="#000080">:  </font><font color="#800000">0</font><font color="#000080">;   </font>max<font color="#000080">: </font><font color="#800000">50</font><font color="#000080">;   </font>value<font color="#000080">: </font><font color="#800000">15</font><font color="#000080">)   </font><font color="#008000"><i>{1: decay}
       </i></font><font color="#000080">,(</font>min<font color="#000080">: -</font><font color="#800000">2</font><font color="#000080">;   </font>max<font color="#000080">: </font><font color="#800000">10</font><font color="#000080">;   </font>value<font color="#000080">: </font><font color="#800000">10</font><font color="#000080">)   </font><font color="#008000"><i>{2: moreFire}
       </i></font><font color="#000080">,(</font>min<font color="#000080">:  </font><font color="#800000">0</font><font color="#000080">;   </font>max<font color="#000080">:  </font><font color="#800000">9</font><font color="#000080">;   </font>value<font color="#000080">: </font><font color="#800000">10</font><font color="#000080">)   </font><font color="#008000"><i>{3: smooth}
       </i></font><font color="#000080">,(</font>min<font color="#000080">:  </font><font color="#800000">0</font><font color="#000080">;   </font>max<font color="#000080">:</font><font color="#800000">100</font><font color="#000080">;   </font>value<font color="#000080">: </font><font color="#800000">10</font><font color="#000080">)   </font><font color="#008000"><i>{4: minFire}
       </i></font><font color="#000080">,(</font>min<font color="#000080">:  </font><font color="#800000">3</font><font color="#000080">;   </font>max<font color="#000080">: </font><font color="#800000">90</font><font color="#000080">;   </font>value<font color="#000080">: </font><font color="#800000">10</font><font color="#000080">)   </font><font color="#008000"><i>{5: fireInc}
       </i></font><font color="#000080">,(</font>min<font color="#000080">:  </font><font color="#800000">0</font><font color="#000080">;   </font>max<font color="#000080">: </font><font color="#800000">10</font><font color="#000080">;   </font>value<font color="#000080">: </font><font color="#800000">10</font><font color="#000080">)   </font><font color="#008000"><i>{6: sparks}
       </i></font><font color="#000080">,(</font>min<font color="#000080">:  </font><font color="#800000">0</font><font color="#000080">;   </font>max<font color="#000080">: </font><font color="#800000">20</font><font color="#000080">;   </font>value<font color="#000080">: </font><font color="#800000">10</font><font color="#000080">)   </font><font color="#008000"><i>{7: new fire}
       </i></font><font color="#000080">,(</font>min<font color="#000080">:  </font><font color="#800000">0</font><font color="#000080">;   </font>max<font color="#000080">: </font><font color="#800000">20</font><font color="#000080">;   </font>value<font color="#000080">: </font><font color="#800000">10</font><font color="#000080">)); </font><font color="#008000"><i>{8: put water}

</i></font><font color="#FF0000"><b>const </b></font>maxX <font color="#000080">= </font><font color="#800000">319</font><font color="#000080">;
      </font>maxY <font color="#000080">= </font><font color="#800000">199</font><font color="#000080">;
      </font>bkColor <font color="#000080">= </font><font color="#800000">16</font><font color="#000080">;

</font><font color="#FF0000"><b>var   </b></font>vga256<font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font>maxY<font color="#000080">,</font><font color="#800000">0</font><font color="#000080">..</font>maxX<font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte <font color="#FF0000"><b>absolute </b></font><font color="#800000">$A000</font><font color="#000080">:</font><font color="#800000">0</font><font color="#000080">;
      </font>cb<font color="#000080">: </font>char<font color="#000080">;

      </font>rootRand<font color="#000080">,         </font><font color="#008000"><i>{Max/Min decrease of the root of the flames}
      </i></font>moreFire<font color="#000080">,         </font><font color="#008000"><i>{change fire intensity}
      </i></font>decay<font color="#000080">,            </font><font color="#008000"><i>{How far should the flames go up on the screen ?}
      </i></font>smooth<font color="#000080">,           </font><font color="#008000"><i>{How descrete can the flames be?}
      </i></font>minFire<font color="#000080">,          </font><font color="#008000"><i>{limit between the &quot;starting to burn&quot; and
                         the &quot;is burning&quot; routines }
      </i></font>fireIncrease<font color="#000080">,     </font><font color="#008000"><i>{3 = Wood, 90 = Gazolin}
      </i></font>sparks<font color="#000080">,           </font><font color="#008000"><i>{new sparks per picture}
      </i></font>newFlame<font color="#000080">,         </font><font color="#008000"><i>{create new flame}
      </i></font>putWater<font color="#000080">: </font>integer<font color="#000080">;</font><font color="#008000"><i>{put water to fire}

      </i></font>x1<font color="#000080">,</font>x2<font color="#000080">,</font>y1<font color="#000080">,</font>y2<font color="#000080">: </font>integer<font color="#000080">;  </font><font color="#008000"><i>{drawing rectangle}

{********************************************************}
</i></font><font color="#FF0000"><b>procedure </b></font>MakePal<font color="#000080">;

</font><font color="#FF0000"><b>const </b></font>maxColor <font color="#000080">= </font><font color="#800000">110</font><font color="#000080">;

</font><font color="#FF0000"><b>var   </b></font>ni<font color="#000080">: </font>integer<font color="#000080">;   </font>pal<font color="#000080">: </font>VGAPaletteType<font color="#000080">;

</font><font color="#FF0000"><b>begin
  </b></font>FillChar <font color="#000080">(</font>pal<font color="#000080">, </font>SizeOf <font color="#000080">(</font>pal<font color="#000080">), </font><font color="#800000">0</font><font color="#000080">);
  </font><font color="#FF0000"><b>for </b></font>ni <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>MaxColor
  <font color="#FF0000"><b>do </b></font>HSI2RGB <font color="#000080">(</font><font color="#800000">4.6</font><font color="#000080">-</font><font color="#800000">1.5</font><font color="#000080">*</font>ni<font color="#000080">/</font>MaxColor<font color="#000080">, </font>ni<font color="#000080">/</font>MaxColor<font color="#000080">, </font>ni<font color="#000080">/</font>MaxColor<font color="#000080">, </font>pal<font color="#000080">[</font>ni<font color="#000080">]);
  </font><font color="#FF0000"><b>for </b></font>ni <font color="#000080">:= </font>MaxColor <font color="#FF0000"><b>to </b></font><font color="#800000">255
  </font><font color="#FF0000"><b>do begin
    </b></font>pal<font color="#000080">[</font>ni<font color="#000080">] := </font>pal<font color="#000080">[</font>ni<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">];
    </font><font color="#FF0000"><b>With </b></font>pal<font color="#000080">[</font>ni<font color="#000080">] </font><font color="#FF0000"><b>do
    begin
      if </b></font>R <font color="#000080">&lt; </font><font color="#800000">63 </font><font color="#FF0000"><b>then </b></font>Inc<font color="#000080">(</font>R<font color="#000080">);
      </font><font color="#FF0000"><b>if </b></font>R <font color="#000080">&lt; </font><font color="#800000">63 </font><font color="#FF0000"><b>then </b></font>Inc<font color="#000080">(</font>R<font color="#000080">);
      </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>ni <font color="#FF0000"><b>Mod </b></font><font color="#800000">2</font><font color="#000080">=</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>And </b></font><font color="#000080">(</font>G<font color="#000080">&lt;</font><font color="#800000">53</font><font color="#000080">) </font><font color="#FF0000"><b>then </b></font>Inc<font color="#000080">(</font>G<font color="#000080">);
      </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>ni <font color="#FF0000"><b>Mod </b></font><font color="#800000">2</font><font color="#000080">=</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>And </b></font><font color="#000080">(</font>B<font color="#000080">&lt;</font><font color="#800000">63</font><font color="#000080">) </font><font color="#FF0000"><b>then </b></font>Inc<font color="#000080">(</font>B<font color="#000080">);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>WritePal <font color="#000080">(</font>pal<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>DrawPaletteScreen<font color="#000080">;

</font><font color="#FF0000"><b>var   </b></font>xi<font color="#000080">, </font>yi<font color="#000080">: </font>integer<font color="#000080">;

</font><font color="#FF0000"><b>begin
  </b></font>MakePal<font color="#000080">;
  </font><font color="#FF0000"><b>for </b></font>yi <font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font>maxY
  <font color="#FF0000"><b>do for </b></font>xi <font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font>maxX <font color="#FF0000"><b>do </b></font>PutPixel <font color="#000080">(</font>xi<font color="#000080">,</font>yi<font color="#000080">,</font>yi<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>DrawValues<font color="#000080">;

</font><font color="#FF0000"><b>var   </b></font>ni<font color="#000080">, </font>yi<font color="#000080">: </font>integer<font color="#000080">;

</font><font color="#FF0000"><b>begin
  for </b></font>ni <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>maxPar
  <font color="#FF0000"><b>do begin
    </b></font>yi <font color="#000080">:= </font>succ<font color="#000080">(</font>ni<font color="#000080">) * </font><font color="#800000">3</font><font color="#000080">;
    </font>FillChar <font color="#000080">(</font>vga256<font color="#000080">[</font>yi<font color="#000080">,</font><font color="#800000">100</font><font color="#000080">], </font><font color="#800000">120</font><font color="#000080">, </font><font color="#800000">0</font><font color="#000080">);
    </font><font color="#FF0000"><b>with </b></font>par<font color="#000080">[</font>ni<font color="#000080">]
    </font><font color="#FF0000"><b>do if </b></font>actPar <font color="#000080">= </font>ni
    <font color="#FF0000"><b>then </b></font>FillChar <font color="#000080">(</font>vga256<font color="#000080">[</font>yi<font color="#000080">,</font><font color="#800000">100</font><font color="#000080">], </font><font color="#800000">1 </font><font color="#000080">+ </font>longint<font color="#000080">(</font>value<font color="#000080">)*</font><font color="#800000">119 </font><font color="#FF0000"><b>div </b></font><font color="#800000">20</font><font color="#000080">, </font><font color="#800000">100</font><font color="#000080">)
    </font><font color="#FF0000"><b>else </b></font>FillChar <font color="#000080">(</font>vga256<font color="#000080">[</font>yi<font color="#000080">,</font><font color="#800000">100</font><font color="#000080">], </font><font color="#800000">1 </font><font color="#000080">+ </font>longint<font color="#000080">(</font>value<font color="#000080">)*</font><font color="#800000">119 </font><font color="#FF0000"><b>div </b></font><font color="#800000">20</font><font color="#000080">,  </font><font color="#800000">50</font><font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>CalcValues<font color="#000080">;

</font><font color="#FF0000"><b>begin
  with </b></font>par<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">] </font><font color="#FF0000"><b>do </b></font>rootRand     <font color="#000080">:=  </font>min <font color="#000080">+ </font>value <font color="#000080">* (</font>max <font color="#000080">- </font>min<font color="#000080">) </font><font color="#FF0000"><b>div </b></font><font color="#800000">20</font><font color="#000080">;
  </font><font color="#FF0000"><b>with </b></font>par<font color="#000080">[</font><font color="#800000">2</font><font color="#000080">] </font><font color="#FF0000"><b>do </b></font>decay        <font color="#000080">:=  </font>max <font color="#000080">- </font>value <font color="#000080">* (</font>max <font color="#000080">- </font>min<font color="#000080">) </font><font color="#FF0000"><b>div </b></font><font color="#800000">20</font><font color="#000080">;
  </font><font color="#FF0000"><b>with </b></font>par<font color="#000080">[</font><font color="#800000">3</font><font color="#000080">] </font><font color="#FF0000"><b>do </b></font>moreFire     <font color="#000080">:=  </font>min <font color="#000080">+ </font>value <font color="#000080">* (</font>max <font color="#000080">- </font>min<font color="#000080">) </font><font color="#FF0000"><b>div </b></font><font color="#800000">20</font><font color="#000080">;
  </font><font color="#FF0000"><b>with </b></font>par<font color="#000080">[</font><font color="#800000">4</font><font color="#000080">] </font><font color="#FF0000"><b>do </b></font>smooth       <font color="#000080">:=  </font>min <font color="#000080">+ </font>value <font color="#000080">* (</font>max <font color="#000080">- </font>min<font color="#000080">) </font><font color="#FF0000"><b>div </b></font><font color="#800000">20</font><font color="#000080">;
  </font><font color="#FF0000"><b>with </b></font>par<font color="#000080">[</font><font color="#800000">5</font><font color="#000080">] </font><font color="#FF0000"><b>do </b></font>minFire      <font color="#000080">:=  </font>min <font color="#000080">+ </font>value <font color="#000080">* (</font>max <font color="#000080">- </font>min<font color="#000080">) </font><font color="#FF0000"><b>div </b></font><font color="#800000">20</font><font color="#000080">;
  </font><font color="#FF0000"><b>with </b></font>par<font color="#000080">[</font><font color="#800000">6</font><font color="#000080">] </font><font color="#FF0000"><b>do </b></font>fireIncrease <font color="#000080">:=  </font>min <font color="#000080">+ </font>sqr <font color="#000080">(</font>value<font color="#000080">);
  </font><font color="#FF0000"><b>with </b></font>par<font color="#000080">[</font><font color="#800000">7</font><font color="#000080">] </font><font color="#FF0000"><b>do </b></font>sparks       <font color="#000080">:=  </font>min <font color="#000080">+ </font>value <font color="#000080">* (</font>max <font color="#000080">- </font>min<font color="#000080">) </font><font color="#FF0000"><b>div </b></font><font color="#800000">20</font><font color="#000080">;
  </font><font color="#FF0000"><b>with </b></font>par<font color="#000080">[</font><font color="#800000">8</font><font color="#000080">] </font><font color="#FF0000"><b>do </b></font>newFlame     <font color="#000080">:=  </font>max <font color="#000080">- </font>value <font color="#000080">* (</font>max <font color="#000080">- </font>min<font color="#000080">) </font><font color="#FF0000"><b>div </b></font><font color="#800000">20</font><font color="#000080">;
  </font><font color="#FF0000"><b>with </b></font>par<font color="#000080">[</font><font color="#800000">9</font><font color="#000080">] </font><font color="#FF0000"><b>do </b></font>putWater     <font color="#000080">:=  </font>max <font color="#000080">- </font>value <font color="#000080">* (</font>max <font color="#000080">- </font>min<font color="#000080">) </font><font color="#FF0000"><b>div </b></font><font color="#800000">20</font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>ChangeValue<font color="#000080">;

</font><font color="#FF0000"><b>begin
  </b></font>cb <font color="#000080">:= </font>ReadKey<font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font>cb <font color="#000080">= </font><font color="#800000">'P' </font><font color="#008000"><i>{down} </i></font><font color="#FF0000"><b>then </b></font>actPar <font color="#000080">:= (</font>actPar <font color="#FF0000"><b>mod </b></font>maxPar<font color="#000080">) + </font><font color="#800000">1</font><font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font>cb <font color="#000080">= </font><font color="#800000">'H' </font><font color="#008000"><i>{up}   </i></font><font color="#FF0000"><b>then </b></font>actPar <font color="#000080">:= (</font>actPar<font color="#000080">+</font>maxPar<font color="#000080">-</font><font color="#800000">2</font><font color="#000080">) </font><font color="#FF0000"><b>mod </b></font>maxPar <font color="#000080">+ </font><font color="#800000">1</font><font color="#000080">;
  </font><font color="#FF0000"><b>with </b></font>par<font color="#000080">[</font>actPar<font color="#000080">]
  </font><font color="#FF0000"><b>do begin
    if </b></font>cb <font color="#000080">= </font><font color="#800000">'K' </font><font color="#008000"><i>{left}  </i></font><font color="#FF0000"><b>then if </b></font>value <font color="#000080">&gt;  </font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>dec <font color="#000080">(</font>value<font color="#000080">);
    </font><font color="#FF0000"><b>if </b></font>cb <font color="#000080">= </font><font color="#800000">'M' </font><font color="#008000"><i>{right} </i></font><font color="#FF0000"><b>then if </b></font>value <font color="#000080">&lt; </font><font color="#800000">20 </font><font color="#FF0000"><b>then </b></font>inc <font color="#000080">(</font>value<font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>CalcValues<font color="#000080">;
  </font>DrawValues<font color="#000080">;
  </font>cb <font color="#000080">:= </font><font color="#800000">#1</font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>RandomValues<font color="#000080">;

</font><font color="#FF0000"><b>var   </b></font>ni<font color="#000080">: </font>integer<font color="#000080">;

</font><font color="#FF0000"><b>begin
  for </b></font>ni <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>maxPar
  <font color="#FF0000"><b>do </b></font>par<font color="#000080">[</font>ni<font color="#000080">].</font>value <font color="#000080">:= </font>random<font color="#000080">(</font><font color="#800000">21</font><font color="#000080">);
  </font>CalcValues<font color="#000080">;
  </font>DrawValues<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>AnimateValues<font color="#000080">;

</font><font color="#FF0000"><b>var   </b></font>ni<font color="#000080">: </font>integer<font color="#000080">;

</font><font color="#FF0000"><b>begin
  </b></font>ni <font color="#000080">:= </font><font color="#800000">1 </font><font color="#000080">+ </font>random <font color="#000080">(</font>maxPar<font color="#000080">);
  </font><font color="#FF0000"><b>with </b></font>par<font color="#000080">[</font>ni<font color="#000080">]
  </font><font color="#FF0000"><b>do if </b></font>random <font color="#000080">(</font><font color="#800000">2</font><font color="#000080">) = </font><font color="#800000">0
  </font><font color="#FF0000"><b>then if </b></font>value <font color="#000080">&lt; </font><font color="#800000">20 </font><font color="#FF0000"><b>then </b></font>inc <font color="#000080">(</font>value<font color="#000080">) </font><font color="#FF0000"><b>else
  else if </b></font>value <font color="#000080">&gt;  </font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>dec <font color="#000080">(</font>value<font color="#000080">);
  </font>CalcValues<font color="#000080">;
  </font>DrawValues<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>ChangeSize <font color="#000080">(</font>dx<font color="#000080">: </font>integer<font color="#000080">);

</font><font color="#FF0000"><b>var   </b></font>yi<font color="#000080">: </font>integer<font color="#000080">;

</font><font color="#FF0000"><b>begin
  if </b></font><font color="#000080">(</font>dx <font color="#000080">&gt; </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>x1 <font color="#000080">- </font>dx <font color="#000080">&gt; </font><font color="#800000">2</font><font color="#000080">)
  </font><font color="#FF0000"><b>then repeat
    </b></font>dec <font color="#000080">(</font>x1<font color="#000080">);
    </font>inc <font color="#000080">(</font>x2<font color="#000080">);
    </font>dec <font color="#000080">(</font>dx<font color="#000080">);
    </font><font color="#FF0000"><b>for </b></font>yi <font color="#000080">:= </font>y1 <font color="#FF0000"><b>to </b></font>y2
    <font color="#FF0000"><b>do begin
      </b></font>PutPixel <font color="#000080">(</font>x1<font color="#000080">,</font>yi<font color="#000080">,</font><font color="#800000">0</font><font color="#000080">);
      </font>PutPixel <font color="#000080">(</font>x2<font color="#000080">,</font>yi<font color="#000080">,</font><font color="#800000">0</font><font color="#000080">);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>until </b></font>dx <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>dx <font color="#000080">&lt; </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>x1 <font color="#000080">- </font>dx <font color="#000080">&lt; </font><font color="#800000">140</font><font color="#000080">)
  </font><font color="#FF0000"><b>then repeat
    for </b></font>yi <font color="#000080">:= </font>y1 <font color="#FF0000"><b>to </b></font>y2
    <font color="#FF0000"><b>do begin
      </b></font>PutPixel <font color="#000080">(</font>x1<font color="#000080">, </font>yi<font color="#000080">, </font>bkColor<font color="#000080">);
      </font>PutPixel <font color="#000080">(</font>x2<font color="#000080">, </font>yi<font color="#000080">, </font>bkColor<font color="#000080">);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font>inc <font color="#000080">(</font>x1<font color="#000080">);
    </font>dec <font color="#000080">(</font>x2<font color="#000080">);
    </font>inc <font color="#000080">(</font>dx<font color="#000080">);
  </font><font color="#FF0000"><b>until </b></font>dx <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">;
  </font>xl <font color="#000080">:= </font>x2 <font color="#000080">- </font>x1 <font color="#000080">- </font><font color="#800000">1</font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>procedure </b></font>Help<font color="#000080">;

</font><font color="#FF0000"><b>begin
  </b></font>SetVideoMode <font color="#000080">(</font><font color="#800000">3</font><font color="#000080">);          </font><font color="#008000"><i>{TextMode}
  </i></font>ClrScr<font color="#000080">;
  </font>Info<font color="#000080">;
  </font>Write <font color="#000080">(</font><font color="#800000">'Hit any key to start '</font><font color="#000080">);
  </font>cb <font color="#000080">:= </font>ReadKey<font color="#000080">;
  </font>SetVideoMode <font color="#000080">(</font><font color="#800000">$13</font><font color="#000080">);
  </font>MakePal<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>const </b></font>animValues<font color="#000080">: </font>boolean <font color="#000080">= </font>false<font color="#000080">;

</font><font color="#FF0000"><b>var   </b></font>flameArray<font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">319</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">;
      </font>x<font color="#000080">,</font>xi<font color="#000080">,</font>y<font color="#000080">,</font>c<font color="#000080">,</font>v<font color="#000080">: </font>integer<font color="#000080">;

</font><font color="#FF0000"><b>begin
  </b></font>x1 <font color="#000080">:= (</font><font color="#800000">320 </font><font color="#000080">- </font>xl<font color="#000080">) </font><font color="#FF0000"><b>div </b></font><font color="#800000">2</font><font color="#000080">;   </font>x2 <font color="#000080">:= </font>x1 <font color="#000080">+ </font>xl <font color="#000080">- </font><font color="#800000">1</font><font color="#000080">;
  </font>y1 <font color="#000080">:= (</font><font color="#800000">200 </font><font color="#000080">- </font>yl<font color="#000080">) </font><font color="#FF0000"><b>div </b></font><font color="#800000">2</font><font color="#000080">;   </font>y2 <font color="#000080">:= </font>y1 <font color="#000080">+ </font>yl <font color="#000080">- </font><font color="#800000">1</font><font color="#000080">;
  </font>Help<font color="#000080">;
  </font>Randomize<font color="#000080">;

  </font>FillChar <font color="#000080">(</font>vga256<font color="#000080">, </font>SizeOf<font color="#000080">(</font>vga256<font color="#000080">), </font>bkColor<font color="#000080">);
  </font>FillChar <font color="#000080">(</font>flameArray<font color="#000080">, </font>SizeOf<font color="#000080">(</font>flameArray<font color="#000080">), </font><font color="#800000">0</font><font color="#000080">);
  </font><font color="#FF0000"><b>for </b></font>x <font color="#000080">:= </font>x1 <font color="#FF0000"><b>to </b></font>x2 <font color="#FF0000"><b>do for </b></font>y <font color="#000080">:= </font>y1 <font color="#FF0000"><b>to </b></font>y2 <font color="#FF0000"><b>do </b></font>PutPixel <font color="#000080">(</font>x<font color="#000080">,</font>y<font color="#000080">,</font><font color="#800000">0</font><font color="#000080">);
  </font>CalcValues<font color="#000080">;
  </font>pic <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font><font color="#FF0000"><b>repeat
    </b></font>inc <font color="#000080">(</font>pic<font color="#000080">);
    </font><font color="#FF0000"><b>if </b></font>KeyPressed <font color="#FF0000"><b>then </b></font>cb <font color="#000080">:= </font>upcase<font color="#000080">(</font>ReadKey<font color="#000080">) </font><font color="#FF0000"><b>else </b></font>cb <font color="#000080">:= </font><font color="#800000">#1</font><font color="#000080">;
    </font><font color="#FF0000"><b>if </b></font>cb <font color="#000080">= </font><font color="#800000">#0 </font><font color="#FF0000"><b>then </b></font>ChangeValue<font color="#000080">;
    </font><font color="#FF0000"><b>while </b></font>KeyPressed <font color="#FF0000"><b>do </b></font>ReadKey<font color="#000080">;  </font><font color="#008000"><i>{empty keyboard buffer}

    {Put the values from flameArray on the bottom line of the screen}
    </i></font><font color="#FF0000"><b>for </b></font>x <font color="#000080">:= </font>x1 <font color="#FF0000"><b>to </b></font>x2 <font color="#FF0000"><b>do </b></font>PutPixel <font color="#000080">(</font>x<font color="#000080">, </font>y2<font color="#000080">, </font>flameArray<font color="#000080">[</font>x<font color="#000080">]);

    </font><font color="#008000"><i>{This loop makes the actual flames}
    </i></font><font color="#FF0000"><b>for </b></font>xi <font color="#000080">:= </font>x1 <font color="#FF0000"><b>to </b></font>x2
    <font color="#FF0000"><b>do begin
      if      </b></font>xi <font color="#000080">= </font>x1 <font color="#FF0000"><b>then </b></font>x <font color="#000080">:= </font>xi
      <font color="#FF0000"><b>else if </b></font>xi <font color="#000080">&lt; </font>x2 <font color="#FF0000"><b>then </b></font>x <font color="#000080">:= </font>xi <font color="#000080">- </font><font color="#800000">1
      </font><font color="#FF0000"><b>else                 </b></font>x <font color="#000080">:= </font>xi <font color="#000080">- </font><font color="#800000">2</font><font color="#000080">;
      </font><font color="#FF0000"><b>for </b></font>y <font color="#000080">:= </font>y1 <font color="#000080">+ </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>y2
      <font color="#FF0000"><b>do begin
        </b></font>v <font color="#000080">:= </font>GetPixel <font color="#000080">(</font>xi<font color="#000080">,</font>y<font color="#000080">);
        </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>v <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">)
        </font><font color="#FF0000"><b>or </b></font><font color="#000080">(</font>v <font color="#000080">&lt; </font>decay<font color="#000080">)
</font><font color="#008000"><i>{        then PutPixel (x,pred(y),0)
        else PutPixel (x-pred(Random(3)),Pred(y),v-Random(decay));
}       </i></font><font color="#FF0000"><b>then </b></font>vga256<font color="#000080">[</font>pred<font color="#000080">(</font>y<font color="#000080">),</font>xi<font color="#000080">] := </font><font color="#800000">0
        </font><font color="#FF0000"><b>else </b></font>vga256<font color="#000080">[</font>pred<font color="#000080">(</font>y<font color="#000080">),</font>x<font color="#000080">+</font>Random<font color="#000080">(</font><font color="#800000">3</font><font color="#000080">)] := </font>v<font color="#000080">-</font>Random<font color="#000080">(</font>decay<font color="#000080">);
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

    </font><font color="#FF0000"><b>for </b></font>xi <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>sparks
    <font color="#FF0000"><b>do begin
      </b></font>x <font color="#000080">:= </font>x1 <font color="#000080">+ </font>random <font color="#000080">(</font>xl<font color="#000080">);
      </font>y <font color="#000080">:= </font>y2 <font color="#000080">- </font>random <font color="#000080">(</font>yl <font color="#000080">- </font><font color="#800000">10</font><font color="#000080">);
      </font>PutPixel <font color="#000080">(</font>x<font color="#000080">,</font>y<font color="#000080">, </font>GetPixel <font color="#000080">(</font>x<font color="#000080">,</font>y<font color="#000080">)+</font>y<font color="#000080">);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

    </font><font color="#FF0000"><b>if </b></font>Random<font color="#000080">(</font>newFlame<font color="#000080">) = </font><font color="#800000">0       </font><font color="#008000"><i>{new fire ?}
    </i></font><font color="#FF0000"><b>then </b></font>FillChar <font color="#000080">(</font>flameArray<font color="#000080">[</font>x1<font color="#000080">+</font>Random<font color="#000080">(</font>xl<font color="#000080">-</font><font color="#800000">5</font><font color="#000080">)],</font><font color="#800000">5</font><font color="#000080">,</font><font color="#800000">199</font><font color="#000080">);

    </font><font color="#FF0000"><b>if </b></font>Random<font color="#000080">(</font>putWater<font color="#000080">)= </font><font color="#800000">0        </font><font color="#008000"><i>{put water ?}
    </i></font><font color="#FF0000"><b>then </b></font>FillChar <font color="#000080">(</font>flameArray<font color="#000080">[</font>x1<font color="#000080">+</font>Random<font color="#000080">(</font>xl<font color="#000080">-</font><font color="#800000">5</font><font color="#000080">)],</font><font color="#800000">3</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">);

    </font><font color="#FF0000"><b>if </b></font>cb <font color="#000080">&lt;&gt; </font><font color="#800000">#1                   </font><font color="#008000"><i>{check input ?}
    </i></font><font color="#FF0000"><b>then begin
      if      </b></font>cb <font color="#000080">= </font><font color="#800000">'+' </font><font color="#FF0000"><b>then </b></font>ChangeSize <font color="#000080">(+</font><font color="#800000">5</font><font color="#000080">)
      </font><font color="#FF0000"><b>else if </b></font>cb <font color="#000080">= </font><font color="#800000">'-' </font><font color="#FF0000"><b>then </b></font>ChangeSize <font color="#000080">(-</font><font color="#800000">5</font><font color="#000080">)
      </font><font color="#FF0000"><b>else if </b></font>cb <font color="#000080">= </font><font color="#800000">'R' </font><font color="#FF0000"><b>then </b></font>RandomValues
      <font color="#FF0000"><b>else if </b></font>cb <font color="#000080">= </font><font color="#800000">' ' </font><font color="#FF0000"><b>then </b></font>RandomValues
      <font color="#FF0000"><b>else if </b></font>cb <font color="#000080">= </font><font color="#800000">'A' </font><font color="#FF0000"><b>then </b></font>animValues <font color="#000080">:= </font><font color="#FF0000"><b>not </b></font>animValues
      <font color="#FF0000"><b>else if </b></font>cb <font color="#000080">= </font><font color="#800000">'C' </font><font color="#FF0000"><b>then </b></font>FillChar <font color="#000080">(</font>flameArray<font color="#000080">, </font>SizeOf<font color="#000080">(</font>flameArray<font color="#000080">),</font><font color="#800000">0</font><font color="#000080">)
      </font><font color="#FF0000"><b>else if </b></font>cb <font color="#000080">= </font><font color="#800000">'W' </font><font color="#FF0000"><b>then for </b></font>x <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>xl <font color="#FF0000"><b>div </b></font><font color="#800000">10
                            </font><font color="#FF0000"><b>do </b></font>flameArray<font color="#000080">[</font>x1<font color="#000080">+</font>Random<font color="#000080">(</font>xl<font color="#000080">)] := </font><font color="#800000">0
      </font><font color="#FF0000"><b>else if </b></font>cb <font color="#000080">= </font><font color="#800000">'?' </font><font color="#FF0000"><b>then </b></font>Help
      <font color="#FF0000"><b>else if </b></font>cb <font color="#000080">= </font><font color="#800000">'P' </font><font color="#FF0000"><b>then </b></font>DrawPaletteScreen<font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>if </b></font>animValues <font color="#FF0000"><b>then </b></font>AnimateValues<font color="#000080">;

    </font><font color="#008000"><i>{This loop controls the &quot;root&quot; of the flames (values in flameArray)}
    </i></font><font color="#FF0000"><b>for </b></font>x <font color="#000080">:= </font>x1 <font color="#FF0000"><b>to </b></font>x2 <font color="#FF0000"><b>do
    begin
      </b></font>c <font color="#000080">:= </font>flameArray<font color="#000080">[</font>x<font color="#000080">];
      </font><font color="#FF0000"><b>if </b></font>c <font color="#000080">&lt; </font>MinFire <font color="#FF0000"><b>then    </b></font><font color="#008000"><i>{Increase by the &quot;burnability&quot;}
      </i></font><font color="#FF0000"><b>begin                  </b></font><font color="#008000"><i>{Starting to burn:}
        </i></font><font color="#FF0000"><b>if </b></font>c <font color="#000080">&gt; </font><font color="#800000">10 </font><font color="#FF0000"><b>then </b></font>Inc <font color="#000080">(</font>c<font color="#000080">, </font>Random <font color="#000080">(</font>fireIncrease<font color="#000080">));
      </font><font color="#FF0000"><b>end
      else </b></font><font color="#008000"><i>{Otherwise randomize and increase by intensity (is burning)}
        </i></font>Inc <font color="#000080">(</font>c<font color="#000080">, </font>Random <font color="#000080">(</font>rootRand <font color="#000080">* </font><font color="#800000">2 </font><font color="#000080">+ </font><font color="#800000">1</font><font color="#000080">) - </font>rootRand <font color="#000080">+ </font>moreFire<font color="#000080">);
      </font><font color="#FF0000"><b>if </b></font>c <font color="#000080">&gt; </font><font color="#800000">200 </font><font color="#FF0000"><b>then </b></font>c <font color="#000080">:= </font><font color="#800000">200</font><font color="#000080">;  </font><font color="#008000"><i>{c too large ?}
      </i></font>flameArray<font color="#000080">[</font>x<font color="#000080">] := </font>c<font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

    </font><font color="#008000"><i>{Pour a little water on both sides of the fire
     to make it look nice on the sides}
    </i></font><font color="#FF0000"><b>for </b></font>x <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>xl <font color="#FF0000"><b>div </b></font><font color="#800000">8 </font><font color="#FF0000"><b>do
    begin
      </b></font>c <font color="#000080">:= </font>Trunc<font color="#000080">(</font>Sqr<font color="#000080">(</font>Random<font color="#000080">)*</font>xl<font color="#000080">/</font><font color="#800000">8</font><font color="#000080">);
      </font>flameArray<font color="#000080">[</font>x1<font color="#000080">+</font>c<font color="#000080">] := </font><font color="#800000">0</font><font color="#000080">;
      </font>flameArray<font color="#000080">[</font>x2<font color="#000080">-</font>c<font color="#000080">] := </font><font color="#800000">0</font><font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

    </font><font color="#008000"><i>{Smoothen the values of FrameArray to avoid &quot;descrete&quot; flames}
    </i></font><font color="#FF0000"><b>for </b></font>x <font color="#000080">:= </font>x1<font color="#000080">+</font>Smooth <font color="#FF0000"><b>to </b></font>x2<font color="#000080">-</font>Smooth <font color="#FF0000"><b>do
    begin
      </b></font>c <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
      </font><font color="#FF0000"><b>for </b></font>y <font color="#000080">:= -</font>Smooth <font color="#FF0000"><b>to </b></font>Smooth <font color="#FF0000"><b>do </b></font>Inc <font color="#000080">(</font>c<font color="#000080">,</font>flameArray<font color="#000080">[</font>x<font color="#000080">+</font>y<font color="#000080">]);
      </font>flameArray<font color="#000080">[</font>x<font color="#000080">] := </font>c <font color="#FF0000"><b>div </b></font><font color="#000080">(</font><font color="#800000">2</font><font color="#000080">*</font>Smooth<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>until </b></font><font color="#000080">(</font>cb <font color="#000080">= </font><font color="#800000">#27</font><font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#008000"><i>{********************************************************}
</i></font><font color="#FF0000"><b>var   </b></font>lastMode<font color="#000080">: </font>byte<font color="#000080">;

</font><font color="#FF0000"><b>begin
  </b></font>lastMode <font color="#000080">:= </font>GetVideoMode<font color="#000080">;  </font><font color="#008000"><i>{save video mode}
  </i></font>StartBurning <font color="#000080">(</font><font color="#800000">120</font><font color="#000080">, </font><font color="#800000">100</font><font color="#000080">);   </font><font color="#008000"><i>{fire simulation}
  </i></font>SetVideoMode <font color="#000080">(</font>lastMode<font color="#000080">);   </font><font color="#008000"><i>{Restore video mode}
  </i></font>Info<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to GRAPHICS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0241.PAS">Original</a><b>]</b></p></body>
</html>
