<html>
<head><title> "Fast Get/PutImage" by GERALD GUTIERREZ</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to GRAPHICS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0182.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
From: gutier@unixg.ubc.ca (Gerald Gutierrez)

: If I am going to be writing a large number of pixels to the screen, would
: it be faster to do a direct memory write to the video buffer at $A000
: (assuming I'm using 320x200x256 mode) or use an assembly language routine
: to do this?
}
</i></font><font color="#FF0000"><b>Procedure </b></font>Z_0GetImage<font color="#000080">( </font>ImgPtr <font color="#000080">: </font>pointer<font color="#000080">; </font>XOfs<font color="#000080">,</font>YOfs<font color="#000080">,</font>XSize<font color="#000080">,</font>YSize <font color="#000080">: </font>Word <font color="#000080">);
</font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;
 
  </font><font color="#FF0000"><b>asm
     </b></font><font color="#FF00FF">PUSH DS
     MOV AX,0A000h
     MOV DS,AX
     LES DI,Imgptr
 
     MOV BX,YOfs
     XCHG BH,BL
     MOV DX,BX
     SHR BX,1
     SHR BX,1
     ADD DX,BX
     ADD DX,XOfs
 
     MOV AX,xsize
     STOSW
     MOV BX,AX
     MOV AX,ysize
     STOSW
 
    @JP1:
     MOV SI,DX
     MOV CX,BX
     shr cx,1
     jnc @Jp2
     movsb
    @Jp2:
     repz movsw
     ADD DX,0140h
     DEC AX
     JNZ @JP1
     POP DS
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>Z_0PutImage<font color="#000080">( </font>ImgPtr <font color="#000080">: </font>pointer<font color="#000080">; </font>XOfs<font color="#000080">,</font>YOfs  <font color="#000080">: </font>Word <font color="#000080">);
</font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>asm
     </b></font><font color="#FF00FF">PUSH DS
     MOV AX,0A000h
     MOV ES,AX
     LDS SI,ImgPtr
 
     MOV BX,YOfs
     XCHG BH,BL
     MOV CX,BX
     SHR BX,1
     SHR BX,1
     ADD CX,BX
     ADD CX,XOfs
 
     lodsw
     or ax,ax
     jz @Exit
     mov dx,ax
     lodsw
     or ax,ax
     jz @Exit
     mov bx,ax
 
     mov ax,cx
 
    @JP1:
     MOV DI,AX
     MOV CX,DX
     SHR CX,1
     JNC @JP2
     MOVSB
    @JP2:
     REPZ MOVSW
     ADD AX,140h
     DEC BX
     JNZ @JP1
 
    @Exit:
     POP DS
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
 
</font><font color="#FF0000"><b>Procedure </b></font>Z_0PutPixel <font color="#000080">( </font>X<font color="#000080">,</font>Y <font color="#000080">: </font>Word<font color="#000080">; </font>Color<font color="#000080">: </font>Byte <font color="#000080">);
</font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>asm
     </b></font><font color="#FF00FF">mov ax,0a000h
     mov es,ax
     mov di,x
     mov ax,y
     xchg ah,al          </font><font color="#008000"><i>{ multiply Y by 320 }
     </i></font><font color="#FF00FF">add di,ax
     shr ax,1
     shr ax,1
     add di,ax
     mov al,color
     stosb
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function  </b></font>Z_0GetPixel <font color="#000080">( </font>X<font color="#000080">,</font>Y <font color="#000080">: </font>Word <font color="#000080">): </font>Byte<font color="#000080">;
</font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>asm
    </b></font><font color="#FF00FF">push ds
    mov ax,0a000h
    mov ds,ax
    mov si,x
    mov ax,y
    xchg ah,al          </font><font color="#008000"><i>{ multiply Y by 320 }
    </i></font><font color="#FF00FF">add si,ax
    shr ax,1
    shr ax,1
    add si,ax
    lodsb
    pop ds
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to GRAPHICS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0182.PAS">Original</a><b>]</b></p></body>
</html>
