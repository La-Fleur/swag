<html>
<head><title> "Scroll Bars" by BAS VAN GAALEN</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to GRAPHICS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0124.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#FF0000"><b>USES </b></font>dos<font color="#000080">, </font>crt<font color="#000080">;

</font><font color="#FF0000"><b>CONST
    </b></font>v_vidseg   <font color="#000080">: </font>WORD <font color="#000080">= </font><font color="#800000">$B800</font><font color="#000080">;  </font><font color="#008000"><i>{ $B000 for mono }
    </i></font>v_columns  <font color="#000080">: </font>BYTE <font color="#000080">= </font><font color="#800000">80</font><font color="#000080">;     </font><font color="#008000"><i>{ Number of CRT columns }

</i></font><font color="#FF0000"><b>VAR
    </b></font>x <font color="#000080">: </font>BYTE<font color="#000080">;
</font><font color="#008000"><i>{
the dspat routine, as you can see.  Displays a string QUICKLY
If 'Col' (=columns, NOT color) is negative (-1) the centence will be centered.
Works also in exotic screenmodes, like 132x44, 100x44 or whatever you like.
}
</i></font><font color="#FF0000"><b>procedure </b></font>dspat<font color="#000080">(</font>Str <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">; </font>Col <font color="#000080">: </font>integer<font color="#000080">; </font>Row<font color="#000080">,</font>Attr <font color="#000080">: </font>byte<font color="#000080">); </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>asm
  </b></font><font color="#FF00FF">push ds          </font><font color="#008000"><i>{ Save Turbo's DS }
  </i></font><font color="#FF00FF">mov es,v_vidseg  </font><font color="#008000"><i>{ Place VideoBuffer in es }
  </i></font><font color="#FF00FF">xor dh,dh        </font><font color="#008000"><i>{ Clear DH }
  </i></font><font color="#FF00FF">mov dl,v_columns </font><font color="#008000"><i>{ Bytes per row }

  </i></font><font color="#FF00FF">lds si,Str       </font><font color="#008000"><i>{ DS:SI pts to Str }
  </i></font><font color="#FF00FF">xor cx,cx        </font><font color="#008000"><i>{ clear CX }
  </i></font><font color="#FF00FF">mov cl,[si]      </font><font color="#008000"><i>{ String len counted in CX }
  </i></font><font color="#FF00FF">jcxz @l5         </font><font color="#008000"><i>{ If null, quit }
  </i></font><font color="#FF00FF">inc si           </font><font color="#008000"><i>{ Point DS:SI to first char }

  </i></font><font color="#FF00FF">mov ax,Col       </font><font color="#008000"><i>{ Get Column value }
  </i></font><font color="#FF00FF">cmp ax,0
  jge @l6          </font><font color="#008000"><i>{ Absolute, or centered? }

  </i></font><font color="#FF00FF">mov ax,dx
  sub ax,cx        </font><font color="#008000"><i>{ Substract stringlen from total }
  </i></font><font color="#FF00FF">shr ax,1         </font><font color="#008000"><i>{ Centre}

 </i></font><font color="#FF00FF">@l6:
  mov di,ax
  shl di,1         </font><font color="#008000"><i>{ Double for attributes }

  </i></font><font color="#FF00FF">mov al,Row       </font><font color="#008000"><i>{ Get Row value }
  </i></font><font color="#FF00FF">mul dl           </font><font color="#008000"><i>{ Times rows }
  </i></font><font color="#FF00FF">shl ax,1

  add di,ax        </font><font color="#008000"><i>{ ES:DI pts to lst pos }
  </i></font><font color="#FF00FF">cld              </font><font color="#008000"><i>{ Direction flag forward }
  </i></font><font color="#FF00FF">mov ah,Attr      </font><font color="#008000"><i>{ Get Attribute }
 </i></font><font color="#FF00FF">@l1:
  lodsb            </font><font color="#008000"><i>{ Get a character}
  </i></font><font color="#FF00FF">stosw            </font><font color="#008000"><i>{ Write it with attribute }
  </i></font><font color="#FF00FF">loop @l1         </font><font color="#008000"><i>{ Go do next }
 </i></font><font color="#FF00FF">@l5:
  pop ds           </font><font color="#008000"><i>{ Restore DS and quit }
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>filltext<font color="#000080">(</font>Dir <font color="#000080">: </font>char<font color="#000080">; </font>X1<font color="#000080">,</font>Y1<font color="#000080">,</font>X2<font color="#000080">,</font>Y2<font color="#000080">,</font>Col <font color="#000080">: </font>byte<font color="#000080">); </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>asm
  </b></font><font color="#FF00FF">push ds          </font><font color="#008000"><i>{ Save Turbo's DS }

  </i></font><font color="#FF00FF">xor dh,dh        </font><font color="#008000"><i>{ Clear DH }
  </i></font><font color="#FF00FF">mov dl,v_columns </font><font color="#008000"><i>{ Bytes per row (number of columns) }

  </i></font><font color="#FF00FF">xor ah,ah
  mov es,v_vidseg  </font><font color="#008000"><i>{ Place VideoBuffer in ES and DS }
  </i></font><font color="#FF00FF">mov al,[X1]
  mov di,ax
  shl di,1         </font><font color="#008000"><i>{ Double for attributes }
  </i></font><font color="#FF00FF">mov al,[Y1]      </font><font color="#008000"><i>{ Get Row value }
  </i></font><font color="#FF00FF">mul dl           </font><font color="#008000"><i>{ Times rows }
  </i></font><font color="#FF00FF">shl ax,1
  add di,ax        </font><font color="#008000"><i>{ ES:DI pts to upperleft corner }

  </i></font><font color="#FF00FF">xor ch,ch
  mov cl,[X2]
  inc cl
  sub cl,[X1]      </font><font color="#008000"><i>{ Number of bytes to move in CL (columns) }
  </i></font><font color="#FF00FF">xor bh,bh
  mov bl,[Y2]
  inc bl
  sub bl,[Y1]      </font><font color="#008000"><i>{ Number of rows to move in BL }

  </i></font><font color="#FF00FF">sub dl,[X2]      </font><font color="#008000"><i>{ Substract right site }
  </i></font><font color="#FF00FF">dec dl
  shl dx,1         </font><font color="#008000"><i>{ Times two for attribs }
  </i></font><font color="#FF00FF">xor ah,ah        </font><font color="#008000"><i>{ Clear AH }
  </i></font><font color="#FF00FF">mov al,[X1]      </font><font color="#008000"><i>{ Left site }
  </i></font><font color="#FF00FF">shl ax,1         </font><font color="#008000"><i>{ Times two for attribs }
  </i></font><font color="#FF00FF">add dx,ax        </font><font color="#008000"><i>{ Calculated difference between last col - first col }

  </i></font><font color="#FF00FF">mov al,[Dir]
  mov ah,[Col]

  cld              </font><font color="#008000"><i>{ Direction flag forward }
 </i></font><font color="#FF00FF">@L1:
  push cx
  rep stosw
  pop cx
  add di,dx
  dec bl
  jnz @L1

  pop ds           </font><font color="#008000"><i>{ Restore DS and quit }
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{ Displays Veritical scrollbar }
</i></font><font color="#FF0000"><b>procedure </b></font>ScrollBar<font color="#000080">(</font>BarXPos<font color="#000080">,
                    </font>BarYPos <font color="#000080">: </font>byte<font color="#000080">;
                    </font>CurPos<font color="#000080">,
                    </font>ScrLen<font color="#000080">,                     </font><font color="#008000"><i>{ max screen row }
                    </i></font>NofItems <font color="#000080">: </font>word<font color="#000080">;
                    </font>ColAttr <font color="#000080">: </font>byte<font color="#000080">);
</font><font color="#FF0000"><b>var </b></font>barpos<font color="#000080">,</font>maxpos <font color="#000080">: </font>word<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>dspat<font color="#000080">(</font><font color="#800000">#30</font><font color="#000080">,</font>barxpos<font color="#000080">,</font>barypos<font color="#000080">,</font>colattr<font color="#000080">);
  </font>dspat<font color="#000080">(</font><font color="#800000">#31</font><font color="#000080">,</font>barxpos<font color="#000080">,</font>barypos<font color="#000080">+</font>scrlen<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">,</font>colattr<font color="#000080">);
  </font>filltext<font color="#000080">(</font><font color="#800000">'&plusmn;'</font><font color="#000080">,</font>barxpos<font color="#000080">,</font>barypos<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">,</font>barxpos<font color="#000080">,</font>barypos<font color="#000080">+</font>scrlen<font color="#000080">-</font><font color="#800000">2</font><font color="#000080">,</font>colattr<font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font>nofitems <font color="#000080">&gt;= </font><font color="#800000">1 </font><font color="#FF0000"><b>then begin
    </b></font>maxpos <font color="#000080">:= </font>scrlen<font color="#000080">-</font><font color="#800000">3</font><font color="#000080">;
    </font><font color="#FF0000"><b>if </b></font>nofitems <font color="#000080">&lt;&gt; </font><font color="#800000">1 </font><font color="#FF0000"><b>then </b></font>barpos <font color="#000080">:= </font>round<font color="#000080">(((</font>curpos<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">)/(</font>nofitems<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">))*</font>maxpos<font color="#000080">)
    </font><font color="#FF0000"><b>else </b></font>barpos <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
    </font>dspat<font color="#000080">(</font><font color="#800000">'&thorn;'</font><font color="#000080">,</font>barxpos<font color="#000080">,</font>barypos<font color="#000080">+</font>barpos<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">,</font>colattr<font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{ ScrollBar }

</i></font><font color="#FF0000"><b>BEGIN  </b></font><font color="#008000"><i>{ demo coded by Gayle Davis for SWAG 8/18/94 }

   </i></font>ClrScr<font color="#000080">;
   </font><font color="#008000"><i>{ put at col 40 of Row x, 3rd item selected }

   </i></font><font color="#FF0000"><b>FOR </b></font>X <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font><font color="#800000">24 </font><font color="#FF0000"><b>DO
       BEGIN
       </b></font>ScrollBar<font color="#000080">(</font><font color="#800000">40</font><font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font>x<font color="#000080">,</font><font color="#800000">22</font><font color="#000080">,</font><font color="#800000">40</font><font color="#000080">,</font><font color="#800000">31</font><font color="#000080">);
       </font>DELAY<font color="#000080">(</font><font color="#800000">300</font><font color="#000080">);
       </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>END</b></font><font color="#000080">.

</font>The <font color="#FF0000"><b>assembler </b></font>stuff <font color="#FF0000"><b>is </b></font>nicely documented<font color="#000080">, </font>so shouldn<font color="#800000">'t be a problem. What'</font>s
missing here<font color="#000080">, </font>you can define <font color="#FF0000"><b>as </b></font>constants at the top <font color="#FF0000"><b>of </b></font>your source<font color="#000080">, </font><font color="#FF0000"><b>or try to
</b></font>find <font color="#FF0000"><b>out </b></font>using interrupt<font color="#000080">-</font>calls <font color="#FF0000"><b>or </b></font>whatever<font color="#000080">...

</font>Btw<font color="#000080">: </font>these routines are taken from my very <font color="#FF0000"><b>private </b></font>video<font color="#000080">-</font><font color="#FF0000"><b>unit</b></font><font color="#000080">, </font><font color="#FF0000"><b>and </b></font>seem <font color="#FF0000"><b>to </b></font>work
<font color="#FF0000"><b>on </b></font>many different configurations <font color="#000080">(</font>so <font color="#FF0000"><b>far</b></font><font color="#000080">...) </font>But that<font color="#800000">'s also due to the fact
</font>that the v_columns <font color="#FF0000"><b>is </b></font>found through some interrupt<font color="#000080">-</font>calls <font color="#FF0000"><b>and </b></font>stuff<font color="#000080">...
</font>The routines work also <font color="#FF0000"><b>in </b></font><font color="#800000">132</font>x44 <font color="#FF0000"><b>or </b></font>whatever strange video<font color="#000080">-</font>mode<font color="#000080">.

</font>Another point <font color="#FF0000"><b>of </b></font>discussion<font color="#000080">: </font>no snow<font color="#000080">-</font>checking <font color="#FF0000"><b>is </b></font>performed<font color="#000080">. </font>I got <font color="#FF0000"><b>in </b></font>some
anoying discussions about this<font color="#000080">, </font>because <font color="#000080">(</font>imho<font color="#000080">) </font>CGA<font color="#800000">'s are hardly used these
</font>days<font color="#000080">. </font>So it seems a little <font color="#000080">... </font>nuts <font color="#000080">... </font><font color="#FF0000"><b>to </b></font>make support <font color="#FF0000"><b>for </b></font>that hand full <font color="#FF0000"><b>of
</b></font>CGA<font color="#000080">-</font>users<font color="#000080">. </font>Ah well<font color="#000080">, </font>enclose the sc yourself<font color="#000080">. </font>it<font color="#800000">'s not hard, but it REALY slow'</font>s
stuff down<font color="#000080">. </font><font color="#FF0000"><b>And </b></font>these routines were designed <font color="#FF0000"><b>with </b></font>SPEED <font color="#FF0000"><b>as </b></font>first concern <font color="#FF0000"><b>and
</b></font>compatibily <font color="#FF0000"><b>with </b></font>MODERN hardware <font color="#FF0000"><b>as </b></font>a second<font color="#000080">...

 </font>_    _
<font color="#000080">|</font>_<font color="#000080">]  | </font>_
<font color="#000080">|</font>__<font color="#000080">].|</font>__<font color="#000080">].
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to GRAPHICS SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0124.PAS">Original</a><b>]</b></p></body>
</html>
