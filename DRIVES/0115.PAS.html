<html>
<head><title> "Ask for insertion of diskette" by SUNE MARCHER</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to DRIVES SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0115.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{$g+,n-,e-,d-,q-,r-,s-,t-,v-,x-}
</i></font><font color="#FF0000"><b>uses </b></font>crt<font color="#000080">,</font>dos<font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>diskettedrives<font color="#000080">:</font>integer<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>asm
  </b></font><font color="#FF00FF">xor ax,ax
  xor bx,bx
  xor cx,cx
  xor dx,dx
  int 011h
  cmp ax,00001h
  je @@exit2
  @@exit2:
    xor ax,ax
  @@exit:
  shl ax,8
  shl ax,14
  inc ax
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>var
  </b></font>buf<font color="#000080">:</font><font color="#FF0000"><b>array </b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">512</font><font color="#000080">]</font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">;
  </font>ch<font color="#000080">:</font>char<font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>ready<font color="#000080">(</font>drivespec<font color="#000080">:</font>char<font color="#000080">):</font>boolean<font color="#000080">; </font><font color="#008000"><i>{A,B,etc}
</i></font><font color="#FF0000"><b>var
  </b></font>result<font color="#000080">:</font>word<font color="#000080">;
  </font>drive<font color="#000080">,</font>number<font color="#000080">,</font>logical<font color="#000080">:</font>word<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>ready<font color="#000080">:=</font>true<font color="#000080">;
  </font>drive<font color="#000080">:=</font>ord<font color="#000080">(</font>upcase<font color="#000080">(</font>drivespec<font color="#000080">))-</font><font color="#800000">65</font><font color="#000080">;
  </font><font color="#FF0000"><b>if</b></font><font color="#000080">(</font>drive<font color="#000080">&gt;</font>diskettedrives<font color="#000080">)</font><font color="#FF0000"><b>then </b></font>exit<font color="#000080">;
  </font>number<font color="#000080">:=</font><font color="#800000">1</font><font color="#000080">;
  </font>logical<font color="#000080">:=</font><font color="#800000">1</font><font color="#000080">;
  </font><font color="#FF0000"><b>asm
    </b></font><font color="#FF00FF">push bp
    push ds
    xor ax,ax
    mov result,ax
    mov al,byte ptr drive
    mov cx,number
    mov dx,logical
    mov bx,seg buf
    mov ds,bx
    mov bx,offset buf
    int 25h
    pop bx
    pop ds
    pop bp
    jnb @@done
    mov result,ax
   @@done:
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>ready<font color="#000080">:=(</font>result<font color="#000080">=</font><font color="#800000">0</font><font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>dodummy<font color="#000080">(</font><font color="#FF0000"><b>const </b></font>d<font color="#000080">:</font>char<font color="#000080">):</font>boolean<font color="#000080">;
</font><font color="#FF0000"><b>var </b></font>f<font color="#000080">:</font><font color="#FF0000"><b>file</b></font><font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>dodummy<font color="#000080">:=</font>false<font color="#000080">;
  </font>assign<font color="#000080">(</font>f<font color="#000080">,</font>d<font color="#000080">+</font><font color="#800000">':\dummy'</font><font color="#000080">);
  </font><font color="#008000"><i>{$i-} </i></font>rewrite<font color="#000080">(</font>f<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">); </font><font color="#008000"><i>{$i+}
  </i></font><font color="#FF0000"><b>if</b></font><font color="#000080">(</font>ioresult<font color="#000080">&lt;&gt;</font><font color="#800000">0</font><font color="#000080">)</font><font color="#FF0000"><b>then
  begin
    </b></font>exit<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#008000"><i>{$i-} </i></font>close<font color="#000080">(</font>f<font color="#000080">); </font><font color="#008000"><i>{$i+}
  </i></font><font color="#FF0000"><b>if</b></font><font color="#000080">(</font>ioresult<font color="#000080">&lt;&gt;</font><font color="#800000">0</font><font color="#000080">)</font><font color="#FF0000"><b>then </b></font>exit<font color="#000080">;
  </font><font color="#008000"><i>{$i-} </i></font>erase<font color="#000080">(</font>f<font color="#000080">); </font><font color="#008000"><i>{$i+}
  </i></font><font color="#FF0000"><b>if</b></font><font color="#000080">(</font>ioresult<font color="#000080">&lt;&gt;</font><font color="#800000">0</font><font color="#000080">)</font><font color="#FF0000"><b>then </b></font>exit<font color="#000080">;
  </font>dodummy<font color="#000080">:=</font>true<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>begin
  repeat
    </b></font>writeln<font color="#000080">(</font><font color="#800000">'insert a unprotected disk in drive A: and press any key!'</font><font color="#000080">);
    </font>ch<font color="#000080">:=</font>readkey<font color="#000080">;
  </font><font color="#FF0000"><b>until</b></font><font color="#000080">(</font>ready<font color="#000080">(</font><font color="#800000">'a'</font><font color="#000080">))</font><font color="#FF0000"><b>and</b></font><font color="#000080">(</font>dodummy<font color="#000080">(</font><font color="#800000">'a'</font><font color="#000080">));
</font><font color="#FF0000"><b>end</b></font><font color="#000080">.</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to DRIVES SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0115.PAS">Original</a><b>]</b></p></body>
</html>
