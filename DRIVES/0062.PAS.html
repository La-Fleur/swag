<html>
<head><title> "Detecting CDROM Drives" by GREG VIGNEAULT</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to DRIVES SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0062.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
From: GREG VIGNEAULT
Subj: Extended drives (CD-ROM)
---------------------------------------------------------------------------
 In a message with STEVE ROGERS...
SR&gt;PN&gt;  Is it acceptable and safe for the hardware to attempt to write
SR&gt;  &gt;  a test file to a CD-Rom drive? I would do this to find out that
SR&gt;  I tried this a few years ago and just got a write error. Should be
SR&gt;  safe enough.

LD&gt;Although... would you not get the same result as you would on a
  &gt;write-protected disk, or a full disk, or one where the &quot;test&quot;
  &gt;file name is unacceptable?

 Hi Lou,

 I haven't been following this thread, so I don't know what all has
 been said. I don't have a CD-ROM but I'll toss in some of the info
 that I'm aware of...

 Here is TP source that can detect if one or more CD-ROM is present
 in a PC system, and the drive letter of the first CD-ROM. It tries
 to find if the Microsoft CD-ROM Extension (MSCDEX) is installed...
}

(*******************************************************************)
</i></font><font color="#FF0000"><b>PROGRAM </b></font>CDROM<font color="#000080">;                    </font><font color="#008000"><i>{ compiler: Turbo Pascal 4.0+     }
                                  { Jan.07.94 Greg Vigneault        }

</i></font><font color="#FF0000"><b>USES  </b></font>Dos<font color="#000080">;                        </font><font color="#008000"><i>{ import  Intr, Registers         }
</i></font><font color="#FF0000"><b>VAR   </b></font>DrvName   <font color="#000080">: </font>CHAR<font color="#000080">;           </font><font color="#008000"><i>{ first extended drive (A: to Z:) }
      </i></font>DrvCount   <font color="#000080">: </font>WORD<font color="#000080">;          </font><font color="#008000"><i>{ number of extended drives       }
      </i></font>IsMSCDEX<font color="#000080">,                   </font><font color="#008000"><i>{ TRUE if MSCDEX is installed     }
      </i></font>IsCDROM   <font color="#000080">: </font>BOOLEAN<font color="#000080">;        </font><font color="#008000"><i>{ TRUE if extended drive is CDROM }

(*-----------------------------------------------------------------*)
{ Detect if/how-many extended drives (CD-ROMs) are in system ...    }

</i></font><font color="#FF0000"><b>PROCEDURE </b></font>CD_ROMdat <font color="#000080">( </font><font color="#FF0000"><b>VAR </b></font>DrvCount  <font color="#000080">: </font>WORD<font color="#000080">;     </font><font color="#008000"><i>{ total ext. drives }
                      </i></font><font color="#FF0000"><b>VAR </b></font>FirstDrv  <font color="#000080">: </font>CHAR<font color="#000080">;     </font><font color="#008000"><i>{ first ext. drv    }
                      </i></font><font color="#FF0000"><b>VAR </b></font>IsMSCDEX  <font color="#000080">: </font>BOOLEAN<font color="#000080">;  </font><font color="#008000"><i>{ MSCDEX found?     }
                      </i></font><font color="#FF0000"><b>VAR </b></font>IsCDROM   <font color="#000080">: </font>BOOLEAN<font color="#000080">); </font><font color="#008000"><i>{ is CD-ROM?        }
  </i></font><font color="#FF0000"><b>VAR </b></font>Reg <font color="#000080">: </font>Registers<font color="#000080">;            </font><font color="#008000"><i>{ to access 8086 CPU registers    }
  </i></font><font color="#FF0000"><b>BEGIN </b></font><font color="#008000"><i>{CD_ROMdat}
                                  { initialize the VARs...          }
      </i></font>FirstDrv  <font color="#000080">:= </font><font color="#800000">#0</font><font color="#000080">;            </font><font color="#008000"><i>{ assume no extension drives      }
      </i></font>IsMSCDEX  <font color="#000080">:= </font>FALSE<font color="#000080">;         </font><font color="#008000"><i>{ assume MSCDEX not installed     }
      </i></font>IsCDROM   <font color="#000080">:= </font>FALSE<font color="#000080">;         </font><font color="#008000"><i>{ assume drive isn't a CD-ROM     }
      </i></font>Reg<font color="#000080">.</font>AX <font color="#000080">:= </font><font color="#800000">$1500</font><font color="#000080">;            </font><font color="#008000"><i>{ fn: check if CD-ROM is present  }
      </i></font>Reg<font color="#000080">.</font>BX <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;                    </font><font color="#008000"><i>{ clear BX                    }
      </i></font>Intr <font color="#000080">(</font><font color="#800000">$2F</font><font color="#000080">, </font>Reg<font color="#000080">);                </font><font color="#008000"><i>{ invoke MSCDEX               }
      </i></font>DrvCount <font color="#000080">:= </font>Reg<font color="#000080">.</font>BX<font color="#000080">;             </font><font color="#008000"><i>{ count of extended drives    }
      </i></font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>DrvCount <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>THEN </b></font>EXIT<font color="#000080">;    </font><font color="#008000"><i>{ abort if no extended drive  }
      </i></font>FirstDrv <font color="#000080">:= </font>CHR <font color="#000080">(</font>Reg<font color="#000080">.</font>CX <font color="#000080">+ </font><font color="#800000">65</font><font color="#000080">);  </font><font color="#008000"><i>{ first drive IN ['A'..'Z']   }
      </i></font>Reg<font color="#000080">.</font>AX <font color="#000080">:= </font><font color="#800000">$150B</font><font color="#000080">;                </font><font color="#008000"><i>{ fn: CD-ROM drive check      }
      </i></font>Reg<font color="#000080">.</font>BX <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;                    </font><font color="#008000"><i>{ Reg.CX already has drive #  }
      </i></font>Intr <font color="#000080">(</font><font color="#800000">$2F</font><font color="#000080">, </font>Reg<font color="#000080">);                </font><font color="#008000"><i>{ call the CD-ROM services    }
      </i></font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>Reg<font color="#000080">.</font>BX <font color="#000080">&lt;&gt; </font><font color="#800000">$ADAD</font><font color="#000080">) </font><font color="#FF0000"><b>THEN </b></font>EXIT<font color="#000080">; </font><font color="#008000"><i>{ MSCDEX isn't installed      }
      </i></font>IsMSCDEX <font color="#000080">:= </font>TRUE<font color="#000080">;               </font><font color="#008000"><i>{ MSCDEX is installed         }
      </i></font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>Reg<font color="#000080">.</font>AX <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>THEN </b></font>EXIT<font color="#000080">;      </font><font color="#008000"><i>{ ext. drive isn't a CD-ROM   }
      </i></font>IsCDROM <font color="#000080">:= </font>TRUE<font color="#000080">;                </font><font color="#008000"><i>{ extended is a CD-ROM        }
  </i></font><font color="#FF0000"><b>END </b></font><font color="#008000"><i>{CD_ROMdat}</i></font><font color="#000080">;                    </font><font color="#008000"><i>{ END PROCEDURE DC_ROMdat     }

(*-----------------------------------------------------------------*)
</i></font><font color="#FF0000"><b>BEGIN </b></font><font color="#008000"><i>{PROGRAM CDROM}

  </i></font>CD_ROMdat <font color="#000080">(</font>DrvCount<font color="#000080">, </font>DrvName<font color="#000080">, </font>IsMSCDEX<font color="#000080">, </font>IsCDROM<font color="#000080">);
  </font>WriteLn<font color="#000080">;

  </font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>DrvCount <font color="#000080">&lt;&gt; </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>THEN BEGIN
    IF </b></font>IsMSCDEX <font color="#FF0000"><b>THEN </b></font>WriteLn <font color="#000080">(</font><font color="#800000">'MSCDEX is installed'</font><font color="#000080">);
    </font>Write <font color="#000080">(</font><font color="#800000">'Extended drive(s) detected'</font><font color="#000080">);
    </font><font color="#FF0000"><b>IF </b></font>IsCDROM <font color="#FF0000"><b>THEN </b></font>Write <font color="#000080">(</font><font color="#800000">' (CD-ROM)'</font><font color="#000080">);
    </font>WriteLn <font color="#000080">(</font><font color="#800000">' = '</font><font color="#000080">,</font>DrvCount<font color="#000080">,</font><font color="#800000">' at '</font><font color="#000080">,</font>DrvName<font color="#000080">,</font><font color="#800000">':'</font><font color="#000080">);
    </font><font color="#FF0000"><b>END </b></font><font color="#008000"><i>{IF DrvCount}
  </i></font><font color="#FF0000"><b>ELSE
    </b></font>WriteLn <font color="#000080">(</font><font color="#800000">'No extended drives (CD-ROMs) detected in system.'</font><font color="#000080">);

  </font>WriteLn<font color="#000080">;

</font><font color="#FF0000"><b>END </b></font><font color="#008000"><i>{CDROM}</i></font><font color="#000080">.
</font><font color="#008000"><i>(*******************************************************************)

 </i></font>The familiar Int21h <font color="#FF0000"><b>file </b></font>i<font color="#000080">/</font>o can be used <font color="#FF0000"><b>for </b></font>reading files <font color="#FF0000"><b>on </b></font>an
 extended drive<font color="#000080">.  </font>The MSCDEX also offers the following extended
 functions<font color="#000080">...

      </font>o Get CD<font color="#000080">-</font>ROM Drive List
      o Get Copyright Filename
      o Get <font color="#FF0000"><b>Abstract </b></font>Filename
      o Get Bibliographic Filename
      o Read Volume Table <font color="#FF0000"><b>of </b></font>Contents
      o <font color="#FF0000"><b>Absolute </b></font>Disk Read
      o <font color="#FF0000"><b>Absolute </b></font>Disk Write
      o Get CD<font color="#000080">-</font>ROM Extensions Version
      o Get CD<font color="#000080">-</font>ROM Units
      o Get <font color="#FF0000"><b>or Set </b></font>Volume Descriptor Preference
      o Get Directory Entry
      o Send Device Request

 Greg_

</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to DRIVES SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0062.PAS">Original</a><b>]</b></p></body>
</html>
