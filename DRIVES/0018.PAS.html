<html>
<head><title> "Drive VOL-Serial" by SWAG SUPPORT TEAM</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to DRIVES SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0018.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
 This Turbo Pascal code will read the serial number and volume
 from disks that have been Formatted under Dos 4.0 and higher ...
}
(*-------------------------------------------------------------------*)
</i></font><font color="#FF0000"><b>Program </b></font>VolSN<font color="#000080">;  </font><font color="#008000"><i>{ reads disk serial number &amp; volume Label (Dos 4.0+) }
</i></font><font color="#FF0000"><b>Uses    </b></font>Dos<font color="#000080">;
</font><font color="#FF0000"><b>Type    </b></font>MediaID <font color="#000080">= </font><font color="#FF0000"><b>Record
                    </b></font>InfoLevel   <font color="#000080">: </font>Word<font color="#000080">;
                    </font>SerialN     <font color="#000080">: </font>LongInt<font color="#000080">;
                    </font>VLabel      <font color="#000080">: </font><font color="#FF0000"><b>Array </b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">10</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Char<font color="#000080">;
                    </font>SysName     <font color="#000080">: </font><font color="#FF0000"><b>Array </b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">7</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Char<font color="#000080">;
                  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Var     </b></font>IDbuffer        <font color="#000080">: </font>MediaID<font color="#000080">;
        </font>SerialNumber    <font color="#000080">: </font>LongInt<font color="#000080">;
        </font>VolumeLabel     <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">[</font><font color="#800000">12</font><font color="#000080">];
        </font>Reg             <font color="#000080">: </font>Registers<font color="#000080">;
        </font>loopc           <font color="#000080">: </font>Byte<font color="#000080">;
</font><font color="#FF0000"><b>begin
        </b></font>WriteLn<font color="#000080">( </font><font color="#800000">#10</font><font color="#000080">, </font><font color="#800000">'VolStat 0.00 Greg Vigneault'</font><font color="#000080">, </font><font color="#800000">#10 </font><font color="#000080">);

        </font>Reg<font color="#000080">.</font>AH <font color="#000080">:= </font><font color="#800000">$30</font><font color="#000080">;      </font><font color="#008000"><i>{ Function to get Dos version number }
        </i></font>MsDos<font color="#000080">( </font>Reg <font color="#000080">);       </font><font color="#008000"><i>{ via MS-Dos }
        </i></font><font color="#FF0000"><b>if </b></font><font color="#000080">( </font>Reg<font color="#000080">.</font>AL <font color="#000080">&lt; </font><font color="#800000">4 </font><font color="#000080">) </font><font color="#FF0000"><b>or </b></font><font color="#000080">( </font>Reg<font color="#000080">.</font>AL <font color="#000080">= </font><font color="#800000">10 </font><font color="#000080">)
            </font><font color="#FF0000"><b>then begin      </b></font><font color="#008000"><i>{ must be Dos 4.0 or above (&amp; not OS/2?) }
                </i></font>WriteLn<font color="#000080">( </font><font color="#800000">'Dos version error'</font><font color="#000080">,</font><font color="#800000">#7 </font><font color="#000080">);
                </font>Halt<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">)     </font><font color="#008000"><i>{ abort Program }
            </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

        </font>Reg<font color="#000080">.</font>AX <font color="#000080">:= </font><font color="#800000">$6900</font><font color="#000080">;            </font><font color="#008000"><i>{ Dos Function  }
        </i></font>Reg<font color="#000080">.</font>BL <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;                </font><font color="#008000"><i>{ Drive (0=current,1=A,2=B,etc)}
        </i></font>Reg<font color="#000080">.</font>DS <font color="#000080">:= </font>Seg<font color="#000080">( </font>IDbuffer <font color="#000080">);  </font><font color="#008000"><i>{ place to return data }
        </i></font>Reg<font color="#000080">.</font>DX <font color="#000080">:= </font>ofs<font color="#000080">( </font>IDbuffer <font color="#000080">);
        </font>MsDos<font color="#000080">( </font>Reg <font color="#000080">);               </font><font color="#008000"><i>{ call Dos }
        { there'll be an error if disk doesn't have a serial # ... }
        </i></font><font color="#FF0000"><b>if </b></font><font color="#000080">( </font>Reg<font color="#000080">.</font>FLAGS <font color="#FF0000"><b>and </b></font><font color="#800000">1 </font><font color="#000080">) &lt;&gt; </font><font color="#800000">0 </font><font color="#008000"><i>{ carry flag set? }
            </i></font><font color="#FF0000"><b>then begin
                </b></font>WriteLn<font color="#000080">( </font><font color="#800000">'Dos error getting Media ID'</font><font color="#000080">,</font><font color="#800000">#7 </font><font color="#000080">);
                </font>Halt<font color="#000080">(</font><font color="#800000">2</font><font color="#000080">);
            </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

        </font>SerialNumber <font color="#000080">:= </font>IDbuffer<font color="#000080">.</font>SerialN<font color="#000080">;   </font><font color="#008000"><i>{ get serial number }

        </i></font>WriteLn<font color="#000080">( </font><font color="#800000">'Disk serial number: '</font><font color="#000080">, </font>SerialNumber <font color="#000080">);

        </font>VolumeLabel <font color="#000080">:= </font><font color="#800000">''</font><font color="#000080">;
        </font>loopc <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
        </font><font color="#FF0000"><b>While </b></font><font color="#000080">( </font>IDbuffer<font color="#000080">.</font>VLabel<font color="#000080">[ </font>loopc <font color="#000080">] &lt;&gt; </font><font color="#800000">' ' </font><font color="#000080">)
            </font><font color="#FF0000"><b>do begin
                </b></font>VolumeLabel<font color="#000080">[ </font>loopc<font color="#000080">+</font><font color="#800000">1 </font><font color="#000080">] := </font>IDbuffer<font color="#000080">.</font>VLabel<font color="#000080">[ </font>loopc <font color="#000080">];
                </font>inC<font color="#000080">( </font>loopc <font color="#000080">);
            </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
        </font>VolumeLabel<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">] := </font>CHR<font color="#000080">( </font>loopc <font color="#000080">); </font><font color="#008000"><i>{ set TP String length }
        </i></font><font color="#FF0000"><b>if </b></font><font color="#000080">( </font>loopc <font color="#000080">&lt;&gt; </font><font color="#800000">0 </font><font color="#000080">) </font><font color="#FF0000"><b>then
            </b></font>WriteLn<font color="#000080">( </font><font color="#800000">'Disk volume Label : '</font><font color="#000080">, </font>VolumeLabel <font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to DRIVES SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0018.PAS">Original</a><b>]</b></p></body>
</html>
