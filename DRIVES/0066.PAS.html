<html>
<head><title> "GIG Drive Size/Free" by BO BENDTSEN</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to DRIVES SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0066.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
From: BO BENDTSEN
Subj: Diskfree...

 MT&gt; Has anyone noticed the problem with TP returning the wrong values from the
 MT&gt; DISKFREE function on large size HD's? We have a 2 gig drive at work
 MT&gt; (actual total is like 1900000000 bytes free), and pascal returns something
 MT&gt; like 576009491. All variables are longint.


Many people does not think about it, but DOS is limited to report more than
1 gigabyte. Myself I have a 1.3 giga and a 1.0 giga, and made these routines
for my programs for knowing if the size is more than 1 giga. Using the normal
DiskSize and DiskFree could get you strange result, sometimes it could report
maybe 100MB when it is really 1 giga.

If the size og free space is 1 you can assume that the drive is more than 1
gigabyte.}

</i></font><font color="#FF0000"><b>Function </b></font>DriveSize<font color="#000080">(</font>d<font color="#000080">:</font>byte<font color="#000080">):</font>Longint<font color="#000080">; </font><font color="#008000"><i>{ -1 not found, 1=&gt;1 Giga }
</i></font><font color="#FF0000"><b>Var
  </b></font>R <font color="#000080">: </font>Registers<font color="#000080">;
</font><font color="#FF0000"><b>Begin
  With </b></font>R <font color="#FF0000"><b>Do
  Begin
    </b></font>ah<font color="#000080">:=</font><font color="#800000">$36</font><font color="#000080">; </font>dl<font color="#000080">:=</font>d<font color="#000080">; </font>Intr<font color="#000080">(</font><font color="#800000">$21</font><font color="#000080">,</font>R<font color="#000080">);
    </font><font color="#FF0000"><b>If </b></font>AX<font color="#000080">=</font><font color="#800000">$FFFF </font><font color="#FF0000"><b>Then </b></font>DriveSize<font color="#000080">:=-</font><font color="#800000">1 </font><font color="#008000"><i>{ Drive not found }
    </i></font><font color="#FF0000"><b>Else If </b></font><font color="#000080">(</font>DX<font color="#000080">=</font><font color="#800000">$FFFF</font><font color="#000080">) </font><font color="#FF0000"><b>or </b></font><font color="#000080">(</font>Longint<font color="#000080">(</font>ax<font color="#000080">)*</font>cx<font color="#000080">*</font>dx<font color="#000080">=</font><font color="#800000">1073725440</font><font color="#000080">) </font><font color="#FF0000"><b>Then </b></font>DriveSize<font color="#000080">:=</font><font color="#800000">1
    </font><font color="#FF0000"><b>Else </b></font>DriveSize<font color="#000080">:=</font>Longint<font color="#000080">(</font>ax<font color="#000080">)*</font>cx<font color="#000080">*</font>dx<font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>DriveFree<font color="#000080">(</font>d<font color="#000080">:</font>byte<font color="#000080">):</font>Longint<font color="#000080">; </font><font color="#008000"><i>{ -1 not found, 1=&gt;1 Giga }
</i></font><font color="#FF0000"><b>Var
  </b></font>R <font color="#000080">: </font>Registers<font color="#000080">;
</font><font color="#FF0000"><b>Begin
  With </b></font>R <font color="#FF0000"><b>Do
  Begin
    </b></font>ah<font color="#000080">:=</font><font color="#800000">$36</font><font color="#000080">; </font>dl<font color="#000080">:=</font>d<font color="#000080">; </font>Intr<font color="#000080">(</font><font color="#800000">$21</font><font color="#000080">,</font>R<font color="#000080">);
    </font><font color="#FF0000"><b>If </b></font>AX<font color="#000080">=</font><font color="#800000">$FFFF </font><font color="#FF0000"><b>Then </b></font>DriveFree<font color="#000080">:=-</font><font color="#800000">1 </font><font color="#008000"><i>{ Drive not found }
    </i></font><font color="#FF0000"><b>Else If </b></font><font color="#000080">(</font>BX<font color="#000080">=</font><font color="#800000">$FFFF</font><font color="#000080">) </font><font color="#FF0000"><b>or </b></font><font color="#000080">(</font>Longint<font color="#000080">(</font>ax<font color="#000080">)*</font>bx<font color="#000080">*</font>cx<font color="#000080">=</font><font color="#800000">1073725440</font><font color="#000080">) </font><font color="#FF0000"><b>Then </b></font>DriveFree<font color="#000080">:=</font><font color="#800000">1
    </font><font color="#FF0000"><b>Else </b></font>DriveFree<font color="#000080">:=</font>Longint<font color="#000080">(</font>ax<font color="#000080">)*</font>bx<font color="#000080">*</font>cx<font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to DRIVES SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0066.PAS">Original</a><b>]</b></p></body>
</html>
