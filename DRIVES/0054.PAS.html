<html>
<head><title> "Disk Serial Number in ASM" by JIMISOLA LAURSEN</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to DRIVES SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0054.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
jimisola.laursen@cindy.ct.se (jimisola laursen)

&gt; Anybody know how to read the Volume Serial Number from a (hard) disk??
&gt; No problem getting the Volume Label, but this seemsa to be another matter...
}

</i></font><font color="#FF0000"><b>Unit </b></font>Serial<font color="#000080">;

</font><font color="#FF0000"><b>Interface

Uses
  </b></font>Dos<font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>Get_Serial_number<font color="#000080">(</font>Drive <font color="#000080">: </font>Byte<font color="#000080">) : </font><font color="#FF0000"><b>String</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Implementation

Asm
  </b></font><font color="#FF00FF">mov  ax, w
  mov  bx, b
  xor  cx, cx
  les  di, @result
  xor  si, si
  jcxz @@@20
 @@@10:
  xor  dx, dx
  div  bx
  cmp  dl, 10
  jb   @h10
  add  dl, 'A'-10
  jmp  @h20
 @h10:
   or  dl, '0'
 @h20:
  push dx
  inc  si
  loop @@@10
 @@@20:
  inc  cx
  or   ax, ax
  jnz  @@@10
  mov  cx, si
  jcxz @@@40
  cld
  mov  al, cl
  stosb
 @@@30:
  pop  ax
  stosb
  loop @@@30
 @@@40:
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>Get_Serial_number<font color="#000080">(</font>Drive <font color="#000080">: </font>Byte<font color="#000080">) : </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
</font><font color="#008000"><i>(* &quot;Drive&quot; is 0=current, 1=A:, 2=B: osv.. *)
</i></font><font color="#FF0000"><b>Type
  </b></font>Disk_info <font color="#000080">= </font><font color="#FF0000"><b>Record
    </b></font>RES     <font color="#000080">: </font>Word<font color="#000080">;                 </font><font color="#008000"><i>(* reserverad ska Vara 0 *)
    </i></font>SER_NR1 <font color="#000080">: </font>Word<font color="#000080">;                 </font><font color="#008000"><i>(* Serinummer (bin{rt) *)
    </i></font>SER_NR2 <font color="#000080">: </font>Word<font color="#000080">;                 </font><font color="#008000"><i>(* Serinummer (bin{rt) *)
    </i></font>VOL     <font color="#000080">: </font><font color="#FF0000"><b>Array </b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">11</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Char<font color="#000080">;</font><font color="#008000"><i>(* Volume Label *)
    </i></font>TYP     <font color="#000080">: </font><font color="#FF0000"><b>Array </b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">8</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Char<font color="#000080">; </font><font color="#008000"><i>(* tex 'FAT12' eller 'FAT16' *)
  </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Var
   </b></font>D_I    <font color="#000080">: </font>Disk_Info<font color="#000080">;
   </font>s1<font color="#000080">, </font>s2 <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">[</font><font color="#800000">5</font><font color="#000080">];
</font><font color="#FF0000"><b>begin
  Asm
    </b></font><font color="#FF00FF">push ds
    mov ax,ss
    mov ds,ax
    lea dx,D_I
    mov bl,drive
    mov ax,6900h
    int 21h
    pop ds
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>s1 <font color="#000080">:= </font>NumAscii<font color="#000080">(</font>D_I<font color="#000080">.</font>SER_NR2<font color="#000080">, </font><font color="#800000">16</font><font color="#000080">);
  </font>s2 <font color="#000080">:= </font>NumAscii<font color="#000080">(</font>D_I<font color="#000080">.</font>SER_NR1<font color="#000080">, </font><font color="#800000">16</font><font color="#000080">);
  </font><font color="#FF0000"><b>While </b></font>length<font color="#000080">(</font>s1<font color="#000080">) &lt; </font><font color="#800000">4 </font><font color="#FF0000"><b>do
    </b></font>s1 <font color="#000080">:= </font><font color="#800000">'0' </font><font color="#000080">+ </font>s1<font color="#000080">;
  </font><font color="#FF0000"><b>While </b></font>length<font color="#000080">(</font>s2<font color="#000080">) &lt; </font><font color="#800000">4 </font><font color="#FF0000"><b>do
    </b></font>s2 <font color="#000080">:= </font><font color="#800000">'0' </font><font color="#000080">+ </font>s2<font color="#000080">;
  </font>Get_Serial_number <font color="#000080">:= </font>s1 <font color="#000080">+ </font><font color="#800000">'-' </font><font color="#000080">+ </font>s2<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>end</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to DRIVES SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0054.PAS">Original</a><b>]</b></p></body>
</html>
