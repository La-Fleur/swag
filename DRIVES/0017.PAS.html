<html>
<head><title> "Drive Volume ID" by SWAG SUPPORT TEAM</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to DRIVES SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0017.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
 In the thread concerning copy protection (in which I have no
 interest) the serial number of a disk was mentioned.
 How can this be read from TP? Can it be changed other than
 by re-Formatting? I can't find any reference to serial number
 in the Dos 5.0 users guide except a passing one in the section
 on the ForMAT command.

Reading the volume id number is no problem:

reads volume id number -- not sophisticated enough to
determine whether disk was Formatted With a Dos version
new enough to assign volume id }

</i></font><font color="#FF0000"><b>Uses </b></font>Dos<font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>Byte2HexSt<font color="#000080">(</font>b <font color="#000080">: </font>Byte<font color="#000080">) : </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Const
  </b></font>hexChars<font color="#000080">: </font><font color="#FF0000"><b>Array </b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">$F</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Char <font color="#000080">=
    </font><font color="#800000">'0123456789ABCDEF'</font><font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>Byte2HexSt <font color="#000080">:= </font>hexChars<font color="#000080">[</font>b <font color="#FF0000"><b>shr </b></font><font color="#800000">4</font><font color="#000080">] + </font>hexChars<font color="#000080">[</font>b <font color="#FF0000"><b>and </b></font><font color="#800000">$F</font><font color="#000080">];
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>ResetDisk<font color="#000080">(</font>DriveNo <font color="#000080">: </font>Byte<font color="#000080">);
</font><font color="#FF0000"><b>Var
  </b></font>reg <font color="#000080">: </font>Registers<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>reg<font color="#000080">.</font>ah <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;        </font><font color="#008000"><i>{ bios Function reset drive system }
  </i></font>reg<font color="#000080">.</font>dl <font color="#000080">:= </font>DriveNo<font color="#000080">;
  </font>intr<font color="#000080">(</font><font color="#800000">$13</font><font color="#000080">,</font>reg<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>VolIDSt<font color="#000080">(</font>DriveCh <font color="#000080">: </font>Char<font color="#000080">) : </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
</font><font color="#008000"><i>{ returns Volume ID number as a String of hex digits }
</i></font><font color="#FF0000"><b>Var
  </b></font>reg <font color="#000080">: </font>Registers<font color="#000080">;
  </font><font color="#FF0000"><b>try </b></font><font color="#000080">: </font>Integer<font color="#000080">;
  </font>buff <font color="#000080">: </font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">1023</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Byte<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>DriveCh <font color="#000080">:= </font>upCase<font color="#000080">(</font>DriveCh<font color="#000080">);
  </font><font color="#FF0000"><b>try </b></font><font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font><font color="#FF0000"><b>Repeat
    </b></font>reg<font color="#000080">.</font>ax <font color="#000080">:= </font><font color="#800000">$0201</font><font color="#000080">;  </font><font color="#008000"><i>{ ah = bios Function read disk sector }
                      { al = read 1 sector }
    </i></font>reg<font color="#000080">.</font>cx <font color="#000080">:= </font><font color="#800000">$0001</font><font color="#000080">;  </font><font color="#008000"><i>{ ch = cylinder number }
                      { cl = sector number }
    </i></font>reg<font color="#000080">.</font>dh <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;      </font><font color="#008000"><i>{ head number }
    </i></font>reg<font color="#000080">.</font>dl <font color="#000080">:= </font>ord<font color="#000080">(</font>DriveCh<font color="#000080">) - </font><font color="#800000">65</font><font color="#000080">;  </font><font color="#008000"><i>{ drive number }
    </i></font>reg<font color="#000080">.</font>es <font color="#000080">:= </font>seg<font color="#000080">(</font>buff<font color="#000080">);
    </font>reg<font color="#000080">.</font>bx <font color="#000080">:= </font>ofs<font color="#000080">(</font>buff<font color="#000080">);
    </font>intr<font color="#000080">(</font><font color="#800000">$13</font><font color="#000080">,</font>reg<font color="#000080">);
    </font>inc<font color="#000080">(</font><font color="#FF0000"><b>try</b></font><font color="#000080">);
    </font><font color="#FF0000"><b>if </b></font>reg<font color="#000080">.</font>flags <font color="#FF0000"><b>and </b></font>FCarry <font color="#000080">&lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>ResetDisk<font color="#000080">(</font>reg<font color="#000080">.</font>dl<font color="#000080">);
  </font><font color="#FF0000"><b>Until </b></font><font color="#000080">((</font>reg<font color="#000080">.</font>flags <font color="#FF0000"><b>and </b></font>FCarry<font color="#000080">) = </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>or </b></font><font color="#000080">(</font><font color="#FF0000"><b>try </b></font><font color="#000080">= </font><font color="#800000">3</font><font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font>reg<font color="#000080">.</font>flags <font color="#FF0000"><b>and </b></font>FCarry <font color="#000080">&lt;&gt; </font><font color="#800000">0
    </font><font color="#FF0000"><b>then </b></font>VolIDSt <font color="#000080">:= </font><font color="#800000">'Error attempting to read volume ID number'
    </font><font color="#FF0000"><b>else </b></font>VolIDSt <font color="#000080">:= </font>Byte2HexSt<font color="#000080">(</font>buff<font color="#000080">[</font><font color="#800000">$2A</font><font color="#000080">]) +
                    </font>Byte2HexSt<font color="#000080">(</font>buff<font color="#000080">[</font><font color="#800000">$29</font><font color="#000080">]) + </font><font color="#800000">'-' </font><font color="#000080">+
                    </font>Byte2HexSt<font color="#000080">(</font>buff<font color="#000080">[</font><font color="#800000">$28</font><font color="#000080">]) +
                    </font>Byte2HexSt<font color="#000080">(</font>buff<font color="#000080">[</font><font color="#800000">$27</font><font color="#000080">]);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{
Can the volume id number be changed?  You bet.

Although it is True that DISKCOPY will not copy the volume id
number from the original disk, it's still a pretty weak basis For a
copy protection scheme.  I consider myself a pretty unsophisticated
Programmer, but it only took me a few minutes of fooling around to
figure out where the volume id number is on the disk.  then all you
have to do is grab an interrupt reference and quickly Type up some
code to read and Write to the right spot on the disk.
}
</i></font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to DRIVES SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0017.PAS">Original</a><b>]</b></p></body>
</html>
