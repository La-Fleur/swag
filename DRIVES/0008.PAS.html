<html>
<head><title> "Detect Active DOS Drives" by SWAG SUPPORT TEAM</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to DRIVES SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0008.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{ JW&sup3; How do I detect active drives in Pascal?  My Program would crash if you
   &sup3; Typed in a non-existent drive as either source or destination.

Here's the method I use:
}
</i></font><font color="#FF0000"><b>Uses
  </b></font>Dos<font color="#000080">;

</font><font color="#FF0000"><b>Var
  </b></font>Isthere <font color="#000080">: </font>Boolean<font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>ChangeDrive<font color="#000080">( </font>drv<font color="#000080">: </font>Char <font color="#000080">): </font>Boolean<font color="#000080">;
</font><font color="#008000"><i>(*
Takes drive letter as parameter, returns True if change
succeeded, False if change failed (invalid drive)
*)
</i></font><font color="#FF0000"><b>Var
  </b></font>Regs<font color="#000080">:   </font>Dos<font color="#000080">.</font>Registers<font color="#000080">;
  </font>NewDrv<font color="#000080">: </font>Byte<font color="#000080">;
</font><font color="#FF0000"><b>begin
</b></font><font color="#008000"><i>(* Calculate drive code For desired drive *)
  </i></font>NewDrv <font color="#000080">:= </font>orD<font color="#000080">( </font>UpCase<font color="#000080">( </font>drv <font color="#000080">) ) - </font>orD<font color="#000080">( </font><font color="#800000">'A' </font><font color="#000080">); </font><font color="#008000"><i>(* A: = 0 *)

(* Change drive *)
  </i></font>Regs<font color="#000080">.</font>DL <font color="#000080">:= </font>NewDrv<font color="#000080">;
  </font>Regs<font color="#000080">.</font>AH <font color="#000080">:= </font><font color="#800000">$0E</font><font color="#000080">;            </font><font color="#008000"><i>(* Function 0Eh: Select Disk *)
  </i></font>MSDos<font color="#000080">( </font>Regs <font color="#000080">);

</font><font color="#008000"><i>(* See if the change 'took' *)
  </i></font>Regs<font color="#000080">.</font>AH <font color="#000080">:= </font><font color="#800000">$19</font><font color="#000080">; </font><font color="#008000"><i>(* Function 19h:  Get current drive *)
  </i></font>MSDos<font color="#000080">( </font>Regs <font color="#000080">);
  </font>ChangeDrive <font color="#000080">:= (</font>Regs<font color="#000080">.</font>AL <font color="#000080">= </font>NewDrv<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>(* ChangeDrive *)

</i></font><font color="#FF0000"><b>begin
  </b></font>isthere <font color="#000080">:= </font>ChangeDrive<font color="#000080">(</font><font color="#800000">'a'</font><font color="#000080">);
  </font>Writeln <font color="#000080">(</font><font color="#800000">'a: '</font><font color="#000080">,</font>isthere<font color="#000080">);
  </font>isthere <font color="#000080">:= </font>ChangeDrive<font color="#000080">(</font><font color="#800000">'b'</font><font color="#000080">);
  </font>Writeln <font color="#000080">(</font><font color="#800000">'b: '</font><font color="#000080">,</font>isthere<font color="#000080">);
  </font>isthere <font color="#000080">:= </font>ChangeDrive<font color="#000080">(</font><font color="#800000">'c'</font><font color="#000080">);
  </font>Writeln <font color="#000080">(</font><font color="#800000">'c: '</font><font color="#000080">,</font>isthere<font color="#000080">);
  </font>isthere <font color="#000080">:= </font>ChangeDrive<font color="#000080">(</font><font color="#800000">'d'</font><font color="#000080">);
  </font>Writeln <font color="#000080">(</font><font color="#800000">'d: '</font><font color="#000080">,</font>isthere<font color="#000080">);
  </font>isthere <font color="#000080">:= </font>ChangeDrive<font color="#000080">(</font><font color="#800000">'e'</font><font color="#000080">);
  </font>Writeln <font color="#000080">(</font><font color="#800000">'e: '</font><font color="#000080">,</font>isthere<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to DRIVES SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0008.PAS">Original</a><b>]</b></p></body>
</html>
