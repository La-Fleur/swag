<html>
<head><title> "CD-ROM Routines" by TORSTEN FRANK</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to DRIVES SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0106.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code>
<font color="#FF0000"><b>Unit </b></font>CD_ROM<font color="#000080">;
</font><font color="#FF0000"><b>Interface
Const
  </b></font>RED<font color="#000080">=</font><font color="#800000">1</font><font color="#000080">;
  </font>HSG<font color="#000080">=</font><font color="#800000">0</font><font color="#000080">;
  </font>GlobalError<font color="#000080">:</font>Word    <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">;
  </font>GlobalDriveCount<font color="#000080">:</font>Byte    <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">;
  </font>MSCDEXOk<font color="#000080">:</font>Boolean <font color="#000080">= </font>FALSE<font color="#000080">;
  </font>AudioCD<font color="#000080">:</font>Boolean <font color="#000080">= </font>FALSE<font color="#000080">;
</font><font color="#FF0000"><b>Type
  </b></font>REDUnPack <font color="#000080">= </font><font color="#FF0000"><b>Record
             </b></font>Frame<font color="#000080">:</font>Byte<font color="#000080">;
             </font>Second<font color="#000080">:</font>Byte<font color="#000080">;
             </font>Minute<font color="#000080">:</font>Byte<font color="#000080">;
             </font>Unused<font color="#000080">:</font>Byte<font color="#000080">;
             </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Var
  </b></font>GlobalDriveNo<font color="#000080">:</font>Byte<font color="#000080">;
  </font>GlobalLeadOut<font color="#000080">:</font>LongInt<font color="#000080">;
  </font>GlobalTrackMin<font color="#000080">:</font>Byte<font color="#000080">;
  </font>GlobalTrackMax<font color="#000080">:</font>Byte<font color="#000080">;
  </font>GlobalAktualTrack <font color="#000080">:</font>Byte<font color="#000080">;
  </font>TOC<font color="#000080">:</font><font color="#FF0000"><b>Array </b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">99</font><font color="#000080">] </font><font color="#FF0000"><b>Of </b></font>LongInt<font color="#000080">;
</font><font color="#FF0000"><b>Function  </b></font>RED2HSG<font color="#000080">(</font>Minute<font color="#000080">, </font>Second<font color="#000080">, </font>Frame <font color="#000080">:</font>LongInt<font color="#000080">) :</font>LongInt<font color="#000080">;
</font><font color="#FF0000"><b>Procedure </b></font>HSG2RED<font color="#000080">(</font>HSG <font color="#000080">:</font>LongInt<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>Minute<font color="#000080">, </font>Second<font color="#000080">, </font>Frame <font color="#000080">:</font>LongInt<font color="#000080">);
</font><font color="#FF0000"><b>Procedure </b></font>Audio_Disk_Info<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>TrackMin<font color="#000080">,</font>TrackMax <font color="#000080">:</font>Byte<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>LeadOut <font color="#000080">:</font>LongInt<font color="#000080">);
</font><font color="#FF0000"><b>Procedure </b></font>Audio_Track_Info<font color="#000080">(</font>TrackNr <font color="#000080">:</font>Byte<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>TrackStart <font color="#000080">:</font>LongInt<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>CntlAdr
<font color="#000080">:</font>Byte<font color="#000080">);</font><font color="#FF0000"><b>Function  </b></font>Media_Changed <font color="#000080">:</font>Byte<font color="#000080">;
</font><font color="#FF0000"><b>Procedure </b></font>Audio_Status<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>AudioStatus <font color="#000080">:</font>Word<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>StartResume<font color="#000080">,</font>EndPlay
<font color="#000080">:</font>LongInt<font color="#000080">);</font><font color="#FF0000"><b>Procedure </b></font>Stop_Audio<font color="#000080">;
</font><font color="#FF0000"><b>Procedure </b></font>Pause_Audio<font color="#000080">;
</font><font color="#FF0000"><b>Procedure </b></font>Resume_Audio<font color="#000080">;
</font><font color="#FF0000"><b>Procedure </b></font>Play_Audio<font color="#000080">(</font>StartSector<font color="#000080">,</font>nFrames <font color="#000080">:</font>LongInt<font color="#000080">);
</font><font color="#FF0000"><b>Function  </b></font>Location_of_Head<font color="#000080">(</font>AdressMode <font color="#000080">:</font>Byte<font color="#000080">) :</font>LongInt<font color="#000080">;
</font><font color="#FF0000"><b>Function  </b></font>Device_Status <font color="#000080">:</font>LongInt<font color="#000080">;
</font><font color="#FF0000"><b>Procedure </b></font>Audio_Channel_Info<font color="#000080">(</font><font color="#FF0000"><b>var
</b></font>ChOut0<font color="#000080">,</font>Vol0<font color="#000080">,</font>ChOut1<font color="#000080">,</font>Vol1<font color="#000080">,</font>ChOut2<font color="#000080">,</font>Vol2<font color="#000080">,</font>ChOut3<font color="#000080">,</font>Vol3 <font color="#000080">:</font>Byte<font color="#000080">);</font><font color="#FF0000"><b>Procedure
</b></font>Audio_Q_Channel_Info<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>TrackNo<font color="#000080">,</font>Min<font color="#000080">,</font>Sec<font color="#000080">,</font>Frame<font color="#000080">,</font>Zero<font color="#000080">,</font>AMin<font color="#000080">,</font>ASec<font color="#000080">,</font>AFrame <font color="#000080">:</font>Byte<font color="#000080">);
</font><font color="#FF0000"><b>Function  </b></font>Disk_Remain <font color="#000080">:</font>LongInt<font color="#000080">;
</font><font color="#FF0000"><b>Function  </b></font>Track_Remain <font color="#000080">:</font>LongInt<font color="#000080">;
</font><font color="#FF0000"><b>Function  </b></font>Get_UPC <font color="#000080">:</font><font color="#FF0000"><b>String</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Procedure </b></font>MSCDEX_Version<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>HVersion<font color="#000080">, </font>NVersion <font color="#000080">:</font>Byte<font color="#000080">);
</font><font color="#FF0000"><b>Function  </b></font>CDROM_Number<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>DriveNo <font color="#000080">:</font>Byte<font color="#000080">) :</font>Byte<font color="#000080">;
</font><font color="#FF0000"><b>Procedure </b></font>MSCDEX_Init<font color="#000080">;
</font><font color="#FF0000"><b>Procedure </b></font>ReadTOC<font color="#000080">;
</font><font color="#FF0000"><b>Procedure </b></font>Calculate_Track<font color="#000080">(</font>TrackNo <font color="#000080">:</font>Byte<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>StartSector<font color="#000080">,</font>TrackLength<font color="#000080">,</font>DiskEnd
<font color="#000080">:</font>LongInt<font color="#000080">);</font><font color="#FF0000"><b>Procedure </b></font>Play_Track<font color="#000080">(</font>TrackNo <font color="#000080">:</font>Byte<font color="#000080">);
</font><font color="#FF0000"><b>Procedure </b></font>Play_Track_to_End<font color="#000080">(</font>TrackNo <font color="#000080">:</font>Byte<font color="#000080">);
</font><font color="#FF0000"><b>Procedure </b></font>Show_Track<font color="#000080">(</font>TrackNo<font color="#000080">, </font>Seconds <font color="#000080">:</font>Byte<font color="#000080">);
</font><font color="#FF0000"><b>Procedure </b></font>Next_Track<font color="#000080">;
</font><font color="#FF0000"><b>Procedure </b></font>Last_Track<font color="#000080">;
</font><font color="#FF0000"><b>Procedure </b></font>Next_Track_to_End<font color="#000080">;
</font><font color="#FF0000"><b>Procedure </b></font>Last_Track_to_End<font color="#000080">;
</font><font color="#FF0000"><b>Procedure </b></font>Eject_Disk<font color="#000080">;
</font><font color="#FF0000"><b>Procedure </b></font>Close_Tray<font color="#000080">;
</font><font color="#FF0000"><b>Procedure </b></font>Lock_Door<font color="#000080">;
</font><font color="#FF0000"><b>Procedure </b></font>UnLock_Door<font color="#000080">;
</font><font color="#FF0000"><b>Procedure </b></font>Reset_Drive<font color="#000080">;
</font><font color="#FF0000"><b>Procedure
</b></font>Audio_Channel_Control<font color="#000080">(</font>ChOut0<font color="#000080">,</font>Vol0<font color="#000080">,</font>ChOut1<font color="#000080">,</font>Vol1<font color="#000080">,</font>ChOut2<font color="#000080">,</font>Vol2<font color="#000080">,</font>ChOut3<font color="#000080">,</font>Vol3
<font color="#000080">:</font>Byte<font color="#000080">);</font><font color="#FF0000"><b>Procedure </b></font>Chk_Audio<font color="#000080">;</font><font color="#FF0000"><b>Implementation
Const
  </b></font>TOCreaded <font color="#000080">: </font>Boolean <font color="#000080">= </font>FALSE<font color="#000080">;
</font><font color="#FF0000"><b>Type
  </b></font>Ptr     <font color="#000080">= </font><font color="#FF0000"><b>Record
              </b></font>Ofs <font color="#000080">:</font>Word<font color="#000080">;
              </font>Seg <font color="#000080">:</font>Word<font color="#000080">;
            </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
  </font>TDevName <font color="#000080">= </font><font color="#FF0000"><b>Array </b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">8</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Char<font color="#000080">;
  </font>TRequestHeader <font color="#000080">=
    </font><font color="#FF0000"><b>Record
      </b></font>Len             <font color="#000080">:</font>Byte<font color="#000080">;
      </font>SubUnit         <font color="#000080">:</font>Byte<font color="#000080">;
      </font>CommandCode     <font color="#000080">:</font>Byte<font color="#000080">;
      </font>Status          <font color="#000080">:</font>Word<font color="#000080">;
      </font>DevName         <font color="#000080">:</font>TDevName<font color="#000080">;
    </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
  </font>TIOCtlOBufferStruct <font color="#000080">=
    </font><font color="#FF0000"><b>Record
      </b></font>Command<font color="#000080">:</font>Byte<font color="#000080">;
      </font>Data0<font color="#000080">:</font>Byte<font color="#000080">;
      </font>Data1<font color="#000080">:</font>Byte<font color="#000080">;
      </font>Data2<font color="#000080">:</font>Byte<font color="#000080">;
      </font>Data3<font color="#000080">:</font>Byte<font color="#000080">;
      </font>Data4<font color="#000080">:</font>Byte<font color="#000080">;
      </font>Data5<font color="#000080">:</font>Byte<font color="#000080">;
      </font>Data6<font color="#000080">:</font>Byte<font color="#000080">;
      </font>Data7<font color="#000080">:</font>Byte<font color="#000080">;
    </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
  </font>TIOCtlO <font color="#000080">=
    </font><font color="#FF0000"><b>Record
      </b></font>RequestHeader<font color="#000080">:</font>TRequestHeader<font color="#000080">;
      </font>MediaDescriptor<font color="#000080">:</font>Byte<font color="#000080">;
      </font>Buffer<font color="#000080">:</font>Pointer<font color="#000080">;
      </font>BufferSize<font color="#000080">:</font>Word<font color="#000080">;
      </font>StartSector<font color="#000080">:</font>LongInt<font color="#000080">;
      </font>VolumePtr<font color="#000080">:</font>LongInt<font color="#000080">;
    </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
  </font>TIOCtlI <font color="#000080">=
    </font><font color="#FF0000"><b>Record
      </b></font>RequestHeader<font color="#000080">:</font>TRequestHeader<font color="#000080">;
      </font>MediaDescriptor<font color="#000080">:</font>Byte<font color="#000080">;
      </font>Buffer<font color="#000080">:</font>Pointer<font color="#000080">;
      </font>BufferSize<font color="#000080">:</font>Word<font color="#000080">;
      </font>StartSector<font color="#000080">:</font>Word<font color="#000080">;
      </font>VolumePtr<font color="#000080">:</font>LongInt<font color="#000080">;
    </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Var
  </b></font>IO<font color="#000080">:</font>TIOCtlO<font color="#000080">;
  </font>II<font color="#000080">:</font>TIOCtlI<font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>RED2HSG<font color="#000080">(</font>Minute<font color="#000080">, </font>Second<font color="#000080">, </font>Frame <font color="#000080">:</font>LongInt<font color="#000080">) :</font>LongInt<font color="#000080">;
  </font><font color="#FF0000"><b>Begin
    </b></font>RED2HSG<font color="#000080">:=</font>Minute<font color="#000080">*</font><font color="#800000">4500</font><font color="#000080">+</font>Second<font color="#000080">*</font><font color="#800000">75</font><font color="#000080">+</font>Frame<font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>HSG2RED<font color="#000080">(</font>HSG <font color="#000080">:</font>LongInt<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>Minute<font color="#000080">, </font>Second<font color="#000080">, </font>Frame <font color="#000080">:</font>LongInt<font color="#000080">);
  </font><font color="#FF0000"><b>Begin
    </b></font>Frame<font color="#000080">:=</font>HSG <font color="#FF0000"><b>Mod </b></font><font color="#800000">75</font><font color="#000080">;
    </font>HSG<font color="#000080">:=</font>HSG <font color="#FF0000"><b>Div </b></font><font color="#800000">75</font><font color="#000080">;
    </font>Second<font color="#000080">:=</font>HSG <font color="#FF0000"><b>Mod </b></font><font color="#800000">60</font><font color="#000080">;
    </font>Minute<font color="#000080">:=</font>HSG <font color="#FF0000"><b>Div </b></font><font color="#800000">60</font><font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>IOCTLin<font color="#000080">(</font>IOCTL <font color="#000080">:</font>Pointer<font color="#000080">; </font>IOCTLLength <font color="#000080">:</font>Word<font color="#000080">);
  </font><font color="#FF0000"><b>Var </b></font>S<font color="#000080">,</font>O <font color="#000080">:</font>Word<font color="#000080">;
  </font><font color="#FF0000"><b>Begin
    </b></font>FillChar<font color="#000080">(</font>II<font color="#000080">, </font>SizeOf<font color="#000080">(</font>II<font color="#000080">), </font><font color="#800000">0</font><font color="#000080">);
    </font><font color="#FF0000"><b>With </b></font>II <font color="#FF0000"><b>do
      Begin
        </b></font>RequestHeader<font color="#000080">.</font>Len<font color="#000080">:=</font>SizeOf<font color="#000080">(</font>TIOCtlI<font color="#000080">);
        </font>RequestHeader<font color="#000080">.</font>CommandCode<font color="#000080">:=</font><font color="#800000">3</font><font color="#000080">;
        </font>Buffer<font color="#000080">:=</font>IOCTL<font color="#000080">;
        </font>BufferSize<font color="#000080">:=</font>IOCTLLength<font color="#000080">;
        </font>StartSector<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
        </font>VolumePtr<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
      </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
    </font>O<font color="#000080">:=</font>Ofs<font color="#000080">(</font>II<font color="#000080">);</font>S<font color="#000080">:=</font>Seg<font color="#000080">(</font>II<font color="#000080">);
    </font><font color="#FF0000"><b>Asm
      </b></font><font color="#FF00FF">xor ch,ch;
      mov cl,GlobalDriveNo;
      mov ax,S;
      mov es,ax;
      mov bx,O;
      mov ax,$1510;
      int $2f;
    </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
    </font>GlobalError<font color="#000080">:=</font>II<font color="#000080">.</font>RequestHeader<font color="#000080">.</font>Status<font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>IOCTLout<font color="#000080">(</font>IOCTL <font color="#000080">:</font>Pointer<font color="#000080">; </font>IOCTLLength <font color="#000080">:</font>Word<font color="#000080">);
  </font><font color="#FF0000"><b>Var </b></font>S<font color="#000080">,</font>O <font color="#000080">:</font>Word<font color="#000080">;
  </font><font color="#FF0000"><b>Begin
    </b></font>FillChar<font color="#000080">(</font>IO<font color="#000080">, </font>SizeOf<font color="#000080">(</font>IO<font color="#000080">), </font><font color="#800000">0</font><font color="#000080">);
    </font><font color="#FF0000"><b>With </b></font>IO <font color="#FF0000"><b>do
      Begin
        </b></font>RequestHeader<font color="#000080">.</font>Len<font color="#000080">:=</font>SizeOf<font color="#000080">(</font>TIOCtlI<font color="#000080">);
        </font>RequestHeader<font color="#000080">.</font>CommandCode<font color="#000080">:=</font><font color="#800000">12</font><font color="#000080">;
        </font>Buffer<font color="#000080">:=</font>IOCTL<font color="#000080">;
        </font>BufferSize<font color="#000080">:=</font>IOCTLLength<font color="#000080">;
        </font>StartSector<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
        </font>VolumePtr<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
      </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
    </font>O<font color="#000080">:=</font>Ofs<font color="#000080">(</font>IO<font color="#000080">);
    </font>S<font color="#000080">:=</font>Seg<font color="#000080">(</font>IO<font color="#000080">);
    </font><font color="#FF0000"><b>Asm
      </b></font><font color="#FF00FF">xor ch,ch;
      mov cl,GlobalDriveNo;
      mov ax,S;
      mov es,ax;
      mov bx,O;
      mov ax,$1510;
      int $2f;
    </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
    </font>GlobalError<font color="#000080">:=</font>IO<font color="#000080">.</font>RequestHeader<font color="#000080">.</font>Status<font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Procedure </b></font>Audio_Disk_Info<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>TrackMin<font color="#000080">,</font>TrackMax <font color="#000080">:</font>Byte<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>LeadOut <font color="#000080">:</font>LongInt<font color="#000080">);
</font><font color="#FF0000"><b>Type
  </b></font>TAudioDiskInfo <font color="#000080">=
    </font><font color="#FF0000"><b>Record
    </b></font>Command<font color="#000080">:</font>Byte<font color="#000080">;
    </font>Min<font color="#000080">:</font>Byte<font color="#000080">;
    </font>Max<font color="#000080">:</font>Byte<font color="#000080">;
    </font>LeadOut<font color="#000080">:</font>LongInt<font color="#000080">;
    </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>Var
    </b></font>IOCTL<font color="#000080">:</font>TAudioDiskInfo<font color="#000080">;
  </font><font color="#FF0000"><b>Begin
    </b></font>IOCTL<font color="#000080">.</font>Command<font color="#000080">:=</font><font color="#800000">10</font><font color="#000080">;
    </font>IOCTLin<font color="#000080">(@</font>IOCTL<font color="#000080">,</font>SizeOf<font color="#000080">(</font>IOCTL<font color="#000080">));
    </font>TrackMin<font color="#000080">:=</font>IOCTL<font color="#000080">.</font>Min<font color="#000080">;
    </font>TrackMax<font color="#000080">:=</font>IOCTL<font color="#000080">.</font>Max<font color="#000080">;
    </font>LeadOut<font color="#000080">:=</font>IOCTL<font color="#000080">.</font>LeadOut<font color="#000080">; </font><font color="#008000"><i>(* RED *)
  </i></font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>Audio_Track_Info<font color="#000080">(</font>TrackNr <font color="#000080">:</font>Byte<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>TrackStart <font color="#000080">:</font>LongInt<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>CntlAdr
<font color="#000080">:</font>Byte<font color="#000080">);</font><font color="#FF0000"><b>Type
 </b></font>TAudioTrackInfo <font color="#000080">= </font><font color="#FF0000"><b>Record
                     </b></font>Command<font color="#000080">:</font>Byte<font color="#000080">;
        </font>TrackNr<font color="#000080">:</font>Byte<font color="#000080">;
        </font>TrackStart <font color="#000080">:</font>LongInt<font color="#000080">;
        </font>TrackCntl<font color="#000080">:</font>Byte<font color="#000080">;
      </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>Var
    </b></font>IOCTL <font color="#000080">:</font>TAudioTrackInfo<font color="#000080">;
  </font><font color="#FF0000"><b>Begin
    </b></font>IOCTL<font color="#000080">.</font>Command<font color="#000080">:=</font><font color="#800000">11</font><font color="#000080">;
    </font>IOCTL<font color="#000080">.</font>TrackNr<font color="#000080">:=</font>TrackNr<font color="#000080">;
    </font>IOCTLin<font color="#000080">(@</font>IOCTL<font color="#000080">,</font>SizeOf<font color="#000080">(</font>IOCTL<font color="#000080">));
    </font>TrackStart<font color="#000080">:=</font>IOCTL<font color="#000080">.</font>TrackStart<font color="#000080">; </font><font color="#008000"><i>(* RED *)
    </i></font>CntlAdr<font color="#000080">:=</font>IOCTL<font color="#000080">.</font>TrackCntl<font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>Media_Changed <font color="#000080">:</font>Byte<font color="#000080">;
  </font><font color="#FF0000"><b>Type
    </b></font>TMediaChanged <font color="#000080">=
      </font><font color="#FF0000"><b>Record
        </b></font>Command<font color="#000080">:</font>Byte<font color="#000080">;
        </font>MediaChanged<font color="#000080">:</font>Byte<font color="#000080">;
      </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>Var </b></font>IOCTL <font color="#000080">:</font>TMediaChanged<font color="#000080">;
  </font><font color="#FF0000"><b>Begin
    </b></font>IOCTL<font color="#000080">.</font>Command<font color="#000080">:=</font><font color="#800000">9</font><font color="#000080">;
    </font>IOCTLin<font color="#000080">(@</font>IOCTL<font color="#000080">,</font>SizeOf<font color="#000080">(</font>IOCTL<font color="#000080">));
    </font>Media_Changed<font color="#000080">:=</font>IOCTL<font color="#000080">.</font>MediaChanged<font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>Audio_Status<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>AudioStatus <font color="#000080">:</font>Word<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>StartResume<font color="#000080">,</font>EndPlay
<font color="#000080">:</font>LongInt<font color="#000080">);  </font><font color="#FF0000"><b>Type
    </b></font>TAudioStatus <font color="#000080">=
      </font><font color="#FF0000"><b>Record
        </b></font>Command<font color="#000080">:</font>Byte<font color="#000080">;
        </font>AudioStatus<font color="#000080">:</font>Word<font color="#000080">;
        </font>StartResume<font color="#000080">:</font>LongInt<font color="#000080">;
        </font>EndPlay<font color="#000080">:</font>LongInt<font color="#000080">;
      </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>Var
    </b></font>IOCTL <font color="#000080">:</font>TAudioStatus<font color="#000080">;
  </font><font color="#FF0000"><b>Begin
    If </b></font>AudioCD <font color="#FF0000"><b>Then
      Begin
        </b></font>IOCTL<font color="#000080">.</font>Command<font color="#000080">:=</font><font color="#800000">15</font><font color="#000080">;
        </font>IOCTLin<font color="#000080">(@</font>IOCTL<font color="#000080">,</font>SizeOf<font color="#000080">(</font>IOCTL<font color="#000080">));
        </font>AudioStatus<font color="#000080">:=</font>IOCTL<font color="#000080">.</font>AudioStatus<font color="#000080">;
        </font>StartResume<font color="#000080">:=</font>IOCTL<font color="#000080">.</font>StartResume<font color="#000080">;
        </font>EndPlay<font color="#000080">:=</font>IOCTL<font color="#000080">.</font>EndPlay<font color="#000080">;
      </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>Halt_Audio<font color="#000080">;
  </font><font color="#FF0000"><b>Var </b></font>RequestHeader <font color="#000080">:</font>TRequestHeader<font color="#000080">; </font>S<font color="#000080">,</font>O <font color="#000080">:</font>Word<font color="#000080">;
  </font><font color="#FF0000"><b>Begin
    If </b></font>AudioCD <font color="#FF0000"><b>Then
      Begin
        </b></font>RequestHeader<font color="#000080">.</font>Len<font color="#000080">:=</font>SizeOf<font color="#000080">(</font>TRequestHeader<font color="#000080">);
        </font>RequestHeader<font color="#000080">.</font>CommandCode<font color="#000080">:=</font><font color="#800000">133</font><font color="#000080">;
        </font>O<font color="#000080">:=</font>Ofs<font color="#000080">(</font>RequestHeader<font color="#000080">);
        </font>S<font color="#000080">:=</font>Seg<font color="#000080">(</font>RequestHeader<font color="#000080">);
        </font><font color="#FF0000"><b>Asm
          </b></font><font color="#FF00FF">xor ch,ch;
          mov cl,GlobalDriveNo;
          mov ax,S;
          mov es,ax;
          mov bx,O;
          mov ax,$1510;
          int $2f;
        </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
        </font>GlobalError<font color="#000080">:=</font>RequestHeader<font color="#000080">.</font>Status<font color="#000080">;
      </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>Stop_Audio<font color="#000080">;
  </font><font color="#FF0000"><b>Var </b></font>AudioStatus <font color="#000080">:</font>Word<font color="#000080">; </font>StartResume<font color="#000080">,</font>EndPlay <font color="#000080">:</font>LongInt<font color="#000080">;
  </font><font color="#FF0000"><b>Begin
    If </b></font>AudioCD <font color="#FF0000"><b>Then
      Begin
        </b></font>Halt_Audio<font color="#000080">;
        </font>Audio_Status<font color="#000080">(</font>AudioStatus<font color="#000080">,</font>StartResume<font color="#000080">,</font>EndPlay<font color="#000080">);
        </font><font color="#FF0000"><b>If </b></font><font color="#000080">(</font>AudioStatus <font color="#FF0000"><b>AND </b></font><font color="#800000">1</font><font color="#000080">)=</font><font color="#800000">1 </font><font color="#FF0000"><b>Then
          </b></font>Halt_Audio<font color="#000080">;
      </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>Pause_Audio<font color="#000080">;
  </font><font color="#FF0000"><b>Var </b></font>AudioStatus <font color="#000080">:</font>Word<font color="#000080">; </font>StartResume<font color="#000080">,</font>EndPlay <font color="#000080">:</font>LongInt<font color="#000080">;
  </font><font color="#FF0000"><b>Begin
    If </b></font>AudioCD <font color="#FF0000"><b>Then
      Begin
        </b></font>Audio_Status<font color="#000080">(</font>AudioStatus<font color="#000080">,</font>StartResume<font color="#000080">,</font>EndPlay<font color="#000080">);
        </font><font color="#FF0000"><b>If </b></font><font color="#000080">(</font>AudioStatus <font color="#FF0000"><b>AND </b></font><font color="#800000">1</font><font color="#000080">)=</font><font color="#800000">0 </font><font color="#FF0000"><b>Then
          </b></font>Halt_Audio<font color="#000080">;
      </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>Resume_Audio<font color="#000080">;
  </font><font color="#FF0000"><b>Var </b></font>RequestHeader <font color="#000080">:</font>TRequestHeader<font color="#000080">; </font>AudioStatus<font color="#000080">,</font>S<font color="#000080">,</font>O <font color="#000080">:</font>Word<font color="#000080">;
</font>StartResume<font color="#000080">,</font>EndPlay <font color="#000080">:</font>LongInt<font color="#000080">;  </font><font color="#FF0000"><b>Begin
    If </b></font>AudioCD <font color="#FF0000"><b>Then
      Begin
        </b></font>Audio_Status<font color="#000080">(</font>AudioStatus<font color="#000080">,</font>StartResume<font color="#000080">,</font>EndPlay<font color="#000080">);
        </font><font color="#FF0000"><b>If </b></font><font color="#000080">(</font>AudioStatus <font color="#FF0000"><b>AND </b></font><font color="#800000">1</font><font color="#000080">)=</font><font color="#800000">1 </font><font color="#FF0000"><b>Then
          Begin
            </b></font>RequestHeader<font color="#000080">.</font>Len<font color="#000080">:=</font>SizeOf<font color="#000080">(</font>TRequestHeader<font color="#000080">);
            </font>RequestHeader<font color="#000080">.</font>CommandCode<font color="#000080">:=</font><font color="#800000">136</font><font color="#000080">;
            </font>O<font color="#000080">:=</font>Ofs<font color="#000080">(</font>RequestHeader<font color="#000080">);
            </font>S<font color="#000080">:=</font>Seg<font color="#000080">(</font>RequestHeader<font color="#000080">);
            </font><font color="#FF0000"><b>Asm
              </b></font><font color="#FF00FF">xor ch,ch;
              mov cl,GlobalDriveNo;
              mov ax,S;
              mov es,ax;
              mov bx,O;
              mov ax,$1510;
              int $2f;
            </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
          </font>GlobalError<font color="#000080">:=</font>RequestHeader<font color="#000080">.</font>Status<font color="#000080">;
        </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>Play_Audio<font color="#000080">(</font>StartSector<font color="#000080">,</font>nFrames <font color="#000080">:</font>LongInt<font color="#000080">);
  </font><font color="#FF0000"><b>Type
    </b></font>TPlayAudio <font color="#000080">=
      </font><font color="#FF0000"><b>Record
        </b></font>RequestHeader   <font color="#000080">:</font>TRequestHeader<font color="#000080">;
        </font>AdressMode      <font color="#000080">:</font>Byte<font color="#000080">;
        </font>StartSector     <font color="#000080">:</font>LongInt<font color="#000080">;
        </font>nFrames         <font color="#000080">:</font>LongInt<font color="#000080">;
      </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>Var
    </b></font>PA <font color="#000080">:</font>TPlayAudio<font color="#000080">; </font>S<font color="#000080">,</font>O <font color="#000080">:</font>Word<font color="#000080">;
  </font><font color="#FF0000"><b>Begin
    </b></font>FillChar<font color="#000080">(</font>PA<font color="#000080">, </font>SizeOf<font color="#000080">(</font>PA<font color="#000080">), </font><font color="#800000">0</font><font color="#000080">);
    </font>PA<font color="#000080">.</font>RequestHeader<font color="#000080">.</font>Len<font color="#000080">:=</font>SizeOf<font color="#000080">(</font>TPlayAudio<font color="#000080">);
    </font>PA<font color="#000080">.</font>RequestHeader<font color="#000080">.</font>CommandCode<font color="#000080">:=</font><font color="#800000">132</font><font color="#000080">;
    </font>PA<font color="#000080">.</font>AdressMode<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">; </font><font color="#008000"><i>(* HSG *)
    </i></font>PA<font color="#000080">.</font>StartSector<font color="#000080">:=</font>StartSector<font color="#000080">;
    </font>PA<font color="#000080">.</font>nFrames<font color="#000080">:=</font>nFrames<font color="#000080">;
    </font>O<font color="#000080">:=</font>Ofs<font color="#000080">(</font>PA<font color="#000080">);
    </font>S<font color="#000080">:=</font>Seg<font color="#000080">(</font>PA<font color="#000080">);
    </font><font color="#FF0000"><b>Asm
      </b></font><font color="#FF00FF">xor ch,ch;
      mov cl,GlobalDriveNo;
      mov ax,S;
      mov es,ax;
      mov bx,O;
      mov ax,$1510;
      int $2f;
    </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
    </font>GlobalError<font color="#000080">:=</font>PA<font color="#000080">.</font>RequestHeader<font color="#000080">.</font>Status<font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>Location_of_Head<font color="#000080">(</font>AdressMode <font color="#000080">:</font>Byte<font color="#000080">) :</font>LongInt<font color="#000080">;
  </font><font color="#FF0000"><b>Type
    </b></font>TLocHead <font color="#000080">=
      </font><font color="#FF0000"><b>Record
        </b></font>Command         <font color="#000080">:</font>Byte<font color="#000080">;
        </font>AdressMode      <font color="#000080">:</font>Byte<font color="#000080">;
        </font>HeadPosition    <font color="#000080">:</font>LongInt<font color="#000080">;
      </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>Var
    </b></font>IOCTL <font color="#000080">:</font>TLocHead<font color="#000080">;
  </font><font color="#FF0000"><b>Begin
    </b></font>IOCTL<font color="#000080">.</font>Command<font color="#000080">:=</font><font color="#800000">1</font><font color="#000080">;
    </font>IOCTL<font color="#000080">.</font>AdressMode<font color="#000080">:=</font>AdressMode<font color="#000080">; </font><font color="#008000"><i>(* 0=HSG 1=RED *)

    </i></font>IOCTLin<font color="#000080">(@</font>IOCTL<font color="#000080">,</font>SizeOf<font color="#000080">(</font>IOCTL<font color="#000080">));

    </font>Location_of_Head<font color="#000080">:=</font>IOCTL<font color="#000080">.</font>HeadPosition<font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>Device_Status <font color="#000080">:</font>LongInt<font color="#000080">;
  </font><font color="#FF0000"><b>Type
    </b></font>TDeviceStatus <font color="#000080">=
      </font><font color="#FF0000"><b>Record
        </b></font>Command         <font color="#000080">:</font>Byte<font color="#000080">;
        </font>Status          <font color="#000080">:</font>LongInt<font color="#000080">;
      </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>Var </b></font>IOCTL <font color="#000080">:</font>TDeviceStatus<font color="#000080">;
  </font><font color="#FF0000"><b>Begin
    </b></font>IOCTL<font color="#000080">.</font>Command<font color="#000080">:=</font><font color="#800000">6</font><font color="#000080">;

    </font>IOCTLin<font color="#000080">(@</font>IOCTL<font color="#000080">,</font>SizeOf<font color="#000080">(</font>IOCTL<font color="#000080">));

    </font>Device_Status<font color="#000080">:=</font>IOCTL<font color="#000080">.</font>Status<font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>Audio_Channel_Info<font color="#000080">(</font><font color="#FF0000"><b>var
</b></font>ChOut0<font color="#000080">,</font>Vol0<font color="#000080">,</font>ChOut1<font color="#000080">,</font>Vol1<font color="#000080">,</font>ChOut2<font color="#000080">,</font>Vol2<font color="#000080">,</font>ChOut3<font color="#000080">,</font>Vol3 <font color="#000080">:</font>Byte<font color="#000080">);  </font><font color="#FF0000"><b>Type
    </b></font>TAudioChannelInfo <font color="#000080">=
      </font><font color="#FF0000"><b>Record
        </b></font>Command <font color="#000080">:</font>Byte<font color="#000080">;
        </font>ChOut0  <font color="#000080">:</font>Byte<font color="#000080">;
        </font>Vol0    <font color="#000080">:</font>Byte<font color="#000080">;
        </font>ChOut1  <font color="#000080">:</font>Byte<font color="#000080">;
        </font>Vol1    <font color="#000080">:</font>Byte<font color="#000080">;
        </font>ChOut2  <font color="#000080">:</font>Byte<font color="#000080">;
        </font>Vol2    <font color="#000080">:</font>Byte<font color="#000080">;
        </font>ChOut3  <font color="#000080">:</font>Byte<font color="#000080">;
        </font>Vol3    <font color="#000080">:</font>Byte<font color="#000080">;
      </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>Var </b></font>IOCTL <font color="#000080">:</font>TAudioChannelInfo<font color="#000080">;
  </font><font color="#FF0000"><b>Begin
    </b></font>IOCTL<font color="#000080">.</font>Command<font color="#000080">:=</font><font color="#800000">4</font><font color="#000080">;
    </font>IOCTLin<font color="#000080">(@</font>IOCTL<font color="#000080">,</font>SizeOf<font color="#000080">(</font>IOCTL<font color="#000080">));
    </font>ChOut0<font color="#000080">:=</font>IOCTL<font color="#000080">.</font>ChOut0<font color="#000080">;
    </font>ChOut1<font color="#000080">:=</font>IOCTL<font color="#000080">.</font>ChOut1<font color="#000080">;
    </font>ChOut2<font color="#000080">:=</font>IOCTL<font color="#000080">.</font>ChOut2<font color="#000080">;
    </font>ChOut3<font color="#000080">:=</font>IOCTL<font color="#000080">.</font>ChOut3<font color="#000080">;
    </font>Vol0<font color="#000080">:=</font>IOCTL<font color="#000080">.</font>Vol0<font color="#000080">;
    </font>Vol1<font color="#000080">:=</font>IOCTL<font color="#000080">.</font>Vol1<font color="#000080">;
    </font>Vol2<font color="#000080">:=</font>IOCTL<font color="#000080">.</font>Vol2<font color="#000080">;
    </font>Vol3<font color="#000080">:=</font>IOCTL<font color="#000080">.</font>Vol3<font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>Audio_Q_Channel_Info<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>TrackNo<font color="#000080">,</font>Min<font color="#000080">,</font>Sec<font color="#000080">,</font>Frame<font color="#000080">,</font>Zero<font color="#000080">,</font>AMin<font color="#000080">,</font>ASec<font color="#000080">,</font>AFrame
<font color="#000080">:</font>Byte<font color="#000080">);  </font><font color="#FF0000"><b>Type
    </b></font>TAudioQChannelInfo <font color="#000080">=
      </font><font color="#FF0000"><b>Record
        </b></font>Command <font color="#000080">:</font>Byte<font color="#000080">;
        </font>ADR     <font color="#000080">:</font>Byte<font color="#000080">;
        </font>TrackNo <font color="#000080">:</font>Byte<font color="#000080">;
        </font>Point   <font color="#000080">:</font>Byte<font color="#000080">;
        </font>Min     <font color="#000080">:</font>Byte<font color="#000080">;
        </font>Sec     <font color="#000080">:</font>Byte<font color="#000080">;
        </font>Frame   <font color="#000080">:</font>Byte<font color="#000080">;
        </font>Zero    <font color="#000080">:</font>Byte<font color="#000080">;
        </font>AMin    <font color="#000080">:</font>Byte<font color="#000080">;
        </font>ASec    <font color="#000080">:</font>Byte<font color="#000080">;
        </font>AFrame  <font color="#000080">:</font>Byte<font color="#000080">;
      </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>Var </b></font>IOCTL <font color="#000080">:</font>TAudioQChannelInfo<font color="#000080">; </font>HTrack <font color="#000080">:</font>Byte<font color="#000080">;
  </font><font color="#FF0000"><b>Begin
    </b></font>IOCTL<font color="#000080">.</font>Command<font color="#000080">:=</font><font color="#800000">12</font><font color="#000080">;
    </font>IOCTL<font color="#000080">.</font>ADR<font color="#000080">:=</font><font color="#800000">1</font><font color="#000080">;
    </font>IOCTL<font color="#000080">.</font>Point<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
    </font>IOCTLin<font color="#000080">(@</font>IOCTL<font color="#000080">,</font>SizeOf<font color="#000080">(</font>IOCTL<font color="#000080">));
    </font>HTrack<font color="#000080">:=(</font>IOCTL<font color="#000080">.</font>TrackNo <font color="#FF0000"><b>AND </b></font><font color="#800000">$0F</font><font color="#000080">)+((</font>IOCTL<font color="#000080">.</font>TrackNo <font color="#FF0000"><b>AND </b></font><font color="#800000">$F0</font><font color="#000080">) </font><font color="#FF0000"><b>shr </b></font><font color="#800000">4</font><font color="#000080">)*</font><font color="#800000">10</font><font color="#000080">;
    </font>TrackNo<font color="#000080">:=</font>HTrack<font color="#000080">;
    </font>Min<font color="#000080">:=</font>IOCTL<font color="#000080">.</font>Min<font color="#000080">;
    </font>Sec<font color="#000080">:=</font>IOCTL<font color="#000080">.</font>Sec<font color="#000080">;
    </font>Frame<font color="#000080">:=</font>IOCTL<font color="#000080">.</font>Frame<font color="#000080">;
    </font>Zero<font color="#000080">:=</font>IOCTL<font color="#000080">.</font>Zero<font color="#000080">;
    </font>AMin<font color="#000080">:=</font>IOCTL<font color="#000080">.</font>AMin<font color="#000080">;
    </font>ASec<font color="#000080">:=</font>IOCTL<font color="#000080">.</font>ASec<font color="#000080">;
    </font>AFrame<font color="#000080">:=</font>IOCTL<font color="#000080">.</font>AFrame<font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>Disk_Remain <font color="#000080">:</font>LongInt<font color="#000080">;
  </font><font color="#FF0000"><b>Var </b></font>StartSector<font color="#000080">,</font>TrackLength<font color="#000080">,</font>DiskEnd <font color="#000080">:</font>LongInt<font color="#000080">;
      </font>TrackNo<font color="#000080">,</font>Min<font color="#000080">,</font>Sec<font color="#000080">,</font>Frame<font color="#000080">,</font>Zero<font color="#000080">,</font>AMin<font color="#000080">,</font>ASec<font color="#000080">,</font>AFrame <font color="#000080">:</font>Byte<font color="#000080">;
  </font><font color="#FF0000"><b>Begin
    If NOT </b></font>TOCreaded <font color="#FF0000"><b>Then
      </b></font>ReadTOC<font color="#000080">;
    </font><font color="#FF0000"><b>If </b></font>TOCreaded <font color="#FF0000"><b>AND </b></font><font color="#000080">(</font>Media_Changed<font color="#000080">=</font><font color="#800000">1</font><font color="#000080">) </font><font color="#FF0000"><b>AND </b></font>AudioCD <font color="#FF0000"><b>Then
      Begin
        </b></font>Audio_Q_Channel_Info<font color="#000080">(</font>TrackNo<font color="#000080">,</font>Min<font color="#000080">,</font>Sec<font color="#000080">,</font>Frame<font color="#000080">,</font>Zero<font color="#000080">,</font>AMin<font color="#000080">,</font>ASec<font color="#000080">,</font>AFrame<font color="#000080">);
        </font>Disk_Remain<font color="#000080">:=</font>GlobalLeadOut<font color="#000080">-</font>RED2HSG<font color="#000080">(</font>AMin<font color="#000080">,</font>ASec<font color="#000080">,</font>AFrame<font color="#000080">);
        </font>GlobalAktualTrack<font color="#000080">:=</font>TrackNo<font color="#000080">;
      </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>Track_Remain <font color="#000080">:</font>LongInt<font color="#000080">;
  </font><font color="#FF0000"><b>Var </b></font>StartSector<font color="#000080">,</font>TrackLength<font color="#000080">,</font>DiskEnd <font color="#000080">:</font>LongInt<font color="#000080">;
      </font>TrackNo<font color="#000080">,</font>Min<font color="#000080">,</font>Sec<font color="#000080">,</font>Frame<font color="#000080">,</font>Zero<font color="#000080">,</font>AMin<font color="#000080">,</font>ASec<font color="#000080">,</font>AFrame <font color="#000080">:</font>Byte<font color="#000080">;
  </font><font color="#FF0000"><b>Begin
    If NOT </b></font>TOCreaded <font color="#FF0000"><b>Then
      </b></font>ReadTOC<font color="#000080">;
    </font><font color="#FF0000"><b>If </b></font>TOCreaded <font color="#FF0000"><b>AND </b></font><font color="#000080">(</font>Media_Changed<font color="#000080">=</font><font color="#800000">1</font><font color="#000080">) </font><font color="#FF0000"><b>AND </b></font>AudioCD <font color="#FF0000"><b>Then
      Begin
        </b></font>Audio_Q_Channel_Info<font color="#000080">(</font>TrackNo<font color="#000080">,</font>Min<font color="#000080">,</font>Sec<font color="#000080">,</font>Frame<font color="#000080">,</font>Zero<font color="#000080">,</font>AMin<font color="#000080">,</font>ASec<font color="#000080">,</font>AFrame<font color="#000080">);
        </font>Calculate_Track<font color="#000080">(</font>TrackNo<font color="#000080">,</font>StartSector<font color="#000080">,</font>TrackLength<font color="#000080">,</font>DiskEnd<font color="#000080">);
        </font>Track_Remain<font color="#000080">:=</font>TrackLength<font color="#000080">-</font>RED2HSG<font color="#000080">(</font>Min<font color="#000080">,</font>Sec<font color="#000080">,</font>Frame<font color="#000080">);
        </font>GlobalAktualTrack<font color="#000080">:=</font>TrackNo<font color="#000080">;
      </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>Get_UPC <font color="#000080">:</font><font color="#FF0000"><b>String</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>Type
    </b></font>TGetUPCAEN <font color="#000080">=
      </font><font color="#FF0000"><b>Record
        </b></font>Command<font color="#000080">:</font>Byte<font color="#000080">;
        </font>ADR<font color="#000080">:</font>Byte<font color="#000080">;
        </font>UPC<font color="#000080">:</font><font color="#FF0000"><b>Array </b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">6</font><font color="#000080">] </font><font color="#FF0000"><b>Of </b></font>Char<font color="#000080">;
        </font>Zero<font color="#000080">:</font>Byte<font color="#000080">;
        </font>AFrame<font color="#000080">:</font>Byte<font color="#000080">;
      </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>Var </b></font>IOCTL <font color="#000080">:</font>TGetUPCAEN<font color="#000080">; </font>HStr <font color="#000080">:</font><font color="#FF0000"><b>String</b></font><font color="#000080">[</font><font color="#800000">7</font><font color="#000080">]; </font>T <font color="#000080">:</font>Byte<font color="#000080">;
  </font><font color="#FF0000"><b>Begin
    </b></font>IOCTL<font color="#000080">.</font>Command<font color="#000080">:=</font><font color="#800000">14</font><font color="#000080">;
    </font>IOCTL<font color="#000080">.</font>ADR<font color="#000080">:=</font><font color="#800000">1</font><font color="#000080">;
    </font>IOCTLin<font color="#000080">(@</font>IOCTL<font color="#000080">,</font>SizeOf<font color="#000080">(</font>IOCTL<font color="#000080">));
    </font>HStr<font color="#000080">:=</font><font color="#800000">''</font><font color="#000080">;
    </font><font color="#FF0000"><b>For </b></font>T<font color="#000080">:=</font><font color="#800000">0 </font><font color="#FF0000"><b>To </b></font><font color="#800000">6 </font><font color="#FF0000"><b>Do
      </b></font>HStr<font color="#000080">:=</font>HStr<font color="#000080">+</font>IOCTL<font color="#000080">.</font>UPC<font color="#000080">[</font>T<font color="#000080">];
    </font>Get_UPC<font color="#000080">:=</font>HStr<font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>MSCDEX_Version<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>HVersion<font color="#000080">, </font>NVersion <font color="#000080">:</font>Byte<font color="#000080">);
  </font><font color="#FF0000"><b>Var </b></font>HV<font color="#000080">,</font>NV <font color="#000080">:</font>Byte<font color="#000080">;
  </font><font color="#FF0000"><b>Begin
    Asm
      </b></font><font color="#FF00FF">mov ax,$150C;
      int $2F;
      mov HV,bh;
      mov NV,bh;
    </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
    </font>HVersion<font color="#000080">:=</font>HV<font color="#000080">;
    </font>NVersion<font color="#000080">:=</font>NV<font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>CDROM_Number<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>DriveNo <font color="#000080">:</font>Byte<font color="#000080">) :</font>Byte<font color="#000080">;
  </font><font color="#FF0000"><b>Var </b></font>Ha<font color="#000080">,</font>Hb<font color="#000080">:</font>Byte<font color="#000080">;
  </font><font color="#FF0000"><b>Begin
    Asm
      </b></font><font color="#FF00FF">mov ax,$1500;
      xor bx,bx;
      xor cx,cx;
      int $2F;
      mov Ha,bl;
      mov Hb,cl;
    </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
    </font>CDROM_Number<font color="#000080">:=</font>Ha<font color="#000080">;
    </font>DriveNo<font color="#000080">:=</font>Hb<font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>MSCDEX_Init<font color="#000080">;
  </font><font color="#FF0000"><b>Type
    </b></font>TInit <font color="#000080">=
      </font><font color="#FF0000"><b>Record
        </b></font>RequestHeader<font color="#000080">:</font>TRequestHeader<font color="#000080">;
        </font>AnzahlDrv<font color="#000080">:</font>Byte<font color="#000080">;
        </font>EndAdress<font color="#000080">:</font>LongInt<font color="#000080">;
        </font>BPB<font color="#000080">:</font>LongInt<font color="#000080">;
        </font>BlockDeviceNo<font color="#000080">:</font>Byte<font color="#000080">;
      </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>Var </b></font>MSCDEXInit <font color="#000080">:</font>TInit<font color="#000080">; </font>S<font color="#000080">,</font>O <font color="#000080">:</font>Word<font color="#000080">;
  </font><font color="#FF0000"><b>Begin
    </b></font>MSCDEXInit<font color="#000080">.</font>RequestHeader<font color="#000080">.</font>Len<font color="#000080">:=</font>SizeOf<font color="#000080">(</font>MSCDEXInit<font color="#000080">);
    </font>MSCDEXInit<font color="#000080">.</font>RequestHeader<font color="#000080">.</font>CommandCode<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
    </font>MSCDEXInit<font color="#000080">.</font>AnzahlDrv<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
    </font>MSCDEXInit<font color="#000080">.</font>BlockDeviceNo<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
    </font>O<font color="#000080">:=</font>Ofs<font color="#000080">(</font>MSCDEXInit<font color="#000080">);
    </font>S<font color="#000080">:=</font>Seg<font color="#000080">(</font>MSCDEXInit<font color="#000080">);
    </font><font color="#FF0000"><b>Asm
      </b></font><font color="#FF00FF">xor ch,ch;
      mov cl,GlobalDriveNo;
      mov ax,S;
      mov es,ax;
      mov bx,O;
      mov ax,$1510;
      int $2f;
    </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
    </font>GlobalError<font color="#000080">:=</font>MSCDEXInit<font color="#000080">.</font>RequestHeader<font color="#000080">.</font>Status<font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>Chk_Audio<font color="#000080">;
  </font><font color="#FF0000"><b>Begin
    </b></font>Play_Audio<font color="#000080">(</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">10</font><font color="#000080">);
    </font><font color="#FF0000"><b>If </b></font><font color="#000080">(</font>GlobalError <font color="#FF0000"><b>AND </b></font><font color="#800000">$8002</font><font color="#000080">)=</font><font color="#800000">$8002 </font><font color="#FF0000"><b>Then
      </b></font>AudioCD<font color="#000080">:=</font>FALSE
    <font color="#FF0000"><b>Else
      </b></font>AudioCD<font color="#000080">:=</font>TRUE<font color="#000080">;
    </font>Stop_Audio<font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>ReadTOC<font color="#000080">;
  </font><font color="#FF0000"><b>Var </b></font>Change<font color="#000080">,</font>TrackMin<font color="#000080">,</font>TrackMax<font color="#000080">,</font>T<font color="#000080">,</font>CntlADR <font color="#000080">:</font>Byte<font color="#000080">; </font>HTOC<font color="#000080">,</font>LeadOut <font color="#000080">:</font>LongInt<font color="#000080">; </font>HErr
<font color="#000080">:</font>Word<font color="#000080">;  </font><font color="#FF0000"><b>Begin
    </b></font>Change<font color="#000080">:=</font>Media_Changed<font color="#000080">;
    </font><font color="#FF0000"><b>While </b></font><font color="#000080">(</font>Change<font color="#000080">&lt;&gt;</font><font color="#800000">1</font><font color="#000080">) </font><font color="#FF0000"><b>AND </b></font><font color="#000080">((</font>GlobalError <font color="#FF0000"><b>AND </b></font><font color="#800000">$8000</font><font color="#000080">)=</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>Do
      </b></font>Change<font color="#000080">:=</font>Media_Changed<font color="#000080">;
    </font>Chk_Audio<font color="#000080">;
    </font><font color="#FF0000"><b>If </b></font><font color="#000080">((</font>GlobalError <font color="#FF0000"><b>AND </b></font><font color="#800000">$8000</font><font color="#000080">)=</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>AND </b></font>AudioCD <font color="#FF0000"><b>Then
      Begin
        </b></font>Audio_Disk_Info<font color="#000080">(</font>TrackMin<font color="#000080">,</font>TrackMax<font color="#000080">,</font>LeadOut<font color="#000080">);
        </font><font color="#FF0000"><b>If </b></font><font color="#000080">(</font>GlobalError <font color="#FF0000"><b>AND </b></font><font color="#800000">$8000</font><font color="#000080">)=</font><font color="#800000">0 </font><font color="#FF0000"><b>Then
          Begin
            </b></font>GlobalLeadOut<font color="#000080">:=</font>RED2HSG<font color="#000080">(</font>REDUnPack<font color="#000080">(</font>LeadOut<font color="#000080">).</font>Minute<font color="#000080">,
                           </font>REDUnPack<font color="#000080">(</font>LeadOut<font color="#000080">).</font>Second<font color="#000080">,
                           </font>REDUnPack<font color="#000080">(</font>LeadOut<font color="#000080">).</font>Frame<font color="#000080">);
            </font>GlobalTrackMin<font color="#000080">:=</font>TrackMin<font color="#000080">;
            </font>GlobalTrackMax<font color="#000080">:=</font>TrackMax<font color="#000080">;
            </font>TOCreaded<font color="#000080">:=</font>TRUE<font color="#000080">;
            </font><font color="#FF0000"><b>For </b></font>T<font color="#000080">:=</font>TrackMin <font color="#FF0000"><b>To </b></font>TrackMax <font color="#FF0000"><b>Do
              Begin
                </b></font>Audio_Track_Info<font color="#000080">(</font>T<font color="#000080">,</font>HTOC<font color="#000080">,</font>CntlADR<font color="#000080">);
                </font>TOC<font color="#000080">[</font>T<font color="#000080">]:=</font>RED2HSG<font color="#000080">(</font>REDUnPack<font color="#000080">(</font>HTOC<font color="#000080">).</font>Minute<font color="#000080">,
                                </font>REDUnPack<font color="#000080">(</font>HTOC<font color="#000080">).</font>Second<font color="#000080">,
                                </font>REDUnPack<font color="#000080">(</font>HTOC<font color="#000080">).</font>Frame<font color="#000080">);
              </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
          </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>Calculate_Track<font color="#000080">(</font>TrackNo <font color="#000080">:</font>Byte<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>StartSector<font color="#000080">,</font>TrackLength<font color="#000080">,</font>DiskEnd
<font color="#000080">:</font>LongInt<font color="#000080">);  </font><font color="#FF0000"><b>Var </b></font>HStartSector<font color="#000080">,</font>HTrackLength <font color="#000080">:</font>LongInt<font color="#000080">;
  </font><font color="#FF0000"><b>Begin
    If </b></font><font color="#000080">(</font>TOCreaded<font color="#000080">) </font><font color="#FF0000"><b>AND </b></font><font color="#000080">(</font>Media_Changed<font color="#000080">=</font><font color="#800000">1</font><font color="#000080">) </font><font color="#FF0000"><b>AND </b></font>AudioCD <font color="#FF0000"><b>Then
      Begin
        </b></font>HStartSector<font color="#000080">:=</font>TOC<font color="#000080">[</font>TrackNo<font color="#000080">]-</font>TOC<font color="#000080">[</font>GlobalTrackMin<font color="#000080">];
        </font><font color="#FF0000"><b>If </b></font>TrackNo<font color="#000080">&lt;</font>GlobalTrackMax <font color="#FF0000"><b>Then
          </b></font>HTrackLength<font color="#000080">:=(</font>TOC<font color="#000080">[</font>TrackNo<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">]-</font>HStartSector<font color="#000080">)-</font>TOC<font color="#000080">[</font>GlobalTrackMin<font color="#000080">]
        </font><font color="#FF0000"><b>Else
          </b></font>HTrackLength<font color="#000080">:=(</font>GlobalLeadOut<font color="#000080">-</font>HStartSector<font color="#000080">)-</font>TOC<font color="#000080">[</font>GlobalTrackMin<font color="#000080">];
        </font>DiskEnd<font color="#000080">:=</font>GlobalLeadOut<font color="#000080">-</font>HStartSector<font color="#000080">;
      </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
    </font>StartSector<font color="#000080">:=</font>HStartSector<font color="#000080">;
    </font>TrackLength<font color="#000080">:=</font>HTrackLength<font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>Play_Track<font color="#000080">(</font>TrackNo <font color="#000080">:</font>Byte<font color="#000080">);
  </font><font color="#FF0000"><b>Var </b></font>Status<font color="#000080">,</font>StartSector<font color="#000080">,</font>TrackLength<font color="#000080">,</font>DiskEnd <font color="#000080">:</font>LongInt<font color="#000080">;
  </font><font color="#FF0000"><b>Begin
    </b></font>Status<font color="#000080">:=</font>Device_Status<font color="#000080">;
    </font><font color="#FF0000"><b>If </b></font><font color="#000080">(</font>Status <font color="#FF0000"><b>AND </b></font><font color="#800000">$0800</font><font color="#000080">)=</font><font color="#800000">$0000 </font><font color="#FF0000"><b>Then
      Begin
        If </b></font><font color="#000080">(</font><font color="#FF0000"><b>NOT </b></font>TOCreaded<font color="#000080">) </font><font color="#FF0000"><b>OR </b></font><font color="#000080">(</font>Media_Changed<font color="#000080">&lt;&gt;</font><font color="#800000">1</font><font color="#000080">) </font><font color="#FF0000"><b>Then
          </b></font>ReadTOC<font color="#000080">;
        </font><font color="#FF0000"><b>If </b></font><font color="#000080">(</font>TrackNo<font color="#000080">&gt;=</font>GlobalTrackMin<font color="#000080">) </font><font color="#FF0000"><b>AND </b></font><font color="#000080">(</font>TrackNo<font color="#000080">&lt;=</font>GlobalTrackMax<font color="#000080">) </font><font color="#FF0000"><b>AND </b></font>AudioCD
<font color="#FF0000"><b>Then          Begin
            </b></font>Status<font color="#000080">:=</font>Device_Status<font color="#000080">;
            </font><font color="#FF0000"><b>If </b></font><font color="#000080">(</font>GlobalError <font color="#FF0000"><b>AND </b></font><font color="#800000">$0200</font><font color="#000080">)=</font><font color="#800000">$0200 </font><font color="#FF0000"><b>Then
              </b></font>Pause_Audio<font color="#000080">;
            </font>Calculate_Track<font color="#000080">(</font>TrackNo<font color="#000080">,</font>StartSector<font color="#000080">,</font>TrackLength<font color="#000080">,</font>DiskEnd<font color="#000080">);
            </font><font color="#FF0000"><b>If </b></font><font color="#000080">(</font>GlobalError <font color="#FF0000"><b>AND </b></font><font color="#800000">$8000</font><font color="#000080">)=</font><font color="#800000">0 </font><font color="#FF0000"><b>Then
              Begin
                </b></font>Play_Audio<font color="#000080">(</font>StartSector<font color="#000080">,</font>TrackLength<font color="#000080">);
                </font>GlobalAktualTrack<font color="#000080">:=</font>TrackNo<font color="#000080">;
              </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
          </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>Play_Track_to_End<font color="#000080">(</font>TrackNo <font color="#000080">:</font>Byte<font color="#000080">);
  </font><font color="#FF0000"><b>Var </b></font>Status<font color="#000080">,</font>StartSector<font color="#000080">,</font>TrackLength<font color="#000080">,</font>DiskEnd <font color="#000080">:</font>LongInt<font color="#000080">;
  </font><font color="#FF0000"><b>Begin
    </b></font>Status<font color="#000080">:=</font>Device_Status<font color="#000080">;
    </font><font color="#FF0000"><b>If </b></font><font color="#000080">(</font>Status <font color="#FF0000"><b>AND </b></font><font color="#800000">$0800</font><font color="#000080">)=</font><font color="#800000">$0000 </font><font color="#FF0000"><b>Then
      Begin
        If </b></font><font color="#000080">(</font><font color="#FF0000"><b>NOT </b></font>TOCreaded<font color="#000080">) </font><font color="#FF0000"><b>OR </b></font><font color="#000080">(</font>Media_Changed<font color="#000080">&lt;&gt;</font><font color="#800000">1</font><font color="#000080">) </font><font color="#FF0000"><b>Then
          </b></font>ReadTOC<font color="#000080">;
        </font><font color="#FF0000"><b>If </b></font><font color="#000080">(</font>TrackNo<font color="#000080">&gt;=</font>GlobalTrackMin<font color="#000080">) </font><font color="#FF0000"><b>AND </b></font><font color="#000080">(</font>TrackNo<font color="#000080">&lt;=</font>GlobalTrackMax<font color="#000080">) </font><font color="#FF0000"><b>AND </b></font>AudioCD
<font color="#FF0000"><b>Then          Begin
            </b></font>Status<font color="#000080">:=</font>Device_Status<font color="#000080">;
            </font><font color="#FF0000"><b>If </b></font><font color="#000080">(</font>GlobalError <font color="#FF0000"><b>AND </b></font><font color="#800000">$0200</font><font color="#000080">)=</font><font color="#800000">$0200 </font><font color="#FF0000"><b>Then
              </b></font>Pause_Audio<font color="#000080">;
            </font>Calculate_Track<font color="#000080">(</font>TrackNo<font color="#000080">,</font>StartSector<font color="#000080">,</font>TrackLength<font color="#000080">,</font>DiskEnd<font color="#000080">);
            </font><font color="#FF0000"><b>If </b></font><font color="#000080">(</font>GlobalError <font color="#FF0000"><b>AND </b></font><font color="#800000">$8000</font><font color="#000080">)=</font><font color="#800000">0 </font><font color="#FF0000"><b>Then
              Begin
                </b></font>Play_Audio<font color="#000080">(</font>StartSector<font color="#000080">,</font>DiskEnd<font color="#000080">);
                </font>GlobalAktualTrack<font color="#000080">:=</font>TrackNo<font color="#000080">;
              </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
          </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>Show_Track<font color="#000080">(</font>TrackNo<font color="#000080">, </font>Seconds <font color="#000080">:</font>Byte<font color="#000080">);
  </font><font color="#FF0000"><b>Var </b></font>Status<font color="#000080">,</font>StartSector<font color="#000080">,</font>TrackLength<font color="#000080">,</font>DiskEnd <font color="#000080">:</font>LongInt<font color="#000080">;
  </font><font color="#FF0000"><b>Begin
    </b></font>Status<font color="#000080">:=</font>Device_Status<font color="#000080">;
    </font><font color="#FF0000"><b>If </b></font><font color="#000080">(</font>Status <font color="#FF0000"><b>AND </b></font><font color="#800000">$0800</font><font color="#000080">)=</font><font color="#800000">$0000 </font><font color="#FF0000"><b>Then
      Begin
        If </b></font><font color="#000080">(</font><font color="#FF0000"><b>NOT </b></font>TOCreaded<font color="#000080">) </font><font color="#FF0000"><b>OR </b></font><font color="#000080">(</font>Media_Changed<font color="#000080">&lt;&gt;</font><font color="#800000">1</font><font color="#000080">) </font><font color="#FF0000"><b>Then
          </b></font>Reset_Drive<font color="#000080">;
        </font><font color="#FF0000"><b>If </b></font><font color="#000080">(</font>TrackNo<font color="#000080">&gt;=</font>GlobalTrackMin<font color="#000080">) </font><font color="#FF0000"><b>AND </b></font><font color="#000080">(</font>TrackNo<font color="#000080">&lt;=</font>GlobalTrackMax<font color="#000080">) </font><font color="#FF0000"><b>AND </b></font>AudioCD
<font color="#FF0000"><b>Then          Begin
            </b></font>Status<font color="#000080">:=</font>Device_Status<font color="#000080">;
            </font><font color="#FF0000"><b>If </b></font><font color="#000080">(</font>GlobalError <font color="#FF0000"><b>AND </b></font><font color="#800000">$0200</font><font color="#000080">)=</font><font color="#800000">$0200 </font><font color="#FF0000"><b>Then
              </b></font>Pause_Audio<font color="#000080">;
            </font>Calculate_Track<font color="#000080">(</font>TrackNo<font color="#000080">,</font>StartSector<font color="#000080">,</font>TrackLength<font color="#000080">,</font>DiskEnd<font color="#000080">);
            </font><font color="#FF0000"><b>If </b></font><font color="#000080">(</font>GlobalError <font color="#FF0000"><b>AND </b></font><font color="#800000">$8000</font><font color="#000080">)=</font><font color="#800000">0 </font><font color="#FF0000"><b>Then
               Begin
                 </b></font>Play_Audio<font color="#000080">(</font>StartSector<font color="#000080">,</font>Seconds<font color="#000080">*</font><font color="#800000">75</font><font color="#000080">);
                 </font>GlobalAktualTrack<font color="#000080">:=</font>TrackNo<font color="#000080">;
               </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
          </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>Next_Track<font color="#000080">;
  </font><font color="#FF0000"><b>Begin
    If </b></font><font color="#000080">(</font>TOCreaded<font color="#000080">) </font><font color="#FF0000"><b>AND </b></font><font color="#000080">(</font>Media_Changed<font color="#000080">=</font><font color="#800000">1</font><font color="#000080">) </font><font color="#FF0000"><b>AND </b></font>AudioCD <font color="#FF0000"><b>Then
      If </b></font>GlobalTrackMax<font color="#000080">&gt;</font>GlobalAktualTrack <font color="#FF0000"><b>Then
        </b></font>Play_Track<font color="#000080">(</font>GlobalAktualTrack<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">)
      </font><font color="#FF0000"><b>Else
        </b></font>Play_Track<font color="#000080">(</font>GlobalTrackMin<font color="#000080">);
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>Last_Track<font color="#000080">;
  </font><font color="#FF0000"><b>Begin
    If </b></font><font color="#000080">(</font>TOCreaded<font color="#000080">) </font><font color="#FF0000"><b>AND </b></font><font color="#000080">(</font>Media_Changed<font color="#000080">=</font><font color="#800000">1</font><font color="#000080">) </font><font color="#FF0000"><b>AND </b></font>AudioCD <font color="#FF0000"><b>Then
      If </b></font>GlobalTrackMin<font color="#000080">&lt;</font>GlobalAktualTrack <font color="#FF0000"><b>Then
        </b></font>Play_Track<font color="#000080">(</font>GlobalAktualTrack<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">)
      </font><font color="#FF0000"><b>Else
        </b></font>Play_Track<font color="#000080">(</font>GlobalTrackMax<font color="#000080">);
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>Next_Track_to_End<font color="#000080">;
  </font><font color="#FF0000"><b>Begin
    If </b></font><font color="#000080">(</font>TOCreaded<font color="#000080">) </font><font color="#FF0000"><b>AND </b></font><font color="#000080">(</font>Media_Changed<font color="#000080">=</font><font color="#800000">1</font><font color="#000080">) </font><font color="#FF0000"><b>AND </b></font>AudioCD <font color="#FF0000"><b>Then
      If </b></font>GlobalTrackMax<font color="#000080">&gt;</font>GlobalAktualTrack <font color="#FF0000"><b>Then
        </b></font>Play_Track_to_End<font color="#000080">(</font>GlobalAktualTrack<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">)
      </font><font color="#FF0000"><b>Else
        </b></font>Play_Track_to_End<font color="#000080">(</font>GlobalTrackMin<font color="#000080">);
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>Last_Track_to_End<font color="#000080">;
  </font><font color="#FF0000"><b>Begin
    If </b></font><font color="#000080">(</font>TOCreaded<font color="#000080">) </font><font color="#FF0000"><b>AND </b></font><font color="#000080">(</font>Media_Changed<font color="#000080">=</font><font color="#800000">1</font><font color="#000080">) </font><font color="#FF0000"><b>AND </b></font>AudioCD <font color="#FF0000"><b>Then
      If </b></font>GlobalTrackMin<font color="#000080">&lt;</font>GlobalAktualTrack <font color="#FF0000"><b>Then
        </b></font>Play_Track_to_End<font color="#000080">(</font>GlobalAktualTrack<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">)
      </font><font color="#FF0000"><b>Else
        </b></font>Play_Track_to_End<font color="#000080">(</font>GlobalTrackMax<font color="#000080">);
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure
</b></font>Audio_Channel_Control<font color="#000080">(</font>ChOut0<font color="#000080">,</font>Vol0<font color="#000080">,</font>ChOut1<font color="#000080">,</font>Vol1<font color="#000080">,</font>ChOut2<font color="#000080">,</font>Vol2<font color="#000080">,</font>ChOut3<font color="#000080">,</font>Vol3 <font color="#000080">:</font>Byte<font color="#000080">);
</font><font color="#FF0000"><b>Type    </b></font>TAudioChannelControl <font color="#000080">=
      </font><font color="#FF0000"><b>Record
        </b></font>Command <font color="#000080">:</font>Byte<font color="#000080">;
        </font>ChOut0  <font color="#000080">:</font>Byte<font color="#000080">;
        </font>Vol0    <font color="#000080">:</font>Byte<font color="#000080">;
        </font>ChOut1  <font color="#000080">:</font>Byte<font color="#000080">;
        </font>Vol1    <font color="#000080">:</font>Byte<font color="#000080">;
        </font>ChOut2  <font color="#000080">:</font>Byte<font color="#000080">;
        </font>Vol2    <font color="#000080">:</font>Byte<font color="#000080">;
        </font>ChOut3  <font color="#000080">:</font>Byte<font color="#000080">;
        </font>Vol3    <font color="#000080">:</font>Byte<font color="#000080">;
      </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>Var </b></font>IOCTL <font color="#000080">:</font>TAudioChannelControl<font color="#000080">;
  </font><font color="#FF0000"><b>Begin
    </b></font>IOCTL<font color="#000080">.</font>Command<font color="#000080">:=</font><font color="#800000">3</font><font color="#000080">;
    </font>IOCTL<font color="#000080">.</font>ChOut0<font color="#000080">:=</font>ChOut0<font color="#000080">;
    </font>IOCTL<font color="#000080">.</font>ChOut1<font color="#000080">:=</font>ChOut1<font color="#000080">;
    </font>IOCTL<font color="#000080">.</font>ChOut2<font color="#000080">:=</font>ChOut2<font color="#000080">;
    </font>IOCTL<font color="#000080">.</font>ChOut3<font color="#000080">:=</font>ChOut3<font color="#000080">;
    </font>IOCTL<font color="#000080">.</font>Vol0<font color="#000080">:=</font>Vol0<font color="#000080">;
    </font>IOCTL<font color="#000080">.</font>Vol1<font color="#000080">:=</font>Vol1<font color="#000080">;
    </font>IOCTL<font color="#000080">.</font>Vol2<font color="#000080">:=</font>Vol2<font color="#000080">;
    </font>IOCTL<font color="#000080">.</font>Vol3<font color="#000080">:=</font>Vol3<font color="#000080">;
    </font>IOCTLout<font color="#000080">(@</font>IOCTL<font color="#000080">,</font>SizeOf<font color="#000080">(</font>IOCTL<font color="#000080">));
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>Eject_Disk<font color="#000080">;
  </font><font color="#FF0000"><b>Type
    </b></font>TEjectDisk <font color="#000080">=
      </font><font color="#FF0000"><b>Record
        </b></font>Command <font color="#000080">:</font>Byte<font color="#000080">;
      </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>Var </b></font>IOCTL <font color="#000080">:</font>TEjectDisk<font color="#000080">;
  </font><font color="#FF0000"><b>Begin
    </b></font>IOCTL<font color="#000080">.</font>Command<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
    </font>IOCTLout<font color="#000080">(@</font>IOCTL<font color="#000080">,</font>SizeOf<font color="#000080">(</font>IOCTL<font color="#000080">));
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>Close_Tray<font color="#000080">;
  </font><font color="#FF0000"><b>Type
    </b></font>TCloseTray <font color="#000080">=
      </font><font color="#FF0000"><b>Record
        </b></font>Command <font color="#000080">:</font>Byte<font color="#000080">;
      </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>Var </b></font>IOCTL <font color="#000080">:</font>TCloseTray<font color="#000080">;
  </font><font color="#FF0000"><b>Begin
    </b></font>IOCTL<font color="#000080">.</font>Command<font color="#000080">:=</font><font color="#800000">5</font><font color="#000080">;
    </font>IOCTLout<font color="#000080">(@</font>IOCTL<font color="#000080">,</font>SizeOf<font color="#000080">(</font>IOCTL<font color="#000080">));
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>Lock_Door<font color="#000080">;
  </font><font color="#FF0000"><b>Type
    </b></font>TLockUnlock <font color="#000080">=
      </font><font color="#FF0000"><b>Record
        </b></font>Command    <font color="#000080">:</font>Byte<font color="#000080">;
        </font>LockUnlock <font color="#000080">:</font>Byte<font color="#000080">;
      </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>Var </b></font>IOCTL <font color="#000080">:</font>TLockUnlock<font color="#000080">;
  </font><font color="#FF0000"><b>Begin
    </b></font>IOCTL<font color="#000080">.</font>Command<font color="#000080">:=</font><font color="#800000">1</font><font color="#000080">;
    </font>IOCTL<font color="#000080">.</font>LockUnlock<font color="#000080">:=</font><font color="#800000">1</font><font color="#000080">; </font><font color="#008000"><i>(* Lock *)
    </i></font>IOCTLout<font color="#000080">(@</font>IOCTL<font color="#000080">,</font>SizeOf<font color="#000080">(</font>IOCTL<font color="#000080">));
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>UnLock_Door<font color="#000080">;
  </font><font color="#FF0000"><b>Type
    </b></font>TLockUnlock <font color="#000080">=
      </font><font color="#FF0000"><b>Record
        </b></font>Command    <font color="#000080">:</font>Byte<font color="#000080">;
        </font>LockUnlock <font color="#000080">:</font>Byte<font color="#000080">;
      </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>Var </b></font>IOCTL <font color="#000080">:</font>TLockUnlock<font color="#000080">;
  </font><font color="#FF0000"><b>Begin
    </b></font>IOCTL<font color="#000080">.</font>Command<font color="#000080">:=</font><font color="#800000">1</font><font color="#000080">;
    </font>IOCTL<font color="#000080">.</font>LockUnlock<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">; </font><font color="#008000"><i>(* Unlock *)
    </i></font>IOCTLout<font color="#000080">(@</font>IOCTL<font color="#000080">,</font>SizeOf<font color="#000080">(</font>IOCTL<font color="#000080">));
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>Reset_Drive<font color="#000080">;
  </font><font color="#FF0000"><b>Type
    </b></font>TResetDrive <font color="#000080">=
      </font><font color="#FF0000"><b>Record
        </b></font>Command    <font color="#000080">:</font>Byte<font color="#000080">;
      </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>Var </b></font>IOCTL <font color="#000080">:</font>TResetDrive<font color="#000080">;
  </font><font color="#FF0000"><b>Begin
    </b></font>IOCTL<font color="#000080">.</font>Command<font color="#000080">:=</font><font color="#800000">2</font><font color="#000080">;
    </font>IOCTLout<font color="#000080">(@</font>IOCTL<font color="#000080">,</font>SizeOf<font color="#000080">(</font>IOCTL<font color="#000080">));
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Begin
  </b></font>MSCDEX_Init<font color="#000080">;
  </font>GlobalDriveCount<font color="#000080">:=</font>CDROM_Number<font color="#000080">(</font>GlobalDriveNo<font color="#000080">);
  </font><font color="#FF0000"><b>If </b></font>GlobalDriveCount<font color="#000080">&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>Then
    </b></font>MSCDEXOk<font color="#000080">:=</font>TRUE<font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to DRIVES SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0106.PAS">Original</a><b>]</b></p></body>
</html>
