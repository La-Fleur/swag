<html>
<head><title> "Drive Serial Number" by SWAG SUPPORT TEAM</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to DRIVES SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0015.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
&gt;How can [a disk serial number] be read from TP? Can it be changed other than
&gt;by re-Formatting? I can't find any reference to serial number
&gt;in the Dos 5.0 users guide except a passing one in the section
&gt;on the ForMAT command.
}
</i></font><font color="#FF0000"><b>Uses </b></font>Dos<font color="#000080">;
</font><font color="#FF0000"><b>Var  </b></font>regs <font color="#000080">: </font>Registers<font color="#000080">;
     </font>LabelInfo <font color="#000080">: </font><font color="#FF0000"><b>Record
       </b></font>InfoLevel <font color="#000080">: </font>Word<font color="#000080">;    </font><font color="#008000"><i>{Always 0}
       </i></font>SerialNum <font color="#000080">: </font>LongInt<font color="#000080">;
       </font>VolumeLabel <font color="#000080">: </font><font color="#FF0000"><b>Array </b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">11</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Char<font color="#000080">;
       </font>FileSystemType <font color="#000080">: </font><font color="#FF0000"><b>Array </b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">8</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Char<font color="#000080">;
     </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>begin

  if </b></font>lo<font color="#000080">(</font>DosVersion<font color="#000080">)&lt;</font><font color="#800000">4 </font><font color="#FF0000"><b>then
    begin
      </b></font>Writeln <font color="#000080">(</font><font color="#800000">'Only works With Dos 4.0 or higher'</font><font color="#000080">);
      </font>Exit<font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font>LabelInfo<font color="#000080">.</font>InfoLevel <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;       </font><font color="#008000"><i>{Set Info level (0 is the only legal value)}
  </i></font><font color="#FF0000"><b>With </b></font>regs <font color="#FF0000"><b>do
     begin
       </b></font>ax <font color="#000080">:= </font><font color="#800000">$6900</font><font color="#000080">;  </font><font color="#008000"><i>{Function $69 With 0 in AL gets, With 1 in AL sets}
       </i></font>bl <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;      </font><font color="#008000"><i>{Drive, 0 For default, 1 For A:, 2 For B:, ...}
       </i></font>ds <font color="#000080">:= </font>seg<font color="#000080">(</font>LabelInfo<font color="#000080">);  </font><font color="#008000"><i>{DS:DX points at structure}
       </i></font>dx <font color="#000080">:= </font>ofs<font color="#000080">(</font>LabelInfo<font color="#000080">);
       </font>es <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;      </font><font color="#008000"><i>{Do not have garbage in segment Registers}
       </i></font>flags <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;   </font><font color="#008000"><i>{  or in flags}

       </i></font>MsDos<font color="#000080">(</font>Regs<font color="#000080">);

       </font><font color="#FF0000"><b>if </b></font>Odd<font color="#000080">(</font>flags<font color="#000080">) </font><font color="#FF0000"><b>then   </b></font><font color="#008000"><i>{Carry set if error}
         </i></font><font color="#FF0000"><b>begin
             Case </b></font>AX <font color="#FF0000"><b>of
               </b></font><font color="#800000">1</font><font color="#000080">:  </font>Writeln <font color="#000080">(</font><font color="#800000">'Illegal attempt to get Label from network drv'</font><font color="#000080">);
               </font><font color="#800000">5</font><font color="#000080">:  </font>Writeln <font color="#000080">(</font><font color="#800000">'No Extended BPB on disk (Format old)'</font><font color="#000080">);
             </font><font color="#FF0000"><b>else  </b></font>Writeln <font color="#000080">(</font><font color="#800000">'Unknown error'</font><font color="#000080">);
             </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
         </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{On return, fills SerialNum, VolumeLabel, and FileSystemType fields.
  places 'FAT12   ' or 'FAT16   ' in FileSystemType, For 12- or 16-bit FAT
entries.  With AL=1, will use info you store in LabelInfo to set disk's
extended BPB}
</i></font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to DRIVES SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0015.PAS">Original</a><b>]</b></p></body>
</html>
