<html>
<head><title> "Get DOS Drives" by SWAG SUPPORT TEAM</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to DRIVES SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0064.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#FF0000"><b>unit </b></font>GetDrive<font color="#000080">;

</font><font color="#FF0000"><b>interface
uses
  </b></font>Crt<font color="#000080">;

</font><font color="#FF0000"><b>type
  </b></font>TFCB <font color="#000080">= </font><font color="#FF0000"><b>Record
    </b></font>Drive<font color="#000080">: </font>Byte<font color="#000080">;
    </font>Name<font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">7</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Char<font color="#000080">;
    </font>Ext<font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">2</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Char<font color="#000080">;
    </font>CurBlock<font color="#000080">: </font>Word<font color="#000080">;
    </font>RecSize<font color="#000080">: </font>Word<font color="#000080">;
    </font>FileSize<font color="#000080">: </font>LongInt<font color="#000080">;
    </font>FileDate<font color="#000080">: </font>Word<font color="#000080">;
    </font>FileTime<font color="#000080">: </font>Word<font color="#000080">;
    </font>Reserved<font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">7</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Char<font color="#000080">;
    </font>CurRec<font color="#000080">: </font>Byte<font color="#000080">;
    </font>RandRec<font color="#000080">: </font>LongInt<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font>TDBP <font color="#000080">= </font><font color="#FF0000"><b>Record
    </b></font>Drive<font color="#000080">: </font>Byte<font color="#000080">;
    </font>AUnit<font color="#000080">: </font>Byte<font color="#000080">;
    </font>SectorSize<font color="#000080">: </font>Word<font color="#000080">;
    </font>Rest<font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">28</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Byte<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>PDBP <font color="#000080">= ^</font>TDBP<font color="#000080">;


</font><font color="#FF0000"><b>procedure </b></font>GetDrives<font color="#000080">;

</font><font color="#FF0000"><b>implementation
var
  </b></font>Sx<font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">80</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Char<font color="#000080">;
  </font>FCBx<font color="#000080">: </font>TFCB<font color="#000080">;
  </font>DBP<font color="#000080">: </font>PDBP<font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>ISOK<font color="#000080">(</font>Drive<font color="#000080">: </font>Byte<font color="#000080">): </font>Boolean<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>asm
  </b></font><font color="#FF00FF">push ds
  mov dl, Drive
  mov ah, 32h
  int 21h
  cmp al, $FF
  jz  @error
  mov cx, ds
  mov es, cx
  pop ds
  mov word ptr DBP, bx
  mov word ptr DBP + 2, es
  mov al, 1
  jmp @Ok
@error:
  pop ds
  mov al, 0
@Ok:
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>function </b></font>GetInfo<font color="#000080">: </font>Boolean<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>asm
  </b></font><font color="#FF00FF">push bp
  push ds
  mov si, seg Sx
  mov ds, si
  mov si, offset sx
  mov di, seg FCBx
  mov es, di
  mov di, offset fcbx
  mov al, 1
  mov ah, 29h
  int 21h
  mov bl, al
  mov ax, 1
  cmp bl, $FF
  jnz @Done
  mov ax, 0
@Done:
  pop ds
  pop bp
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>GetDrives<font color="#000080">;
</font><font color="#FF0000"><b>var
  </b></font>S1<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
  </font>i<font color="#000080">: </font>Integer<font color="#000080">;
  </font>bad<font color="#000080">: </font>Boolean<font color="#000080">;
  </font>S<font color="#000080">: </font>PChar<font color="#000080">;

</font><font color="#FF0000"><b>begin
  </b></font>GetMem<font color="#000080">(</font>S<font color="#000080">, </font><font color="#800000">80</font><font color="#000080">);
  </font>S1 <font color="#000080">:= </font><font color="#800000">'c:*.*'</font><font color="#000080">;
  </font>FillChar<font color="#000080">(</font>FCBx<font color="#000080">, </font>SizeOf<font color="#000080">(</font>TFCB<font color="#000080">), </font><font color="#800000">#0</font><font color="#000080">);
  </font><font color="#FF0000"><b>for </b></font>i <font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font><font color="#800000">25 </font><font color="#FF0000"><b>do begin
    </b></font>S1<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">] := </font>Chr<font color="#000080">(</font>i <font color="#000080">+ </font><font color="#800000">65</font><font color="#000080">);
    </font>move<font color="#000080">(</font>S1<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">], </font>Sx<font color="#000080">, </font>Length<font color="#000080">(</font>S1<font color="#000080">));
    </font>S<font color="#000080">[</font>Length<font color="#000080">(</font>S1<font color="#000080">)] := </font><font color="#800000">#0</font><font color="#000080">;
    </font>Bad <font color="#000080">:= </font>GetInfo<font color="#000080">;
    </font><font color="#FF0000"><b>if </b></font>bad <font color="#FF0000"><b>then begin
      </b></font>Write<font color="#000080">(</font>S1<font color="#000080">);
      </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>i <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>or </b></font><font color="#000080">(</font>i <font color="#000080">= </font><font color="#800000">1</font><font color="#000080">) </font><font color="#FF0000"><b>then
        </b></font>WriteLn<font color="#000080">(</font><font color="#800000">' -&gt; Normal'</font><font color="#000080">)
      </font><font color="#FF0000"><b>else
        if </b></font>IsOk<font color="#000080">(</font>i<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">) </font><font color="#FF0000"><b>then </b></font>WriteLn<font color="#000080">(</font><font color="#800000">' -&gt; Normal'</font><font color="#000080">)
        </font><font color="#FF0000"><b>else </b></font>WriteLn<font color="#000080">(</font><font color="#800000">' -&gt; Special'</font><font color="#000080">);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>FreeMem<font color="#000080">(</font>S<font color="#000080">, </font><font color="#800000">80</font><font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">.

</font><font color="#008000"><i>{ -------------------------------   DEMO  --------------------------- }

{
  This code shows how to find information about which drives
  exist on the system. It returns the information without
  ever causing an error message to appear on screen.

}
</i></font><font color="#FF0000"><b>program </b></font>Drives<font color="#000080">;
</font><font color="#FF0000"><b>uses
  </b></font>GetDrive<font color="#000080">,
  </font>Crt<font color="#000080">;

</font><font color="#FF0000"><b>begin
  </b></font>ClrScr<font color="#000080">;
  </font>GetDrives<font color="#000080">;
  </font>ReadLn<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">.</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to DRIVES SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0064.PAS">Original</a><b>]</b></p></body>
</html>
