<html>
<head><title> "Getting Device Names" by JOSEPH METCALF</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to DRIVES SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0085.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
From: regis@alpha2.csd.uwm.edu (Joseph William Metcalf)

There are been a couple posts looking for a way to read the device name for
CD audio play functions, so here it is (tested under TP7):
}

</i></font><font color="#FF0000"><b>type </b></font>DRIVELIST<font color="#000080">=</font><font color="#FF0000"><b>Record
               </b></font>unitcode<font color="#000080">:</font>byte<font color="#000080">;
               </font>doffset<font color="#000080">,</font>dsegment<font color="#000080">:</font>word<font color="#000080">;
               </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>var
  </b></font>CDDL<font color="#000080">:</font>DriveList<font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>GetDriverName<font color="#000080">:</font><font color="#FF0000"><b>string</b></font><font color="#000080">;
</font><font color="#FF0000"><b>var
  </b></font>CDNTemp<font color="#000080">:</font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">18</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">;
  </font>where<font color="#000080">:</font>pointer<font color="#000080">;
  </font>count<font color="#000080">:</font>byte<font color="#000080">;
  </font>CDSTemp<font color="#000080">:</font><font color="#FF0000"><b>string</b></font><font color="#000080">[</font><font color="#800000">8</font><font color="#000080">];
</font><font color="#FF0000"><b>begin
  asm
    </b></font><font color="#FF00FF">mov ax,1501h
    mov bx,OFFSET CDDL
    mov dx,SEG CDDL
    mov es,dx
    int 2fh
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>where<font color="#000080">:=</font>ptr<font color="#000080">(</font>CDDL<font color="#000080">.</font>dsegment<font color="#000080">,</font>CDDL<font color="#000080">.</font>doffset<font color="#000080">);
  </font>move<font color="#000080">(</font>where<font color="#000080">^,</font>CDNTEMP<font color="#000080">,</font><font color="#800000">18</font><font color="#000080">);
  </font>count<font color="#000080">:=</font><font color="#800000">1</font><font color="#000080">;
  </font><font color="#FF0000"><b>repeat
    </b></font>CDStemp<font color="#000080">[</font>count<font color="#000080">]:=</font>chr<font color="#000080">(</font>cdntemp<font color="#000080">[</font><font color="#800000">10</font><font color="#000080">+</font>count<font color="#000080">]);
    </font>inc<font color="#000080">(</font>count<font color="#000080">);
  </font><font color="#FF0000"><b>until </b></font><font color="#000080">(</font>count<font color="#000080">&gt;</font><font color="#800000">8</font><font color="#000080">) </font><font color="#FF0000"><b>or </b></font><font color="#000080">(</font>cdntemp<font color="#000080">[</font><font color="#800000">10</font><font color="#000080">+</font>count<font color="#000080">]=</font><font color="#800000">32</font><font color="#000080">);
  </font>cdstemp<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">]:=</font>chr<font color="#000080">(</font>count<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">);
 </font>getdrivername<font color="#000080">:=</font>cdstemp<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#008000"><i>{
This uses the MSCDEX function 1501h (Int 2fh) to read the drivelist and
segment/offset of the device driver header. Device name is 10 bytes into the
header, max 8 characters, padded with spaces if the name is less than 8
characters.
}
</i></font><font color="#FF0000"><b>begin
  </b></font>Writeln<font color="#000080">(</font>GetDriverName<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">.</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to DRIVES SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0085.PAS">Original</a><b>]</b></p></body>
</html>
