<html>
<head><title> "Edit Disk Serial Number" by SWAG SUPPORT TEAM</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to DRIVES SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0024.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#FF0000"><b>PROGRAM </b></font>Serial <font color="#000080">(</font>Input<font color="#000080">, </font>Output<font color="#000080">);
</font><font color="#FF0000"><b>USES </b></font>CRT<font color="#000080">;

</font><font color="#FF0000"><b>CONST
  </b></font>HexDigits <font color="#000080">: </font><font color="#FF0000"><b>ARRAY </b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">15</font><font color="#000080">]</font><font color="#FF0000"><b>OF </b></font>CHAR <font color="#000080">= </font><font color="#800000">'0123456789ABCDEF'</font><font color="#000080">;
</font><font color="#FF0000"><b>TYPE
  </b></font>InfoBuffer <font color="#000080">= </font><font color="#FF0000"><b>RECORD
               </b></font>InfoLevel <font color="#000080">: </font>WORD<font color="#000080">;    </font><font color="#008000"><i>{should be zero}
               </i></font>Serial <font color="#000080">: </font>LONGINT<font color="#000080">;
               </font>VolLabel <font color="#000080">: </font><font color="#FF0000"><b>ARRAY </b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">10</font><font color="#000080">]</font><font color="#FF0000"><b>OF </b></font>CHAR<font color="#000080">;
               </font>FileSystem <font color="#000080">: </font><font color="#FF0000"><b>ARRAY </b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">7</font><font color="#000080">]</font><font color="#FF0000"><b>OF </b></font>CHAR<font color="#000080">;
             </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
  </font>SerString <font color="#000080">= </font><font color="#FF0000"><b>STRING </b></font><font color="#000080">[</font><font color="#800000">9</font><font color="#000080">];

</font><font color="#FF0000"><b>VAR
  </b></font>IB <font color="#000080">: </font>InfoBuffer<font color="#000080">;
  </font>N <font color="#000080">: </font>WORD<font color="#000080">;
  </font>let <font color="#000080">: </font>CHAR<font color="#000080">;
  </font>param <font color="#000080">: </font><font color="#FF0000"><b>STRING </b></font><font color="#000080">[</font><font color="#800000">10</font><font color="#000080">];
  </font>IsSet <font color="#000080">: </font>BOOLEAN<font color="#000080">;
  </font>NewSerial <font color="#000080">: </font>LONGINT<font color="#000080">;
  </font>code <font color="#000080">: </font>INTEGER<font color="#000080">;

  </font><font color="#FF0000"><b>FUNCTION </b></font>SerialStr <font color="#000080">(</font>L <font color="#000080">: </font>LONGINT<font color="#000080">) : </font>SerString<font color="#000080">;
  </font><font color="#FF0000"><b>VAR </b></font>Temp <font color="#000080">: </font>SerString<font color="#000080">;
  </font><font color="#FF0000"><b>BEGIN
    </b></font>Temp <font color="#000080">[</font><font color="#800000">0</font><font color="#000080">] := </font><font color="#800000">#9</font><font color="#000080">;
    </font>Temp <font color="#000080">[</font><font color="#800000">1</font><font color="#000080">] := </font>HexDigits <font color="#000080">[</font>L <font color="#FF0000"><b>SHR </b></font><font color="#800000">28</font><font color="#000080">];
    </font>Temp <font color="#000080">[</font><font color="#800000">2</font><font color="#000080">] := </font>HexDigits <font color="#000080">[ (</font>L <font color="#FF0000"><b>SHR </b></font><font color="#800000">24</font><font color="#000080">) </font><font color="#FF0000"><b>AND </b></font><font color="#800000">$F</font><font color="#000080">];
    </font>Temp <font color="#000080">[</font><font color="#800000">3</font><font color="#000080">] := </font>HexDigits <font color="#000080">[ (</font>L <font color="#FF0000"><b>SHR </b></font><font color="#800000">20</font><font color="#000080">) </font><font color="#FF0000"><b>AND </b></font><font color="#800000">$F</font><font color="#000080">];
    </font>Temp <font color="#000080">[</font><font color="#800000">4</font><font color="#000080">] := </font>HexDigits <font color="#000080">[ (</font>L <font color="#FF0000"><b>SHR </b></font><font color="#800000">16</font><font color="#000080">) </font><font color="#FF0000"><b>AND </b></font><font color="#800000">$F</font><font color="#000080">];
    </font>Temp <font color="#000080">[</font><font color="#800000">5</font><font color="#000080">] := </font><font color="#800000">'-'</font><font color="#000080">;
    </font>Temp <font color="#000080">[</font><font color="#800000">6</font><font color="#000080">] := </font>HexDigits <font color="#000080">[ (</font>L <font color="#FF0000"><b>SHR </b></font><font color="#800000">12</font><font color="#000080">) </font><font color="#FF0000"><b>AND </b></font><font color="#800000">$F</font><font color="#000080">];
    </font>Temp <font color="#000080">[</font><font color="#800000">7</font><font color="#000080">] := </font>HexDigits <font color="#000080">[ (</font>L <font color="#FF0000"><b>SHR </b></font><font color="#800000">8</font><font color="#000080">) </font><font color="#FF0000"><b>AND </b></font><font color="#800000">$F</font><font color="#000080">];
    </font>Temp <font color="#000080">[</font><font color="#800000">8</font><font color="#000080">] := </font>HexDigits <font color="#000080">[ (</font>L <font color="#FF0000"><b>SHR </b></font><font color="#800000">4</font><font color="#000080">) </font><font color="#FF0000"><b>AND </b></font><font color="#800000">$F</font><font color="#000080">];
    </font>Temp <font color="#000080">[</font><font color="#800000">9</font><font color="#000080">] := </font>HexDigits <font color="#000080">[</font>L <font color="#FF0000"><b>AND </b></font><font color="#800000">$F</font><font color="#000080">];
    </font>SerialStr <font color="#000080">:= </font>Temp<font color="#000080">;
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>FUNCTION </b></font>GetSerial <font color="#000080">(</font>DiskNum <font color="#000080">: </font>BYTE<font color="#000080">;
                     </font><font color="#FF0000"><b>VAR </b></font>I <font color="#000080">: </font>InfoBuffer<font color="#000080">) : </font>WORD<font color="#000080">;</font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>asm
    </b></font><font color="#FF00FF">MOV AH, 69h
    MOV AL, 00h
    MOV BL, DiskNum
    PUSH DS
    LDS DX, I
    INT 21h
    POP DS
    JC @Bad
    XOR AX, AX
    @Bad :
    </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

    </font><font color="#FF0000"><b>FUNCTION </b></font>SetSerial <font color="#000080">(</font>DiskNum <font color="#000080">: </font>BYTE<font color="#000080">;
                       </font><font color="#FF0000"><b>VAR </b></font>I <font color="#000080">: </font>InfoBuffer<font color="#000080">) : </font>WORD<font color="#000080">;</font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>asm
      </b></font><font color="#FF00FF">MOV AH, 69h
      MOV AL, 00h
      MOV BL, DiskNum
      PUSH DS
      LDS DX, I
      INT 21h
      POP DS
      JC @Bad
      XOR AX, AX
      @Bad :
      </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

      </font><font color="#FF0000"><b>PROCEDURE </b></font>ErrorOut <font color="#000080">(</font>err <font color="#000080">: </font>BYTE<font color="#000080">);
      </font><font color="#FF0000"><b>BEGIN
        CASE </b></font>err <font color="#FF0000"><b>OF
          </b></font><font color="#800000">5 </font><font color="#000080">: </font><font color="#FF0000"><b>BEGIN
              </b></font>WRITELN <font color="#000080">(</font><font color="#800000">'Either the disk in '</font><font color="#000080">, </font>let<font color="#000080">, </font><font color="#800000">': is write'</font><font color="#000080">,
                      </font><font color="#800000">'protected or it lacks an extended BPB.'</font><font color="#000080">);
              </font>WRITELN <font color="#000080">(</font><font color="#800000">'If the disk is not write-protected, '</font><font color="#000080">,
                      </font><font color="#800000">'reformat it with DOS 4 or higher.'</font><font color="#000080">);
            </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
          </font><font color="#800000">15 </font><font color="#000080">: </font>WRITELN <font color="#000080">(</font><font color="#800000">'Not a valid drive letter.'</font><font color="#000080">);
          </font><font color="#800000">255 </font><font color="#000080">: </font><font color="#FF0000"><b>BEGIN
                </b></font>WRITELN <font color="#000080">(</font><font color="#800000">'SYNTAX:   SERIAL D:########&quot;'</font><font color="#000080">);
                </font>WRITELN <font color="#000080">(</font><font color="#800000">'  where D: is the drive letter'</font><font color="#000080">,
                        </font><font color="#800000">'and ######## is the eight digit'</font><font color="#000080">);
                </font>WRITELN <font color="#000080">(</font><font color="#800000">'  hexadecimal serial number with-'</font><font color="#000080">,
                        </font><font color="#800000">'out the &quot;-&quot;.'</font><font color="#000080">);
                </font>WRITELN <font color="#000080">(</font><font color="#800000">'EXAMPLE:  SERIAL A: 1234ABCD'</font><font color="#000080">);
              </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

        </font><font color="#FF0000"><b>ELSE </b></font>WRITELN <font color="#000080">(</font><font color="#800000">'DOS ERROR #'</font><font color="#000080">, </font>N<font color="#000080">);
        </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
        </font>HALT <font color="#000080">(</font><font color="#800000">1</font><font color="#000080">);
      </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

    </font><font color="#FF0000"><b>BEGIN
      </b></font>CLRSCR<font color="#000080">;
      </font><font color="#FF0000"><b>IF </b></font>PARAMCOUNT <font color="#000080">&lt; </font><font color="#800000">1 </font><font color="#FF0000"><b>THEN </b></font>ErrorOut <font color="#000080">(</font><font color="#800000">255</font><font color="#000080">);
      </font><font color="#FF0000"><b>IF </b></font>PARAMCOUNT <font color="#000080">&gt; </font><font color="#800000">2 </font><font color="#FF0000"><b>THEN </b></font>ErrorOut <font color="#000080">(</font><font color="#800000">255</font><font color="#000080">);
      </font>param <font color="#000080">:= </font>PARAMSTR <font color="#000080">(</font><font color="#800000">1</font><font color="#000080">);
      </font><font color="#FF0000"><b>CASE </b></font>LENGTH <font color="#000080">(</font>param<font color="#000080">) </font><font color="#FF0000"><b>OF
        </b></font><font color="#800000">1 </font><font color="#000080">: </font><font color="#008000"><i>{OK}</i></font><font color="#000080">;
        </font><font color="#800000">2 </font><font color="#000080">: </font><font color="#FF0000"><b>IF </b></font>param <font color="#000080">[</font><font color="#800000">2</font><font color="#000080">] &lt;&gt; </font><font color="#800000">':' </font><font color="#FF0000"><b>THEN </b></font>ErrorOut <font color="#000080">(</font><font color="#800000">255</font><font color="#000080">);
      </font><font color="#FF0000"><b>ELSE </b></font>ErrorOut <font color="#000080">(</font><font color="#800000">255</font><font color="#000080">);
      </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
      </font>let <font color="#000080">:= </font>UPCASE <font color="#000080">(</font>param <font color="#000080">[</font><font color="#800000">1</font><font color="#000080">]);
      </font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>let <font color="#000080">&lt; </font><font color="#800000">'A'</font><font color="#000080">) </font><font color="#FF0000"><b>OR </b></font><font color="#000080">(</font>let <font color="#000080">&gt; </font><font color="#800000">'Z'</font><font color="#000080">) </font><font color="#FF0000"><b>THEN </b></font>ErrorOut <font color="#000080">(</font><font color="#800000">15</font><font color="#000080">);
      </font><font color="#FF0000"><b>IF </b></font>PARAMCOUNT <font color="#000080">&lt; </font><font color="#800000">2 </font><font color="#FF0000"><b>THEN </b></font>IsSet <font color="#000080">:= </font>FALSE
      <font color="#FF0000"><b>ELSE
        BEGIN
          </b></font>IsSet <font color="#000080">:= </font>TRUE<font color="#000080">;
          </font>param <font color="#000080">:= </font><font color="#800000">'$' </font><font color="#000080">+ </font>PARAMSTR <font color="#000080">(</font><font color="#800000">2</font><font color="#000080">);
          </font>VAL <font color="#000080">(</font>param<font color="#000080">, </font>NewSerial<font color="#000080">, </font>code<font color="#000080">);
          </font><font color="#FF0000"><b>IF </b></font>code <font color="#000080">&lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>THEN </b></font>ErrorOut <font color="#000080">(</font><font color="#800000">255</font><font color="#000080">);
        </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
      </font>N <font color="#000080">:= </font>GetSerial <font color="#000080">(</font>ORD <font color="#000080">(</font>let<font color="#000080">) - </font>ORD <font color="#000080">(</font><font color="#800000">'@'</font><font color="#000080">), </font>IB<font color="#000080">);
      </font><font color="#FF0000"><b>IF </b></font>N <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>THEN
        BEGIN
          WITH </b></font>IB <font color="#FF0000"><b>DO
            BEGIN
              </b></font>WRITELN <font color="#000080">(</font><font color="#800000">'Serial Number is &quot;'</font><font color="#000080">,
                      </font>SerialStr <font color="#000080">(</font>Serial<font color="#000080">), </font><font color="#800000">'&quot;'</font><font color="#000080">);
              </font><font color="#FF0000"><b>IF </b></font>IsSet <font color="#FF0000"><b>THEN
                BEGIN
                  </b></font>Serial <font color="#000080">:=
                  </font>NewSerial<font color="#000080">; ;
                  </font>N <font color="#000080">:=
                  </font>SetSerial <font color="#000080">(</font>ORD <font color="#000080">(</font>let<font color="#000080">) - </font>ORD <font color="#000080">(</font><font color="#800000">'@'</font><font color="#000080">), </font>IB<font color="#000080">);
                  </font><font color="#FF0000"><b>IF </b></font>N <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>THEN

                    </b></font>WRITELN <font color="#000080">(</font><font color="#800000">'Successfully canged serial to &quot;'</font><font color="#000080">, </font>SerialStr <font color="#000080">(</font>NewSerial<font color="#000080">), </font><font color="#800000">'&quot;'</font><font color="#000080">)
                  </font><font color="#FF0000"><b>ELSE
                    </b></font>ErrorOut <font color="#000080">(</font>N<font color="#000080">);
                </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
            </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
        </font><font color="#FF0000"><b>END
      ELSE </b></font>ErrorOut <font color="#000080">(</font>N<font color="#000080">);

    </font><font color="#FF0000"><b>END</b></font><font color="#000080">.

</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to DRIVES SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0024.PAS">Original</a><b>]</b></p></body>
</html>
