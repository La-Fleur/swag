<html>
<head><title> "Get Drive ID" by GREG VIGNEAULT</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to DRIVES SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0005.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
 Below is TP code to do drive-Type identification.  I leave it as a
 research exercise For you to create code to differentiate between
 a RAM drive and fixed disk, if that's needed.

}
(********************************************************************)
 </i></font><font color="#FF0000"><b>Program </b></font>DrvCount<font color="#000080">;                      </font><font color="#008000"><i>{ coded by Greg Vigneault   }
 </i></font><font color="#FF0000"><b>Uses   </b></font>Crt<font color="#000080">,</font>Dos<font color="#000080">;                        </font><font color="#008000"><i>{ For MsDos Function        }
 </i></font><font color="#FF0000"><b>Var    </b></font>Drives      <font color="#000080">:</font>Byte<font color="#000080">;              </font><font color="#008000"><i>{ count of logical drives   }
        </i></font>Reg         <font color="#000080">:</font>Registers<font color="#000080">;         </font><font color="#008000"><i>{ to access CPU Registers   }
        </i></font>ThisDrive   <font color="#000080">:</font>Byte<font color="#000080">;              </font><font color="#008000"><i>{ loop count                }
        </i></font>DriveType   <font color="#000080">:</font><font color="#FF0000"><b>String</b></font><font color="#000080">[</font><font color="#800000">16</font><font color="#000080">];        </font><font color="#008000"><i>{ Type of drive found       }
        </i></font>DataBuffer  <font color="#000080">:</font><font color="#FF0000"><b>Array </b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">127</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Byte<font color="#000080">;   </font><font color="#008000"><i>{ buffer For Dos i/o }
 </i></font><font color="#FF0000"><b>begin
    </b></font>ClrScr<font color="#000080">;                             </font><font color="#008000"><i>{ remove screen clutter     }
    </i></font>Reg<font color="#000080">.</font>AH <font color="#000080">:= </font><font color="#800000">$19</font><font color="#000080">;                      </font><font color="#008000"><i>{ get current disk code     }
    </i></font>MsDos<font color="#000080">(</font>Reg<font color="#000080">);                         </font><font color="#008000"><i>{ via Dos                   }
    </i></font>Reg<font color="#000080">.</font>DL <font color="#000080">:= </font>Reg<font color="#000080">.</font>AL<font color="#000080">;                   </font><font color="#008000"><i>{ returned drive code       }
    </i></font>Reg<font color="#000080">.</font>AH <font color="#000080">:= </font><font color="#800000">$E</font><font color="#000080">;                       </font><font color="#008000"><i>{ select disk               }
    </i></font>MsDos<font color="#000080">(</font>Reg<font color="#000080">);                         </font><font color="#008000"><i>{ via Dos                   }
    </i></font>Drives <font color="#000080">:= </font>Reg<font color="#000080">.</font>AL<font color="#000080">;                   </font><font color="#008000"><i>{ number of logical drives  }

    </i></font>WriteLn<font color="#000080">(</font><font color="#800000">'Number of logical drives: '</font><font color="#000080">, </font>Drives <font color="#000080">);

    </font>Intr<font color="#000080">(</font><font color="#800000">$11</font><font color="#000080">,</font>Reg<font color="#000080">);                      </font><font color="#008000"><i>{ get system equipment flag }
    </i></font><font color="#FF0000"><b>if </b></font><font color="#000080">( (</font>Reg<font color="#000080">.</font>AX <font color="#FF0000"><b>and </b></font><font color="#800000">1</font><font color="#000080">) &lt;&gt; </font><font color="#800000">0 </font><font color="#000080">)          </font><font color="#008000"><i>{ any floppies installed?   }
        </i></font><font color="#FF0000"><b>then </b></font>WriteLn<font color="#000080">(</font><font color="#800000">'(physical floppy drives: '</font><font color="#000080">,
                (</font>Reg<font color="#000080">.</font>AX <font color="#FF0000"><b>SHR </b></font><font color="#800000">6</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#800000">3</font><font color="#000080">, </font><font color="#800000">')' </font><font color="#000080">);    </font><font color="#008000"><i>{ get bits 6&amp;7      }

    </i></font><font color="#FF0000"><b>For </b></font>ThisDrive <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>Drives <font color="#FF0000"><b>do begin   </b></font><font color="#008000"><i>{ scan all drives       }
        </i></font>Reg<font color="#000080">.</font>AX <font color="#000080">:= </font><font color="#800000">$440D</font><font color="#000080">;                </font><font color="#008000"><i>{ using generic I/O control }
        </i></font>Reg<font color="#000080">.</font>CX <font color="#000080">:= </font><font color="#800000">$860</font><font color="#000080">;                 </font><font color="#008000"><i>{ to get drive parameters   }
        </i></font>Reg<font color="#000080">.</font>BL <font color="#000080">:= </font>ThisDrive<font color="#000080">;            </font><font color="#008000"><i>{ For this drive            }
        </i></font>Reg<font color="#000080">.</font>DX <font color="#000080">:= </font>ofs<font color="#000080">(</font>DataBuffer<font color="#000080">);      </font><font color="#008000"><i>{ Pointer to scratch buffer }
        </i></font>Reg<font color="#000080">.</font>DS <font color="#000080">:= </font>Seg<font color="#000080">(</font>DataBuffer<font color="#000080">);      </font><font color="#008000"><i>{  in is DS:DX              }
        </i></font>MsDos<font color="#000080">(</font>Reg<font color="#000080">);                     </font><font color="#008000"><i>{ thank you, Dos            }
        </i></font><font color="#FF0000"><b>Case </b></font><font color="#000080">( </font>DataBuffer<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">] ) </font><font color="#FF0000"><b>of       </b></font><font color="#008000"><i>{ which Type it is...       }
            </i></font><font color="#800000">0   </font><font color="#000080">: </font>DriveType <font color="#000080">:= </font><font color="#800000">'360 KB 5.25&quot; FDD'</font><font color="#000080">;
            </font><font color="#800000">1   </font><font color="#000080">: </font>DriveType <font color="#000080">:= </font><font color="#800000">'1.2 MB 5.25&quot; FDD'</font><font color="#000080">;
            </font><font color="#800000">2   </font><font color="#000080">: </font>DriveType <font color="#000080">:= </font><font color="#800000">'720 KB 3.5&quot; FDD'</font><font color="#000080">;
            </font><font color="#800000">3   </font><font color="#000080">: </font>DriveType <font color="#000080">:= </font><font color="#800000">'SD 8&quot;'</font><font color="#000080">; </font><font color="#008000"><i>{ a relic from CP/M roots   }
            </i></font><font color="#800000">4   </font><font color="#000080">: </font>DriveType <font color="#000080">:= </font><font color="#800000">'DD 8&quot;'</font><font color="#000080">; </font><font color="#008000"><i>{   ditto                   }
            </i></font><font color="#800000">5   </font><font color="#000080">: </font>DriveType <font color="#000080">:= </font><font color="#800000">'Fixed/RAM disk'</font><font color="#000080">;    </font><font color="#008000"><i>{ HDD or RAM    }
            </i></font><font color="#800000">6   </font><font color="#000080">: </font>DriveType <font color="#000080">:= </font><font color="#800000">'Tape drive'</font><font color="#000080">;    </font><font color="#008000"><i>{ a good investment }
            </i></font><font color="#800000">7   </font><font color="#000080">: </font>DriveType <font color="#000080">:= </font><font color="#800000">'1.44 MB 3.5&quot; FDD'  </font><font color="#008000"><i>{ or &quot;other&quot; drv }
            </i></font><font color="#FF0000"><b>else  </b></font>DriveType <font color="#000080">:= </font><font color="#800000">'???'</font><font color="#000080">;   </font><font color="#008000"><i>{ anything else             }
            </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{ Case }
        </i></font>WriteLn<font color="#000080">(</font><font color="#800000">' - '</font><font color="#000080">, </font>CHR<font color="#000080">(</font>ThisDrive<font color="#000080">+</font><font color="#800000">64</font><font color="#000080">),</font><font color="#800000">': ('</font><font color="#000080">, </font>DriveType<font color="#000080">, </font><font color="#800000">')' </font><font color="#000080">);
        </font><font color="#008000"><i>{ further code could ID between RAM drive &amp; HDD             }
        </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{ For }
 </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">. </font><font color="#008000"><i>{ Program }
(********************************************************************)
</i></font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to DRIVES SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0005.PAS">Original</a><b>]</b></p></body>
</html>
