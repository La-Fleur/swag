<html>
<head><title> "HD Test" by STUART KIRSCHENBAUM</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to DRIVES SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0059.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
&gt;  function GetDriveID(drive: char):byte;
&gt;  begin
&gt;    with regs do
&gt;      begin
&gt;        AH := $1C;
&gt;        DL := ord(Upcase(drive))-64;
&gt;        Intr($21,regs);
&gt;        GetDriveID := Mem[ds:bx];
&gt;      end;
&gt;  end;

&gt;This interrupt (01Ch) is supposed to return 0F8h in case of a harddisk, and
&gt;some other value if it is a floppy. However, running OS/2, this function
&gt;returns 0F0h :(( My old Apricot (it's a computer!), running DOS 3.2, also
&gt;reports 0F0h...

  0F0H is also the code for an unknown device for Service $1C.  I
  haven't tried it but have you looked at Service $44, function $08?  My
  sources tell me that this function (DOS 3.0 up) will return 0 in AX if
  the device is removable, 1 if a fixed disk, and $0F if invalid drive.

  Hang on... I'm trying it now.  It seemed to work here.  Below is the
  sample code I used (in TP 5.5).
}

</i></font><font color="#FF0000"><b>PROGRAM </b></font>HDTest<font color="#000080">;
</font><font color="#008000"><i>{Stuart Kirschenbaum 93/12/11 Donated to the Public Domain if
  the Public actually wants it :-)  }

</i></font><font color="#FF0000"><b>USES
   </b></font>DOS<font color="#000080">;

</font><font color="#FF0000"><b>VAR
  </b></font>Is_Hard_Drive <font color="#000080">: </font>boolean<font color="#000080">;

</font><font color="#FF0000"><b>FUNCTION </b></font>TestHD<font color="#000080">(</font>DriveNum <font color="#000080">: </font>byte<font color="#000080">):</font>boolean<font color="#000080">;
</font><font color="#FF0000"><b>VAR
   </b></font>Regs<font color="#000080">: </font>Registers<font color="#000080">;
</font><font color="#FF0000"><b>BEGIN
   With </b></font>Regs <font color="#FF0000"><b>DO BEGIN
      </b></font>AH <font color="#000080">:= </font><font color="#800000">$44</font><font color="#000080">;
      </font>AL <font color="#000080">:= </font><font color="#800000">$08</font><font color="#000080">;
      </font>BL <font color="#000080">:= </font>DriveNum<font color="#000080">;
      </font>Intr<font color="#000080">(</font><font color="#800000">$21</font><font color="#000080">, </font>Regs<font color="#000080">);
      </font><font color="#FF0000"><b>IF </b></font>AX <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>THEN </b></font>TestHD <font color="#000080">:= </font>false
      <font color="#FF0000"><b>ELSE IF </b></font>AX <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>THEN </b></font>TestHD <font color="#000080">:= </font>true<font color="#000080">;  </font><font color="#008000"><i>{Note we really should test
                                            for invalid drive but this
                                            is just an example &lt;g&gt; }
   </i></font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>BEGIN </b></font><font color="#008000"><i>{Main for testing program}

   </i></font>Is_Hard_Drive <font color="#000080">:= </font>TestHD<font color="#000080">(</font><font color="#800000">3</font><font color="#000080">); </font><font color="#008000"><i>{3 = Drive C a Hard Drive on my system}
   </i></font><font color="#FF0000"><b>IF </b></font>Is_Hard_Drive <font color="#FF0000"><b>THEN
      </b></font>writeln<font color="#000080">(</font><font color="#800000">'Well that seemed to work fine... Let''s try a floppy'</font><font color="#000080">)
   </font><font color="#FF0000"><b>ELSE
      </b></font>writeln<font color="#000080">(</font><font color="#800000">'That didn''t work right... Damn.'</font><font color="#000080">);
   </font>Is_Hard_Drive <font color="#000080">:= </font>TestHD<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">); </font><font color="#008000"><i>{1 = Drive A, a floppy drive}
   </i></font><font color="#FF0000"><b>IF </b></font>Is_Hard_Drive <font color="#FF0000"><b>THEN
      </b></font>writeln<font color="#000080">(</font><font color="#800000">'You should never see this message'</font><font color="#000080">)
   </font><font color="#FF0000"><b>ELSE
      </b></font>writeln<font color="#000080">(</font><font color="#800000">'Success'</font><font color="#000080">);
</font><font color="#FF0000"><b>END</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to DRIVES SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0059.PAS">Original</a><b>]</b></p></body>
</html>
