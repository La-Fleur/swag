<html>
<head><title> "EXISTDD Update" by GAYLE DAVIS</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to DRIVES SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0047.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{ Updated DRIVES.SWG on October 13, 1993 }

{ This give all the info on a bootable drive }
{ it replaces the EXIST-DD in DRIVES.SWG which DID NOT work }
{ updated by GDAVIS 10/13/93 }

</i></font><font color="#FF0000"><b>Uses
  </b></font>Crt<font color="#000080">,</font>Dos<font color="#000080">;

</font><font color="#FF0000"><b>Type
  </b></font>bootrecptr <font color="#000080">= ^</font>bootRecord<font color="#000080">;
  </font>bootRecord <font color="#000080">= </font><font color="#FF0000"><b>Record
       </b></font>nj       <font color="#000080">: </font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">2</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Byte<font color="#000080">;       </font><font color="#008000"><i>{offset  0   Near jump code   }
       </i></font>oem      <font color="#000080">: </font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">7</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Byte<font color="#000080">;       </font><font color="#008000"><i>{        3   OEM name and ver }
       </i></font>Bytesec  <font color="#000080">: </font>Word<font color="#000080">;                      </font><font color="#008000"><i>{       11   Bytes/Sector     }
       </i></font>sectclus <font color="#000080">: </font>Byte<font color="#000080">;                      </font><font color="#008000"><i>{       13   Sectors/cluster  }
       </i></font>ressect  <font color="#000080">: </font>Word<font color="#000080">;                      </font><font color="#008000"><i>{       14   Reserved sectors }
       </i></font>fattables<font color="#000080">: </font>Byte<font color="#000080">;                      </font><font color="#008000"><i>{       16   FAT tables       }
       </i></font>direntrys<font color="#000080">: </font>Word<font color="#000080">;                      </font><font color="#008000"><i>{       17   Directory entries}
       </i></font>logsec   <font color="#000080">: </font>Word<font color="#000080">;                      </font><font color="#008000"><i>{       19   Logical sectors  }
       </i></font>MDS      <font color="#000080">: </font>Byte<font color="#000080">;                      </font><font color="#008000"><i>{       21   Media descriptor }
       </i></font>FatSects <font color="#000080">: </font>Word<font color="#000080">;                      </font><font color="#008000"><i>{       22   FAT sectors      }
       </i></font>Secstrak <font color="#000080">: </font>Word<font color="#000080">;                      </font><font color="#008000"><i>{       24   Sectors/track    }
       </i></font>NumHeads <font color="#000080">: </font>Word<font color="#000080">;                      </font><font color="#008000"><i>{       26   Number of heads  }
       </i></font>HidnSecs <font color="#000080">: </font>Word<font color="#000080">;                      </font><font color="#008000"><i>{       28   Hidden sectors   }
       </i></font>bootcode <font color="#000080">: </font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">415</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Byte<font color="#000080">;     </font><font color="#008000"><i>{       30   boot code        }
       </i></font>partcode <font color="#000080">: </font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">15</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Byte<font color="#000080">;      </font><font color="#008000"><i>{      446   partition info   }
       </i></font>bootcode2<font color="#000080">: </font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">49</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Byte<font color="#000080">;      </font><font color="#008000"><i>{      462   rest of boot code}
     </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Var
  </b></font>boot <font color="#000080">: </font>bootRecord<font color="#000080">;      </font><font color="#008000"><i>{ the boot Record Variable }

  </i></font><font color="#FF0000"><b>FUNCTION </b></font>DiskRead <font color="#000080">(</font>Drive <font color="#000080">: </font>CHAR<font color="#000080">; </font>SSect<font color="#000080">, </font>NSect <font color="#000080">: </font>WORD<font color="#000080">; </font><font color="#FF0000"><b>VAR </b></font>Buffer<font color="#000080">) : </font>WORD<font color="#000080">;
    </font><font color="#008000"><i>{ Read absolute disk sectors }

  </i></font><font color="#FF0000"><b>VAR
      </b></font>kbuff  <font color="#000080">: </font><font color="#FF0000"><b>ARRAY </b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">$1f</font><font color="#000080">] </font><font color="#FF0000"><b>OF </b></font>BYTE<font color="#000080">; </font><font color="#008000"><i>{Read Ralf Brown's interrupt listing}
      </i></font>kPtr   <font color="#000080">: </font>POINTER<font color="#000080">;                </font><font color="#008000"><i>{Int 25h - ES:[BP+1E] may change    }
      </i></font>bufPtr <font color="#000080">: </font>POINTER<font color="#000080">;

  </font><font color="#FF0000"><b>BEGIN

    </b></font>kPtr   <font color="#000080">:= @</font>kbuff<font color="#000080">;
    </font>BufPtr <font color="#000080">:= @</font>buffer<font color="#000080">;

    </font><font color="#FF0000"><b>Asm
      </b></font><font color="#FF00FF">push  es
      push  bp
      push  di
      les   di, kPtr       </font><font color="#008000"><i>{ move past first 31 bytes   }
      </i></font><font color="#FF00FF">mov   al, drive      </font><font color="#008000"><i>{ Gets the passed parameter. }
      </i></font><font color="#FF00FF">AND   al, 1fh        </font><font color="#008000"><i>{ Cvt from ASCII to drive num }
      </i></font><font color="#FF00FF">DEC   al             </font><font color="#008000"><i>{ Adjust because A: is drive 0 }
      </i></font><font color="#FF00FF">mov   cx, nsect      </font><font color="#008000"><i>{ number of sectors to read }
      </i></font><font color="#FF00FF">mov   dx, ssect      </font><font color="#008000"><i>{ starting at sector.. }
      </i></font><font color="#FF00FF">push  ds
      lds   bx, bufptr      </font><font color="#008000"><i>{ Get the address of the buffer }
      </i></font><font color="#FF00FF">mov   bp, di
      push  si
      INT   25h            </font><font color="#008000"><i>{ Do the drive read. }
      </i></font><font color="#FF00FF">pop   si             </font><font color="#008000"><i>{ Remove the flags int 25h leaves on stack}
      </i></font><font color="#FF00FF">pop   si
      pop   ds
      pop   di
      pop   bp
      pop   es
      jc    @1
      mov   @result, 0       </font><font color="#008000"><i>{ No errors, so set Function to zero }
      </i></font><font color="#FF00FF">jmp   @Escape
      @1 :
      mov   @result, ax

    @Escape :
    </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>bootlook<font color="#000080">(</font>Drive <font color="#000080">: </font>Char<font color="#000080">);
</font><font color="#FF0000"><b>Var
  </b></font>ReadResult <font color="#000080">: </font>WORD<font color="#000080">;
  </font>I          <font color="#000080">: </font>Integer<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font><font color="#008000"><i>{ Get diskette info }
  </i></font>ReadResult <font color="#000080">:= </font>DiskRead<font color="#000080">(</font>Drive<font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font>boot<font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font>ReadResult <font color="#000080">&lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then
  begin
  </b></font><font color="#008000"><i>{ Error code here , there are LOTS of them.. see a good DOS book
    most common will be :
    2 = Drive NOT ready
    7 = unknown media .. not a boot disk
    8 = sector not found .. not a boot disk }
  </i></font>Writeln<font color="#000080">(</font>LO<font color="#000080">(</font>ReadResult<font color="#000080">));
  </font><font color="#FF0000"><b>end
  else
  begin
  WITH </b></font>Boot <font color="#FF0000"><b>DO
  BEGIN
  </b></font><font color="#008000"><i>{ I'll just print a few of the possible items }
  </i></font>Write<font color="#000080">(</font><font color="#800000">'OEM         :  '</font><font color="#000080">);
  </font><font color="#FF0000"><b>FOR </b></font>I <font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>TO </b></font><font color="#800000">7 </font><font color="#FF0000"><b>DO </b></font>WRITE<font color="#000080">(</font>CHR<font color="#000080">(</font>OEM<font color="#000080">[</font>i<font color="#000080">]));
  </font>Writeln<font color="#000080">;
  </font>WriteLn<font color="#000080">(</font><font color="#800000">'Dir Entrys  : '</font><font color="#000080">,</font>DirEntrys <font color="#000080">: </font><font color="#800000">4</font><font color="#000080">);
  </font>WriteLn<font color="#000080">(</font><font color="#800000">'Fat Tables  : '</font><font color="#000080">,</font>FatTables <font color="#000080">: </font><font color="#800000">4</font><font color="#000080">);
  </font>WriteLn<font color="#000080">(</font><font color="#800000">'Num Heads   : '</font><font color="#000080">,</font>NumHeads <font color="#000080">: </font><font color="#800000">4</font><font color="#000080">);
  </font>WriteLn<font color="#000080">(</font><font color="#800000">'Secs p/Trk  : '</font><font color="#000080">,</font>SecsTrak <font color="#000080">: </font><font color="#800000">4</font><font color="#000080">);
  </font>WriteLn<font color="#000080">(</font><font color="#800000">'Hidden Secs : '</font><font color="#000080">,</font>HidnSecs <font color="#000080">: </font><font color="#800000">4</font><font color="#000080">);
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>end</b></font><font color="#000080">;  </font><font color="#008000"><i>{ Procedure bootlook }

</i></font><font color="#FF0000"><b>BEGIN
</b></font>ClrScr<font color="#000080">;
</font>BootLook<font color="#000080">(</font><font color="#800000">'B'</font><font color="#000080">);  </font><font color="#008000"><i>{ if drive isn't bootable, you'll get an error (7) }
</i></font>Readkey<font color="#000080">;        </font><font color="#008000"><i>{ try it, this is a safe procedure                 }
</i></font><font color="#FF0000"><b>END</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to DRIVES SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0047.PAS">Original</a><b>]</b></p></body>
</html>
