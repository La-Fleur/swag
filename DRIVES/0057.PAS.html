<html>
<head><title> "Disk Ready Function" by PHIL NICKELL</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to DRIVES SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0057.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
From: PHIL NICKELL
Subj: Disk Ready Function

 Here are a couple of ways that are about equivalent.  Which you use
 depends on the info you might want about the drive.  These calls
 actually spin up the disk and get info from the boot sector or the fat
 table, so they also incidentally check if the disk is ready and ok.
 Unfortunately, DOS doesn't really have a reasonable way to tell you if
 the disk is ready without it actually spinning up the drive.
}
  </i></font><font color="#FF0000"><b>var </b></font>r<font color="#000080">:</font>registers<font color="#000080">;

    </font>Get Allocation Table Info
  <font color="#000080">...</font><font color="#FF0000"><b>on </b></font>entry
         r<font color="#000080">.</font>ah <font color="#000080">:= </font><font color="#800000">$1c</font>h<font color="#000080">;
         </font>r<font color="#000080">.</font>dl <font color="#000080">:= </font>drivenum<font color="#000080">;  </font><font color="#008000"><i>{ 0=default, 1=A, 2=B etc}
         </i></font>msdos<font color="#000080">(</font>r<font color="#000080">);
  ...</font><font color="#FF0000"><b>on </b></font>return
         r<font color="#000080">.</font>al <font color="#000080">= </font>sectors per cluster
         r<font color="#000080">.</font>cx <font color="#000080">= </font>bytes per physical sector
         r<font color="#000080">.</font>dx <font color="#000080">= </font>clusters per disk
         ds<font color="#000080">:</font>bx <font color="#000080">= </font>pointer <font color="#FF0000"><b>to </b></font>media descriptor byte

     Get Free Disk Space Info
  <font color="#000080">...</font><font color="#FF0000"><b>on </b></font>entry
         r<font color="#000080">.</font>ah <font color="#000080">:= </font><font color="#800000">$36</font><font color="#000080">;
         </font>r<font color="#000080">.</font>dl <font color="#000080">:= </font>drivenum<font color="#000080">;  </font><font color="#008000"><i>{ 0=default, 1=A, 2=B etc}
         </i></font>msdos<font color="#000080">(</font>r<font color="#000080">);
  ...</font><font color="#FF0000"><b>on </b></font>return
         r<font color="#000080">.</font>ax <font color="#000080">= </font>sectors per cluster <font color="#000080">/</font><font color="#FF0000"><b>or</b></font><font color="#000080">/
              = </font><font color="#800000">$ffff </font><font color="#FF0000"><b>if </b></font>error<font color="#000080">.
         </font>r<font color="#000080">.</font>bx <font color="#000080">= </font>number <font color="#FF0000"><b>of </b></font>available clusters
         r<font color="#000080">.</font>cx <font color="#000080">= </font>bytes per sector
           dx <font color="#000080">= </font>clusters <font color="#FF0000"><b>on </b></font>the drive


</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to DRIVES SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0057.PAS">Original</a><b>]</b></p></body>
</html>
