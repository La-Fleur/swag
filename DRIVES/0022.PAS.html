<html>
<head><title> "Yet Another Volume Label" by SWAG SUPPORT TEAM</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to DRIVES SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0022.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
&gt;I am having difficulty changing a disk volume Label using Turbo Pascal.
&gt;Does anyone know how to acComplish this?
}
</i></font><font color="#FF0000"><b>Uses
  </b></font>Dos<font color="#000080">;

</font><font color="#FF0000"><b>Type </b></font>fcbType <font color="#000080">= </font><font color="#FF0000"><b>Record
                 </b></font>drive   <font color="#000080">: </font>Byte<font color="#000080">;
                 </font>name    <font color="#000080">: </font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">8</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Char<font color="#000080">;
                 </font>ext     <font color="#000080">: </font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">3</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Char<font color="#000080">;
                 </font>fpos    <font color="#000080">: </font>Word<font color="#000080">;
                 </font>recsize <font color="#000080">: </font>Word<font color="#000080">;
                 </font>fsize   <font color="#000080">: </font>LongInt<font color="#000080">;
                 </font>fdate   <font color="#000080">: </font>Word<font color="#000080">;
                 </font>ftime   <font color="#000080">: </font>Word<font color="#000080">;
                 </font>reserv  <font color="#000080">: </font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">8</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Byte<font color="#000080">;
                 </font>currec  <font color="#000080">: </font>Byte<font color="#000080">;
                 </font>relrec  <font color="#000080">: </font>LongInt<font color="#000080">;
               </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
     </font>extfcb <font color="#000080">=  </font><font color="#FF0000"><b>Record
                 </b></font>flag    <font color="#000080">: </font>Byte<font color="#000080">;                  </font><font color="#008000"><i>{ must be $ff! }
                 </i></font>reserv  <font color="#000080">: </font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">5</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Byte<font color="#000080">;
                 </font>attrib  <font color="#000080">: </font>Byte<font color="#000080">;
                 </font>fcb     <font color="#000080">: </font>fcbType<font color="#000080">;
               </font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>Function </b></font>GetVolLabel<font color="#000080">(</font>drive<font color="#000080">:</font>Char<font color="#000080">):</font><font color="#FF0000"><b>String</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Var </b></font>sr <font color="#000080">: </font>SearchRec<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>findfirst<font color="#000080">(</font>drive<font color="#000080">+</font><font color="#800000">':\*.*'</font><font color="#000080">,</font>VolumeID<font color="#000080">,</font>sr<font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font>Doserror<font color="#000080">=</font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>GetVolLabel<font color="#000080">:=</font>sr<font color="#000080">.</font>name
  <font color="#FF0000"><b>else </b></font>GetVolLabel<font color="#000080">:=</font><font color="#800000">''</font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>Procedure </b></font>setfcbname<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>fcb<font color="#000080">:</font>fcbType<font color="#000080">; </font>name<font color="#000080">:</font><font color="#FF0000"><b>String</b></font><font color="#000080">);
</font><font color="#FF0000"><b>Var </b></font>p <font color="#000080">: </font>Byte<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>p<font color="#000080">:=</font>pos<font color="#000080">(</font><font color="#800000">'.'</font><font color="#000080">,</font>name<font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font>p<font color="#000080">=</font><font color="#800000">0 </font><font color="#FF0000"><b>then begin
    </b></font>p<font color="#000080">:=</font>length<font color="#000080">(</font>name<font color="#000080">)+</font><font color="#800000">1</font><font color="#000080">;
    </font>name<font color="#000080">:=</font>name<font color="#000080">+</font><font color="#800000">'.'</font><font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>fillChar<font color="#000080">(</font>fcb<font color="#000080">.</font>name<font color="#000080">,</font><font color="#800000">11</font><font color="#000080">,</font><font color="#800000">' '</font><font color="#000080">);
  </font>move<font color="#000080">(</font>name<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">],</font>fcb<font color="#000080">.</font>name<font color="#000080">,</font>p<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">);
  </font>move<font color="#000080">(</font>name<font color="#000080">[</font>p<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">],</font>fcb<font color="#000080">.</font>ext<font color="#000080">,</font>length<font color="#000080">(</font>name<font color="#000080">)-</font>p<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>Procedure </b></font>SetVolLabel<font color="#000080">(</font>drive<font color="#000080">:</font>Char<font color="#000080">; </font>vLabel<font color="#000080">:</font><font color="#FF0000"><b>String</b></font><font color="#000080">);
</font><font color="#FF0000"><b>Var </b></font>fcb  <font color="#000080">: </font>extfcb<font color="#000080">;
    </font>vl   <font color="#000080">: </font>PathStr<font color="#000080">;
    </font>regs <font color="#000080">: </font>Registers<font color="#000080">;
    </font>f    <font color="#000080">: </font><font color="#FF0000"><b>File</b></font><font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>vl<font color="#000080">:=</font>GetVolLabel<font color="#000080">(</font>drive<font color="#000080">);
  </font>fcb<font color="#000080">.</font>flag<font color="#000080">:=</font><font color="#800000">$ff</font><font color="#000080">;
  </font>fcb<font color="#000080">.</font>attrib<font color="#000080">:=</font>VolumeID<font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font>vl<font color="#000080">&lt;&gt;</font><font color="#800000">'' </font><font color="#FF0000"><b>then begin
    </b></font>setfcbname<font color="#000080">(</font>fcb<font color="#000080">.</font>fcb<font color="#000080">,</font>vl<font color="#000080">);
    </font>fcb<font color="#000080">.</font>fcb<font color="#000080">.</font>drive<font color="#000080">:=</font>ord<font color="#000080">(</font>UpCase<font color="#000080">(</font>drive<font color="#000080">))-</font><font color="#800000">64</font><font color="#000080">;
    </font>regs<font color="#000080">.</font>ah<font color="#000080">:=</font><font color="#800000">$13</font><font color="#000080">;                </font><font color="#008000"><i>{ Delete File }
    </i></font>regs<font color="#000080">.</font>ds<font color="#000080">:=</font>seg<font color="#000080">(</font>fcb<font color="#000080">);
    </font>regs<font color="#000080">.</font>dx<font color="#000080">:=</font>ofs<font color="#000080">(</font>fcb<font color="#000080">);
    </font>msDos<font color="#000080">(</font>regs<font color="#000080">);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font>vLabel<font color="#000080">&lt;&gt;</font><font color="#800000">'' </font><font color="#FF0000"><b>then begin
    </b></font>fcb<font color="#000080">.</font>fcb<font color="#000080">.</font>drive<font color="#000080">:=</font>ord<font color="#000080">(</font>UpCase<font color="#000080">(</font>drive<font color="#000080">))-</font><font color="#800000">64</font><font color="#000080">;
    </font>setfcbname<font color="#000080">(</font>fcb<font color="#000080">.</font>fcb<font color="#000080">,</font>vLabel<font color="#000080">);
    </font><font color="#FF0000"><b>With </b></font>regs <font color="#FF0000"><b>do begin
      </b></font>ah<font color="#000080">:=</font><font color="#800000">$16</font><font color="#000080">;                  </font><font color="#008000"><i>{ Create File }
      </i></font>ds<font color="#000080">:=</font>seg<font color="#000080">(</font>fcb<font color="#000080">);
      </font>dx<font color="#000080">:=</font>ofs<font color="#000080">(</font>fcb<font color="#000080">);
      </font>msDos<font color="#000080">(</font>regs<font color="#000080">);
      </font>ah<font color="#000080">:=</font><font color="#800000">$10</font><font color="#000080">;                  </font><font color="#008000"><i>{ Close File }
      </i></font>ds<font color="#000080">:=</font>seg<font color="#000080">(</font>fcb<font color="#000080">);
      </font>dx<font color="#000080">:=</font>ofs<font color="#000080">(</font>fcb<font color="#000080">);
      </font>msDos<font color="#000080">(</font>regs<font color="#000080">);
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to DRIVES SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0022.PAS">Original</a><b>]</b></p></body>
</html>
