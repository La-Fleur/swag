<html>
<head><title> "DOS Files Info" by SWAG SUPPORT TEAM</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to DRIVES SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0063.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#FF0000"><b>unit </b></font>FileInfo<font color="#000080">;
</font><font color="#008000"><i>(* FILEINFO scans DOS' &quot;list of lists&quot; to retrieve valuable file information.
   It does this by calling undocumented MSDOS call 52h.  It should be noted
   that this only works for DOS versions 2.0 and higher.  No error checking
   for this is performed.
*)
</i></font><font color="#FF0000"><b>interface
uses
  </b></font>dos<font color="#000080">;
</font><font color="#FF0000"><b>type
  </b></font>FileTblPtr     <font color="#000080">= ^</font>FileTables<font color="#000080">;
  </font>FileTables     <font color="#000080">= </font><font color="#FF0000"><b>record
    </b></font>Next<font color="#000080">:               </font>FileTblPtr<font color="#000080">;
    </font>NumFiles<font color="#000080">:           </font>word<font color="#000080">;
    </font>NumHandles<font color="#000080">:         </font>byte<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;  </font><font color="#008000"><i>{ FileTables }
  </i></font>ListofListsRec <font color="#000080">= </font><font color="#FF0000"><b>record
    </b></font>DOSDriveParamBlock<font color="#000080">: </font>pointer<font color="#000080">;
    </font>DOSFileTbl<font color="#000080">:         </font>FileTblPtr<font color="#000080">;
    </font>ClockDevice<font color="#000080">:        </font>pointer<font color="#000080">;
    </font>ConDevice<font color="#000080">:          </font>pointer<font color="#000080">;
    </font>MaxBytes<font color="#000080">:           </font>word<font color="#000080">;
    </font>DiskBuffer<font color="#000080">:         </font>pointer<font color="#000080">;
    </font>SubDirectory<font color="#000080">:       </font>pointer<font color="#000080">;
    </font>FCBTable<font color="#000080">:           </font>pointer<font color="#000080">;
    </font>FCBsProtected<font color="#000080">:      </font>word<font color="#000080">;
    </font>NumBlocks<font color="#000080">:          </font>byte<font color="#000080">;
    </font>LastDrive<font color="#000080">:          </font>byte<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;  </font><font color="#008000"><i>{ ListofLists }
  </i></font>DOSFilesObj <font color="#000080">= </font><font color="#FF0000"><b>object
    </b></font>ListOfLists <font color="#000080">: ^</font>ListofListsRec<font color="#000080">;
    </font><font color="#FF0000"><b>constructor </b></font>Init<font color="#000080">;
    </font><font color="#FF0000"><b>function    </b></font>LastDrive   <font color="#000080">: </font>char<font color="#000080">;
    </font><font color="#FF0000"><b>function    </b></font>FilesUsed   <font color="#000080">: </font>integer<font color="#000080">;
    </font><font color="#FF0000"><b>function    </b></font>ConfigFiles <font color="#000080">: </font>integer<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;  </font><font color="#008000"><i>{ ConfigObj }

</i></font><font color="#FF0000"><b>implementation

constructor </b></font>DOSFilesObj<font color="#000080">.</font>Init<font color="#000080">;
</font><font color="#FF0000"><b>var
  </b></font>regs<font color="#000080">:   </font>registers<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>regs<font color="#000080">.</font>ah <font color="#000080">:= </font><font color="#800000">$52</font><font color="#000080">;
  </font>MsDos<font color="#000080">(</font>regs<font color="#000080">);       </font><font color="#008000"><i>{ call undocumented function 52h                    }
                     { returns pointer to list of lists @Regs.ES,Regs.BX }
  </i></font>ListofLists <font color="#000080">:= </font>Ptr<font color="#000080">(</font>regs<font color="#000080">.</font>ES<font color="#000080">,</font>regs<font color="#000080">.</font>BX<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;  </font><font color="#008000"><i>{ DOSFilesObj.Init }

</i></font><font color="#FF0000"><b>function </b></font>DOSFilesObj<font color="#000080">.</font>LastDrive <font color="#000080">: </font>char<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>LastDrive   <font color="#000080">:= </font>Char<font color="#000080">(</font>ListofLists<font color="#000080">^.</font>LastDrive<font color="#000080">+</font><font color="#800000">64</font><font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;  </font><font color="#008000"><i>{ DOSFilesObj.LastDrive }

</i></font><font color="#FF0000"><b>function </b></font>DOSFilesObj<font color="#000080">.</font>FilesUsed <font color="#000080">: </font>integer<font color="#000080">;
</font><font color="#FF0000"><b>var
  </b></font>n<font color="#000080">:   </font>integer<font color="#000080">;
  </font>p<font color="#000080">:   </font>FileTblPtr<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>n <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font>p <font color="#000080">:= </font>ListOfLists<font color="#000080">^.</font>DOSFileTbl<font color="#000080">;
  </font><font color="#FF0000"><b>while </b></font>ofs<font color="#000080">(</font>p<font color="#000080">^)&lt;&gt;</font><font color="#800000">$FFFF </font><font color="#FF0000"><b>do
  begin
    </b></font>inc<font color="#000080">(</font>n<font color="#000080">,</font>p<font color="#000080">^.</font>NumHandles<font color="#000080">);
    </font>p <font color="#000080">:= </font>p<font color="#000080">^.</font>Next<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;  </font><font color="#008000"><i>{ while }
  </i></font>FilesUsed <font color="#000080">:= </font>n<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;  </font><font color="#008000"><i>{ DOSFilesObj.FilesUsed }

</i></font><font color="#FF0000"><b>function </b></font>DOSFilesObj<font color="#000080">.</font>ConfigFiles <font color="#000080">: </font>integer<font color="#000080">;
</font><font color="#FF0000"><b>var
  </b></font>n<font color="#000080">:   </font>integer<font color="#000080">;
  </font>p<font color="#000080">:   </font>FileTblPtr<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>n <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font>p <font color="#000080">:= </font>ListOfLists<font color="#000080">^.</font>DOSFileTbl<font color="#000080">;
  </font><font color="#FF0000"><b>while </b></font>ofs<font color="#000080">(</font>p<font color="#000080">^)&lt;&gt;</font><font color="#800000">$FFFF </font><font color="#FF0000"><b>do
  begin
    </b></font>inc<font color="#000080">(</font>n<font color="#000080">,</font>p<font color="#000080">^.</font>NumFiles<font color="#000080">);
    </font>p <font color="#000080">:= </font>p<font color="#000080">^.</font>Next<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;  </font><font color="#008000"><i>{ while }
  </i></font>ConfigFiles <font color="#000080">:= </font>n<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;  </font><font color="#008000"><i>{ DOSFilesObj.ConfigFiles }

</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">.  </font><font color="#008000"><i>{ FileInfo }

{--------------     DEMO ------------------ }

</i></font><font color="#FF0000"><b>program </b></font>filetest<font color="#000080">;
</font><font color="#FF0000"><b>uses </b></font>fileinfo<font color="#000080">;
</font><font color="#FF0000"><b>var
  </b></font>DOSFiles <font color="#000080">: </font>DOSFilesObj<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>DOSFiles<font color="#000080">.</font>Init<font color="#000080">;
  </font>Writeln<font color="#000080">(</font><font color="#800000">'LASTDRIVE='</font><font color="#000080">,</font>DOSFiles<font color="#000080">.</font>LastDrive<font color="#000080">);
  </font>Writeln<font color="#000080">(</font><font color="#800000">'DOS FILES USED='</font><font color="#000080">,</font>DOSFiles<font color="#000080">.</font>FilesUsed<font color="#000080">);
  </font>Writeln<font color="#000080">(</font><font color="#800000">'DOS FILES='</font><font color="#000080">,</font>DOSFiles<font color="#000080">.</font>ConfigFiles<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">.  </font><font color="#008000"><i>{ FileInfo }</i></font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to DRIVES SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0063.PAS">Original</a><b>]</b></p></body>
</html>
