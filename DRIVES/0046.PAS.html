<html>
<head><title> "Is DISK Ready ??" by BRAIN PAPE</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to DRIVES SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0046.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{===========================================================================
Date: 10-03-93 (00:14)
From: BRIAN PAPE
Subj: disk ready
---------------------------------------------------------------------------
Does anyone know if there is any better (and FASTER!) way to tell if a
disk drive is ready?  I wrote a function yesterday to do that by calling
the BIOS Read Track interrupt.  The only problem is that it has to
actually read from the disk, and it is rather slow, especially on slower
computers.

Here is my code: }

{ NOTE :

          Added a BOOLEAN function and added Reset DRIVE  GDAVIS 10/15/93}

</i></font><font color="#FF0000"><b>USES </b></font>CRT<font color="#000080">;

</font><font color="#FF0000"><b>VAR
   </b></font>Buf <font color="#000080">: </font><font color="#FF0000"><b>ARRAY</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">512</font><font color="#000080">] </font><font color="#FF0000"><b>OF </b></font>BYTE<font color="#000080">;  </font><font color="#008000"><i>{ Buffer MUST be outside }

</i></font><font color="#FF0000"><b>function </b></font>diskstatus<font color="#000080">(</font>drive<font color="#000080">:</font>byte<font color="#000080">):</font>byte<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;  </font><font color="#008000"><i>{ drive is A=0, B=1 etc}
</i></font><font color="#FF0000"><b>asm
  </b></font><font color="#FF00FF">cmp  drive,26
  jb   @driveok
  mov  drive,0   </font><font color="#008000"><i>{ if drive isn't between 0 and 25, make it 0 (for A:) }
  </i></font><font color="#FF00FF">@driveok:

  mov  ax, seg buf
  mov  es, ax
  mov  bx, offset buf

  mov  ah, 02      </font><font color="#008000"><i>{ read disk sectors }
  </i></font><font color="#FF00FF">mov  al, 1       </font><font color="#008000"><i>{ number of sectors to transfer }
  </i></font><font color="#FF00FF">mov  ch, 1       </font><font color="#008000"><i>{ track number }
  </i></font><font color="#FF00FF">mov  cl, 1       </font><font color="#008000"><i>{ sector number }
  </i></font><font color="#FF00FF">mov  dh, 1       </font><font color="#008000"><i>{ head number }
  </i></font><font color="#FF00FF">mov  dl, drive   </font><font color="#008000"><i>{ drive number (0=A, 3=C, or 80h=C, 81h=D) }
  </i></font><font color="#FF00FF">int  13h

  mov  bl,0    </font><font color="#008000"><i>{ assume drive is ready }
  </i></font><font color="#FF00FF">jnc  @done   </font><font color="#008000"><i>{ carry set if unsuccessfull (i.e. disk is not ready) }
  </i></font><font color="#FF00FF">mov  bl,ah
  jmp  @done

  </font><font color="#008000"><i>{ take out the above two lines to make this just check
    for disk ready/not ready }

  </i></font><font color="#FF00FF">and  ah,$80
  jz   @done   </font><font color="#008000"><i>{ error was something other than disk not ready }
  </i></font><font color="#FF00FF">mov  bl,false</font><font color="#008000"><i>{ disk wasn't ready. store result }
  </i></font><font color="#FF00FF">@done:

  mov  ax,$0000  </font><font color="#008000"><i>{ reset drive }
  </i></font><font color="#FF00FF">INT  13H

  xor  ax,ax   </font><font color="#008000"><i>{ shut off disk drive quickly }
  </i></font><font color="#FF00FF">mov  es,ax
  mov  ax,440h
  mov  di,ax
  mov  byte ptr es:[di],01h

  mov  al,bl   </font><font color="#008000"><i>{ retrieve result }
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;  </font><font color="#008000"><i>{ diskstatus }


</i></font><font color="#FF0000"><b>function </b></font>diskready<font color="#000080">(</font>drive<font color="#000080">:</font>CHAR<font color="#000080">):</font>BOOLEAN<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>asm
  </b></font><font color="#FF00FF">cmp  drive,'a'
  jb   @isupcase  </font><font color="#008000"><i>{ make it UPPER case }
  </i></font><font color="#FF00FF">sub  drive,20H
  @isupcase:
  cmp  drive,'Z'
  jb   @driveok
  mov  drive,'A'  </font><font color="#008000"><i>{ if drive isn't between 'A' and 'Z', make it A) }
  </i></font><font color="#FF00FF">@driveok:
  mov  ax, seg buf
  mov  es, ax
  mov  bx, offset buf

  mov  ah, 02  </font><font color="#008000"><i>{ read disk sectors }
  </i></font><font color="#FF00FF">mov  al, 1   </font><font color="#008000"><i>{ number of sectors to transfer }
  </i></font><font color="#FF00FF">mov  ch, 1   </font><font color="#008000"><i>{ track number }
  </i></font><font color="#FF00FF">mov  cl, 1   </font><font color="#008000"><i>{ sector number }
  </i></font><font color="#FF00FF">mov  dh, 1   </font><font color="#008000"><i>{ head number }

  </i></font><font color="#FF00FF">mov        dl, drive
  sub        dl, 'A'     </font><font color="#008000"><i>{ subtract ORD of 'A' }

  {mov  dl, drive   { drive number (0=A, 3=C, or 80h=C, 81h=D) }
  </i></font><font color="#FF00FF">int  13h

  mov  bl,true </font><font color="#008000"><i>{ assume drive is ready }
  </i></font><font color="#FF00FF">and  ah,$80
  jz   @done   </font><font color="#008000"><i>{ error was something other than disk not ready }
  </i></font><font color="#FF00FF">mov  bl,false</font><font color="#008000"><i>{ disk wasn't ready. store result }
  </i></font><font color="#FF00FF">@done:

  mov  ax,$0000  </font><font color="#008000"><i>{ reset drive }
  </i></font><font color="#FF00FF">INT  13H

  xor  ax,ax   </font><font color="#008000"><i>{ shut off disk drive quickly }
  </i></font><font color="#FF00FF">mov  es,ax
  mov  ax,440h
  mov  di,ax
  mov  byte ptr es:[di],01h

  mov  al,bl   </font><font color="#008000"><i>{ retrieve result }
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;  </font><font color="#008000"><i>{ diskready }

</i></font><font color="#FF0000"><b>BEGIN
</b></font>ClrScr<font color="#000080">;
</font>WriteLn<font color="#000080">(</font>DiskStatus<font color="#000080">(</font><font color="#800000">0</font><font color="#000080">));
</font>WriteLn<font color="#000080">(</font>DiskReady<font color="#000080">(</font><font color="#800000">'a'</font><font color="#000080">));  </font><font color="#008000"><i>{ case ain't significant }
</i></font>readkey<font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">.</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to DRIVES SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0046.PAS">Original</a><b>]</b></p></body>
</html>
