<html>
<head><title> "CD-ROM driver (BP7)" by MENNO VICTOR VAN DER STAR</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to DRIVES SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0118.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#FF0000"><b>Unit </b></font>CD<font color="#000080">;

</font><font color="#008000"><i>{----------------------------------------------------------------------------}

{  CD : An implementation of a CD-ROM driver.                                }

{****************************************************************************}

{  Author            : Menno Victor van der star                             }

{  E-Mail            : s795238@dutiwy.twi.tudelft.nl                         }

{  Developed on      : 08-06-'95                                             }

{  Last update on    : 07-09-'95                                             }

{  Status            : Finished                                              }

{  Future extensions : None                                                  }

{----------------------------------------------------------------------------}

{$R-}

</i></font><font color="#FF0000"><b>Interface



Uses </b></font>Dos<font color="#000080">;



</font><font color="#FF0000"><b>Type

  </b></font>CDRomParametersRecord <font color="#000080">= </font><font color="#FF0000"><b>Record

                            </b></font>Raw <font color="#000080">: </font>Boolean<font color="#000080">;

                            </font>SectorSize <font color="#000080">: </font>Word<font color="#000080">;

                            </font>NumberOfSectors <font color="#000080">: </font>LongInt<font color="#000080">;

                          </font><font color="#FF0000"><b>End</b></font><font color="#000080">;



  </font>CDRomPositionInfo <font color="#000080">= </font><font color="#FF0000"><b>Record

                        </b></font>CntAdr <font color="#000080">: </font>Byte<font color="#000080">;

                        </font>CTrk   <font color="#000080">: </font>Byte<font color="#000080">;

                        </font>Cindx  <font color="#000080">: </font>Byte<font color="#000080">;

                        </font>CMin   <font color="#000080">: </font>Byte<font color="#000080">;

                        </font>CSek   <font color="#000080">: </font>Byte<font color="#000080">;

                        </font>CFrm   <font color="#000080">: </font>Byte<font color="#000080">;

                        </font>Czero  <font color="#000080">: </font>Byte<font color="#000080">;

                        </font>CAmin  <font color="#000080">: </font>Byte<font color="#000080">;

                        </font>CAsec  <font color="#000080">: </font>Byte<font color="#000080">;

                        </font>CAFrm  <font color="#000080">: </font>Byte<font color="#000080">;

                      </font><font color="#FF0000"><b>End</b></font><font color="#000080">;



  </font>CDRom <font color="#000080">= </font><font color="#FF0000"><b>Object



            </b></font>ValidCDRoms <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;

            </font>Error <font color="#000080">: </font>Word<font color="#000080">;

            </font>CDRomDevice <font color="#000080">: </font>Text<font color="#000080">;



            </font><font color="#FF0000"><b>Constructor </b></font>Init<font color="#000080">;

            </font><font color="#FF0000"><b>Destructor  </b></font>Done<font color="#000080">; </font><font color="#FF0000"><b>Virtual</b></font><font color="#000080">;



            </font><font color="#FF0000"><b>Procedure   </b></font>ChangeDrive <font color="#000080">(</font>DriveLetter <font color="#000080">: </font>Char<font color="#000080">);

            </font><font color="#FF0000"><b>Procedure   </b></font>OpenDoor<font color="#000080">;

            </font><font color="#FF0000"><b>Procedure   </b></font>CloseDoor<font color="#000080">;

            </font><font color="#FF0000"><b>Procedure   </b></font>LockDoor<font color="#000080">;

            </font><font color="#FF0000"><b>Procedure   </b></font>UnlockDoor<font color="#000080">;

            </font><font color="#FF0000"><b>Procedure   </b></font>Reset<font color="#000080">;

            </font><font color="#FF0000"><b>Function    </b></font>DriveStatus <font color="#000080">: </font>Word<font color="#000080">;

            </font><font color="#FF0000"><b>Procedure   </b></font>GetDriveParameters <font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>Parameters <font color="#000080">: </font>CDRomParametersRecord<font color="#000080">);

            </font><font color="#FF0000"><b>Procedure   </b></font>GetPosition <font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>Position <font color="#000080">: </font>CDRomPositionInfo<font color="#000080">);



            </font><font color="#FF0000"><b>Procedure   </b></font>PlayAudio <font color="#000080">(</font>MinuteStart<font color="#000080">, </font>SecondStart<font color="#000080">, </font>MinuteEnd<font color="#000080">, </font>SecondEnd <font color="#000080">: </font>Byte<font color="#000080">);

            </font><font color="#FF0000"><b>Procedure   </b></font>PlayTrack <font color="#000080">(</font>TrackNr <font color="#000080">: </font>Byte<font color="#000080">);

            </font><font color="#FF0000"><b>Procedure   </b></font>PausePlay<font color="#000080">;

            </font><font color="#FF0000"><b>Procedure   </b></font>ResumePlay<font color="#000080">;

            </font><font color="#FF0000"><b>Function    </b></font>NumberOfAudioTracks <font color="#000080">: </font>Byte<font color="#000080">;



          </font><font color="#FF0000"><b>Private



            </b></font>Regs <font color="#000080">: </font>Registers<font color="#000080">;

            </font>MSCDEXVerMajor<font color="#000080">, </font>MSCDEXVerMinor <font color="#000080">: </font>Byte<font color="#000080">;

            </font>NumCDRoms <font color="#000080">: </font>Byte<font color="#000080">;

            </font>DriverNames <font color="#000080">: </font><font color="#FF0000"><b>Array </b></font><font color="#000080">[</font><font color="#800000">'A'</font><font color="#000080">..</font><font color="#800000">'Z'</font><font color="#000080">] </font><font color="#FF0000"><b>Of Record

                                                </b></font>SubunitNr <font color="#000080">: </font>Byte<font color="#000080">;

                                                </font>Name <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">[</font><font color="#800000">8</font><font color="#000080">];

                                              </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

            </font>CurrentDrive <font color="#000080">: </font>Char<font color="#000080">;



            </font><font color="#FF0000"><b>Function    </b></font>DeviceCommand <font color="#000080">(</font>CommandNr<font color="#000080">, </font>DosFunction <font color="#000080">: </font>Word<font color="#000080">; </font><font color="#FF0000"><b>Var </b></font>Data<font color="#000080">) : </font>Word<font color="#000080">;

            </font><font color="#FF0000"><b>Function    </b></font>RedBookToHSG <font color="#000080">(</font>Minute<font color="#000080">, </font>Second<font color="#000080">, </font>Frame <font color="#000080">: </font>Byte<font color="#000080">) : </font>LongInt<font color="#000080">;



          </font><font color="#FF0000"><b>End</b></font><font color="#000080">;



</font><font color="#FF0000"><b>Implementation



Type

  </b></font>PCharArray <font color="#000080">= ^</font>CharArray<font color="#000080">;

  </font>CharArray <font color="#000080">= </font><font color="#FF0000"><b>Array </b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">0</font><font color="#000080">] </font><font color="#FF0000"><b>Of </b></font>Char<font color="#000080">;



</font><font color="#FF0000"><b>Constructor </b></font>CDRom<font color="#000080">.</font>Init<font color="#000080">;



</font><font color="#FF0000"><b>Var

  </b></font>n <font color="#000080">: </font>Word<font color="#000080">;

  </font>c<font color="#000080">, </font>c2 <font color="#000080">: </font>Char<font color="#000080">;

  </font>DeviceInfo <font color="#000080">: </font><font color="#FF0000"><b>Array </b></font><font color="#000080">[</font><font color="#800000">'A'</font><font color="#000080">..</font><font color="#800000">'Z'</font><font color="#000080">] </font><font color="#FF0000"><b>Of Record

                                     </b></font>SubunitNr <font color="#000080">: </font>Byte<font color="#000080">;

                                     </font>NamePtr <font color="#000080">: </font>PCharArray<font color="#000080">;

                                   </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Begin

  </b></font>Regs<font color="#000080">.</font>ax<font color="#000080">:=</font><font color="#800000">$1100</font><font color="#000080">;             </font><font color="#008000"><i>{ MSCDEX Installed? }

  </i></font>Intr <font color="#000080">(</font><font color="#800000">$2F</font><font color="#000080">,</font>Regs<font color="#000080">);

  </font><font color="#FF0000"><b>If </b></font>Regs<font color="#000080">.</font>al<font color="#000080">&lt;&gt;</font><font color="#800000">255 </font><font color="#FF0000"><b>then </b></font>Fail<font color="#000080">;  </font><font color="#008000"><i>{ MSCDEX Not installed, fail to construct }



  </i></font>Regs<font color="#000080">.</font>AX<font color="#000080">:=</font><font color="#800000">$150C</font><font color="#000080">;            </font><font color="#008000"><i>{ Get MSCDEX version }

  </i></font>Intr <font color="#000080">(</font><font color="#800000">$2F</font><font color="#000080">,</font>Regs<font color="#000080">);

  </font>MSCDEXVerMajor<font color="#000080">:=</font>Regs<font color="#000080">.</font>BH<font color="#000080">;

  </font>MSCDEXVerMinor<font color="#000080">:=</font>Regs<font color="#000080">.</font>BL<font color="#000080">;

  </font><font color="#008000"><i>{ Only work with versions 2.1 or higher }

  </i></font><font color="#FF0000"><b>If </b></font><font color="#000080">(</font>MSCDEXVerMajor<font color="#000080">&lt;</font><font color="#800000">2</font><font color="#000080">) </font><font color="#FF0000"><b>Or </b></font><font color="#000080">((</font>MSCDEXVerMajor<font color="#000080">=</font><font color="#800000">2</font><font color="#000080">) </font><font color="#FF0000"><b>And </b></font><font color="#000080">(</font>MSCDEXVerMinor <font color="#000080">&lt; </font><font color="#800000">10</font><font color="#000080">)) </font><font color="#FF0000"><b>then </b></font>Fail<font color="#000080">;



  </font>Regs<font color="#000080">.</font>AX<font color="#000080">:=</font><font color="#800000">$1500</font><font color="#000080">;             </font><font color="#008000"><i>{ get number of cdrom's }

  </i></font>Regs<font color="#000080">.</font>BX<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;

  </font>Intr <font color="#000080">(</font><font color="#800000">$2F</font><font color="#000080">,</font>Regs<font color="#000080">);

  </font>NumCDRoms<font color="#000080">:=</font>Regs<font color="#000080">.</font>BX<font color="#000080">;

  </font><font color="#FF0000"><b>If </b></font>NumCDRoms<font color="#000080">=</font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>Fail<font color="#000080">;   </font><font color="#008000"><i>{ No cdroms present, fail to construct }



  </i></font>Regs<font color="#000080">.</font>AX<font color="#000080">:=</font><font color="#800000">$150D</font><font color="#000080">;

  </font>Regs<font color="#000080">.</font>ES<font color="#000080">:=</font>Seg <font color="#000080">(</font>ValidCDRoms<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">]);

  </font>Regs<font color="#000080">.</font>BX<font color="#000080">:=</font>Ofs <font color="#000080">(</font>ValidCDRoms<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">]);

  </font>Intr <font color="#000080">(</font><font color="#800000">$2F</font><font color="#000080">,</font>Regs<font color="#000080">);

  </font>ValidCDRoms<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">]:=</font>Chr <font color="#000080">(</font>NumCDRoms<font color="#000080">);

  </font><font color="#FF0000"><b>For </b></font>n<font color="#000080">:=</font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>Length <font color="#000080">(</font>ValidCDRoms<font color="#000080">) </font><font color="#FF0000"><b>Do </b></font>ValidCDRoms<font color="#000080">[</font>n<font color="#000080">]:=</font>Chr <font color="#000080">(</font>Ord <font color="#000080">(</font>ValidCDRoms<font color="#000080">[</font>n<font color="#000080">])+</font><font color="#800000">65</font><font color="#000080">);

  </font><font color="#FF0000"><b>For </b></font>c<font color="#000080">:=</font><font color="#800000">'A' </font><font color="#FF0000"><b>to </b></font><font color="#800000">'Z' </font><font color="#FF0000"><b>Do Begin

    </b></font>DriverNames<font color="#000080">[</font>c<font color="#000080">].</font>Name<font color="#000080">:=</font><font color="#800000">''</font><font color="#000080">;

    </font>DriverNames<font color="#000080">[</font>c<font color="#000080">].</font>SubunitNr<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;

    </font>DeviceInfo<font color="#000080">[</font>c<font color="#000080">].</font>SubunitNr<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;

    </font>DeviceInfo<font color="#000080">[</font>c<font color="#000080">].</font>NamePtr<font color="#000080">:=</font><font color="#FF0000"><b>NIL</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

  </font>Regs<font color="#000080">.</font>AX<font color="#000080">:=</font><font color="#800000">$1501</font><font color="#000080">;

  </font>Regs<font color="#000080">.</font>ES<font color="#000080">:=</font>Seg <font color="#000080">(</font>DeviceInfo<font color="#000080">);

  </font>Regs<font color="#000080">.</font>BX<font color="#000080">:=</font>Ofs <font color="#000080">(</font>DeviceInfo<font color="#000080">);

  </font>Intr <font color="#000080">(</font><font color="#800000">$2f</font><font color="#000080">,</font>Regs<font color="#000080">);

  </font>c2<font color="#000080">:=</font><font color="#800000">'A'</font><font color="#000080">;

  </font><font color="#FF0000"><b>For </b></font>c<font color="#000080">:=</font><font color="#800000">'A' </font><font color="#FF0000"><b>to </b></font><font color="#800000">'Z' </font><font color="#FF0000"><b>Do Begin

    </b></font>Regs<font color="#000080">.</font>AX<font color="#000080">:=</font><font color="#800000">$150B</font><font color="#000080">;

    </font>Regs<font color="#000080">.</font>CX<font color="#000080">:=</font>Ord <font color="#000080">(</font>c<font color="#000080">)-</font><font color="#800000">65</font><font color="#000080">;

    </font>Intr <font color="#000080">(</font><font color="#800000">$2F</font><font color="#000080">,</font>Regs<font color="#000080">);

    </font><font color="#FF0000"><b>If </b></font><font color="#000080">(</font>Regs<font color="#000080">.</font>AX<font color="#000080">&gt;</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>And </b></font>Assigned <font color="#000080">(</font>DeviceInfo<font color="#000080">[</font>c2<font color="#000080">].</font>NamePtr<font color="#000080">) </font><font color="#FF0000"><b>then Begin

      </b></font>n<font color="#000080">:=</font><font color="#800000">10</font><font color="#000080">;

      </font><font color="#FF0000"><b>While </b></font><font color="#000080">(</font>n<font color="#000080">&lt;=</font><font color="#800000">17</font><font color="#000080">) </font><font color="#FF0000"><b>And </b></font><font color="#000080">(</font>DeviceInfo<font color="#000080">[</font>c2<font color="#000080">].</font>NamePtr<font color="#000080">^[</font>n<font color="#000080">]&lt;&gt;</font><font color="#800000">' '</font><font color="#000080">) </font><font color="#FF0000"><b>Do Begin

        </b></font>DriverNames<font color="#000080">[</font>c<font color="#000080">].</font>Name<font color="#000080">:=</font>DriverNames<font color="#000080">[</font>c<font color="#000080">].</font>Name<font color="#000080">+</font>DeviceInfo<font color="#000080">[</font>c2<font color="#000080">].</font>NamePtr<font color="#000080">^[</font>n<font color="#000080">];

        </font>Inc <font color="#000080">(</font>n<font color="#000080">);

      </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

      </font>DriverNames<font color="#000080">[</font>c<font color="#000080">].</font>SubunitNr<font color="#000080">:=</font>DeviceInfo<font color="#000080">[</font>c2<font color="#000080">].</font>SubunitNr<font color="#000080">;

      </font><font color="#FF0000"><b>If </b></font>c2<font color="#000080">=</font><font color="#800000">'A' </font><font color="#FF0000"><b>then </b></font>ChangeDrive <font color="#000080">(</font>c<font color="#000080">);

      </font>Inc <font color="#000080">(</font>c2<font color="#000080">);

    </font><font color="#FF0000"><b>End

  End</b></font><font color="#000080">;

  </font>Reset<font color="#000080">;

</font><font color="#FF0000"><b>End</b></font><font color="#000080">;



</font><font color="#FF0000"><b>Destructor </b></font>CDRom<font color="#000080">.</font>Done<font color="#000080">;



</font><font color="#FF0000"><b>Begin

  </b></font>Close <font color="#000080">(</font>CDRomDevice<font color="#000080">);

</font><font color="#FF0000"><b>End</b></font><font color="#000080">;



</font><font color="#FF0000"><b>Procedure </b></font>CDRom<font color="#000080">.</font>ChangeDrive <font color="#000080">(</font>DriveLetter <font color="#000080">: </font>Char<font color="#000080">);



</font><font color="#FF0000"><b>Begin

  If </b></font>DriverNames<font color="#000080">[</font>DriveLetter<font color="#000080">].</font>Name<font color="#000080">=</font><font color="#800000">'' </font><font color="#FF0000"><b>then </b></font>Exit<font color="#000080">;

  </font>Assign <font color="#000080">(</font>CDRomDevice<font color="#000080">,</font>DriverNames<font color="#000080">[</font>DriveLetter<font color="#000080">].</font>Name<font color="#000080">);

  </font>System<font color="#000080">.</font>Reset <font color="#000080">(</font>CDRomDevice<font color="#000080">);

  </font>CurrentDrive<font color="#000080">:=</font>DriveLetter<font color="#000080">;

</font><font color="#FF0000"><b>End</b></font><font color="#000080">;



</font><font color="#FF0000"><b>Procedure </b></font>CDRom<font color="#000080">.</font>OpenDoor<font color="#000080">;



</font><font color="#FF0000"><b>Var

  </b></font>Data <font color="#000080">: </font>Byte<font color="#000080">;



</font><font color="#FF0000"><b>Begin

  </b></font>Data<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;

  </font>Error<font color="#000080">:=</font>DeviceCommand <font color="#000080">(</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">$4403</font><font color="#000080">,</font>Data<font color="#000080">);

</font><font color="#FF0000"><b>End</b></font><font color="#000080">;



</font><font color="#FF0000"><b>Procedure </b></font>CDRom<font color="#000080">.</font>CloseDoor<font color="#000080">;



</font><font color="#FF0000"><b>Var

  </b></font>Data <font color="#000080">: </font>Byte<font color="#000080">;



</font><font color="#FF0000"><b>Begin

  </b></font>Data<font color="#000080">:=</font><font color="#800000">5</font><font color="#000080">;

  </font>Error<font color="#000080">:=</font>DeviceCommand <font color="#000080">(</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">$4403</font><font color="#000080">,</font>Data<font color="#000080">);

  </font>Reset<font color="#000080">;

</font><font color="#FF0000"><b>End</b></font><font color="#000080">;



</font><font color="#FF0000"><b>Procedure </b></font>CDRom<font color="#000080">.</font>LockDoor<font color="#000080">;



</font><font color="#FF0000"><b>Var

  </b></font>Data <font color="#000080">: </font>Word<font color="#000080">;



</font><font color="#FF0000"><b>Begin

  </b></font>Data<font color="#000080">:=</font><font color="#800000">$0001</font><font color="#000080">;

  </font>Error<font color="#000080">:=</font>DeviceCommand <font color="#000080">(</font><font color="#800000">2</font><font color="#000080">,</font><font color="#800000">$4403</font><font color="#000080">,</font>Data<font color="#000080">);

</font><font color="#FF0000"><b>End</b></font><font color="#000080">;



</font><font color="#FF0000"><b>Procedure </b></font>CDRom<font color="#000080">.</font>UnlockDoor<font color="#000080">;



</font><font color="#FF0000"><b>Var

  </b></font>Data <font color="#000080">: </font>Word<font color="#000080">;



</font><font color="#FF0000"><b>Begin

  </b></font>Data<font color="#000080">:=</font><font color="#800000">$0101</font><font color="#000080">;

  </font>Error<font color="#000080">:=</font>DeviceCommand <font color="#000080">(</font><font color="#800000">2</font><font color="#000080">,</font><font color="#800000">$4403</font><font color="#000080">,</font>Data<font color="#000080">);

  </font>Reset<font color="#000080">;

</font><font color="#FF0000"><b>End</b></font><font color="#000080">;



</font><font color="#FF0000"><b>Procedure </b></font>CDRom<font color="#000080">.</font>Reset<font color="#000080">;



</font><font color="#FF0000"><b>Var

  </b></font>Data <font color="#000080">: </font>Byte<font color="#000080">;



</font><font color="#FF0000"><b>Begin

  </b></font>Data<font color="#000080">:=</font><font color="#800000">2</font><font color="#000080">;

  </font>Error<font color="#000080">:=</font>DeviceCommand <font color="#000080">(</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">$4403</font><font color="#000080">,</font>Data<font color="#000080">);

</font><font color="#FF0000"><b>End</b></font><font color="#000080">;



</font><font color="#FF0000"><b>Function </b></font>CDRom<font color="#000080">.</font>DriveStatus <font color="#000080">: </font>Word<font color="#000080">;



</font><font color="#FF0000"><b>Var

  </b></font>Data <font color="#000080">: </font><font color="#FF0000"><b>Record </b></font>Command <font color="#000080">: </font>Byte<font color="#000080">; </font>Status <font color="#000080">: </font>Word<font color="#000080">; </font>Dummy2 <font color="#000080">: </font>Word<font color="#000080">; </font><font color="#FF0000"><b>End</b></font><font color="#000080">;



</font><font color="#FF0000"><b>Begin

  </b></font>Data<font color="#000080">.</font>Command<font color="#000080">:=</font><font color="#800000">6</font><font color="#000080">;

  </font>Error<font color="#000080">:=</font>DeviceCommand <font color="#000080">(</font><font color="#800000">5</font><font color="#000080">,</font><font color="#800000">$4402</font><font color="#000080">,</font>Data<font color="#000080">);

  </font>DriveStatus<font color="#000080">:=</font>Data<font color="#000080">.</font>Status <font color="#FF0000"><b>And </b></font><font color="#800000">2047</font><font color="#000080">;

</font><font color="#008000"><i>{  Reset; }

</i></font><font color="#FF0000"><b>End</b></font><font color="#000080">;



</font><font color="#FF0000"><b>Procedure </b></font>CDRom<font color="#000080">.</font>GetDriveParameters <font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>Parameters <font color="#000080">: </font>CDRomParametersRecord<font color="#000080">);



</font><font color="#FF0000"><b>Var

  </b></font>Data1 <font color="#000080">: </font><font color="#FF0000"><b>Record </b></font>Command<font color="#000080">, </font>Raw <font color="#000080">: </font>Byte<font color="#000080">; </font>SectorSize <font color="#000080">: </font>Word<font color="#000080">; </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

  </font>Data2 <font color="#000080">: </font><font color="#FF0000"><b>Record </b></font>Command <font color="#000080">: </font>Byte<font color="#000080">; </font>NumberOfSectors <font color="#000080">: </font>LongInt<font color="#000080">; </font><font color="#FF0000"><b>End</b></font><font color="#000080">;



</font><font color="#FF0000"><b>Begin

  </b></font>Data1<font color="#000080">.</font>Command<font color="#000080">:=</font><font color="#800000">7</font><font color="#000080">;

  </font>Error<font color="#000080">:=</font>DeviceCommand <font color="#000080">(</font><font color="#800000">4</font><font color="#000080">,</font><font color="#800000">$4402</font><font color="#000080">,</font>Data1<font color="#000080">);

  </font>Data2<font color="#000080">.</font>Command<font color="#000080">:=</font><font color="#800000">8</font><font color="#000080">;

  </font>Error<font color="#000080">:=</font>DeviceCommand <font color="#000080">(</font><font color="#800000">5</font><font color="#000080">,</font><font color="#800000">$4402</font><font color="#000080">,</font>Data2<font color="#000080">);

  </font>Parameters<font color="#000080">.</font>Raw<font color="#000080">:=</font>Data1<font color="#000080">.</font>Raw<font color="#000080">=</font><font color="#800000">1</font><font color="#000080">;

  </font>Parameters<font color="#000080">.</font>SectorSize<font color="#000080">:=</font>Data1<font color="#000080">.</font>SectorSize<font color="#000080">;

  </font>Parameters<font color="#000080">.</font>NumberOfSectors<font color="#000080">:=</font>Data2<font color="#000080">.</font>NumberOfSectors<font color="#000080">;

</font><font color="#FF0000"><b>End</b></font><font color="#000080">;



</font><font color="#FF0000"><b>Procedure </b></font>CDRom<font color="#000080">.</font>GetPosition <font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>Position <font color="#000080">: </font>CDRomPositionInfo<font color="#000080">);



</font><font color="#FF0000"><b>Var

  </b></font>Data <font color="#000080">: </font><font color="#FF0000"><b>Record

           </b></font>Command <font color="#000080">: </font>Byte<font color="#000080">;

           </font>Info <font color="#000080">: </font>CDRomPositionInfo<font color="#000080">;

         </font><font color="#FF0000"><b>End</b></font><font color="#000080">;



</font><font color="#FF0000"><b>Begin

  </b></font>Data<font color="#000080">.</font>Command<font color="#000080">:=</font><font color="#800000">12</font><font color="#000080">;

  </font>Error<font color="#000080">:=</font>DeviceCommand <font color="#000080">(</font><font color="#800000">129</font><font color="#000080">,</font><font color="#800000">$4402</font><font color="#000080">,</font>Data<font color="#000080">);

  </font>Position<font color="#000080">:=</font>Data<font color="#000080">.</font>Info<font color="#000080">;

</font><font color="#FF0000"><b>End</b></font><font color="#000080">;



</font><font color="#FF0000"><b>Procedure </b></font>CDRom<font color="#000080">.</font>PlayAudio <font color="#000080">(</font>MinuteStart<font color="#000080">, </font>SecondStart<font color="#000080">, </font>MinuteEnd<font color="#000080">, </font>SecondEnd <font color="#000080">: </font>Byte<font color="#000080">);



</font><font color="#FF0000"><b>Var

  </b></font>HSGAddress1<font color="#000080">, </font>HSGAddress2 <font color="#000080">: </font>LongInt<font color="#000080">;

  </font>Data <font color="#000080">: </font><font color="#FF0000"><b>Record

           </b></font>Bytes <font color="#000080">: </font><font color="#FF0000"><b>Array </b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">13</font><font color="#000080">] </font><font color="#FF0000"><b>Of </b></font>Byte<font color="#000080">;

           </font>HSGAddress <font color="#000080">: </font>LongInt<font color="#000080">;

           </font>NumberOfFrames <font color="#000080">: </font>LongInt<font color="#000080">;

         </font><font color="#FF0000"><b>End</b></font><font color="#000080">;



</font><font color="#FF0000"><b>Begin

  </b></font>HSGAddress1<font color="#000080">:=</font>RedBookToHSG <font color="#000080">(</font>MinuteStart<font color="#000080">, </font>SecondStart<font color="#000080">, </font><font color="#800000">0</font><font color="#000080">);

  </font>HSGAddress2<font color="#000080">:=</font>RedBookToHSG <font color="#000080">(</font>MinuteEnd<font color="#000080">, </font>SecondEnd<font color="#000080">, </font><font color="#800000">0</font><font color="#000080">);



  </font>Data<font color="#000080">.</font>Bytes<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">]:=</font><font color="#800000">$16</font><font color="#000080">;

  </font>Data<font color="#000080">.</font>Bytes<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">]:=</font>DriverNames<font color="#000080">[</font>CurrentDrive<font color="#000080">].</font>SubunitNr<font color="#000080">;

  </font>Data<font color="#000080">.</font>Bytes<font color="#000080">[</font><font color="#800000">2</font><font color="#000080">]:=</font><font color="#800000">$84</font><font color="#000080">;

  </font>Data<font color="#000080">.</font>Bytes<font color="#000080">[</font><font color="#800000">13</font><font color="#000080">]:=</font><font color="#800000">0</font><font color="#000080">;

  </font>Data<font color="#000080">.</font>HSGAddress<font color="#000080">:=</font>HSGAddress1<font color="#000080">;

  </font>Data<font color="#000080">.</font>NumberOfFrames<font color="#000080">:=</font>HSGAddress2<font color="#000080">-</font>HSGAddress1<font color="#000080">;



  </font>Regs<font color="#000080">.</font>ES<font color="#000080">:=</font>Seg <font color="#000080">(</font>Data<font color="#000080">);

  </font>Regs<font color="#000080">.</font>BX<font color="#000080">:=</font>Ofs <font color="#000080">(</font>Data<font color="#000080">);

  </font>Regs<font color="#000080">.</font>CX<font color="#000080">:=</font>Ord <font color="#000080">(</font>CurrentDrive<font color="#000080">)-</font><font color="#800000">65</font><font color="#000080">;

  </font>Regs<font color="#000080">.</font>AX<font color="#000080">:=</font><font color="#800000">$1510</font><font color="#000080">;

  </font>Intr <font color="#000080">(</font><font color="#800000">$2F</font><font color="#000080">,</font>Regs<font color="#000080">);

</font><font color="#FF0000"><b>End</b></font><font color="#000080">;



</font><font color="#FF0000"><b>Procedure </b></font>CDRom<font color="#000080">.</font>PlayTrack <font color="#000080">(</font>TrackNr <font color="#000080">: </font>Byte<font color="#000080">);



</font><font color="#FF0000"><b>Var

  </b></font>Track1 <font color="#000080">: </font><font color="#FF0000"><b>Record

            </b></font>Command<font color="#000080">, </font>TrackNr <font color="#000080">: </font>Byte<font color="#000080">;

            </font>RedBookAdress <font color="#000080">: </font><font color="#FF0000"><b>Record

                              </b></font>Frame<font color="#000080">,

                              </font>Second<font color="#000080">,

                              </font>Minute<font color="#000080">,

                              </font>Dummy <font color="#000080">: </font>Byte<font color="#000080">;

                            </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

            </font>TrackControl <font color="#000080">: </font>Word<font color="#000080">;

            </font>HSGAddress <font color="#000080">: </font>LongInt<font color="#000080">;

          </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

  </font>Track2 <font color="#000080">: </font><font color="#FF0000"><b>Record

            </b></font>Command<font color="#000080">, </font>TrackNr <font color="#000080">: </font>Byte<font color="#000080">;

            </font>RedBookAdress <font color="#000080">: </font><font color="#FF0000"><b>Record

                              </b></font>Frame<font color="#000080">,

                              </font>Second<font color="#000080">,

                              </font>Minute<font color="#000080">,

                              </font>Dummy <font color="#000080">: </font>Byte<font color="#000080">;

                            </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

            </font>TrackControl <font color="#000080">: </font>Word<font color="#000080">;

            </font>HSGAddress <font color="#000080">: </font>LongInt<font color="#000080">;

          </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

  </font>Data <font color="#000080">: </font><font color="#FF0000"><b>Record

           </b></font>Bytes <font color="#000080">: </font><font color="#FF0000"><b>Array </b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">13</font><font color="#000080">] </font><font color="#FF0000"><b>Of </b></font>Byte<font color="#000080">;

           </font>HSGAddress <font color="#000080">: </font>LongInt<font color="#000080">;

           </font>NumberOfFrames <font color="#000080">: </font>LongInt<font color="#000080">;

         </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

  </font>NumberOfTracks <font color="#000080">: </font>Byte<font color="#000080">;



</font><font color="#FF0000"><b>Begin

  </b></font>NumberOfTracks<font color="#000080">:=</font>NumberOfAudioTracks<font color="#000080">;

  </font>Track1<font color="#000080">.</font>Command<font color="#000080">:=</font><font color="#800000">$0B</font><font color="#000080">;

  </font>Track1<font color="#000080">.</font>TrackNr<font color="#000080">:=</font>TrackNr<font color="#000080">;

  </font>Error<font color="#000080">:=</font>DeviceCommand <font color="#000080">(</font><font color="#800000">8</font><font color="#000080">,</font><font color="#800000">$4402</font><font color="#000080">,</font>Track1<font color="#000080">);

  </font>Track1<font color="#000080">.</font>HSGAddress<font color="#000080">:=</font>RedBookToHSG <font color="#000080">(</font>Track1<font color="#000080">.</font>RedBookAdress<font color="#000080">.</font>Minute<font color="#000080">,

                                   </font>Track1<font color="#000080">.</font>RedBookAdress<font color="#000080">.</font>Second<font color="#000080">,

                                   </font>Track1<font color="#000080">.</font>RedBookAdress<font color="#000080">.</font>Frame<font color="#000080">);

  </font><font color="#FF0000"><b>If </b></font>Track1<font color="#000080">.</font>TrackControl <font color="#FF0000"><b>And </b></font><font color="#800000">16384</font><font color="#000080">&lt;&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>Exit<font color="#000080">;

  </font>Track2<font color="#000080">.</font>Command<font color="#000080">:=</font><font color="#800000">$0B</font><font color="#000080">;

  </font>Track2<font color="#000080">.</font>TrackNr<font color="#000080">:=</font>TrackNr<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">;

  </font>Error<font color="#000080">:=</font>DeviceCommand <font color="#000080">(</font><font color="#800000">8</font><font color="#000080">,</font><font color="#800000">$4402</font><font color="#000080">,</font>Track2<font color="#000080">);

  </font>Track2<font color="#000080">.</font>HSGAddress<font color="#000080">:=</font>RedBookToHSG <font color="#000080">(</font>Track2<font color="#000080">.</font>RedBookAdress<font color="#000080">.</font>Minute<font color="#000080">,

                                   </font>Track2<font color="#000080">.</font>RedBookAdress<font color="#000080">.</font>Second<font color="#000080">,

                                   </font>Track2<font color="#000080">.</font>RedBookAdress<font color="#000080">.</font>Frame<font color="#000080">);

  </font>Data<font color="#000080">.</font>Bytes<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">]:=</font><font color="#800000">$16</font><font color="#000080">;

  </font>Data<font color="#000080">.</font>Bytes<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">]:=</font>DriverNames<font color="#000080">[</font>CurrentDrive<font color="#000080">].</font>SubunitNr<font color="#000080">;

  </font>Data<font color="#000080">.</font>Bytes<font color="#000080">[</font><font color="#800000">2</font><font color="#000080">]:=</font><font color="#800000">$84</font><font color="#000080">;

  </font>Data<font color="#000080">.</font>Bytes<font color="#000080">[</font><font color="#800000">13</font><font color="#000080">]:=</font><font color="#800000">0</font><font color="#000080">;

  </font>Data<font color="#000080">.</font>HSGAddress<font color="#000080">:=</font>Track1<font color="#000080">.</font>HSGAddress<font color="#000080">;

  </font>Data<font color="#000080">.</font>NumberOfFrames<font color="#000080">:=</font>Track2<font color="#000080">.</font>HSGAddress<font color="#000080">-</font>Track1<font color="#000080">.</font>HSGAddress<font color="#000080">;



  </font>Regs<font color="#000080">.</font>ES<font color="#000080">:=</font>Seg <font color="#000080">(</font>Data<font color="#000080">);

  </font>Regs<font color="#000080">.</font>BX<font color="#000080">:=</font>Ofs <font color="#000080">(</font>Data<font color="#000080">);

  </font>Regs<font color="#000080">.</font>CX<font color="#000080">:=</font>Ord <font color="#000080">(</font>CurrentDrive<font color="#000080">)-</font><font color="#800000">65</font><font color="#000080">;

  </font>Regs<font color="#000080">.</font>AX<font color="#000080">:=</font><font color="#800000">$1510</font><font color="#000080">;

  </font>Intr <font color="#000080">(</font><font color="#800000">$2F</font><font color="#000080">,</font>Regs<font color="#000080">);

</font><font color="#FF0000"><b>End</b></font><font color="#000080">;



</font><font color="#FF0000"><b>Procedure </b></font>CDRom<font color="#000080">.</font>PausePlay<font color="#000080">;



</font><font color="#FF0000"><b>Var

  </b></font>Data <font color="#000080">: </font><font color="#FF0000"><b>Array </b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">12</font><font color="#000080">] </font><font color="#FF0000"><b>Of </b></font>Byte<font color="#000080">;



</font><font color="#FF0000"><b>Begin

  </b></font>Data<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">]:=</font><font color="#800000">$0D</font><font color="#000080">;

  </font>Data<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">]:=</font>DriverNames<font color="#000080">[</font>CurrentDrive<font color="#000080">].</font>SubunitNr<font color="#000080">;

  </font>Data<font color="#000080">[</font><font color="#800000">2</font><font color="#000080">]:=</font><font color="#800000">$85</font><font color="#000080">;

  </font>Regs<font color="#000080">.</font>ES<font color="#000080">:=</font>Seg <font color="#000080">(</font>Data<font color="#000080">);

  </font>Regs<font color="#000080">.</font>BX<font color="#000080">:=</font>Ofs <font color="#000080">(</font>Data<font color="#000080">);

  </font>Regs<font color="#000080">.</font>CX<font color="#000080">:=</font>Ord <font color="#000080">(</font>CurrentDrive<font color="#000080">)-</font><font color="#800000">65</font><font color="#000080">;

  </font>Regs<font color="#000080">.</font>AX<font color="#000080">:=</font><font color="#800000">$1510</font><font color="#000080">;

  </font>Intr <font color="#000080">(</font><font color="#800000">$2F</font><font color="#000080">,</font>Regs<font color="#000080">);

</font><font color="#FF0000"><b>End</b></font><font color="#000080">;



</font><font color="#FF0000"><b>Procedure </b></font>CDRom<font color="#000080">.</font>ResumePlay<font color="#000080">;



</font><font color="#FF0000"><b>Var

  </b></font>Data <font color="#000080">: </font><font color="#FF0000"><b>Array </b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">12</font><font color="#000080">] </font><font color="#FF0000"><b>Of </b></font>Byte<font color="#000080">;



</font><font color="#FF0000"><b>Begin

  </b></font>Data<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">]:=</font><font color="#800000">$0D</font><font color="#000080">;

  </font>Data<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">]:=</font>DriverNames<font color="#000080">[</font>CurrentDrive<font color="#000080">].</font>SubunitNr<font color="#000080">;

  </font>Data<font color="#000080">[</font><font color="#800000">2</font><font color="#000080">]:=</font><font color="#800000">$88</font><font color="#000080">;

  </font>Regs<font color="#000080">.</font>ES<font color="#000080">:=</font>Seg <font color="#000080">(</font>Data<font color="#000080">);

  </font>Regs<font color="#000080">.</font>BX<font color="#000080">:=</font>Ofs <font color="#000080">(</font>Data<font color="#000080">);

  </font>Regs<font color="#000080">.</font>CX<font color="#000080">:=</font>Ord <font color="#000080">(</font>CurrentDrive<font color="#000080">)-</font><font color="#800000">65</font><font color="#000080">;

  </font>Regs<font color="#000080">.</font>AX<font color="#000080">:=</font><font color="#800000">$1510</font><font color="#000080">;

  </font>Intr <font color="#000080">(</font><font color="#800000">$2F</font><font color="#000080">,</font>Regs<font color="#000080">);

</font><font color="#FF0000"><b>End</b></font><font color="#000080">;



</font><font color="#FF0000"><b>Function </b></font>CDRom<font color="#000080">.</font>NumberOfAudioTracks <font color="#000080">: </font>Byte<font color="#000080">;



</font><font color="#FF0000"><b>Var

  </b></font>Data <font color="#000080">: </font><font color="#FF0000"><b>Record </b></font>Command <font color="#000080">: </font>Byte<font color="#000080">; </font>FirstTrack<font color="#000080">, </font>LastTrack <font color="#000080">: </font>Byte<font color="#000080">; </font>Dummy <font color="#000080">: </font>LongInt<font color="#000080">; </font><font color="#FF0000"><b>End</b></font><font color="#000080">;



</font><font color="#FF0000"><b>Begin

  </b></font>Data<font color="#000080">.</font>Command<font color="#000080">:=</font><font color="#800000">$0A</font><font color="#000080">;

  </font>Error<font color="#000080">:=</font>DeviceCommand <font color="#000080">(</font><font color="#800000">7</font><font color="#000080">,</font><font color="#800000">$4402</font><font color="#000080">,</font>Data<font color="#000080">);

  </font>NumberOfAudioTracks<font color="#000080">:=</font>Data<font color="#000080">.</font>LastTrack<font color="#000080">-</font>Data<font color="#000080">.</font>FirstTrack<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">;

</font><font color="#FF0000"><b>End</b></font><font color="#000080">;



</font><font color="#FF0000"><b>Function </b></font>CDRom<font color="#000080">.</font>DeviceCommand <font color="#000080">(</font>CommandNr<font color="#000080">, </font>DosFunction <font color="#000080">: </font>Word<font color="#000080">; </font><font color="#FF0000"><b>Var </b></font>Data<font color="#000080">) : </font>Word<font color="#000080">;



</font><font color="#FF0000"><b>Begin

  </b></font>Regs<font color="#000080">.</font>BX<font color="#000080">:=</font>TextRec <font color="#000080">(</font>CDRomDevice<font color="#000080">).</font>Handle<font color="#000080">;

  </font>Regs<font color="#000080">.</font>DS<font color="#000080">:=</font>Seg <font color="#000080">(</font>Data<font color="#000080">);

  </font>Regs<font color="#000080">.</font>DX<font color="#000080">:=</font>Ofs <font color="#000080">(</font>Data<font color="#000080">);

  </font>Regs<font color="#000080">.</font>CX<font color="#000080">:=</font>CommandNr<font color="#000080">;

  </font>Regs<font color="#000080">.</font>AX<font color="#000080">:=</font>DosFunction<font color="#000080">;

  </font>MsDos <font color="#000080">(</font>Regs<font color="#000080">);

  </font><font color="#FF0000"><b>If </b></font>Regs<font color="#000080">.</font>Flags <font color="#FF0000"><b>And </b></font>fCarry<font color="#000080">=</font><font color="#800000">0 </font><font color="#FF0000"><b>then

    </b></font>DeviceCommand<font color="#000080">:=</font><font color="#800000">0

  </font><font color="#FF0000"><b>Else

    </b></font>DeviceCommand<font color="#000080">:=</font>Regs<font color="#000080">.</font>AX<font color="#000080">;

</font><font color="#FF0000"><b>End</b></font><font color="#000080">;



</font><font color="#FF0000"><b>Function </b></font>CDRom<font color="#000080">.</font>RedBookToHSG <font color="#000080">(</font>Minute<font color="#000080">, </font>Second<font color="#000080">, </font>Frame <font color="#000080">: </font>Byte<font color="#000080">) : </font>LongInt<font color="#000080">;



</font><font color="#FF0000"><b>Begin

  </b></font>RedBookToHSG<font color="#000080">:=(</font>LongInt <font color="#000080">(</font>Minute<font color="#000080">)*</font><font color="#800000">4500</font><font color="#000080">)+(</font>LongInt <font color="#000080">(</font>Second<font color="#000080">)*</font><font color="#800000">75</font><font color="#000080">)+</font>Frame<font color="#000080">-</font><font color="#800000">183</font><font color="#000080">;

</font><font color="#FF0000"><b>End</b></font><font color="#000080">;



</font><font color="#FF0000"><b>End</b></font><font color="#000080">.</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to DRIVES SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0118.PAS">Original</a><b>]</b></p></body>
</html>
