<html>
<head><title> "VOL Label Functions" by SWAG SUPPORT TEAM</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to DRIVES SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0056.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#FF0000"><b>UNIT </b></font>VolFuncs<font color="#000080">;
</font><font color="#008000"><i>(**) </i></font><font color="#FF0000"><b>INTERFACE </b></font><font color="#008000"><i>(**)
</i></font><font color="#FF0000"><b>USES </b></font>Dos<font color="#000080">;
</font><font color="#FF0000"><b>TYPE
  </b></font>VolString <font color="#000080">= </font><font color="#FF0000"><b>String</b></font><font color="#000080">[</font><font color="#800000">12</font><font color="#000080">];

  </font><font color="#FF0000"><b>FUNCTION </b></font>GetLabel<font color="#000080">(</font>driveNum <font color="#000080">: </font>Byte<font color="#000080">;
                    </font><font color="#FF0000"><b>VAR </b></font>V <font color="#000080">: </font>VolString<font color="#000080">) : </font>Boolean<font color="#000080">;
  </font><font color="#FF0000"><b>FUNCTION </b></font>SetLabel<font color="#000080">(</font>driveNum <font color="#000080">: </font>Byte<font color="#000080">;
                    </font>NuLabel <font color="#000080">: </font>VolString<font color="#000080">) : </font>Boolean<font color="#000080">;
  </font><font color="#FF0000"><b>FUNCTION </b></font>DelLabel<font color="#000080">(</font>driveNum <font color="#000080">: </font>Byte<font color="#000080">) : </font>Boolean<font color="#000080">;

</font><font color="#008000"><i>(**) </i></font><font color="#FF0000"><b>IMPLEMENTATION </b></font><font color="#008000"><i>(**)
</i></font><font color="#FF0000"><b>TYPE
  </b></font>ExFCB <font color="#000080">= </font><font color="#FF0000"><b>RECORD
            </b></font>FF        <font color="#000080">: </font>Byte<font color="#000080">;              </font><font color="#008000"><i>{must be 0FFh}
            </i></font>Reserved0 <font color="#000080">: </font><font color="#FF0000"><b>ARRAY</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">5</font><font color="#000080">] </font><font color="#FF0000"><b>OF </b></font>Byte<font color="#000080">; </font><font color="#008000"><i>{must be 0s}
            </i></font>Attribute <font color="#000080">: </font>Byte<font color="#000080">;
            </font>DriveID   <font color="#000080">: </font>Byte<font color="#000080">;
            </font>Filename  <font color="#000080">: </font><font color="#FF0000"><b>ARRAY</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">8</font><font color="#000080">] </font><font color="#FF0000"><b>OF </b></font>Char<font color="#000080">;
            </font>Extension <font color="#000080">: </font><font color="#FF0000"><b>ARRAY</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">3</font><font color="#000080">] </font><font color="#FF0000"><b>OF </b></font>Char<font color="#000080">;
            </font>CurBlock  <font color="#000080">: </font>Word<font color="#000080">;
            </font>RecSize   <font color="#000080">: </font>Word<font color="#000080">;
            </font>FileSize  <font color="#000080">: </font>LongInt<font color="#000080">;
            </font>Date      <font color="#000080">: </font>Word<font color="#000080">;
            </font>Time      <font color="#000080">: </font>Word<font color="#000080">;
            </font>Reserved  <font color="#000080">: </font><font color="#FF0000"><b>ARRAY</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">8</font><font color="#000080">] </font><font color="#FF0000"><b>OF </b></font>Byte<font color="#000080">;
            </font>CurRec    <font color="#000080">: </font>Byte<font color="#000080">;
            </font>Relative  <font color="#000080">: </font>LongInt<font color="#000080">;
          </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>FUNCTION </b></font>GetLabel<font color="#000080">(</font>driveNum <font color="#000080">: </font>Byte<font color="#000080">;
                    </font><font color="#FF0000"><b>VAR </b></font>V <font color="#000080">: </font>VolString<font color="#000080">) : </font>Boolean<font color="#000080">;
  </font><font color="#FF0000"><b>CONST
    </b></font>Any <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">[</font><font color="#800000">5</font><font color="#000080">] = </font><font color="#800000">':\*.*'</font><font color="#000080">;
  </font><font color="#FF0000"><b>VAR
    </b></font>SR   <font color="#000080">: </font>SearchRec<font color="#000080">;
    </font>Mask <font color="#000080">: </font>PathStr<font color="#000080">;
    </font>P    <font color="#000080">: </font>Byte<font color="#000080">;
  </font><font color="#FF0000"><b>BEGIN
    IF </b></font>DriveNum <font color="#000080">&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>THEN
      </b></font>Mask<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">] := </font>Char<font color="#000080">(</font>DriveNum <font color="#000080">+ </font>ord<font color="#000080">(</font><font color="#800000">'@'</font><font color="#000080">))
    </font><font color="#FF0000"><b>ELSE </b></font>GetDir<font color="#000080">(</font><font color="#800000">0</font><font color="#000080">, </font>Mask<font color="#000080">);
    </font>Move<font color="#000080">(</font>Any<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">], </font>Mask<font color="#000080">[</font><font color="#800000">2</font><font color="#000080">], </font><font color="#800000">5</font><font color="#000080">);
    </font>Mask<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">] := </font><font color="#800000">#6</font><font color="#000080">;
    </font>FindFirst<font color="#000080">(</font>Mask<font color="#000080">, </font>VolumeID<font color="#000080">, </font>SR<font color="#000080">);
    </font><font color="#FF0000"><b>WHILE </b></font><font color="#000080">(</font>SR<font color="#000080">.</font>Attr <font color="#FF0000"><b>AND </b></font>VolumeID <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>AND
          </b></font><font color="#000080">(</font>DosError <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>DO
      </b></font>FindNext<font color="#000080">(</font>SR<font color="#000080">);
    </font><font color="#FF0000"><b>IF </b></font>DosError <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>THEN
      BEGIN
        </b></font>FillChar<font color="#000080">(</font>V<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">], </font><font color="#800000">11</font><font color="#000080">, </font><font color="#800000">' '</font><font color="#000080">);
        </font>V<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">] := </font><font color="#800000">#11</font><font color="#000080">;
        </font>P <font color="#000080">:= </font>Pos<font color="#000080">(</font><font color="#800000">'.'</font><font color="#000080">, </font>SR<font color="#000080">.</font>Name<font color="#000080">);
        </font><font color="#FF0000"><b>IF </b></font>P <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>THEN
          </b></font>Move<font color="#000080">(</font>SR<font color="#000080">.</font>Name<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">], </font>V<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">], </font>length<font color="#000080">(</font>SR<font color="#000080">.</font>Name<font color="#000080">))
        </font><font color="#FF0000"><b>ELSE
          BEGIN
            </b></font>Move<font color="#000080">(</font>SR<font color="#000080">.</font>Name<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">], </font>V<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">], </font>pred<font color="#000080">(</font>P<font color="#000080">));
            </font>Move<font color="#000080">(</font>SR<font color="#000080">.</font>Name<font color="#000080">[</font>P<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">], </font>V<font color="#000080">[</font><font color="#800000">9</font><font color="#000080">], </font>length<font color="#000080">(</font>SR<font color="#000080">.</font>Name<font color="#000080">)-</font>P<font color="#000080">);
          </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
        </font>GetLabel <font color="#000080">:= </font>TRUE<font color="#000080">;
      </font><font color="#FF0000"><b>END
    ELSE </b></font>GetLabel <font color="#000080">:= </font>FALSE<font color="#000080">;
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>FUNCTION </b></font>SetLabel<font color="#000080">(</font>driveNum <font color="#000080">: </font>Byte<font color="#000080">;
                    </font>NuLabel <font color="#000080">: </font>VolString<font color="#000080">) : </font>Boolean<font color="#000080">;
  </font><font color="#FF0000"><b>VAR </b></font>E  <font color="#000080">: </font>ExFCB<font color="#000080">;
  </font><font color="#FF0000"><b>BEGIN
    WITH </b></font>E <font color="#FF0000"><b>DO
      BEGIN
        </b></font>FF        <font color="#000080">:= </font><font color="#800000">$FF</font><font color="#000080">;
        </font>FillChar<font color="#000080">(</font>Reserved0<font color="#000080">, </font><font color="#800000">5</font><font color="#000080">, </font><font color="#800000">0</font><font color="#000080">);
        </font>Attribute <font color="#000080">:= </font>VolumeID<font color="#000080">;
        </font>DriveID   <font color="#000080">:= </font>DriveNum<font color="#000080">;
        </font>FillChar<font color="#000080">(</font>FileName<font color="#000080">, </font><font color="#800000">8</font><font color="#000080">, </font><font color="#800000">' '</font><font color="#000080">);
        </font>FillChar<font color="#000080">(</font>Extension<font color="#000080">, </font><font color="#800000">3</font><font color="#000080">, </font><font color="#800000">' '</font><font color="#000080">);
        </font>Move<font color="#000080">(</font>NuLabel<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">], </font>Filename<font color="#000080">, </font>length<font color="#000080">(</font>NuLabel<font color="#000080">));
      </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>ASM
      </b></font><font color="#FF00FF">PUSH DS
      MOV AX, SS
      MOV DS, AX
      LEA DX, E    </font><font color="#008000"><i>{point DS:DX at Extended FCB}
      </i></font><font color="#FF00FF">MOV AH, 16h  </font><font color="#008000"><i>{create using FCB}
      </i></font><font color="#FF00FF">INT 21h
      INC AL
      MOV @result, AL
      POP DS
    </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>FUNCTION </b></font>DelLabel<font color="#000080">(</font>driveNum <font color="#000080">: </font>Byte<font color="#000080">) : </font>Boolean<font color="#000080">;
  </font><font color="#FF0000"><b>VAR </b></font>E   <font color="#000080">: </font>ExFCB<font color="#000080">;
  </font><font color="#FF0000"><b>BEGIN
    WITH </b></font>E <font color="#FF0000"><b>DO
      BEGIN
        </b></font>FF        <font color="#000080">:= </font><font color="#800000">$FF</font><font color="#000080">;
        </font>FillChar<font color="#000080">(</font>Reserved0<font color="#000080">, </font><font color="#800000">5</font><font color="#000080">, </font><font color="#800000">0</font><font color="#000080">);
        </font>Attribute <font color="#000080">:= </font>VolumeID<font color="#000080">;
        </font>DriveID   <font color="#000080">:= </font>DriveNum<font color="#000080">;
        </font>FillChar<font color="#000080">(</font>FileName<font color="#000080">, </font><font color="#800000">8</font><font color="#000080">, </font><font color="#800000">'?'</font><font color="#000080">);
        </font>FillChar<font color="#000080">(</font>Extension<font color="#000080">, </font><font color="#800000">3</font><font color="#000080">, </font><font color="#800000">'?'</font><font color="#000080">);
      </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>ASM
      </b></font><font color="#FF00FF">PUSH DS
      MOV AX, SS
      MOV DS, AX
      LEA DX, E    </font><font color="#008000"><i>{point DS:DX at Extended FCB}
      </i></font><font color="#FF00FF">MOV AH, 13h  </font><font color="#008000"><i>{delete using FCB}
      </i></font><font color="#FF00FF">INT 21h
      INC AL
      MOV @Result, AL
      POP DS
    </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">.</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to DRIVES SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0056.PAS">Original</a><b>]</b></p></body>
</html>
