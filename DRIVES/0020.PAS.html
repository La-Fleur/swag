<html>
<head><title> "Volume Labels" by SVERRE HJELM</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to DRIVES SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0020.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#000080">&gt; </font>I need a way <font color="#FF0000"><b>to </b></font>find the  volume <font color="#FF0000"><b>Label of </b></font>a drive<font color="#000080">.  </font>Any  suggestions <font color="#FF0000"><b>or
</b></font><font color="#000080">&gt; </font>source code<font color="#000080">?

</font><font color="#008000"><i>{$S-,R-,V-,I-,N-,B-,F-}

</i></font><font color="#FF0000"><b>Unit </b></font>Volume<font color="#000080">;

</font><font color="#FF0000"><b>Interface

Uses
  </b></font>Dos<font color="#000080">;

</font><font color="#FF0000"><b>Type

  </b></font>Drive       <font color="#000080">= </font>Byte<font color="#000080">;
  </font>VolumeName  <font color="#000080">= </font><font color="#FF0000"><b>String </b></font><font color="#000080">[</font><font color="#800000">11</font><font color="#000080">];

  </font>VolFCB      <font color="#000080">= </font><font color="#FF0000"><b>Record
    </b></font>FCB_Flag <font color="#000080">: </font>Byte<font color="#000080">;
    </font>Reserved <font color="#000080">: </font><font color="#FF0000"><b>Array </b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">5</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Byte<font color="#000080">;
    </font>FileAttr <font color="#000080">: </font>Byte<font color="#000080">;
    </font>Drive_ID <font color="#000080">: </font>Byte<font color="#000080">;
    </font>FileName <font color="#000080">: </font><font color="#FF0000"><b>Array </b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">8</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Byte<font color="#000080">;
    </font>File_Ext <font color="#000080">: </font><font color="#FF0000"><b>Array </b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">3</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Byte<font color="#000080">;
    </font>Unused_A <font color="#000080">: </font><font color="#FF0000"><b>Array </b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">5</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Byte<font color="#000080">;
    </font>File_New <font color="#000080">: </font><font color="#FF0000"><b>Array </b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">8</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Byte<font color="#000080">;
    </font>fExt_New <font color="#000080">: </font><font color="#FF0000"><b>Array </b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">3</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Byte<font color="#000080">;
    </font>Unused_B <font color="#000080">: </font><font color="#FF0000"><b>Array </b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">9</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Byte
  <font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>DelVol <font color="#000080">(</font>D <font color="#000080">: </font>Byte<font color="#000080">) : </font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>Function </b></font>AddVol <font color="#000080">(</font>D <font color="#000080">: </font>Byte<font color="#000080">; </font>V <font color="#000080">: </font>VolumeName<font color="#000080">) : </font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>Function </b></font>ChgVol <font color="#000080">(</font>D <font color="#000080">: </font>Byte<font color="#000080">; </font>V <font color="#000080">: </font>VolumeName<font color="#000080">) : </font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>Function </b></font>GetVol <font color="#000080">(</font>D <font color="#000080">: </font>Byte<font color="#000080">) : </font>VolumeName<font color="#000080">;

</font><font color="#FF0000"><b>Implementation

Procedure </b></font>Pad_Name <font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>V <font color="#000080">: </font>VolumeName<font color="#000080">);
</font><font color="#FF0000"><b>begin
  While </b></font>LENGTH <font color="#000080">(</font>V<font color="#000080">) &lt;&gt; </font><font color="#800000">11 </font><font color="#FF0000"><b>DO
    </b></font>V <font color="#000080">:= </font>V <font color="#000080">+ </font><font color="#800000">' '
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>Fix_Ext_Sym <font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>V <font color="#000080">: </font>VolumeName<font color="#000080">) : </font>Byte<font color="#000080">;
</font><font color="#FF0000"><b>Var
  </b></font>I <font color="#000080">: </font>Byte<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>I <font color="#000080">:= </font>POS <font color="#000080">(</font><font color="#800000">'.'</font><font color="#000080">, </font>V<font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font>I <font color="#000080">&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then
    </b></font>DELETE <font color="#000080">(</font>V<font color="#000080">, </font>I<font color="#000080">, </font><font color="#800000">1</font><font color="#000080">);
  </font>Fix_Ext_Sym <font color="#000080">:= </font>I
<font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>Extract_Name <font color="#000080">(</font>S <font color="#000080">: </font>SearchRec<font color="#000080">) : </font>VolumeName<font color="#000080">;
</font><font color="#FF0000"><b>Var
  </b></font>H<font color="#000080">, </font>I <font color="#000080">: </font>Byte<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>I <font color="#000080">:= </font>Fix_Ext_Sym <font color="#000080">(</font>S<font color="#000080">.</font>Name<font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>I <font color="#000080">&gt; </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>I <font color="#000080">&lt; </font><font color="#800000">9</font><font color="#000080">) </font><font color="#FF0000"><b>then
    For </b></font>H <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font><font color="#000080">(</font><font color="#800000">9 </font><font color="#000080">- </font>I<font color="#000080">) </font><font color="#FF0000"><b>DO
      </b></font>INSERT <font color="#000080">(</font><font color="#800000">' '</font><font color="#000080">, </font>S<font color="#000080">.</font>Name<font color="#000080">, </font>I<font color="#000080">);
  </font>Extract_Name <font color="#000080">:= </font>S<font color="#000080">.</font>Name
<font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>Fix_Name <font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>V <font color="#000080">: </font>VolumeName<font color="#000080">);
</font><font color="#FF0000"><b>Var
  </b></font>I <font color="#000080">: </font>Byte<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>Pad_Name <font color="#000080">(</font>V<font color="#000080">);
  </font><font color="#FF0000"><b>For </b></font>I <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font><font color="#800000">11
    </font><font color="#FF0000"><b>do </b></font>V <font color="#000080">[</font>I<font color="#000080">] := </font>UPCASE <font color="#000080">(</font>V <font color="#000080">[</font>I<font color="#000080">])
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>Valid_Drive_Num <font color="#000080">(</font>D <font color="#000080">: </font>Byte<font color="#000080">) : </font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>Valid_Drive_Num <font color="#000080">:= (</font>D <font color="#000080">&gt;= </font><font color="#800000">1</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>D <font color="#000080">&lt;= </font><font color="#800000">26</font><font color="#000080">)
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>Find_Vol <font color="#000080">(</font>D <font color="#000080">: </font>Byte<font color="#000080">; </font><font color="#FF0000"><b>Var </b></font>S <font color="#000080">: </font>SearchRec<font color="#000080">) : </font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>FINDFIRST <font color="#000080">(</font>CHR <font color="#000080">(</font>D <font color="#000080">+ </font><font color="#800000">64</font><font color="#000080">) + </font><font color="#800000">':\*.*'</font><font color="#000080">, </font>VolumeID<font color="#000080">, </font>S<font color="#000080">);
  </font>Find_Vol <font color="#000080">:= </font>DosError <font color="#000080">= </font><font color="#800000">0
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>Fix_FCB_NewFile <font color="#000080">(</font>V <font color="#000080">: </font>VolumeName<font color="#000080">; </font><font color="#FF0000"><b>Var </b></font>FCB <font color="#000080">: </font>VolFCB<font color="#000080">);
</font><font color="#FF0000"><b>Var
  </b></font>I <font color="#000080">: </font>Byte<font color="#000080">;
</font><font color="#FF0000"><b>begin
  For </b></font>I <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font><font color="#800000">8 </font><font color="#FF0000"><b>DO
    </b></font>FCB<font color="#000080">.</font>File_New <font color="#000080">[</font>I<font color="#000080">] := </font>ORD <font color="#000080">(</font>V <font color="#000080">[</font>I<font color="#000080">]);
  </font><font color="#FF0000"><b>For </b></font>I <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font><font color="#800000">3 </font><font color="#FF0000"><b>DO
    </b></font>FCB<font color="#000080">.</font>fExt_New <font color="#000080">[</font>I<font color="#000080">] := </font>ORD <font color="#000080">(</font>V <font color="#000080">[</font>I <font color="#000080">+ </font><font color="#800000">8</font><font color="#000080">])
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>Fix_FCB_FileName <font color="#000080">(</font>V <font color="#000080">: </font>VolumeName<font color="#000080">; </font><font color="#FF0000"><b>Var </b></font>FCB <font color="#000080">: </font>VolFCB<font color="#000080">);
</font><font color="#FF0000"><b>Var
   </b></font>I <font color="#000080">: </font>Byte<font color="#000080">;
</font><font color="#FF0000"><b>begin
  For </b></font>I <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font><font color="#800000">8 </font><font color="#FF0000"><b>DO
    </b></font>FCB<font color="#000080">.</font>FileName <font color="#000080">[</font>I<font color="#000080">] := </font>ORD <font color="#000080">(</font>V <font color="#000080">[</font>I<font color="#000080">]);
  </font><font color="#FF0000"><b>For </b></font>I <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font><font color="#800000">3 </font><font color="#FF0000"><b>DO
    </b></font>FCB<font color="#000080">.</font>File_Ext <font color="#000080">[</font>I<font color="#000080">] := </font>ORD <font color="#000080">(</font>V <font color="#000080">[</font>I <font color="#000080">+ </font><font color="#800000">8</font><font color="#000080">])
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>Vol_Int21 <font color="#000080">(</font>Fnxn <font color="#000080">: </font>Word<font color="#000080">; </font>D <font color="#000080">: </font>Drive<font color="#000080">; </font><font color="#FF0000"><b>Var </b></font>FCB <font color="#000080">: </font>VolFCB<font color="#000080">) : </font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>Var
  </b></font>Regs <font color="#000080">: </font>Registers<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>FCB<font color="#000080">.</font>Drive_ID <font color="#000080">:= </font>D<font color="#000080">;
  </font>FCB<font color="#000080">.</font>FCB_Flag <font color="#000080">:= </font><font color="#800000">$FF</font><font color="#000080">;
  </font>FCB<font color="#000080">.</font>FileAttr <font color="#000080">:= </font><font color="#800000">$08</font><font color="#000080">;
  </font>Regs<font color="#000080">.</font>DS     <font color="#000080">:= </font>SEG <font color="#000080">(</font>FCB<font color="#000080">);
  </font>Regs<font color="#000080">.</font>DX     <font color="#000080">:= </font>OFS <font color="#000080">(</font>FCB<font color="#000080">);
  </font>Regs<font color="#000080">.</font>AX     <font color="#000080">:= </font>Fnxn<font color="#000080">;
  </font>MSDos <font color="#000080">(</font>Regs<font color="#000080">);
  </font>Vol_Int21 <font color="#000080">:= </font>Regs<font color="#000080">.</font>AL <font color="#000080">= </font><font color="#800000">0
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>DelVol <font color="#000080">(</font>D <font color="#000080">: </font>Byte<font color="#000080">) : </font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>Var
   </b></font>sRec <font color="#000080">: </font>SearchRec<font color="#000080">;
   </font>FCB  <font color="#000080">: </font>VolFCB<font color="#000080">;
   </font>V    <font color="#000080">: </font>VolumeName<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>DelVol <font color="#000080">:= </font>False<font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font>Valid_Drive_Num <font color="#000080">(</font>D<font color="#000080">) </font><font color="#FF0000"><b>then
  begin
    if </b></font>Find_Vol <font color="#000080">(</font>D<font color="#000080">, </font>sRec<font color="#000080">) </font><font color="#FF0000"><b>then
    begin
      </b></font>V <font color="#000080">:= </font>Extract_Name <font color="#000080">(</font>sRec<font color="#000080">);
      </font>Pad_Name <font color="#000080">(</font>V<font color="#000080">);
      </font>Fix_FCB_FileName <font color="#000080">(</font>V<font color="#000080">, </font>FCB<font color="#000080">);
      </font>DelVol <font color="#000080">:= </font>Vol_Int21 <font color="#000080">(</font><font color="#800000">$1300</font><font color="#000080">, </font>D<font color="#000080">, </font>FCB<font color="#000080">)
    </font><font color="#FF0000"><b>end
  end
end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>AddVol <font color="#000080">(</font>D <font color="#000080">: </font>Byte<font color="#000080">; </font>V <font color="#000080">: </font>VolumeName<font color="#000080">) : </font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>Var
  </b></font>sRec <font color="#000080">: </font>SearchRec<font color="#000080">;
  </font>FCB  <font color="#000080">: </font>VolFCB<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>AddVol <font color="#000080">:= </font>False<font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font>Valid_Drive_Num <font color="#000080">(</font>D<font color="#000080">) </font><font color="#FF0000"><b>then
  begin
    if not </b></font>Find_Vol <font color="#000080">(</font>D<font color="#000080">, </font>sRec<font color="#000080">) </font><font color="#FF0000"><b>then
    begin
      </b></font>Fix_Name <font color="#000080">(</font>V<font color="#000080">);
      </font>Fix_FCB_FileName <font color="#000080">(</font>V<font color="#000080">, </font>FCB<font color="#000080">);
      </font>AddVol <font color="#000080">:= </font>Vol_Int21 <font color="#000080">(</font><font color="#800000">$1600</font><font color="#000080">, </font>D<font color="#000080">, </font>FCB<font color="#000080">)
    </font><font color="#FF0000"><b>end
  end
end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>ChgVol <font color="#000080">(</font>D <font color="#000080">: </font>Byte<font color="#000080">; </font>V <font color="#000080">: </font>VolumeName<font color="#000080">) : </font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>Var
   </b></font>sRec <font color="#000080">: </font>SearchRec<font color="#000080">;
   </font>FCB  <font color="#000080">: </font>VolFCB<font color="#000080">;
   </font>x    <font color="#000080">: </font>Byte<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>ChgVol <font color="#000080">:= </font>False<font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font>Valid_Drive_Num <font color="#000080">(</font>D<font color="#000080">) </font><font color="#FF0000"><b>then
  begin
    if </b></font>Find_Vol <font color="#000080">(</font>D<font color="#000080">, </font>sRec<font color="#000080">) </font><font color="#FF0000"><b>then
    begin
      </b></font>x <font color="#000080">:= </font>Fix_Ext_Sym <font color="#000080">(</font>V<font color="#000080">);
      </font>Fix_Name <font color="#000080">(</font>V<font color="#000080">);
      </font>Fix_FCB_NewFile <font color="#000080">(</font>V<font color="#000080">, </font>FCB<font color="#000080">);
      </font>V <font color="#000080">:= </font>Extract_Name <font color="#000080">(</font>sRec<font color="#000080">);
      </font>Pad_Name <font color="#000080">(</font>V<font color="#000080">);
      </font>Fix_FCB_FileName <font color="#000080">(</font>V<font color="#000080">, </font>FCB<font color="#000080">);
      </font>ChgVol <font color="#000080">:= </font>Vol_Int21 <font color="#000080">(</font><font color="#800000">$1700</font><font color="#000080">, </font>D<font color="#000080">, </font>FCB<font color="#000080">)
    </font><font color="#FF0000"><b>end
  end
end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>GetVol <font color="#000080">(</font>D <font color="#000080">: </font>Byte<font color="#000080">) : </font>VolumeName<font color="#000080">;
</font><font color="#FF0000"><b>Var
  </b></font>sRec <font color="#000080">: </font>SearchRec<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>GetVol <font color="#000080">:= </font><font color="#800000">''</font><font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font>Valid_Drive_Num <font color="#000080">(</font>D<font color="#000080">) </font><font color="#FF0000"><b>then
    if </b></font>Find_Vol <font color="#000080">(</font>D<font color="#000080">, </font>sRec<font color="#000080">) </font><font color="#FF0000"><b>then
      </b></font>GetVol <font color="#000080">:= </font>Extract_Name <font color="#000080">(</font>sRec<font color="#000080">)
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>end</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to DRIVES SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0020.PAS">Original</a><b>]</b></p></body>
</html>
