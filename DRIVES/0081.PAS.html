<html>
<head><title> "VOLUME LABEL Program" by GREG VIGNEAULT</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to DRIVES SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0081.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
&gt;Can someone please tell me how to read the volume label off a hard
&gt;disk or floppy. I haven't been able to find any information on how
&gt;to do this.  Thanks for any help you can offer.

 Here's one way, which is valid for DOS 3.0 or higher...

}
</i></font><font color="#FF0000"><b>PROGRAM </b></font>VOLAB<font color="#000080">;                    </font><font color="#008000"><i>{ Read a disk volume label (TP4+) }
                                  { June 12, 1994. Greg Vigneault   }
</i></font><font color="#FF0000"><b>USES  </b></font>Dos<font color="#000080">;                              </font><font color="#008000"><i>{ import MsDos, Registers   }
</i></font><font color="#FF0000"><b>TYPE  </b></font>ASCIIZ  <font color="#000080">= </font><font color="#FF0000"><b>ARRAY </b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">255</font><font color="#000080">] </font><font color="#FF0000"><b>OF </b></font>CHAR<font color="#000080">; </font><font color="#008000"><i>{ ASCIIZ strings            }
</i></font><font color="#FF0000"><b>CONST </b></font>TAB     <font color="#000080">= </font><font color="#800000">#9</font><font color="#000080">;                     </font><font color="#008000"><i>{ ASCII horizontal tab      }
</i></font><font color="#FF0000"><b>VAR   </b></font>Drv     <font color="#000080">: </font>CHAR<font color="#000080">;                   </font><font color="#008000"><i>{ drive letter 'A'..'Z'     }
      </i></font>Volume  <font color="#000080">: </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">;                 </font><font color="#008000"><i>{ for volume label          }
      </i></font>Reg     <font color="#000080">: </font>Registers<font color="#000080">;              </font><font color="#008000"><i>{ to access CPU registers   }

</i></font><font color="#FF0000"><b>PROCEDURE </b></font>Asciiz2TP <font color="#000080">(</font>AStr<font color="#000080">:</font>ASCIIZ<font color="#000080">; </font><font color="#FF0000"><b>VAR </b></font>Temp<font color="#000080">:</font><font color="#FF0000"><b>STRING</b></font><font color="#000080">);
  </font><font color="#008000"><i>{ convert an ASCIIZ (DOS) string to a TP string }
  </i></font><font color="#FF0000"><b>VAR </b></font>Index<font color="#000080">:</font>BYTE<font color="#000080">; </font><font color="#FF0000"><b>BEGIN  </b></font>Index <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
    </font><font color="#FF0000"><b>WHILE </b></font><font color="#000080">(</font>Index <font color="#000080">&lt; </font><font color="#800000">255</font><font color="#000080">) </font><font color="#FF0000"><b>AND </b></font><font color="#000080">(</font>AStr<font color="#000080">[</font>Index<font color="#000080">] &lt;&gt; </font><font color="#800000">#0</font><font color="#000080">) </font><font color="#FF0000"><b>DO BEGIN
      </b></font>Temp<font color="#000080">[</font>Index<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">] := </font>AStr<font color="#000080">[</font>Index<font color="#000080">];;  </font>INC<font color="#000080">(</font>Index<font color="#000080">);
    </font><font color="#FF0000"><b>END</b></font><font color="#008000"><i>{WHILE}</i></font><font color="#000080">;;  </font>Temp<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">] := </font>CHR<font color="#000080">(</font>Index<font color="#000080">);
  </font><font color="#FF0000"><b>END </b></font><font color="#008000"><i>{Asciiz2TP}</i></font><font color="#000080">;

</font><font color="#FF0000"><b>PROCEDURE </b></font>TP2Asciiz <font color="#000080">(</font>TStr<font color="#000080">:</font><font color="#FF0000"><b>STRING</b></font><font color="#000080">; </font><font color="#FF0000"><b>VAR </b></font>Temp<font color="#000080">:</font>ASCIIZ<font color="#000080">);
  </font><font color="#008000"><i>{ convert a TP string to an ASCIIZ (DOS) string }
  </i></font><font color="#FF0000"><b>VAR </b></font>Index<font color="#000080">:</font>BYTE<font color="#000080">; </font><font color="#FF0000"><b>BEGIN </b></font>Index <font color="#000080">:= </font>ORD<font color="#000080">(</font>TStr<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">]);; </font>Temp<font color="#000080">[</font>Index<font color="#000080">] := </font><font color="#800000">#0</font><font color="#000080">;
    </font><font color="#FF0000"><b>WHILE </b></font><font color="#000080">(</font>Index <font color="#000080">&gt; </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>DO BEGIN
      </b></font>Temp<font color="#000080">[</font>Index<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">] := </font>TStr<font color="#000080">[</font>Index<font color="#000080">];;  </font>DEC<font color="#000080">(</font>Index<font color="#000080">);
    </font><font color="#FF0000"><b>END</b></font><font color="#008000"><i>{WHILE}</i></font><font color="#000080">;
  </font><font color="#FF0000"><b>END </b></font><font color="#008000"><i>{TP2Asciiz}</i></font><font color="#000080">;

</font><font color="#FF0000"><b>FUNCTION </b></font>GetVolLabel <font color="#000080">(</font>Drv<font color="#000080">:</font>CHAR<font color="#000080">):</font><font color="#FF0000"><b>STRING</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>VAR </b></font>Temp<font color="#000080">:</font>ASCIIZ<font color="#000080">; </font>Temp2<font color="#000080">:</font><font color="#FF0000"><b>STRING</b></font><font color="#000080">; </font>Index<font color="#000080">:</font>BYTE<font color="#000080">;  </font>seg0<font color="#000080">,</font>ofs0<font color="#000080">:</font>WORD<font color="#000080">;
      </font>DTA <font color="#000080">: </font><font color="#FF0000"><b>ARRAY </b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">127</font><font color="#000080">] </font><font color="#FF0000"><b>OF </b></font>CHAR<font color="#000080">; </font><font color="#FF0000"><b>BEGIN  </b></font>Temp2 <font color="#000080">:= </font><font color="#800000">''</font><font color="#000080">;
    </font><font color="#FF0000"><b>IF </b></font>Drv <font color="#FF0000"><b>IN </b></font><font color="#000080">[</font><font color="#800000">'A'</font><font color="#000080">..</font><font color="#800000">'Z'</font><font color="#000080">] </font><font color="#FF0000"><b>THEN BEGIN       </b></font><font color="#008000"><i>{ valid drive spec?       }
      </i></font>Reg<font color="#000080">.</font>AH <font color="#000080">:= </font><font color="#800000">$2F</font><font color="#000080">;; </font>MsDos<font color="#000080">(</font>Reg<font color="#000080">);         </font><font color="#008000"><i>{ get current DTA address }
      </i></font>seg0 <font color="#000080">:= </font>Reg<font color="#000080">.</font>ES<font color="#000080">;; </font>ofs0 <font color="#000080">:= </font>Reg<font color="#000080">.</font>BX<font color="#000080">;    </font><font color="#008000"><i>{ save the orig DTA       }
      </i></font>Reg<font color="#000080">.</font>DS <font color="#000080">:= </font>SEG<font color="#000080">(</font>DTA<font color="#000080">);; </font>Reg<font color="#000080">.</font>DX <font color="#000080">:= </font>OFS<font color="#000080">(</font>DTA<font color="#000080">);  </font><font color="#008000"><i>{ our local DTA     }
      </i></font>Reg<font color="#000080">.</font>AH <font color="#000080">:= </font><font color="#800000">$1A</font><font color="#000080">;; </font>MsDos<font color="#000080">(</font>Reg<font color="#000080">);               </font><font color="#008000"><i>{ activate our DTA  }
      </i></font>Temp2 <font color="#000080">:= </font><font color="#800000">'?:\*.*'</font><font color="#000080">;; </font>Temp2<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">] := </font>Drv<font color="#000080">;      </font><font color="#008000"><i>{ build filespec    }
      </i></font>TP2Asciiz <font color="#000080">(</font>Temp2<font color="#000080">, </font>Temp<font color="#000080">);                  </font><font color="#008000"><i>{ xlate to ASCIIZ   }
      </i></font>Reg<font color="#000080">.</font>DS <font color="#000080">:= </font>SEG<font color="#000080">(</font>Temp<font color="#000080">);; </font>Reg<font color="#000080">.</font>DX <font color="#000080">:= </font>OFS<font color="#000080">(</font>Temp<font color="#000080">);; </font>Reg<font color="#000080">.</font>CX <font color="#000080">:= </font><font color="#800000">8</font><font color="#000080">;
      </font>Reg<font color="#000080">.</font>AH <font color="#000080">:= </font><font color="#800000">$4E</font><font color="#000080">;; </font>MsDos<font color="#000080">(</font>Reg<font color="#000080">); </font><font color="#008000"><i>{ label search, then reset DTA... }
      </i></font>Reg<font color="#000080">.</font>DS <font color="#000080">:= </font>seg0<font color="#000080">;; </font>Reg<font color="#000080">.</font>DX <font color="#000080">:= </font>ofs0<font color="#000080">;; </font>Reg<font color="#000080">.</font>AH <font color="#000080">:= </font><font color="#800000">$1A</font><font color="#000080">;; </font>MsDos<font color="#000080">(</font>Reg<font color="#000080">);
      </font><font color="#FF0000"><b>IF NOT </b></font>ODD<font color="#000080">(</font>Reg<font color="#000080">.</font>FLAGS<font color="#000080">) </font><font color="#008000"><i>{ no DOS error? }
        </i></font><font color="#FF0000"><b>THEN FOR </b></font>Index <font color="#000080">:= </font><font color="#800000">$1E </font><font color="#FF0000"><b>TO </b></font><font color="#800000">$2A </font><font color="#FF0000"><b>DO </b></font>Temp<font color="#000080">[</font>Index<font color="#000080">-</font><font color="#800000">$1E</font><font color="#000080">] := </font>DTA<font color="#000080">[</font>Index<font color="#000080">]
        </font><font color="#FF0000"><b>ELSE </b></font>Temp<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">] := </font><font color="#800000">#0</font><font color="#000080">;             </font><font color="#008000"><i>{ if no volume label found  }
      </i></font>Asciiz2TP<font color="#000080">(</font>Temp<font color="#000080">, </font>Temp2<font color="#000080">);           </font><font color="#008000"><i>{ xlate DOS to TP string    }
      </i></font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>Length<font color="#000080">(</font>Temp2<font color="#000080">) &gt; </font><font color="#800000">8</font><font color="#000080">) </font><font color="#FF0000"><b>AND </b></font><font color="#000080">(</font>Temp2<font color="#000080">[</font><font color="#800000">9</font><font color="#000080">] = </font><font color="#800000">'.'</font><font color="#000080">) </font><font color="#008000"><i>{ if 8/3 format   }
        </i></font><font color="#FF0000"><b>THEN </b></font>Delete <font color="#000080">(</font>Temp2<font color="#000080">,</font><font color="#800000">9</font><font color="#000080">,</font><font color="#800000">1</font><font color="#000080">);
    </font><font color="#FF0000"><b>END</b></font><font color="#008000"><i>{IF Drv}</i></font><font color="#000080">;
    </font>GetVolLabel <font color="#000080">:= </font>Temp2<font color="#000080">;
  </font><font color="#FF0000"><b>END </b></font><font color="#008000"><i>{GetVolLabel}</i></font><font color="#000080">;

</font><font color="#FF0000"><b>BEGIN </b></font><font color="#008000"><i>{VOLAB: here we go...}

  </i></font>WriteLn<font color="#000080">;; </font>WriteLn <font color="#000080">(</font>TAB<font color="#000080">,</font><font color="#800000">'ReadVOL v0.01 Greg Vigneault'</font><font color="#000080">);; </font>WriteLn<font color="#000080">;
  </font><font color="#FF0000"><b>REPEAT
    </b></font>Write <font color="#000080">(</font>TAB<font color="#000080">,</font><font color="#800000">'Read volume label from which drive [A..Z] ? '</font><font color="#000080">);
    </font>Read <font color="#000080">(</font>Drv<font color="#000080">);;  </font>Drv <font color="#000080">:= </font>UpCase<font color="#000080">(</font>Drv<font color="#000080">);
  </font><font color="#FF0000"><b>UNTIL </b></font>Drv <font color="#FF0000"><b>IN </b></font><font color="#000080">[</font><font color="#800000">'A'</font><font color="#000080">..</font><font color="#800000">'Z'</font><font color="#000080">];
  </font>Volume <font color="#000080">:= </font>GetVolLabel <font color="#000080">(</font>Drv<font color="#000080">);;  </font>WriteLn<font color="#000080">;
  </font><font color="#FF0000"><b>IF </b></font>Length<font color="#000080">(</font>Volume<font color="#000080">) &lt;&gt; </font><font color="#800000">0
    </font><font color="#FF0000"><b>THEN </b></font>WriteLn <font color="#000080">(</font>TAB<font color="#000080">,</font><font color="#800000">'Volume in drive '</font><font color="#000080">,</font>Drv<font color="#000080">,</font><font color="#800000">': is '</font><font color="#000080">, </font>Volume<font color="#000080">)
    </font><font color="#FF0000"><b>ELSE </b></font>WriteLn <font color="#000080">(</font>TAB<font color="#000080">,</font><font color="#800000">'No label for volume in drive '</font><font color="#000080">,</font>Drv<font color="#000080">,</font><font color="#800000">':'</font><font color="#000080">);
  </font>WriteLn<font color="#000080">;

</font><font color="#FF0000"><b>END </b></font><font color="#008000"><i>{VOLAB}</i></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to DRIVES SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0081.PAS">Original</a><b>]</b></p></body>
</html>
