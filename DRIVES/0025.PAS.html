<html>
<head><title> "Disk Serial Numbers" by LAWRENCE JOHNSTONE</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to DRIVES SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0025.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>(*
Date: 07-10-93 (02:15)
From: LAWRENCE JOHNSTONE
Subj: DISK'S SERIAL NUMBER.
This will work under DOS 4.0 or later, according to Microsoft's MS-DOS
Programmer's Reference (earlier versions of DOS didn't give disks
serial numbers).
*)

</i></font><font color="#FF0000"><b>UNIT </b></font>MediaID<font color="#000080">;

</font><font color="#FF0000"><b>INTERFACE

TYPE
  </b></font>TMediaID <font color="#000080">= </font><font color="#FF0000"><b>RECORD
    </b></font>InfoLvl<font color="#000080">:   </font>WORD<font color="#000080">;
    </font>SerialNum<font color="#000080">: </font>LONGINT<font color="#000080">;
    </font>VolLabel<font color="#000080">:  </font><font color="#FF0000"><b>ARRAY </b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">11</font><font color="#000080">] </font><font color="#FF0000"><b>OF </b></font>CHAR<font color="#000080">;
    </font>FileSys<font color="#000080">:   </font><font color="#FF0000"><b>ARRAY </b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">8</font><font color="#000080">] </font><font color="#FF0000"><b>OF </b></font>CHAR<font color="#000080">;
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>FUNCTION </b></font>GetMediaID<font color="#000080">( </font>Drive<font color="#000080">: </font>WORD<font color="#000080">; </font><font color="#FF0000"><b>VAR </b></font>MID<font color="#000080">:  </font>TMediaID <font color="#000080">): </font>BOOLEAN<font color="#000080">;
  </font><font color="#008000"><i>(* Drive:  0=default, 1=A, 2=B, etc. *)

</i></font><font color="#FF0000"><b>FUNCTION </b></font>SetMediaID<font color="#000080">( </font>Drive<font color="#000080">: </font>WORD<font color="#000080">; </font><font color="#FF0000"><b>CONST </b></font>MID<font color="#000080">: </font>TMediaID <font color="#000080">): </font>BOOLEAN<font color="#000080">;

</font><font color="#FF0000"><b>IMPLEMENTATION

FUNCTION </b></font>GetMediaID<font color="#000080">( </font>Drive<font color="#000080">: </font>WORD<font color="#000080">; </font><font color="#FF0000"><b>VAR </b></font>MID<font color="#000080">: </font>TMediaID <font color="#000080">): </font>BOOLEAN<font color="#000080">;  </font><font color="#FF0000"><b>ASSEMBLER</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>ASM
    </b></font><font color="#FF00FF">push ds
    mov  bx, [Drive]
    mov  ch, $08       </font><font color="#008000"><i>(* Device category (must be 08h) *)
    </i></font><font color="#FF00FF">mov  cl, $66       </font><font color="#008000"><i>(* Minor code for Get Media ID function *)
    </i></font><font color="#FF00FF">lds  dx, [MID]     </font><font color="#008000"><i>(* DS:DX -&gt; TMediaID structure *)
    </i></font><font color="#FF00FF">mov  ax, $440D     </font><font color="#008000"><i>(* Function 44 (IOCTL), subfunction 0D *)
    </i></font><font color="#FF00FF">int  $21
    pop  ds
    mov  ax, 0         </font><font color="#008000"><i>(* Assume function failed *)
    </i></font><font color="#FF00FF">jc   @@Done
    inc  ax            </font><font color="#008000"><i>(* Didn't fail -- return TRUE *)
  </i></font><font color="#FF00FF">@@Done:
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>FUNCTION </b></font>SetMediaID<font color="#000080">( </font>Drive<font color="#000080">: </font>WORD<font color="#000080">; </font><font color="#FF0000"><b>CONST </b></font>MID<font color="#000080">: </font>TMediaID <font color="#000080">): </font>BOOLEAN<font color="#000080">;  </font><font color="#FF0000"><b>ASSEMBLER</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>ASM
    </b></font><font color="#FF00FF">push ds
    mov  bx, [Drive]
    mov  ch, $08       </font><font color="#008000"><i>(* Device category (must be 08h) *)
    </i></font><font color="#FF00FF">mov  cl, $46       </font><font color="#008000"><i>(* Minor code for Set Media ID function *)
    </i></font><font color="#FF00FF">lds  dx, [MID]     </font><font color="#008000"><i>(* DS:DX -&gt; TMediaID structure *)
    </i></font><font color="#FF00FF">mov  ax, $440D     </font><font color="#008000"><i>(* Function 44 (IOCTL), subfunction 0D *)
    </i></font><font color="#FF00FF">int  $21
    pop  ds
    mov  ax, 0         </font><font color="#008000"><i>(* Assume function failed *)
    </i></font><font color="#FF00FF">jc   @@Done
    inc  ax            </font><font color="#008000"><i>(* Didn't fail -- return TRUE *)
  </i></font><font color="#FF00FF">@@Done:
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;


</font><font color="#FF0000"><b>END</b></font><font color="#000080">.

</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to DRIVES SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0025.PAS">Original</a><b>]</b></p></body>
</html>
