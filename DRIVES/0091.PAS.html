<html>
<head><title> "CD-ROM Disksize" by NORBERT IGL</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to DRIVES SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0091.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code>
<font color="#008000"><i>{
 KB&gt; How do get the disk size or the total clusters on a CD-ROM?
}

 </i></font><font color="#FF0000"><b>program </b></font>CD_Info<font color="#000080">;

 </font><font color="#FF0000"><b>uses </b></font>crt<font color="#000080">, </font>dos<font color="#000080">;

 </font><font color="#FF0000"><b>Type   </b></font>tReq_Blk <font color="#000080">= </font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">255</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Byte<font color="#000080">;
        </font>tReq_Hdr <font color="#000080">= </font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">017</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Word<font color="#000080">;

 </font><font color="#FF0000"><b>Const  </b></font>MSCDEX_GETDRIVES  <font color="#000080">= </font><font color="#800000">$1500</font><font color="#000080">;
        </font>MSCDEX_GETVERSION <font color="#000080">= </font><font color="#800000">$150C</font><font color="#000080">;
        </font>MSCDEX_DRIVER_REQ <font color="#000080">= </font><font color="#800000">$1510</font><font color="#000080">;

        </font>MSCDEX_GetSecSize <font color="#000080">= </font><font color="#800000">7</font><font color="#000080">;
        </font>MSCDEX_GetVolSize <font color="#000080">= </font><font color="#800000">8</font><font color="#000080">;

        </font>RAW_DATA          <font color="#000080">= </font><font color="#800000">1</font><font color="#000080">;

 </font><font color="#FF0000"><b>Var    </b></font>CPU             <font color="#000080">: </font>Registers<font color="#000080">;
        </font>Akt<font color="#000080">, </font>Cnt<font color="#000080">, </font>First <font color="#000080">: </font>byte<font color="#000080">;
        </font>Req_Hdr         <font color="#000080">: </font>tReq_Hdr<font color="#000080">;
        </font>Req_Blk         <font color="#000080">: </font>tReq_Blk<font color="#000080">;
        </font>SecSize         <font color="#000080">: </font>word<font color="#000080">;
        </font>VolBytes        <font color="#000080">: </font>real<font color="#000080">;
        </font>VolSize         <font color="#000080">: </font>LongInt<font color="#000080">;

 </font><font color="#FF0000"><b>function </b></font>CallDriver<font color="#000080">( </font><font color="#FF0000"><b>Var </b></font>R<font color="#000080">: </font>Registers <font color="#000080">):</font>byte<font color="#000080">;
 </font><font color="#FF0000"><b>begin
   </b></font>Intr<font color="#000080">(</font><font color="#800000">$2F</font><font color="#000080">, </font>R<font color="#000080">);
   </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>R<font color="#000080">.</font>FLAGS <font color="#FF0000"><b>and </b></font>FCARRY<font color="#000080">) &lt;&gt; </font><font color="#800000">0
     </font><font color="#FF0000"><b>then </b></font>CallDriver <font color="#000080">:= </font>R<font color="#000080">.</font>AL
     <font color="#FF0000"><b>else </b></font>CallDriver <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
 </font><font color="#FF0000"><b>end</b></font><font color="#000080">;



 </font><font color="#FF0000"><b>begin
   </b></font>writeln<font color="#000080">; </font>writeln<font color="#000080">;
   </font>writeln<font color="#000080">(</font><font color="#800000">' CD-ROM Info v1.0           (c)  Norbert Igl 1994 '</font><font color="#000080">);
   </font>writeln<font color="#000080">;
   </font><font color="#FF0000"><b>With </b></font>CPU <font color="#FF0000"><b>do
   begin
     </b></font>FillChar<font color="#000080">( </font>CPU<font color="#000080">, </font>Sizeof<font color="#000080">( </font>CPU <font color="#000080">), </font><font color="#800000">0</font><font color="#000080">);
     </font>AX <font color="#000080">:= </font>MSCDEX_GETVERSION<font color="#000080">;
     </font><font color="#FF0000"><b>If </b></font>CallDriver<font color="#000080">( </font>CPU <font color="#000080">) &lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then
     begin
       </b></font>writeln<font color="#000080">(</font><font color="#800000">' MSCDEX not installed ... '</font><font color="#000080">);
       </font>halt<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">);
     </font><font color="#FF0000"><b>end
     else begin
       </b></font>writeln<font color="#000080">(</font><font color="#800000">' MSCDEX Version   : '</font><font color="#000080">,</font>Hi<font color="#000080">(</font>BX<font color="#000080">),</font><font color="#800000">'.'</font><font color="#000080">,</font>Lo<font color="#000080">(</font>BX<font color="#000080">):</font><font color="#800000">2 </font><font color="#000080">);
     </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

     </font>FillChar<font color="#000080">( </font>CPU<font color="#000080">, </font>Sizeof<font color="#000080">( </font>CPU <font color="#000080">), </font><font color="#800000">0</font><font color="#000080">);
     </font>AX <font color="#000080">:= </font>MSCDEX_GETDRIVES<font color="#000080">;
     </font><font color="#FF0000"><b>If </b></font>CallDriver<font color="#000080">( </font>CPU <font color="#000080">) &lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then
     begin
       </b></font>writeln<font color="#000080">(</font><font color="#800000">' GETDRIVES Error  : '</font><font color="#000080">,</font>Lo<font color="#000080">(</font>AX<font color="#000080">) );
       </font>halt<font color="#000080">(</font><font color="#800000">2</font><font color="#000080">);
     </font><font color="#FF0000"><b>end
     else begin
       </b></font>Cnt   <font color="#000080">:= </font>BX<font color="#000080">;
       </font>First <font color="#000080">:= </font>CX<font color="#000080">;
       </font>write<font color="#000080">(</font><font color="#800000">' Installed Drives : '</font><font color="#000080">,</font>Cnt<font color="#000080">,</font><font color="#800000">' ( '</font><font color="#000080">);
       </font>write<font color="#000080">( </font>CHAR<font color="#000080">( </font><font color="#800000">65</font><font color="#000080">+</font>first <font color="#000080">),</font><font color="#800000">':'</font><font color="#000080">);
       </font><font color="#FF0000"><b>if </b></font>Cnt <font color="#000080">&gt; </font><font color="#800000">1 </font><font color="#FF0000"><b>then
         </b></font>write<font color="#000080">(</font><font color="#800000">' .. '</font><font color="#000080">, </font>CHAR<font color="#000080">( </font><font color="#800000">64</font><font color="#000080">+</font>first<font color="#000080">+</font>cnt<font color="#000080">),</font><font color="#800000">':'</font><font color="#000080">);
       </font>writeln<font color="#000080">(</font><font color="#800000">' )'</font><font color="#000080">);
     </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
     </font><font color="#FF0000"><b>For </b></font>Akt <font color="#000080">:= </font>First <font color="#FF0000"><b>to </b></font>First<font color="#000080">+</font>Cnt<font color="#000080">-</font><font color="#800000">1 </font><font color="#FF0000"><b>do
     begin
       </b></font>FillChar<font color="#000080">( </font>CPU<font color="#000080">, </font>Sizeof<font color="#000080">( </font>CPU <font color="#000080">), </font><font color="#800000">0</font><font color="#000080">);
       </font>FillChar<font color="#000080">( </font>Req_Blk<font color="#000080">, </font>Sizeof<font color="#000080">( </font>Req_Blk <font color="#000080">), </font><font color="#800000">0</font><font color="#000080">);
       </font>FillChar<font color="#000080">( </font>Req_Hdr<font color="#000080">, </font>Sizeof<font color="#000080">( </font>Req_Hdr <font color="#000080">), </font><font color="#800000">0</font><font color="#000080">);

       </font>Req_Hdr<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">] := </font><font color="#800000">$000D</font><font color="#000080">;  </font><font color="#008000"><i>{ length of req_hdr }
       </i></font>Req_Hdr<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">] := </font><font color="#800000">$0003</font><font color="#000080">;  </font><font color="#008000"><i>{ IOCTL_READ }
       </i></font>Req_Hdr<font color="#000080">[</font><font color="#800000">7</font><font color="#000080">] := </font>Ofs<font color="#000080">(</font>Req_Blk<font color="#000080">);
       </font>Req_Hdr<font color="#000080">[</font><font color="#800000">8</font><font color="#000080">] := </font>Seg<font color="#000080">(</font>Req_Blk<font color="#000080">);
       </font>Req_Hdr<font color="#000080">[</font><font color="#800000">9</font><font color="#000080">] := </font><font color="#800000">$0004</font><font color="#000080">;

       </font>Req_Blk<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">] := </font>MSCDEX_GetSecSize<font color="#000080">;

       </font>AX <font color="#000080">:= </font>MSCDEX_DRIVER_REQ<font color="#000080">;
       </font>CX <font color="#000080">:= </font>Akt<font color="#000080">;
       </font>ES <font color="#000080">:= </font>SEG<font color="#000080">( </font>Req_Hdr <font color="#000080">);
       </font>BX <font color="#000080">:= </font>OFS<font color="#000080">( </font>Req_Hdr <font color="#000080">);
       </font><font color="#FF0000"><b>If </b></font>CallDriver<font color="#000080">( </font>CPU <font color="#000080">) &lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then
       begin
         </b></font>writeln<font color="#000080">(</font><font color="#800000">' GetSecSize Drive('</font><font color="#000080">,</font>Char<font color="#000080">(</font>Akt<font color="#000080">+</font><font color="#800000">65</font><font color="#000080">),</font><font color="#800000">') Error  : '</font><font color="#000080">,</font>Lo<font color="#000080">(</font>AX<font color="#000080">) );
       </font><font color="#FF0000"><b>end
       else </b></font>Move<font color="#000080">(</font>Req_Blk<font color="#000080">[</font><font color="#800000">2</font><font color="#000080">], </font>SecSize<font color="#000080">, </font><font color="#800000">2</font><font color="#000080">);

       </font>FillChar<font color="#000080">( </font>CPU<font color="#000080">, </font>Sizeof<font color="#000080">( </font>CPU <font color="#000080">), </font><font color="#800000">0</font><font color="#000080">);
       </font>FillChar<font color="#000080">( </font>Req_Blk<font color="#000080">, </font>Sizeof<font color="#000080">( </font>Req_Blk <font color="#000080">), </font><font color="#800000">0</font><font color="#000080">);
       </font>FillChar<font color="#000080">( </font>Req_Hdr<font color="#000080">, </font>Sizeof<font color="#000080">( </font>Req_Hdr <font color="#000080">), </font><font color="#800000">0</font><font color="#000080">);

       </font>Req_Hdr<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">] := </font><font color="#800000">$000D</font><font color="#000080">;  </font><font color="#008000"><i>{ length of req_hdr }
       </i></font>Req_Hdr<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">] := </font><font color="#800000">$0003</font><font color="#000080">;  </font><font color="#008000"><i>{ IOCTL_READ }
       </i></font>Req_Hdr<font color="#000080">[</font><font color="#800000">7</font><font color="#000080">] := </font>Ofs<font color="#000080">(</font>Req_Blk<font color="#000080">);
       </font>Req_Hdr<font color="#000080">[</font><font color="#800000">8</font><font color="#000080">] := </font>Seg<font color="#000080">(</font>Req_Blk<font color="#000080">);
       </font>Req_Hdr<font color="#000080">[</font><font color="#800000">9</font><font color="#000080">] := </font><font color="#800000">$0005</font><font color="#000080">;

       </font>Req_Blk<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">] := </font>MSCDEX_GetVolSize<font color="#000080">;;

       </font>AX <font color="#000080">:= </font>MSCDEX_DRIVER_REQ<font color="#000080">;
       </font>CX <font color="#000080">:= </font>Akt<font color="#000080">;
       </font>ES <font color="#000080">:= </font>SEG<font color="#000080">( </font>Req_Hdr <font color="#000080">);
       </font>BX <font color="#000080">:= </font>OFS<font color="#000080">( </font>Req_Hdr <font color="#000080">);
       </font><font color="#FF0000"><b>If </b></font>CallDriver<font color="#000080">( </font>CPU <font color="#000080">) &lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then
       begin
         </b></font>writeln<font color="#000080">(</font><font color="#800000">' GetVolSize Drive('</font><font color="#000080">,</font>Char<font color="#000080">(</font>Akt<font color="#000080">+</font><font color="#800000">65</font><font color="#000080">),</font><font color="#800000">') Error  : '</font><font color="#000080">,</font>Lo<font color="#000080">(</font>AX<font color="#000080">) );
       </font><font color="#FF0000"><b>end
       else </b></font>Move<font color="#000080">(</font>Req_Blk<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">], </font>VolSize<font color="#000080">, </font><font color="#800000">4</font><font color="#000080">);

       </font>VolBytes <font color="#000080">:= </font>VolSize<font color="#000080">;
       </font><font color="#FF0000"><b>if </b></font>VolBytes <font color="#000080">&lt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then
       begin
         </b></font>VolSize <font color="#000080">:=  ( </font>VolSize <font color="#FF0000"><b>shr </b></font><font color="#800000">1 </font><font color="#000080">);
         </font>VolBytes <font color="#000080">:= </font>Volsize<font color="#000080">;
         </font>VolBytes <font color="#000080">:= </font>VolBytes<font color="#000080">*</font><font color="#800000">2</font><font color="#000080">;
       </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
       </font>VolBytes <font color="#000080">:= </font>Volbytes <font color="#000080">* </font>SecSize<font color="#000080">;
       </font>VolBytes <font color="#000080">:= </font>Volbytes <font color="#000080">/ ( </font><font color="#800000">1024</font><font color="#000080">*</font><font color="#800000">1024 </font><font color="#000080">);
       </font>Writeln<font color="#000080">(</font><font color="#800000">' Disk in Drive '</font><font color="#000080">,</font>Char<font color="#000080">(</font>Akt<font color="#000080">+</font><font color="#800000">65</font><font color="#000080">),</font><font color="#800000">'  : '</font><font color="#000080">,</font>VolBytes<font color="#000080">:</font><font color="#800000">6</font><font color="#000080">:</font><font color="#800000">2 </font><font color="#000080">,</font><font color="#800000">' MB '</font><font color="#000080">);
     </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
   </font><font color="#FF0000"><b>end
 end</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to DRIVES SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0091.PAS">Original</a><b>]</b></p></body>
</html>
