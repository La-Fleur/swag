<html>
<head><title> "Another IS DRIVE READY" by GAYLE DAVIS</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to DRIVES SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0011.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
Author : GAYLE DAVIS

&gt; It will check For example, drive A:, and if there is no disk in the
&gt;drive it will return False, if it is ready it will return True..

There is a problem that you will have to deal With here from the beginning.
First of all Dos can't easily tell if the problem is that you drive door is
open, say in drive 'A', or if the disk is unformatted or unreadable.  Here
is some code that I use to solve the problem using INT25.  do not TRY THIS
ON A HARD DRIVE.
}
</i></font><font color="#FF0000"><b>Uses
  </b></font>Dos<font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>DisketteDrives <font color="#000080">: </font>Integer<font color="#000080">;
</font><font color="#FF0000"><b>Var
  </b></font>Regs <font color="#000080">: </font>Registers<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>FILLChar <font color="#000080">(</font>Regs<font color="#000080">, </font>SIZEOF <font color="#000080">(</font>Regs<font color="#000080">), </font><font color="#800000">#0</font><font color="#000080">);
  </font>INTR <font color="#000080">(</font><font color="#800000">$11</font><font color="#000080">, </font>Regs<font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font>Regs<font color="#000080">.</font>AX <font color="#FF0000"><b>and </b></font><font color="#800000">$0001 </font><font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>then
    </b></font>DisketteDrives <font color="#000080">:= </font><font color="#800000">0
  </font><font color="#FF0000"><b>else
    </b></font>DisketteDrives <font color="#000080">:= ( (</font>Regs<font color="#000080">.</font>AX <font color="#FF0000"><b>SHL </b></font><font color="#800000">8</font><font color="#000080">) </font><font color="#FF0000"><b>SHR </b></font><font color="#800000">14</font><font color="#000080">) + </font><font color="#800000">1</font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>IsDriveReady <font color="#000080">(</font>DriveSpec <font color="#000080">: </font>Char<font color="#000080">) : </font>Boolean<font color="#000080">; </font><font color="#008000"><i>{A,B,etc}
</i></font><font color="#FF0000"><b>Var
  </b></font>result <font color="#000080">: </font>Word<font color="#000080">;
  </font>Drive<font color="#000080">,
  </font>number<font color="#000080">,
  </font>logical <font color="#000080">: </font>Word<font color="#000080">;
  </font>buf    <font color="#000080">: </font><font color="#FF0000"><b>Array </b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">512</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Byte<font color="#000080">;
  </font>Regs   <font color="#000080">: </font>Registers<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>IsDriveReady <font color="#000080">:= </font>True<font color="#000080">;     </font><font color="#008000"><i>{ Assume True to start }
  </i></font>Drive   <font color="#000080">:= </font>ORD <font color="#000080">(</font>UPCASE <font color="#000080">(</font>DriveSpec<font color="#000080">) ) - </font><font color="#800000">65</font><font color="#000080">;  </font><font color="#008000"><i>{ 0=a, 1=b, etc }

  </i></font><font color="#FF0000"><b>if </b></font>Drive <font color="#000080">&gt; </font>DisketteDrives <font color="#FF0000"><b>then
    </b></font>Exit<font color="#000080">;  </font><font color="#008000"><i>{ do not CHECK HARD DRIVES }

  </i></font>number  <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;
  </font>logical <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;

  </font><font color="#FF0000"><b>Inline </b></font><font color="#000080">(
    </font><font color="#800000">$55 </font><font color="#000080">/                       </font><font color="#008000"><i>{ PUSH BP         ; Interrupt 25 trashes all}
    </i></font><font color="#800000">$1E </font><font color="#000080">/                       </font><font color="#008000"><i>{ PUSH DS         ; Store DS                }
    </i></font><font color="#800000">$33 </font><font color="#000080">/ </font><font color="#800000">$C0 </font><font color="#000080">/                 </font><font color="#008000"><i>{ xor  AX,AX      ; set AX to zero          }
    </i></font><font color="#800000">$89 </font><font color="#000080">/ </font><font color="#800000">$86 </font><font color="#000080">/ </font>result <font color="#000080">/        </font><font color="#008000"><i>{ MOV  Result, AX ; Move AX to Result       }
    </i></font><font color="#800000">$8A </font><font color="#000080">/ </font><font color="#800000">$86 </font><font color="#000080">/ </font>Drive <font color="#000080">/         </font><font color="#008000"><i>{ MOV  AL, Drive  ; Move Drive to AL        }
    </i></font><font color="#800000">$8B </font><font color="#000080">/ </font><font color="#800000">$8E </font><font color="#000080">/ </font>number <font color="#000080">/        </font><font color="#008000"><i>{ MOV  CX, Number ; Move Number to CX       }
    </i></font><font color="#800000">$8B </font><font color="#000080">/ </font><font color="#800000">$96 </font><font color="#000080">/ </font>logical <font color="#000080">/       </font><font color="#008000"><i>{ MOV  DX, Logical; Move Logical to DX      }
    </i></font><font color="#800000">$C5 </font><font color="#000080">/ </font><font color="#800000">$9e </font><font color="#000080">/ </font>buf <font color="#000080">/           </font><font color="#008000"><i>{ LDS  BX, Buf    ; Move Buf to DS:BX       }
    </i></font><font color="#800000">$CD </font><font color="#000080">/ </font><font color="#800000">$25 </font><font color="#000080">/                 </font><font color="#008000"><i>{ INT  25h        ; Call interrupt $25      }
    </i></font><font color="#800000">$5B </font><font color="#000080">/                       </font><font color="#008000"><i>{ POP  BX         ; Remove the flags valu fr}
    </i></font><font color="#800000">$1F </font><font color="#000080">/                       </font><font color="#008000"><i>{ POP  DS         ; Restore DS              }
    </i></font><font color="#800000">$5D </font><font color="#000080">/                       </font><font color="#008000"><i>{ POP  BP         ; Restore BP              }
    </i></font><font color="#800000">$73 </font><font color="#000080">/ </font><font color="#800000">$04 </font><font color="#000080">/                 </font><font color="#008000"><i>{ JNB  Done       ; Jump ...                }
    </i></font><font color="#800000">$89 </font><font color="#000080">/ </font><font color="#800000">$86 </font><font color="#000080">/ </font>result<font color="#000080">);        </font><font color="#008000"><i>{ MOV  Result, AX ; move error code to AX   }
  { Done: }

  </i></font>IsDriveReady <font color="#000080">:= (</font>result <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>(*
Also, you could change the ISDRIVEREADY Function if you wanted to find out
WHY the drive isn't ready by checking the LO(result). Like this :

  if result &lt;&gt; 0 then
  begin
    Case LO (result) OF
      0     : FloppyState := WritePROTECT; { should not ever happen }
      1..4  : FloppyState := DOOROPEN;
      5..12 : FloppyState := NOFORMAT;
      else
        FloppyState := DOOROPEN;
    end
  end
  else
    FloppyState := DRIVEREADY;
*)
</i></font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to DRIVES SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0011.PAS">Original</a><b>]</b></p></body>
</html>
