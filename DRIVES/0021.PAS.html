<html>
<head><title> "Another Volume Label" by SWAG SUPPORT TEAM</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to DRIVES SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0021.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
Could somebody help me out here? I'm trying to Write a
Program that reads the File names and their attributes from
disk/drive.

Unit volLabel;

  Type String11 = String[11];
  Function  GetCurrentVolumeLabel : String11;
  Procedure DelVolumeLabel(CurrentVolumeLabel:String11);
  Procedure WriteVolumeLabel(CurrentVolumeLabel:String11);
  ( to change a volume Label: delete old, then Write new )
}

(* Implementation *)

</i></font><font color="#FF0000"><b>Uses
  </b></font>Dos<font color="#000080">;

</font><font color="#FF0000"><b>Var
  </b></font>oldir <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">; </font><font color="#008000"><i>{ only For test Program }

</i></font><font color="#FF0000"><b>Type
  </b></font>ExtendedFCBType <font color="#000080">= </font><font color="#FF0000"><b>Record
                      </b></font>ExtendedFCBflag <font color="#000080">: </font>Byte<font color="#000080">;
                      </font>Reserved1       <font color="#000080">: </font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">5</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Byte<font color="#000080">;
                      </font>Attr            <font color="#000080">: </font>Byte<font color="#000080">;
                      </font>DriveID         <font color="#000080">: </font>Byte<font color="#000080">;
                      </font>FileName        <font color="#000080">: </font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">8</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Char<font color="#000080">;
                      </font>FileExt         <font color="#000080">: </font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">3</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Char<font color="#000080">;
                      </font>CurrentBlockNum <font color="#000080">: </font>Word<font color="#000080">;
                      </font>RecordSize      <font color="#000080">: </font>Word<font color="#000080">;
                      </font>FileSize        <font color="#000080">: </font>LongInt<font color="#000080">;
                      </font>PackedDate      <font color="#000080">: </font>Word<font color="#000080">;
                      </font>PackedTime      <font color="#000080">: </font>Word<font color="#000080">;
                      </font>Reserved2       <font color="#000080">: </font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">8</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Byte<font color="#000080">;
                      </font>CurrentRecNum   <font color="#000080">: </font>Byte<font color="#000080">;
                      </font>RandomRecNum    <font color="#000080">: </font>LongInt<font color="#000080">;
                    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Type </b></font>String11 <font color="#000080">= </font><font color="#FF0000"><b>String</b></font><font color="#000080">[</font><font color="#800000">11</font><font color="#000080">];
</font><font color="#FF0000"><b>Function </b></font>GetCurrentVolumeLabel <font color="#000080">: </font>String11<font color="#000080">;
</font><font color="#FF0000"><b>Var
  </b></font>CurrentDrive<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
  </font>VolumeLabel <font color="#000080">: </font>SearchRec<font color="#000080">;  </font><font color="#008000"><i>{ defined in the Dos Unit }
  </i></font>i <font color="#000080">: </font>Word<font color="#000080">;
</font><font color="#FF0000"><b>begin                    </b></font><font color="#008000"><i>{ 12345678901 }
  </i></font>GetCurrentVolumeLabel<font color="#000080">:= </font><font color="#800000">'no Label   '</font><font color="#000080">;
  </font>getdir<font color="#000080">(</font><font color="#800000">0</font><font color="#000080">,</font>CurrentDrive<font color="#000080">); </font><font color="#008000"><i>{in Dos Unit }
  </i></font>CurrentDrive<font color="#000080">:= </font>copy<font color="#000080">(</font>CurrentDrive<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">3</font><font color="#000080">) + </font><font color="#800000">'*.*'</font><font color="#000080">;
  </font><font color="#008000"><i>{get Volume Label in A: drive}
  </i></font>findfirst<font color="#000080">(</font>CurrentDrive<font color="#000080">,</font>VolumeID<font color="#000080">,</font>VolumeLabel<font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font>Doserror<font color="#000080">=</font><font color="#800000">0 </font><font color="#FF0000"><b>then
    With </b></font>VolumeLabel <font color="#FF0000"><b>do
      begin
        </b></font><font color="#008000"><i>{remove period}
        </i></font>delete<font color="#000080">(</font>VolumeLabel<font color="#000080">.</font>name<font color="#000080">,</font>pos<font color="#000080">(</font><font color="#800000">'.'</font><font color="#000080">,</font>VolumeLabel<font color="#000080">.</font>name<font color="#000080">),</font><font color="#800000">1</font><font color="#000080">);
        </font><font color="#008000"><i>{ pad to 11 Chars }
        </i></font><font color="#FF0000"><b>For </b></font>i<font color="#000080">:= </font>length<font color="#000080">(</font>name<font color="#000080">) </font><font color="#FF0000"><b>to </b></font><font color="#800000">11 </font><font color="#FF0000"><b>do </b></font>name<font color="#000080">:= </font>name <font color="#000080">+ </font><font color="#800000">' '</font><font color="#000080">;
        </font>GetCurrentVolumeLabel<font color="#000080">:= </font>name<font color="#000080">;
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{ With VolumeLabel}
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{of GetCurrentVolumeLabel }

</i></font><font color="#FF0000"><b>Procedure </b></font>DelVolumeLabel<font color="#000080">(</font>CurrentVolumeLabel<font color="#000080">:</font>String11<font color="#000080">);
</font><font color="#008000"><i>{delete volume Label from disk in current drive}
</i></font><font color="#FF0000"><b>Var
  </b></font>regs <font color="#000080">: </font>Registers<font color="#000080">;
  </font>FCB  <font color="#000080">: </font>ExtendedFCBType<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>fillChar<font color="#000080">(</font>FCB<font color="#000080">,</font>sizeof<font color="#000080">(</font>FCB<font color="#000080">),</font><font color="#800000">#0</font><font color="#000080">);  </font><font color="#008000"><i>{initialize FCB With nulls }
  </i></font><font color="#FF0000"><b>With </b></font>FCB <font color="#FF0000"><b>do
    begin
      </b></font>ExtendedFCBflag<font color="#000080">:= </font><font color="#800000">$ff</font><font color="#000080">;      </font><font color="#008000"><i>{ always }
      </i></font>Attr           <font color="#000080">:= </font>VolumeID<font color="#000080">; </font><font color="#008000"><i>{defined in the Dos Unit}
      </i></font>DriveID        <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;        </font><font color="#008000"><i>{default drive}
      </i></font>move<font color="#000080">(</font>CurrentVolumeLabel<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">],</font>FileName<font color="#000080">,</font><font color="#800000">8</font><font color="#000080">); </font><font color="#008000"><i>{you have to put these in}
     </i></font>move<font color="#000080">(</font>CurrentVolumeLabel<font color="#000080">[</font><font color="#800000">9</font><font color="#000080">],</font>FileExt <font color="#000080">,</font><font color="#800000">3</font><font color="#000080">); </font><font color="#008000"><i>{For some silly reason   }
    </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{ With FCB do }

  { set up regs For Dos call }
  </i></font>fillChar<font color="#000080">(</font>regs<font color="#000080">,</font>sizeof<font color="#000080">(</font>regs<font color="#000080">),</font><font color="#800000">#0</font><font color="#000080">); </font><font color="#008000"><i>{initialize regs With nulls}
  </i></font>regs<font color="#000080">.</font>ah<font color="#000080">:= </font><font color="#800000">$13</font><font color="#000080">; </font><font color="#008000"><i>{Dos 1.0 delete File Function}
  </i></font>regs<font color="#000080">.</font>ds<font color="#000080">:= </font>seg<font color="#000080">(</font>FCB<font color="#000080">);
  </font>regs<font color="#000080">.</font>dx<font color="#000080">:= </font>ofs<font color="#000080">(</font>FCB<font color="#000080">);
  </font>MsDos<font color="#000080">(</font>regs<font color="#000080">); </font><font color="#008000"><i>{call Dos to delete the volume Label }
  </i></font><font color="#FF0000"><b>if </b></font>regs<font color="#000080">.</font>al<font color="#000080">=</font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>Writeln<font color="#000080">(</font><font color="#800000">'Success -- volume Label deleted.'</font><font color="#000080">)
  </font><font color="#FF0000"><b>else </b></font>Writeln<font color="#000080">(</font><font color="#800000">'Failure -- volume Label not deleted.'</font><font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{ of DelVolumeLabel }

</i></font><font color="#FF0000"><b>Procedure </b></font>WriteVolumeLabel<font color="#000080">(</font>CurrentVolumeLabel<font color="#000080">:</font>String11<font color="#000080">);
</font><font color="#008000"><i>{create volume Label from disk in current drive}
</i></font><font color="#FF0000"><b>Var
  </b></font>regs <font color="#000080">: </font>Registers<font color="#000080">;
  </font>FCB  <font color="#000080">: </font>ExtendedFCBType<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>fillChar<font color="#000080">(</font>FCB<font color="#000080">,</font>sizeof<font color="#000080">(</font>FCB<font color="#000080">),</font><font color="#800000">#0</font><font color="#000080">);  </font><font color="#008000"><i>{initialize FCB With nulls }
  </i></font><font color="#FF0000"><b>With </b></font>FCB <font color="#FF0000"><b>do
    begin
      </b></font>ExtendedFCBflag<font color="#000080">:= </font><font color="#800000">$ff</font><font color="#000080">;      </font><font color="#008000"><i>{ always }
      </i></font>Attr           <font color="#000080">:= </font>VolumeID<font color="#000080">; </font><font color="#008000"><i>{defined in the Dos Unit}
      </i></font>DriveID        <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;        </font><font color="#008000"><i>{default drive}
      </i></font>move<font color="#000080">(</font>CurrentVolumeLabel<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">],</font>FileName<font color="#000080">,</font><font color="#800000">8</font><font color="#000080">);
      </font>move<font color="#000080">(</font>CurrentVolumeLabel<font color="#000080">[</font><font color="#800000">9</font><font color="#000080">],</font>FileExt <font color="#000080">,</font><font color="#800000">3</font><font color="#000080">);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{ With FCB do }

  { set up regs For Dos call }
  </i></font>fillChar<font color="#000080">(</font>regs<font color="#000080">,</font>sizeof<font color="#000080">(</font>regs<font color="#000080">),</font><font color="#800000">#0</font><font color="#000080">); </font><font color="#008000"><i>{initialize regs With nulls}
  </i></font>regs<font color="#000080">.</font>ah<font color="#000080">:= </font><font color="#800000">$16</font><font color="#000080">; </font><font color="#008000"><i>{Dos 1.0 create File Function}
  </i></font>regs<font color="#000080">.</font>ds<font color="#000080">:= </font>seg<font color="#000080">(</font>FCB<font color="#000080">);
  </font>regs<font color="#000080">.</font>dx<font color="#000080">:= </font>ofs<font color="#000080">(</font>FCB<font color="#000080">);
  </font>MsDos<font color="#000080">(</font>regs<font color="#000080">); </font><font color="#008000"><i>{call Dos to delete the volume Label }
  </i></font><font color="#FF0000"><b>if </b></font>regs<font color="#000080">.</font>al<font color="#000080">=</font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>Writeln<font color="#000080">(</font><font color="#800000">'Success -- volume Label written.'</font><font color="#000080">)
  </font><font color="#FF0000"><b>else </b></font>Writeln<font color="#000080">(</font><font color="#800000">'Failure -- volume Label not written.'</font><font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{ of WriteVolumeLabel }

</i></font><font color="#FF0000"><b>begin </b></font><font color="#008000"><i>{ test Program }
  </i></font>getdir<font color="#000080">(</font><font color="#800000">0</font><font color="#000080">,</font>oldir<font color="#000080">); </font><font color="#008000"><i>{ save current directory }
  </i></font>chdir<font color="#000080">(</font><font color="#800000">'a:'</font><font color="#000080">);     </font><font color="#008000"><i>{ play With diskette in A: }
  </i></font>Writeln<font color="#000080">(</font><font color="#800000">'Old volume Label: '</font><font color="#000080">,</font>GetCurrentVolumeLabel<font color="#000080">);
  </font>DelVolumeLabel<font color="#000080">(</font>GetCurrentVolumeLabel<font color="#000080">);
  </font>WriteVolumeLabel<font color="#000080">(</font><font color="#800000">'10987654321'</font><font color="#000080">);
  </font>Writeln<font color="#000080">(</font><font color="#800000">'New volume Label: '</font><font color="#000080">,</font>GetCurrentVolumeLabel<font color="#000080">);
  </font>chdir<font color="#000080">(</font>oldir<font color="#000080">); </font><font color="#008000"><i>{ go back to original directory }
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">. </font><font color="#008000"><i>{ test program }
</i></font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to DRIVES SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0021.PAS">Original</a><b>]</b></p></body>
</html>
