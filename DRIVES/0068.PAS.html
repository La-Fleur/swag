<html>
<head><title> "Network Drives" by GREG VIGNEAULT</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to DRIVES SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0068.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
  &gt;Hi, I'm interested in trying to identify what type of drive a
  &gt;logical drive is (specifically, whether or not a hard drive is
  &gt;a network drive; I want the installation program I'm writing
  &gt;to prevent the user from installing to a network drive).

 Hi Jim,

 I don't have access to a network, but the following code will
 consistently assure me that my drives are all local ;) ... }

(************************* NETDRV.PAS ******************************)
</i></font><font color="#FF0000"><b>PROGRAM </b></font>NetDrive<font color="#000080">;                     </font><font color="#008000"><i>{ compiler: Turbo Pascal 4.0+ }
                                      { Jan.17.94 Greg Vigneault    }

</i></font><font color="#FF0000"><b>USES  </b></font>Dos<font color="#000080">;                            </font><font color="#008000"><i>{ import MsDos, Registers     }

</i></font><font color="#FF0000"><b>CONST </b></font>Beep          <font color="#000080">= </font>CHR<font color="#000080">(</font><font color="#800000">7</font><font color="#000080">);         </font><font color="#008000"><i>{ ASCII bell-tone             }

</i></font><font color="#FF0000"><b>VAR   </b></font>Reg           <font color="#000080">: </font>Registers<font color="#000080">;      </font><font color="#008000"><i>{ to use CPU registers        }
      </i></font>DosErrorCode  <font color="#000080">: </font>WORD<font color="#000080">;           </font><font color="#008000"><i>{ MsDos function error code   }
      </i></font>DriveID       <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">];      </font><font color="#008000"><i>{ for PC/AT drive 'A'..'Z'    }
      </i></font>DriveIsRemote <font color="#000080">: </font>BOOLEAN<font color="#000080">;        </font><font color="#008000"><i>{ TRUE or FALSE, of course    }

(*-----------------------------------------------------------------*)
(* Return PC/MS-DOS version, times 100 (eg. 310 = version 3.1) ... *)

</i></font><font color="#FF0000"><b>FUNCTION </b></font>DosVersion <font color="#000080">: </font>WORD<font color="#000080">;
  </font><font color="#FF0000"><b>BEGIN
    </b></font>Reg<font color="#000080">.</font>AX <font color="#000080">:= </font><font color="#800000">$3000</font><font color="#000080">;                  </font><font color="#008000"><i>{ Dos fn: get Dos version   }
    </i></font>MsDos <font color="#000080">(</font>Reg<font color="#000080">);                      </font><font color="#008000"><i>{ call the Dos services     }
    </i></font>DosVersion <font color="#000080">:= </font>WORD<font color="#000080">(</font>Reg<font color="#000080">.</font>AL<font color="#000080">) * </font><font color="#800000">100 </font><font color="#000080">+ </font>WORD<font color="#000080">(</font>Reg<font color="#000080">.</font>AH<font color="#000080">);  </font><font color="#008000"><i>{ convert   }
  </i></font><font color="#FF0000"><b>END </b></font><font color="#008000"><i>{DosVersion}</i></font><font color="#000080">;

</font><font color="#008000"><i>(*-----------------------------------------------------------------*)
(*  Return TRUE if Drive is redirected to a network server...      *)

</i></font><font color="#FF0000"><b>FUNCTION </b></font>NetworkDrive <font color="#000080">(</font>Drive<font color="#000080">:</font>CHAR<font color="#000080">):</font>BOOLEAN<font color="#000080">;
  </font><font color="#FF0000"><b>BEGIN
    </b></font>Drive <font color="#000080">:= </font>UpCase <font color="#000080">(</font>Drive<font color="#000080">);            </font><font color="#008000"><i>{ Drive _must_ be 'A'..'Z'  }
    </i></font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>Drive <font color="#FF0000"><b>IN </b></font><font color="#000080">[</font><font color="#800000">'A'</font><font color="#000080">..</font><font color="#800000">'Z'</font><font color="#000080">]) </font><font color="#FF0000"><b>THEN BEGIN </b></font><font color="#008000"><i>{ make sure of 'A'..'Z'     }
      </i></font>Reg<font color="#000080">.</font>BL <font color="#000080">:= </font>ORD<font color="#000080">(</font>Drive<font color="#000080">) - </font><font color="#800000">64</font><font color="#000080">;      </font><font color="#008000"><i>{ 1 = A:, 2 = B:, 3 = C: etc. }
      </i></font>Reg<font color="#000080">.</font>AX <font color="#000080">:= </font><font color="#800000">$4409</font><font color="#000080">;                </font><font color="#008000"><i>{ Dos fn: check if dev remote }
      </i></font>MsDos <font color="#000080">(</font>Reg<font color="#000080">);                    </font><font color="#008000"><i>{ call Dos' services          }
      </i></font><font color="#FF0000"><b>IF </b></font>ODD<font color="#000080">(</font>Reg<font color="#000080">.</font>FLAGS<font color="#000080">) </font><font color="#FF0000"><b>THEN          </b></font><font color="#008000"><i>{ Dos reports function error? }
        </i></font>DosErrorCode <font color="#000080">:= </font>Reg<font color="#000080">.</font>AX        <font color="#008000"><i>{ yes: return Dos' error code }
      </i></font><font color="#FF0000"><b>ELSE BEGIN                      </b></font><font color="#008000"><i>{   else ...                  }
        </i></font>DosErrorCode <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;            </font><font color="#008000"><i>{ 0 = no error was detected   }
        </i></font><font color="#FF0000"><b>IF </b></font>ODD<font color="#000080">(</font>Reg<font color="#000080">.</font>DX <font color="#FF0000"><b>SHR </b></font><font color="#800000">12</font><font color="#000080">) </font><font color="#FF0000"><b>THEN    </b></font><font color="#008000"><i>{ is Drive remote?            }
          </i></font>NetworkDrive <font color="#000080">:= </font>TRUE        <font color="#008000"><i>{ yes: return TRUE            }
        </i></font><font color="#FF0000"><b>ELSE
          </b></font>NetworkDrive <font color="#000080">:= </font>FALSE<font color="#000080">;      </font><font color="#008000"><i>{ no: return FALSE            }
        {END IF ODD(Reg.DX...}
      </i></font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>{IF ODD(Reg.FLAGS)}
    </i></font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>{IF Drive}
  </i></font><font color="#FF0000"><b>END </b></font><font color="#008000"><i>{NetworkDrive}</i></font><font color="#000080">;

</font><font color="#008000"><i>(*-----------------------------------------------------------------*)
</i></font><font color="#FF0000"><b>BEGIN </b></font><font color="#008000"><i>{NetDrive}

  </i></font>WriteLn<font color="#000080">;

  </font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>ParamCount <font color="#000080">&lt;&gt; </font><font color="#800000">1</font><font color="#000080">) </font><font color="#FF0000"><b>THEN BEGIN                 </b></font><font color="#008000"><i>{ user input?     }
    </i></font>WriteLn <font color="#000080">(</font><font color="#800000">'Usage: NETDRV &lt;DriveLetter&gt;'</font><font color="#000080">,</font>Beep<font color="#000080">); </font><font color="#008000"><i>{ no: offer hint  }
    </i></font>HALT <font color="#000080">(</font><font color="#800000">1</font><font color="#000080">);                                     </font><font color="#008000"><i>{ abort program   }
  </i></font><font color="#FF0000"><b>END</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>DosVersion <font color="#000080">&lt; </font><font color="#800000">310</font><font color="#000080">) </font><font color="#FF0000"><b>THEN BEGIN                </b></font><font color="#008000"><i>{ check DOS ver   }
    </i></font>WriteLn <font color="#000080">(</font><font color="#800000">'DOS version 3.1+ is needed.'</font><font color="#000080">,</font>Beep<font color="#000080">); </font><font color="#008000"><i>{ version too low }
    </i></font>HALT <font color="#000080">(</font><font color="#800000">2</font><font color="#000080">);                                     </font><font color="#008000"><i>{ abort program   }
  </i></font><font color="#FF0000"><b>END</b></font><font color="#000080">;

  </font>DriveID <font color="#000080">:= </font>ParamStr<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">);                       </font><font color="#008000"><i>{ get user's input  }
  </i></font>DriveID<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">] := </font>UpCase <font color="#000080">(</font>DriveID<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">]);            </font><font color="#008000"><i>{ to uppercase      }
  </i></font>DriveIsRemote <font color="#000080">:= </font>NetWorkDrive <font color="#000080">(</font>DriveID<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">]);   </font><font color="#008000"><i>{ check per netwrok }

  { _ALWAYS_ check if the function call failed....................  }

  </i></font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>DosErrorCode <font color="#000080">&lt;&gt; </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>THEN BEGIN             </b></font><font color="#008000"><i>{ any DOS errors?   }
    </i></font>WriteLn <font color="#000080">(</font><font color="#800000">'!DOS error #'</font><font color="#000080">,</font>DosErrorCode<font color="#000080">,</font>Beep<font color="#000080">); </font><font color="#008000"><i>{ DOS fn failed     }
    </i></font>HALT <font color="#000080">(</font><font color="#800000">3</font><font color="#000080">);                                   </font><font color="#008000"><i>{ abort program     }
  </i></font><font color="#FF0000"><b>END</b></font><font color="#000080">;

  </font>Write <font color="#000080">(</font><font color="#800000">'Drive '</font><font color="#000080">,</font>DriveID<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">],</font><font color="#800000">': is '</font><font color="#000080">);          </font><font color="#008000"><i>{ inform user of    }
  </i></font><font color="#FF0000"><b>IF NOT </b></font>DriveIsRemote <font color="#FF0000"><b>THEN </b></font>Write <font color="#000080">(</font><font color="#800000">'NOT '</font><font color="#000080">);     </font><font color="#008000"><i>{  the drive status }
  </i></font>WriteLn <font color="#000080">(</font><font color="#800000">'redirected to a network.'</font><font color="#000080">);

</font><font color="#FF0000"><b>END </b></font><font color="#008000"><i>{NetDrive}</i></font><font color="#000080">.
</font><font color="#008000"><i>(*******************************************************************)
</i></font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to DRIVES SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0068.PAS">Original</a><b>]</b></p></body>
</html>
