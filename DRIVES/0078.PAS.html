<html>
<head><title> "TRUENAME (BASM)" by BJ™RN FELTEN</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to DRIVES SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0078.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{SWAG=DOS.SWG,BJ&trade;RN FELTEN,TRUENAME (BASM)}

{ Updated DOS.SWG on August 24, 1994 }



</i></font><font color="#FF0000"><b>program </b></font>TName<font color="#000080">;  </font><font color="#008000"><i>{ to test the TrueName function }

</i></font><font color="#FF0000"><b>function </b></font>TrueName<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>P<font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">): </font><font color="#FF0000"><b>string</b></font><font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#008000"><i>{ returns TrueName just like the DOS command does }
{ if error, returns a zero length string }
{ will probably crash for DOS versions &lt; 3.0 }
{ donated to the Public Domain by Bj”rn Felten @ 2:203/208 }
</i></font><font color="#FF0000"><b>asm
   </b></font><font color="#FF00FF">push  ds
   lds   si,P
@strip:
   inc   si     </font><font color="#008000"><i>{ skip length byte ... }
   </i></font><font color="#FF00FF">cmp   byte ptr [si],' '
   jle   @strip </font><font color="#008000"><i>{ ... and trailing white space }

   </i></font><font color="#FF00FF">les   di,@Result
   inc   di     </font><font color="#008000"><i>{ leave room for byte count }
   </i></font><font color="#FF00FF">mov   ah,60h </font><font color="#008000"><i>{ undocumented DOS call }
   </i></font><font color="#FF00FF">int   21h
   pop   ds
   jc    @error

   mov   cx,80  </font><font color="#008000"><i>{ convert ASCIZ to Pascal string }
   </i></font><font color="#FF00FF">xor   ax,ax
   repnz scasb  </font><font color="#008000"><i>{ find trailing zero }
   </i></font><font color="#FF00FF">mov   ax,80
   sub   ax,cx  </font><font color="#008000"><i>{ get length byte }
   </i></font><font color="#FF00FF">jmp   @ret

@error:
   xor   ax,ax  </font><font color="#008000"><i>{ return zero length string }

</i></font><font color="#FF00FF">@ret:
   les   di,@Result
   stosb
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>var </b></font>S<font color="#000080">:</font><font color="#FF0000"><b>string</b></font><font color="#000080">;
</font><font color="#FF0000"><b>begin
   </b></font>S<font color="#000080">:=</font>paramstr<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">);
   </font><font color="#FF0000"><b>if </b></font>paramcount<font color="#000080">&lt;&gt;</font><font color="#800000">1 </font><font color="#FF0000"><b>then
      </b></font>writeln<font color="#000080">(</font><font color="#800000">'Usage: tname &lt;filename&gt;'</font><font color="#000080">)
   </font><font color="#FF0000"><b>else
      </b></font>writeln<font color="#000080">(</font><font color="#800000">'TrueName of '</font><font color="#000080">,</font>S<font color="#000080">,</font><font color="#800000">' is '</font><font color="#000080">,</font>TrueName<font color="#000080">(</font>S<font color="#000080">))
</font><font color="#FF0000"><b>end</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to DRIVES SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0078.PAS">Original</a><b>]</b></p></body>
</html>
