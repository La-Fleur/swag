<html>
<head><title> "Get Drive ID & Labels" by SWAG SUPPORT TEAM</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to DRIVES SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0023.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#FF0000"><b>UNIT </b></font>FCBLabel<font color="#000080">;
</font><font color="#008000"><i>{Turbo Pascal unit for manipulating volume labels}

</i></font><font color="#FF0000"><b>INTERFACE
USES
    </b></font>DOS<font color="#000080">;
</font><font color="#FF0000"><b>TYPE
    </b></font>DriveType   <font color="#000080">= </font><font color="#FF0000"><b>String</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">];
    </font>DiskIDType  <font color="#000080">= </font><font color="#FF0000"><b>String</b></font><font color="#000080">[</font><font color="#800000">11</font><font color="#000080">];

</font><font color="#FF0000"><b>FUNCTION </b></font>GetDiskID<font color="#000080">(</font>Drive<font color="#000080">:</font>DriveType<font color="#000080">): </font>DiskIDType<font color="#000080">;
</font><font color="#FF0000"><b>FUNCTION </b></font>SetDiskID<font color="#000080">(</font>Drive<font color="#000080">:</font>DriveType<font color="#000080">;
                    </font>DiskID<font color="#000080">:</font>DiskIDType<font color="#000080">): </font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>FUNCTION </b></font>ReNameDiskID<font color="#000080">(</font>Drive<font color="#000080">:</font>DriveType<font color="#000080">;
                   </font>OldDiskID<font color="#000080">:</font>DiskIDType<font color="#000080">;
                   </font>NewDiskID<font color="#000080">:</font>DiskIDType<font color="#000080">): </font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>FUNCTION </b></font>DeleteDiskID<font color="#000080">(</font>Drive<font color="#000080">:</font>DriveType<font color="#000080">): </font>Boolean<font color="#000080">;

</font><font color="#FF0000"><b>IMPLEMENTATION
TYPE
    </b></font>ExtendedFCBRecord <font color="#000080">= </font><font color="#FF0000"><b>RECORD
               </b></font>ExtFCB <font color="#000080">: </font>Byte<font color="#000080">;
               </font>Res1   <font color="#000080">: </font><font color="#FF0000"><b>ARRAY</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">5</font><font color="#000080">] </font><font color="#FF0000"><b>OF </b></font>Byte<font color="#000080">;
               </font>Attr   <font color="#000080">: </font>Byte<font color="#000080">;
               </font>Drive  <font color="#000080">: </font>Byte<font color="#000080">;
               </font>Name1  <font color="#000080">: </font><font color="#FF0000"><b>ARRAY</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">11</font><font color="#000080">] </font><font color="#FF0000"><b>OF </b></font>Char<font color="#000080">;
               </font>Unused1<font color="#000080">: </font><font color="#FF0000"><b>ARRAY</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">5</font><font color="#000080">] </font><font color="#FF0000"><b>OF </b></font>Char<font color="#000080">;
               </font>Name2  <font color="#000080">: </font><font color="#FF0000"><b>ARRAY</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">11</font><font color="#000080">] </font><font color="#FF0000"><b>OF </b></font>Char<font color="#000080">;
               </font>Unused2<font color="#000080">: </font><font color="#FF0000"><b>ARRAY</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">9</font><font color="#000080">] </font><font color="#FF0000"><b>OF </b></font>Byte<font color="#000080">;
           </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>FUNCTION </b></font>GetDiskID<font color="#000080">(</font>Drive<font color="#000080">:</font>DriveType<font color="#000080">): </font>DiskIDType<font color="#000080">;
</font><font color="#FF0000"><b>VAR
   </b></font>DirInfo     <font color="#000080">: </font>SearchRec<font color="#000080">;
   </font>DirDiskID   <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">[</font><font color="#800000">12</font><font color="#000080">];
   </font>I<font color="#000080">,</font>PosPeriod <font color="#000080">: </font>Byte<font color="#000080">;
</font><font color="#FF0000"><b>BEGIN
   </b></font>FindFirst<font color="#000080">(</font>Drive<font color="#000080">+</font><font color="#800000">':\'</font><font color="#000080">+</font><font color="#800000">'*.*'</font><font color="#000080">,</font>VolumeID<font color="#000080">,</font>DirInfo<font color="#000080">);
   </font><font color="#FF0000"><b>IF </b></font>DosError <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>THEN
      BEGIN
         </b></font>DirDiskID <font color="#000080">:= </font>DirInfo<font color="#000080">.</font>Name<font color="#000080">;
         </font>PosPeriod <font color="#000080">:= </font>POS<font color="#000080">(</font><font color="#800000">'.'</font><font color="#000080">,</font>DirDiskID<font color="#000080">);
         </font><font color="#FF0000"><b>IF </b></font>PosPeriod <font color="#000080">&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>THEN
            </b></font>Delete<font color="#000080">(</font>DirDiskID<font color="#000080">,</font>PosPeriod<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">);
         </font>GetDiskID <font color="#000080">:= </font>DirDiskID
      <font color="#FF0000"><b>END
   ELSE
      </b></font>GetDiskID <font color="#000080">:= </font><font color="#800000">''
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#008000"><i>{Use MsDos service 16H to SET a volume label }
</i></font><font color="#FF0000"><b>FUNCTION </b></font>SetDiskID<font color="#000080">(</font>Drive<font color="#000080">:</font>DriveType<font color="#000080">;
                    </font>DiskID<font color="#000080">:</font>DiskIDType<font color="#000080">): </font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>VAR
   </b></font>FCB  <font color="#000080">: </font>ExtendedFCBRecord<font color="#000080">;
   </font>Regs <font color="#000080">: </font>Registers<font color="#000080">;
   </font>Temp <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">];
   </font>I    <font color="#000080">: </font>Integer<font color="#000080">;
</font><font color="#FF0000"><b>BEGIN
   </b></font>Temp <font color="#000080">:= </font>Drive<font color="#000080">;
   </font><font color="#FF0000"><b>WITH </b></font>FCB <font color="#FF0000"><b>DO
     BEGIN
       </b></font>ExtFCB <font color="#000080">:= </font><font color="#800000">$FF</font><font color="#000080">;
       </font>Attr   <font color="#000080">:= </font><font color="#800000">$8</font><font color="#000080">;
       </font>Drive  <font color="#000080">:= </font>Ord<font color="#000080">(</font>UpCase<font color="#000080">(</font>Temp<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">])) - </font><font color="#800000">64</font><font color="#000080">;
       </font><font color="#FF0000"><b>FOR </b></font>I <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>TO </b></font>Length<font color="#000080">(</font>DiskID<font color="#000080">) </font><font color="#FF0000"><b>DO
         </b></font>Name1<font color="#000080">[</font>I<font color="#000080">] := </font>DiskID<font color="#000080">[</font>I<font color="#000080">];
         </font><font color="#FF0000"><b>IF </b></font>Length<font color="#000080">(</font>DiskID<font color="#000080">) &lt; </font><font color="#800000">11 </font><font color="#FF0000"><b>THEN
           FOR </b></font>I <font color="#000080">:= (</font>Length<font color="#000080">(</font>DiskID<font color="#000080">) + </font><font color="#800000">1</font><font color="#000080">) </font><font color="#FF0000"><b>TO </b></font><font color="#800000">11 </font><font color="#FF0000"><b>DO
             </b></font>Name1<font color="#000080">[</font>I<font color="#000080">] := </font><font color="#800000">' '
     </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
   </font>Regs<font color="#000080">.</font>ah <font color="#000080">:= </font><font color="#800000">$16</font><font color="#000080">;
   </font>Regs<font color="#000080">.</font>ds <font color="#000080">:= </font>Seg<font color="#000080">(</font>FCB<font color="#000080">);
   </font>Regs<font color="#000080">.</font>dx <font color="#000080">:= </font>Ofs<font color="#000080">(</font>FCB<font color="#000080">);
   </font>MsDos<font color="#000080">(</font>Regs<font color="#000080">);
   </font><font color="#FF0000"><b>IF </b></font>Regs<font color="#000080">.</font>AL <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>THEN
      </b></font>SetDiskID <font color="#000080">:= </font>TRUE
   <font color="#FF0000"><b>ELSE
      </b></font>SetDiskID <font color="#000080">:= </font>FALSE
<font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#008000"><i>{use MsDOS service 17H to RENAME a volume label }
</i></font><font color="#FF0000"><b>FUNCTION </b></font>ReNameDiskID<font color="#000080">(</font>Drive<font color="#000080">:</font>DriveType<font color="#000080">;
                   </font>OldDiskID<font color="#000080">:</font>DiskIDType <font color="#000080">;
                   </font>NewDiskID<font color="#000080">:</font>DiskIDType<font color="#000080">): </font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>VAR
   </b></font>FCB  <font color="#000080">: </font>ExtendedFCBRecord<font color="#000080">;
   </font>Regs <font color="#000080">: </font>Registers<font color="#000080">;
   </font>Temp <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">];
   </font>I    <font color="#000080">: </font>Integer<font color="#000080">;
</font><font color="#FF0000"><b>BEGIN
  </b></font>Temp <font color="#000080">:= </font>Drive<font color="#000080">;
  </font><font color="#FF0000"><b>WITH </b></font>FCB <font color="#FF0000"><b>DO
    BEGIN
      </b></font>ExtFCB <font color="#000080">:= </font><font color="#800000">$FF</font><font color="#000080">;
      </font>Attr   <font color="#000080">:= </font><font color="#800000">$8</font><font color="#000080">;
      </font>Drive  <font color="#000080">:= </font>Ord<font color="#000080">(</font>UpCase<font color="#000080">(</font>Temp<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">])) - </font><font color="#800000">64</font><font color="#000080">;

      </font><font color="#008000"><i>{Set old disk id}

      </i></font><font color="#FF0000"><b>FOR </b></font>I <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>TO </b></font>Length<font color="#000080">(</font>OldDiskID<font color="#000080">) </font><font color="#FF0000"><b>DO
        </b></font>Name1<font color="#000080">[</font>I<font color="#000080">] := </font>OldDiskID<font color="#000080">[</font>I<font color="#000080">];
      </font><font color="#FF0000"><b>FOR </b></font>I <font color="#000080">:= (</font>Length<font color="#000080">(</font>OldDiskID<font color="#000080">) + </font><font color="#800000">1</font><font color="#000080">) </font><font color="#FF0000"><b>TO </b></font><font color="#800000">11 </font><font color="#FF0000"><b>DO
        </b></font>Name1<font color="#000080">[</font>I<font color="#000080">] := </font><font color="#800000">' '</font><font color="#000080">;

      </font><font color="#008000"><i>{Set new disk id}

      </i></font><font color="#FF0000"><b>FOR </b></font>I <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>TO </b></font>Length<font color="#000080">(</font>NewDiskID<font color="#000080">) </font><font color="#FF0000"><b>DO
        </b></font>Name2<font color="#000080">[</font>I<font color="#000080">] := </font>NewDiskID<font color="#000080">[</font>I<font color="#000080">];
      </font><font color="#FF0000"><b>FOR </b></font>I <font color="#000080">:= (</font>Length<font color="#000080">(</font>NewDiskID<font color="#000080">) + </font><font color="#800000">1</font><font color="#000080">) </font><font color="#FF0000"><b>TO </b></font><font color="#800000">11 </font><font color="#FF0000"><b>DO
        </b></font>Name2<font color="#000080">[</font>I<font color="#000080">] := </font><font color="#800000">' '
    </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
  </font>Regs<font color="#000080">.</font>ah <font color="#000080">:= </font><font color="#800000">$17</font><font color="#000080">;
  </font>Regs<font color="#000080">.</font>ds <font color="#000080">:= </font>Seg<font color="#000080">(</font>FCB<font color="#000080">);
  </font>Regs<font color="#000080">.</font>dx <font color="#000080">:= </font>Ofs<font color="#000080">(</font>FCB<font color="#000080">);
  </font>MsDos<font color="#000080">(</font>Regs<font color="#000080">);
  </font><font color="#FF0000"><b>IF </b></font>Regs<font color="#000080">.</font>AL <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>THEN
     </b></font>ReNameDiskID <font color="#000080">:= </font>TRUE
  <font color="#FF0000"><b>ELSE
     </b></font>ReNameDiskID <font color="#000080">:= </font>FALSE
<font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#008000"><i>{Use MsDos service 13H DELETE a volume label }

</i></font><font color="#FF0000"><b>FUNCTION </b></font>DeleteDiskID<font color="#000080">(</font>Drive<font color="#000080">:</font>DriveType<font color="#000080">): </font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>VAR
  </b></font>FCB  <font color="#000080">: </font>ExtendedFCBRecord<font color="#000080">;
  </font>Regs <font color="#000080">: </font>Registers<font color="#000080">;
  </font>Temp <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">];
  </font>I    <font color="#000080">: </font>Integer<font color="#000080">;
</font><font color="#FF0000"><b>BEGIN
  </b></font>Temp <font color="#000080">:= </font>Drive<font color="#000080">;
  </font><font color="#FF0000"><b>WITH </b></font>FCB <font color="#FF0000"><b>DO
    BEGIN
      </b></font>ExtFCB <font color="#000080">:= </font><font color="#800000">$FF</font><font color="#000080">;
      </font>Attr   <font color="#000080">:= </font><font color="#800000">$8</font><font color="#000080">;
      </font>Drive  <font color="#000080">:= </font>Ord<font color="#000080">(</font>UpCase<font color="#000080">(</font>Temp<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">])) - </font><font color="#800000">64</font><font color="#000080">;
      </font>Name1<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">] := </font><font color="#800000">'*'</font><font color="#000080">;
      </font>Name1<font color="#000080">[</font><font color="#800000">2</font><font color="#000080">] := </font><font color="#800000">'.'</font><font color="#000080">;
      </font>Name1<font color="#000080">[</font><font color="#800000">3</font><font color="#000080">] := </font><font color="#800000">'*'</font><font color="#000080">;
      </font><font color="#FF0000"><b>FOR </b></font>I <font color="#000080">:= </font><font color="#800000">4 </font><font color="#FF0000"><b>TO </b></font><font color="#800000">11 </font><font color="#FF0000"><b>DO </b></font>Name1<font color="#000080">[</font>I<font color="#000080">] := </font><font color="#800000">' '
    </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
  </font>Regs<font color="#000080">.</font>ah <font color="#000080">:= </font><font color="#800000">$13</font><font color="#000080">;
  </font>Regs<font color="#000080">.</font>ds <font color="#000080">:= </font>Seg<font color="#000080">(</font>FCB<font color="#000080">);
  </font>Regs<font color="#000080">.</font>dx <font color="#000080">:= </font>Ofs<font color="#000080">(</font>FCB<font color="#000080">);
  </font>MsDos<font color="#000080">(</font>Regs<font color="#000080">);
  </font><font color="#FF0000"><b>IF </b></font>Regs<font color="#000080">.</font>AL <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>THEN
     </b></font>DeleteDiskID <font color="#000080">:= </font>TRUE
  <font color="#FF0000"><b>ELSE
     </b></font>DeleteDiskID <font color="#000080">:= </font>FALSE
<font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>END</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to DRIVES SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0023.PAS">Original</a><b>]</b></p></body>
</html>
