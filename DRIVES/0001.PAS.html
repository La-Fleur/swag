<html>
<head><title> "Unit to access CDROM" by NORBERT IGL</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to DRIVES SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0001.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
&gt; Are there anybody out there who has some routins to play CD Audio in a CD
&gt; ROM drive. Just the usual commands like play, stop, resume, eject and so
&gt; on. I would appreciate any help!
}

</i></font><font color="#FF0000"><b>Unit </b></font>CDROM<font color="#000080">;

</font><font color="#008000"><i>{  Unit talking to a CD-Rom-Drive
   Low-level CD access,
   only the first drive is supported...!
   Copyright 1992  Norbert Igl  }

</i></font><font color="#FF0000"><b>Interface

Type
   </b></font>CD_Record <font color="#000080">= </font><font color="#FF0000"><b>Record
                    </b></font>Status <font color="#000080">: </font>Word<font color="#000080">;    </font><font color="#008000"><i>{ Status des Drives/letzte Funktion }
                    </i></font>DrvChar<font color="#000080">: </font>Char<font color="#000080">;    </font><font color="#008000"><i>{ LW-Buchstabe }
                    </i></font>DrvNo  <font color="#000080">: </font>Byte<font color="#000080">;    </font><font color="#008000"><i>{ als Byte ablegegt (0...) }
                    </i></font>HSG_RB <font color="#000080">: </font>Byte<font color="#000080">;    </font><font color="#008000"><i>{ Adressierungs-Modus }

                    </i></font>Sector <font color="#000080">: </font>LongInt<font color="#000080">; </font><font color="#008000"><i>{ Adresse des Lesekopfes }
                    </i></font>VolInfo<font color="#000080">: </font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">8</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Byte<font color="#000080">; </font><font color="#008000"><i>{ Lautst.-Einstellungen }
                    </i></font>DevPar <font color="#000080">: </font>LongInt<font color="#000080">; </font><font color="#008000"><i>{ Device-parameter, BIT-Feld! }
                    </i></font>RawMode<font color="#000080">: </font>Boolean<font color="#000080">; </font><font color="#008000"><i>{ Raw/Cooked-Mode ? }
                    </i></font>SecSize<font color="#000080">: </font>Word<font color="#000080">;    </font><font color="#008000"><i>{ Bytes/Sector }
                    </i></font>VolSize<font color="#000080">: </font>LongInt<font color="#000080">; </font><font color="#008000"><i>{ sek/Volume =&gt; Groesse der CD}

                    </i></font>MedChg <font color="#000080">: </font>Byte<font color="#000080">;    </font><font color="#008000"><i>{ Disk gewechselt? }

                    </i></font>LoAuTr <font color="#000080">: </font>Byte<font color="#000080">;    </font><font color="#008000"><i>{ kleinste Audio-Track # }
                    </i></font>HiAuTr <font color="#000080">: </font>Byte<font color="#000080">;    </font><font color="#008000"><i>{ groesste Audio-Track # }
                    </i></font>endAdr <font color="#000080">: </font>LongInt<font color="#000080">; </font><font color="#008000"><i>{ Adresse der Auslaufrille (8-) }

                    </i></font>TrkNo  <font color="#000080">: </font>Byte<font color="#000080">;    </font><font color="#008000"><i>{ Track #. Eingabe-Wert ! }
                    </i></font>TrkAdr <font color="#000080">: </font>LongInt<font color="#000080">; </font><font color="#008000"><i>{ Adresse dieses Tracks }
                    </i></font>TrkInf <font color="#000080">: </font>Byte<font color="#000080">;    </font><font color="#008000"><i>{ Info dazu: BIT-Feld! }

                    </i></font>CntAdr <font color="#000080">: </font>Byte<font color="#000080">;   </font><font color="#008000"><i>{ CONTROL und ADR, von LW }
                    </i></font>CTrk   <font color="#000080">: </font>Byte<font color="#000080">;   </font><font color="#008000"><i>{ track # }
                    </i></font>Cindx  <font color="#000080">: </font>Byte<font color="#000080">;   </font><font color="#008000"><i>{ point/index }
                    </i></font>CMin   <font color="#000080">: </font>Byte<font color="#000080">;   </font><font color="#008000"><i>{ minute\  }
                    </i></font>CSek   <font color="#000080">: </font>Byte<font color="#000080">;   </font><font color="#008000"><i>{ second &gt; Laufzeit im Track }
                    </i></font>CFrm   <font color="#000080">: </font>Byte<font color="#000080">;   </font><font color="#008000"><i>{ frame /  }
                    </i></font>Czero  <font color="#000080">: </font>Byte<font color="#000080">;   </font><font color="#008000"><i>{ immer =0 }
                    </i></font>CAmin  <font color="#000080">: </font>Byte<font color="#000080">;   </font><font color="#008000"><i>{ minute \ }
                    </i></font>CAsec  <font color="#000080">: </font>Byte<font color="#000080">;   </font><font color="#008000"><i>{ sekunde &gt; Laufzeit auf Disk }
                    </i></font>CAFrm  <font color="#000080">: </font>Byte<font color="#000080">;   </font><font color="#008000"><i>{ frame  / }

                    </i></font>Qfrm   <font color="#000080">: </font>LongInt<font color="#000080">;</font><font color="#008000"><i>{ start-frame address }
                    </i></font>Qtrfs  <font color="#000080">: </font>LongInt<font color="#000080">;</font><font color="#008000"><i>{ Bufferaddresse }
                    </i></font>Qcnt   <font color="#000080">: </font>LongInt<font color="#000080">;</font><font color="#008000"><i>{ Anzahl der Sectoren }
                      { pro Sector werden 96 Byte nach buffer kopiert }

                    </i></font>Uctrl  <font color="#000080">: </font>Byte<font color="#000080">;  </font><font color="#008000"><i>{ CONTROL und ADR Byte }
                    </i></font>Upn    <font color="#000080">: </font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">7</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Byte<font color="#000080">; </font><font color="#008000"><i>{ EAN-CODE }
                    </i></font>Uzero  <font color="#000080">: </font>Byte<font color="#000080">;  </font><font color="#008000"><i>{ immer = 0 }
                    </i></font>Ufrm   <font color="#000080">: </font>Byte<font color="#000080">;  </font><font color="#008000"><i>{ Frame-# }
                  </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font>OneTrack             <font color="#000080">= </font><font color="#FF0000"><b>Record
                               </b></font>Title   <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">[</font><font color="#800000">20</font><font color="#000080">];
                               </font>Runmin<font color="#000080">,
                               </font>RunSec <font color="#000080">:  </font>Byte<font color="#000080">;
                               </font>Start  <font color="#000080">:  </font>LongInt<font color="#000080">;  </font><font color="#008000"><i>{ HSG Format ! }
                             </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font>VolumeTableOfContens <font color="#000080">= </font><font color="#FF0000"><b>Record
                               </b></font>Diskname<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">[</font><font color="#800000">20</font><font color="#000080">];
                               </font>UAN_Code<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">[</font><font color="#800000">13</font><font color="#000080">];
                               </font>TrackCnt<font color="#000080">: </font>Byte<font color="#000080">;
                               </font>Titles  <font color="#000080">: </font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">99</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>OneTrack<font color="#000080">;
                             </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
       </font>TrkInfo  <font color="#000080">= </font><font color="#FF0000"><b>Record
                     </b></font>Nummer  <font color="#000080">: </font>Byte<font color="#000080">;
                     </font>Start   <font color="#000080">: </font>LongInt<font color="#000080">;
                     </font>Cntrl2  <font color="#000080">: </font>Byte<font color="#000080">;
                  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#008000"><i>{===== global verfuegbare Variablen =============}

</i></font><font color="#FF0000"><b>Var    </b></font>CD           <font color="#000080">: </font>CD_Record<font color="#000080">;
       </font>CD_AVAIL     <font color="#000080">: </font>Boolean<font color="#000080">;
       </font>VtoC         <font color="#000080">: </font>VolumeTableOfContens<font color="#000080">;
       </font>CD_REDPos    <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
       </font>CD_HSGPos    <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;

</font><font color="#008000"><i>{===== allgemeine Funktionen ===================}

</i></font><font color="#FF0000"><b>Function </b></font>CD_Reset   <font color="#000080">: </font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>Function </b></font>CD_HeadAdr <font color="#000080">: </font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>Function </b></font>CD_Position<font color="#000080">: </font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>Function </b></font>CD_MediaChanged<font color="#000080">: </font>Boolean<font color="#000080">;


</font><font color="#008000"><i>{===== Tray/Caddy-Funktionen ===================}

</i></font><font color="#FF0000"><b>Function </b></font>CD_Open<font color="#000080">:  </font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>Function </b></font>CD_Close<font color="#000080">: </font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>Function </b></font>CD_Eject<font color="#000080">: </font>Boolean<font color="#000080">;

</font><font color="#008000"><i>{==== Audio-Funktionen =========================}

</i></font><font color="#FF0000"><b>Function </b></font>CD_Play<font color="#000080">(</font>no<font color="#000080">:</font>Byte<font color="#000080">; </font>len<font color="#000080">:</font>Integer<font color="#000080">):  </font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>Function </b></font>CD_Stop<font color="#000080">:  </font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>Function </b></font>CD_Resume<font color="#000080">:</font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>Function </b></font>CD_SetVol<font color="#000080">:</font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>Function </b></font>CD_GetVol<font color="#000080">:</font>Boolean<font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>CD_Info<font color="#000080">;
</font><font color="#FF0000"><b>Procedure </b></font>CD_TrackInfo<font color="#000080">( </font>Nr<font color="#000080">:</font>Byte<font color="#000080">; </font><font color="#FF0000"><b>Var </b></font>T<font color="#000080">:</font>TrkInfo <font color="#000080">);

</font><font color="#008000"><i>{==== Umwandlungen =============================}

</i></font><font color="#FF0000"><b>Function </b></font>Red2Time<font color="#000080">( </font><font color="#FF0000"><b>Var </b></font>Inf<font color="#000080">:</font>TrkInfo <font color="#000080">):</font>Word<font color="#000080">;

</font><font color="#FF0000"><b>Implementation Uses </b></font>Dos<font color="#000080">;
</font><font color="#FF0000"><b>Type   </b></font>IOCtlBlk <font color="#000080">= </font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">200</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Byte<font color="#000080">;

</font><font color="#FF0000"><b>Const  </b></font>IOCtlRead  <font color="#000080">= </font><font color="#800000">$4402</font><font color="#000080">;
       </font>IOCtlWrite <font color="#000080">= </font><font color="#800000">$4403</font><font color="#000080">;
       </font>DevDrvReq  <font color="#000080">= </font><font color="#800000">$1510</font><font color="#000080">;
       </font>All<font color="#000080">:</font>LongInt<font color="#000080">= </font><font color="#800000">$0f00</font><font color="#000080">;

</font><font color="#FF0000"><b>Var  </b></font>R        <font color="#000080">: </font>Registers<font color="#000080">;
     </font>H        <font color="#000080">: </font>Text<font color="#000080">;
     </font>Handle   <font color="#000080">: </font>Word<font color="#000080">;
     </font>Old_Exit <font color="#000080">: </font>Pointer<font color="#000080">;
     </font>CtlBlk   <font color="#000080">: </font>IOCtlBlk<font color="#000080">;

     </font>Tracks   <font color="#000080">: </font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">100</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>TrkInfo<font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>CD_Exit<font color="#000080">;               </font><font color="#008000"><i>{ wird bei Programmende ausgefuehrt }
</i></font><font color="#FF0000"><b>begin
  if </b></font>Old_Exit <font color="#000080">&lt;&gt; </font><font color="#FF0000"><b>NIL
    then </b></font>ExitProc <font color="#000080">:= </font>Old_Exit<font color="#000080">;      </font><font color="#008000"><i>{ Umleitung wieder zuruecknehmen }
{$I-}
  </i></font>Close<font color="#000080">(</font>H<font color="#000080">);
  </font><font color="#FF0000"><b>If </b></font>IoResult <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>then</b></font><font color="#000080">;              </font><font color="#008000"><i>{ 'H' schliessen, falls offen, }
{$I+}                                      { evtl. Fehler verwerfen }
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>Function </b></font>CD_Init<font color="#000080">:  </font>Boolean<font color="#000080">;    </font><font color="#008000"><i>{ Initialisierung beim Programmstart }
</i></font><font color="#FF0000"><b>begin
 </b></font>FillChar<font color="#000080">( </font>CD<font color="#000080">, </font>SizeOf<font color="#000080">( </font>CD <font color="#000080">), </font><font color="#800000">0</font><font color="#000080">);
 </font><font color="#FF0000"><b>With </b></font>R <font color="#FF0000"><b>do
 begin
   </b></font>AX <font color="#000080">:= </font><font color="#800000">$1500</font><font color="#000080">;
   </font>BX <font color="#000080">:= </font><font color="#800000">$0000</font><font color="#000080">;
   </font>CX <font color="#000080">:= </font><font color="#800000">$0000</font><font color="#000080">;
   </font>Intr<font color="#000080">( </font><font color="#800000">$2F</font><font color="#000080">, </font>R <font color="#000080">);
   </font>CD_Init <font color="#000080">:= (</font>BX <font color="#000080">&gt; </font><font color="#800000">0</font><font color="#000080">);                  </font><font color="#008000"><i>{ Anzahl der CD-Laufwerke }
   </i></font><font color="#FF0000"><b>If </b></font>BX <font color="#000080">&gt; </font><font color="#800000">0
    </font><font color="#FF0000"><b>then begin
      </b></font>CD<font color="#000080">.</font>DrvChar                           <font color="#008000"><i>{ CD-Laufwerksbuchstabe }
         </i></font><font color="#000080">:= </font>Char<font color="#000080">( </font>CL <font color="#000080">+ </font>Byte<font color="#000080">(</font><font color="#800000">'A'</font><font color="#000080">) );
      </font>CD<font color="#000080">.</font>DrvNo <font color="#000080">:= </font>CL<font color="#000080">;
      </font><font color="#FF0000"><b>If </b></font>CD_HeadAdr <font color="#FF0000"><b>then
        If </b></font>CD_GetVol <font color="#FF0000"><b>then</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>end
    else </b></font>CD<font color="#000080">.</font>DrvChar <font color="#000080">:= </font><font color="#800000">'?'</font><font color="#000080">;                      </font><font color="#008000"><i>{ im Fehlerfall...}
 </i></font><font color="#FF0000"><b>end
end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>CD_TrackInfo<font color="#000080">( </font>Nr<font color="#000080">:</font>Byte<font color="#000080">; </font><font color="#FF0000"><b>Var </b></font>T<font color="#000080">:</font>TrkInfo <font color="#000080">);
</font><font color="#FF0000"><b>begin
  </b></font>T <font color="#000080">:= </font>Tracks<font color="#000080">[</font>nr<font color="#000080">]
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>OpenCDHandle<font color="#000080">:</font>Word<font color="#000080">;
</font><font color="#FF0000"><b>Const </b></font>Name <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">[</font><font color="#800000">8</font><font color="#000080">] = </font><font color="#800000">'MSCD001'</font><font color="#000080">;        </font><font color="#008000"><i>{ evt. anpassen!!! ? }
</i></font><font color="#FF0000"><b>begin
  </b></font>Assign<font color="#000080">(</font>H<font color="#000080">, </font>Name<font color="#000080">);                         </font><font color="#008000"><i>{ Filehandle holen }
(*$I-*)
  </i></font>Reset<font color="#000080">(</font>H<font color="#000080">);
</font><font color="#008000"><i>(*$I+*)
  </i></font><font color="#FF0000"><b>if </b></font>IoResult <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>then
  begin
    </b></font>Handle <font color="#000080">:= </font>TextRec<font color="#000080">(</font>H<font color="#000080">).</font>Handle<font color="#000080">;                </font><font color="#008000"><i>{ Filehandle holen }
    </i></font>Old_Exit <font color="#000080">:= </font>ExitProc<font color="#000080">;           </font><font color="#008000"><i>{ Bei ende/Abbruch muss 'H'... }
    </i></font>ExitProc <font color="#000080">:= @</font>CD_Exit<font color="#000080">;      </font><font color="#008000"><i>{ ...automatisch geschlossen werden }
  </i></font><font color="#FF0000"><b>end
  else </b></font>Handle <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font>OpenCDHandle <font color="#000080">:= </font>Handle<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>CloseCDHandle<font color="#000080">;
</font><font color="#FF0000"><b>begin
  if </b></font>TextRec<font color="#000080">(</font>H<font color="#000080">).</font>Mode <font color="#000080">&lt;&gt; </font>FmClosed
     <font color="#FF0000"><b>then </b></font>ExitProc <font color="#000080">:= </font>Old_Exit<font color="#000080">;     </font><font color="#008000"><i>{ Umleitung wieder zuruecknehmen }
  </i></font>Old_Exit <font color="#000080">:= </font><font color="#FF0000"><b>NIL</b></font><font color="#000080">;
</font><font color="#008000"><i>{$I-}
  </i></font>Close<font color="#000080">(</font>H<font color="#000080">);
  </font><font color="#FF0000"><b>If </b></font>IoResult <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>then</b></font><font color="#000080">;             </font><font color="#008000"><i>{ 'H' schliessen, falls offen, }
{$I+}                                     { evtl. Fehler verwerfen }
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>Function </b></font>Red2HSG<font color="#000080">( </font><font color="#FF0000"><b>Var </b></font>Inf<font color="#000080">:</font>TrkInfo <font color="#000080">):</font>LongInt<font color="#000080">;
</font><font color="#FF0000"><b>Var </b></font>l<font color="#000080">: </font>LongInt<font color="#000080">;
</font><font color="#FF0000"><b>begin
      </b></font>l <font color="#000080">:=     </font>LongInt<font color="#000080">(( </font>Inf<font color="#000080">.</font>Start <font color="#FF0000"><b>shr </b></font><font color="#800000">16 </font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#800000">$FF </font><font color="#000080">)  * </font><font color="#800000">4500</font><font color="#000080">;
      </font>l <font color="#000080">:= </font>l <font color="#000080">+ </font>LongInt<font color="#000080">(( </font>Inf<font color="#000080">.</font>Start <font color="#FF0000"><b>shr  </b></font><font color="#800000">8 </font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#800000">$FF </font><font color="#000080">)  * </font><font color="#800000">75</font><font color="#000080">;
      </font>l <font color="#000080">:= </font>l <font color="#000080">+ </font>LongInt<font color="#000080">(( </font>Inf<font color="#000080">.</font>Start        <font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#800000">$FF </font><font color="#000080">) ;

  </font>Red2HSG <font color="#000080">:= </font>l <font color="#000080">-</font><font color="#800000">2</font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>Red2Time<font color="#000080">( </font><font color="#FF0000"><b>Var </b></font>Inf<font color="#000080">:</font>TrkInfo <font color="#000080">):</font>Word<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>Red2Time<font color="#000080">:= (( </font>Inf<font color="#000080">.</font>Start <font color="#FF0000"><b>shr </b></font><font color="#800000">24 </font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#800000">$FF </font><font color="#000080">) </font><font color="#FF0000"><b>shl </b></font><font color="#800000">8
           </font><font color="#000080">+ (( </font>Inf<font color="#000080">.</font>Start <font color="#FF0000"><b>shr </b></font><font color="#800000">16 </font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#800000">$FF </font><font color="#000080">)
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>HSG2Red<font color="#000080">(</font>L<font color="#000080">:</font>LongInt<font color="#000080">):</font>LongInt<font color="#000080">;
</font><font color="#FF0000"><b>begin
end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>CD_IOCtl<font color="#000080">( </font>Func<font color="#000080">, </font>Len <font color="#000080">: </font>Word<font color="#000080">) :  </font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>begin
  With </b></font>R <font color="#FF0000"><b>do
  begin
    </b></font>AX <font color="#000080">:= </font>Func<font color="#000080">;
    </font>BX <font color="#000080">:= </font>OpenCDHandle<font color="#000080">;
    </font>CX <font color="#000080">:= </font><font color="#800000">129</font><font color="#000080">;
    </font>DS <font color="#000080">:= </font>DSeg<font color="#000080">;
    </font>ES <font color="#000080">:= </font>DS<font color="#000080">;
    </font>DX <font color="#000080">:= </font>Ofs<font color="#000080">(</font>CtlBlk<font color="#000080">);
    </font>MsDos<font color="#000080">( </font>R <font color="#000080">);
    </font>CD<font color="#000080">.</font>Status <font color="#000080">:= </font>AX<font color="#000080">;
    </font>CD_IOCtl  <font color="#000080">:= (</font>Flags <font color="#FF0000"><b>and </b></font>FCARRY<font color="#000080">) = </font><font color="#800000">0</font><font color="#000080">;
    </font>CloseCDHandle<font color="#000080">;
  </font><font color="#FF0000"><b>end
end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>Function </b></font>CD_Reset<font color="#000080">: </font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>CtlBlk<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">] := </font><font color="#800000">2</font><font color="#000080">;   </font><font color="#008000"><i>{ Reset }
  </i></font>CD_Reset  <font color="#000080">:= </font>CD_IoCtl<font color="#000080">( </font>IoCtlWrite<font color="#000080">, </font><font color="#800000">1</font><font color="#000080">)
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>DieTuer<font color="#000080">( </font>AufZu<font color="#000080">:</font>Byte <font color="#000080">): </font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>CtlBlk<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">] := </font><font color="#800000">1</font><font color="#000080">;                                      </font><font color="#008000"><i>{ die Tuer.. }
  </i></font>CtlBlk<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">] := </font>AufZu<font color="#000080">;                                </font><font color="#008000"><i>{ ..freigeben }
  </i></font>DieTuer <font color="#000080">:= </font>CD_IoCTL<font color="#000080">(</font>IoCtlWrite<font color="#000080">, </font><font color="#800000">2</font><font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>CD_Open<font color="#000080">: </font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>Const </b></font>Auf <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">;
</font><font color="#FF0000"><b>begin
 </b></font>CD_Open <font color="#000080">:= </font>DieTuer<font color="#000080">( </font>Auf <font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>CD_Close<font color="#000080">: </font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>Const </b></font>Zu <font color="#000080">= </font><font color="#800000">1</font><font color="#000080">;
</font><font color="#FF0000"><b>begin
 </b></font>CD_Close <font color="#000080">:= </font>DieTuer<font color="#000080">( </font>Zu <font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>Function </b></font>CD_Eject<font color="#000080">: </font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>CtlBlk<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">] := </font><font color="#800000">0</font><font color="#000080">;                                   </font><font color="#008000"><i>{ CD auswerfen }
  </i></font>CD_Eject  <font color="#000080">:= </font>CD_IOCtl<font color="#000080">(</font>IoCtlWrite<font color="#000080">, </font><font color="#800000">1</font><font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>Function </b></font>CD_Play<font color="#000080">(</font>no<font color="#000080">:</font>Byte<font color="#000080">; </font>len<font color="#000080">:</font>Integer<font color="#000080">):  </font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>begin                                               </b></font><font color="#008000"><i>{ CD PlayAudio }

  </i></font>FillChar<font color="#000080">(</font>CtlBlk<font color="#000080">, </font>SizeOf<font color="#000080">(</font>CtlBlk<font color="#000080">), </font><font color="#800000">0</font><font color="#000080">);
  </font>CtlBlk<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">] := </font><font color="#800000">22</font><font color="#000080">;                             </font><font color="#008000"><i>{ laenge des req-hdr }
  </i></font>CtlBlk<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">] := </font><font color="#800000">0</font><font color="#000080">;                                       </font><font color="#008000"><i>{ sub-Unit }
  </i></font>CtlBlk<font color="#000080">[</font><font color="#800000">2</font><font color="#000080">] := </font><font color="#800000">$84</font><font color="#000080">;                                     </font><font color="#008000"><i>{ Kommando }
  </i></font>CtlBlk<font color="#000080">[</font><font color="#800000">3</font><font color="#000080">] := </font><font color="#800000">0</font><font color="#000080">;                                    </font><font color="#008000"><i>{ Status-WORT }
  </i></font>CtlBlk<font color="#000080">[</font><font color="#800000">4</font><font color="#000080">] := </font><font color="#800000">0</font><font color="#000080">;
  </font>CtlBlk<font color="#000080">[</font><font color="#800000">5</font><font color="#000080">] := </font><font color="#800000">0</font><font color="#000080">;
  </font>CtlBlk<font color="#000080">[</font><font color="#800000">13</font><font color="#000080">]:= </font>CD<font color="#000080">.</font>HSG_RB<font color="#000080">;                             </font><font color="#008000"><i>{ HSG-Modus }

  </i></font>CD<font color="#000080">.</font>Sector <font color="#000080">:= </font>VtoC<font color="#000080">.</font>Titles<font color="#000080">[</font>no<font color="#000080">].</font>Start<font color="#000080">;          </font><font color="#008000"><i>{ ist im HSG-Format }

  </i></font>Move<font color="#000080">( </font>CD<font color="#000080">.</font>Sector<font color="#000080">, </font>CtlBlk<font color="#000080">[</font><font color="#800000">14</font><font color="#000080">], </font><font color="#800000">4 </font><font color="#000080">);                 </font><font color="#008000"><i>{ Start-Sector }
  </i></font><font color="#FF0000"><b>if </b></font>len <font color="#000080">= -</font><font color="#800000">1
    </font><font color="#FF0000"><b>then </b></font>All <font color="#000080">:= </font><font color="#800000">$FFFF
    </font><font color="#FF0000"><b>else </b></font>All <font color="#000080">:= </font>len<font color="#000080">;
  </font>Move<font color="#000080">( </font>All      <font color="#000080">, </font>CtlBlk<font color="#000080">[</font><font color="#800000">18</font><font color="#000080">], </font><font color="#800000">4 </font><font color="#000080">);               </font><font color="#008000"><i>{ Anzahl Sectoren}
  </i></font><font color="#FF0000"><b>Asm
     </b></font><font color="#FF00FF">mov  ax, $1510
     push ds
     pop  es
     xor  cx, cx
     mov  cl, CD.DrvNo
     mov  bx, offset CtlBlk
     Int $2f
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font>CD<font color="#000080">.</font>Status <font color="#000080">:= </font>CtlBlk<font color="#000080">[</font><font color="#800000">3</font><font color="#000080">] </font><font color="#FF0000"><b>or </b></font>CtlBlk<font color="#000080">[</font><font color="#800000">4</font><font color="#000080">] </font><font color="#FF0000"><b>shl </b></font><font color="#800000">8</font><font color="#000080">;
  </font>CD_Play   <font color="#000080">:= </font>CD<font color="#000080">.</font>Status <font color="#FF0000"><b>and </b></font><font color="#800000">$8000 </font><font color="#000080">= </font><font color="#800000">0</font><font color="#000080">;

</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>CD_VtoC<font color="#000080">:</font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>Var </b></font>i<font color="#000080">: </font>Byte<font color="#000080">;
    </font>l<font color="#000080">: </font>LongInt<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>FillChar<font color="#000080">( </font>Tracks<font color="#000080">, </font>SizeOf<font color="#000080">( </font>Tracks <font color="#000080">), </font><font color="#800000">0</font><font color="#000080">);
  </font>CtlBlk<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">] := </font><font color="#800000">10</font><font color="#000080">;                               </font><font color="#008000"><i>{ Read LeadOut-Tr }
  </i></font>CD_IoCtl<font color="#000080">( </font>IoCtlRead<font color="#000080">, </font><font color="#800000">6</font><font color="#000080">);
  </font>Move<font color="#000080">( </font>CtlBlk<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">], </font>CD<font color="#000080">.</font>LoAuTr<font color="#000080">, </font><font color="#800000">6</font><font color="#000080">);
  </font>i <font color="#000080">:= </font>CD<font color="#000080">.</font>HiAuTr<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">;
  </font>Move<font color="#000080">( </font>CtlBlk<font color="#000080">[</font><font color="#800000">3</font><font color="#000080">], </font>Tracks<font color="#000080">[</font>i<font color="#000080">], </font><font color="#800000">4</font><font color="#000080">);      </font><font color="#008000"><i>{ die Auslaufrille 8-) }
  </i></font>Tracks<font color="#000080">[</font>i<font color="#000080">].</font>Start <font color="#000080">:= </font>Red2Hsg<font color="#000080">(</font>Tracks<font color="#000080">[</font>i<font color="#000080">]);

  </font><font color="#FF0000"><b>For </b></font>i <font color="#000080">:= </font>CD<font color="#000080">.</font>LoAuTr <font color="#FF0000"><b>to </b></font>CD<font color="#000080">.</font>HiAuTr <font color="#FF0000"><b>do
  begin
    </b></font>FillChar<font color="#000080">(</font>CtlBlk<font color="#000080">, </font>SizeOf<font color="#000080">(</font>CtlBlk<font color="#000080">), </font><font color="#800000">0</font><font color="#000080">);           </font><font color="#008000"><i>{ RED-Book-Format }
    </i></font>CtlBlk<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">] := </font><font color="#800000">11</font><font color="#000080">;                               </font><font color="#008000"><i>{ Read VtoC-Entry }
    </i></font>CtlBlk<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">] := </font>i<font color="#000080">;                                       </font><font color="#008000"><i>{ track-no }
    </i></font>CD_IoCtl<font color="#000080">( </font>IoCtlRead<font color="#000080">, </font><font color="#800000">6</font><font color="#000080">);
    </font>Move<font color="#000080">( </font>CtlBlk<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">], </font>Tracks<font color="#000080">[</font>i<font color="#000080">], </font><font color="#800000">6</font><font color="#000080">);
</font><font color="#008000"><i>{   Tracks[i].Start := Red2Hsg(Tracks[i]); }
  </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;


  </font><font color="#FF0000"><b>With </b></font>VtoC <font color="#FF0000"><b>do
  begin
    </b></font>DiskName <font color="#000080">:= </font><font color="#800000">''</font><font color="#000080">;
    </font>UAN_Code <font color="#000080">:= </font><font color="#800000">''</font><font color="#000080">;
    </font>TrackCnt <font color="#000080">:= </font>CD<font color="#000080">.</font>HiAuTr<font color="#000080">;
    </font><font color="#FF0000"><b>For </b></font>i <font color="#000080">:= </font>CD<font color="#000080">.</font>LoAuTr <font color="#FF0000"><b>to </b></font>CD<font color="#000080">.</font>HiAuTr <font color="#FF0000"><b>do
    With </b></font>Titles<font color="#000080">[</font>i<font color="#000080">] </font><font color="#FF0000"><b>do
    begin
      </b></font>L <font color="#000080">:= </font>LongInt<font color="#000080">((</font>Tracks<font color="#000080">[</font>i<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">].</font>Start <font color="#FF0000"><b>shr </b></font><font color="#800000">16</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#800000">$FF</font><font color="#000080">) * </font><font color="#800000">60
        </font><font color="#000080">+         (</font>Tracks<font color="#000080">[</font>i<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">].</font>Start <font color="#FF0000"><b>shr  </b></font><font color="#800000">8</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#800000">$FF
        </font><font color="#000080">- ( </font>LongInt<font color="#000080">((</font>Tracks<font color="#000080">[</font>i<font color="#000080">].</font>Start <font color="#FF0000"><b>shr </b></font><font color="#800000">16</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#800000">$FF</font><font color="#000080">) * </font><font color="#800000">60
                 </font><font color="#000080">+  (</font>Tracks<font color="#000080">[</font>i<font color="#000080">].</font>Start <font color="#FF0000"><b>shr  </b></font><font color="#800000">8</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#800000">$FF</font><font color="#000080">);
      </font>Title  <font color="#000080">:= </font><font color="#800000">'???'</font><font color="#000080">;
      </font>RunMin <font color="#000080">:= </font>L <font color="#FF0000"><b>div </b></font><font color="#800000">60</font><font color="#000080">;
      </font>RunSec <font color="#000080">:= </font>l <font color="#000080">- </font>RunMin<font color="#000080">*</font><font color="#800000">60</font><font color="#000080">;
      </font>Start  <font color="#000080">:= </font>Red2Hsg<font color="#000080">(</font>Tracks<font color="#000080">[</font>i<font color="#000080">]);
    </font><font color="#FF0000"><b>end
  end</b></font><font color="#000080">;



</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>CD_Stop<font color="#000080">:  </font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>begin                                               </b></font><font color="#008000"><i>{ CD StopAudio }
  </i></font>FillChar<font color="#000080">(</font>CtlBlk<font color="#000080">, </font>SizeOf<font color="#000080">(</font>CtlBlk<font color="#000080">), </font><font color="#800000">0</font><font color="#000080">);
  </font>CtlBlk<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">] := </font><font color="#800000">5</font><font color="#000080">;                             </font><font color="#008000"><i>{ laenge des req-hdr }
  </i></font>CtlBlk<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">] := </font><font color="#800000">0</font><font color="#000080">;                                       </font><font color="#008000"><i>{ sub-Unit }
  </i></font>CtlBlk<font color="#000080">[</font><font color="#800000">2</font><font color="#000080">] := </font><font color="#800000">$85</font><font color="#000080">;                                     </font><font color="#008000"><i>{ Kommando }
  </i></font>CtlBlk<font color="#000080">[</font><font color="#800000">3</font><font color="#000080">] := </font><font color="#800000">0</font><font color="#000080">;                                    </font><font color="#008000"><i>{ Status-WORT }
  </i></font>CtlBlk<font color="#000080">[</font><font color="#800000">4</font><font color="#000080">] := </font><font color="#800000">0</font><font color="#000080">;
  </font>CtlBlk<font color="#000080">[</font><font color="#800000">5</font><font color="#000080">] := </font><font color="#800000">0</font><font color="#000080">;
  </font><font color="#FF0000"><b>Asm
     </b></font><font color="#FF00FF">mov  ax, $1510
     push ds
     pop  es
     xor  cx, cx
     mov  cl, CD.DrvNo
     mov  bx, offset CtlBlk
     Int $2f
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font>CD<font color="#000080">.</font>Status <font color="#000080">:= </font>CtlBlk<font color="#000080">[</font><font color="#800000">3</font><font color="#000080">] </font><font color="#FF0000"><b>or </b></font>CtlBlk<font color="#000080">[</font><font color="#800000">4</font><font color="#000080">] </font><font color="#FF0000"><b>shl </b></font><font color="#800000">8</font><font color="#000080">;
  </font>CD_Stop   <font color="#000080">:= </font>CD<font color="#000080">.</font>Status <font color="#FF0000"><b>and </b></font><font color="#800000">$8000 </font><font color="#000080">= </font><font color="#800000">0</font><font color="#000080">;

</font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>Function </b></font>CD_Resume<font color="#000080">:</font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>begin                                                 </b></font><font color="#008000"><i>{ ResumeAudio}
  </i></font>CtlBlk<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">] := </font><font color="#800000">3</font><font color="#000080">;                              </font><font color="#008000"><i>{ laenge des req-hdr }
  </i></font>CtlBlk<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">] := </font><font color="#800000">0</font><font color="#000080">;                                       </font><font color="#008000"><i>{ sub-Unit }
  </i></font>CtlBlk<font color="#000080">[</font><font color="#800000">2</font><font color="#000080">] := </font><font color="#800000">$88</font><font color="#000080">;                                     </font><font color="#008000"><i>{ Kommando }
  </i></font>CtlBlk<font color="#000080">[</font><font color="#800000">3</font><font color="#000080">] := </font><font color="#800000">0</font><font color="#000080">;                                    </font><font color="#008000"><i>{ Status-WORT }
  </i></font>CtlBlk<font color="#000080">[</font><font color="#800000">4</font><font color="#000080">] := </font><font color="#800000">0</font><font color="#000080">;
  </font><font color="#FF0000"><b>Asm
     </b></font><font color="#FF00FF">mov ax, Seg @DATA
     mov es, ax
     mov ax, DevDrvReq
     lea bx, CtlBlk
     Int 2fh
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>CD<font color="#000080">.</font>Status <font color="#000080">:= </font>CtlBlk<font color="#000080">[</font><font color="#800000">3</font><font color="#000080">] </font><font color="#FF0000"><b>or </b></font>CtlBlk<font color="#000080">[</font><font color="#800000">4</font><font color="#000080">] </font><font color="#FF0000"><b>shl </b></font><font color="#800000">8</font><font color="#000080">;
  </font>CD_Resume <font color="#000080">:= </font>CD<font color="#000080">.</font>Status <font color="#FF0000"><b>and </b></font><font color="#800000">$8000 </font><font color="#000080">= </font><font color="#800000">0</font><font color="#000080">;

</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>CD_GetVol<font color="#000080">:</font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>CtlBlk<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">] := </font><font color="#800000">4</font><font color="#000080">;                           </font><font color="#008000"><i>{ die Lautstaerke lesen }
  </i></font>CD_GetVol <font color="#000080">:= </font>CD_IOCtl<font color="#000080">(</font>IoCtlRead<font color="#000080">, </font><font color="#800000">8</font><font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font><font color="#000080">((</font>R<font color="#000080">.</font>Flags <font color="#FF0000"><b>and </b></font>FCARRY<font color="#000080">) = </font><font color="#800000">0</font><font color="#000080">)
   </font><font color="#FF0000"><b>then </b></font>Move<font color="#000080">(</font>CtlBlk<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">], </font>CD<font color="#000080">.</font>VolInfo<font color="#000080">, </font><font color="#800000">8</font><font color="#000080">)
   </font><font color="#FF0000"><b>else </b></font>FillChar<font color="#000080">( </font>CD<font color="#000080">.</font>VolInfo<font color="#000080">, </font><font color="#800000">8</font><font color="#000080">, </font><font color="#800000">0</font><font color="#000080">)
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>CD_SetVol<font color="#000080">:</font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>CtlBlk<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">] := </font><font color="#800000">3</font><font color="#000080">;                          </font><font color="#008000"><i>{ die Lautstaerke setzen }
  </i></font>CD_SetVol <font color="#000080">:= </font>CD_IOCtl<font color="#000080">( </font>IoCtlWrite<font color="#000080">, </font><font color="#800000">8</font><font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>CD_HeadAdr<font color="#000080">: </font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>Var  </b></font>L<font color="#000080">:</font>LongInt<font color="#000080">;  </font>S<font color="#000080">:</font><font color="#FF0000"><b>String</b></font><font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>FillChar<font color="#000080">(</font>CtlBlk<font color="#000080">, </font>SizeOf<font color="#000080">(</font>CtlBlk<font color="#000080">), </font><font color="#800000">0</font><font color="#000080">);
  </font>CtlBlk<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">] := </font><font color="#800000">1</font><font color="#000080">;
  </font>CtlBlk<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">] := </font><font color="#800000">1</font><font color="#000080">;                     </font><font color="#008000"><i>{ die KopfPosition im RED-Format }
  </i></font>CD_HeadAdr<font color="#000080">:= </font>CD_IOCtl<font color="#000080">(</font>IoCtlRead<font color="#000080">, </font><font color="#800000">128</font><font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font><font color="#000080">((</font>R<font color="#000080">.</font>Flags <font color="#FF0000"><b>and </b></font>FCARRY<font color="#000080">) = </font><font color="#800000">0</font><font color="#000080">)
    </font><font color="#FF0000"><b>then begin
           </b></font>Move<font color="#000080">(</font>CtlBlk<font color="#000080">[</font><font color="#800000">2</font><font color="#000080">], </font>L<font color="#000080">, </font><font color="#800000">4</font><font color="#000080">);
           </font><font color="#FF0000"><b>if </b></font>CtlBlk<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">] = </font><font color="#800000">1 </font><font color="#FF0000"><b>then
           begin
             </b></font>STR<font color="#000080">( </font>CtlBlk<font color="#000080">[</font><font color="#800000">4</font><font color="#000080">]:</font><font color="#800000">2</font><font color="#000080">, </font>S<font color="#000080">);  </font>CD_REDPos <font color="#000080">:= </font>S<font color="#000080">;
             </font>STR<font color="#000080">( </font>CtlBlk<font color="#000080">[</font><font color="#800000">3</font><font color="#000080">]:</font><font color="#800000">2</font><font color="#000080">, </font>S<font color="#000080">);  </font>CD_REDPos <font color="#000080">:= </font>CD_REDPos<font color="#000080">+ </font><font color="#800000">':'</font><font color="#000080">+ </font>S<font color="#000080">;
             </font>CD<font color="#000080">.</font>Sector <font color="#000080">:= </font>LongInt<font color="#000080">(</font>CtlBlk<font color="#000080">[</font><font color="#800000">4</font><font color="#000080">]) *</font><font color="#800000">4500 </font><font color="#000080">+
                          </font>LongInt<font color="#000080">(</font>CtlBlk<font color="#000080">[</font><font color="#800000">3</font><font color="#000080">]) *</font><font color="#800000">75   </font><font color="#000080">+
                          </font>LongInt<font color="#000080">(</font>CtlBlk<font color="#000080">[</font><font color="#800000">2</font><font color="#000080">])
                          - </font><font color="#800000">150</font><font color="#000080">;
           </font><font color="#FF0000"><b>end else
           begin
             </b></font>CD<font color="#000080">.</font>Sector <font color="#000080">:= </font>L<font color="#000080">;
             </font>STR<font color="#000080">(</font>L<font color="#000080">:</font><font color="#800000">0</font><font color="#000080">,</font>CD_HSGPos<font color="#000080">);
           </font><font color="#FF0000"><b>end

         end
    else </b></font>FillChar<font color="#000080">( </font>CD<font color="#000080">.</font>Sector<font color="#000080">, </font><font color="#800000">4</font><font color="#000080">, </font><font color="#800000">0</font><font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>Function </b></font>CD_Position<font color="#000080">:</font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>Var </b></font>l <font color="#000080">: </font>LongInt<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>CtlBlk<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">] := </font><font color="#800000">12</font><font color="#000080">;                                  </font><font color="#008000"><i>{ Audio-Infos  }
  </i></font>CD_Position <font color="#000080">:=</font>CD_IOCtl<font color="#000080">(</font>IoCtlRead<font color="#000080">,</font><font color="#800000">10</font><font color="#000080">);
  </font>Move<font color="#000080">(</font>CtlBlk<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">], </font>CD<font color="#000080">.</font>CntAdr<font color="#000080">, </font><font color="#800000">10</font><font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>Procedure </b></font>CD_GetUAN<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>CtlBlk<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">] := </font><font color="#800000">14</font><font color="#000080">;                                  </font><font color="#008000"><i>{ EAN-Nummer   }
  </i></font><font color="#FF0000"><b>If </b></font>CD_IOCtl<font color="#000080">(</font>IoCtlRead<font color="#000080">,</font><font color="#800000">10</font><font color="#000080">)
    </font><font color="#FF0000"><b>then </b></font>Move<font color="#000080">(</font>CtlBlk<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">], </font>CD<font color="#000080">.</font>Uctrl<font color="#000080">, </font><font color="#800000">10</font><font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>Function </b></font>CD_MediaChanged<font color="#000080">:</font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>CtlBlk<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">] := </font><font color="#800000">9</font><font color="#000080">;                                   </font><font color="#008000"><i>{ Media-Change }
  </i></font><font color="#FF0000"><b>If </b></font>CD_IOCtl<font color="#000080">(</font>IoCtlRead<font color="#000080">, </font><font color="#800000">1</font><font color="#000080">)
    </font><font color="#FF0000"><b>then </b></font>Move<font color="#000080">(</font>CtlBlk<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">], </font>CD<font color="#000080">.</font>MedChg<font color="#000080">, </font><font color="#800000">1 </font><font color="#000080">);
  </font>CD_MediaChanged<font color="#000080">:= </font>CD<font color="#000080">.</font>MedChg <font color="#000080">&lt;&gt; </font><font color="#800000">1
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>CD_Info<font color="#000080">;
</font><font color="#FF0000"><b>begin

 </b></font><font color="#008000"><i>{ CD_Reset; }

  </i></font><font color="#FF0000"><b>If </b></font>CD_HeadAdr <font color="#FF0000"><b>then</b></font><font color="#000080">;

  </font>CtlBlk<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">] := </font><font color="#800000">6</font><font color="#000080">;                               </font><font color="#008000"><i>{ Device-parameter }
  </i></font><font color="#FF0000"><b>If </b></font>CD_IOCtl<font color="#000080">(</font>IoCtlRead<font color="#000080">, </font><font color="#800000">4</font><font color="#000080">)
    </font><font color="#FF0000"><b>then </b></font>Move<font color="#000080">(</font>CtlBlk<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">], </font>CD<font color="#000080">.</font>DevPar<font color="#000080">, </font><font color="#800000">4 </font><font color="#000080">);

  </font>CtlBlk<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">] := </font><font color="#800000">7</font><font color="#000080">;                                   </font><font color="#008000"><i>{ Sector-Groesse }
  </i></font><font color="#FF0000"><b>If </b></font>CD_IOCtl<font color="#000080">(</font>IoCtlRead<font color="#000080">, </font><font color="#800000">3</font><font color="#000080">)                              </font><font color="#008000"><i>{ &amp; Modus }
    </i></font><font color="#FF0000"><b>then </b></font>Move<font color="#000080">(</font>CtlBlk<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">], </font>CD<font color="#000080">.</font>RawMode<font color="#000080">, </font><font color="#800000">3 </font><font color="#000080">);

  </font>CtlBlk<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">] := </font><font color="#800000">8</font><font color="#000080">;                                   </font><font color="#008000"><i>{ Volume-Groesse }
  </i></font><font color="#FF0000"><b>If </b></font>CD_IOCtl<font color="#000080">(</font>IoCtlRead<font color="#000080">, </font><font color="#800000">4</font><font color="#000080">)
    </font><font color="#FF0000"><b>then </b></font>Move<font color="#000080">(</font>CtlBlk<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">], </font>CD<font color="#000080">.</font>VolSize<font color="#000080">, </font><font color="#800000">4 </font><font color="#000080">);

  </font>CtlBlk<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">] := </font><font color="#800000">12</font><font color="#000080">;                                  </font><font color="#008000"><i>{ Audio-Infos  }
  </i></font><font color="#FF0000"><b>If </b></font>CD_IOCtl<font color="#000080">(</font>IoCtlRead<font color="#000080">,</font><font color="#800000">10</font><font color="#000080">)
    </font><font color="#FF0000"><b>then </b></font>Move<font color="#000080">(</font>CtlBlk<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">], </font>CD<font color="#000080">.</font>CntAdr<font color="#000080">, </font><font color="#800000">10</font><font color="#000080">);

  </font>CtlBlk<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">] := </font><font color="#800000">11</font><font color="#000080">;                                  </font><font color="#008000"><i>{ Track-Infos  }
  </i></font>CtlBlk<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">] := </font>CtlBlk<font color="#000080">[</font><font color="#800000">2</font><font color="#000080">];                           </font><font color="#008000"><i>{ aktueller... }
  </i></font><font color="#FF0000"><b>If </b></font>CD_IOCtl<font color="#000080">(</font>IoCtlRead<font color="#000080">, </font><font color="#800000">6</font><font color="#000080">)
    </font><font color="#FF0000"><b>then </b></font>Move<font color="#000080">(</font>CtlBlk<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">], </font>CD<font color="#000080">.</font>TrkNo<font color="#000080">, </font><font color="#800000">6 </font><font color="#000080">);

  </font>CD_VtoC<font color="#000080">;

</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{========= minimale Initialisierung =============}
</i></font><font color="#FF0000"><b>begin
  </b></font>CD_Avail <font color="#000080">:= </font>CD_Init<font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font>CD_Avail <font color="#FF0000"><b>then </b></font>CD_INFO
<font color="#FF0000"><b>end</b></font><font color="#000080">. </font>Norbert

<font color="#008000"><i>{
--- part 2, a Test -----
}
</i></font><font color="#FF0000"><b>Program </b></font>CDROM_TEST<font color="#000080">;
</font><font color="#FF0000"><b>Uses </b></font>Crt<font color="#000080">, </font>cdrom<font color="#000080">, </font>SbTest<font color="#000080">;
</font><font color="#FF0000"><b>Type </b></font>a5 <font color="#000080">= </font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">4</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Byte<font color="#000080">;
</font><font color="#FF0000"><b>Var </b></font>i<font color="#000080">:</font>Byte<font color="#000080">;
    </font>L <font color="#000080">: </font>LongInt<font color="#000080">;
    </font>ch <font color="#000080">: </font>Char<font color="#000080">;
    </font>no<font color="#000080">,
    </font>len <font color="#000080">: </font>Integer<font color="#000080">;

</font><font color="#FF0000"><b>begin
  </b></font>ClrScr<font color="#000080">;
  </font>WriteLn<font color="#000080">(</font><font color="#800000">'CDROM-Unit TestProgram'</font><font color="#000080">,</font><font color="#800000">#10</font><font color="#000080">);
  </font><font color="#FF0000"><b>With </b></font>CD <font color="#FF0000"><b>do
  if </b></font>CD_Avail <font color="#FF0000"><b>then
  begin
   </b></font>WriteLn<font color="#000080">(</font><font color="#800000">'&thorn; CD als Laufwerk '</font><font color="#000080">,</font>DrvChar<font color="#000080">,</font><font color="#800000">': gefunden!'</font><font color="#000080">);
   </font>Write  <font color="#000080">(</font><font color="#800000">'&thorn; Aktuelle CD: '</font><font color="#000080">);

   </font>Write<font color="#000080">(</font><font color="#800000">'(UPN-CODE:'</font><font color="#000080">);
   </font><font color="#FF0000"><b>For </b></font>i <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font><font color="#800000">7 </font><font color="#FF0000"><b>do </b></font>Write<font color="#000080">(</font>Char<font color="#000080">( (</font>Upn<font color="#000080">[</font>i<font color="#000080">] </font><font color="#FF0000"><b>shr </b></font><font color="#800000">4</font><font color="#000080">)  </font><font color="#FF0000"><b>or </b></font><font color="#800000">$30</font><font color="#000080">),
                            </font>Char<font color="#000080">((</font>Upn<font color="#000080">[</font>i<font color="#000080">] </font><font color="#FF0000"><b>and </b></font><font color="#800000">$f</font><font color="#000080">) </font><font color="#FF0000"><b>or </b></font><font color="#800000">$30</font><font color="#000080">));
   </font>WriteLn<font color="#000080">(</font><font color="#800000">#8')'</font><font color="#000080">);
   </font>WriteLn<font color="#000080">(</font><font color="#800000">'&thorn; Audio-Tracks : '</font><font color="#000080">,</font>loautr<font color="#000080">,</font><font color="#800000">'..'</font><font color="#000080">,</font>hiautr<font color="#000080">);
   </font>WriteLn<font color="#000080">(</font><font color="#800000">' Laufzeiten : '</font><font color="#000080">);
   </font><font color="#FF0000"><b>For </b></font>i <font color="#000080">:= </font>CD<font color="#000080">.</font>LoAuTr <font color="#FF0000"><b>to </b></font>CD<font color="#000080">.</font>HiAuTr <font color="#FF0000"><b>do
    With </b></font>VtoC<font color="#000080">.</font>Titles<font color="#000080">[</font>i<font color="#000080">] </font><font color="#FF0000"><b>do
      </b></font>WriteLn<font color="#000080">(</font>i<font color="#000080">,</font>Title<font color="#000080">:</font><font color="#800000">10</font><font color="#000080">, </font>RunMin<font color="#000080">:</font><font color="#800000">6</font><font color="#000080">,</font><font color="#800000">':'</font><font color="#000080">,</font>RunSec<font color="#000080">);
   </font>no <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;
   </font>len <font color="#000080">:= -</font><font color="#800000">1</font><font color="#000080">;

   </font><font color="#FF0000"><b>if </b></font>CD_Stop <font color="#FF0000"><b>then
     if not </b></font>CD_Play<font color="#000080">( </font>no <font color="#000080">,</font>len<font color="#000080">)
        </font><font color="#FF0000"><b>then </b></font>WriteLn<font color="#000080">(</font><font color="#800000">'! Fehler-Status: '</font><font color="#000080">,</font>STATUS <font color="#FF0000"><b>and </b></font><font color="#800000">$F</font><font color="#000080">);

   </font>ch <font color="#000080">:= </font><font color="#800000">' '</font><font color="#000080">;
   </font><font color="#FF0000"><b>While </b></font>ch <font color="#000080">&lt;&gt; </font><font color="#800000">#27 </font><font color="#FF0000"><b>do
   begin
   While </b></font>ch <font color="#000080">= </font><font color="#800000">' ' </font><font color="#FF0000"><b>do
     With </b></font>CD <font color="#FF0000"><b>do
     begin
       if </b></font>CD_Position <font color="#FF0000"><b>then
         </b></font>Write<font color="#000080">(</font><font color="#800000">'Playing Track '</font><font color="#000080">,</font>CTrk<font color="#000080">,</font><font color="#800000">'  :   '</font><font color="#000080">,</font>CMin<font color="#000080">:</font><font color="#800000">2</font><font color="#000080">,</font><font color="#800000">':'</font><font color="#000080">,</font>CSek<font color="#000080">:</font><font color="#800000">2</font><font color="#000080">,</font><font color="#800000">'   '#13</font><font color="#000080">);
       </font>Delay<font color="#000080">(</font><font color="#800000">1500</font><font color="#000080">);
       </font><font color="#FF0000"><b>if </b></font>KeyPressed
          <font color="#FF0000"><b>then </b></font>ch <font color="#000080">:= </font>ReadKey<font color="#000080">;
     </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
     </font><font color="#FF0000"><b>Case </b></font>ch <font color="#FF0000"><b>of
       </b></font><font color="#800000">'+' </font><font color="#000080">: </font>Inc<font color="#000080">(</font>no<font color="#000080">);
       </font><font color="#800000">'-' </font><font color="#000080">: </font>Dec<font color="#000080">(</font>no<font color="#000080">);
     </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
     </font><font color="#FF0000"><b>if </b></font>ch <font color="#000080">&lt;&gt; </font><font color="#800000">#27 </font><font color="#FF0000"><b>then </b></font>ch <font color="#000080">:= </font><font color="#800000">' '</font><font color="#000080">;
     </font><font color="#FF0000"><b>if </b></font>no <font color="#000080">&gt; </font>cd<font color="#000080">.</font>HiAUTr <font color="#FF0000"><b>then </b></font>Dec<font color="#000080">(</font>no<font color="#000080">);
     </font><font color="#FF0000"><b>if </b></font>no <font color="#000080">&lt; </font>cd<font color="#000080">.</font>LoAuTr <font color="#FF0000"><b>then </b></font>Inc<font color="#000080">(</font>no<font color="#000080">);
     </font><font color="#FF0000"><b>if </b></font>CD_Stop
       <font color="#FF0000"><b>then </b></font>CD_Play<font color="#000080">(</font>no<font color="#000080">, </font>len<font color="#000080">);
   </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
   </font>cd_stop<font color="#000080">;
   </font>clreol<font color="#000080">;
   </font>WriteLn<font color="#000080">(</font><font color="#800000">' CD stopped...'</font><font color="#000080">);
  </font><font color="#FF0000"><b>end
  else </b></font>WriteLn<font color="#000080">(</font><font color="#800000">'Leider kein CD-ROM gefunden...'</font><font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">.

</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to DRIVES SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0001.PAS">Original</a><b>]</b></p></body>
</html>
