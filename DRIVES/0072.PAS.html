<html>
<head><title> "Default Boot Drive" by LEE ARONER</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to DRIVES SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0072.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{$A+,B-,D+,E-,F-,G-,I+,L-,N-,O-,R-,S-,T-,V-,X+}
{$M 3072,0,0}

(*  A program to test some interesting behaviour of Int 21h,
    function 44h subfunction 08h.....the MicroSoft documentation I
    have seen indicates only that this returns an error if the flags
    register is set. however, it seems that it also identifies the
    default bootable logical drive, whether the machine was booted
    from a floppy, and discriminates between Ram drives and normal
    HDrives.....&amp; more! Would appreciate your assistance in
    running this test and returning this information to me by mail.
    The results will be published in the FIDO Pascal echo.

    **************** WARNING  *****************
    Although this program has run completely safely on all machines
    tested by me, you should shut down or save all critical processes
    before running this test.

                    L.R.A.  5/6/94                          *)

</i></font><font color="#FF0000"><b>Program </b></font>TestDisk<font color="#000080">;

</font><font color="#FF0000"><b>Uses   </b></font>Dos<font color="#000080">;

</font><font color="#FF0000"><b>Const
  </b></font>TapeDrive    <font color="#000080">= </font><font color="#800000">$01</font><font color="#000080">;
  </font>CdRom        <font color="#000080">= </font><font color="#800000">$02</font><font color="#000080">;
  </font>Floppy       <font color="#000080">= </font><font color="#800000">$03</font><font color="#000080">;    </font><font color="#008000"><i>(* Old 8 inch &amp; ALL Floppies *)
  </i></font>Floppy360    <font color="#000080">= </font><font color="#800000">$04</font><font color="#000080">;    </font><font color="#008000"><i>(* Also 320K Floppy *)
  </i></font>Floppy720    <font color="#000080">= </font><font color="#800000">$05</font><font color="#000080">;
  </font>Floppy12     <font color="#000080">= </font><font color="#800000">$06</font><font color="#000080">;
  </font>Floppy14     <font color="#000080">= </font><font color="#800000">$07</font><font color="#000080">;
  </font>Floppy28     <font color="#000080">= </font><font color="#800000">$08</font><font color="#000080">;
  </font>Floptical    <font color="#000080">= </font><font color="#800000">$09</font><font color="#000080">;
  </font>Bernoulli    <font color="#000080">= </font><font color="#800000">$0a</font><font color="#000080">;
  </font>RamDrive     <font color="#000080">= </font><font color="#800000">$0b</font><font color="#000080">;
  </font>HardDrive    <font color="#000080">= </font><font color="#800000">$0c</font><font color="#000080">;
  </font>BootHrdDrive <font color="#000080">= </font><font color="#800000">$0d</font><font color="#000080">;   </font><font color="#008000"><i>(* Default HARD-Disk BootDrive !!! *)

  </i></font>DriveTypes <font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">13</font><font color="#000080">] </font><font color="#FF0000"><b>of string</b></font><font color="#000080">[</font><font color="#800000">12</font><font color="#000080">] =
               (</font><font color="#800000">'ERROR !'</font><font color="#000080">,      </font><font color="#800000">'TapeDrive'</font><font color="#000080">,    </font><font color="#800000">'CdRom'</font><font color="#000080">,
                </font><font color="#800000">'Floppy'</font><font color="#000080">,       </font><font color="#800000">'360K Floppy'</font><font color="#000080">,  </font><font color="#800000">'720K Floppy'</font><font color="#000080">,
                </font><font color="#800000">'1.2M Floppy'</font><font color="#000080">,  </font><font color="#800000">'1.44M Floppy'</font><font color="#000080">, </font><font color="#800000">'2.88M Floppy'</font><font color="#000080">,
                </font><font color="#800000">'Floptical'</font><font color="#000080">,    </font><font color="#800000">'Bernoulli'</font><font color="#000080">,    </font><font color="#800000">'RamDrive'</font><font color="#000080">,
                </font><font color="#800000">'HardDrive'</font><font color="#000080">,    </font><font color="#800000">'BootHrdDrive'</font><font color="#000080">);

</font><font color="#FF0000"><b>Var
  </b></font>i           <font color="#000080">: </font>byte<font color="#000080">;
  </font>bits        <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">[</font><font color="#800000">16</font><font color="#000080">];
  </font>buff        <font color="#000080">: </font><font color="#FF0000"><b>array </b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">2047</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">;
  </font>drive       <font color="#000080">: </font>char<font color="#000080">;
  </font>Dtype       <font color="#000080">: </font>byte<font color="#000080">;
  </font>f           <font color="#000080">: </font>text<font color="#000080">;
  </font>y<font color="#000080">,</font>m<font color="#000080">,</font>d<font color="#000080">,</font>dow   <font color="#000080">: </font>word<font color="#000080">;
  </font>lastdrive   <font color="#000080">: </font>byte<font color="#000080">;
  </font>regs        <font color="#000080">: </font>registers<font color="#000080">;
  </font>version     <font color="#000080">: </font>word<font color="#000080">;

</font><font color="#008000"><i>(*------------------------------------------------------*)
</i></font><font color="#FF0000"><b>Function </b></font>BinStr<font color="#000080">(</font>num<font color="#000080">:</font>word<font color="#000080">;</font>bits<font color="#000080">:</font>byte<font color="#000080">):</font><font color="#FF0000"><b>string</b></font><font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>ASM
      </b></font><font color="#FF00FF">PUSHF
      LES  DI, @Result
      XOR  CH, CH
      MOV  CL, bits
      MOV  ES:[DI], CL
      JCXZ @@3
      ADD  DI, CX
      MOV  BX, num
      STD
@@1:  MOV  AL, BL
      AND  AL, $01
      OR   AL, $30
      STOSB
      SHR  BX, 1
      LOOP @@1
@@3:  POPF
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#008000"><i>(*------------------------------------------------------*)
</i></font><font color="#FF0000"><b>Function </b></font>DosVersion <font color="#000080">: </font>word<font color="#000080">;
</font><font color="#FF0000"><b>Begin
  with </b></font>regs <font color="#FF0000"><b>do
    begin
      </b></font>ax <font color="#000080">:= </font><font color="#800000">$3000</font><font color="#000080">;
      </font>Intr<font color="#000080">(</font><font color="#800000">$21</font><font color="#000080">,</font>regs<font color="#000080">);
      </font>DosVersion <font color="#000080">:= (</font>word<font color="#000080">(</font>al<font color="#000080">)*</font><font color="#800000">100</font><font color="#000080">)+</font>word<font color="#000080">(</font>ah<font color="#000080">);
   </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#008000"><i>(*---------------------------------------------------------*)
   (* Uses Undocumented function 52h to return actual logical
      lastdrive even under Novell and even if LastDrive is not
      used in Config.Sys. Must be DOS 3.1 or higher !!
      Return is 1 based ie: A=1, B=2, C=3, etc. !!!!

      Note: this will always return 5 if lastdrive is not
      specified in config.sys, even if less then 5 drives !                            *)

</i></font><font color="#FF0000"><b>Function </b></font>GetLastDrive<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>Drives<font color="#000080">:</font>byte<font color="#000080">):</font>boolean<font color="#000080">;
</font><font color="#FF0000"><b>Begin
  With </b></font>regs <font color="#FF0000"><b>do
    begin
      </b></font>ah <font color="#000080">:= </font><font color="#800000">$52</font><font color="#000080">;       </font><font color="#008000"><i>(* Return pointer to List of Lists *)
      </i></font>es <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
      </font>bx <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
      </font>Intr<font color="#000080">(</font><font color="#800000">$21</font><font color="#000080">,</font>regs<font color="#000080">);
  </font><font color="#008000"><i>(* This offset is ONLY valid for DOS 3.1 and above !! *)
      </i></font>Drives <font color="#000080">:= </font>Mem<font color="#000080">[</font>es<font color="#000080">:</font>bx<font color="#000080">+</font><font color="#800000">$21</font><font color="#000080">];
      </font>GetLastDrive <font color="#000080">:= (</font>Drives <font color="#000080">&lt;&gt; </font><font color="#800000">$FF</font><font color="#000080">)
              </font><font color="#FF0000"><b>AND </b></font><font color="#000080">((</font>es <font color="#000080">&lt;&gt; </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>AND </b></font><font color="#000080">(</font>bx <font color="#000080">&lt;&gt; </font><font color="#800000">0</font><font color="#000080">));
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#008000"><i>(*-----------------------------------------------------------*)
(* Switches to requested drive and then checks for error -
   Be sure to call this with Drive UpCased !! - Should work OK
   with networks ???????                                     *)

</i></font><font color="#FF0000"><b>Function </b></font>DriveValid<font color="#000080">(</font>drive<font color="#000080">: </font>char<font color="#000080">): </font>boolean<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>asm
    </b></font><font color="#FF00FF">mov   ah, 19h     </font><font color="#008000"><i>{ Select DOS sub function 19h }
    </i></font><font color="#FF00FF">int   21h         </font><font color="#008000"><i>{ Call DOS for current disk drive }
    </i></font><font color="#FF00FF">mov   bl, al      </font><font color="#008000"><i>{ Save drive code in bl }
    </i></font><font color="#FF00FF">mov   al, Drive   </font><font color="#008000"><i>{ Assign requested drive to al }
    </i></font><font color="#FF00FF">sub   al, 'A'     </font><font color="#008000"><i>{ Adjust so A:=0, B:=1, etc. }
    </i></font><font color="#FF00FF">mov   dl, al      </font><font color="#008000"><i>{ Save adjusted result in dl }
    </i></font><font color="#FF00FF">mov   ah, 0eh     </font><font color="#008000"><i>{ Select DOS sub function 0eh }
    </i></font><font color="#FF00FF">int   21h         </font><font color="#008000"><i>{ Call DOS to set default drive }
    </i></font><font color="#FF00FF">mov   ah, 19h     </font><font color="#008000"><i>{ Select DOS sub function 19h }
    </i></font><font color="#FF00FF">int   21h         </font><font color="#008000"><i>{ Get current drive again }
    </i></font><font color="#FF00FF">mov   cx, 0       </font><font color="#008000"><i>{ Preset result to False }
    </i></font><font color="#FF00FF">cmp   al, dl      </font><font color="#008000"><i>{ Check if drives match }
    </i></font><font color="#FF00FF">jne   @@1         </font><font color="#008000"><i>{ Jump if not--drive not valid }
    </i></font><font color="#FF00FF">mov   cx, 1       </font><font color="#008000"><i>{ Preset result to True }
</i></font><font color="#FF00FF">@@1:
    mov   dl, bl      </font><font color="#008000"><i>{ Restore original default drive }
    </i></font><font color="#FF00FF">mov   ah, 0eh     </font><font color="#008000"><i>{ Select DOS sub function 0eh }
    </i></font><font color="#FF00FF">int   21h         </font><font color="#008000"><i>{ Call DOS to set default drive }
    </i></font><font color="#FF00FF">xchg  ax, cx      </font><font color="#008000"><i>{ Return function result in ax }
</i></font><font color="#FF0000"><b>End</b></font><font color="#000080">;
</font><font color="#008000"><i>(*-----------------------------------------------------*)
   (* Be sure to call this with drive UpCased ! *)

</i></font><font color="#FF0000"><b>Function </b></font>IsCDRom<font color="#000080">(</font>drive <font color="#000080">: </font>char<font color="#000080">) : </font>boolean<font color="#000080">;
</font><font color="#FF0000"><b>Begin
   with </b></font>regs <font color="#FF0000"><b>do
     begin
       </b></font>ax <font color="#000080">:= </font><font color="#800000">$150b</font><font color="#000080">;
       </font>bx <font color="#000080">:= </font><font color="#800000">$0000</font><font color="#000080">;
       </font>cx <font color="#000080">:= </font>word<font color="#000080">(</font>ord<font color="#000080">(</font>drive<font color="#000080">)-</font><font color="#800000">65</font><font color="#000080">);
       </font>Intr<font color="#000080">(</font><font color="#800000">$2f</font><font color="#000080">,</font>regs<font color="#000080">);
    </font><font color="#008000"><i>(* If MSCDEX is loaded, bx will be $adad ! *)
       </i></font>IsCDRom <font color="#000080">:= (</font>ax <font color="#000080">&lt;&gt; </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>AND </b></font><font color="#000080">(</font>bx <font color="#000080">= </font><font color="#800000">$adad</font><font color="#000080">);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#008000"><i>(*-----------------------------------------------------*)
   (* Returns false if drive is local - untested !!! *)

</i></font><font color="#FF0000"><b>Function </b></font>DriveIsRemote<font color="#000080">(</font>drive <font color="#000080">: </font>char<font color="#000080">):</font>boolean<font color="#000080">;
</font><font color="#FF0000"><b>Begin
  with </b></font>regs <font color="#FF0000"><b>do
    begin
      </b></font>ah <font color="#000080">:= </font><font color="#800000">$44</font><font color="#000080">;
      </font>al <font color="#000080">:= </font><font color="#800000">$09</font><font color="#000080">;
      </font>bl <font color="#000080">:= </font>ord<font color="#000080">(</font>drive<font color="#000080">)-</font><font color="#800000">64</font><font color="#000080">;
      </font>Intr<font color="#000080">(</font><font color="#800000">$21</font><font color="#000080">,</font>regs<font color="#000080">);
      </font>DriveIsRemote <font color="#000080">:= ((</font>dx <font color="#FF0000"><b>AND </b></font><font color="#800000">$1000</font><font color="#000080">) &lt;&gt; </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>AND </b></font><font color="#000080">(</font>fCarry <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">);
 </font><font color="#008000"><i>(* Can further check if drive is substituted with
                  dx AND $8000 = $8000 if so *)
    </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#008000"><i>(*------------------------------------------------------*)
       (* Be sure that Drive is UPCASED !
    Returns FALSE on Anything that is NOT a HardDisk,
    including RamDisks, CdRom, etc.                    *)

</i></font><font color="#FF0000"><b>Function </b></font>IsHardDisk<font color="#000080">(</font>drive<font color="#000080">:</font>char<font color="#000080">):</font>boolean<font color="#000080">;
</font><font color="#FF0000"><b>Begin
  with </b></font>regs <font color="#FF0000"><b>DO
    begin
      </b></font>ah <font color="#000080">:= </font><font color="#800000">$44</font><font color="#000080">;
      </font>al <font color="#000080">:= </font><font color="#800000">$08</font><font color="#000080">;
      </font>bl <font color="#000080">:= </font>ord<font color="#000080">(</font>drive<font color="#000080">)-</font><font color="#800000">64</font><font color="#000080">;
      </font>Intr<font color="#000080">(</font><font color="#800000">$21</font><font color="#000080">, </font>regs<font color="#000080">);
      </font>IsHardDisk <font color="#000080">:= (</font>flags <font color="#FF0000"><b>AND </b></font>fCarry <font color="#000080">&lt;&gt; </font>fCarry<font color="#000080">)
           </font><font color="#FF0000"><b>AND </b></font><font color="#000080">(</font><font color="#FF0000"><b>NOT </b></font><font color="#000080">(</font>ax <font color="#FF0000"><b>in </b></font><font color="#000080">[</font><font color="#800000">$0</font><font color="#000080">,</font><font color="#800000">$0f</font><font color="#000080">]));
     </font><font color="#008000"><i>(* ax = $0 for removable, $0f on invalid drive spec ! *)
    </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#008000"><i>(*------------------------------------------------------------------*)
   (* CAUTION !!!!! THIS FUNCTION IS EXPERIMENTAL !!!!!!!!!  *)

 (* Be sure that drive is UPCASED ! - This function goes to DOS
    internal structures to get params for floppy type drives.
    (Including Bernoulli). Because it tells DOS to rebuild the
    BPB (Bios Parameter Block) for drives with removable media,
    the Media Descriptor byte will always return the boot
    paramaters for the drive, ie: a 1.44M floppy will always
    return 1.44M, regardless of the size disk that is currently
    actually in the drive !!

    A return of BootHrdDrive indicates ONLY that this is the
    HardDrive with the DOS boot partition on it. It DOES NOT
    indicate that the machine was booted from that drive !!!

    Dos version is MINIMUM of 3.1 !! - Check FIRST !!

    Because it does NOT read the drive, this puppy is FAST !!

    Returns these Constant types :
                    ERROR !       = $00;
                    TapeDrive     = $01
                    CdRom         = $02;
Check against this- Floppy        = $03; -to get All floppys !!
                    Floppy360     = $04;
                    Floppy720     = $05;
                    Floppy12      = $06;
                    Floppy14      = $07;
                    Floppy28      = $08;
                    Floptical     = $09;
                    Bernoulli     = $0a;
                          RamDrive      = $0b;
                    HardDrive     = $0c;
                    BootHrdDrive  = $0d;     *)

</i></font><font color="#FF0000"><b>Function </b></font>DriveType<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>f<font color="#000080">:</font>text<font color="#000080">;</font>drive<font color="#000080">:</font>char<font color="#000080">):</font>byte<font color="#000080">;
</font><font color="#FF0000"><b>Type
   </b></font>PtrDpbPtr <font color="#000080">= ^</font>DpbPtr<font color="#000080">;
   </font>DpbPtr    <font color="#000080">= ^</font>DPB<font color="#000080">;

   </font>DPB  <font color="#000080">=  </font><font color="#FF0000"><b>record           </b></font><font color="#008000"><i>(* Drive Parameter Block *)
     </i></font>DN   <font color="#000080">: </font>byte<font color="#000080">;      </font><font color="#008000"><i>(* 0=A etc Can compare this for Subst drive *)
     </i></font>DDU  <font color="#000080">: </font>byte<font color="#000080">;      </font><font color="#008000"><i>(* Device Driver Unit Number *)
     </i></font>BPS  <font color="#000080">: </font>word<font color="#000080">;      </font><font color="#008000"><i>(* Bytes Per Sector *)
     </i></font>SPC  <font color="#000080">: </font>byte<font color="#000080">;      </font><font color="#008000"><i>(* Sectors Per Cluster *)
     </i></font>CSC  <font color="#000080">: </font>byte<font color="#000080">;      </font><font color="#008000"><i>(* Cluster Shift Count *)
     </i></font>BS   <font color="#000080">: </font>word<font color="#000080">;      </font><font color="#008000"><i>(* Boot Sectors *)
     </i></font>Fats <font color="#000080">: </font>byte<font color="#000080">;      </font><font color="#008000"><i>(* Number of fats *)
     </i></font>RDE  <font color="#000080">: </font>word<font color="#000080">;      </font><font color="#008000"><i>(* Max Root Dir entries *)
     </i></font>FDS  <font color="#000080">: </font>word<font color="#000080">;      </font><font color="#008000"><i>(* First Data Sector *)
     </i></font>HPC  <font color="#000080">: </font>word<font color="#000080">;      </font><font color="#008000"><i>(* Highest Possible Cluster # *)
    (* Case Variant *)
     </i></font><font color="#FF0000"><b>Case </b></font>byte <font color="#FF0000"><b>of
        </b></font><font color="#008000"><i>(* DOS &lt; 4.0 OR OS2 *)
       </i></font><font color="#800000">0 </font><font color="#000080">: (</font>SpfOld   <font color="#000080">: </font>byte<font color="#000080">;   </font><font color="#008000"><i>(* Sectors per fat *)
            </i></font>JunkOld  <font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">16</font><font color="#000080">..</font><font color="#800000">22</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">;
            </font>MdaOld   <font color="#000080">: </font>byte<font color="#000080">;   </font><font color="#008000"><i>(* Media Descriptor byte *)
            </i></font>DummyOld <font color="#000080">: </font>byte<font color="#000080">;
            </font>NextOld  <font color="#000080">: </font>DpbPtr<font color="#000080">); </font><font color="#008000"><i>(* Pointer to next record *)
       (* DOS &gt;= 4.0 *)
       </i></font><font color="#800000">1 </font><font color="#000080">:(</font>SpfNew    <font color="#000080">: </font>word<font color="#000080">;
           </font>JunkNew   <font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">17</font><font color="#000080">..</font><font color="#800000">23</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">;
           </font>MdaNew    <font color="#000080">: </font>byte<font color="#000080">;
           </font>DummyNew  <font color="#000080">: </font>byte<font color="#000080">;
           </font>NextNew   <font color="#000080">: </font>DpbPtr<font color="#000080">);
       </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Var
  </b></font>dnum<font color="#000080">,</font>i<font color="#000080">,
  </font>num     <font color="#000080">: </font>byte<font color="#000080">;
  </font>CurrDpB <font color="#000080">: </font>DpbPtr<font color="#000080">;
  </font>MDA     <font color="#000080">: </font>byte<font color="#000080">;
  </font>SPF     <font color="#000080">: </font>word<font color="#000080">;
  </font>params  <font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">31</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">;
  </font>UseNew  <font color="#000080">: </font>boolean<font color="#000080">;

</font><font color="#FF0000"><b>Begin
  </b></font>DriveType <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;              </font><font color="#008000"><i>(* Assume failure *)
  </i></font>dnum <font color="#000080">:= </font>ord<font color="#000080">(</font>drive<font color="#000080">)-</font><font color="#800000">64</font><font color="#000080">;       </font><font color="#008000"><i>(* 'A'=1, 'B'=2 etc. *)
  </i></font><font color="#FF0000"><b>with </b></font>regs <font color="#FF0000"><b>do
    begin
      </b></font>ah <font color="#000080">:= </font><font color="#800000">$44</font><font color="#000080">;
      </font>al <font color="#000080">:= </font><font color="#800000">$08</font><font color="#000080">;
      </font>bl <font color="#000080">:= </font>dnum<font color="#000080">;
      </font>Intr<font color="#000080">(</font><font color="#800000">$21</font><font color="#000080">, </font>regs<font color="#000080">);
      </font><font color="#FF0000"><b>if </b></font>ax <font color="#000080">= </font><font color="#800000">$0f </font><font color="#FF0000"><b>then </b></font>exit<font color="#000080">;   </font><font color="#008000"><i>(* Invalid drive ! *)
 (* Here's where we try the undocumented return params ! *)
      </i></font>num <font color="#000080">:= (</font>ax<font color="#000080">+(</font>flags <font color="#FF0000"><b>AND </b></font>fCarry<font color="#000080">)+(</font>flags <font color="#FF0000"><b>AND </b></font>fParity<font color="#000080">));

   </font><font color="#008000"><i>{  if (ax = 0) then        - Diversion for test purposes !
        begin  }
          (* OS2 will return &gt; 10 *)
          </i></font>UseNew <font color="#000080">:= </font>Lo<font color="#000080">(</font>DosVersion<font color="#000080">) </font><font color="#FF0000"><b>in </b></font><font color="#000080">[</font><font color="#800000">4</font><font color="#000080">..</font><font color="#800000">9</font><font color="#000080">];

    </font><font color="#008000"><i>(* Get Ptr to List of Lists *)
          </i></font>ah <font color="#000080">:= </font><font color="#800000">$52</font><font color="#000080">;
          </font>es <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
          </font>bx <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
          </font>Intr<font color="#000080">(</font><font color="#800000">$21</font><font color="#000080">,</font>regs<font color="#000080">);
          </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>es <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>OR </b></font><font color="#000080">(</font>bx <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>then </b></font>exit<font color="#000080">;  </font><font color="#008000"><i>(* Error ! *)

       (* Pointer to list - 0h is pointer to 1st DPB *)
          </i></font>CurrDpb <font color="#000080">:= </font>PtrDpbPtr<font color="#000080">(</font>Ptr<font color="#000080">(</font>es<font color="#000080">,</font>bx<font color="#000080">))^;
    </font><font color="#008000"><i>(* Walk the chain of DPB's to our drive: 0='A' etc. *)
 (* Possible that drive is SUBSTed, so index from dnum instead of DN ! *)
    (* Don't index on 'A', cause it's already there ! *)
          </i></font><font color="#FF0000"><b>for </b></font>i <font color="#000080">:= </font><font color="#800000">2 </font><font color="#FF0000"><b>to </b></font>dnum <font color="#FF0000"><b>do
            begin
       </b></font><font color="#008000"><i>(* Offset set to $ffff on last in chain *)
              </i></font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>ofs<font color="#000080">(</font>CurrDpb<font color="#000080">^) &lt;&gt; </font><font color="#800000">$ffff</font><font color="#000080">) </font><font color="#FF0000"><b>then
                begin
                  if </b></font>UseNew <font color="#FF0000"><b>then </b></font>CurrDpb <font color="#000080">:= </font>CurrDpb<font color="#000080">^.</font>NextNew
                  <font color="#FF0000"><b>else </b></font>CurrDpb <font color="#000080">:= </font>CurrDpb<font color="#000080">^.</font>NextOld<font color="#000080">;
                </font><font color="#FF0000"><b>end
     </b></font><font color="#008000"><i>(* Hit end of chain before got to our drive ! *)
              </i></font><font color="#FF0000"><b>else </b></font>exit<font color="#000080">;
            </font><font color="#FF0000"><b>end</b></font><font color="#000080">;   </font><font color="#008000"><i>(* Of for *)

          </i></font><font color="#FF0000"><b>Case </b></font>UseNew <font color="#FF0000"><b>of
         </b></font><font color="#008000"><i>(* &gt;= DOS 4.0 and NOT OS2 *)
            </i></font>true  <font color="#000080">: </font><font color="#FF0000"><b>begin
                      </b></font>MDA <font color="#000080">:= </font>CurrDpb<font color="#000080">^.</font>MdaNew<font color="#000080">;
                      </font>SPF <font color="#000080">:= </font>CurrDpb<font color="#000080">^.</font>SpfNew<font color="#000080">;
                    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
          </font><font color="#008000"><i>(* &lt; DOS 4 or OS2 *)
            </i></font>false <font color="#000080">: </font><font color="#FF0000"><b>begin
                      </b></font>MDA <font color="#000080">:= </font>CurrDpb<font color="#000080">^.</font>MdaOld<font color="#000080">;
                      </font>SPF <font color="#000080">:= </font>CurrDpb<font color="#000080">^.</font>SpfOld<font color="#000080">;
                    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
            </font><font color="#FF0000"><b>end</b></font><font color="#000080">;   </font><font color="#008000"><i>(* Of case *)

       (* Write out buncha stuff for analysis *)
          </i></font>writeln<font color="#000080">(</font>f<font color="#000080">,</font><font color="#800000">'DN   is : '</font><font color="#000080">,</font>CurrDpb<font color="#000080">^.</font>DN<font color="#000080">);
          </font>writeln<font color="#000080">(</font>f<font color="#000080">,</font><font color="#800000">'DDU  is : '</font><font color="#000080">,</font>CurrDpb<font color="#000080">^.</font>DDU<font color="#000080">);
          </font>writeln<font color="#000080">(</font>f<font color="#000080">,</font><font color="#800000">'BPS  is : '</font><font color="#000080">,</font>CurrDpb<font color="#000080">^.</font>BPS<font color="#000080">);
          </font>writeln<font color="#000080">(</font>f<font color="#000080">,</font><font color="#800000">'SPC  is : '</font><font color="#000080">,</font>CurrDpb<font color="#000080">^.</font>SPC<font color="#000080">);
          </font>writeln<font color="#000080">(</font>f<font color="#000080">,</font><font color="#800000">'CSC  is : '</font><font color="#000080">,</font>CurrDpb<font color="#000080">^.</font>CSC<font color="#000080">);
          </font>writeln<font color="#000080">(</font>f<font color="#000080">,</font><font color="#800000">'BS   is : '</font><font color="#000080">,</font>CurrDpb<font color="#000080">^.</font>BS<font color="#000080">);
          </font>writeln<font color="#000080">(</font>f<font color="#000080">,</font><font color="#800000">'FATS is : '</font><font color="#000080">,</font>CurrDpb<font color="#000080">^.</font>Fats<font color="#000080">);
          </font>writeln<font color="#000080">(</font>f<font color="#000080">,</font><font color="#800000">'RDE  is : '</font><font color="#000080">,</font>CurrDpb<font color="#000080">^.</font>RDE<font color="#000080">);
          </font>writeln<font color="#000080">(</font>f<font color="#000080">,</font><font color="#800000">'FDS  is : '</font><font color="#000080">,</font>CurrDpb<font color="#000080">^.</font>FDS<font color="#000080">);
          </font>writeln<font color="#000080">(</font>f<font color="#000080">,</font><font color="#800000">'HPC  is : '</font><font color="#000080">,</font>CurrDpb<font color="#000080">^.</font>HPC<font color="#000080">);
          </font>writeln<font color="#000080">(</font>f<font color="#000080">,</font><font color="#800000">'SPF  is : '</font><font color="#000080">,</font>SPF<font color="#000080">);
          </font>writeln<font color="#000080">(</font>f<font color="#000080">,</font><font color="#800000">'MDA  is : '</font><font color="#000080">,</font>MDA<font color="#000080">);

    </font><font color="#008000"><i>(* This work on last of multiple Benoulli drives ???? *)
          </i></font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>SPF <font color="#000080">&gt; </font><font color="#800000">2</font><font color="#000080">) </font><font color="#FF0000"><b>AND </b></font><font color="#000080">(</font>MDA <font color="#000080">&gt;= </font><font color="#800000">$fc</font><font color="#000080">) </font><font color="#FF0000"><b>then
                  </b></font>DriveType <font color="#000080">:= </font>Bernoulli
          <font color="#FF0000"><b>else
          if </b></font>num <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>then
            begin
    </b></font><font color="#008000"><i>(* Tell DOS to build new BPB for removable types *)
              </i></font>fillchar<font color="#000080">(</font>params<font color="#000080">,</font>sizeof<font color="#000080">(</font>params<font color="#000080">),</font><font color="#800000">0</font><font color="#000080">);
              </font>params<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">] := </font><font color="#800000">4</font><font color="#000080">;   </font><font color="#008000"><i>(* Do NOT go to drive ! *)
              </i></font>ax <font color="#000080">:= </font><font color="#800000">$440d</font><font color="#000080">;
              </font>cx <font color="#000080">:= </font><font color="#800000">$0860</font><font color="#000080">;
              </font>bl <font color="#000080">:= </font>dnum<font color="#000080">;
              </font>dx <font color="#000080">:= </font>ofs<font color="#000080">(</font>params<font color="#000080">);
              </font>ds <font color="#000080">:= </font>seg<font color="#000080">(</font>params<font color="#000080">);
              </font>Intr<font color="#000080">(</font><font color="#800000">$21</font><font color="#000080">, </font>regs<font color="#000080">);
              </font><font color="#FF0000"><b>Case </b></font>params<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">] </font><font color="#FF0000"><b>of
                </b></font><font color="#800000">0  </font><font color="#000080">: </font>DriveType <font color="#000080">:= </font>Floppy360<font color="#000080">;
                </font><font color="#800000">1  </font><font color="#000080">: </font>DriveType <font color="#000080">:= </font>Floppy12<font color="#000080">;
                </font><font color="#800000">2  </font><font color="#000080">: </font>DriveType <font color="#000080">:= </font>Floppy720<font color="#000080">;
               </font><font color="#800000">3</font><font color="#000080">,</font><font color="#800000">4 </font><font color="#000080">: </font>DriveType <font color="#000080">:= </font>Floppy<font color="#000080">;
                </font><font color="#800000">6  </font><font color="#000080">: </font>DriveType <font color="#000080">:= </font>TapeDrive<font color="#000080">;
                </font><font color="#800000">7  </font><font color="#000080">: </font>DriveType <font color="#000080">:= </font>Floppy14<font color="#000080">;
                </font><font color="#800000">8  </font><font color="#000080">: </font>DriveType <font color="#000080">:= </font>Floptical<font color="#000080">;
                </font><font color="#800000">9  </font><font color="#000080">: </font>DriveType <font color="#000080">:= </font>Floppy28<font color="#000080">;
                </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
                  </font><font color="#FF0000"><b>begin
                    </b></font>writeln<font color="#000080">(</font>f<font color="#000080">,</font><font color="#800000">'Params[1] is : '</font><font color="#000080">,</font>byte<font color="#000080">(</font>params<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">]));
                    </font>writeln<font color="#000080">(</font>f<font color="#000080">,</font><font color="#800000">'BPS  is : '</font><font color="#000080">,</font>word<font color="#000080">(</font>params<font color="#000080">[</font><font color="#800000">7</font><font color="#000080">]));
                    </font>writeln<font color="#000080">(</font>f<font color="#000080">,</font><font color="#800000">'SPC  is : '</font><font color="#000080">,</font>byte<font color="#000080">(</font>params<font color="#000080">[</font><font color="#800000">9</font><font color="#000080">]));
                    </font>writeln<font color="#000080">(</font>f<font color="#000080">,</font><font color="#800000">'Fats is : '</font><font color="#000080">,</font>byte<font color="#000080">(</font>params<font color="#000080">[</font><font color="#800000">12</font><font color="#000080">]));
                    </font>writeln<font color="#000080">(</font>f<font color="#000080">,</font><font color="#800000">'RDE  is : '</font><font color="#000080">,</font>word<font color="#000080">(</font>params<font color="#000080">[</font><font color="#800000">13</font><font color="#000080">]));
                    </font>writeln<font color="#000080">(</font>f<font color="#000080">,</font><font color="#800000">'SPF  is : '</font><font color="#000080">,</font>word<font color="#000080">(</font>params<font color="#000080">[</font><font color="#800000">18</font><font color="#000080">]));
                    </font>writeln<font color="#000080">(</font>f<font color="#000080">,</font><font color="#800000">'MDA  is : '</font><font color="#000080">,</font>byte<font color="#000080">(</font>params<font color="#000080">[</font><font color="#800000">17</font><font color="#000080">]));
                  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
            </font><font color="#FF0000"><b>end     </b></font><font color="#008000"><i>(* Of Not Bernoulli *)
      { end}
      </i></font><font color="#FF0000"><b>else    </b></font><font color="#008000"><i>(* ax &gt; 0 ! *)
        </i></font><font color="#FF0000"><b>begin
          Case </b></font>num <font color="#FF0000"><b>of
            </b></font><font color="#800000">1 </font><font color="#000080">: </font>DriveType <font color="#000080">:= </font>HardDrive<font color="#000080">;
            </font><font color="#800000">5 </font><font color="#000080">: </font>DriveType <font color="#000080">:= </font>BootHrdDrive<font color="#000080">;
            </font><font color="#800000">6 </font><font color="#000080">: </font><font color="#FF0000"><b>begin
                  if </b></font>IsCdRom<font color="#000080">(</font>drive<font color="#000080">) </font><font color="#FF0000"><b>then
                     </b></font>DriveType <font color="#000080">:= </font>CDRom
                   <font color="#FF0000"><b>else </b></font>DriveType <font color="#000080">:= </font>RamDrive<font color="#000080">;
                </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
            </font><font color="#FF0000"><b>else </b></font>DriveType <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;            </font><font color="#008000"><i>(* Error ! *)
            </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;  </font><font color="#008000"><i>(* Of case *)
        </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;  </font><font color="#008000"><i>(* Not a floppy or bernoulli *)
    </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;   </font><font color="#008000"><i>(* With regs *)
</i></font><font color="#FF0000"><b>End</b></font><font color="#000080">;




</font><font color="#FF0000"><b>Begin      </b></font><font color="#008000"><i>(* TestDisk *)
  </i></font>GetDate<font color="#000080">(</font>y<font color="#000080">,</font>m<font color="#000080">,</font>d<font color="#000080">,</font>dow<font color="#000080">);
  </font><font color="#008000"><i>{$I-}
  </i></font>assign<font color="#000080">(</font>f<font color="#000080">,</font><font color="#800000">'TESTDISK.RPT'</font><font color="#000080">);
  </font>rewrite<font color="#000080">(</font>f<font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font>IoResult <font color="#000080">&lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then
    begin
      </b></font>write<font color="#000080">(^</font>G<font color="#000080">);
      </font>writeln<font color="#000080">(</font><font color="#800000">'Can''t open report file: aborting !'</font><font color="#000080">);
      </font>exit<font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>SetTextBuf<font color="#000080">(</font>f<font color="#000080">,</font>buff<font color="#000080">);
  </font>writeln<font color="#000080">(</font>f<font color="#000080">);
  </font>writeln<font color="#000080">(</font>f<font color="#000080">,</font><font color="#800000">'DOS Drive Detection Survey Report'</font><font color="#000080">);
  </font>writeln<font color="#000080">(</font>f<font color="#000080">);
  </font>writeln<font color="#000080">(</font>f<font color="#000080">,</font><font color="#800000">'Please mail to: CDC Micro'</font><font color="#000080">);
  </font>writeln<font color="#000080">(</font>f<font color="#000080">,</font><font color="#800000">'                PO Box 4457'</font><font color="#000080">);
  </font>writeln<font color="#000080">(</font>f<font color="#000080">,</font><font color="#800000">'                Seattle WA 98104'</font><font color="#000080">);
  </font>writeln<font color="#000080">(</font>f<font color="#000080">,</font><font color="#800000">'                (206) 435-1125'</font><font color="#000080">);
  </font>writeln<font color="#000080">(</font>f<font color="#000080">);
  </font>writeln<font color="#000080">(</font>f<font color="#000080">,</font><font color="#800000">'Thanks for taking the time to help with this survey !'</font><font color="#000080">);
  </font>writeln<font color="#000080">(</font>f<font color="#000080">);
  </font>writeln<font color="#000080">(</font>f<font color="#000080">,</font><font color="#800000">'Report dated : '</font><font color="#000080">,</font>m<font color="#000080">:</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">'/'</font><font color="#000080">,</font>d<font color="#000080">:</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">'/'</font><font color="#000080">,</font>y<font color="#000080">:</font><font color="#800000">0</font><font color="#000080">);
  </font>writeln<font color="#000080">(</font>f<font color="#000080">);
  </font>writeln<font color="#000080">(</font>f<font color="#000080">,</font><font color="#800000">'Report submitted by : _________________________________________________________'</font><font color="#000080">);
  </font>writeln<font color="#000080">(</font>f<font color="#000080">,</font><font color="#800000">'My address &amp; phone # is : _____________________________________________________'</font><font color="#000080">);
  </font>writeln<font color="#000080">(</font>f<font color="#000080">,</font><font color="#800000">'_______________________________________________________________________________'</font><font color="#000080">);
  </font>writeln<font color="#000080">(</font>f<font color="#000080">,</font><font color="#800000">'Test equipment is : ___________________________________________________________'</font><font color="#000080">);
  </font>writeln<font color="#000080">(</font>f<font color="#000080">,</font><font color="#800000">'_______________________________________________________________________________'</font><font color="#000080">);
  </font>writeln<font color="#000080">(</font>f<font color="#000080">,</font><font color="#800000">'For this test, my machine was booted from the: _______ drive.'</font><font color="#000080">);
  </font>writeln<font color="#000080">(</font>f<font color="#000080">,</font><font color="#800000">'For this test, I was running a RamDisk on Drive: ______,using _________________'</font><font color="#000080">);
  </font>writeln<font color="#000080">(</font>f<font color="#000080">,</font><font color="#800000">'For this test, I had a Bernoulli drive connected as Drive: ________ (Yes/No?)'</font><font color="#000080">);
  </font>writeln<font color="#000080">(</font>f<font color="#000080">,</font><font color="#800000">'For this test, I had a Tape/Optical drive connected as Drive: _______ (Yes/No?)'</font><font color="#000080">);
  </font>writeln<font color="#000080">(</font>f<font color="#000080">,</font><font color="#800000">'For this test, I was running Stacker/DoubleSpace/Other compressor. (Yes/No ?)'</font><font color="#000080">);
  </font>writeln<font color="#000080">(</font>f<font color="#000080">,</font><font color="#800000">'Test Conducted under : __________________________ operating/system/environment'</font><font color="#000080">);
  </font>writeln<font color="#000080">(</font>f<font color="#000080">,</font><font color="#800000">'Comments ? ____________________________________________________________________'</font><font color="#000080">);
  </font>writeln<font color="#000080">(</font>f<font color="#000080">);
  </font>version <font color="#000080">:= </font>DosVersion<font color="#000080">;
  </font>writeln<font color="#000080">(</font>f<font color="#000080">,</font><font color="#800000">'DOS Version: '</font><font color="#000080">,</font>version<font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>version <font color="#000080">&lt; </font><font color="#800000">310</font><font color="#000080">) </font><font color="#FF0000"><b>OR </b></font><font color="#000080">(</font><font color="#FF0000"><b>NOT </b></font>GetLastDrive<font color="#000080">(</font>lastdrive<font color="#000080">)) </font><font color="#FF0000"><b>then
  </b></font>writeln<font color="#000080">(</font>f<font color="#000080">,</font><font color="#800000">'Dos Version too low or lastdrive detection FAILED !!'</font><font color="#000080">)
  </font><font color="#FF0000"><b>else begin
  </b></font>writeln<font color="#000080">(</font>f<font color="#000080">,</font><font color="#800000">'LastDrive is: '</font><font color="#000080">,</font>lastdrive<font color="#000080">:</font><font color="#800000">0</font><font color="#000080">);
  </font>writeln<font color="#000080">(</font>f<font color="#000080">);
  </font><font color="#FF0000"><b>for </b></font>i <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>lastdrive <font color="#FF0000"><b>do with </b></font>regs <font color="#FF0000"><b>do
    begin
      </b></font>drive <font color="#000080">:= </font>char<font color="#000080">(</font>i<font color="#000080">+</font><font color="#800000">64</font><font color="#000080">);
       </font><font color="#FF0000"><b>if </b></font>DriveValid<font color="#000080">(</font>drive<font color="#000080">) </font><font color="#FF0000"><b>then
         begin
          </b></font>IsHardDisk<font color="#000080">(</font>drive<font color="#000080">);
          </font>Dtype <font color="#000080">:= </font>ax<font color="#000080">+(</font>flags <font color="#FF0000"><b>AND </b></font>fCarry<font color="#000080">)+(</font>flags <font color="#FF0000"><b>AND </b></font>fParity<font color="#000080">);
          </font>bits <font color="#000080">:= </font>BinStr<font color="#000080">(</font>flags<font color="#000080">,</font><font color="#800000">16</font><font color="#000080">);
          </font>writeln<font color="#000080">(</font>f<font color="#000080">,</font><font color="#800000">'Drive '</font><font color="#000080">+</font>Drive<font color="#000080">+</font><font color="#800000">':          Value of AX is: '</font><font color="#000080">,</font>ax<font color="#000080">);
          </font>writeln<font color="#000080">(</font><font color="#800000">'Drive '</font><font color="#000080">+</font>Drive<font color="#000080">+</font><font color="#800000">':          Value of AX is: '</font><font color="#000080">,</font>ax<font color="#000080">);
          </font>writeln<font color="#000080">(</font>f<font color="#000080">,</font><font color="#800000">'Drive '</font><font color="#000080">+</font>Drive<font color="#000080">+</font><font color="#800000">':       Value of flags is: '</font><font color="#000080">,</font>flags<font color="#000080">);
          </font>writeln<font color="#000080">(</font><font color="#800000">'Drive '</font><font color="#000080">+</font>Drive<font color="#000080">+</font><font color="#800000">':       Value of flags is: '</font><font color="#000080">,</font>flags<font color="#000080">);
          </font>writeln<font color="#000080">(</font>f<font color="#000080">,</font><font color="#800000">'Drive '</font><font color="#000080">+</font>Drive<font color="#000080">+</font><font color="#800000">':          Flags bits are: '</font><font color="#000080">+</font>bits<font color="#000080">);
          </font>writeln<font color="#000080">(</font><font color="#800000">'Drive '</font><font color="#000080">+</font>Drive<font color="#000080">+</font><font color="#800000">':          Flags bits are: '</font><font color="#000080">+</font>bits<font color="#000080">);
          </font>writeln<font color="#000080">(</font>f<font color="#000080">,</font><font color="#800000">'Drive '</font><font color="#000080">+</font>Drive<font color="#000080">+</font><font color="#800000">':      AX+carry+parity is: '</font><font color="#000080">,</font>ax<font color="#000080">+(</font>flags <font color="#FF0000"><b>AND </b></font>fCarry<font color="#000080">)+(</font>flags <font color="#FF0000"><b>AND </b></font>fParity<font color="#000080">));
          </font>writeln<font color="#000080">(</font><font color="#800000">'Drive '</font><font color="#000080">+</font>Drive<font color="#000080">+</font><font color="#800000">':      AX+carry+parity is: '</font><font color="#000080">,</font>Dtype<font color="#000080">);

          </font>writeln<font color="#000080">(</font>f<font color="#000080">,</font><font color="#800000">'Drive '</font><font color="#000080">+</font>Drive<font color="#000080">+</font><font color="#800000">':     flags AND fCarry is: '</font><font color="#000080">,</font>flags <font color="#FF0000"><b>AND </b></font>fCarry<font color="#000080">,</font><font color="#800000">' '</font><font color="#000080">,</font>flags <font color="#FF0000"><b>AND </b></font>fCarry <font color="#000080">= </font>fCarry<font color="#000080">);
          </font>writeln<font color="#000080">(</font><font color="#800000">'Drive '</font><font color="#000080">+</font>Drive<font color="#000080">+</font><font color="#800000">':     flags AND fCarry is: '</font><font color="#000080">,</font>flags <font color="#FF0000"><b>AND </b></font>fCarry<font color="#000080">,</font><font color="#800000">' '</font><font color="#000080">,</font>flags <font color="#FF0000"><b>AND </b></font>fCarry <font color="#000080">= </font>fCarry<font color="#000080">);
          </font>writeln<font color="#000080">(</font>f<font color="#000080">,</font><font color="#800000">'Drive '</font><font color="#000080">+</font>Drive<font color="#000080">+</font><font color="#800000">':    flags AND fParity is: '</font><font color="#000080">,</font>flags <font color="#FF0000"><b>AND </b></font>fParity<font color="#000080">,</font><font color="#800000">' '</font><font color="#000080">,</font>flags <font color="#FF0000"><b>AND </b></font>fParity <font color="#000080">= </font>fParity<font color="#000080">);
          </font>writeln<font color="#000080">(</font><font color="#800000">'Drive '</font><font color="#000080">+</font>Drive<font color="#000080">+</font><font color="#800000">':    flags AND fParity is: '</font><font color="#000080">,</font>flags <font color="#FF0000"><b>AND </b></font>fParity<font color="#000080">,</font><font color="#800000">' '</font><font color="#000080">,</font>flags <font color="#FF0000"><b>AND </b></font>fParity <font color="#000080">= </font>fParity<font color="#000080">);
          </font>writeln<font color="#000080">(</font>f<font color="#000080">,</font><font color="#800000">'Drive '</font><font color="#000080">+</font>Drive<font color="#000080">+</font><font color="#800000">': flags AND fAuxiliary is: '</font><font color="#000080">,</font>flags <font color="#FF0000"><b>AND </b></font>fAuxiliary<font color="#000080">,</font><font color="#800000">' '</font><font color="#000080">,</font>flags <font color="#FF0000"><b>AND </b></font>fAuxiliary <font color="#000080">= </font>fAuxiliary<font color="#000080">);
          </font>writeln<font color="#000080">(</font><font color="#800000">'Drive '</font><font color="#000080">+</font>Drive<font color="#000080">+</font><font color="#800000">': flags AND fAuxiliary is: '</font><font color="#000080">,</font>flags <font color="#FF0000"><b>AND </b></font>fAuxiliary<font color="#000080">,</font><font color="#800000">' '</font><font color="#000080">,</font>flags <font color="#FF0000"><b>AND </b></font>fAuxiliary <font color="#000080">= </font>fAuxiliary<font color="#000080">);
          </font>writeln<font color="#000080">(</font>f<font color="#000080">,</font><font color="#800000">'Drive '</font><font color="#000080">+</font>Drive<font color="#000080">+</font><font color="#800000">':      flags AND fZero is: '</font><font color="#000080">,</font>flags <font color="#FF0000"><b>AND </b></font>fZero<font color="#000080">,</font><font color="#800000">' '</font><font color="#000080">,</font>flags <font color="#FF0000"><b>AND </b></font>fZero <font color="#000080">= </font>fZero<font color="#000080">);
          </font>writeln<font color="#000080">(</font><font color="#800000">'Drive '</font><font color="#000080">+</font>Drive<font color="#000080">+</font><font color="#800000">':      flags AND fZero is: '</font><font color="#000080">,</font>flags <font color="#FF0000"><b>AND </b></font>fZero<font color="#000080">,</font><font color="#800000">' '</font><font color="#000080">,</font>flags <font color="#FF0000"><b>AND </b></font>fZero <font color="#000080">= </font>fZero<font color="#000080">);
          </font>writeln<font color="#000080">(</font>f<font color="#000080">,</font><font color="#800000">'Drive '</font><font color="#000080">+</font>Drive<font color="#000080">+</font><font color="#800000">':      flags AND fSign is: '</font><font color="#000080">,</font>flags <font color="#FF0000"><b>AND </b></font>fSign<font color="#000080">,</font><font color="#800000">' '</font><font color="#000080">,</font>flags <font color="#FF0000"><b>AND </b></font>fSign <font color="#000080">= </font>fSign<font color="#000080">);
          </font>writeln<font color="#000080">(</font><font color="#800000">'Drive '</font><font color="#000080">+</font>Drive<font color="#000080">+</font><font color="#800000">':      flags AND fSign is: '</font><font color="#000080">,</font>flags <font color="#FF0000"><b>AND </b></font>fSign<font color="#000080">,</font><font color="#800000">' '</font><font color="#000080">,</font>flags <font color="#FF0000"><b>AND </b></font>fSign <font color="#000080">= </font>fSign<font color="#000080">);
          </font>writeln<font color="#000080">(</font>f<font color="#000080">,</font><font color="#800000">'Drive '</font><font color="#000080">+</font>Drive<font color="#000080">+</font><font color="#800000">':  flags AND fOverFlow is: '</font><font color="#000080">,</font>flags <font color="#FF0000"><b>AND </b></font>fOverflow<font color="#000080">,</font><font color="#800000">' '</font><font color="#000080">,</font>flags <font color="#FF0000"><b>AND </b></font>fOverFlow <font color="#000080">= </font>fOverFlow<font color="#000080">);
          </font>writeln<font color="#000080">(</font><font color="#800000">'Drive '</font><font color="#000080">+</font>Drive<font color="#000080">+</font><font color="#800000">':  flags AND fOverFlow is: '</font><font color="#000080">,</font>flags <font color="#FF0000"><b>AND </b></font>fOverflow<font color="#000080">,</font><font color="#800000">' '</font><font color="#000080">,</font>flags <font color="#FF0000"><b>AND </b></font>fOverFlow <font color="#000080">= </font>fOverFlow<font color="#000080">);

          </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>Dtype <font color="#000080">&gt; </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>then if </b></font>DriveIsRemote<font color="#000080">(</font>Drive<font color="#000080">)
                </font><font color="#FF0000"><b>then </b></font>writeln<font color="#000080">(</font>f<font color="#000080">,</font><font color="#800000">'  ***** This drive is remote (network) or Substituted ?  Yes/No/Which  *****'</font><font color="#000080">);

          </font>writeln<font color="#000080">(</font>f<font color="#000080">,</font><font color="#800000">'       *****  This is a '</font><font color="#000080">+</font>DriveTypes<font color="#000080">[</font>DriveType<font color="#000080">(</font>f<font color="#000080">,</font>Drive<font color="#000080">)]+</font><font color="#800000">' ?  Yes/No  *****'</font><font color="#000080">);
          </font>writeln<font color="#000080">(</font>f<font color="#000080">);
          </font>writeln<font color="#000080">;
        </font><font color="#FF0000"><b>end</b></font><font color="#000080">;    </font><font color="#008000"><i>(* Drive is valid *)
    </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;     </font><font color="#008000"><i>(* For loop *)
  </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;   </font><font color="#008000"><i>(* Lastdrive detection *)
  </i></font>writeln<font color="#000080">(</font>f<font color="#000080">,</font><font color="#800000">'End of Report... and Thanks for running this test !'</font><font color="#000080">);
  </font>close<font color="#000080">(</font>f<font color="#000080">); </font><font color="#008000"><i>{$I+}
  </i></font><font color="#FF0000"><b>if </b></font>IoResult <font color="#000080">&lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then</b></font><font color="#000080">;

  </font>writeln<font color="#000080">(</font><font color="#800000">'Please print out and mail in the TESTDISK.RPT file.'</font><font color="#000080">);
  </font>writeln<font color="#000080">(</font><font color="#800000">'You''ll find it in this sub-directory.'</font><font color="#000080">);
  </font>writeln<font color="#000080">(</font><font color="#800000">'Thanks for running this test !'</font><font color="#000080">);
</font><font color="#FF0000"><b>End</b></font><font color="#000080">.</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to DRIVES SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0072.PAS">Original</a><b>]</b></p></body>
</html>
