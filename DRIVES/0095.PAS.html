<html>
<head><title> "Re: IDE HDD Parameters?" by IVAN HAMILTON</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to DRIVES SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0095.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{

 The code below identifies some of the IDE params. Actually, it identifies
 most of what you'd ever need.
 Theres only one catch. The main program checks the letter given on the
 command line using a function:
 DriveValid(Drive: Char; var Drv: Byte): Boolean; assembler;
 This returns the numeric equivalent of the Drive character into Drv and
 returns true/false if the Drive is Valid. The trick is the validity check
 is done by DOS. Meaning that on my machine, my second drive, a HPFS drive
 won't show up unless I stick something like Drive=3 (Second HDD) and
 disable the DriveValid check. I hope this helps.

}

(*******************************************************************
    idediag
    shows characteristics of IDE hard disks.
    Public Domain by Paolo Bevilacqua, Rome.
    Rewritten from C to Turbo Pascal 7.0 by Ivan Peev, Sofia.
    You can add more disk type to the idetypes[]
    table, and distribuite freely.
********************************************************************)

</i></font><font color="#FF0000"><b>const
</b></font><font color="#008000"><i>{ read/write }
   </i></font>HDC_DATA    <font color="#000080">= </font><font color="#800000">$01F0</font><font color="#000080">;
   </font>HDC_ERROR   <font color="#000080">= </font><font color="#800000">$01F1</font><font color="#000080">;
   </font>HDC_SECCOU  <font color="#000080">= </font><font color="#800000">$01F2</font><font color="#000080">;
   </font>HDC_SECNUM  <font color="#000080">= </font><font color="#800000">$01F3</font><font color="#000080">;
   </font>HDC_CYLLOW  <font color="#000080">= </font><font color="#800000">$01F4</font><font color="#000080">;
   </font>HDC_CYLHIGH <font color="#000080">= </font><font color="#800000">$01F5</font><font color="#000080">;
   </font>HDC_SDH     <font color="#000080">= </font><font color="#800000">$01F6</font><font color="#000080">;

</font><font color="#008000"><i>{ read }
   </i></font>HDC_STATUS  <font color="#000080">: </font>Word <font color="#000080">= </font><font color="#800000">$01F7</font><font color="#000080">;
   </font>HDC_ALTSTA  <font color="#000080">= </font><font color="#800000">$03F6</font><font color="#000080">;

</font><font color="#008000"><i>{ write }
   </i></font>HDC_COMMAND <font color="#000080">= </font><font color="#800000">$01F7</font><font color="#000080">;
   </font>HDC_FIXED   <font color="#000080">= </font><font color="#800000">$03F6</font><font color="#000080">;

</font><font color="#008000"><i>{ commands }
   </i></font>HDC_COMMAND_RESTORE <font color="#000080">= </font><font color="#800000">$10</font><font color="#000080">;
   </font>HDC_COMMAND_SEEK    <font color="#000080">= </font><font color="#800000">$70</font><font color="#000080">;
   </font>HDC_COMMAND_READ    <font color="#000080">= </font><font color="#800000">$20</font><font color="#000080">;
   </font>HDC_COMMAND_WRITE   <font color="#000080">= </font><font color="#800000">$30</font><font color="#000080">;
   </font>HDC_COMMAND_FORMAT  <font color="#000080">= </font><font color="#800000">$50</font><font color="#000080">;
   </font>HDC_COMMAND_READVER <font color="#000080">= </font><font color="#800000">$90</font><font color="#000080">;
   </font>HDC_COMMAND_DIAG    <font color="#000080">= </font><font color="#800000">$90</font><font color="#000080">;
   </font>HDC_COMMAND_SETPAR  <font color="#000080">= </font><font color="#800000">$91</font><font color="#000080">;
   </font>HDC_COMMAND_WRSTACK <font color="#000080">= </font><font color="#800000">$E8</font><font color="#000080">;
   </font>HDC_COMMAND_RDSTACK <font color="#000080">= </font><font color="#800000">$E4</font><font color="#000080">;
   </font>HDC_COMMAND_READPAR <font color="#000080">= </font><font color="#800000">$EC</font><font color="#000080">;
   </font>HDC_COMMAND_POWER   <font color="#000080">= </font><font color="#800000">$E0</font><font color="#000080">;

   </font>HDC_FIXED_IRQ       <font color="#000080">= </font><font color="#800000">$02</font><font color="#000080">;
   </font>HDC_FIXED_RESET     <font color="#000080">= </font><font color="#800000">$04</font><font color="#000080">;

   </font>HDC_STATUS_ERROR    <font color="#000080">= </font><font color="#800000">$01</font><font color="#000080">;
   </font>HDC_STATUS_INDEX    <font color="#000080">= </font><font color="#800000">$02</font><font color="#000080">;
   </font>HDC_STATUS_ECC      <font color="#000080">= </font><font color="#800000">$04</font><font color="#000080">;
   </font>HDC_STATUS_DRQ      <font color="#000080">= </font><font color="#800000">$08</font><font color="#000080">;
   </font>HDC_STATUS_COMPLETE <font color="#000080">= </font><font color="#800000">$10</font><font color="#000080">;
   </font>HDC_STATUS_WRFAULT  <font color="#000080">= </font><font color="#800000">$20</font><font color="#000080">;
   </font>HDC_STATUS_READY    <font color="#000080">= </font><font color="#800000">$40</font><font color="#000080">;
   </font>HDC_STATUS_BUSY     <font color="#000080">= </font><font color="#800000">$80</font><font color="#000080">;

</font><font color="#FF0000"><b>type
   </b></font>TIdeTypes <font color="#000080">= </font><font color="#FF0000"><b>record
      </b></font>Cylinders<font color="#000080">,
      </font>Heads<font color="#000080">,
      </font>Sectors<font color="#000080">: </font>Word<font color="#000080">;
      </font>Name<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">[</font><font color="#800000">38</font><font color="#000080">];
   </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

   </font>PIdeInfo <font color="#000080">= ^</font>TIdeInfo<font color="#000080">;
   </font>TIdeInfo <font color="#000080">= </font><font color="#FF0000"><b>record
      </b></font>genconf<font color="#000080">,
      </font>fixcyls<font color="#000080">,
      </font>remcyls<font color="#000080">,
      </font>heads<font color="#000080">,
      </font>bytetrack<font color="#000080">,                     </font><font color="#008000"><i>{ bytes per track }
      </i></font>bytesector<font color="#000080">,                    </font><font color="#008000"><i>{ bytes per sector }
      </i></font>sectors<font color="#000080">,                             </font><font color="#008000"><i>{ sectors per track }
      </i></font>byteisg<font color="#000080">,                             </font><font color="#008000"><i>{ bytes intesector gap }
      </i></font>byteplo<font color="#000080">,                             </font><font color="#008000"><i>{ bytes in sync }
      </i></font>worduniq<font color="#000080">: </font>Word<font color="#000080">;                </font><font color="#008000"><i>{ words unique status }
      </i></font>serial<font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">20</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Char<font color="#000080">;
      </font>contype<font color="#000080">,                       </font><font color="#008000"><i>{ controller type }
      </i></font>bufsiz<font color="#000080">,                             </font><font color="#008000"><i>{ buffer size in 512 byte blocks }
      </i></font>byteecc<font color="#000080">: </font>Word<font color="#000080">;                     </font><font color="#008000"><i>{ ECC bytes trasferred in read/write long }
      </i></font>firmware<font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">8</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Char<font color="#000080">; </font><font color="#008000"><i>{ firmware revision }
      </i></font>model<font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">40</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Char<font color="#000080">;   </font><font color="#008000"><i>{ model ID }
      </i></font>secsint<font color="#000080">,                             </font><font color="#008000"><i>{ number of sectors transferred per
interrupt }      </i></font>dblword<font color="#000080">,                             </font><font color="#008000"><i>{ double word transfer flag }
      </i></font>writepro<font color="#000080">: </font>Word<font color="#000080">;                </font><font color="#008000"><i>{ write protect }
   </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>const
   </b></font>IdesInDataBase <font color="#000080">= </font><font color="#800000">17</font><font color="#000080">;

   </font>IdeTypes<font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font>IdesInDataBase<font color="#000080">] </font><font color="#FF0000"><b>of </b></font>TIdeTypes <font color="#000080">=
   ((</font>Cylinders<font color="#000080">:</font><font color="#800000">667</font><font color="#000080">;  </font>Heads<font color="#000080">:</font><font color="#800000">4</font><font color="#000080">;  </font>Sectors<font color="#000080">:</font><font color="#800000">33</font><font color="#000080">; </font>Name<font color="#000080">:</font><font color="#800000">'Fujitsu M2611T (42.9 MB)'</font><font color="#000080">),
    (</font>Cylinders<font color="#000080">:</font><font color="#800000">667</font><font color="#000080">;  </font>Heads<font color="#000080">:</font><font color="#800000">8</font><font color="#000080">;  </font>Sectors<font color="#000080">:</font><font color="#800000">33</font><font color="#000080">; </font>Name<font color="#000080">:</font><font color="#800000">'Fujitsu M2612T (85.9 MB)'</font><font color="#000080">),
    (</font>Cylinders<font color="#000080">:</font><font color="#800000">667</font><font color="#000080">;  </font>Heads<font color="#000080">:</font><font color="#800000">12</font><font color="#000080">; </font>Sectors<font color="#000080">:</font><font color="#800000">33</font><font color="#000080">; </font>Name<font color="#000080">:</font><font color="#800000">'Fujitsu M2613T (128.9 MB)'</font><font color="#000080">),
    (</font>Cylinders<font color="#000080">:</font><font color="#800000">667</font><font color="#000080">;  </font>Heads<font color="#000080">:</font><font color="#800000">16</font><font color="#000080">; </font>Sectors<font color="#000080">:</font><font color="#800000">33</font><font color="#000080">; </font>Name<font color="#000080">:</font><font color="#800000">'Fujitsu M2614T (171.9 MB)'</font><font color="#000080">),
    (</font>Cylinders<font color="#000080">:</font><font color="#800000">782</font><font color="#000080">;  </font>Heads<font color="#000080">:</font><font color="#800000">2</font><font color="#000080">;  </font>Sectors<font color="#000080">:</font><font color="#800000">27</font><font color="#000080">; </font>Name<font color="#000080">:</font><font color="#800000">'Western Digital WD93024-A (20.6 MB)'</font><font color="#000080">),
    (</font>Cylinders<font color="#000080">:</font><font color="#800000">782</font><font color="#000080">;  </font>Heads<font color="#000080">:</font><font color="#800000">4</font><font color="#000080">;  </font>Sectors<font color="#000080">:</font><font color="#800000">27</font><font color="#000080">; </font>Name<font color="#000080">:</font><font color="#800000">'Western Digital WD93044-A (41.2 MB)'</font><font color="#000080">),
    (</font>Cylinders<font color="#000080">:</font><font color="#800000">845</font><font color="#000080">;  </font>Heads<font color="#000080">:</font><font color="#800000">3</font><font color="#000080">;  </font>Sectors<font color="#000080">:</font><font color="#800000">35</font><font color="#000080">; </font>Name<font color="#000080">:</font><font color="#800000">'Toshiba MK232FC (45.4 MB'</font><font color="#000080">),
    (</font>Cylinders<font color="#000080">:</font><font color="#800000">845</font><font color="#000080">;  </font>Heads<font color="#000080">:</font><font color="#800000">7</font><font color="#000080">;  </font>Sectors<font color="#000080">:</font><font color="#800000">35</font><font color="#000080">; </font>Name<font color="#000080">:</font><font color="#800000">'Toshiba MK234FC (106 MB'</font><font color="#000080">),
    (</font>Cylinders<font color="#000080">:</font><font color="#800000">965</font><font color="#000080">;  </font>Heads<font color="#000080">:</font><font color="#800000">5</font><font color="#000080">;  </font>Sectors<font color="#000080">:</font><font color="#800000">17</font><font color="#000080">; </font>Name<font color="#000080">:</font><font color="#800000">'Quantum ProDrive 40AT (40 MB)'</font><font color="#000080">),
    (</font>Cylinders<font color="#000080">:</font><font color="#800000">965</font><font color="#000080">;  </font>Heads<font color="#000080">:</font><font color="#800000">10</font><font color="#000080">; </font>Sectors<font color="#000080">:</font><font color="#800000">17</font><font color="#000080">; </font>Name<font color="#000080">:</font><font color="#800000">'Quantum ProDrive 80AT (80 MB)'</font><font color="#000080">),
    (</font>Cylinders<font color="#000080">:</font><font color="#800000">1050</font><font color="#000080">; </font>Heads<font color="#000080">:</font><font color="#800000">2</font><font color="#000080">;  </font>Sectors<font color="#000080">:</font><font color="#800000">40</font><font color="#000080">; </font>Name<font color="#000080">:</font><font color="#800000">'Teac SD-340 (41 MB)'</font><font color="#000080">),
    (</font>Cylinders<font color="#000080">:</font><font color="#800000">776</font><font color="#000080">;  </font>Heads<font color="#000080">:</font><font color="#800000">8</font><font color="#000080">;  </font>Sectors<font color="#000080">:</font><font color="#800000">33</font><font color="#000080">; </font>Name<font color="#000080">:</font><font color="#800000">'Conner CP-3104 (100 MB)'</font><font color="#000080">),
    (</font>Cylinders<font color="#000080">:</font><font color="#800000">745</font><font color="#000080">;  </font>Heads<font color="#000080">:</font><font color="#800000">4</font><font color="#000080">;  </font>Sectors<font color="#000080">:</font><font color="#800000">28</font><font color="#000080">; </font>Name<font color="#000080">:</font><font color="#800000">'Priam 3804M (40.7 MB)'</font><font color="#000080">),
    (</font>Cylinders<font color="#000080">:</font><font color="#800000">980</font><font color="#000080">;  </font>Heads<font color="#000080">:</font><font color="#800000">10</font><font color="#000080">; </font>Sectors<font color="#000080">:</font><font color="#800000">17</font><font color="#000080">; </font>Name<font color="#000080">:</font><font color="#800000">'Western Digitial Caviar AC280 (81 MB)'</font><font color="#000080">),
    (</font>Cylinders<font color="#000080">:</font><font color="#800000">560</font><font color="#000080">;  </font>Heads<font color="#000080">:</font><font color="#800000">6</font><font color="#000080">;  </font>Sectors<font color="#000080">:</font><font color="#800000">26</font><font color="#000080">; </font>Name<font color="#000080">:</font><font color="#800000">'Seagate ST157A (42 MB)'</font><font color="#000080">),
    (</font>Cylinders<font color="#000080">:</font><font color="#800000">732</font><font color="#000080">;  </font>Heads<font color="#000080">:</font><font color="#800000">8</font><font color="#000080">;  </font>Sectors<font color="#000080">:</font><font color="#800000">35</font><font color="#000080">; </font>Name<font color="#000080">:</font><font color="#800000">'ALPS ELECTRIC Co.,LTD. DR311C (102 MB)'</font><font color="#000080">),
    (</font>Cylinders<font color="#000080">:</font><font color="#800000">0</font><font color="#000080">;    </font>Heads<font color="#000080">:</font><font color="#800000">0</font><font color="#000080">;  </font>Sectors<font color="#000080">:</font><font color="#800000">0</font><font color="#000080">;  </font>Name<font color="#000080">:</font><font color="#800000">''</font><font color="#000080">));

</font><font color="#FF0000"><b>type
   </b></font>parray <font color="#000080">= ^</font>tarray<font color="#000080">;
   </font>tarray <font color="#000080">= </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">256</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Word<font color="#000080">;

</font><font color="#FF0000"><b>var
   </b></font>secbuf<font color="#000080">: </font>parray<font color="#000080">;
   </font>drive<font color="#000080">: </font>Byte<font color="#000080">;
   </font>drv<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">];

</font><font color="#FF0000"><b>procedure </b></font>printinfo<font color="#000080">;

</font><font color="#FF0000"><b>var
   </b></font>id<font color="#000080">: </font>TIdeInfo<font color="#000080">;
   </font>capacity<font color="#000080">: </font>Word<font color="#000080">;
   </font>types<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
   </font>i<font color="#000080">: </font>Integer<font color="#000080">;

   </font><font color="#FF0000"><b>function </b></font>zo<font color="#000080">(</font><font color="#FF0000"><b>const </b></font>value<font color="#000080">: </font>Byte<font color="#000080">): </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
   </font><font color="#FF0000"><b>begin
      if </b></font>Boolean<font color="#000080">(</font>value<font color="#000080">) </font><font color="#FF0000"><b>then
         </b></font>zo <font color="#000080">:= </font><font color="#800000">''
      </font><font color="#FF0000"><b>else
         </b></font>zo <font color="#000080">:= </font><font color="#800000">'not'</font><font color="#000080">;
   </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

   </font><font color="#FF0000"><b>function </b></font>ToStr<font color="#000080">(</font>value<font color="#000080">: </font>LongInt<font color="#000080">): </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
   </font><font color="#FF0000"><b>var
      </b></font>S<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
   </font><font color="#FF0000"><b>begin
      </b></font>Str<font color="#000080">(</font>value<font color="#000080">, </font>S<font color="#000080">);
      </font>ToStr <font color="#000080">:= </font>S<font color="#000080">;
   </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

   </font><font color="#FF0000"><b>function </b></font>ConvertHex<font color="#000080">(</font>Value<font color="#000080">: </font>Word<font color="#000080">): </font><font color="#FF0000"><b>String</b></font><font color="#000080">;

   </font><font color="#FF0000"><b>const
      </b></font>hexTable<font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">15</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Char <font color="#000080">= </font><font color="#800000">'0123456789ABCDEF'</font><font color="#000080">;

   </font><font color="#FF0000"><b>begin
      </b></font>ConvertHex <font color="#000080">:= </font>hexTable<font color="#000080">[</font>Hi<font color="#000080">(</font>Value<font color="#000080">) </font><font color="#FF0000"><b>shr </b></font><font color="#800000">4</font><font color="#000080">] + </font>hexTable<font color="#000080">[</font>Hi<font color="#000080">(</font>Value<font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#800000">$f</font><font color="#000080">] +
                    </font>hexTable<font color="#000080">[</font>Lo<font color="#000080">(</font>Value<font color="#000080">) </font><font color="#FF0000"><b>shr </b></font><font color="#800000">4</font><font color="#000080">] + </font>hexTable<font color="#000080">[</font>Lo<font color="#000080">(</font>Value<font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#800000">$f</font><font color="#000080">];
   </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

   </font><font color="#FF0000"><b>procedure </b></font>SwapBytes<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>Source<font color="#000080">, </font>Dest<font color="#000080">; </font>Len<font color="#000080">: </font>Byte<font color="#000080">); </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
   </font><font color="#FF0000"><b>asm
       </b></font><font color="#FF00FF">push  ds

       lds   si, Source
       les   di, Dest
       mov   cl, len
       xor   ch, ch

   @1: mov   ax, ds:[si]
       xchg  ah, al
       mov   es:[di], ax
       inc   si
       inc   si
       inc   di
       inc   di
       loop  @1

       pop    ds
   </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>begin
   </b></font>id <font color="#000080">:= </font>PIdeInfo<font color="#000080">(</font>secbuf<font color="#000080">)^;

   </font><font color="#008000"><i>{ get disk type by characteristics }
   </i></font>i <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;
   </font><font color="#FF0000"><b>while </b></font>IdeTypes<font color="#000080">[</font>i<font color="#000080">].</font>Cylinders <font color="#000080">&lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>do
      Begin
         if </b></font><font color="#000080">(</font>IdeTypes<font color="#000080">[</font>i<font color="#000080">].</font>cylinders <font color="#000080">= </font>id<font color="#000080">.</font>fixcyls<font color="#000080">) </font><font color="#FF0000"><b>and
            </b></font><font color="#000080">(</font>IdeTypes<font color="#000080">[</font>i<font color="#000080">].</font>heads <font color="#000080">= </font>id<font color="#000080">.</font>heads<font color="#000080">) </font><font color="#FF0000"><b>and
            </b></font><font color="#000080">(</font>IdeTypes<font color="#000080">[</font>i<font color="#000080">].</font>sectors <font color="#000080">= </font>id<font color="#000080">.</font>sectors<font color="#000080">) </font><font color="#FF0000"><b>then
            Begin
               </b></font>types <font color="#000080">:= </font>IdeTypes<font color="#000080">[</font>i<font color="#000080">].</font>name<font color="#000080">;
               </font>break<font color="#000080">;
            </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
         </font>inc<font color="#000080">(</font>i<font color="#000080">);
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

   </font><font color="#008000"><i>{ unknown disk }
   </i></font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>IdeTypes<font color="#000080">[</font>i<font color="#000080">].</font>cylinders <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>then
      Begin
         </b></font>types <font color="#000080">:= </font><font color="#800000">'Unknown '</font><font color="#000080">;

         </font><font color="#008000"><i>{ calculate capacity in MB }
         </i></font>capacity <font color="#000080">:= (</font>LongInt<font color="#000080">(</font>id<font color="#000080">.</font>fixcyls<font color="#000080">) * </font>id<font color="#000080">.</font>heads <font color="#000080">* </font>id<font color="#000080">.</font>sectors<font color="#000080">) </font><font color="#FF0000"><b>div </b></font><font color="#800000">2048</font><font color="#000080">;
         </font>types <font color="#000080">:= </font>types <font color="#000080">+ </font>ToStr<font color="#000080">(</font>capacity<font color="#000080">);
         </font>types <font color="#000080">:= </font>types <font color="#000080">+ </font><font color="#800000">' Mbytes'</font><font color="#000080">;
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

   </font><font color="#008000"><i>{ swap bytes in ASCII fields except for WD disks }

   </i></font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>i <font color="#000080">&lt;&gt; </font><font color="#800000">4</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>i <font color="#000080">&lt;&gt; </font><font color="#800000">5</font><font color="#000080">) </font><font color="#FF0000"><b>then
      Begin
         </b></font>SwapBytes<font color="#000080">(</font>id<font color="#000080">.</font>serial<font color="#000080">, </font>id<font color="#000080">.</font>serial<font color="#000080">, </font><font color="#800000">10</font><font color="#000080">);
         </font>SwapBytes<font color="#000080">(</font>id<font color="#000080">.</font>firmware<font color="#000080">, </font>id<font color="#000080">.</font>firmware<font color="#000080">, </font><font color="#800000">4</font><font color="#000080">);
         </font>SwapBytes<font color="#000080">(</font>id<font color="#000080">.</font>model<font color="#000080">, </font>id<font color="#000080">.</font>model<font color="#000080">, </font><font color="#800000">20</font><font color="#000080">);
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

   </font>WriteLn<font color="#000080">(</font><font color="#800000">'Informations for drive '</font><font color="#000080">, </font>drive<font color="#000080">-</font><font color="#800000">2</font><font color="#000080">, </font><font color="#800000">', '</font><font color="#000080">, </font>types<font color="#000080">);
   </font>WriteLn<font color="#000080">(</font><font color="#800000">'Drive ID '</font><font color="#000080">, </font>ConvertHex<font color="#000080">(</font>id<font color="#000080">.</font>genconf<font color="#000080">));
   </font>WriteLn<font color="#000080">(</font>id<font color="#000080">.</font>fixcyls<font color="#000080">, </font><font color="#800000">' fixed cylinders, '</font><font color="#000080">, </font>id<font color="#000080">.</font>remcyls<font color="#000080">, </font><font color="#800000">' removables'</font><font color="#000080">);
   </font>WriteLn<font color="#000080">(</font>id<font color="#000080">.</font>heads<font color="#000080">, </font><font color="#800000">' heads, '</font><font color="#000080">, </font>id<font color="#000080">.</font>sectors<font color="#000080">, </font><font color="#800000">' sectors'</font><font color="#000080">);
   </font>WriteLn<font color="#000080">(</font><font color="#800000">'Serial number: '</font><font color="#000080">, </font>id<font color="#000080">.</font>serial<font color="#000080">);
   </font>WriteLn<font color="#000080">(</font><font color="#800000">'Controller firmware: '</font><font color="#000080">, </font>id<font color="#000080">.</font>firmware<font color="#000080">);
   </font>WriteLn<font color="#000080">(</font><font color="#800000">'Controller model: '</font><font color="#000080">, </font>id<font color="#000080">.</font>model<font color="#000080">);
   </font>WriteLn<font color="#000080">(</font>id<font color="#000080">.</font>bytetrack<font color="#000080">, </font><font color="#800000">' bytes per track, '</font><font color="#000080">, </font>id<font color="#000080">.</font>bytesector<font color="#000080">, </font><font color="#800000">' per sector'</font><font color="#000080">);
   </font>WriteLn<font color="#000080">(</font>id<font color="#000080">.</font>byteisg<font color="#000080">, </font><font color="#800000">' bytes of intersector gap, '</font><font color="#000080">, </font>id<font color="#000080">.</font>byteplo<font color="#000080">, </font><font color="#800000">' of sync'</font><font color="#000080">);
   </font>WriteLn<font color="#000080">(</font><font color="#800000">'Controller type '</font><font color="#000080">, </font>id<font color="#000080">.</font>contype<font color="#000080">, </font><font color="#800000">', buffer '</font><font color="#000080">, </font>id<font color="#000080">.</font>bufsiz <font color="#FF0000"><b>div </b></font><font color="#800000">2</font><font color="#000080">, </font><font color="#800000">'KBytes'</font><font color="#000080">);
   </font>WriteLn<font color="#000080">(</font>id<font color="#000080">.</font>byteecc<font color="#000080">, </font><font color="#800000">' bytes of ECC, '</font><font color="#000080">, </font>id<font color="#000080">.</font>secsint<font color="#000080">, </font><font color="#800000">' sector(s) transferred per interrupt'</font><font color="#000080">);
   </font>WriteLn<font color="#000080">(</font><font color="#800000">'Double word transfer '</font><font color="#000080">, </font>zo<font color="#000080">(</font>id<font color="#000080">.</font>dblword<font color="#000080">),</font><font color="#800000">' allowed, '</font><font color="#000080">, </font>zo<font color="#000080">(</font>id<font color="#000080">.</font>writepro<font color="#000080">), </font><font color="#800000">'write protected.'</font><font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>readsect<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>asm
</b></font><font color="#008000"><i>{ poll DRQ }
</i></font><font color="#FF00FF">@1: mov   dx, HDC_STATUS
    in    al, dx
    and   al, HDC_STATUS_BUSY
    or    al, al
    jne   @1

</font><font color="#008000"><i>{ read up sector }
    </i></font><font color="#FF00FF">mov   cx, 256
    mov   dx, HDC_DATA
    les   di, secbuf
@2: in    ax, dx
    mov   es:[di], ax
    inc   di
    inc   di
    loop  @2
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>DriveValid<font color="#000080">(</font>Drive<font color="#000080">: </font>Char<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>Drv<font color="#000080">: </font>Byte<font color="#000080">): </font>Boolean<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>asm
    </b></font><font color="#FF00FF">mov   ah, 19h      </font><font color="#008000"><i>{ Save the current drive in BL }
    </i></font><font color="#FF00FF">int   21h
    mov   bl, al
    mov   dl, Drive    </font><font color="#008000"><i>{ Select the given drive }
    </i></font><font color="#FF00FF">sub   dl, 'A'
    les   di, DRV
    mov   es:[di], dl
    mov   ah, 0Eh
    int   21h
    mov   ah, 19h      </font><font color="#008000"><i>{ Retrieve what DOS thinks is current }
    </i></font><font color="#FF00FF">int   21h
    mov   cx, 0        </font><font color="#008000"><i>{ Assume false }
    </i></font><font color="#FF00FF">cmp   al, dl       </font><font color="#008000"><i>{ Is the current drive the given drive? }
    </i></font><font color="#FF00FF">jne   @1
    mov   cx, 1        </font><font color="#008000"><i>{ It is, so the drive is valid }
    </i></font><font color="#FF00FF">mov   dl, bl       </font><font color="#008000"><i>{ Restore the old drive }
    </i></font><font color="#FF00FF">mov   ah, 0eh
    int   21h
@1: xchg  ax, cx       </font><font color="#008000"><i>{ Put the return value into AX }
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>CurDisk<font color="#000080">: </font>Byte<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#008000"><i>{ Returns current drive }
</i></font><font color="#FF0000"><b>asm
    </b></font><font color="#FF00FF">mov   ah, 19h
    int   21h
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>begin
   if </b></font>ParamCount <font color="#000080">&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then
      Begin
         </b></font>drv <font color="#000080">:= </font>ParamStr<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">);
         </font>drv<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">] := </font>UpCase<font color="#000080">(</font>drv<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">]);
         </font><font color="#FF0000"><b>if not </b></font>DriveValid<font color="#000080">(</font>drv<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">], </font>Drive<font color="#000080">) </font><font color="#FF0000"><b>or not </b></font><font color="#000080">(</font>drv<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">] </font><font color="#FF0000"><b>in </b></font><font color="#000080">[</font><font color="#800000">'C'</font><font color="#000080">..</font><font color="#800000">'Z'</font><font color="#000080">]) </font><font color="#FF0000"><b>then
            Begin
               </b></font>WriteLn<font color="#000080">(</font><font color="#800000">'There isn''t such drive or drive invalid!'</font><font color="#000080">);
               </font>Halt<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">);
            </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>end
   else
      </b></font>drive <font color="#000080">:= </font>CurDisk<font color="#000080">;

   </font><font color="#008000"><i>{ disable interrupt from drive }
   </i></font>Port<font color="#000080">[</font>HDC_FIXED<font color="#000080">] := </font>HDC_FIXED_IRQ<font color="#000080">;

   </font><font color="#008000"><i>{ set up task file parameter }
   </i></font>Port<font color="#000080">[</font>HDC_SDH<font color="#000080">] := </font><font color="#800000">$A0 </font><font color="#000080">+ (</font>drive <font color="#FF0000"><b>shl </b></font><font color="#800000">4</font><font color="#000080">);

   </font><font color="#008000"><i>{ issue read parameters }
   </i></font>Port<font color="#000080">[</font>HDC_COMMAND<font color="#000080">] := </font>HDC_COMMAND_READPAR<font color="#000080">;

   </font>GetMem<font color="#000080">(</font>secbuf<font color="#000080">, </font>SizeOf<font color="#000080">(</font>secbuf<font color="#000080">));

   </font><font color="#008000"><i>{ read up sector }
   </i></font>readsect<font color="#000080">;

   </font><font color="#008000"><i>{ print out info }
   </i></font>printinfo<font color="#000080">;

   </font>FreeMem<font color="#000080">(</font>secbuf<font color="#000080">, </font>SizeOf<font color="#000080">(</font>secbuf<font color="#000080">));
</font><font color="#FF0000"><b>end</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to DRIVES SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0095.PAS">Original</a><b>]</b></p></body>
</html>
