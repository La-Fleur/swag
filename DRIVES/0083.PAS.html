<html>
<head><title> "Available Drive Lister" by ANDREW EIGUS</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to DRIVES SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0083.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
&gt; What I need is a routine that will give back the letters of the active
&gt; drives on a system.  Can anyone help me.
}
</i></font><font color="#FF0000"><b>Program </b></font>ListAvailableDrives<font color="#000080">;
</font><font color="#008000"><i>(*
  Public Domain, (c) 1994 by Andrew Eigus   Fidonet: 2:5100/33 }
  These routines are taken from my EnhDOS unit where are lot of useful
  stuff.

  MATERIAL RELEASED FOR SWAG
*)

</i></font><font color="#FF0000"><b>const
  </b></font><font color="#008000"><i>{ GetDriveType return values }

  </i></font>dtError      <font color="#000080">= </font><font color="#800000">$00</font><font color="#000080">; </font><font color="#008000"><i>{ Bad drive }
  </i></font>dtFixed      <font color="#000080">= </font><font color="#800000">$01</font><font color="#000080">; </font><font color="#008000"><i>{ Fixed drive }
  </i></font>dtRemovable  <font color="#000080">= </font><font color="#800000">$02</font><font color="#000080">; </font><font color="#008000"><i>{ Removable (floppy) drive }
  </i></font>dtRemote     <font color="#000080">= </font><font color="#800000">$03</font><font color="#000080">; </font><font color="#008000"><i>{ Remote (network) drive }
  </i></font>dtCDROM      <font color="#000080">= </font><font color="#800000">$04</font><font color="#000080">; </font><font color="#008000"><i>{ CD-ROM V2.00+ drive }
  </i></font>dtDblSpace   <font color="#000080">= </font><font color="#800000">$05</font><font color="#000080">; </font><font color="#008000"><i>{ DoubleSpace compressed drive }

</i></font><font color="#FF0000"><b>Function </b></font>GetDriveType<font color="#000080">(</font>Drive <font color="#000080">: </font>byte<font color="#000080">) : </font>byte<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#008000"><i>{ 0=current (default) drive,1=A,2=B,3=C... }
</i></font><font color="#FF0000"><b>Asm
  </b></font><font color="#FF00FF">cmp Drive,0
  jne @@1
  mov ah,19h
  int 21h
  mov Drive,al
  inc Drive
@@1:
  mov ax,1500h
  xor bx,bx
  int 2Fh
  or  bx,0      </font><font color="#008000"><i>{ works with CD-ROM v2.00+ }
  </i></font><font color="#FF00FF">jz  @@2
  mov ax,150Bh
  xor ch,ch
  mov cl,Drive
  int 2Fh
  cmp bx,0ADADh
  jne @@2
  or  ax,0
  jz  @@2
  mov bl,dtCDROM
  jmp @@7
@@2:
  mov ax,4A11h
  mov bx,1
  mov dl,Drive
  dec dl
  int 2Fh
  xor cl,cl     </font><font color="#008000"><i>{ mov cl,False }
  </i></font><font color="#FF00FF">or  ax,0      </font><font color="#008000"><i>{ is DoubleSpace loaded? }
  </i></font><font color="#FF00FF">jnz @@3
  cmp dl,bl     </font><font color="#008000"><i>{ if a host drive equal to compressed, then get out... }
  </i></font><font color="#FF00FF">je  @@3
  test bl,10000000b </font><font color="#008000"><i>{ bit 7=1: DL=compressed,BL=host
                           =0: DL=host,BL=compressed }
  </i></font><font color="#FF00FF">jz  @@3       </font><font color="#008000"><i>{ so avoid host drives, assume host=fixed :) }
  </i></font><font color="#FF00FF">inc dl
  cmp Drive,dl
  jne @@3
  mov bl,dtDblSpace
  jmp @@7
@@3:
  mov ax,4409h
  mov bl,Drive
  int 21h
  jc  @@5
  or  al,False
  jz  @@4
  mov bl,dtRemote
  jmp @@7
@@4:
  mov ax,4408h
  mov bl,Drive
  int 21h
  jc  @@5
  or  al,False
  jz  @@6
  mov bl,dtFixed
  jmp @@7
@@5:
  xor bl,bl     </font><font color="#008000"><i>{ mov bl,dtError cuz dtError=0 }
  </i></font><font color="#FF00FF">jmp @@7
@@6:
  mov bl,dtRemovable
@@7:
  mov al,bl
</font><font color="#FF0000"><b>End</b></font><font color="#000080">; </font><font color="#008000"><i>{ GetDriveType }

</i></font><font color="#FF0000"><b>var
  </b></font>Drive <font color="#000080">: </font>byte<font color="#000080">;
  </font>DriveType <font color="#000080">: </font>byte<font color="#000080">;

</font><font color="#FF0000"><b>Begin
  </b></font>WriteLn<font color="#000080">(</font><font color="#800000">#13#10'Drives available:'</font><font color="#000080">);
  </font>WriteLn<font color="#000080">(</font><font color="#800000">'-----------------------------'</font><font color="#000080">);
  </font><font color="#FF0000"><b>for </b></font>Drive <font color="#000080">:= (</font>Ord<font color="#000080">(</font><font color="#800000">'A'</font><font color="#000080">) - </font>Ord<font color="#000080">(</font><font color="#800000">'A'</font><font color="#000080">) + </font><font color="#800000">1</font><font color="#000080">) </font><font color="#FF0000"><b>to </b></font><font color="#000080">(</font>Ord<font color="#000080">(</font><font color="#800000">'Z'</font><font color="#000080">) - </font>Ord<font color="#000080">(</font><font color="#800000">'A'</font><font color="#000080">) + </font><font color="#800000">1</font><font color="#000080">) </font><font color="#FF0000"><b>do
  begin
    </b></font>DriveType <font color="#000080">:= </font>GetDriveType<font color="#000080">(</font>Drive<font color="#000080">);
    </font><font color="#FF0000"><b>if </b></font>DriveType <font color="#000080">&lt;&gt; </font>dtError <font color="#FF0000"><b>then
    begin
      </b></font>Write<font color="#000080">(</font><font color="#800000">'Drive '</font><font color="#000080">, </font>Chr<font color="#000080">(</font>Drive <font color="#000080">+ </font>Ord<font color="#000080">(</font><font color="#800000">'A'</font><font color="#000080">) - </font><font color="#800000">1</font><font color="#000080">), </font><font color="#800000">': '</font><font color="#000080">);
      </font><font color="#FF0000"><b>case </b></font>DriveType <font color="#FF0000"><b>of
        </b></font>dtRemovable<font color="#000080">: </font>WriteLn<font color="#000080">(</font><font color="#800000">'Removable (floppy)'</font><font color="#000080">);
        </font>dtFixed<font color="#000080">: </font>WriteLn<font color="#000080">(</font><font color="#800000">'Fixed (hard disk)'</font><font color="#000080">);
        </font>dtRemote<font color="#000080">: </font>WriteLn<font color="#000080">(</font><font color="#800000">'Remote (network)'</font><font color="#000080">);
        </font>dtCDROM<font color="#000080">: </font>WriteLn<font color="#000080">(</font><font color="#800000">'CD-ROM'</font><font color="#000080">);
        </font>dtDblSpace<font color="#000080">: </font>WriteLn<font color="#000080">(</font><font color="#800000">'DoubleSpace'</font><font color="#000080">)
      </font><font color="#FF0000"><b>end
    end
  end</b></font><font color="#000080">;
  </font>WriteLn<font color="#000080">(</font><font color="#800000">'-----------------------------'</font><font color="#000080">)
</font><font color="#FF0000"><b>End</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to DRIVES SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0083.PAS">Original</a><b>]</b></p></body>
</html>
