<html>
<head><title> "Very Nice File Handling For BP" by GIL SHAPIRA</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to FILES SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0102.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{$A+,B-,D-,E-,F-,G+,I-,L-,N+,O-,P-,Q-,R-,S-,T-,V+,X+,Y-}

</i></font><font color="#FF0000"><b>Unit </b></font>UFile95<font color="#000080">;

</font><font color="#008000"><i>{A lot of declarations in this unit belong in other units, such as
 Move32 (UMemory); TBoolean/TByte/TChar - UGlobal. Unit was modified to
 be standalone.}


(* **************************************************************
     TO COMPILE  UFILE95  YOU NEED TO COMPILE THE  UMULTI  UNIT
         WHOSE SOURCE CAN BE FOUND AT THE END OF THIS FILE
   **************************************************************
                  PLEASE PUBLISH THIS IN THE SWAG
   ************************************************************** *)


</i></font><font color="#FF0000"><b>Interface </b></font><font color="#008000"><i>{Nothing!}

</i></font><font color="#FF0000"><b>Const </b></font>Author <font color="#000080">= </font><font color="#800000">'UFile95 v6.2, 05-Feb-97, 1995-1997.'</font><font color="#000080">+
               </font><font color="#800000">'Written by Gil Shapira.'</font><font color="#000080">+
               </font><font color="#800000">'Bug or other reports to:  gilsh@ibm.net'</font><font color="#000080">;

</font><font color="#008000"><i>{Nicer looks ;-) }
</i></font><font color="#FF0000"><b>Type </b></font>TBoolean <font color="#000080">= </font>Boolean<font color="#000080">;
     </font>TPointer <font color="#000080">= </font>Pointer<font color="#000080">;
     </font>TChar <font color="#000080">= </font>Char<font color="#000080">;
     </font>TByte <font color="#000080">= </font>Byte<font color="#000080">;
     </font>TWord <font color="#000080">= </font>Word<font color="#000080">;
     </font>THalf <font color="#000080">= </font>ShortInt<font color="#000080">;
     </font>TInt <font color="#000080">= </font>Integer<font color="#000080">;
     </font>TDouble <font color="#000080">= </font>LongInt<font color="#000080">;

</font><font color="#FF0000"><b>Type </b></font>THandle <font color="#000080">= </font>TWord<font color="#000080">;
     </font>TError <font color="#000080">= </font>TWord<font color="#000080">;

</font><font color="#008000"><i>{File modes}
</i></font><font color="#FF0000"><b>Const </b></font>fmRead <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">;
      </font>fmWrite <font color="#000080">= </font><font color="#800000">1</font><font color="#000080">;
      </font>fmReadWrite <font color="#000080">= </font><font color="#800000">2</font><font color="#000080">;
      </font>fmDenyAll <font color="#000080">= </font><font color="#800000">16</font><font color="#000080">;
      </font>fmDenyWrite <font color="#000080">= </font><font color="#800000">32</font><font color="#000080">;
      </font>fmDenyRead <font color="#000080">= </font><font color="#800000">48</font><font color="#000080">;
      </font>fmDenyNone <font color="#000080">= </font><font color="#800000">64</font><font color="#000080">;

</font><font color="#008000"><i>{File seek origins}
</i></font><font color="#FF0000"><b>Const </b></font>foStart <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">;
      </font>foCurrent <font color="#000080">= </font><font color="#800000">1</font><font color="#000080">;
      </font>foEnd <font color="#000080">= </font><font color="#800000">2</font><font color="#000080">;

</font><font color="#008000"><i>{File attributes}
</i></font><font color="#FF0000"><b>Const </b></font>faReadOnly <font color="#000080">= </font><font color="#800000">1</font><font color="#000080">;
      </font>faHidden <font color="#000080">= </font><font color="#800000">2</font><font color="#000080">;
      </font>faSystem <font color="#000080">= </font><font color="#800000">4</font><font color="#000080">;
      </font>faVolume <font color="#000080">= </font><font color="#800000">8</font><font color="#000080">;
      </font>faDirectory <font color="#000080">= </font><font color="#800000">16</font><font color="#000080">;
      </font>faArchive <font color="#000080">= </font><font color="#800000">32</font><font color="#000080">;
      </font>faAnyFile <font color="#000080">= </font><font color="#800000">63</font><font color="#000080">;

</font><font color="#008000"><i>{File parts}
</i></font><font color="#FF0000"><b>Const </b></font>fcExtension <font color="#000080">= </font><font color="#800000">1</font><font color="#000080">;
      </font>fcFileName <font color="#000080">= </font><font color="#800000">2</font><font color="#000080">;
      </font>fcDirectory <font color="#000080">= </font><font color="#800000">4</font><font color="#000080">;
      </font>fcWildcards <font color="#000080">= </font><font color="#800000">8</font><font color="#000080">;

</font><font color="#008000"><i>{Search record for DOS interrupt 21h}
</i></font><font color="#FF0000"><b>Type </b></font>PSearch <font color="#000080">= ^</font>TSearch<font color="#000080">;
     </font>TSearch <font color="#000080">= </font><font color="#FF0000"><b>Record
                </b></font>SearchDrive<font color="#000080">: </font>TChar<font color="#000080">;
                </font>SearchTemplate<font color="#000080">: </font><font color="#FF0000"><b>Array </b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">11</font><font color="#000080">] </font><font color="#FF0000"><b>Of </b></font>TByte<font color="#000080">;
                </font>SearchAttr<font color="#000080">: </font>TByte<font color="#000080">;
                </font>DirEntry<font color="#000080">: </font>TWord<font color="#000080">;
                </font>StartCluster<font color="#000080">: </font>TWord<font color="#000080">;
                </font>Reserved<font color="#000080">: </font><font color="#FF0000"><b>Array </b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">4</font><font color="#000080">] </font><font color="#FF0000"><b>Of </b></font>TByte<font color="#000080">;
                </font>Attr<font color="#000080">: </font>TByte<font color="#000080">;
                </font>Time<font color="#000080">: </font>TWord<font color="#000080">;
                </font>Date<font color="#000080">: </font>TWord<font color="#000080">;
                </font>Size<font color="#000080">: </font>TDouble<font color="#000080">;
                </font>Name<font color="#000080">: </font><font color="#FF0000"><b>Array </b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">13</font><font color="#000080">] </font><font color="#FF0000"><b>Of </b></font>TChar<font color="#000080">;
               </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#008000"><i>{Search record for Windows '95 interrupt 21h}
</i></font><font color="#FF0000"><b>Type </b></font>PSearch95 <font color="#000080">= ^</font>TSearch95<font color="#000080">;
     </font>TSearch95 <font color="#000080">= </font><font color="#FF0000"><b>Record
                  </b></font>Handle<font color="#000080">: </font>TWord<font color="#000080">;
                  </font>Attr<font color="#000080">: </font>TDouble<font color="#000080">;
                  </font>Creation<font color="#000080">: </font>Comp<font color="#000080">;
                  </font>LastAccess<font color="#000080">: </font>Comp<font color="#000080">;
                  </font>LastModify<font color="#000080">: </font>Comp<font color="#000080">;
                  </font>SizeHi<font color="#000080">: </font>TDouble<font color="#000080">;
                  </font>SizeLo<font color="#000080">: </font>TDouble<font color="#000080">;
                  </font>Reserved<font color="#000080">: </font><font color="#FF0000"><b>Array </b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">8</font><font color="#000080">] </font><font color="#FF0000"><b>Of </b></font>TByte<font color="#000080">;
                  </font>Name<font color="#000080">: </font><font color="#FF0000"><b>Array </b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">259</font><font color="#000080">] </font><font color="#FF0000"><b>Of </b></font>TChar<font color="#000080">;
                  </font>ShortName<font color="#000080">: </font><font color="#FF0000"><b>Array </b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">13</font><font color="#000080">] </font><font color="#FF0000"><b>Of </b></font>TChar<font color="#000080">;
                 </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Var </b></font>LockLevel<font color="#000080">,
    </font>FileMode<font color="#000080">,
    </font>FindAttr<font color="#000080">,
    </font>CopyAttr<font color="#000080">,
    </font>DeleteAttr<font color="#000080">,
    </font>CreateAttr<font color="#000080">: </font>TWord<font color="#000080">;
    </font>flError<font color="#000080">: </font>TError<font color="#000080">;
    </font>isError<font color="#000080">,
    </font>Using95<font color="#000080">: </font>TBoolean<font color="#000080">;

 </font><font color="#008000"><i>{Creates a new directory; only ONE directory at a time.}
</i></font><font color="#FF0000"><b>Procedure </b></font>CreateDir<font color="#000080">(</font>PathName<font color="#000080">: </font>PChar<font color="#000080">);
 </font><font color="#008000"><i>{Removes an existing directory; should not be current directory}
</i></font><font color="#FF0000"><b>Procedure </b></font>RemoveDir<font color="#000080">(</font>PathName<font color="#000080">: </font>PChar<font color="#000080">);
 </font><font color="#008000"><i>{Makes the specified directory the current directory,
  without changing the current drive}
</i></font><font color="#FF0000"><b>Procedure </b></font>ChangeDir<font color="#000080">(</font>PathName<font color="#000080">: </font>PChar<font color="#000080">);
 </font><font color="#008000"><i>{Returns the current directory path}
</i></font><font color="#FF0000"><b>Procedure </b></font>CurrentDir<font color="#000080">(</font>CurDir<font color="#000080">: </font>PChar<font color="#000080">);
 </font><font color="#008000"><i>{Makes the specified directory the current directory,
  and changes the current drive if needed}
</i></font><font color="#FF0000"><b>Procedure </b></font>ChangePath<font color="#000080">(</font>PathName<font color="#000080">: </font>PChar<font color="#000080">);
 </font><font color="#008000"><i>{Creates a virtual drive for the path specified; should be
  used ONLY under Windows '95}
</i></font><font color="#FF0000"><b>Procedure </b></font>Subst<font color="#000080">(</font>Drive<font color="#000080">: </font>TChar<font color="#000080">; </font>PathName<font color="#000080">: </font>PChar<font color="#000080">);
 </font><font color="#008000"><i>{Returns the path for the virtual drive specified; should be
  used ONLY under Windows '95}
</i></font><font color="#FF0000"><b>Procedure </b></font>QuerySubst<font color="#000080">(</font>Drive<font color="#000080">: </font>TChar<font color="#000080">; </font><font color="#FF0000"><b>Var </b></font>PathName<font color="#000080">: </font>PChar<font color="#000080">);
 </font><font color="#008000"><i>{Terminates the virtual drive association; should be
  used ONLY under Windows '95}
</i></font><font color="#FF0000"><b>Procedure </b></font>DeleteSubst<font color="#000080">(</font>Drive<font color="#000080">: </font>TChar<font color="#000080">);
 </font><font color="#008000"><i>{Creates a new file}
</i></font><font color="#FF0000"><b>Function </b></font>Create<font color="#000080">(</font>FileName<font color="#000080">: </font>PChar<font color="#000080">): </font>THandle<font color="#000080">;
 </font><font color="#008000"><i>{Replaces an existing file, erasing its content}
</i></font><font color="#FF0000"><b>Function </b></font>Replace<font color="#000080">(</font>FileName<font color="#000080">: </font>PChar<font color="#000080">): </font>THandle<font color="#000080">;
 </font><font color="#008000"><i>{Opens an existing file}
</i></font><font color="#FF0000"><b>Function </b></font>Open<font color="#000080">(</font>FileName<font color="#000080">: </font>PChar<font color="#000080">): </font>THandle<font color="#000080">;
 </font><font color="#008000"><i>{Duplicated a file handle}
</i></font><font color="#FF0000"><b>Function </b></font>Duplicate<font color="#000080">(</font>Handle<font color="#000080">: </font>THandle<font color="#000080">): </font>THandle<font color="#000080">;
 </font><font color="#008000"><i>{Changes the position in the file; use the file origin
  constants for Origin}
</i></font><font color="#FF0000"><b>Function </b></font>Seek<font color="#000080">(</font>Handle<font color="#000080">: </font>THandle<font color="#000080">; </font>Position<font color="#000080">: </font>TDouble<font color="#000080">; </font>Origin<font color="#000080">: </font>TByte<font color="#000080">): </font>TDouble<font color="#000080">;
 </font><font color="#008000"><i>{Returns the current position in the file}
</i></font><font color="#FF0000"><b>Function </b></font>FilePos<font color="#000080">(</font>Handle<font color="#000080">: </font>THandle<font color="#000080">): </font>TDouble<font color="#000080">;
 </font><font color="#008000"><i>{Returns the size of the file}
</i></font><font color="#FF0000"><b>Function </b></font>FileSize<font color="#000080">(</font>Handle<font color="#000080">: </font>THandle<font color="#000080">): </font>TDouble<font color="#000080">;
 </font><font color="#008000"><i>{Splits the path to directory, filename (8), and extension (4)}
</i></font><font color="#FF0000"><b>Function </b></font>FSplit<font color="#000080">(</font>Path<font color="#000080">,</font>Dir<font color="#000080">,</font>Name<font color="#000080">,</font>Ext<font color="#000080">: </font>PChar<font color="#000080">): </font>TByte<font color="#000080">;
 </font><font color="#008000"><i>{Expands a short/long filename}
</i></font><font color="#FF0000"><b>Procedure </b></font>FExpand<font color="#000080">(</font>Path<font color="#000080">,</font>Result<font color="#000080">: </font>PChar<font color="#000080">);
 </font><font color="#008000"><i>{Return the file attributes}
</i></font><font color="#FF0000"><b>Function </b></font>GetFileAttr<font color="#000080">(</font>FileName<font color="#000080">: </font>PChar<font color="#000080">): </font>TByte<font color="#000080">;
 </font><font color="#008000"><i>{Changes the file attributes}
</i></font><font color="#FF0000"><b>Procedure </b></font>SetFileAttr<font color="#000080">(</font>FileName<font color="#000080">: </font>PChar<font color="#000080">; </font>Attr<font color="#000080">: </font>TByte<font color="#000080">);
 </font><font color="#008000"><i>{Returns a file's true name}
</i></font><font color="#FF0000"><b>Procedure </b></font>TrueName<font color="#000080">(</font>FileName<font color="#000080">,</font>TrueFileName<font color="#000080">: </font>PChar<font color="#000080">);
 </font><font color="#008000"><i>{Returns a file's short name (8.3); should be used only
  under Windows '95}
</i></font><font color="#FF0000"><b>Procedure </b></font>ShortName<font color="#000080">(</font>FileName<font color="#000080">,</font>ShortFileName<font color="#000080">: </font>PChar<font color="#000080">);
 </font><font color="#008000"><i>{Generates a short name (8.3) for a long file name; should
  be used only under Windows '95}
</i></font><font color="#FF0000"><b>Procedure </b></font>LongToShort<font color="#000080">(</font>FileName<font color="#000080">,</font>ShortFileName<font color="#000080">: </font>PChar<font color="#000080">);
 </font><font color="#008000"><i>{Deletes a file}
</i></font><font color="#FF0000"><b>Procedure </b></font>Delete<font color="#000080">(</font>FileName<font color="#000080">: </font>PChar<font color="#000080">);
 </font><font color="#008000"><i>{Renames a file; can move a file between directories on the same drive}
</i></font><font color="#FF0000"><b>Procedure </b></font>Rename<font color="#000080">(</font>FileName<font color="#000080">,</font>NewName<font color="#000080">: </font>PChar<font color="#000080">);
 </font><font color="#008000"><i>{Deletes any bytes from the position in the file to its end}
</i></font><font color="#FF0000"><b>Procedure </b></font>Truncate<font color="#000080">(</font>Handle<font color="#000080">: </font>THandle<font color="#000080">);
 </font><font color="#008000"><i>{Flushes any file buffers}
</i></font><font color="#FF0000"><b>Procedure </b></font>Commit<font color="#000080">(</font>Handle<font color="#000080">: </font>THandle<font color="#000080">);
 </font><font color="#008000"><i>{Closes a file, writing any changes}
</i></font><font color="#FF0000"><b>Procedure </b></font>Close<font color="#000080">(</font>Handle<font color="#000080">: </font>THandle<font color="#000080">);
 </font><font color="#008000"><i>{Reads a block of bytes to a buffer}
</i></font><font color="#FF0000"><b>Function </b></font>BlockRead<font color="#000080">(</font>Handle<font color="#000080">: </font>THandle<font color="#000080">; </font><font color="#FF0000"><b>Var </b></font>Buff<font color="#000080">; </font>Count<font color="#000080">: </font>TWord<font color="#000080">): </font>TWord<font color="#000080">;
 </font><font color="#008000"><i>{Writes a block of bytes to a file}
</i></font><font color="#FF0000"><b>Function </b></font>BlockWrite<font color="#000080">(</font>Handle<font color="#000080">: </font>THandle<font color="#000080">; </font><font color="#FF0000"><b>Var </b></font>Buff<font color="#000080">; </font>Count<font color="#000080">: </font>TWord<font color="#000080">): </font>TWord<font color="#000080">;
 </font><font color="#008000"><i>{Locks a drive to allow direct drive accesses}
</i></font><font color="#FF0000"><b>Procedure </b></font>LockDrive<font color="#000080">(</font>Drive<font color="#000080">: </font>TChar<font color="#000080">);
 </font><font color="#008000"><i>{Unlocks a drive to disallow direct drive accesses}
</i></font><font color="#FF0000"><b>Procedure </b></font>UnlockDrive<font color="#000080">(</font>Drive<font color="#000080">: </font>TChar<font color="#000080">);
 </font><font color="#008000"><i>{Changes the current drive}
</i></font><font color="#FF0000"><b>Procedure </b></font>ChangeDrive<font color="#000080">(</font>Drive<font color="#000080">: </font>TChar<font color="#000080">);
 </font><font color="#008000"><i>{Returns the current drive}
</i></font><font color="#FF0000"><b>Function </b></font>CurrentDrive<font color="#000080">: </font>TChar<font color="#000080">;
 </font><font color="#008000"><i>{Disables a drive, rendering it completely inaccessible until reenabled}
</i></font><font color="#FF0000"><b>Procedure </b></font>DisableDrive<font color="#000080">(</font>Drive<font color="#000080">: </font>TChar<font color="#000080">);
 </font><font color="#008000"><i>{Enables a previously disabled drive}
</i></font><font color="#FF0000"><b>Procedure </b></font>EnableDrive<font color="#000080">(</font>Drive<font color="#000080">: </font>TChar<font color="#000080">);
 </font><font color="#008000"><i>{Turns a FLOPPY drive's led on}
</i></font><font color="#FF0000"><b>Procedure </b></font>TurnLedOn<font color="#000080">(</font>Drive<font color="#000080">: </font>TChar<font color="#000080">);
 </font><font color="#008000"><i>{Turns a FLOPPY drive's led off}
</i></font><font color="#FF0000"><b>Procedure </b></font>TurnLedOff<font color="#000080">(</font>Drive<font color="#000080">: </font>TChar<font color="#000080">);
 </font><font color="#008000"><i>{Returns a drive's information}
</i></font><font color="#FF0000"><b>Function </b></font>DriveInformation<font color="#000080">(</font>Drive<font color="#000080">: </font>TChar<font color="#000080">; </font><font color="#FF0000"><b>Var </b></font>DriveType<font color="#000080">: </font>TByte<font color="#000080">; </font>Volume<font color="#000080">: </font>TPointer<font color="#000080">; </font><font color="#FF0000"><b>Var </b></font>Serial<font color="#000080">,</font>TotalSpace<font color="#000080">,</font>FreeSpace<font color="#000080">,
                           </font>ClusterSize<font color="#000080">: </font>TDouble<font color="#000080">): </font>TBoolean<font color="#000080">;
 </font><font color="#008000"><i>{Returns the amount of bytes free on a drive}
</i></font><font color="#FF0000"><b>Function </b></font>DiskFree<font color="#000080">(</font>Drive<font color="#000080">: </font>TChar<font color="#000080">): </font>TDouble<font color="#000080">;
 </font><font color="#008000"><i>{Returns the total amount of bytes used on a drive}
</i></font><font color="#FF0000"><b>Function </b></font>DiskSize<font color="#000080">(</font>Drive<font color="#000080">: </font>TChar<font color="#000080">): </font>TDouble<font color="#000080">;
 </font><font color="#008000"><i>{Resets a drive, flushing its buffers}
</i></font><font color="#FF0000"><b>Procedure </b></font>ResetDrive<font color="#000080">(</font>Drive<font color="#000080">: </font>TChar<font color="#000080">);
 </font><font color="#008000"><i>{Quits from the calling program}
</i></font><font color="#FF0000"><b>Procedure </b></font>Halt<font color="#000080">(</font>ErrorLevel<font color="#000080">: </font>TByte<font color="#000080">);
 </font><font color="#008000"><i>{Runs another program; READ NOTE IN THE CODE ITSELF!}
</i></font><font color="#FF0000"><b>Procedure </b></font>Exec<font color="#000080">(</font>Prog<font color="#000080">,</font>Params<font color="#000080">: </font>PChar<font color="#000080">);
 </font><font color="#008000"><i>{Sets the data transfer area; not to be changed normally}
</i></font><font color="#FF0000"><b>Procedure </b></font>SetDTA<font color="#000080">(</font>Address<font color="#000080">: </font>TPointer<font color="#000080">);
 </font><font color="#008000"><i>{Returns the data transfer area's address}
</i></font><font color="#FF0000"><b>Function </b></font>GetDTA<font color="#000080">: </font>TPointer<font color="#000080">;
 </font><font color="#008000"><i>{Finds the first file; able to process long filenames; should be
  used ONLY under Windows '95}
</i></font><font color="#FF0000"><b>Procedure </b></font>FindFirst95<font color="#000080">(</font>FileSpec<font color="#000080">: </font>PChar<font color="#000080">; </font>Attr<font color="#000080">: </font>TByte<font color="#000080">; </font><font color="#FF0000"><b>Var </b></font>Search<font color="#000080">: </font>TSearch95<font color="#000080">);
 </font><font color="#008000"><i>{Returns the next file; should be
  used ONLY under Windows '95}
</i></font><font color="#FF0000"><b>Procedure </b></font>FindNext95<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>Search<font color="#000080">: </font>TSearch95<font color="#000080">);
 </font><font color="#008000"><i>{Closes a file search; MUST be done at the end of a search; should be
  used ONLY under Windows '95}
</i></font><font color="#FF0000"><b>Procedure </b></font>FindClose95<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>Search<font color="#000080">: </font>TSearch95<font color="#000080">);
 </font><font color="#008000"><i>{Finds the first file}
</i></font><font color="#FF0000"><b>Procedure </b></font>FindFirst<font color="#000080">(</font>FileSpec<font color="#000080">: </font>PChar<font color="#000080">; </font>Attr<font color="#000080">: </font>TWord<font color="#000080">; </font><font color="#FF0000"><b>Var </b></font>Search<font color="#000080">: </font>TSearch<font color="#000080">);
 </font><font color="#008000"><i>{Finds the next file}
</i></font><font color="#FF0000"><b>Procedure </b></font>FindNext<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>Search<font color="#000080">: </font>TSearch<font color="#000080">);
 </font><font color="#008000"><i>{Moves 4 bytes in each move; much faster; (80386 processors
  and faster ONLY)}
</i></font><font color="#FF0000"><b>Procedure </b></font>Move32<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>Source<font color="#000080">,</font>Target<font color="#000080">; </font>Len<font color="#000080">: </font>TWord<font color="#000080">);


</font><font color="#FF0000"><b>Implementation uses </b></font>UMulti<font color="#000080">,</font>Strings<font color="#000080">; </font><font color="#008000"><i>{This is of course the Strings unit
                                     you got with your Borland/Turbo Pascal.
                                     The UMulti unit is at the end of this
                                     file. Compile if first.}

</i></font><font color="#FF0000"><b>Var </b></font>DTA<font color="#000080">: </font>TPointer<font color="#000080">;
    </font>ParameterBlock<font color="#000080">: </font>TPointer<font color="#000080">;
    </font>Block<font color="#000080">: </font><font color="#FF0000"><b>Array </b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">40</font><font color="#000080">] </font><font color="#FF0000"><b>Of </b></font>TByte<font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>Move32<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>Source<font color="#000080">,</font>Target<font color="#000080">; </font>Len<font color="#000080">: </font>TWord<font color="#000080">); </font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Asm
  </b></font><font color="#FF00FF">Push          Ds
  Mov           Cx,Len
  Jcxz         @</font><font color="#FF0000"><b>End
  </b></font>Lds           Si<font color="#000080">,</font>Source
  Les           Di<font color="#000080">,</font>Target
  Cld
  <font color="#FF0000"><b>ShR           </b></font>Cx<font color="#000080">,</font><font color="#800000">1
  </font>Jnc          <font color="#000080">@</font>Sw
  MovSb
 <font color="#000080">@</font>Sw<font color="#000080">:
  </font><font color="#FF0000"><b>Shr           </b></font>Cx<font color="#000080">,</font><font color="#800000">1
  </font>Jnc          <font color="#000080">@</font>Sd
  MovSw
 <font color="#000080">@</font>Sd<font color="#000080">:
  </font>Db            <font color="#800000">66</font>h<font color="#000080">,</font><font color="#800000">0</font>F3h<font color="#000080">,</font><font color="#800000">0</font>A5h <font color="#008000"><i>{Rep MovSd}
 </i></font><font color="#000080">@</font><font color="#FF0000"><b>End</b></font><font color="#000080">:
  </font>Pop           Ds
<font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>CreateDir<font color="#000080">(</font>PathName<font color="#000080">: </font>PChar<font color="#000080">); </font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Asm
  </b></font><font color="#FF00FF">Push          Ds
  Mov           Ax,7139h
  Cmp           Using95,True
  Je           @Use95
  Mov           Ax,3900h
 @Use95:
  Lds           Dx,PathName
  Int           21h
  Pop           Ds
  Jnc          @</font><font color="#FF0000"><b>End
  </b></font>Mov           flError<font color="#000080">,</font>Ax
  Mov           isError<font color="#000080">,</font>True
 <font color="#000080">@</font><font color="#FF0000"><b>End</b></font><font color="#000080">:
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>RemoveDir<font color="#000080">(</font>PathName<font color="#000080">: </font>PChar<font color="#000080">); </font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Asm
  </b></font><font color="#FF00FF">Push          Ds
  Mov           Ax,713Ah
  Cmp           Using95,True
  Je           @Use95
  Mov           Ax,3A00h
 @Use95:
  Lds           Dx,PathName
  Int           21h
  Pop           Ds
  Jnc          @</font><font color="#FF0000"><b>End
  </b></font>Mov           flError<font color="#000080">,</font>Ax
  Mov           isError<font color="#000080">,</font>True
 <font color="#000080">@</font><font color="#FF0000"><b>End</b></font><font color="#000080">:
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>ChangeDir<font color="#000080">(</font>PathName<font color="#000080">: </font>PChar<font color="#000080">); </font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Asm
  </b></font><font color="#FF00FF">Push          Ds
  Mov           Ax,713Bh
  Cmp           Using95,True
  Je           @Use95
  Mov           Ax,3B00h
 @Use95:
  Lds           Dx,PathName
  Int           21h
  Pop           Ds
  Jnc          @</font><font color="#FF0000"><b>End
  </b></font>Mov           flError<font color="#000080">,</font>Ax
  Mov           isError<font color="#000080">,</font>True
 <font color="#000080">@</font><font color="#FF0000"><b>End</b></font><font color="#000080">:
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>CurrentDir<font color="#000080">(</font>CurDir<font color="#000080">: </font>PChar<font color="#000080">); </font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Asm
  </b></font><font color="#FF00FF">Push          Ds
  Mov           Ax,7147h
  Cmp           Using95,True
  Je           @Use95
  Mov           Ax,4700h
 @Use95:
  Xor           Dl,Dl
  Lds           Si,CurDir
  Int           21h
  Pop           Ds
  Jnc          @</font><font color="#FF0000"><b>End
  </b></font>Mov           flError<font color="#000080">,</font>Ax
  Mov           isError<font color="#000080">,</font>True
 <font color="#000080">@</font><font color="#FF0000"><b>End</b></font><font color="#000080">:
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>ChangePath<font color="#000080">(</font>PathName<font color="#000080">: </font>PChar<font color="#000080">); </font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Asm
  </b></font><font color="#FF00FF">Push          Ds
  Lds           Si,PathName
  LodSw
  Cmp           Ah,':'
  Jne          @NoDrive
  Cmp           Al,'A'
  Jb           @NoUpper
  Cmp           Al,'Z'
  Ja           @NoUpper
  Sub           Al,20h
 @NoUpper:
  Xor           Ah,Ah
  Push          Ax
  Call          ChangeDrive
 @NoDrive:
  Lds           Si,PathName
  LodSw
  Cmp           Ah,':'
  Jne          @Added
  Dec           Si
  Dec           Si
 @Added:
  Mov           Ax,Ds
  Mov           Es,Ax
  Pop           Ds
  Push          Es
  Push          Si
  Call          ChangeDir
 @</font><font color="#FF0000"><b>End</b></font><font color="#000080">:
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>Subst<font color="#000080">(</font>Drive<font color="#000080">: </font>TChar<font color="#000080">; </font>PathName<font color="#000080">: </font>PChar<font color="#000080">); </font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Asm
  </b></font><font color="#FF00FF">Push          Ds
  Cmp           Using95,True
  Jne           @</font><font color="#FF0000"><b>End
  </b></font>Mov           Ax<font color="#000080">,</font><font color="#800000">71</font>AAh
  <font color="#FF0000"><b>Xor           </b></font>Bh<font color="#000080">,</font>Bh
  Mov           Bl<font color="#000080">,</font>Drive
  Sub           Bl<font color="#000080">,</font><font color="#800000">64
  </font>Lds           Dx<font color="#000080">,</font>PathName
  Int           <font color="#800000">21</font>h
  Pop           Ds
  Jnc          <font color="#000080">@</font><font color="#FF0000"><b>End
  </b></font>Mov           flError<font color="#000080">,</font>Ax
  Mov           isError<font color="#000080">,</font>True
 <font color="#000080">@</font><font color="#FF0000"><b>End</b></font><font color="#000080">:
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>QuerySubst<font color="#000080">(</font>Drive<font color="#000080">: </font>TChar<font color="#000080">; </font><font color="#FF0000"><b>Var </b></font>PathName<font color="#000080">: </font>PChar<font color="#000080">); </font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Asm
  </b></font><font color="#FF00FF">Push          Ds
  Cmp           Using95,True
  Jne           @</font><font color="#FF0000"><b>End
  </b></font>Mov           Ax<font color="#000080">,</font><font color="#800000">71</font>AAh
  Mov           Bh<font color="#000080">,</font><font color="#800000">02</font>h
  Mov           Bl<font color="#000080">,</font>Drive
  Sub           Bl<font color="#000080">,</font><font color="#800000">64
  </font>Lds           Dx<font color="#000080">,</font>PathName
  Int           <font color="#800000">21</font>h
  Pop           Ds
  Jnc          <font color="#000080">@</font><font color="#FF0000"><b>End
  </b></font>Mov           flError<font color="#000080">,</font>Ax
  Mov           isError<font color="#000080">,</font>True
 <font color="#000080">@</font><font color="#FF0000"><b>End</b></font><font color="#000080">:
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>DeleteSubst<font color="#000080">(</font>Drive<font color="#000080">: </font>TChar<font color="#000080">); </font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Asm
  </b></font><font color="#FF00FF">Cmp           Using95,True
  Jne           @</font><font color="#FF0000"><b>End
  </b></font>Mov           Ax<font color="#000080">,</font><font color="#800000">71</font>AAh
  Mov           Bh<font color="#000080">,</font><font color="#800000">01</font>h
  Mov           Bl<font color="#000080">,</font>Drive
  Sub           Bl<font color="#000080">,</font><font color="#800000">64
  </font>Int           <font color="#800000">21</font>h
  Jnc          <font color="#000080">@</font><font color="#FF0000"><b>End
  </b></font>Mov           flError<font color="#000080">,</font>Ax
  Mov           isError<font color="#000080">,</font>True
 <font color="#000080">@</font><font color="#FF0000"><b>End</b></font><font color="#000080">:
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>Create<font color="#000080">(</font>FileName<font color="#000080">: </font>PChar<font color="#000080">): </font>THandle<font color="#000080">; </font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Asm
  </b></font><font color="#FF00FF">Push          Ds
  Mov           Ax,716Ch
  Cmp           Using95,True
  Je           @Use95
  Mov           Ax,6C00h
 @Use95:
  Mov           Bl,Byte Ptr FileMode
  Mov           Bh,32
  Mov           Cx,Word Ptr CreateAttr
  Mov           Dx,0000000000010000b
  Lds           Si,FileName
  Int           21h
  Pop           Ds
  Jnc          @</font><font color="#FF0000"><b>End
  </b></font>Mov           flError<font color="#000080">,</font>Ax
  Mov           isError<font color="#000080">,</font>True
  <font color="#FF0000"><b>Xor           </b></font>Ax<font color="#000080">,</font>Ax
 <font color="#000080">@</font><font color="#FF0000"><b>End</b></font><font color="#000080">:
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>Replace<font color="#000080">(</font>FileName<font color="#000080">: </font>PChar<font color="#000080">): </font>THandle<font color="#000080">; </font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Asm
  </b></font><font color="#FF00FF">Push          Ds
  Mov           Ax,716Ch
  Cmp           Using95,True
  Je           @Use95
  Mov           Ax,6C00h
 @Use95:
  Mov           Bl,Byte Ptr FileMode
  Mov           Bh,32
  Mov           Cx,32
  Mov           Dx,0000000000010010b
  Lds           Si,FileName
  Int           21h
  Pop           Ds
  Jnc          @</font><font color="#FF0000"><b>End
  </b></font>Mov           flError<font color="#000080">,</font>Ax
  Mov           isError<font color="#000080">,</font>True
  <font color="#FF0000"><b>Xor           </b></font>Ax<font color="#000080">,</font>Ax
 <font color="#000080">@</font><font color="#FF0000"><b>End</b></font><font color="#000080">:
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>Open<font color="#000080">(</font>FileName<font color="#000080">: </font>PChar<font color="#000080">): </font>THandle<font color="#000080">; </font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Asm
  </b></font><font color="#FF00FF">Push          Ds
  Mov           Ax,716Ch
  Cmp           Using95,True
  Je           @Use95
  Mov           Ax,6C00h
 @Use95:
  Mov           Bl,Byte Ptr FileMode
  Mov           Bh,32
  Mov           Cx,32
  Mov           Dx,0000000000000001b
  Lds           Si,FileName
  Int           21h
  Pop           Ds
  Jnc          @</font><font color="#FF0000"><b>End
  </b></font>Mov           flError<font color="#000080">,</font>Ax
  Mov           isError<font color="#000080">,</font>True
  <font color="#FF0000"><b>Xor           </b></font>Ax<font color="#000080">,</font>Ax
 <font color="#000080">@</font><font color="#FF0000"><b>End</b></font><font color="#000080">:
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>Duplicate<font color="#000080">(</font>Handle<font color="#000080">: </font>THandle<font color="#000080">): </font>THandle<font color="#000080">; </font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Asm
  </b></font><font color="#FF00FF">Mov           Ah,45h
  Mov           Bx,Word Ptr Handle
  Int           21h
  Jnc          @</font><font color="#FF0000"><b>End
  </b></font>Mov           flError<font color="#000080">,</font>Ax
  Mov           isError<font color="#000080">,</font>True
  <font color="#FF0000"><b>Xor           </b></font>Ax<font color="#000080">,</font>Ax
 <font color="#000080">@</font><font color="#FF0000"><b>End</b></font><font color="#000080">:
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>Seek<font color="#000080">(</font>Handle<font color="#000080">: </font>THandle<font color="#000080">; </font>Position<font color="#000080">: </font>TDouble<font color="#000080">; </font>Origin<font color="#000080">: </font>TByte<font color="#000080">): </font>TDouble<font color="#000080">; </font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Asm
  </b></font><font color="#FF00FF">Mov           Ah,42h
  Mov           Al,Byte Ptr Origin
  Mov           Bx,Word Ptr Handle
  Mov           Cx,Word Ptr Position
  Mov           Dx,Word Ptr Position+2
  Int           21h
  Jnc          @</font><font color="#FF0000"><b>End
  </b></font>Mov           flError<font color="#000080">,</font>Ax
  Mov           isError<font color="#000080">,</font>True
  <font color="#FF0000"><b>Xor           </b></font>Ax<font color="#000080">,</font>Ax
 <font color="#000080">@</font><font color="#FF0000"><b>End</b></font><font color="#000080">:
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>FilePos<font color="#000080">(</font>Handle<font color="#000080">: </font>THandle<font color="#000080">): </font>TDouble<font color="#000080">; </font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Asm
  </b></font><font color="#FF00FF">Mov           Ah,42h
  Mov           Al,foCurrent
  Mov           Bx,Word Ptr Handle
  Xor           Cx,Cx
  Xor           Dx,Dx
  Int           21h
  Jnc          @</font><font color="#FF0000"><b>End
  </b></font>Mov           flError<font color="#000080">,</font>Ax
  Mov           isError<font color="#000080">,</font>True
  <font color="#FF0000"><b>Xor           </b></font>Ax<font color="#000080">,</font>Ax
  <font color="#FF0000"><b>Xor           </b></font>Dx<font color="#000080">,</font>Dx
 <font color="#000080">@</font><font color="#FF0000"><b>End</b></font><font color="#000080">:
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>FileSize<font color="#000080">(</font>Handle<font color="#000080">: </font>THandle<font color="#000080">): </font>TDouble<font color="#000080">; </font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Var </b></font>FPos<font color="#000080">: </font>TDouble<font color="#000080">;
</font><font color="#FF0000"><b>Asm
  </b></font><font color="#FF00FF">Push          Word Ptr Handle
  Call          FilePos
  Cmp           Word Ptr flError,0
  Jne          @Error
  Mov           Word Ptr FPos,Dx
  Mov           Word Ptr FPos+2,Ax
  Mov           Ah,42h
  Mov           Al,foEnd
  Mov           Bx,Word Ptr Handle
  Xor           Cx,Cx
  Xor           Dx,Dx
  Int           21h
  Jc           @Error
  Pusha
  Mov           Ah,42h
  Mov           Al,foStart
  Mov           Bx,Word Ptr Handle
  Mov           Cx,Word Ptr FPos
  Mov           Dx,Word Ptr FPos+2
  Int           21h
  Jnc          @</font><font color="#FF0000"><b>End
 </b></font><font color="#000080">@</font>Error<font color="#000080">:
  </font>Mov           flError<font color="#000080">,</font>Ax
  Mov           isError<font color="#000080">,</font>True
  <font color="#FF0000"><b>Xor           </b></font>Ax<font color="#000080">,</font>Ax
  <font color="#FF0000"><b>Xor           </b></font>Dx<font color="#000080">,</font>Dx
 <font color="#000080">@</font><font color="#FF0000"><b>End</b></font><font color="#000080">:
  </font>Popa
<font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>FSplit<font color="#000080">(</font>Path<font color="#000080">,</font>Dir<font color="#000080">,</font>Name<font color="#000080">,</font>Ext<font color="#000080">: </font>PChar<font color="#000080">): </font>TByte<font color="#000080">;
</font><font color="#008000"><i>{Based on the Borland Pascal run-time library and EnhancedDos (Andrew Eigus);
 Modified for long filename support by Gil Shapira}
</i></font><font color="#FF0000"><b>Var </b></font>DirLen<font color="#000080">,</font>NameLen<font color="#000080">,</font>Flags<font color="#000080">: </font>TWord<font color="#000080">;
    </font>NamePtr<font color="#000080">,</font>ExtPtr<font color="#000080">: </font>PChar<font color="#000080">;
</font><font color="#FF0000"><b>Begin
 </b></font>NamePtr<font color="#000080">:=</font>StrRScan<font color="#000080">(</font>Path<font color="#000080">,</font><font color="#800000">'\'</font><font color="#000080">);
 </font><font color="#FF0000"><b>If </b></font><font color="#000080">(</font>NamePtr<font color="#000080">=</font><font color="#FF0000"><b>Nil</b></font><font color="#000080">) </font><font color="#FF0000"><b>Then </b></font>NamePtr<font color="#000080">:=</font>StrRScan<font color="#000080">(</font>Path<font color="#000080">,</font><font color="#800000">':'</font><font color="#000080">);
 </font><font color="#FF0000"><b>If </b></font><font color="#000080">(</font>NamePtr<font color="#000080">=</font><font color="#FF0000"><b>Nil</b></font><font color="#000080">) </font><font color="#FF0000"><b>Then </b></font>NamePtr<font color="#000080">:=</font>Path <font color="#FF0000"><b>Else </b></font>Inc<font color="#000080">(</font>NamePtr<font color="#000080">);
 </font>ExtPtr<font color="#000080">:=</font>StrScan<font color="#000080">(</font>NamePtr<font color="#000080">,</font><font color="#800000">'.'</font><font color="#000080">);
 </font><font color="#FF0000"><b>If </b></font><font color="#000080">(</font>ExtPtr<font color="#000080">=</font><font color="#FF0000"><b>Nil</b></font><font color="#000080">) </font><font color="#FF0000"><b>Then </b></font>ExtPtr<font color="#000080">:=</font>StrEnd<font color="#000080">(</font>NamePtr<font color="#000080">);
 </font>DirLen<font color="#000080">:=</font>NamePtr<font color="#000080">-</font>Path<font color="#000080">;
 </font>NameLen<font color="#000080">:=</font>ExtPtr<font color="#000080">-</font>NamePtr<font color="#000080">;
 </font>Flags<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
 </font><font color="#FF0000"><b>If </b></font><font color="#000080">(</font>StrScan<font color="#000080">(</font>NamePtr<font color="#000080">,</font><font color="#800000">'?'</font><font color="#000080">)&lt;&gt;</font><font color="#FF0000"><b>Nil</b></font><font color="#000080">) </font><font color="#FF0000"><b>Or </b></font><font color="#000080">(</font>StrScan<font color="#000080">(</font>NamePtr<font color="#000080">,</font><font color="#800000">'*'</font><font color="#000080">)&lt;&gt;</font><font color="#FF0000"><b>Nil</b></font><font color="#000080">) </font><font color="#FF0000"><b>Then </b></font>Flags<font color="#000080">:=</font>fcWildcards<font color="#000080">;
 </font><font color="#FF0000"><b>If </b></font><font color="#000080">(</font>DirLen<font color="#000080">&lt;&gt;</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>Then </b></font>Flags<font color="#000080">:=</font>Flags <font color="#FF0000"><b>Or </b></font>fcDirectory<font color="#000080">;
 </font><font color="#FF0000"><b>If </b></font><font color="#000080">(</font>NameLen<font color="#000080">&lt;&gt;</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>Then </b></font>Flags<font color="#000080">:=</font>Flags <font color="#FF0000"><b>Or </b></font>fcFilename<font color="#000080">;
 </font><font color="#FF0000"><b>If </b></font><font color="#000080">(</font>ExtPtr<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">]&lt;&gt;</font><font color="#800000">#0</font><font color="#000080">) </font><font color="#FF0000"><b>Then </b></font>Flags<font color="#000080">:=</font>Flags <font color="#FF0000"><b>Or </b></font>fcExtension<font color="#000080">;
 </font><font color="#FF0000"><b>If </b></font><font color="#000080">(</font>Dir<font color="#000080">&lt;&gt;</font><font color="#FF0000"><b>Nil</b></font><font color="#000080">) </font><font color="#FF0000"><b>Then </b></font>StrLCopy<font color="#000080">(</font>Dir<font color="#000080">,</font>Path<font color="#000080">,</font>DirLen<font color="#000080">);
 </font><font color="#FF0000"><b>If </b></font><font color="#000080">(</font>Name<font color="#000080">&lt;&gt;</font><font color="#FF0000"><b>Nil</b></font><font color="#000080">) </font><font color="#FF0000"><b>Then </b></font>StrLCopy<font color="#000080">(</font>Name<font color="#000080">,</font>NamePtr<font color="#000080">,</font>NameLen<font color="#000080">);
 </font><font color="#FF0000"><b>If </b></font><font color="#000080">(</font>Ext<font color="#000080">&lt;&gt;</font><font color="#FF0000"><b>Nil</b></font><font color="#000080">) </font><font color="#FF0000"><b>Then </b></font>StrLCopy<font color="#000080">(</font>Ext<font color="#000080">,</font>ExtPtr<font color="#000080">,</font><font color="#800000">4</font><font color="#000080">);
 </font>FSplit<font color="#000080">:=</font>Flags<font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>FExpand<font color="#000080">(</font>Path<font color="#000080">,</font>Result<font color="#000080">: </font>PChar<font color="#000080">); </font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Asm
  </b></font><font color="#FF00FF">Push</font>	        <font color="#FF00FF">Ds
  Cld
  Lds</font>	        <font color="#FF00FF">Si,Path
  Push          Ds
  Push          Si
  Call          StrLen
  Mov           Cx,Ax
  Add</font>	        <font color="#FF00FF">Cx,Si
  Les</font>	        <font color="#FF00FF">Di,Result
  LodSw
  Cmp</font>	        <font color="#FF00FF">Si,Cx
  Ja</font>	       <font color="#FF00FF">@1
  Cmp</font>	        <font color="#FF00FF">Ah,':'                  </font><font color="#008000"><i>{If DriveLetter not present...}
  </i></font><font color="#FF00FF">Jne          @1                       </font><font color="#008000"><i>{use default drive}
  </i></font><font color="#FF00FF">Cmp           Al,'a'                  </font><font color="#008000"><i>{If DriveLetter below 'a'...}
  </i></font><font color="#FF00FF">Jb</font>	       <font color="#FF00FF">@2
  Cmp</font>	        <font color="#FF00FF">Al,'z'                  </font><font color="#008000"><i>{or above 'z'...}
  </i></font><font color="#FF00FF">Ja</font>	       <font color="#FF00FF">@2                       </font><font color="#008000"><i>{jump...}
  </i></font><font color="#FF00FF">Sub</font>	        <font color="#FF00FF">Al,20h                  </font><font color="#008000"><i>{or else make it uppercase...}
  </i></font><font color="#FF00FF">Jmp</font>	       <font color="#FF00FF">@2                       </font><font color="#008000"><i>{and jump}
 </i></font><font color="#FF00FF">@1:                                    </font><font color="#008000"><i>{Get current drive}
  </i></font><font color="#FF00FF">Dec</font>	        <font color="#FF00FF">Si
  Dec</font>	        <font color="#FF00FF">Si
  Mov</font>	        <font color="#FF00FF">Ah,19h
  Int</font>	        <font color="#FF00FF">21h
  Add</font>	        <font color="#FF00FF">Al,'A'
  Mov</font>	        <font color="#FF00FF">Ah,':'
 @2:
  StoSw                                 </font><font color="#008000"><i>{Write drive letter}
  </i></font><font color="#FF00FF">Cmp</font>	        <font color="#FF00FF">Si,Cx                   </font><font color="#008000"><i>{If source is only drive letter...}
  </i></font><font color="#FF00FF">Je</font>	       <font color="#FF00FF">@21                      </font><font color="#008000"><i>{jump...}
  </i></font><font color="#FF00FF">Cmp</font>	        <font color="#FF00FF">Byte Ptr [Si],'\'       </font><font color="#008000"><i>{if it includes path...}
  </i></font><font color="#FF00FF">Je</font>	       <font color="#FF00FF">@3                       </font><font color="#008000"><i>{jump}
 </i></font><font color="#FF00FF">@21:                                   </font><font color="#008000"><i>{Get current directory}
  </i></font><font color="#FF00FF">Sub</font>	        <font color="#FF00FF">Al,'A'-1
  Mov</font>	        <font color="#FF00FF">Dl,Al
  Mov</font>	        <font color="#FF00FF">Al,'\'
  StoSb
  Push</font>	        <font color="#FF00FF">Si
  Push</font>	        <font color="#FF00FF">Ds
  Mov</font>	        <font color="#FF00FF">Ax,7147h
  Mov</font>	        <font color="#FF00FF">Si,Di
  Push</font>	        <font color="#FF00FF">Es
  Pop</font>	        <font color="#FF00FF">Ds
  Int</font>	        <font color="#FF00FF">21h
  Pop</font>	        <font color="#FF00FF">Ds
  Pop</font>	        <font color="#FF00FF">Si
  Jc</font>	       <font color="#FF00FF">@3
  Cmp</font>	        <font color="#FF00FF">Byte Ptr Es:[Di],0
  Je</font>	       <font color="#FF00FF">@3
  Push</font>	        <font color="#FF00FF">Cx
  Mov</font>	        <font color="#FF00FF">Cx,-1
  Xor</font>	        <font color="#FF00FF">Al,Al
  RepNe</font>	        <font color="#FF00FF">ScaSb
  Dec</font>	        <font color="#FF00FF">Di
  Mov</font>	        <font color="#FF00FF">Al,'\'
  StoSb
  Pop</font>	        <font color="#FF00FF">Cx
 @3:
  Sub</font>   	<font color="#FF00FF">Cx,Si
  Rep</font>	        <font color="#FF00FF">MovSb
  Xor</font>	        <font color="#FF00FF">Al,Al
  StoSb
  Lds</font>	        <font color="#FF00FF">Si,Result
  Mov</font>	        <font color="#FF00FF">Di,Si
  Push</font>	        <font color="#FF00FF">Di
 @4:
  LodSb
  Or</font>	        <font color="#FF00FF">Al,Al
  Je</font>	       <font color="#FF00FF">@6
  Cmp</font>	        <font color="#FF00FF">Al,'\'
  Je</font>	       <font color="#FF00FF">@6
  Cmp</font>	        <font color="#FF00FF">Al,'a'
  Jb</font>	       <font color="#FF00FF">@5
  Cmp</font>	        <font color="#FF00FF">Al,'z'
  Ja</font>	       <font color="#FF00FF">@5
 @5:
  StoSb
  Jmp</font>	       <font color="#FF00FF">@4
 @6:
  Cmp</font>	        <font color="#FF00FF">Word Ptr [Di-2],'.\'
  Jne</font>	       <font color="#FF00FF">@7
  Dec</font>	        <font color="#FF00FF">Di
  Dec</font>	        <font color="#FF00FF">Di
  Jmp</font>	       <font color="#FF00FF">@9
 @7:
  Cmp</font>	        <font color="#FF00FF">Word Ptr [Di-2],'..'
  Jne</font>	       <font color="#FF00FF">@9
  Cmp</font>	        <font color="#FF00FF">Byte Ptr [Di-3],'\'
  Jne</font>	       <font color="#FF00FF">@9
  Sub</font>	        <font color="#FF00FF">Di,3
  Cmp</font>	        <font color="#FF00FF">Byte Ptr [Di-1],':'
  Je</font>	       <font color="#FF00FF">@9
 @8:
  Dec</font>	        <font color="#FF00FF">Di
  Cmp</font>	        <font color="#FF00FF">Byte Ptr [Di],'\'
  Jne</font>	       <font color="#FF00FF">@8
 @9:
  Or</font>	        <font color="#FF00FF">Al,Al
  Jne</font>	       <font color="#FF00FF">@5
  Cmp</font>	        <font color="#FF00FF">Byte Ptr [Di-1],':'
  Jne</font>	       <font color="#FF00FF">@10
  Mov</font>	        <font color="#FF00FF">Al,'\'
  StoSb
 @10:
  Xor           Al,Al
  StoSb
  Pop           Di
  Pop</font>	        <font color="#FF00FF">Ds
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>GetFileAttr<font color="#000080">(</font>FileName<font color="#000080">: </font>PChar<font color="#000080">): </font>TByte<font color="#000080">; </font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Asm
  </b></font><font color="#FF00FF">Push          Ds
  Mov           Ax,7143h
  Cmp           Using95,True
  Je           @Use95
  Mov           Ax,4300h
 @Use95:
  Xor           Bl,Bl
  Lds           Dx,FileName
  Int           21h
  Pop           Ds
  Jnc          @OK
  Mov           flError,Ax
  Mov           isError,True
  Xor           Ax,Ax
  Jmp          @</font><font color="#FF0000"><b>End
 </b></font><font color="#000080">@</font>OK<font color="#000080">:
  </font>Mov           Ax<font color="#000080">,</font>Cx
 <font color="#000080">@</font><font color="#FF0000"><b>End</b></font><font color="#000080">:
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>SetFileAttr<font color="#000080">(</font>FileName<font color="#000080">: </font>PChar<font color="#000080">; </font>Attr<font color="#000080">: </font>TByte<font color="#000080">); </font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Asm
  </b></font><font color="#FF00FF">Push          Ds
  Mov           Ax,7143h
  Cmp           Using95,True
  Je           @Use95
  Mov           Ax,4301h
 @Use95:
  Mov           Bl,01h
  Mov           Cl,Byte Ptr Attr
  Xor           Ch,Ch
  Lds           Dx,FileName
  Int           21h
  Pop           Ds
  Jnc          @</font><font color="#FF0000"><b>End
  </b></font>Mov           flError<font color="#000080">,</font>Ax
  Mov           isError<font color="#000080">,</font>True
 <font color="#000080">@</font><font color="#FF0000"><b>End</b></font><font color="#000080">:
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>TrueName<font color="#000080">(</font>FileName<font color="#000080">,</font>TrueFileName<font color="#000080">: </font>PChar<font color="#000080">); </font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Asm
  </b></font><font color="#FF00FF">Push          Ds
  Mov           Ax,7160h
  Cmp           Using95,True
  Je           @Use95
  Mov           Ax,6000h
 @Use95:
  Mov           Cx,0002h
  Lds           Si,FileName
  Les           Di,TrueFileName
  Int           21h
  Pop           Ds
  Jnc          @</font><font color="#FF0000"><b>End
  </b></font>Mov           flError<font color="#000080">,</font>Ax
  Mov           isError<font color="#000080">,</font>True
 <font color="#000080">@</font><font color="#FF0000"><b>End</b></font><font color="#000080">:
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>ShortName<font color="#000080">(</font>FileName<font color="#000080">,</font>ShortFileName<font color="#000080">: </font>PChar<font color="#000080">); </font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Asm
  </b></font><font color="#FF00FF">Push          Ds
  Cmp           Using95,True
  Jne          @</font><font color="#FF0000"><b>End
  </b></font>Mov           Ax<font color="#000080">,</font><font color="#800000">7160</font>h
  Mov           Cx<font color="#000080">,</font><font color="#800000">0001</font>h
  Lds           Si<font color="#000080">,</font>FileName
  Les           Di<font color="#000080">,</font>ShortFileName
  Int           <font color="#800000">21</font>h
  Pop           Ds
  Jnc          <font color="#000080">@</font><font color="#FF0000"><b>End
  </b></font>Mov           flError<font color="#000080">,</font>Ax
  Mov           isError<font color="#000080">,</font>True
 <font color="#000080">@</font><font color="#FF0000"><b>End</b></font><font color="#000080">:
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>LongToShort<font color="#000080">(</font>FileName<font color="#000080">,</font>ShortFileName<font color="#000080">: </font>PChar<font color="#000080">); </font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Asm
  </b></font><font color="#FF00FF">Cld
  Push          Ds
  Mov           Ax,71A8h
  Cmp           Using95,True
  Jne          @</font><font color="#FF0000"><b>End
  </b></font>Lds           Si<font color="#000080">,</font>FileName
  Les           Di<font color="#000080">,</font>ShortFileName
  <font color="#FF0000"><b>Xor           </b></font>Dx<font color="#000080">,</font>Dx
  Int           <font color="#800000">21</font>h
  Pop           Ds
  Jnc          <font color="#000080">@</font><font color="#FF0000"><b>End
  </b></font>Mov           flError<font color="#000080">,</font>Ax
  Mov           isError<font color="#000080">,</font>True
 <font color="#000080">@</font><font color="#FF0000"><b>End</b></font><font color="#000080">:
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>Delete<font color="#000080">(</font>FileName<font color="#000080">: </font>PChar<font color="#000080">); </font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Asm
  </b></font><font color="#FF00FF">Push          Ds
  Mov           Ax,7141h
  Cmp           Using95,True
  Je           @Use95
  Mov           Ax,4100h
 @Use95:
  Lds           Dx,FileName
  Mov           Si,0001h
  Mov           Cl,Byte Ptr DeleteAttr
  Xor           Ch,Ch
  Int           21h
  Pop           Ds
  Jnc          @</font><font color="#FF0000"><b>End
  </b></font>Mov           flError<font color="#000080">,</font>Ax
  Mov           isError<font color="#000080">,</font>True
 <font color="#000080">@</font><font color="#FF0000"><b>End</b></font><font color="#000080">:
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>Rename<font color="#000080">(</font>FileName<font color="#000080">,</font>NewName<font color="#000080">: </font>PChar<font color="#000080">); </font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Asm
  </b></font><font color="#FF00FF">Push          Ds
  Mov           Ax,7156h
  Cmp           Using95,True
  Je           @Use95
  Mov           Ax,5600h
 @Use95:
  Lds           Dx,FileName
  Les           Di,NewName
  Int           21h
  Pop           Ds
  Jnc          @</font><font color="#FF0000"><b>End
  </b></font>Mov           flError<font color="#000080">,</font>Ax
  Mov           isError<font color="#000080">,</font>True
 <font color="#000080">@</font><font color="#FF0000"><b>End</b></font><font color="#000080">:
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>Close<font color="#000080">(</font>Handle<font color="#000080">: </font>THandle<font color="#000080">); </font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Asm
  </b></font><font color="#FF00FF">Mov           Ah,3Eh
  Mov           Bx,Word Ptr Handle
  Int           21h
  Jnc          @</font><font color="#FF0000"><b>End
  </b></font>Mov           flError<font color="#000080">,</font>Ax
  Mov           isError<font color="#000080">,</font>True
 <font color="#000080">@</font><font color="#FF0000"><b>End</b></font><font color="#000080">:
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>Truncate<font color="#000080">(</font>Handle<font color="#000080">: </font>THandle<font color="#000080">); </font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Asm
  </b></font><font color="#FF00FF">Push          Ds
  Mov           Ah,40h
  Mov           Bx,Word Ptr Handle
  Xor           Cx,Cx
  Int           21h
  Pop           Ds
  Jnc          @</font><font color="#FF0000"><b>End
  </b></font>Mov           flError<font color="#000080">,</font>Ax
  Mov           isError<font color="#000080">,</font>True
 <font color="#000080">@</font><font color="#FF0000"><b>End</b></font><font color="#000080">:
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>Commit<font color="#000080">(</font>Handle<font color="#000080">: </font>THandle<font color="#000080">); </font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Asm
  </b></font><font color="#FF00FF">Mov           Ah,68h
  Mov           Bx,Word Ptr Handle
  Int           21h
  Jnc          @</font><font color="#FF0000"><b>End
  </b></font>Mov           flError<font color="#000080">,</font>Ax
  Mov           isError<font color="#000080">,</font>True
 <font color="#000080">@</font><font color="#FF0000"><b>End</b></font><font color="#000080">:
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>BlockRead<font color="#000080">(</font>Handle<font color="#000080">: </font>THandle<font color="#000080">; </font><font color="#FF0000"><b>Var </b></font>Buff<font color="#000080">; </font>Count<font color="#000080">: </font>TWord<font color="#000080">): </font>TWord<font color="#000080">; </font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Asm
  </b></font><font color="#FF00FF">Push          Ds
  Mov           Ah,3Fh
  Mov           Bx,Word Ptr Handle
  Mov           Cx,Count
  Jcxz         @</font><font color="#FF0000"><b>End
  </b></font>Lds           Dx<font color="#000080">,</font>Buff
  Int           <font color="#800000">21</font>h
  Pop           Ds
  Jnc          <font color="#000080">@</font><font color="#FF0000"><b>End
  </b></font>Mov           flError<font color="#000080">,</font>Ax
  Mov           isError<font color="#000080">,</font>True
  <font color="#FF0000"><b>Xor           </b></font>Ax<font color="#000080">,</font>Ax
 <font color="#000080">@</font><font color="#FF0000"><b>End</b></font><font color="#000080">:
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>BlockWrite<font color="#000080">(</font>Handle<font color="#000080">: </font>THandle<font color="#000080">; </font><font color="#FF0000"><b>Var </b></font>Buff<font color="#000080">; </font>Count<font color="#000080">: </font>TWord<font color="#000080">): </font>TWord<font color="#000080">; </font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Asm
  </b></font><font color="#FF00FF">Push          Ds
  Mov           Ah,40h
  Mov           Bx,Word Ptr Handle
  Mov           Cx,Count
  Jcxz         @</font><font color="#FF0000"><b>End
  </b></font>Lds           Dx<font color="#000080">,</font>Buff
  Int           <font color="#800000">21</font>h
  Pop           Ds
  Jnc          <font color="#000080">@</font><font color="#FF0000"><b>End
  </b></font>Mov           flError<font color="#000080">,</font>Ax
  Mov           isError<font color="#000080">,</font>True
  <font color="#FF0000"><b>Xor           </b></font>Ax<font color="#000080">,</font>Ax
 <font color="#000080">@</font><font color="#FF0000"><b>End</b></font><font color="#000080">:
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>LockDrive<font color="#000080">(</font>Drive<font color="#000080">: </font>TChar<font color="#000080">); </font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Asm
  </b></font><font color="#FF00FF">Mov           Ax,440Dh
  Mov           Cx,084Ah
  Mov           Bl,Drive
  Sub           Bl,'@'
  Mov           Bh,Byte Ptr LockLevel
  Mov           Dx,0000000000000001b
  Int           21h
  Jnc          @</font><font color="#FF0000"><b>End
  </b></font>Mov           flError<font color="#000080">,</font>Ax
  Mov           isError<font color="#000080">,</font>True
 <font color="#000080">@</font><font color="#FF0000"><b>End</b></font><font color="#000080">:
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>UnlockDrive<font color="#000080">(</font>Drive<font color="#000080">: </font>TChar<font color="#000080">); </font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Asm
  </b></font><font color="#FF00FF">Mov           Ax,440Dh
  Mov           Cx,086Ah
  Mov           Bl,Drive
  Sub           Bl,'@'
  Int           21h
  Jnc          @</font><font color="#FF0000"><b>End
  </b></font>Mov           flError<font color="#000080">,</font>Ax
  Mov           isError<font color="#000080">,</font>True
 <font color="#000080">@</font><font color="#FF0000"><b>End</b></font><font color="#000080">:
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>ChangeDrive<font color="#000080">(</font>Drive<font color="#000080">: </font>TChar<font color="#000080">); </font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Asm
  </b></font><font color="#FF00FF">Mov           Ah,0Eh
  Mov           Dl,Byte Ptr Drive
  Sub           Dl,'A'
  Int           21h
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>CurrentDrive<font color="#000080">: </font>TChar<font color="#000080">; </font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Asm
  </b></font><font color="#FF00FF">Mov           Ah,19h
  Int           21h
  Add           Al,'A'
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>EnableDrive<font color="#000080">(</font>Drive<font color="#000080">: </font>TChar<font color="#000080">); </font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Asm
  </b></font><font color="#FF00FF">Mov           Ax,5F07h
  Mov           Dl,Byte Ptr Drive
  Sub           Dl,'A'
  Int           21h
  Jnc          @</font><font color="#FF0000"><b>End
  </b></font>Mov           flError<font color="#000080">,</font>Ax
  Mov           isError<font color="#000080">,</font>True
  <font color="#FF0000"><b>Xor           </b></font>Ax<font color="#000080">,</font>Ax
 <font color="#000080">@</font><font color="#FF0000"><b>End</b></font><font color="#000080">:
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>DisableDrive<font color="#000080">(</font>Drive<font color="#000080">: </font>TChar<font color="#000080">); </font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Asm
  </b></font><font color="#FF00FF">Mov           Ax,5F08h
  Mov           Dl,Byte Ptr Drive
  Sub           Dl,'A'
  Int           21h
  Jnc          @</font><font color="#FF0000"><b>End
  </b></font>Mov           flError<font color="#000080">,</font>Ax
  Mov           isError<font color="#000080">,</font>True
  <font color="#FF0000"><b>Xor           </b></font>Ax<font color="#000080">,</font>Ax
 <font color="#000080">@</font><font color="#FF0000"><b>End</b></font><font color="#000080">:
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>FindFirst95<font color="#000080">(</font>FileSpec<font color="#000080">: </font>PChar<font color="#000080">; </font>Attr<font color="#000080">: </font>TByte<font color="#000080">; </font><font color="#FF0000"><b>Var </b></font>Search<font color="#000080">: </font>TSearch95<font color="#000080">); </font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Asm
  </b></font><font color="#FF00FF">Push          Ds
  Mov           Ax,714Eh
  Xor           Si,Si
  Xor           Ch,Ch
  Mov           Cl,Attr
  Lds           Dx,FileSpec
  Les           Di,Search
  Inc           Di
  Inc           Di
  Int           21h
  Dec           Di
  Dec           Di
  StoSw
  Pop           Ds
  Jnc          @</font><font color="#FF0000"><b>End
  </b></font>Mov           flError<font color="#000080">,</font>Ax
  Mov           isError<font color="#000080">,</font>True
 <font color="#000080">@</font><font color="#FF0000"><b>End</b></font><font color="#000080">:
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>FindNext95<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>Search<font color="#000080">: </font>TSearch95<font color="#000080">); </font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Asm
  </b></font><font color="#FF00FF">Push          Ds
  Lds           Si,Search
  LodSw
  Mov           Bx,Ax
  Mov           Ax,714Fh
  Xor           Si,Si
  Les           Di,Search
  Inc           Di
  Inc           Di
  Int           21h
  Pop           Ds
  Jnc          @</font><font color="#FF0000"><b>End
  </b></font>Mov           flError<font color="#000080">,</font>Ax
  Mov           isError<font color="#000080">,</font>True
 <font color="#000080">@</font><font color="#FF0000"><b>End</b></font><font color="#000080">:
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>FindClose95<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>Search<font color="#000080">: </font>TSearch95<font color="#000080">); </font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Asm
  </b></font><font color="#FF00FF">Push          Ds
  Lds           Si,Search
  LodSw
  Mov           Bx,Ax
  Mov           Ax,71A1h
  Int           21h
  Pop           Ds
  Jnc          @</font><font color="#FF0000"><b>End
  </b></font>Mov           flError<font color="#000080">,</font>Ax
  Mov           isError<font color="#000080">,</font>True
 <font color="#000080">@</font><font color="#FF0000"><b>End</b></font><font color="#000080">:
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>FindFirst<font color="#000080">(</font>FileSpec<font color="#000080">: </font>PChar<font color="#000080">; </font>Attr<font color="#000080">: </font>TWord<font color="#000080">; </font><font color="#FF0000"><b>Var </b></font>Search<font color="#000080">: </font>TSearch<font color="#000080">); </font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Asm
  </b></font><font color="#FF00FF">Push          Ds
  Mov           Ah,4Eh
  Mov           Cx,Attr
  Lds           Dx,FileSpec
  Int           21h
  Jnc          @Transfer
  Mov           flError,Ax
  Mov           isError,True
  Jmp          @</font><font color="#FF0000"><b>End
 </b></font><font color="#000080">@</font>Transfer<font color="#000080">:
  </font>Les           Si<font color="#000080">,</font>DTA
  Push          Es
  Push          Si
  Les           Si<font color="#000080">,</font>Search
  Push          Es
  Push          Si
  Push          <font color="#800000">43
  </font>Call          Move32
 <font color="#000080">@</font><font color="#FF0000"><b>End</b></font><font color="#000080">:
  </font>Pop           Ds
<font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>FindNext<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>Search<font color="#000080">: </font>TSearch<font color="#000080">); </font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Asm
  </b></font><font color="#FF00FF">Push          Ds
  Les           Si,Search
  Push          Es
  Push          Si
  Les           Si,DTA
  Push          Es
  Push          Si
  Push          43
  Call          Move32
  Mov           Ah,4Fh
  Int           21h
  Jnc          @Transfer
  Mov           flError,Ax
  Mov           isError,True
  Jmp          @</font><font color="#FF0000"><b>End
 </b></font><font color="#000080">@</font>Transfer<font color="#000080">:
  </font>Les           Si<font color="#000080">,</font>DTA
  Push          Es
  Push          Si
  Les           Si<font color="#000080">,</font>Search
  Push          Es
  Push          Si
  Push          <font color="#800000">43
  </font>Call          Move32
 <font color="#000080">@</font><font color="#FF0000"><b>End</b></font><font color="#000080">:
  </font>Pop           Ds
<font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>Halt<font color="#000080">(</font>ErrorLevel<font color="#000080">: </font>TByte<font color="#000080">); </font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Asm
  </b></font><font color="#FF00FF">Mov           Ah,4Ch
  Mov           Al,Byte Ptr ErrorLevel
  Int           21h
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>Exec<font color="#000080">(</font>Prog<font color="#000080">,</font>Params<font color="#000080">: </font>PChar<font color="#000080">); </font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;
</font><font color="#008000"><i>{For some reason, you need to add a space before the Params
 string. For example:

 To run:
   C:\COMMAND.COM /C DIR C:\
 The variables need to be like this:
   Prog:='C:\COMMAND.COM';
   Params:=' /C DIR C:\';   {Notice the space before the /C}

</i></font><font color="#FF0000"><b>Var </b></font>ShortFileName<font color="#000080">: </font>PChar<font color="#000080">;
</font><font color="#FF0000"><b>Asm
  </b></font><font color="#FF00FF">Push          Ds
</font><font color="#008000"><i>{Building ParameterBlock}
  </i></font><font color="#FF00FF">Cld
  Les           Di,ParameterBlock
  Lds           Si,Params
  Inc           Di
  Inc           Di
  Mov           Ax,Si
  StoSw
  Mov           Ax,Ds
  StoSw
  Db            86h,0D0h,90h,86h,0C2h,86h,0C9h
  Pop           Ds
  Push          Ds
  Cmp           Using95,True
  Je           @Use95
  Lds           Dx,Prog
  Jmp          @OK
 @Use95:
</font><font color="#008000"><i>{Getting short filename}
  </i></font><font color="#FF00FF">Mov           Ax,7160h
  Mov           Cx,0001h
  Lds           Si,Prog
  Les           Di,ShortFileName
  Int           21h
  Lds           Dx,ShortFileName
  Jc           @</font><font color="#FF0000"><b>End
</b></font><font color="#008000"><i>{Executing}
 </i></font><font color="#000080">@</font>OK<font color="#000080">:
  </font>Les           Bx<font color="#000080">,</font>ParameterBlock
  Mov           Ah<font color="#000080">,</font><font color="#800000">4</font>Bh
  <font color="#FF0000"><b>Xor           </b></font>Al<font color="#000080">,</font>Al
  Int           <font color="#800000">21</font>h
 <font color="#000080">@</font><font color="#FF0000"><b>End</b></font><font color="#000080">:
  </font>Pop           Ds
<font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>SetDTA<font color="#000080">(</font>Address<font color="#000080">: </font>Pointer<font color="#000080">); </font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Asm
  </b></font><font color="#FF00FF">Push          Ds
  Mov           Ah,1Ah
  Lds           Dx,Address
  Int           21h
  Pop           Ds
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>GetDTA<font color="#000080">: </font>Pointer<font color="#000080">; </font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Asm
  </b></font><font color="#FF00FF">Mov           Ah,2Fh
  Int           21h
  Mov           Dx,Es
  Mov           Ax,Bx
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>DriveInformation<font color="#000080">(</font>Drive<font color="#000080">: </font>TChar<font color="#000080">; </font><font color="#FF0000"><b>Var </b></font>DriveType<font color="#000080">: </font>TByte<font color="#000080">; </font>Volume<font color="#000080">: </font>TPointer<font color="#000080">; </font><font color="#FF0000"><b>Var </b></font>Serial<font color="#000080">,</font>TotalSpace<font color="#000080">,</font>FreeSpace<font color="#000080">,
                           </font>ClusterSize<font color="#000080">: </font>TDouble<font color="#000080">): </font>TBoolean<font color="#000080">; </font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Asm
  </b></font><font color="#FF00FF">Push          Ds
  Mov           Ax,440Dh
  Mov           Bl,Drive
  Sub           Bl,64
  Mov           Cx,0860h
  Lds           Dx,ParameterBlock
  Int           21h
  Mov           Al,1
  Jnc          @Continue
  Xor           Al,Al
  Jmp          @Error
 @Continue:
  Mov           Si,Dx
  Inc           Si
  LodSb
  Les           Di,DriveType
  StoSb
  Pop           Ds
  Push          Ds
  Les           Di,ParameterBlock
  Xor           Ax,Ax
  StoSw
  Lds           Dx,ParameterBlock
  Mov           Ax,440Dh
  Mov           Bl,Drive
  Sub           Bl,64
  Mov           Cx,0866h
  Int           21h
  Mov           Si,Dx
  Inc           Si
  Inc           Si
  Les           Di,Serial
  Dw            0A566h
  Les           Di,Volume
  Dw            0A566h
  Dw            0A566h
  MovSw
  MovSb
  Mov           Ah,36h
  Mov           Dl,Drive
  Sub           Dl,64
  Int           21h
  Push          Dx
  Push          Ax
  Mul           Cx
  Les           Di,ClusterSize
  StoSw
  Mov           Ax,Dx
  StoSw
  Pop           Ax
  Push          Ax
  Mul           Cx
  Mul           Bx
  Les           Di,FreeSpace
  StoSw
  Mov           Ax,Dx
  StoSw
  Pop           Ax
  Pop           Dx
  Mov           Bx,Dx
  Mul           Cx
  Mul           Bx
  Les           Di,TotalSpace
  StoSw
  Mov           Ax,Dx
  StoSw
  Mov           Al,1
 @Error:
  Pop           Ds
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>DiskFree<font color="#000080">(</font>Drive<font color="#000080">: </font>TChar<font color="#000080">): </font>TDouble<font color="#000080">; </font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Asm
  </b></font><font color="#FF00FF">Mov           Ah,36h
  Mov           Dl,Drive
  Sub           Dl,64
  Int           21h
  Cmp           Ax,0FFFFh
  Je           @Error
  Mul           Cx
  Mul           Bx
  Jmp          @</font><font color="#FF0000"><b>End
 </b></font><font color="#000080">@</font>Error<font color="#000080">:
  </font>Mov           Dx<font color="#000080">,</font>Ax
 <font color="#000080">@</font><font color="#FF0000"><b>End</b></font><font color="#000080">:
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>DiskSize<font color="#000080">(</font>Drive<font color="#000080">: </font>TChar<font color="#000080">): </font>TDouble<font color="#000080">; </font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Asm
  </b></font><font color="#FF00FF">Mov           Ah,36h
  Mov           Dl,Drive
  Sub           Dl,64
  Int           21h
  Cmp           Ax,0FFFFh
  Je           @Error
  Mul           Cx
  Mul           Dx
  Jmp          @</font><font color="#FF0000"><b>End
 </b></font><font color="#000080">@</font>Error<font color="#000080">:
  </font>Mov           Dx<font color="#000080">,</font>Ax
 <font color="#000080">@</font><font color="#FF0000"><b>End</b></font><font color="#000080">:
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>ResetDrive<font color="#000080">(</font>Drive<font color="#000080">: </font>TChar<font color="#000080">); </font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Asm
  </b></font><font color="#FF00FF">Mov           Ax,710Dh
  Cmp           Using95,True
  Je           @Use95
  Mov           Ax,0D00h
 @Use95:
  Mov           Cx,01h
  Xor           Dh,Dh
  Mov           Dl,Drive
  Sub           Dx,65
  Int           21h
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>TurnLedOn<font color="#000080">(</font>Drive<font color="#000080">: </font>TChar<font color="#000080">); </font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Asm
  </b></font><font color="#FF00FF">Mov           Al,Drive
  Sub           Al,65
  Mov           Cl,Al
  Add           Cl,4
  Mov           Ah,1
  ShL           Ah,Cl
  Add           Al,Ah
  Add           Al,12
  Mov           Dx,03F2h
  Out           Dx,Al
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>TurnLedOff<font color="#000080">(</font>Drive<font color="#000080">: </font>TChar<font color="#000080">); </font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Asm
  </b></font><font color="#FF00FF">Mov           Al,Drive
  Sub           Al,53
  Mov           Dx,03F2h
  Out           Dx,Al
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;


</font><font color="#FF0000"><b>Begin
 </b></font>CreateAttr<font color="#000080">:=</font>faArchive<font color="#000080">;
 </font>FindAttr<font color="#000080">:=</font>faArchive <font color="#FF0000"><b>Or </b></font>faReadOnly<font color="#000080">;
 </font>CopyAttr<font color="#000080">:=</font>faArchive <font color="#FF0000"><b>Or </b></font>faReadOnly<font color="#000080">;
 </font>DeleteAttr<font color="#000080">:=</font>faArchive<font color="#000080">;
 </font>FileMode<font color="#000080">:=</font>fmReadWrite<font color="#000080">;
 </font>FillChar<font color="#000080">(</font>Block<font color="#000080">,</font><font color="#800000">40</font><font color="#000080">,</font><font color="#800000">$00</font><font color="#000080">);
 </font>ParameterBlock<font color="#000080">:=@</font>Block<font color="#000080">;
 </font>LockLevel<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
 </font>Using95<font color="#000080">:=(</font>Task<font color="#000080">.</font>OS<font color="#000080">=</font>osWin95<font color="#000080">);
 </font>DTA<font color="#000080">:=</font>GetDTA<font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">.

</font><font color="#008000"><i>(* UMulti - multitasker support unit *)
(*        Compile this first         *)
(* UMulti - multitasker support unit *)
(*        Compile this first         *)
(* UMulti - multitasker support unit *)
(*        Compile this first         *)
(* UMulti - multitasker support unit *)
(*        Compile this first         *)
(* UMulti - multitasker support unit *)
(*        Compile this first         *)
(* UMulti - multitasker support unit *)
(*        Compile this first         *)
(* UMulti - multitasker support unit *)
(*        Compile this first         *)
(* UMulti - multitasker support unit *)
(*        Compile this first         *)
(* UMulti - multitasker support unit *)
(*        Compile this first         *)
(* UMulti - multitasker support unit *)
(*        Compile this first         *)

</i></font><font color="#FF0000"><b>Unit </b></font>UMulti<font color="#000080">;

</font><font color="#FF0000"><b>Interface uses </b></font>UGlobal<font color="#000080">;

</font><font color="#FF0000"><b>Const </b></font>Tasker<font color="#000080">: </font><font color="#FF0000"><b>Array </b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">10</font><font color="#000080">] </font><font color="#FF0000"><b>Of String</b></font><font color="#000080">[</font><font color="#800000">9</font><font color="#000080">] = (</font><font color="#800000">'DOS'</font><font color="#000080">,</font><font color="#800000">'Windows ''95'</font><font color="#000080">,</font><font color="#800000">'Windows'</font><font color="#000080">,</font><font color="#800000">'OS/2'</font><font color="#000080">,</font><font color="#800000">'DesqView'</font><font color="#000080">,</font><font color="#800000">'TopView'</font><font color="#000080">,</font><font color="#800000">'DoubleDos'</font><font color="#000080">,
                                            </font><font color="#800000">'NetWare'</font><font color="#000080">,</font><font color="#800000">'MultiLink'</font><font color="#000080">,</font><font color="#800000">'CSwitch'</font><font color="#000080">,</font><font color="#800000">'EuroDOS'</font><font color="#000080">);

</font><font color="#FF0000"><b>Const </b></font>osDOS <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">;
      </font>osWin95 <font color="#000080">= </font><font color="#800000">1</font><font color="#000080">;
      </font>osWindows <font color="#000080">= </font><font color="#800000">2</font><font color="#000080">;
      </font>osOS2 <font color="#000080">= </font><font color="#800000">3</font><font color="#000080">;
      </font>osDesqView <font color="#000080">= </font><font color="#800000">4</font><font color="#000080">;
      </font>osTopView <font color="#000080">= </font><font color="#800000">5</font><font color="#000080">;
      </font>osDoubleDos <font color="#000080">= </font><font color="#800000">6</font><font color="#000080">;
      </font>osNetWare <font color="#000080">= </font><font color="#800000">7</font><font color="#000080">;
      </font>osMultiLink <font color="#000080">= </font><font color="#800000">8</font><font color="#000080">;
      </font>osCSwitch <font color="#000080">= </font><font color="#800000">9</font><font color="#000080">;
      </font>osEuroDOS <font color="#000080">= </font><font color="#800000">10</font><font color="#000080">;

</font><font color="#FF0000"><b>Type </b></font>TaskRec <font color="#000080">= </font><font color="#FF0000"><b>Record
      </b></font>OS<font color="#000080">: </font>Word<font color="#000080">;
      </font>Version<font color="#000080">: </font>Word<font color="#000080">;
      </font>Delay<font color="#000080">: </font>Word<font color="#000080">;
     </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Const </b></font>Task<font color="#000080">: </font>TaskRec <font color="#000080">= (</font>OS<font color="#000080">: </font><font color="#800000">0</font><font color="#000080">;
                       </font>Version<font color="#000080">: </font><font color="#800000">0</font><font color="#000080">;
                       </font>Delay<font color="#000080">: </font><font color="#800000">100</font><font color="#000080">);

</font><font color="#008000"><i>{ Call  GiveTimeSlice  to release CPU cycles to the multitasker. }

{ Polling  could be use as procedure to be used inside ReadKey procedures
  to read the clock, update the screen, and release CPU cycles. Polling is
  at startup the same as GiveTimeSlice }

</i></font><font color="#FF0000"><b>Var </b></font>GiveTimeSlice<font color="#000080">,
    </font>Polling<font color="#000080">: </font>TProc<font color="#000080">;

</font><font color="#008000"><i>{ AssignProcs  is called automatically by the startup procedure Init }
</i></font><font color="#FF0000"><b>Procedure </b></font>AssignProcs<font color="#000080">;

</font><font color="#008000"><i>{ ReleaseTime is a macro procedure which takes only 7 bytes, and releases
  DOS, Windows, Windows '95, and OS/2 timeslices }
</i></font><font color="#FF0000"><b>Procedure </b></font>ReleaseTime<font color="#000080">; </font><font color="#FF0000"><b>Inline</b></font><font color="#000080">(</font><font color="#800000">$CD</font><font color="#000080">/</font><font color="#800000">$28</font><font color="#000080">/</font><font color="#800000">$B8</font><font color="#000080">/</font><font color="#800000">$80</font><font color="#000080">/</font><font color="#800000">$16</font><font color="#000080">/</font><font color="#800000">$CD</font><font color="#000080">/</font><font color="#800000">$2F</font><font color="#000080">);

</font><font color="#FF0000"><b>Implementation

</b></font><font color="#008000"><i>{$F+}
</i></font><font color="#FF0000"><b>Procedure </b></font>NetWare_GTS<font color="#000080">; </font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Asm
  </b></font><font color="#FF00FF">Mov           Bx,000Ah
  Int           7Ah
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>DoubleDOS_GTS<font color="#000080">; </font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Asm
  </b></font><font color="#FF00FF">Mov           Ax,0EE02h
  Int           21h
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>Windows_Win95_OS2_GTS<font color="#000080">; </font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Asm
  </b></font><font color="#FF00FF">Mov           Ax,1680h
  Int           2Fh
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>DesqView_TopView_GTS<font color="#000080">; </font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Asm
  </b></font><font color="#FF00FF">Mov           Ax,1000h
  Int           15h
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>DOS_GTS<font color="#000080">; </font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Asm
  </b></font><font color="#FF00FF">Int           28h
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>MultiLink_GTS<font color="#000080">; </font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Asm
  </b></font><font color="#FF00FF">Mov           Ah,02h
  Int           7Fh
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>CSwitch_GTS<font color="#000080">; </font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Asm
  </b></font><font color="#FF00FF">Mov           Ah,01h
  Int           62h
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>EuroDOS_GTS<font color="#000080">; </font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Asm
  </b></font><font color="#FF00FF">Mov           Ah,89h
  Xor           Cx,Cx
  Int           21h
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;
</font><font color="#008000"><i>{$F-}

</i></font><font color="#FF0000"><b>Procedure </b></font>AssignProcs<font color="#000080">;
</font><font color="#FF0000"><b>Begin
 Case </b></font>Task<font color="#000080">.</font>OS <font color="#FF0000"><b>Of
  </b></font>osDos<font color="#000080">: </font>GiveTimeSlice<font color="#000080">:=</font>DOS_GTS<font color="#000080">;
  </font>osWin95<font color="#000080">: </font>GiveTimeSlice<font color="#000080">:=</font>Windows_Win95_OS2_GTS<font color="#000080">;
  </font>osWindows<font color="#000080">: </font>GiveTimeSlice<font color="#000080">:=</font>Windows_Win95_OS2_GTS<font color="#000080">;
  </font>osOS2<font color="#000080">: </font>GiveTimeSlice<font color="#000080">:=</font>Windows_Win95_OS2_GTS<font color="#000080">;
  </font>osDesqView<font color="#000080">: </font>GiveTimeSlice<font color="#000080">:=</font>DesqView_TopView_GTS<font color="#000080">;
  </font>osTopView<font color="#000080">: </font>GiveTimeSlice<font color="#000080">:=</font>DesqView_TopView_GTS<font color="#000080">;
  </font>osDoubleDos<font color="#000080">: </font>GiveTimeSlice<font color="#000080">:=</font>DoubleDOS_GTS<font color="#000080">;
  </font>osNetWare<font color="#000080">: </font>GiveTimeSlice<font color="#000080">:=</font>NetWare_GTS<font color="#000080">;
  </font>osMultiLink<font color="#000080">: </font>GiveTimeSlice<font color="#000080">:=</font>MultiLink_GTS<font color="#000080">;
  </font>osCSwitch<font color="#000080">: </font>GiveTimeSlice<font color="#000080">:=</font>CSwitch_GTS<font color="#000080">;
  </font>osEuroDOS<font color="#000080">: </font>GiveTimeSlice<font color="#000080">:=</font>EuroDOS_GTS<font color="#000080">;
 </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>Init<font color="#000080">; </font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Asm
  </b></font><font color="#FF00FF">Mov           Task.OS,00h
  Mov           Task.Version,00h
  Mov           Ah,87h
  Xor           Al,Al
  Int           21h
  Cmp           Al,0
  Jne          @EuroDOS
  Mov           Ah,30h
  Mov           Al,01h
  Int           21h
  Cmp           Al,14h
  Je           @OS2
  Mov           Ax,160Ah
  Int           2Fh
  Cmp           Ax,00h
  Je           @Windows
  Mov           Ax,1022h
  Mov           Bx,0000h
  Int           15h
  Cmp           Bx,00h
  Jne          @DesqView
  Mov           Ah,2Bh
  Mov           Al,01h
  Mov           Cx,4445h
  Mov           Dx,5351h
  Int           21h
  Cmp           Al,0FFh
  Jne          @TopView
  Mov           Ax,0E400h
  Int           21h
  Cmp           Al,00h
  Jne          @DoubleDos
  Mov           Ax,7A00h
  Int           2Fh
  Cmp           Al,0FFh
  Je           @NetWare
  Jmp          @</font><font color="#FF0000"><b>End
 </b></font><font color="#000080">@</font>Windows<font color="#000080">:
  </font>Cmp           Bh<font color="#000080">,</font><font color="#800000">04</font>h
  Jne          <font color="#000080">@</font>Win3
  Mov           Task<font color="#000080">.</font>OS<font color="#000080">,</font><font color="#800000">01</font>h
  Jmp          <font color="#000080">@</font>Windows_OK
 <font color="#000080">@</font>Win3<font color="#000080">:
  </font>Mov           Task<font color="#000080">.</font>OS<font color="#000080">,</font><font color="#800000">02</font>h
 <font color="#000080">@</font>Windows_OK<font color="#000080">:
  </font>Mov           Task<font color="#000080">.</font>Version<font color="#000080">,</font>Bx
  Jmp          <font color="#000080">@</font><font color="#FF0000"><b>End
 </b></font><font color="#000080">@</font>OS2<font color="#000080">:
  </font>Mov           Task<font color="#000080">.</font>OS<font color="#000080">,</font><font color="#800000">03</font>h
  Mov           Bh<font color="#000080">,</font>Ah
  <font color="#FF0000"><b>Xor           </b></font>Ah<font color="#000080">,</font>Ah
  Mov           Cl<font color="#000080">,</font><font color="#800000">0</font>Ah
  <font color="#FF0000"><b>Div           </b></font>Cl
  Mov           Ah<font color="#000080">,</font>Bh
  XChg          Ah<font color="#000080">,</font>Al
  Mov           Task<font color="#000080">.</font>Version<font color="#000080">,</font>Ax
  Jmp          <font color="#000080">@</font><font color="#FF0000"><b>End
 </b></font><font color="#000080">@</font>DesqView<font color="#000080">:
  </font>Mov           Task<font color="#000080">.</font>OS<font color="#000080">,</font><font color="#800000">04</font>h
  Jmp          <font color="#000080">@</font><font color="#FF0000"><b>End
 </b></font><font color="#000080">@</font>TopView<font color="#000080">:
  </font>Mov           Task<font color="#000080">.</font>OS<font color="#000080">,</font><font color="#800000">05</font>h
  Jmp          <font color="#000080">@</font><font color="#FF0000"><b>End
 </b></font><font color="#000080">@</font>DoubleDos<font color="#000080">:
  </font>Mov           Task<font color="#000080">.</font>OS<font color="#000080">,</font><font color="#800000">06</font>h
  Jmp          <font color="#000080">@</font><font color="#FF0000"><b>End
 </b></font><font color="#000080">@</font>NetWare<font color="#000080">:
  </font>Mov           Task<font color="#000080">.</font>OS<font color="#000080">,</font><font color="#800000">07</font>h
  Jmp          <font color="#000080">@</font><font color="#FF0000"><b>End
 </b></font><font color="#000080">@</font>MultiLink<font color="#000080">:
  </font>Mov           Task<font color="#000080">.</font>OS<font color="#000080">,</font><font color="#800000">08</font>h
  Jmp          <font color="#000080">@</font><font color="#FF0000"><b>End
 </b></font><font color="#000080">@</font>CSwitch<font color="#000080">:
  </font>Mov           Task<font color="#000080">.</font>OS<font color="#000080">,</font><font color="#800000">09</font>h
  Jmp          <font color="#000080">@</font><font color="#FF0000"><b>End
 </b></font><font color="#000080">@</font>EuroDOS<font color="#000080">:
  </font>Mov           Task<font color="#000080">.</font>OS<font color="#000080">,</font><font color="#800000">10</font>h
 <font color="#000080">@</font><font color="#FF0000"><b>End</b></font><font color="#000080">:
  </font>Call          AssignProcs
<font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Begin
 </b></font>Init<font color="#000080">;
 </font>Polling<font color="#000080">:=</font>GiveTimeSlice<font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">.</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to FILES SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0102.PAS">Original</a><b>]</b></p></body>
</html>
