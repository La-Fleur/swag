<html>
<head><title> "Copying files" by VARIOUS</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to FILES SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0094.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code>
<font color="#008000"><i>{This way uses a File stream.}
</i></font><font color="#FF0000"><b>Procedure </b></font>FileCopy<font color="#000080">( </font><font color="#FF0000"><b>Const </b></font>sourcefilename<font color="#000080">, </font>targetfilename<font color="#000080">: </font><font color="#FF0000"><b>String </b></font><font color="#000080">);
</font><font color="#FF0000"><b>Var
  </b></font>S<font color="#000080">, </font>T<font color="#000080">: </font>TFileStream<font color="#000080">;
</font><font color="#FF0000"><b>Begin
  </b></font>S <font color="#000080">:= </font>TFileStream<font color="#000080">.</font>Create<font color="#000080">( </font>sourcefilename<font color="#000080">, </font>fmOpenRead <font color="#000080">);
  </font><font color="#FF0000"><b>try
    </b></font>T <font color="#000080">:= </font>TFileStream<font color="#000080">.</font>Create<font color="#000080">( </font>targetfilename<font color="#000080">, </font>fmOpenWrite <font color="#FF0000"><b>or </b></font>fmCreate <font color="#000080">);
    </font><font color="#FF0000"><b>try
      </b></font>T<font color="#000080">.</font>CopyFrom<font color="#000080">(</font>S<font color="#000080">, </font>S<font color="#000080">.</font>Size <font color="#000080">) ;
    </font><font color="#FF0000"><b>finally
      </b></font>T<font color="#000080">.</font>Free<font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>finally
    </b></font>S<font color="#000080">.</font>Free<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;


</font><font color="#008000"><i>{Here is one that uses a TMemoryStream:}
</i></font><font color="#FF0000"><b>procedure </b></font>FileCopy<font color="#000080">(</font><font color="#FF0000"><b>const </b></font>FromFile<font color="#000080">, </font>ToFile<font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">);
</font><font color="#FF0000"><b>begin
  with </b></font>TMemoryStream<font color="#000080">.</font>Create <font color="#FF0000"><b>do
  try
    </b></font>LoadFromFile<font color="#000080">(</font>FromFile<font color="#000080">);

    </font>SaveToFile<font color="#000080">(</font>ToFile<font color="#000080">);
  </font><font color="#FF0000"><b>finally
    </b></font>Free<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#008000"><i>{This way uses memory blocks for read/write.}
</i></font><font color="#FF0000"><b>procedure </b></font>FileCopy<font color="#000080">(</font><font color="#FF0000"><b>const </b></font>FromFile<font color="#000080">, </font>ToFile<font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">);
 </font><font color="#FF0000"><b>var
  </b></font>FromF<font color="#000080">, </font>ToF<font color="#000080">: </font><font color="#FF0000"><b>file</b></font><font color="#000080">;
  </font>NumRead<font color="#000080">, </font>NumWritten<font color="#000080">: </font>Word<font color="#000080">;
  </font>Buf<font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">2048</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Char<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>AssignFile<font color="#000080">(</font>FromF<font color="#000080">, </font>FromFile<font color="#000080">);
  </font>Reset<font color="#000080">(</font>FromF<font color="#000080">, </font><font color="#800000">1</font><font color="#000080">);</font>		<font color="#008000"><i>{ Record size = 1 }
  </i></font>AssignFile<font color="#000080">(</font>ToF<font color="#000080">, </font>ToFile<font color="#000080">);</font>	<font color="#008000"><i>{ Open output file }
  </i></font>Rewrite<font color="#000080">(</font>ToF<font color="#000080">, </font><font color="#800000">1</font><font color="#000080">);</font>		<font color="#008000"><i>{ Record size = 1 }
  </i></font><font color="#FF0000"><b>repeat
    </b></font>BlockRead<font color="#000080">(</font>FromF<font color="#000080">, </font>Buf<font color="#000080">, </font>SizeOf<font color="#000080">(</font>Buf<font color="#000080">), </font>NumRead<font color="#000080">);
    </font>BlockWrite<font color="#000080">(</font>ToF<font color="#000080">, </font>Buf<font color="#000080">, </font>NumRead<font color="#000080">, </font>NumWritten<font color="#000080">);
  </font><font color="#FF0000"><b>until </b></font><font color="#000080">(</font>NumRead <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>or </b></font><font color="#000080">(</font>NumWritten <font color="#000080">&lt;&gt; </font>NumRead<font color="#000080">);

  </font>System<font color="#000080">.</font>CloseFile<font color="#000080">(</font>FromF<font color="#000080">);
  </font>System<font color="#000080">.</font>CloseFile<font color="#000080">(</font>ToF<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{This one uses LZCopy, which USES LZExpand.}
</i></font><font color="#FF0000"><b>procedure </b></font>CopyFile<font color="#000080">(</font>FromFileName<font color="#000080">, </font>ToFileName<font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">);
</font><font color="#FF0000"><b>var
  </b></font>FromFile<font color="#000080">, </font>ToFile<font color="#000080">: </font><font color="#FF0000"><b>File</b></font><font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>AssignFile<font color="#000080">(</font>FromFile<font color="#000080">, </font>FromFileName<font color="#000080">); </font><font color="#008000"><i>{ Assign FromFile to FromFileName }
  </i></font>AssignFile<font color="#000080">(</font>ToFile<font color="#000080">, </font>ToFileName<font color="#000080">);     </font><font color="#008000"><i>{ Assign ToFile to ToFileName }
  </i></font>Reset<font color="#000080">(</font>FromFile<font color="#000080">);                    </font><font color="#008000"><i>{ Open file for input }
  </i></font><font color="#FF0000"><b>try
    </b></font>Rewrite<font color="#000080">(</font>ToFile<font color="#000080">);                  </font><font color="#008000"><i>{ Create file for output }
    </i></font><font color="#FF0000"><b>try
      </b></font><font color="#008000"><i>{ copy the file an if a negative value is returned raise an exception }

      </i></font><font color="#FF0000"><b>if </b></font>LZCopy<font color="#000080">(</font>TFileRec<font color="#000080">(</font>FromFile<font color="#000080">).</font>Handle<font color="#000080">, </font>TFileRec<font color="#000080">(</font>ToFile<font color="#000080">).</font>Handle<font color="#000080">) &lt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then
        raise </b></font>Exception<font color="#000080">.</font>Create<font color="#000080">(</font><font color="#800000">'Error using LZCopy'</font><font color="#000080">)
    </font><font color="#FF0000"><b>finally
      </b></font>CloseFile<font color="#000080">(</font>ToFile<font color="#000080">);  </font><font color="#008000"><i>{ Close ToFile }
    </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>finally
    </b></font>CloseFile<font color="#000080">(</font>FromFile<font color="#000080">);  </font><font color="#008000"><i>{ Close FromFile }
  </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font>This one <font color="#FF0000"><b>is </b></font>from Dr<font color="#000080">. </font>Bob <font color="#000080">(</font>Swart<font color="#000080">).  </font>The point <font color="#FF0000"><b>of </b></font>this one <font color="#FF0000"><b>is </b></font>that it <font color="#FF0000"><b>contains </b></font>a callback <font color="#FF0000"><b>function </b></font>that gives you the ability <font color="#FF0000"><b>to </b></font>callback<font color="#000080">.  </font>This can be used <font color="#FF0000"><b>for </b></font>progress bars <font color="#FF0000"><b>and </b></font>the like<font color="#000080">.  </font>Groetjes<font color="#000080">, </font>Dr<font color="#000080">. </font>Bob<font color="#000080">!


 </font><font color="#008000"><i>{$A+,B-,D-,F-,G+,I+,K+,L-,N+,P+,Q-,R-,S+,T+,V-,W-,X+,Y-}
 </i></font><font color="#FF0000"><b>unit </b></font>FileCopy<font color="#000080">;

 </font><font color="#008000"><i>(*
   FILECOPY 1.5 (Public Domain)
   Borland Delphi 1.0
   Copr. (c) 1995-08-27 Robert E. Swart (100434.2072@compuserve.com)
                        P.O. box 799
                        5702 NP  Helmond
                        The Netherlands
   -----------------------------------------------------------------
   This unit implements a FastFileCopy procedure that is usable from
   Borland Pascal (real mode, DPMI or Windows) and Borland Delphi. A
   callback routine (or nil) can be given as extra argument.

   Example of usage:

   {$IFDEF WINDOWS}
    uses FileCopy, WinCrt;
   {$ELSE}
    uses FileCopy, Crt;

   {$ENDIF}

      procedure CallBack(Position, Size: LongInt); far;
      var i: Integer;
      begin
        { do you stuff here... }
        GotoXY(1,1);
        for i:=1 to (80 * Position) div Size do write('X')
      end {CallBack};

    begin
      FastFileCopy('C:\AUTOEXEC.BAT', 'C:\AUTOEXEC.BAK', nil);
      FastFileCopy('C:\CONFIG.SYS', 'C:\CONFIG.BAK', CallBack)
    end.
 *)
 </i></font><font color="#FF0000"><b>interface

 Type
   </b></font>TCallBack <font color="#000080">= </font><font color="#FF0000"><b>procedure </b></font><font color="#000080">(</font>Position<font color="#000080">, </font>Size<font color="#000080">: </font>LongInt<font color="#000080">); </font><font color="#008000"><i>{ export; }

   </i></font><font color="#FF0000"><b>procedure </b></font>FastFileCopy<font color="#000080">(</font><font color="#FF0000"><b>Const </b></font>InFileName<font color="#000080">, </font>OutFileName<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
                          </font>CallBack<font color="#000080">: </font>TCallBack<font color="#000080">);


 </font><font color="#FF0000"><b>implementation
 </b></font><font color="#008000"><i>{$IFDEF VER80}
 </i></font><font color="#FF0000"><b>uses </b></font>SysUtils<font color="#000080">;
 </font><font color="#008000"><i>{$ELSE}
   {$IFDEF WINDOWS}
   </i></font><font color="#FF0000"><b>uses </b></font>WinDos<font color="#000080">;
   </font><font color="#008000"><i>{$ELSE}
   </i></font><font color="#FF0000"><b>uses </b></font>Dos<font color="#000080">;
   </font><font color="#008000"><i>{$ENDIF}
 {$ENDIF}

   </i></font><font color="#FF0000"><b>procedure </b></font>FastFileCopy<font color="#000080">(</font><font color="#FF0000"><b>Const </b></font>InFileName<font color="#000080">, </font>OutFileName<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
                          </font>CallBack<font color="#000080">: </font>TCallBack<font color="#000080">);
   </font><font color="#FF0000"><b>Const </b></font>BufSize <font color="#000080">= </font><font color="#800000">8</font><font color="#000080">*</font><font color="#800000">4096</font><font color="#000080">; </font><font color="#008000"><i>{ 32Kbytes gives me the best results }
   </i></font><font color="#FF0000"><b>Type
     </b></font>PBuffer <font color="#000080">= ^</font>TBuffer<font color="#000080">;
     </font>TBuffer <font color="#000080">= </font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font>BufSize<font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Byte<font color="#000080">;
   </font><font color="#FF0000"><b>var </b></font>Size<font color="#000080">: </font>Word<font color="#000080">;
       </font>Buffer<font color="#000080">: </font>PBuffer<font color="#000080">;
       </font>infile<font color="#000080">,</font>outfile<font color="#000080">: </font><font color="#FF0000"><b>File</b></font><font color="#000080">;
       </font>SizeDone<font color="#000080">,</font>SizeFile<font color="#000080">,</font>TimeDateFile<font color="#000080">: </font>LongInt<font color="#000080">;
   </font><font color="#FF0000"><b>begin
     if </b></font><font color="#000080">(</font>InFileName <font color="#000080">&lt;&gt; </font>OutFileName<font color="#000080">) </font><font color="#FF0000"><b>then
     begin
       </b></font>Buffer <font color="#000080">:= </font><font color="#FF0000"><b>nil</b></font><font color="#000080">;
       </font>Assign<font color="#000080">(</font>infile<font color="#000080">,</font>InFileName<font color="#000080">);

       </font>System<font color="#000080">.</font>Reset<font color="#000080">(</font>infile<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">);
       </font><font color="#008000"><i>{$IFDEF VER80}
       </i></font><font color="#FF0000"><b>try
       </b></font><font color="#008000"><i>{$ELSE}
       </i></font><font color="#FF0000"><b>begin
       </b></font><font color="#008000"><i>{$ENDIF}
         </i></font>SizeFile <font color="#000080">:= </font>FileSize<font color="#000080">(</font>infile<font color="#000080">);
         </font>Assign<font color="#000080">(</font>outfile<font color="#000080">,</font>OutFileName<font color="#000080">);
         </font>System<font color="#000080">.</font>Rewrite<font color="#000080">(</font>outfile<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">);
         </font><font color="#008000"><i>{$IFDEF VER80}
         </i></font><font color="#FF0000"><b>try
         </b></font><font color="#008000"><i>{$ELSE}
         </i></font><font color="#FF0000"><b>begin
         </b></font><font color="#008000"><i>{$ENDIF}
           </i></font>SizeDone <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
           </font>New<font color="#000080">(</font>Buffer<font color="#000080">);
           </font><font color="#FF0000"><b>repeat
             </b></font>BlockRead<font color="#000080">(</font>infile<font color="#000080">,</font>Buffer<font color="#000080">^,</font>BufSize<font color="#000080">,</font>Size<font color="#000080">);
             </font>Inc<font color="#000080">(</font>SizeDone<font color="#000080">,</font>Size<font color="#000080">);
             </font><font color="#FF0000"><b>if </b></font><font color="#000080">(@</font>CallBack <font color="#000080">&lt;&gt; </font><font color="#FF0000"><b>nil</b></font><font color="#000080">) </font><font color="#FF0000"><b>then
               </b></font>CallBack<font color="#000080">(</font>SizeDone<font color="#000080">,</font>SizeFile<font color="#000080">);

             </font>BlockWrite<font color="#000080">(</font>outfile<font color="#000080">,</font>Buffer<font color="#000080">^,</font>Size<font color="#000080">)
           </font><font color="#FF0000"><b>until </b></font>Size <font color="#000080">&lt; </font>BufSize<font color="#000080">;
           </font><font color="#008000"><i>{$IFDEF VER80}
           </i></font>FileSetDate<font color="#000080">(</font>TFileRec<font color="#000080">(</font>outfile<font color="#000080">).</font>Handle<font color="#000080">,
             </font>FileGetDate<font color="#000080">(</font>TFileRec<font color="#000080">(</font>infile<font color="#000080">).</font>Handle<font color="#000080">));
           </font><font color="#008000"><i>{$ELSE}
           </i></font>GetFTime<font color="#000080">(</font>infile<font color="#000080">, </font>TimeDateFile<font color="#000080">);
           </font>SetFTime<font color="#000080">(</font>outfile<font color="#000080">, </font>TimeDateFile<font color="#000080">);
           </font><font color="#008000"><i>{$ENDIF}
         {$IFDEF VER80}
         </i></font><font color="#FF0000"><b>finally
         </b></font><font color="#008000"><i>{$ENDIF}
           </i></font><font color="#FF0000"><b>if </b></font>Buffer <font color="#000080">&lt;&gt; </font><font color="#FF0000"><b>nil then </b></font>Dispose<font color="#000080">(</font>Buffer<font color="#000080">);
           </font>System<font color="#000080">.</font>close<font color="#000080">(</font>outfile<font color="#000080">)
         </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
       </font><font color="#008000"><i>{$IFDEF VER80}
       </i></font><font color="#FF0000"><b>finally
       </b></font><font color="#008000"><i>{$ENDIF}

         </i></font>System<font color="#000080">.</font>close<font color="#000080">(</font>infile<font color="#000080">)
       </font><font color="#FF0000"><b>end
     end
     </b></font><font color="#008000"><i>{$IFDEF VER80}
     </i></font><font color="#FF0000"><b>else
       Raise </b></font>EInOutError<font color="#000080">.</font>Create<font color="#000080">(</font><font color="#800000">'File cannot be copied onto itself'</font><font color="#000080">)
     </font><font color="#008000"><i>{$ENDIF}
   </i></font><font color="#FF0000"><b>end </b></font><font color="#008000"><i>{FastFileCopy}</i></font><font color="#000080">;
 </font><font color="#FF0000"><b>end</b></font><font color="#000080">.


</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to FILES SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0094.PAS">Original</a><b>]</b></p></body>
</html>
