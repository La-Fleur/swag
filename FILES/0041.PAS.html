<html>
<head><title> "Counting Lines" by KOLYA RICE</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to FILES SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0041.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
&gt;The subroutine opened a text file (in this case the Telix.USE file) in
&gt;binary mode, and then searched through the file for the CR/LF pair and
&gt;then incremented a counter.  At the end I knew the number of lines in
&gt;the text file.  I suppose in Pascal I could open the file do a while
&gt;loop and count the lines -- but that would require me to read every
&gt;single line where the basic subroutine did all the searching without
&gt;having to read the file line by line.

&gt;I guess what I'm asking is how is a fast way to determine the number of
&gt;lines in a text file using Pascal.

FWIW, This routine takes a little over 6 seconds on a 330K TELIX.USE on a
386/33
}

</i></font><font color="#FF0000"><b>program </b></font>countlines<font color="#000080">;

</font><font color="#FF0000"><b>var
   </b></font>usefile <font color="#000080">: </font><font color="#FF0000"><b>file</b></font><font color="#000080">;
   </font>buffer <font color="#000080">:  </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">8191</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">;
   </font>counter<font color="#000080">, </font>numw<font color="#000080">, </font>numr <font color="#000080">: </font>word<font color="#000080">;
   </font>size<font color="#000080">, </font>numlines <font color="#000080">: </font>longint<font color="#000080">;


</font><font color="#FF0000"><b>begin
   </b></font>numlines <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
   </font>counter <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
   </font>fillchar<font color="#000080">(</font>buffer<font color="#000080">, </font>sizeof<font color="#000080">(</font>buffer<font color="#000080">), </font><font color="#800000">#0</font><font color="#000080">);
   </font>assign<font color="#000080">(</font>usefile<font color="#000080">,</font><font color="#800000">'TELIX.USE'</font><font color="#000080">);
   </font>reset<font color="#000080">(</font>usefile<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">);
   </font>size <font color="#000080">:= </font>filesize<font color="#000080">(</font>usefile<font color="#000080">);
   </font><font color="#FF0000"><b>repeat
      </b></font>blockread<font color="#000080">(</font>usefile<font color="#000080">,</font>buffer<font color="#000080">,</font>sizeof<font color="#000080">(</font>buffer<font color="#000080">),</font>numr<font color="#000080">);
      </font><font color="#FF0000"><b>for </b></font>counter <font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font><font color="#800000">8191 </font><font color="#FF0000"><b>do
         if </b></font>buffer<font color="#000080">[</font>counter<font color="#000080">] = </font>ord<font color="#000080">(</font><font color="#800000">13</font><font color="#000080">)
            </font><font color="#FF0000"><b>then begin
                    </b></font>inc<font color="#000080">(</font>numlines<font color="#000080">);
                    </font>write<font color="#000080">(</font>round<font color="#000080">((</font>filepos<font color="#000080">(</font>usefile<font color="#000080">)/</font>size<font color="#000080">)*</font><font color="#800000">100</font><font color="#000080">),</font><font color="#800000">'%'</font><font color="#000080">,</font>chr<font color="#000080">(</font><font color="#800000">13</font><font color="#000080">));
                 </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
   </font><font color="#FF0000"><b>until </b></font>numr <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">;
   </font>close<font color="#000080">(</font>usefile<font color="#000080">);
   </font>writeln<font color="#000080">(</font><font color="#800000">'Your TELIX.USE has '</font><font color="#000080">,</font>numlines<font color="#000080">,</font><font color="#800000">' lines.'</font><font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to FILES SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0041.PAS">Original</a><b>]</b></p></body>
</html>
