<html>
<head><title> "Change File Extensions" by GAYLE DAVIS</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to FILES SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0048.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{$S-,V-,R-,F+}

</i></font><font color="#FF0000"><b>PROGRAM </b></font>REX<font color="#000080">;

 </font><font color="#008000"><i>{ Rename all files matching one extension with another
   CAUTION !!!  This program will rename FILES !!!!!!!!
   Takes to parameters : Ext1(current) and Ext2(whatever)
   i.e.   *.XXX to *.PAS or *.MOD to *.INT
   Uses some of the routines from EDDY THILLEMAN'S recursive directory roam
   whice can be found in the SWAG distribution
   Gayle Davis 1/26/94 }

</i></font><font color="#FF0000"><b>USES </b></font>DOS<font color="#000080">, </font>CRT<font color="#000080">;

</font><font color="#FF0000"><b>TYPE
    </b></font>ProcessType <font color="#000080">= </font><font color="#FF0000"><b>PROCEDURE </b></font><font color="#000080">(</font>Path <font color="#000080">: </font>PathStr<font color="#000080">; </font>FR <font color="#000080">: </font>SearchRec<font color="#000080">);

</font><font color="#FF0000"><b>CONST
    </b></font>NotGoodFile <font color="#000080">: </font>WORD <font color="#000080">= </font>Directory <font color="#000080">+ </font>Hidden <font color="#000080">+ </font>Readonly <font color="#000080">+ </font>VolumeID <font color="#000080">+ </font>Sysfile<font color="#000080">;

</font><font color="#FF0000"><b>VAR
     </b></font>Ext1 <font color="#000080">: </font>Pathstr<font color="#000080">;
     </font>Ext2 <font color="#000080">: </font>Pathstr<font color="#000080">;
     </font>ExitSave <font color="#000080">: </font>POINTER<font color="#000080">;

</font><font color="#FF0000"><b>PROCEDURE </b></font>Frename <font color="#000080">(</font>SourceFile<font color="#000080">, </font>TargetFile <font color="#000080">: </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">; </font><font color="#FF0000"><b>VAR </b></font>ErrCode <font color="#000080">: </font>BYTE<font color="#000080">);
</font><font color="#FF0000"><b>VAR
  </b></font>reg <font color="#000080">: </font>REGISTERS<font color="#000080">;
</font><font color="#FF0000"><b>BEGIN                                   </b></font><font color="#008000"><i>{ Frename }
  </i></font>SourceFile <font color="#000080">:= </font>CONCAT <font color="#000080">(</font>SourceFile<font color="#000080">, </font><font color="#800000">#0</font><font color="#000080">);
  </font>TargetFile <font color="#000080">:= </font>CONCAT <font color="#000080">(</font>TargetFile<font color="#000080">, </font><font color="#800000">#0</font><font color="#000080">);
  </font>reg<font color="#000080">.</font>ds <font color="#000080">:= </font>SEG <font color="#000080">(</font>SourceFile <font color="#000080">[</font><font color="#800000">1</font><font color="#000080">]); </font>reg<font color="#000080">.</font>dx <font color="#000080">:= </font>OFS <font color="#000080">(</font>SourceFile <font color="#000080">[</font><font color="#800000">1</font><font color="#000080">]);
  </font>reg<font color="#000080">.</font>es <font color="#000080">:= </font>SEG <font color="#000080">(</font>TargetFile <font color="#000080">[</font><font color="#800000">1</font><font color="#000080">]); </font>reg<font color="#000080">.</font>di <font color="#000080">:= </font>OFS <font color="#000080">(</font>TargetFile <font color="#000080">[</font><font color="#800000">1</font><font color="#000080">]);
  </font>reg<font color="#000080">.</font>ah <font color="#000080">:= </font><font color="#800000">$56</font><font color="#000080">;
  </font>MSDOS <font color="#000080">(</font>reg<font color="#000080">);
  </font>ErrCode <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>reg<font color="#000080">.</font>flags <font color="#FF0000"><b>AND </b></font>FCarry<font color="#000080">) = </font><font color="#800000">1 </font><font color="#FF0000"><b>THEN </b></font>ErrCode <font color="#000080">:= </font>reg<font color="#000080">.</font>ax<font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;                                    </font><font color="#008000"><i>{ Frename }

</i></font><font color="#FF0000"><b>PROCEDURE </b></font>DoitHere <font color="#000080">(</font>Path <font color="#000080">: </font>PathStr<font color="#000080">; </font>FR <font color="#000080">: </font>SearchRec<font color="#000080">); </font><font color="#FF0000"><b>FAR</b></font><font color="#000080">;
</font><font color="#FF0000"><b>VAR
   </b></font>Name1<font color="#000080">,
   </font>Name2 <font color="#000080">: </font>PathStr<font color="#000080">;
   </font>D     <font color="#000080">: </font>PathStr<font color="#000080">;
   </font>N     <font color="#000080">: </font>NameStr<font color="#000080">;
   </font>E     <font color="#000080">: </font>ExtStr<font color="#000080">;
   </font>Err   <font color="#000080">: </font>BYTE<font color="#000080">;

</font><font color="#FF0000"><b>BEGIN
IF </b></font><font color="#000080">(</font>FR<font color="#000080">.</font>Attr <font color="#FF0000"><b>AND </b></font>NotGoodFile<font color="#000080">) &lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>THEN </b></font>EXIT<font color="#000080">;
</font>FSplit<font color="#000080">(</font>FR<font color="#000080">.</font>Name<font color="#000080">, </font>D<font color="#000080">, </font>N<font color="#000080">, </font>E<font color="#000080">);
</font>Name1 <font color="#000080">:= </font>Path <font color="#000080">+ </font>FR<font color="#000080">.</font>Name<font color="#000080">;
</font>Name2 <font color="#000080">:= </font>Path <font color="#000080">+ </font>N <font color="#000080">+ </font>Ext2<font color="#000080">;
</font>WRITELN <font color="#000080">(</font>Name1<font color="#000080">, </font><font color="#800000">' '</font><font color="#000080">, </font>Name2<font color="#000080">);
</font>FRename<font color="#000080">(</font>Name1<font color="#000080">,</font>Name2<font color="#000080">,</font>Err<font color="#000080">);
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>FUNCTION </b></font>Wildcard <font color="#000080">(</font>Name <font color="#000080">: </font>PathStr<font color="#000080">) : </font>BOOLEAN <font color="#000080">;

</font><font color="#FF0000"><b>BEGIN
</b></font>Wildcard <font color="#000080">:= (</font>POS <font color="#000080">(</font><font color="#800000">'*'</font><font color="#000080">, </font>Name<font color="#000080">) &lt;&gt; </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>OR </b></font><font color="#000080">(</font>POS <font color="#000080">(</font><font color="#800000">'?'</font><font color="#000080">, </font>Name<font color="#000080">) &lt;&gt; </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>AND </b></font><font color="#000080">(</font>POS<font color="#000080">(</font><font color="#800000">'.'</font><font color="#000080">,</font>Name<font color="#000080">) &gt; </font><font color="#800000">0</font><font color="#000080">);
</font><font color="#FF0000"><b>END </b></font><font color="#000080">;


</font><font color="#FF0000"><b>Procedure </b></font>PathAnalyze <font color="#000080">(</font>P<font color="#000080">: </font>PathStr<font color="#000080">; </font><font color="#FF0000"><b>Var </b></font>D<font color="#000080">: </font>DirStr<font color="#000080">; </font><font color="#FF0000"><b>Var </b></font>Name<font color="#000080">: </font>NameStr<font color="#000080">);
</font><font color="#FF0000"><b>Var
  </b></font>N<font color="#000080">: </font>NameStr<font color="#000080">;
  </font>E<font color="#000080">: </font>ExtStr<font color="#000080">;

</font><font color="#FF0000"><b>begin
  </b></font>FSplit<font color="#000080">(</font>P<font color="#000080">, </font>D<font color="#000080">, </font>N<font color="#000080">, </font>E<font color="#000080">);
  </font>Name <font color="#000080">:= </font>N <font color="#000080">+ </font>E<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>PROCEDURE </b></font>FindFiles <font color="#000080">(</font>fMask <font color="#000080">: </font>PathStr<font color="#000080">; </font>fAttr <font color="#000080">: </font>WORD<font color="#000080">; </font>Process <font color="#000080">: </font>ProcessType<font color="#000080">);
</font><font color="#FF0000"><b>VAR
  </b></font>FR   <font color="#000080">: </font>SearchRec<font color="#000080">;
  </font>Path <font color="#000080">: </font>PathStr<font color="#000080">;
  </font>Mask <font color="#000080">: </font>NameStr<font color="#000080">;

</font><font color="#FF0000"><b>BEGIN
  </b></font>PathAnalyze<font color="#000080">(</font>fMask<font color="#000080">,</font>Path<font color="#000080">,</font>Mask<font color="#000080">);
  </font>FINDFIRST <font color="#000080">(</font>FMask<font color="#000080">, </font>FAttr<font color="#000080">, </font>FR<font color="#000080">);
  </font><font color="#FF0000"><b>WHILE </b></font>DosError <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>DO
  BEGIN
    </b></font>Process <font color="#000080">(</font>Path<font color="#000080">,</font>FR<font color="#000080">);
    </font>FINDNEXT <font color="#000080">(</font>FR<font color="#000080">);
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>PROCEDURE </b></font>ExitHandler<font color="#000080">; </font><font color="#FF0000"><b>FAR</b></font><font color="#000080">;
  </font><font color="#008000"><i>{ Return the cursor to its original shape }
  </i></font><font color="#FF0000"><b>BEGIN
  </b></font>ExitProc <font color="#000080">:= </font>ExitSave
  <font color="#FF0000"><b>END</b></font><font color="#000080">;


</font><font color="#FF0000"><b>BEGIN
</b></font>ExitSave <font color="#000080">:= </font>ExitProc<font color="#000080">;
</font>ExitProc <font color="#000080">:= @</font>ExitHandler<font color="#000080">;
</font>ClrScr<font color="#000080">;
</font><font color="#FF0000"><b>IF </b></font>PARAMCOUNT <font color="#000080">&lt; </font><font color="#800000">2 </font><font color="#FF0000"><b>THEN
   BEGIN
   </b></font>WriteLn<font color="#000080">(</font><font color="#800000">'REX : Rename all files matching Ext1 to Ext2'</font><font color="#000080">);
   </font>WRITELN<font color="#000080">(</font><font color="#800000">'Needs 2 Parameters ..   *.ext1  *.ext2'</font><font color="#000080">);
   </font>HALT<font color="#000080">;
   </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
</font>Ext1 <font color="#000080">:= </font>ParamStr<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">);
</font>Ext2 <font color="#000080">:= </font>ParamStr<font color="#000080">(</font><font color="#800000">2</font><font color="#000080">);
</font><font color="#FF0000"><b>IF NOT </b></font>WildCard<font color="#000080">(</font>Ext1<font color="#000080">) </font><font color="#FF0000"><b>THEN </b></font>HALT<font color="#000080">;  </font><font color="#008000"><i>{ must contain a wildcard }
</i></font><font color="#FF0000"><b>IF NOT </b></font>WildCard<font color="#000080">(</font>Ext2<font color="#000080">) </font><font color="#FF0000"><b>THEN </b></font>HALT<font color="#000080">;
</font>Ext2 <font color="#000080">:= </font>COPY<font color="#000080">(</font>Ext2<font color="#000080">,</font>POS<font color="#000080">(</font><font color="#800000">'.'</font><font color="#000080">,</font>Ext2<font color="#000080">),</font><font color="#800000">$FF</font><font color="#000080">);  </font><font color="#008000"><i>{ only want the extension }
</i></font>FindFiles <font color="#000080">(</font>Ext1<font color="#000080">, </font>Anyfile<font color="#000080">, </font>DoitHere<font color="#000080">);
</font><font color="#FF0000"><b>END</b></font><font color="#000080">.</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to FILES SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0048.PAS">Original</a><b>]</b></p></body>
</html>
