<html>
<head><title> "Complete File Handling" by RICK HAINES</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to FILES SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0078.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
Here's a unit I wrote to handle files and directories.  It has procedures
similare to SetFAttr and GetFAttr, plus two others dealing with file
attributes.  It also has a procedure to return a linked list of all the
files in the current directory, three procedure to work with that (I may
write one to sort it later), and one to dispose of the linked list.

At the end of the unit will be a program called attribs that uses it.  It's
basically the same as DOS's attrib with some added features, such as:  It
now works on directories too (i.e. you can now hide directorys), you can
list only the files and directories with certain attributes set, you can
list only directorys, etc...

As always, comments, flames, criticism (constructive or otherwise), and
even &quot;this sucks!&quot; or &quot;cool!&quot; are welcome.

                                                -Rick
rick.haines@cde.com
}

{$A+,B-,D-,E+,F-,G+,I+,L+,N-,O-,P-,Q-,R-,S-,T-,V+,X+,Y+}
{$M 16384,0,655360}
{ ********************************************************** }
{ *********************** Files Unit *********************** }
{ ********************************************************** }
{ **************** Written by: Rick Haines ***************** }
{ **************************** rick.haines@cde.com ********* }
{ ********************************************************** }
{ ***************** Last Revised 03/29/95 ****************** }
{ ********************************************************** }

</i></font><font color="#FF0000"><b>Unit </b></font>Files<font color="#000080">;

</font><font color="#FF0000"><b>Interface

Const
 </b></font>NormalF   <font color="#000080">= </font><font color="#800000">$0</font><font color="#000080">;          </font><font color="#008000"><i>{ Normal File   }
 </i></font>ReadOnlyF <font color="#000080">= </font><font color="#800000">$1</font><font color="#000080">;          </font><font color="#008000"><i>{ ReadOnly File }
 </i></font>HiddenF   <font color="#000080">= </font><font color="#800000">$2</font><font color="#000080">;          </font><font color="#008000"><i>{ Hidden File   }
 </i></font>SystemF   <font color="#000080">= </font><font color="#800000">$4</font><font color="#000080">;          </font><font color="#008000"><i>{ System File   }
 </i></font>VolLabel  <font color="#000080">= </font><font color="#800000">$8</font><font color="#000080">;          </font><font color="#008000"><i>{ Volume Label  }
 </i></font>SubDir    <font color="#000080">= </font><font color="#800000">$10</font><font color="#000080">;         </font><font color="#008000"><i>{ Sub Directory }
 </i></font>ArchiveF  <font color="#000080">= </font><font color="#800000">$20</font><font color="#000080">;         </font><font color="#008000"><i>{ Archive File  }
 </i></font>AllFiles  <font color="#000080">= </font><font color="#800000">$3F</font><font color="#000080">;         </font><font color="#008000"><i>{ All Files     }
{Reserved  = $40;}
{Reserved  = $80;}
 </i></font>fOK       <font color="#000080">= </font><font color="#800000">$0</font><font color="#000080">;          </font><font color="#008000"><i>{ No Error       }
 </i></font>fFileNF   <font color="#000080">= </font><font color="#800000">$2</font><font color="#000080">;          </font><font color="#008000"><i>{ File Not Found }
 </i></font>fPathNF   <font color="#000080">= </font><font color="#800000">$3</font><font color="#000080">;          </font><font color="#008000"><i>{ Path Not Found }
 </i></font>fAccessD  <font color="#000080">= </font><font color="#800000">$5</font><font color="#000080">;          </font><font color="#008000"><i>{ Access Denied  }
 </i></font>fgError   <font color="#000080">= </font><font color="#800000">$120</font><font color="#000080">;        </font><font color="#008000"><i>{ Other Error    }

</i></font><font color="#FF0000"><b>Type
 </b></font>FileListP <font color="#000080">= ^</font>FileListT<font color="#000080">;
 </font>FileListT <font color="#000080">= </font><font color="#FF0000"><b>Record
   </b></font>Name <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">[</font><font color="#800000">12</font><font color="#000080">];
   </font>Attr <font color="#000080">: </font>Byte<font color="#000080">;
   </font>Size <font color="#000080">: </font>LongInt<font color="#000080">;
   </font>Next <font color="#000080">: </font>FileListP<font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

 </font><font color="#FF0000"><b>Function </b></font>SetNewFileAttr<font color="#000080">(</font>FileName <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">; </font>Attr <font color="#000080">: </font>Byte<font color="#000080">) : </font>Integer<font color="#000080">;
  </font><font color="#008000"><i>{ Sets Attr, Clears what is already set }
 </i></font><font color="#FF0000"><b>Function </b></font>SetFileAttr<font color="#000080">(</font>FileName <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">; </font>Attr <font color="#000080">: </font>Byte<font color="#000080">) : </font>Integer<font color="#000080">;
  </font><font color="#008000"><i>{ Sets Attr, leaves the rest }
 </i></font><font color="#FF0000"><b>Function </b></font>ClearFileAttr<font color="#000080">(</font>FileName <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">; </font>Attr <font color="#000080">: </font>Byte<font color="#000080">) : </font>Integer<font color="#000080">;
  </font><font color="#008000"><i>{ Clears Attr, leaves the rest }
 </i></font><font color="#FF0000"><b>Function  </b></font>GetFileAttr<font color="#000080">(</font>FileName <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">) : </font>Byte<font color="#000080">;
  </font><font color="#008000"><i>{ Returns Attr }
 </i></font><font color="#FF0000"><b>Function </b></font>GetFileList <font color="#000080">: </font>FileListP<font color="#000080">;
  </font><font color="#008000"><i>{ Returns a Linked List of all files in current directory }
 </i></font><font color="#FF0000"><b>Procedure </b></font>FilterAttr<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>List <font color="#000080">: </font>FileListP<font color="#000080">; </font>Attr <font color="#000080">: </font>Byte<font color="#000080">);
  </font><font color="#008000"><i>{ Filter out all files without Attr }
 </i></font><font color="#FF0000"><b>Procedure </b></font>FilterName<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>List <font color="#000080">: </font>FileListP<font color="#000080">; </font>Name <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">);
  </font><font color="#008000"><i>{ Filter out all files that don't match Name }
 </i></font><font color="#FF0000"><b>Procedure </b></font>FilterNameAttr<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>List <font color="#000080">: </font>FileListP<font color="#000080">; </font>Name <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">; </font>Attr <font color="#000080">: </font>Byte<font color="#000080">);
  </font><font color="#008000"><i>{ Last two Procedures Combined }
 </i></font><font color="#FF0000"><b>Procedure </b></font>DisposeFileList<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>List <font color="#000080">: </font>FileListP<font color="#000080">);
  </font><font color="#008000"><i>{ Disposes of the Linked List }

</i></font><font color="#FF0000"><b>Implementation
 Uses </b></font>Dos<font color="#000080">;

 </font><font color="#FF0000"><b>Procedure </b></font>NullString<font color="#000080">; </font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;
</font><font color="#008000"><i>{ DS:DX = Pascal String }
{ Return : DS:DX = Null String }
{          AX = fOK, Success     }
  </i></font><font color="#FF0000"><b>Asm
   </b></font><font color="#FF00FF">Mov bx, dx
   Mov cl, Byte Ptr ds:[bx] </font><font color="#008000"><i>{ Get Length      }
   </i></font><font color="#FF00FF">Mov ax, fFileNF          </font><font color="#008000"><i>{ Set Error       }
   </i></font><font color="#FF00FF">Cmp cl, 254              </font><font color="#008000"><i>{ Is it too long? }
   </i></font><font color="#FF00FF">JA @Done                 </font><font color="#008000"><i>{ Yes, then exit  }
   </i></font><font color="#FF00FF">Xor ch, ch
   Add bx, cx               </font><font color="#008000"><i>{ Offset + Length        }
   </i></font><font color="#FF00FF">Inc bx                   </font><font color="#008000"><i>{ Next Byte              }
   </i></font><font color="#FF00FF">Mov Byte Ptr ds:[bx], 0  </font><font color="#008000"><i>{ Null Term. String      }
   </i></font><font color="#FF00FF">Inc dx                   </font><font color="#008000"><i>{ Get rid of length Byte }
   </i></font><font color="#FF00FF">Mov ax, fOK              </font><font color="#008000"><i>{ Return No Error        }
  </i></font><font color="#FF00FF">@Done:
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

 </font><font color="#FF0000"><b>Function </b></font>SetNewFileAttr<font color="#000080">(</font>FileName <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">; </font>Attr <font color="#000080">: </font>Byte<font color="#000080">) : </font>Integer<font color="#000080">; </font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>Asm
   </b></font><font color="#FF00FF">Push ds
   Lds dx, FileName         </font><font color="#008000"><i>{ Pascal String of FileName          }
   </i></font><font color="#FF00FF">Call NullString          </font><font color="#008000"><i>{ Change to a Null String            }
   </i></font><font color="#FF00FF">Cmp ax, fOK              </font><font color="#008000"><i>{ Change OK?                         }
   </i></font><font color="#FF00FF">JA @Done                 </font><font color="#008000"><i>{ If not then Exit                   }
   </i></font><font color="#FF00FF">Mov ah, 43h              </font><font color="#008000"><i>{ Dos Function 43h, File Change Mode }
   </i></font><font color="#FF00FF">Mov al, 1                </font><font color="#008000"><i>{ Change Attributes                  }
   </i></font><font color="#FF00FF">Mov cl, Attr             </font><font color="#008000"><i>{ Set Whatever Attributes            }
   </i></font><font color="#FF00FF">Int 21h                  </font><font color="#008000"><i>{ Call Dos                           }
   </i></font><font color="#FF00FF">JC @Done                 </font><font color="#008000"><i>{ See if there was an error          }
   </i></font><font color="#FF00FF">Mov ax, fOK              </font><font color="#008000"><i>{ If Not, Then No Error              }
  </i></font><font color="#FF00FF">@Done:
   Pop ds
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

 </font><font color="#FF0000"><b>Function </b></font>SetFileAttr<font color="#000080">(</font>FileName <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">; </font>Attr <font color="#000080">: </font>Byte<font color="#000080">) : </font>Integer<font color="#000080">; </font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>Asm
   </b></font><font color="#FF00FF">Push ds
   Lds dx, FileName         </font><font color="#008000"><i>{ Pascal String of FileName          }
   </i></font><font color="#FF00FF">Call NullString          </font><font color="#008000"><i>{ Change to a Null String            }
   </i></font><font color="#FF00FF">Cmp ax, fOK              </font><font color="#008000"><i>{ Change OK?                         }
   </i></font><font color="#FF00FF">JA @Done                 </font><font color="#008000"><i>{ If not then Exit                   }
   </i></font><font color="#FF00FF">Mov ah, 43h              </font><font color="#008000"><i>{ Dos Function 43h, File Change Mode }
   </i></font><font color="#FF00FF">Mov al, 0                </font><font color="#008000"><i>{ Return Attributes                  }
   </i></font><font color="#FF00FF">Int 21h                  </font><font color="#008000"><i>{ Call Dos                           }
   </i></font><font color="#FF00FF">JC @Done                 </font><font color="#008000"><i>{ See if there was an error          }
   </i></font><font color="#FF00FF">Mov ah, 43h              </font><font color="#008000"><i>{ Dos Function 43h, File Change Mode }
   </i></font><font color="#FF00FF">Mov al, 1                </font><font color="#008000"><i>{ Set File Attributes                }
   </i></font><font color="#FF00FF">Or  cl, Attr             </font><font color="#008000"><i>{ Set Whatever Attributes            }
   </i></font><font color="#FF00FF">Int 21h                  </font><font color="#008000"><i>{ Call Dos                           }
   </i></font><font color="#FF00FF">JC @Done                 </font><font color="#008000"><i>{ See if there was an error          }
   </i></font><font color="#FF00FF">Mov ax, fOK              </font><font color="#008000"><i>{ If Not, Then No Error              }
  </i></font><font color="#FF00FF">@Done:
   Pop ds
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

 </font><font color="#FF0000"><b>Function </b></font>ClearFileAttr<font color="#000080">(</font>FileName <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">; </font>Attr <font color="#000080">: </font>Byte<font color="#000080">) : </font>Integer<font color="#000080">; </font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>Asm
   </b></font><font color="#FF00FF">Push ds
   Lds dx, FileName         </font><font color="#008000"><i>{ Pascal String of FileName          }
   </i></font><font color="#FF00FF">Call NullString          </font><font color="#008000"><i>{ Change to a Null String            }
   </i></font><font color="#FF00FF">Cmp ax, fOK              </font><font color="#008000"><i>{ Change OK?                         }
   </i></font><font color="#FF00FF">JA @Done                 </font><font color="#008000"><i>{ If not then Exit                   }
   </i></font><font color="#FF00FF">Mov ah, 43h              </font><font color="#008000"><i>{ Dos Function 43h, File Change Mode }
   </i></font><font color="#FF00FF">Mov al, 0                </font><font color="#008000"><i>{ Return Attributes                  }
   </i></font><font color="#FF00FF">Int 21h                  </font><font color="#008000"><i>{ Call Dos                           }
   </i></font><font color="#FF00FF">JC @Done                 </font><font color="#008000"><i>{ See if there was an error          }
   </i></font><font color="#FF00FF">Mov ah, 43h
   Mov al, 1                </font><font color="#008000"><i>{ Set File Attributes                }
   </i></font><font color="#FF00FF">Mov bl, Attr             </font><font color="#008000"><i>{ bl := Attr                         }
   </i></font><font color="#FF00FF">Not bl                   </font><font color="#008000"><i>{ Not bl (Attr)                      }
   </i></font><font color="#FF00FF">And cl, bl               </font><font color="#008000"><i>{ Clear Whatever Attributes          }
   </i></font><font color="#FF00FF">Int 21h                  </font><font color="#008000"><i>{ Call Dos                           }
   </i></font><font color="#FF00FF">JC @Done                 </font><font color="#008000"><i>{ See if there was an error          }
   </i></font><font color="#FF00FF">Mov ax, fOK              </font><font color="#008000"><i>{ If Not, Then No Error              }
  </i></font><font color="#FF00FF">@Done:
   Pop ds
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

 </font><font color="#FF0000"><b>Function  </b></font>GetFileAttr<font color="#000080">(</font>FileName <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">) : </font>Byte<font color="#000080">; </font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>Asm
   </b></font><font color="#FF00FF">Push ds                  </font><font color="#008000"><i>{ Push Data Segment                  }
   </i></font><font color="#FF00FF">Lds dx, FileName         </font><font color="#008000"><i>{ Pascal String of FileName          }
   </i></font><font color="#FF00FF">Call NullString          </font><font color="#008000"><i>{ Change to a Null String            }
   </i></font><font color="#FF00FF">Cmp ax, fOK              </font><font color="#008000"><i>{ Change OK?                         }
   </i></font><font color="#FF00FF">JA @Done                 </font><font color="#008000"><i>{ If not then Exit                   }
   </i></font><font color="#FF00FF">Mov ah, 43h              </font><font color="#008000"><i>{ Dos Function 43h, File Change Mode }
   </i></font><font color="#FF00FF">Mov al, 0                </font><font color="#008000"><i>{ Return Attributes                  }
   </i></font><font color="#FF00FF">Int 21h                  </font><font color="#008000"><i>{ Call Dos                           }
   </i></font><font color="#FF00FF">JC @Error                </font><font color="#008000"><i>{ See if there was an error          }
   </i></font><font color="#FF00FF">Mov ax, cx               </font><font color="#008000"><i>{ Return Attributes                  }
   </i></font><font color="#FF00FF">Jmp @Done
  @Error:
   Mov ax, fgError          </font><font color="#008000"><i>{ Return Error }
  </i></font><font color="#FF00FF">@Done:
   Pop ds                   </font><font color="#008000"><i>{ Pop Data Segment }
  </i></font><font color="#FF0000"><b>End</b></font><font color="#000080">;

 </font><font color="#FF0000"><b>Function </b></font>GetFileList <font color="#000080">: </font>FileListP<font color="#000080">;
  </font><font color="#FF0000"><b>Var
   </b></font>Dir  <font color="#000080">: </font>SearchRec<font color="#000080">;
   </font>Temp<font color="#000080">,
   </font>Last <font color="#000080">: </font>FileListP<font color="#000080">;
   </font>I    <font color="#000080">: </font>Word<font color="#000080">;
  </font><font color="#FF0000"><b>Begin
   </b></font>FindFirst<font color="#000080">(</font><font color="#800000">'????????.???'</font><font color="#000080">, </font>AllFiles<font color="#000080">, </font>Dir<font color="#000080">);
   </font>New<font color="#000080">(</font>Temp<font color="#000080">);
   </font>GetFileList <font color="#000080">:= </font>Temp<font color="#000080">;
    </font><font color="#FF0000"><b>Repeat
     </b></font>Temp<font color="#000080">^.</font>Name <font color="#000080">:= </font>Dir<font color="#000080">.</font>Name<font color="#000080">;
     </font>Temp<font color="#000080">^.</font>Attr <font color="#000080">:= </font>Dir<font color="#000080">.</font>Attr<font color="#000080">;
     </font>Temp<font color="#000080">^.</font>Size <font color="#000080">:= </font>Dir<font color="#000080">.</font>Size<font color="#000080">;
     </font>Last <font color="#000080">:= </font>Temp<font color="#000080">;
     </font>New<font color="#000080">(</font>Temp<font color="#000080">^.</font>Next<font color="#000080">);
     </font>Temp <font color="#000080">:= </font>Temp<font color="#000080">^.</font>Next<font color="#000080">;
     </font>FindNext<font color="#000080">(</font>Dir<font color="#000080">);
    </font><font color="#FF0000"><b>Until </b></font>DosError <font color="#000080">&lt;&gt; </font><font color="#800000">0</font><font color="#000080">;
   </font>Dispose<font color="#000080">(</font>Temp<font color="#000080">);
   </font>Last<font color="#000080">^.</font>Next <font color="#000080">:= </font><font color="#FF0000"><b>Nil</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

 </font><font color="#FF0000"><b>Procedure </b></font>RemoveLink<font color="#000080">(</font>List <font color="#000080">: </font>FileListP<font color="#000080">);
  </font><font color="#FF0000"><b>Var
   </b></font>Next <font color="#000080">: </font>FileListP<font color="#000080">;
  </font><font color="#FF0000"><b>Begin
   If </b></font>List<font color="#000080">^.</font>Next <font color="#000080">= </font><font color="#FF0000"><b>Nil Then </b></font>Exit<font color="#000080">;
   </font>Next <font color="#000080">:= </font>List<font color="#000080">^.</font>Next<font color="#000080">^.</font>Next<font color="#000080">;
   </font>Dispose<font color="#000080">(</font>List<font color="#000080">^.</font>Next<font color="#000080">);
   </font>List<font color="#000080">^.</font>Next <font color="#000080">:= </font>Next<font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

 </font><font color="#FF0000"><b>Procedure </b></font>FilterAttr<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>List <font color="#000080">: </font>FileListP<font color="#000080">; </font>Attr <font color="#000080">: </font>Byte<font color="#000080">);
  </font><font color="#FF0000"><b>Var
   </b></font>Temp<font color="#000080">,
   </font>Last <font color="#000080">: </font>FileListP<font color="#000080">;
  </font><font color="#FF0000"><b>Begin
   If </b></font>List <font color="#000080">= </font><font color="#FF0000"><b>Nil Then </b></font>Exit<font color="#000080">;
   </font>Last <font color="#000080">:= </font>List<font color="#000080">;
   </font>Temp <font color="#000080">:= </font>Last<font color="#000080">^.</font>Next<font color="#000080">;
   </font><font color="#FF0000"><b>While </b></font>Temp <font color="#000080">&lt;&gt; </font><font color="#FF0000"><b>Nil Do
    Begin
     If </b></font>Temp<font color="#000080">^.</font>Attr <font color="#FF0000"><b>And </b></font>Attr <font color="#000080">&lt;&gt; </font>Attr <font color="#FF0000"><b>Then </b></font>RemoveLink<font color="#000080">(</font>Last<font color="#000080">)
      </font><font color="#FF0000"><b>Else </b></font>Last <font color="#000080">:= </font>Last<font color="#000080">^.</font>Next<font color="#000080">;
     </font>Temp <font color="#000080">:= </font>Last<font color="#000080">^.</font>Next<font color="#000080">;
    </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
   </font>Temp <font color="#000080">:= </font>List<font color="#000080">;
   </font><font color="#FF0000"><b>If </b></font>Temp<font color="#000080">^.</font>Attr <font color="#FF0000"><b>And </b></font>Attr <font color="#000080">&lt;&gt; </font>Attr <font color="#FF0000"><b>Then
    Begin
     </b></font>New<font color="#000080">(</font>Last<font color="#000080">);
     </font>Last <font color="#000080">:= </font>Temp<font color="#000080">^.</font>Next<font color="#000080">;
     </font>Dispose<font color="#000080">(</font>Temp<font color="#000080">);
     </font>Temp <font color="#000080">:= </font>Last<font color="#000080">;
     </font>List <font color="#000080">:= </font>Temp<font color="#000080">;
    </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

 </font><font color="#FF0000"><b>Function </b></font>EqualNames<font color="#000080">(</font>S1<font color="#000080">, </font>S2 <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">) : </font>Boolean<font color="#000080">; </font><font color="#008000"><i>{ Borrowed from SWAG }
  </i></font><font color="#FF0000"><b>Var
   </b></font>STmp1 <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">[</font><font color="#800000">8</font><font color="#000080">];
   </font>STmp2 <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">[</font><font color="#800000">3</font><font color="#000080">];
   </font>SS1<font color="#000080">, </font>SS2 <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">[</font><font color="#800000">12</font><font color="#000080">];
   </font>I <font color="#000080">: </font>Integer<font color="#000080">;
  </font><font color="#FF0000"><b>Begin
   </b></font>STmp1 <font color="#000080">:= </font>Copy<font color="#000080">(</font>S1<font color="#000080">, </font><font color="#800000">1</font><font color="#000080">, </font>Pos<font color="#000080">(</font><font color="#800000">'.'</font><font color="#000080">, </font>S1<font color="#000080">+</font><font color="#800000">'.'</font><font color="#000080">))+</font><font color="#800000">'????????'</font><font color="#000080">;
   </font><font color="#FF0000"><b>If </b></font><font color="#000080">(</font>Pos<font color="#000080">(</font><font color="#800000">'.'</font><font color="#000080">, </font>S1<font color="#000080">) &gt; </font><font color="#800000">1</font><font color="#000080">) </font><font color="#FF0000"><b>Then </b></font>STmp2 <font color="#000080">:= </font>Copy<font color="#000080">(</font>S1<font color="#000080">, </font>Pos<font color="#000080">(</font><font color="#800000">'.'</font><font color="#000080">, </font>S1<font color="#000080">)+</font><font color="#800000">1</font><font color="#000080">, </font><font color="#800000">3</font><font color="#000080">)+</font><font color="#800000">'???'
    </font><font color="#FF0000"><b>Else </b></font>STmp2 <font color="#000080">:= </font><font color="#800000">'???'</font><font color="#000080">;
   </font><font color="#FF0000"><b>For </b></font>I <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>To </b></font><font color="#800000">8 </font><font color="#FF0000"><b>Do If </b></font>STmp1<font color="#000080">[</font>I<font color="#000080">] = </font><font color="#800000">'*' </font><font color="#FF0000"><b>Then For </b></font>I <font color="#000080">:= </font>I <font color="#FF0000"><b>To </b></font><font color="#800000">8 </font><font color="#FF0000"><b>Do
    </b></font>STmp1<font color="#000080">[</font>I<font color="#000080">] := </font><font color="#800000">'?'</font><font color="#000080">;
   </font><font color="#FF0000"><b>For </b></font>I <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>To </b></font><font color="#800000">3 </font><font color="#FF0000"><b>Do If </b></font>STmp2<font color="#000080">[</font>I<font color="#000080">] = </font><font color="#800000">'*' </font><font color="#FF0000"><b>Then For </b></font>I <font color="#000080">:= </font>I <font color="#FF0000"><b>To </b></font><font color="#800000">3 </font><font color="#FF0000"><b>Do
    </b></font>STmp2<font color="#000080">[</font>I<font color="#000080">] := </font><font color="#800000">'?'</font><font color="#000080">;
   </font>SS1 <font color="#000080">:= </font>STmp1<font color="#000080">+</font><font color="#800000">'.'</font><font color="#000080">+</font>STmp2<font color="#000080">;
   </font>STmp1 <font color="#000080">:= </font>Copy<font color="#000080">(</font>S2<font color="#000080">, </font><font color="#800000">1</font><font color="#000080">, </font>Pos<font color="#000080">(</font><font color="#800000">'.'</font><font color="#000080">, </font>S2<font color="#000080">+</font><font color="#800000">'.'</font><font color="#000080">))+</font><font color="#800000">'????????'</font><font color="#000080">;
   </font><font color="#FF0000"><b>If </b></font><font color="#000080">(</font>Pos<font color="#000080">(</font><font color="#800000">'.'</font><font color="#000080">, </font>S2<font color="#000080">) &gt; </font><font color="#800000">1</font><font color="#000080">) </font><font color="#FF0000"><b>Then </b></font>STmp2 <font color="#000080">:= </font>Copy<font color="#000080">(</font>S2<font color="#000080">, </font>Pos<font color="#000080">(</font><font color="#800000">'.'</font><font color="#000080">, </font>S2<font color="#000080">)+</font><font color="#800000">1</font><font color="#000080">, </font><font color="#800000">3</font><font color="#000080">)+</font><font color="#800000">'???'
    </font><font color="#FF0000"><b>Else </b></font>STmp2 <font color="#000080">:= </font><font color="#800000">'???'</font><font color="#000080">;
   </font><font color="#FF0000"><b>For </b></font>I <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>To </b></font><font color="#800000">8 </font><font color="#FF0000"><b>Do If </b></font>STmp1<font color="#000080">[</font>I<font color="#000080">] = </font><font color="#800000">'*' </font><font color="#FF0000"><b>Then For </b></font>I <font color="#000080">:= </font>I <font color="#FF0000"><b>To </b></font><font color="#800000">8 </font><font color="#FF0000"><b>Do
    </b></font>STmp1<font color="#000080">[</font>I<font color="#000080">] := </font><font color="#800000">'?'</font><font color="#000080">;
   </font><font color="#FF0000"><b>For </b></font>I <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>To </b></font><font color="#800000">3 </font><font color="#FF0000"><b>Do If </b></font>STmp2<font color="#000080">[</font>I<font color="#000080">] = </font><font color="#800000">'*' </font><font color="#FF0000"><b>Then For </b></font>I <font color="#000080">:= </font>I <font color="#FF0000"><b>To </b></font><font color="#800000">3 </font><font color="#FF0000"><b>Do
    </b></font>STmp2<font color="#000080">[</font>I<font color="#000080">] := </font><font color="#800000">'?'</font><font color="#000080">;
   </font>SS2 <font color="#000080">:= </font>STmp1<font color="#000080">+</font><font color="#800000">'.'</font><font color="#000080">+</font>STmp2<font color="#000080">;
   </font>EqualNames <font color="#000080">:= </font>False<font color="#000080">;
   </font><font color="#FF0000"><b>For </b></font>I <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>To </b></font><font color="#800000">12 </font><font color="#FF0000"><b>Do If </b></font><font color="#000080">(</font>UpCase<font color="#000080">(</font>SS1<font color="#000080">[</font>I<font color="#000080">]) &lt;&gt; </font>UpCase<font color="#000080">(</font>SS2<font color="#000080">[</font>I<font color="#000080">])) </font><font color="#FF0000"><b>And
    </b></font><font color="#000080">(</font>SS2<font color="#000080">[</font>I<font color="#000080">] &lt;&gt; </font><font color="#800000">'?'</font><font color="#000080">) </font><font color="#FF0000"><b>Then </b></font>Exit<font color="#000080">;
   </font>EqualNames <font color="#000080">:= </font>True<font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

 </font><font color="#FF0000"><b>Procedure </b></font>FilterName<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>List <font color="#000080">: </font>FileListP<font color="#000080">; </font>Name <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">);
  </font><font color="#FF0000"><b>Var
   </b></font>Temp<font color="#000080">,
   </font>Last <font color="#000080">: </font>FileListP<font color="#000080">;
  </font><font color="#FF0000"><b>Begin
   If </b></font>List <font color="#000080">= </font><font color="#FF0000"><b>Nil Then </b></font>Exit<font color="#000080">;
   </font>Last <font color="#000080">:= </font>List<font color="#000080">;
   </font>Temp <font color="#000080">:= </font>Last<font color="#000080">^.</font>Next<font color="#000080">;
   </font><font color="#FF0000"><b>While </b></font>Temp <font color="#000080">&lt;&gt; </font><font color="#FF0000"><b>Nil Do
    Begin
     If Not </b></font>EqualNames<font color="#000080">(</font>Temp<font color="#000080">^.</font>Name<font color="#000080">, </font>Name<font color="#000080">) </font><font color="#FF0000"><b>Then </b></font>RemoveLink<font color="#000080">(</font>Last<font color="#000080">)
      </font><font color="#FF0000"><b>Else </b></font>Last <font color="#000080">:= </font>Last<font color="#000080">^.</font>Next<font color="#000080">;
     </font>Temp <font color="#000080">:= </font>Last<font color="#000080">^.</font>Next<font color="#000080">;
    </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
   </font>Temp <font color="#000080">:= </font>List<font color="#000080">;
   </font><font color="#FF0000"><b>If Not </b></font>EqualNames<font color="#000080">(</font>Temp<font color="#000080">^.</font>Name<font color="#000080">, </font>Name<font color="#000080">) </font><font color="#FF0000"><b>Then

    Begin
     </b></font>New<font color="#000080">(</font>Last<font color="#000080">);
     </font>Last <font color="#000080">:= </font>Temp<font color="#000080">^.</font>Next<font color="#000080">;
     </font>Dispose<font color="#000080">(</font>Temp<font color="#000080">);
     </font>Temp <font color="#000080">:= </font>Last<font color="#000080">;
     </font>List <font color="#000080">:= </font>Temp<font color="#000080">;
    </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

 </font><font color="#FF0000"><b>Procedure </b></font>FilterNameAttr<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>List <font color="#000080">: </font>FileListP<font color="#000080">; </font>Name <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">; </font>Attr <font color="#000080">: </font>Byte<font color="#000080">);
  </font><font color="#FF0000"><b>Begin
   </b></font>FilterName<font color="#000080">(</font>List<font color="#000080">, </font>Name<font color="#000080">);
   </font>FilterAttr<font color="#000080">(</font>List<font color="#000080">, </font>Attr<font color="#000080">);
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

 </font><font color="#FF0000"><b>Procedure </b></font>DisposeFileList<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>List <font color="#000080">: </font>FileListP<font color="#000080">);
  </font><font color="#FF0000"><b>Var
   </b></font>Temp<font color="#000080">,
   </font>Next <font color="#000080">: </font>FileListP<font color="#000080">;
  </font><font color="#FF0000"><b>Begin
   </b></font>Temp <font color="#000080">:= </font>List<font color="#000080">;
    </font><font color="#FF0000"><b>While </b></font>Temp <font color="#000080">&lt;&gt; </font><font color="#FF0000"><b>Nil Do
     Begin
      </b></font>Next <font color="#000080">:= </font>Temp<font color="#000080">^.</font>Next<font color="#000080">;
      </font>Dispose<font color="#000080">(</font>Temp<font color="#000080">);
      </font>Temp <font color="#000080">:= </font>Next<font color="#000080">;
     </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
   </font>List <font color="#000080">:= </font><font color="#FF0000"><b>Nil</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>End</b></font><font color="#000080">.

</font><font color="#008000"><i>{ ---------------------------    TEST PROGRAM ------------------- }

{$A+,B-,D-,E+,F-,G+,I+,L+,N-,O-,P-,Q-,R-,S-,T-,V+,X+,Y+}
{$M 16384,0,655360}
{ ********************************************************** }
{ ************************* Attribs ************************ }
{ ********************************************************** }
{ **************** Written by: Rick Haines ***************** }
{ **************************** rick.haines@cde.com ********* }
{ ********************************************************** }
{ ***************** Last Revised 03/29/95 ****************** }
{ ********************************************************** }
</i></font><font color="#FF0000"><b>Program </b></font>Attribs<font color="#000080">;
 </font><font color="#FF0000"><b>Uses </b></font>Files<font color="#000080">;

</font><font color="#FF0000"><b>Var
 </b></font>Path      <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
 </font>Lines<font color="#000080">,
 </font>SetAttr<font color="#000080">,
 </font>ClearAttr <font color="#000080">: </font>Byte<font color="#000080">;
 </font>ListIt    <font color="#000080">: </font>Boolean<font color="#000080">;
 </font>Directory<font color="#000080">,
 </font>TempDir   <font color="#000080">: </font>FileListP<font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>HelpMe<font color="#000080">;
 </font><font color="#FF0000"><b>Begin
  </b></font>Writeln<font color="#000080">;
  </font>Writeln<font color="#000080">(</font><font color="#800000">'Attribs v1.0a -- Written by Rick Haines.'</font><font color="#000080">);
  </font>Writeln<font color="#000080">;
  </font>Writeln<font color="#000080">(</font><font color="#800000">'Format is:'</font><font color="#000080">);
  </font>Writeln<font color="#000080">(</font><font color="#800000">' Attribs [/L] [/D] [FileName] [R+|R-] [H+|H-] [S+|S-] [A+|A-] [D+]'</font><font color="#000080">);
  </font>Writeln<font color="#000080">;
  </font>Writeln<font color="#000080">(</font><font color="#800000">'WARNING:'</font><font color="#000080">);
  </font>Writeln<font color="#000080">(</font><font color="#800000">' Without the /L switch, Attribs will change the attributes'</font><font color="#000080">);
  </font>Writeln<font color="#000080">(</font><font color="#800000">' of files instead of listing them!'</font><font color="#000080">);
  </font>Writeln<font color="#000080">;
  </font>Writeln<font color="#000080">(</font><font color="#800000">'[/L] - List files &amp; their attributes (If no params, it is assumed)'</font><font color="#000080">);
  </font>Writeln<font color="#000080">(</font><font color="#800000">'[/D] - Use with /L to list only directories and their attributes'</font><font color="#000080">);
  </font>Writeln<font color="#000080">;
  </font>Writeln<font color="#000080">(</font><font color="#800000">'[FileName] - File(s) to Change/List (WildCards Accepted)'</font><font color="#000080">);
  </font>Writeln<font color="#000080">(</font><font color="#800000">'             If not included it is assumed to be *.*    '</font><font color="#000080">);
  </font>Writeln<font color="#000080">;
  </font>Writeln<font color="#000080">(</font><font color="#800000">'               Without /L              With /L       '</font><font color="#000080">);
  </font>Writeln<font color="#000080">(</font><font color="#800000">'               ~~~~~~~~~~              ~~~~~~~       '</font><font color="#000080">);
  </font>Writeln<font color="#000080">(</font><font color="#800000">'[R+|R-] - Make File(s) ReadOnly | View ReadOnly Files'</font><font color="#000080">);
  </font>Writeln<font color="#000080">(</font><font color="#800000">'[H+|H-] - Make File(s) Hidden   | View Hidden Files  '</font><font color="#000080">);
  </font>Writeln<font color="#000080">(</font><font color="#800000">'[S+|S-] - Make File(s) System   | View System Files  '</font><font color="#000080">);
  </font>Writeln<font color="#000080">(</font><font color="#800000">'[A+|A-] - Make File(s) Archive  | View Archive Files '</font><font color="#000080">);
  </font>Writeln<font color="#000080">(</font><font color="#800000">'[D+]    - Change Dir Attribs    | Do Not Use With /L '</font><font color="#000080">);
  </font>Halt<font color="#000080">;
 </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>ParseCommandLine<font color="#000080">;
 </font><font color="#FF0000"><b>Var
  </b></font>I   <font color="#000080">: </font>Byte<font color="#000080">;
  </font>Par <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
 </font><font color="#FF0000"><b>Begin
  </b></font>Path <font color="#000080">:= </font><font color="#800000">'*.*'</font><font color="#000080">;
  </font><font color="#FF0000"><b>If </b></font>ParamCount <font color="#000080">&lt; </font><font color="#800000">1 </font><font color="#FF0000"><b>Then
   Begin
    </b></font>ListIt <font color="#000080">:= </font>True<font color="#000080">;
    </font>Exit<font color="#000080">;
   </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>For </b></font>I <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>To </b></font>ParamCount <font color="#FF0000"><b>Do
   Begin
    </b></font>Par <font color="#000080">:= </font>ParamStr<font color="#000080">(</font>I<font color="#000080">);
     </font><font color="#FF0000"><b>Case </b></font>UpCase<font color="#000080">(</font>Par<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">]) </font><font color="#FF0000"><b>Of
      </b></font><font color="#800000">'D' </font><font color="#000080">: </font><font color="#FF0000"><b>Case </b></font>Par<font color="#000080">[</font><font color="#800000">2</font><font color="#000080">] </font><font color="#FF0000"><b>Of
             </b></font><font color="#800000">'+' </font><font color="#000080">: </font>ClearAttr <font color="#000080">:= </font>ClearAttr <font color="#FF0000"><b>Or </b></font>SubDir<font color="#000080">;
             </font><font color="#800000">'-' </font><font color="#000080">: </font>SetAttr <font color="#000080">:= </font>SetAttr <font color="#FF0000"><b>Or </b></font>SubDir<font color="#000080">;
             </font><font color="#FF0000"><b>Else </b></font>Path <font color="#000080">:= </font>Par<font color="#000080">;
            </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
      </font><font color="#800000">'H' </font><font color="#000080">: </font><font color="#FF0000"><b>Case </b></font>Par<font color="#000080">[</font><font color="#800000">2</font><font color="#000080">] </font><font color="#FF0000"><b>Of
             </b></font><font color="#800000">'+' </font><font color="#000080">: </font>SetAttr <font color="#000080">:= </font>SetAttr <font color="#FF0000"><b>Or </b></font>HiddenF<font color="#000080">;
             </font><font color="#800000">'-' </font><font color="#000080">: </font>ClearAttr <font color="#000080">:= </font>ClearAttr <font color="#FF0000"><b>Or </b></font>HiddenF<font color="#000080">;
             </font><font color="#FF0000"><b>Else </b></font>Path <font color="#000080">:= </font>Par<font color="#000080">;
            </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
      </font><font color="#800000">'S' </font><font color="#000080">: </font><font color="#FF0000"><b>Case </b></font>Par<font color="#000080">[</font><font color="#800000">2</font><font color="#000080">] </font><font color="#FF0000"><b>Of
             </b></font><font color="#800000">'+' </font><font color="#000080">: </font>SetAttr <font color="#000080">:= </font>SetAttr <font color="#FF0000"><b>Or </b></font>SystemF<font color="#000080">;
             </font><font color="#800000">'-' </font><font color="#000080">: </font>ClearAttr <font color="#000080">:= </font>ClearAttr <font color="#FF0000"><b>Or </b></font>SystemF<font color="#000080">;
             </font><font color="#FF0000"><b>Else </b></font>Path <font color="#000080">:= </font>Par<font color="#000080">;
            </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
      </font><font color="#800000">'R' </font><font color="#000080">: </font><font color="#FF0000"><b>Case </b></font>Par<font color="#000080">[</font><font color="#800000">2</font><font color="#000080">] </font><font color="#FF0000"><b>Of
             </b></font><font color="#800000">'+' </font><font color="#000080">: </font>SetAttr <font color="#000080">:= </font>SetAttr <font color="#FF0000"><b>Or </b></font>ReadOnlyF<font color="#000080">;
             </font><font color="#800000">'-' </font><font color="#000080">: </font>ClearAttr <font color="#000080">:= </font>SetAttr <font color="#FF0000"><b>Or </b></font>ReadOnlyF<font color="#000080">;
             </font><font color="#FF0000"><b>Else </b></font>Path <font color="#000080">:= </font>Par<font color="#000080">;
            </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
      </font><font color="#800000">'A' </font><font color="#000080">: </font><font color="#FF0000"><b>Case </b></font>Par<font color="#000080">[</font><font color="#800000">2</font><font color="#000080">] </font><font color="#FF0000"><b>Of
             </b></font><font color="#800000">'+' </font><font color="#000080">: </font>SetAttr <font color="#000080">:= </font>SetAttr <font color="#FF0000"><b>Or </b></font>ArchiveF<font color="#000080">;
             </font><font color="#800000">'-' </font><font color="#000080">: </font>ClearAttr <font color="#000080">:= </font>ClearAttr <font color="#FF0000"><b>Or </b></font>ArchiveF<font color="#000080">;
             </font><font color="#FF0000"><b>Else </b></font>Path <font color="#000080">:= </font>Par<font color="#000080">;
            </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
      </font><font color="#800000">'/' </font><font color="#000080">: </font><font color="#FF0000"><b>Case </b></font>UpCase<font color="#000080">(</font>Par<font color="#000080">[</font><font color="#800000">2</font><font color="#000080">]) </font><font color="#FF0000"><b>Of
             </b></font><font color="#800000">'L' </font><font color="#000080">: </font>ListIt <font color="#000080">:= </font>True<font color="#000080">;
             </font><font color="#800000">'D' </font><font color="#000080">: </font>SetAttr <font color="#000080">:= </font>SetAttr <font color="#FF0000"><b>Or </b></font>SubDir<font color="#000080">;
             </font><font color="#800000">'?' </font><font color="#000080">: </font>HelpMe<font color="#000080">;
             </font><font color="#FF0000"><b>Else </b></font>Path <font color="#000080">:= </font>Par<font color="#000080">;
            </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>Else </b></font>Path <font color="#000080">:= </font>Par<font color="#000080">;
     </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
   </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
 </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>GetBit<font color="#000080">(</font>Byte<font color="#000080">, </font>Bit <font color="#000080">: </font>Word<font color="#000080">) : </font>Boolean<font color="#000080">;
 </font><font color="#FF0000"><b>Begin
  </b></font>Byte <font color="#000080">:= </font>Byte <font color="#FF0000"><b>And </b></font><font color="#000080">(</font><font color="#800000">1 </font><font color="#FF0000"><b>ShL </b></font>Bit<font color="#000080">);
  </font>GetBit <font color="#000080">:= (</font>Byte <font color="#000080">= (</font><font color="#800000">1 </font><font color="#FF0000"><b>ShL </b></font>Bit<font color="#000080">));
 </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>WriteAttr<font color="#000080">(</font>Attr <font color="#000080">: </font>Byte<font color="#000080">);
 </font><font color="#FF0000"><b>Begin
  If </b></font>GetBit<font color="#000080">(</font>Attr<font color="#000080">, </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>Then </b></font>Write<font color="#000080">(</font><font color="#800000">'R'</font><font color="#000080">) </font><font color="#FF0000"><b>Else </b></font>Write<font color="#000080">(</font><font color="#800000">' '</font><font color="#000080">);
  </font><font color="#FF0000"><b>If </b></font>GetBit<font color="#000080">(</font>Attr<font color="#000080">, </font><font color="#800000">1</font><font color="#000080">) </font><font color="#FF0000"><b>Then </b></font>Write<font color="#000080">(</font><font color="#800000">' H'</font><font color="#000080">) </font><font color="#FF0000"><b>Else </b></font>Write<font color="#000080">(</font><font color="#800000">'  '</font><font color="#000080">);
  </font><font color="#FF0000"><b>If </b></font>GetBit<font color="#000080">(</font>Attr<font color="#000080">, </font><font color="#800000">2</font><font color="#000080">) </font><font color="#FF0000"><b>Then </b></font>Write<font color="#000080">(</font><font color="#800000">' S'</font><font color="#000080">) </font><font color="#FF0000"><b>Else </b></font>Write<font color="#000080">(</font><font color="#800000">'  '</font><font color="#000080">);
  </font><font color="#FF0000"><b>If </b></font>GetBit<font color="#000080">(</font>Attr<font color="#000080">, </font><font color="#800000">5</font><font color="#000080">) </font><font color="#FF0000"><b>Then </b></font>Write<font color="#000080">(</font><font color="#800000">' A'</font><font color="#000080">) </font><font color="#FF0000"><b>Else </b></font>Write<font color="#000080">(</font><font color="#800000">'  '</font><font color="#000080">);
  </font><font color="#FF0000"><b>If </b></font>GetBit<font color="#000080">(</font>Attr<font color="#000080">, </font><font color="#800000">3</font><font color="#000080">) </font><font color="#FF0000"><b>Then </b></font>Write<font color="#000080">(</font><font color="#800000">' V'</font><font color="#000080">) </font><font color="#FF0000"><b>Else </b></font>Write<font color="#000080">(</font><font color="#800000">'  '</font><font color="#000080">);
  </font><font color="#FF0000"><b>If </b></font>GetBit<font color="#000080">(</font>Attr<font color="#000080">, </font><font color="#800000">4</font><font color="#000080">) </font><font color="#FF0000"><b>Then </b></font>Write<font color="#000080">(</font><font color="#800000">' Dir'</font><font color="#000080">) </font><font color="#FF0000"><b>Else </b></font>Write<font color="#000080">(</font><font color="#800000">'    '</font><font color="#000080">);
  </font>Write<font color="#000080">(</font><font color="#800000">'  '</font><font color="#000080">);
 </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>ReadKey <font color="#000080">: </font>Char<font color="#000080">; </font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;
 </font><font color="#FF0000"><b>Asm
  </b></font><font color="#FF00FF">Mov ax, 0
  Int 16h
 </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Begin
 </b></font>SetAttr <font color="#000080">:= </font>NormalF<font color="#000080">;
 </font>ClearAttr <font color="#000080">:= </font>NormalF<font color="#000080">;
 </font>ParseCommandLine<font color="#000080">;
 </font>Directory <font color="#000080">:= </font>GetFileList<font color="#000080">;
 </font>FilterName<font color="#000080">(</font>Directory<font color="#000080">, </font>Path<font color="#000080">);
 </font>Writeln<font color="#000080">;
 </font><font color="#FF0000"><b>If </b></font>ListIt <font color="#FF0000"><b>Then
  Begin
   </b></font>Lines <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
   </font>FilterAttr<font color="#000080">(</font>Directory<font color="#000080">, </font>SetAttr<font color="#000080">);
   </font>TempDir <font color="#000080">:= </font>Directory<font color="#000080">;
   </font><font color="#FF0000"><b>If </b></font>TempDir <font color="#000080">= </font><font color="#FF0000"><b>Nil Then </b></font>Writeln<font color="#000080">(</font><font color="#800000">'No Files Found'</font><font color="#000080">);
   </font><font color="#FF0000"><b>While </b></font>TempDir <font color="#000080">&lt;&gt; </font><font color="#FF0000"><b>Nil Do
    Begin
     </b></font>WriteAttr<font color="#000080">(</font>TempDir<font color="#000080">^.</font>Attr<font color="#000080">);
     </font>Writeln<font color="#000080">(</font>TempDir<font color="#000080">^.</font>Name<font color="#000080">);
     </font>TempDir <font color="#000080">:= </font>TempDir<font color="#000080">^.</font>Next<font color="#000080">;
     </font>Inc<font color="#000080">(</font>Lines<font color="#000080">);
     </font><font color="#FF0000"><b>If </b></font>Lines <font color="#000080">&gt;= </font><font color="#800000">24 </font><font color="#FF0000"><b>Then
      Begin
       </b></font>Write<font color="#000080">(</font><font color="#800000">'--Press any key to continue--'</font><font color="#000080">);
       </font>ReadKey<font color="#000080">;
       </font>Writeln<font color="#000080">;
       </font>Lines <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
      </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
 </font><font color="#FF0000"><b>If Not </b></font>ListIt <font color="#FF0000"><b>Then
  Begin
   </b></font>TempDir <font color="#000080">:= </font>Directory<font color="#000080">;
   </font><font color="#FF0000"><b>While </b></font>TempDir <font color="#000080">&lt;&gt; </font><font color="#FF0000"><b>Nil Do
    Begin
     </b></font>TempDir<font color="#000080">^.</font>Attr <font color="#000080">:= (</font>TempDir<font color="#000080">^.</font>Attr <font color="#FF0000"><b>And Not </b></font>ClearAttr<font color="#000080">) </font><font color="#FF0000"><b>Or </b></font>SetAttr<font color="#000080">;
     </font>SetNewFileAttr<font color="#000080">(</font>TempDir<font color="#000080">^.</font>Name<font color="#000080">, </font>TempDir<font color="#000080">^.</font>Attr<font color="#000080">);
     </font>TempDir <font color="#000080">:= </font>TempDir<font color="#000080">^.</font>Next<font color="#000080">;
    </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
   </font><font color="#FF0000"><b>If </b></font>Directory <font color="#000080">= </font><font color="#FF0000"><b>Nil Then </b></font>Writeln<font color="#000080">(</font><font color="#800000">'No Files Found'</font><font color="#000080">) </font><font color="#FF0000"><b>Else </b></font>Writeln<font color="#000080">(</font><font color="#800000">'Success!'</font><font color="#000080">);
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
 </font>DisposeFileList<font color="#000080">(</font>Directory<font color="#000080">);
</font><font color="#FF0000"><b>End</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to FILES SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0078.PAS">Original</a><b>]</b></p></body>
</html>
