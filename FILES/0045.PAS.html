<html>
<head><title> "More File Handles" by BRIAN GRAINGER</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to FILES SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0045.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
From: BRIAN GRAINGER               Refer#: NONE
Subj: Multiple open files            Conf: (58) Pascal
---------------------------------------------------------------------------
RL&plusmn;I would like to open 20-50 silumtaneous files (in TP 6.0 or 7.0).

Two ways that I know of. The first involves sleuthing around in the
Program Segment Prefix prepended to the memory image of a program's .EXE
file. This involves undocumented DOS calls, but is known to work.

The second is to use Interrupt 21h, Function 67h, Set Handle Count.
This is buggy in the original release of DOS 3.3, but is apparently
reliable in later versions.
}

</i></font><font color="#FF0000"><b>USES
  </b></font>Dos<font color="#000080">;

</font><font color="#FF0000"><b>CONST
  </b></font>LotsaHandles <font color="#000080">= </font><font color="#800000">24861</font><font color="#000080">;

</font><font color="#FF0000"><b>FUNCTION </b></font>SetHandleCount<font color="#000080">(</font>Count <font color="#000080">: </font>WORD<font color="#000080">) : </font>WORD<font color="#000080">;
  </font><font color="#FF0000"><b>VAR
    </b></font>Regs <font color="#000080">: </font>Registers<font color="#000080">;
  </font><font color="#FF0000"><b>BEGIN
    </b></font>SetHandleCount <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
    </font><font color="#FF0000"><b>WITH </b></font>Regs <font color="#FF0000"><b>DO
      BEGIN
        </b></font>AH <font color="#000080">:= </font><font color="#800000">$67</font><font color="#000080">;
        </font>BX <font color="#000080">:= </font>Count<font color="#000080">;
        </font>Intr<font color="#000080">(</font><font color="#800000">$21</font><font color="#000080">, </font>Regs<font color="#000080">);
        </font><font color="#FF0000"><b>IF </b></font>Flags <font color="#FF0000"><b>AND </b></font>fCarry <font color="#000080">&lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>THEN </b></font><font color="#008000"><i>(* Error?                *)
          </i></font>SetHandleCount <font color="#000080">:= </font>AX<font color="#000080">;       </font><font color="#008000"><i>(* AX returns error code *)
      </i></font><font color="#FF0000"><b>END</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>BEGIN
  IF </b></font>SetHandleCount<font color="#000080">(</font>LotsaHandles<font color="#000080">) &lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>THEN
    </b></font>WriteLn<font color="#000080">(</font><font color="#800000">'Sorry. Better luck next time.'</font><font color="#000080">)
  </font><font color="#FF0000"><b>ELSE
    </b></font>WriteLn<font color="#000080">(</font><font color="#800000">'What do think I am, a mainframe?'</font><font color="#000080">);
</font><font color="#FF0000"><b>END</b></font><font color="#000080">.

</font><font color="#008000"><i>{ ASSEMBLER TO DO THE SAME THING

(If you are not using protected mode you have to limit the use of DOS memory
by using compiler direvtive $M in BP. DOS steals the first 5 handles for std.
devices. This require at least DOS 3.3)
}


</i></font><font color="#FF0000"><b>procedure </b></font>SetHandleCount<font color="#000080">( </font>wInAnt<font color="#000080">: </font>WORD <font color="#000080">);
</font><font color="#FF0000"><b>var
 </b></font>err            <font color="#000080">: </font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>begin
asm

        </b></font><font color="#FF00FF">MOV     AX, $6700;
        MOV     BX, wInAnt
        INT     $21
        MOV     err, 0
        JNC     @l1
        MOV     err, 1          </font><font color="#008000"><i>{ Error! }
</i></font><font color="#FF00FF">@l1:
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font>err <font color="#FF0000"><b>then begin
    </b></font>ClrScr<font color="#000080">;
    </font>writeln<font color="#000080">(</font><font color="#800000">'Not enough memory'</font><font color="#000080">);
    </font>halt<font color="#000080">(</font><font color="#800000">0</font><font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to FILES SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0045.PAS">Original</a><b>]</b></p></body>
</html>
