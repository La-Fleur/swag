<html>
<head><title> "Low Level File Routines" by GREG ESTABROOKS</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to FILES SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0049.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#FF0000"><b>UNIT </b></font>FILEIO<font color="#000080">;            </font><font color="#008000"><i>{ Low Level File handling routines. Jan 18/94   }
                        { Copyright (C) 1993,1994 Greg Estabrooks       }
                        { NOTE: Requires TP 6.0+ to compile.            }
</i></font><font color="#FF0000"><b>INTERFACE
</b></font><font color="#008000"><i>{***********************************************************************}
</i></font><font color="#FF0000"><b>USES </b></font>DOS<font color="#000080">;                       </font><font color="#008000"><i>{ IMPORT FSearch.                       }
</i></font><font color="#FF0000"><b>CONST                           </b></font><font color="#008000"><i>{ Handles PreDefined by DOS.            }
     </i></font>fStdIn     <font color="#000080">= </font><font color="#800000">$00</font><font color="#000080">;          </font><font color="#008000"><i>{ STD Input Device, (Keyboard).         }
     </i></font>fStdOut    <font color="#000080">= </font><font color="#800000">$01</font><font color="#000080">;          </font><font color="#008000"><i>{ STD Output Device,(CRT).              }
     </i></font>fStdErr    <font color="#000080">= </font><font color="#800000">$02</font><font color="#000080">;          </font><font color="#008000"><i>{ STD Error Device, (CRT).              }
     </i></font>fStdCom    <font color="#000080">= </font><font color="#800000">$03</font><font color="#000080">;          </font><font color="#008000"><i>{ STD Comm.                             }
     </i></font>fStdPrn    <font color="#000080">= </font><font color="#800000">$04</font><font color="#000080">;          </font><font color="#008000"><i>{ STD Printer.                          }
     </i></font>oRead      <font color="#000080">= </font><font color="#800000">$00</font><font color="#000080">;          </font><font color="#008000"><i>{ Opens a file for read only.           }
     </i></font>oWrite     <font color="#000080">= </font><font color="#800000">$01</font><font color="#000080">;          </font><font color="#008000"><i>{ Opens a file for writing only.        }
     </i></font>oReadWrite <font color="#000080">= </font><font color="#800000">$02</font><font color="#000080">;          </font><font color="#008000"><i>{ Opens a file for reading and writing. }
     </i></font>oDenyAll   <font color="#000080">= </font><font color="#800000">$10</font><font color="#000080">;          </font><font color="#008000"><i>{ Deny access to other processes.       }
     </i></font>oDenyWrite <font color="#000080">= </font><font color="#800000">$20</font><font color="#000080">;          </font><font color="#008000"><i>{ Deny write access to other processes. }
     </i></font>oDenyRead  <font color="#000080">= </font><font color="#800000">$30</font><font color="#000080">;          </font><font color="#008000"><i>{ Deny read access to other processes.  }
     </i></font>oDenyNone  <font color="#000080">= </font><font color="#800000">$40</font><font color="#000080">;          </font><font color="#008000"><i>{ Allow free access to other processes. }
                                { Possible file attribs,can be combined.}
     </i></font>aNormal   <font color="#000080">= </font><font color="#800000">$00</font><font color="#000080">;  </font>aSystem <font color="#000080">= </font><font color="#800000">$04</font><font color="#000080">;  </font>aArchive <font color="#000080">= </font><font color="#800000">$20</font><font color="#000080">;
     </font>aReadOnly <font color="#000080">= </font><font color="#800000">$01</font><font color="#000080">;  </font>aVolume <font color="#000080">= </font><font color="#800000">$08</font><font color="#000080">;
     </font>aHidden   <font color="#000080">= </font><font color="#800000">$02</font><font color="#000080">;  </font>aDir    <font color="#000080">= </font><font color="#800000">$10</font><font color="#000080">;
</font><font color="#FF0000"><b>TYPE
    </b></font>LockType <font color="#000080">= (</font>Lock<font color="#000080">,</font>UnLock<font color="#000080">);   </font><font color="#008000"><i>{ Ordinal Type for use with 'fLock'.    }
</i></font><font color="#FF0000"><b>VAR
   </b></font>fError  <font color="#000080">:</font>WORD<font color="#000080">;               </font><font color="#008000"><i>{ Holds any error codes from routines.  }

</i></font><font color="#FF0000"><b>PROCEDURE </b></font>ASCIIZ<font color="#000080">( </font><font color="#FF0000"><b>VAR </b></font>fName <font color="#000080">:</font><font color="#FF0000"><b>STRING </b></font><font color="#000080">);
                         </font><font color="#008000"><i>{ Routine to add a NULL to a string to make it }
                         { ASCIIZ compatible.                           }
                         { File routines automatically call this routine}
                         { usage :                                      }
                         {  ASCIIZ(fName);                              }

</i></font><font color="#FF0000"><b>FUNCTION  </b></font>fCreate<font color="#000080">( </font>fName <font color="#000080">:</font><font color="#FF0000"><b>STRING</b></font><font color="#000080">; </font>Attr <font color="#000080">:</font>BYTE <font color="#000080">) :</font>WORD<font color="#000080">;
                         </font><font color="#008000"><i>{ Routine to Create 'fName' with an attribute  }
                         { of 'Attr'. If the file already exists then it}
                         { will be truncated to a zero length file.     }
                         { Returns a WORD value containing the  handle. }
                         { Uses Int 21h/AH=3Ch.                         }
                         { usage :                                      }
                         {  handle := fCreate('Temp.Dat',aNormal);      }

</i></font><font color="#FF0000"><b>FUNCTION  </b></font>fOpen<font color="#000080">( </font>fName <font color="#000080">:</font><font color="#FF0000"><b>STRING</b></font><font color="#000080">; </font>Mode <font color="#000080">:</font>BYTE <font color="#000080">) :</font>WORD<font color="#000080">;
                         </font><font color="#008000"><i>{ Routine to open already existing file defined}
                         { in 'fName' with an opening mode of 'Mode'.   }
                         { Returns a WORD value containing the  handle. }
                         { Uses Int 21h/AH=3Dh.                         }
                         { usage :                                      }
                         {  handle := fOpen('Temp.Dat',oRead);          }

</i></font><font color="#FF0000"><b>PROCEDURE </b></font>fRead<font color="#000080">( </font>fHandle <font color="#000080">:</font>WORD<font color="#000080">; </font><font color="#FF0000"><b>VAR </b></font>Buff<font color="#000080">; </font>NTRead<font color="#000080">:</font>WORD<font color="#000080">; </font><font color="#FF0000"><b>VAR </b></font>ARead <font color="#000080">:</font>WORD <font color="#000080">);
                         </font><font color="#008000"><i>{ Reads 'NTRead' bytes of data from 'fHandle'  }
                         { and puts it in 'Buff'. The actually amount   }
                         { of bytes read is returned in 'ARead'.        }
                         { Uses Int 21h/AH=3Fh.                         }
                         { usage :                                      }
                         {  fRead(handle,Buffer,SizeOf(Buffer),ARead);  }

</i></font><font color="#FF0000"><b>PROCEDURE </b></font>fWrite<font color="#000080">( </font>fHandle <font color="#000080">:</font>WORD<font color="#000080">; </font><font color="#FF0000"><b>VAR </b></font>Buff<font color="#000080">; </font>NTWrite<font color="#000080">:</font>WORD<font color="#000080">; </font><font color="#FF0000"><b>VAR </b></font>AWrite <font color="#000080">:</font>WORD <font color="#000080">);
                         </font><font color="#008000"><i>{ Writes 'NTWrite' bytes of info from 'Buff'   }
                         { to 'fHandle'. The actually amount written is }
                         { returned in 'AWrite'.                        }
                         { Uses Int 21h/AH=40h.                         }
                         { usage :                                      }
                         {  fWrite(handle,Buffer,SizeOf(Buffer),AWrite);}

</i></font><font color="#FF0000"><b>PROCEDURE </b></font>fClose<font color="#000080">( </font>fHandle <font color="#000080">:</font>WORD <font color="#000080">);
                         </font><font color="#008000"><i>{ Routine to close file 'fHandle'. This updates}
                         { the directory time and size enteries.        }
                         { Uses Int 21h/AH=3Eh.                         }
                         { usage :                                      }
                         {  fClose(handle);                             }

</i></font><font color="#FF0000"><b>PROCEDURE </b></font>fReset<font color="#000080">(  </font>fHandle <font color="#000080">:</font>WORD <font color="#000080">);
                         </font><font color="#008000"><i>{ Routine to reset file position pointer to the}
                         { beginning of 'fHandle'.                      }
                         { Uses Int 21h/AH=42h.                         }
                         { usage :                                      }
                         {  fReset(handle);                             }

</i></font><font color="#FF0000"><b>PROCEDURE </b></font>fAppend<font color="#000080">( </font>fHandle <font color="#000080">:</font>WORD <font color="#000080">);
                         </font><font color="#008000"><i>{ Routine to move the File position pointer of }
                         { 'fHandle' to the end of the file. Any further}
                         { writing is added to the end of the file.     }
                         { Uses Int 21h/AH=42h.                         }
                         { usage :                                      }
                         {  fAppend(handle);                            }

</i></font><font color="#FF0000"><b>PROCEDURE </b></font>fSeek<font color="#000080">( </font>fHandle <font color="#000080">:</font>WORD<font color="#000080">; </font>fOfs <font color="#000080">:</font>LONGINT <font color="#000080">);
                         </font><font color="#008000"><i>{ Routine to move the file position pointer for}
                         { 'fHandle' to 'fOfs'. 'fOfs' is the actual    }
                         { byte position in the file to move to.        }
                         { Uses Int 21h/AH=42h.                         }
                         { usage :                                      }
                         {  fSeek(handle,1023);                         }

</i></font><font color="#FF0000"><b>PROCEDURE </b></font>fErase<font color="#000080">( </font>fName <font color="#000080">:</font><font color="#FF0000"><b>STRING </b></font><font color="#000080">);
                         </font><font color="#008000"><i>{ Routine to erase 'fName'.                    }
                         { Uses Int 21h/AH=41h.                         }
                         { usage :                                      }
                         {  fErase('Temp.Dat');                         }

</i></font><font color="#FF0000"><b>FUNCTION  </b></font>fPos<font color="#000080">( </font>fHandle <font color="#000080">:</font>WORD <font color="#000080">) :</font>LONGINT<font color="#000080">;
                         </font><font color="#008000"><i>{ Routine to return the current position within}
                         { 'fHandle'.                                   }
                         { Uses Int 21h/AH=42.                          }
                         { usage :                                      }
                         {  CurPos := fPos(handle);                     }

</i></font><font color="#FF0000"><b>FUNCTION  </b></font>fEof<font color="#000080">( </font>fHandle <font color="#000080">:</font>WORD <font color="#000080">) :</font>BOOLEAN<font color="#000080">;
                         </font><font color="#008000"><i>{ Routine to determine whether or not we're    }
                         { currently at the end of file 'fHandle'.      }
                         { usage :                                      }
                         {  IsEnd := fEof(handle);                      }

</i></font><font color="#FF0000"><b>FUNCTION  </b></font>fExist<font color="#000080">( </font>fName <font color="#000080">:</font><font color="#FF0000"><b>STRING </b></font><font color="#000080">) :</font>BOOLEAN<font color="#000080">;
                         </font><font color="#008000"><i>{ Routine to determine whether or not 'fName'  }
                         { exists.                                      }
                         { usage :                                      }
                         {  Exist := fExist('Temp.Dat');                }

</i></font><font color="#FF0000"><b>FUNCTION  </b></font>fGetAttr<font color="#000080">( </font>fName <font color="#000080">:</font><font color="#FF0000"><b>STRING </b></font><font color="#000080">) :</font>BYTE<font color="#000080">;
                         </font><font color="#008000"><i>{ Routine to return the current file attribute }
                         { of 'fName'.                                  }
                         { Uses Int 21h/AH=43h,AL=00h.                  }
                         { usage :                                      }
                         {  CurAttr := fGetAttr('Temp.Dat');            }

</i></font><font color="#FF0000"><b>PROCEDURE </b></font>fSetAttr<font color="#000080">( </font>fName <font color="#000080">:</font><font color="#FF0000"><b>STRING</b></font><font color="#000080">; </font>NAttr <font color="#000080">:</font>BYTE <font color="#000080">);
                         </font><font color="#008000"><i>{ Routine to set file attribute of 'fName' to  }
                         { 'NAttr'.                                     }
                         { Uses Int 21h/AH=43h,AL=01h.                  }
                         { usage :                                      }
                         {  fSetAttr('Temp.Dat',aArchive OR aReadOnly); }

</i></font><font color="#FF0000"><b>PROCEDURE </b></font>fSetVerify<font color="#000080">( </font>On_Off <font color="#000080">:</font>BOOLEAN <font color="#000080">);
                         </font><font color="#008000"><i>{ Routine to set the DOS verify flag ON or OFF.}
                         { depending on 'On_Off'.                       }
                         { TRUE = ON, FALSE = OFF.                      }
                         { Uses Int 21h/AH=2Eh.                         }
                         { usage :                                      }
                         {  fSetVerify( TRUE );                         }

</i></font><font color="#FF0000"><b>FUNCTION  </b></font>fGetVerify <font color="#000080">:</font>BOOLEAN<font color="#000080">;
                         </font><font color="#008000"><i>{ Routine to return the current state of the   }
                         { DOS verify flag.                             }
                         { Uses Int 21h/AH=54h.                         }
                         { usage :                                      }
                         {  IsVerify := fGetVerify;                     }

</i></font><font color="#FF0000"><b>FUNCTION  </b></font>fSize<font color="#000080">( </font>fHandle <font color="#000080">:</font>WORD <font color="#000080">) :</font>LONGINT<font color="#000080">;
                         </font><font color="#008000"><i>{ Routine to determine the size in bytes of    }
                         { 'fHandle'.                                   }
                         { usage :                                      }
                         {  CurSize := fSize(handle);                   }

</i></font><font color="#FF0000"><b>PROCEDURE </b></font>fFlush<font color="#000080">( </font>fHandle <font color="#000080">:</font>WORD <font color="#000080">);
                         </font><font color="#008000"><i>{ Flushes any File buffers for 'fHandle'       }
                         { immediately and updates the directory entry. }
                         { Uses Int 21h/AH=68h.                         }
                         { usage :                                      }
                         {  fFlush(handle);                             }

</i></font><font color="#FF0000"><b>PROCEDURE </b></font>fLock<font color="#000080">( </font>fHandle <font color="#000080">:</font>WORD<font color="#000080">; </font>LockInf <font color="#000080">:</font>LockType<font color="#000080">; </font>StartOfs<font color="#000080">,</font>Len <font color="#000080">:</font>LONGINT <font color="#000080">);
                         </font><font color="#008000"><i>{ Routine to lock/unlock parts of a open file.  }
                         { Locking or unlock is determined by 'LockInf'. }
                         { Uses Int 21h/AH=5Ch.                          }
                         { usage :                                       }
                         {  fLock(handle,Lock,1000,500);                 }
{***********************************************************************}
</i></font><font color="#FF0000"><b>IMPLEMENTATION


PROCEDURE </b></font>ASCIIZ<font color="#000080">( </font><font color="#FF0000"><b>VAR </b></font>fName <font color="#000080">:</font><font color="#FF0000"><b>STRING </b></font><font color="#000080">); </font><font color="#FF0000"><b>ASSEMBLER</b></font><font color="#000080">;
                         </font><font color="#008000"><i>{ Routine to add a NULL to a string to make it }
                         { ASCIIZ compatible.                           }
                         { File routines automatically call this routine}
</i></font><font color="#FF0000"><b>ASM
  </b></font><font color="#FF00FF">Push DS                       </font><font color="#008000"><i>{ Push DS onto the stack.               }
  </i></font><font color="#FF00FF">LDS DI,fname                  </font><font color="#008000"><i>{ Point DS:DI ---&gt; fName.               }
  </i></font><font color="#FF00FF">Xor BX,BX                     </font><font color="#008000"><i>{ Clear BX.                             }
  </i></font><font color="#FF00FF">Mov BL,BYTE PTR DS:[DI]       </font><font color="#008000"><i>{ Load length of string into BL.        }
  </i></font><font color="#FF00FF">Inc BL                        </font><font color="#008000"><i>{ Point to char after last one in name. }
  </i></font><font color="#FF00FF">Mov BYTE PTR DS:[DI+BX],0     </font><font color="#008000"><i>{ Now make it a ASCIIZ string.          }
  </i></font><font color="#FF00FF">Pop DS                        </font><font color="#008000"><i>{ Pop DS off the stack.                 }
</i></font><font color="#FF0000"><b>END</b></font><font color="#000080">;</font><font color="#008000"><i>{ASCIIZ}

</i></font><font color="#FF0000"><b>FUNCTION  </b></font>fCreate<font color="#000080">( </font>fName <font color="#000080">:</font><font color="#FF0000"><b>STRING</b></font><font color="#000080">; </font>Attr <font color="#000080">:</font>BYTE <font color="#000080">) :</font>WORD<font color="#000080">;
                         </font><font color="#008000"><i>{ Routine to Create 'fName' with an attribute  }
                         { of 'Attr'. If the file already exists then it}
                         { will be truncated to a zero length file.     }
                         { Returns a WORD value containing the  handle. }
                         { Uses Int 21h/AH=3Ch.                         }
</i></font><font color="#FF0000"><b>BEGIN
  </b></font>ASCIIZ<font color="#000080">(</font>fName<font color="#000080">);                </font><font color="#008000"><i>{ Convert fName to an ASCIIZ string.    }
  </i></font><font color="#FF0000"><b>ASM
    </b></font><font color="#FF00FF">Push DS                     </font><font color="#008000"><i>{ Push DS Onto stack.                   }
    </i></font><font color="#FF00FF">Mov fError,0                </font><font color="#008000"><i>{ Clear Error Flag.                     }
    </i></font><font color="#FF00FF">Mov AX,SS                   </font><font color="#008000"><i>{ Load AX with SS.                      }
    </i></font><font color="#FF00FF">Mov DS,AX                   </font><font color="#008000"><i>{ Now load that value into DS.          }
    </i></font><font color="#FF00FF">Lea DX,fName                </font><font color="#008000"><i>{ Now load DX with the offset of DX.    }
    </i></font><font color="#FF00FF">Inc DX                      </font><font color="#008000"><i>{ Move past length byte.                }
    </i></font><font color="#FF00FF">Xor CH,CH                   </font><font color="#008000"><i>{ Clear High byte of CX.                }
    </i></font><font color="#FF00FF">Mov CL,Attr                 </font><font color="#008000"><i>{ Load attribute to give new file.      }
    </i></font><font color="#FF00FF">Mov AH,$3C                  </font><font color="#008000"><i>{ Function to create a file.            }
    </i></font><font color="#FF00FF">Int $21                     </font><font color="#008000"><i>{ Call dos to create file.              }
    </i></font><font color="#FF00FF">Jnc @Exit                   </font><font color="#008000"><i>{ If no error exit.                     }
    </i></font><font color="#FF00FF">Mov fError,AX               </font><font color="#008000"><i>{ If there was an  error save it.       }
  </i></font><font color="#FF00FF">@Exit:
    Mov @Result,AX              </font><font color="#008000"><i>{ Return proper result to user.         }
    </i></font><font color="#FF00FF">Pop DS                      </font><font color="#008000"><i>{ Pop DS Off the Stack.                 }
  </i></font><font color="#FF0000"><b>END</b></font><font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;</font><font color="#008000"><i>{fCreate}

</i></font><font color="#FF0000"><b>FUNCTION  </b></font>fOpen<font color="#000080">( </font>fName <font color="#000080">:</font><font color="#FF0000"><b>STRING</b></font><font color="#000080">; </font>Mode <font color="#000080">:</font>BYTE <font color="#000080">) :</font>WORD<font color="#000080">;
                         </font><font color="#008000"><i>{ Routine to open already existing file defined}
                         { in 'fName' with an opening mode of 'Mode'.   }
                         { Returns a WORD value containing the  handle. }
                         { Uses Int 21h/AH=3Dh.                         }
</i></font><font color="#FF0000"><b>BEGIN
  </b></font>ASCIIZ<font color="#000080">(</font>fName<font color="#000080">);                </font><font color="#008000"><i>{ Convert fName to an ASCIIZ string.    }
  </i></font><font color="#FF0000"><b>ASM
    </b></font><font color="#FF00FF">Push DS                     </font><font color="#008000"><i>{ Push DS onto stack.                   }
    </i></font><font color="#FF00FF">Mov fError,0                </font><font color="#008000"><i>{ Clear Error Flag.                     }
    </i></font><font color="#FF00FF">Mov AX,SS                   </font><font color="#008000"><i>{ Load AX with SS.                      }
    </i></font><font color="#FF00FF">Mov DS,AX                   </font><font color="#008000"><i>{ Now load that value into DS.          }
    </i></font><font color="#FF00FF">Lea DX,fName                </font><font color="#008000"><i>{ Now load DX with the offset of DX.    }
    </i></font><font color="#FF00FF">Inc DX                      </font><font color="#008000"><i>{ Move past length byte.                }
    </i></font><font color="#FF00FF">Mov AL,Mode                 </font><font color="#008000"><i>{ File Opening mode.                    }
    </i></font><font color="#FF00FF">Mov AH,$3D                  </font><font color="#008000"><i>{ Function to open a file.              }
    </i></font><font color="#FF00FF">Int $21                     </font><font color="#008000"><i>{ Call dos to open file.                }
    </i></font><font color="#FF00FF">Jnc @Exit                   </font><font color="#008000"><i>{ If no error exit.                     }
    </i></font><font color="#FF00FF">Mov fError,AX               </font><font color="#008000"><i>{ If there was an  error save it.       }
  </i></font><font color="#FF00FF">@Exit:
    Mov @Result,AX              </font><font color="#008000"><i>{ Return proper result to user.         }
    </i></font><font color="#FF00FF">Pop DS                      </font><font color="#008000"><i>{ Restore DS from stack.                }
  </i></font><font color="#FF0000"><b>END</b></font><font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;</font><font color="#008000"><i>{fOpen}

</i></font><font color="#FF0000"><b>PROCEDURE </b></font>fRead<font color="#000080">( </font>fHandle <font color="#000080">:</font>WORD<font color="#000080">; </font><font color="#FF0000"><b>VAR </b></font>Buff<font color="#000080">; </font>NTRead<font color="#000080">:</font>WORD<font color="#000080">; </font><font color="#FF0000"><b>VAR </b></font>ARead <font color="#000080">:</font>WORD <font color="#000080">);
</font><font color="#FF0000"><b>ASSEMBLER</b></font><font color="#000080">;               </font><font color="#008000"><i>{ Reads 'NTRead' bytes of data from 'fHandle'  }
                         { and puts it in 'Buff'. The actually amount   }
                         { of bytes read is returned in 'ARead'.        }
                         { Uses Int 21h/AH=3Fh.                         }
</i></font><font color="#FF0000"><b>ASM
  </b></font><font color="#FF00FF">Push DS                       </font><font color="#008000"><i>{ Push DS onto the stack.               }
  </i></font><font color="#FF00FF">Mov fError,0                  </font><font color="#008000"><i>{ Clear Error flag.                     }
  </i></font><font color="#FF00FF">Mov AH,$3F                    </font><font color="#008000"><i>{ Function to read from a file.         }
  </i></font><font color="#FF00FF">Mov BX,fHandle                </font><font color="#008000"><i>{ load handle of file to read.          }
  </i></font><font color="#FF00FF">Mov CX,NTRead                 </font><font color="#008000"><i>{ # of bytes to read.                   }
  </i></font><font color="#FF00FF">LDS DX,Buff                   </font><font color="#008000"><i>{ Point DS:DX to buffer.                }
  </i></font><font color="#FF00FF">Int $21                       </font><font color="#008000"><i>{ Call Dos to read file.                }
  </i></font><font color="#FF00FF">LDS DI,ARead                  </font><font color="#008000"><i>{ Point to amount read.                 }
  </i></font><font color="#FF00FF">Mov WORD PTR DS:[DI],AX       </font><font color="#008000"><i>{ Save amount actually read.            }
  </i></font><font color="#FF00FF">Jnc @Exit                     </font><font color="#008000"><i>{ if there was no error exit.           }
  </i></font><font color="#FF00FF">Mov fError,AX                 </font><font color="#008000"><i>{ If there was Save error code.         }
</i></font><font color="#FF00FF">@Exit:
  Pop DS                        </font><font color="#008000"><i>{ Pop DS off the stack.                 }
</i></font><font color="#FF0000"><b>END</b></font><font color="#000080">;</font><font color="#008000"><i>{fRead}

</i></font><font color="#FF0000"><b>PROCEDURE </b></font>fWrite<font color="#000080">( </font>fHandle <font color="#000080">:</font>WORD<font color="#000080">; </font><font color="#FF0000"><b>VAR </b></font>Buff<font color="#000080">; </font>NTWrite<font color="#000080">:</font>WORD<font color="#000080">; </font><font color="#FF0000"><b>VAR </b></font>AWrite <font color="#000080">:</font>WORD <font color="#000080">);
</font><font color="#FF0000"><b>ASSEMBLER</b></font><font color="#000080">;               </font><font color="#008000"><i>{ Writes 'NTWrite' bytes of info from 'Buff'   }
                         { to 'fHandle'. The actually amount written is }
                         { returned in 'AWrite'.                        }
                         { Uses Int 21h/AH=40h.                         }
</i></font><font color="#FF0000"><b>ASM
  </b></font><font color="#FF00FF">Push DS                       </font><font color="#008000"><i>{ Push DS onto the stack.               }
  </i></font><font color="#FF00FF">Mov fError,0                  </font><font color="#008000"><i>{ Clear Error flag.                     }
  </i></font><font color="#FF00FF">Mov AH,$40                    </font><font color="#008000"><i>{ Function to write to file.            }
  </i></font><font color="#FF00FF">Mov BX,fHandle                </font><font color="#008000"><i>{ Handle of file to write to.           }
  </i></font><font color="#FF00FF">Mov CX,NTWrite                </font><font color="#008000"><i>{ # of bytes to read.                   }
  </i></font><font color="#FF00FF">LDS DX,Buff                   </font><font color="#008000"><i>{ Point DS:DX -&gt; Buffer.                }
  </i></font><font color="#FF00FF">Int $21                       </font><font color="#008000"><i>{ Call Dos to write to file.            }
  </i></font><font color="#FF00FF">LDS DI,AWrite                 </font><font color="#008000"><i>{ Point to amount write.                }
  </i></font><font color="#FF00FF">Mov WORD PTR DS:[DI],AX       </font><font color="#008000"><i>{ Save amount actually written.         }
  </i></font><font color="#FF00FF">Jnc @Exit                     </font><font color="#008000"><i>{ If there was no error exit.           }
  </i></font><font color="#FF00FF">Mov fError,AX                 </font><font color="#008000"><i>{ if there was save error code.         }
</i></font><font color="#FF00FF">@Exit:
  Pop DS                        </font><font color="#008000"><i>{ Pop DS off the stack.                 }
</i></font><font color="#FF0000"><b>END</b></font><font color="#000080">;</font><font color="#008000"><i>{fWrite}

</i></font><font color="#FF0000"><b>PROCEDURE </b></font>fClose<font color="#000080">( </font>fHandle <font color="#000080">:</font>WORD <font color="#000080">); </font><font color="#FF0000"><b>ASSEMBLER</b></font><font color="#000080">;
                         </font><font color="#008000"><i>{ Routine to close file 'fHandle'. This updates}
                         { the directory time and size enteries.        }
                         { Uses Int 21h/AH=3Eh.                         }
</i></font><font color="#FF0000"><b>ASM
  </b></font><font color="#FF00FF">Mov fError,0                  </font><font color="#008000"><i>{ Clear Error flag                      }
  </i></font><font color="#FF00FF">Mov AH,$3E                    </font><font color="#008000"><i>{ Function to close file                }
  </i></font><font color="#FF00FF">Mov BX,fHandle                </font><font color="#008000"><i>{ load handle of file to close          }
  </i></font><font color="#FF00FF">Int $21                       </font><font color="#008000"><i>{ call Dos to close file                }
  </i></font><font color="#FF00FF">Jnc @Exit                     </font><font color="#008000"><i>{ If there was no error exit            }
  </i></font><font color="#FF00FF">Mov fError,AX                 </font><font color="#008000"><i>{ if there was save error code          }
</i></font><font color="#FF00FF">@Exit:
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;</font><font color="#008000"><i>{fClose}

</i></font><font color="#FF0000"><b>PROCEDURE </b></font>fReset<font color="#000080">( </font>fHandle <font color="#000080">:</font>WORD <font color="#000080">); </font><font color="#FF0000"><b>ASSEMBLER</b></font><font color="#000080">;
                         </font><font color="#008000"><i>{ Routine to reset file position pointer to the}
                         { beginning of 'fHandle'.                      }
                         { Uses Int 21h/AH=42h.                         }
</i></font><font color="#FF0000"><b>ASM
  </b></font><font color="#FF00FF">Mov fError,0                  </font><font color="#008000"><i>{ Clear error flag.                     }
  </i></font><font color="#FF00FF">Mov AH,$42                    </font><font color="#008000"><i>{ Function to move file pointer.        }
  </i></font><font color="#FF00FF">Mov BX,fHandle                </font><font color="#008000"><i>{ Handle of file.                       }
  </i></font><font color="#FF00FF">Mov AL,0                      </font><font color="#008000"><i>{ Offset relative to begining.          }
  </i></font><font color="#FF00FF">Mov CX,0                      </font><font color="#008000"><i>{ CX:DX = offset from begining of file  }
  </i></font><font color="#FF00FF">Mov DX,0                      </font><font color="#008000"><i>{ to move to.                           }
  </i></font><font color="#FF00FF">Int $21                       </font><font color="#008000"><i>{ Call dos to change file pointer.      }
  </i></font><font color="#FF00FF">Jnc @Exit                     </font><font color="#008000"><i>{ If there was no error exit.           }
  </i></font><font color="#FF00FF">Mov fError,AX                 </font><font color="#008000"><i>{ If there was save error code.         }
</i></font><font color="#FF00FF">@Exit:
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;</font><font color="#008000"><i>{fReset}

</i></font><font color="#FF0000"><b>PROCEDURE </b></font>fAppend<font color="#000080">( </font>fHandle <font color="#000080">:</font>WORD<font color="#000080">); </font><font color="#FF0000"><b>ASSEMBLER</b></font><font color="#000080">;
                         </font><font color="#008000"><i>{ Routine to move the File position pointer of }
                         { 'fHandle' to the end of the file. Any further}
                         { writing is added to the end of the file.     }
                         { Uses Int 21h/AH=42h.                         }
</i></font><font color="#FF0000"><b>ASM
  </b></font><font color="#FF00FF">Mov fError,0                  </font><font color="#008000"><i>{ Clear error flag.                     }
  </i></font><font color="#FF00FF">Mov AH,$42                    </font><font color="#008000"><i>{ Function to change file ptr position. }
  </i></font><font color="#FF00FF">Mov BX,fHandle                </font><font color="#008000"><i>{ handle of file to change.             }
  </i></font><font color="#FF00FF">Mov AL,$02                    </font><font color="#008000"><i>{ Change relative to end of file.       }
  </i></font><font color="#FF00FF">Mov CX,0                      </font><font color="#008000"><i>{ CX:DX = offset from end of file       }
  </i></font><font color="#FF00FF">Mov DX,0                      </font><font color="#008000"><i>{ to move to.                           }
  </i></font><font color="#FF00FF">Int $21                       </font><font color="#008000"><i>{ Call dos to move file ptr.            }
  </i></font><font color="#FF00FF">Jnc @Exit                     </font><font color="#008000"><i>{ If there was no error exit.           }
  </i></font><font color="#FF00FF">Mov fError,AX                 </font><font color="#008000"><i>{ If there was save error code.         }
</i></font><font color="#FF00FF">@Exit:
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;</font><font color="#008000"><i>{fAppend}

</i></font><font color="#FF0000"><b>PROCEDURE </b></font>fSeek<font color="#000080">( </font>fHandle <font color="#000080">:</font>WORD<font color="#000080">; </font>fOfs <font color="#000080">:</font>LONGINT <font color="#000080">); </font><font color="#FF0000"><b>ASSEMBLER</b></font><font color="#000080">;
                         </font><font color="#008000"><i>{ Routine to move the file position pointer for}
                         { 'fHandle' to 'fOfs'. 'fOfs' is the actual    }
                         { byte position in the file to move to.        }
                         { Uses Int 21h/AH=42h.                         }
</i></font><font color="#FF0000"><b>ASM
  </b></font><font color="#FF00FF">Mov fError,0                  </font><font color="#008000"><i>{ Clear error flag.                     }
  </i></font><font color="#FF00FF">Mov AH,$42                    </font><font color="#008000"><i>{ Function to change file ptr position. }
  </i></font><font color="#FF00FF">Mov BX,fHandle                </font><font color="#008000"><i>{ handle of file to change.             }
  </i></font><font color="#FF00FF">Mov AL,$00                    </font><font color="#008000"><i>{ Change relative to start of file.     }
  </i></font><font color="#FF00FF">Mov CX,fOfs[2].WORD           </font><font color="#008000"><i>{ CX:DX = offset from start of file     }
  </i></font><font color="#FF00FF">Mov DX,fOfs.WORD              </font><font color="#008000"><i>{ to move to.                           }
  </i></font><font color="#FF00FF">Int $21                       </font><font color="#008000"><i>{ Call dos to move file ptr.            }
  </i></font><font color="#FF00FF">Jnc @Exit                     </font><font color="#008000"><i>{ If there was no error exit.           }
  </i></font><font color="#FF00FF">Mov fError,AX                 </font><font color="#008000"><i>{ If there was save error code.         }
</i></font><font color="#FF00FF">@Exit:
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;</font><font color="#008000"><i>{fSeek}

</i></font><font color="#FF0000"><b>PROCEDURE </b></font>fErase<font color="#000080">( </font>fName <font color="#000080">:</font><font color="#FF0000"><b>STRING </b></font><font color="#000080">);
                         </font><font color="#008000"><i>{ Routine to erase 'fName'.                    }
                         { Uses Int 21h/AH=41h.                         }
</i></font><font color="#FF0000"><b>BEGIN
  </b></font>ASCIIZ<font color="#000080">(</font>fName<font color="#000080">);                </font><font color="#008000"><i>{ Convert fName to an ASCIIZ string.    }
  </i></font><font color="#FF0000"><b>ASM
    </b></font><font color="#FF00FF">Push DS                     </font><font color="#008000"><i>{ Push DS onto the stack.               }
    </i></font><font color="#FF00FF">Mov fError,0                </font><font color="#008000"><i>{ Clear error flag.                     }
    </i></font><font color="#FF00FF">Mov AX,SS                   </font><font color="#008000"><i>{ Load AX with SS.                      }
    </i></font><font color="#FF00FF">Mov DS,AX                   </font><font color="#008000"><i>{ Now load that value into DS.          }
    </i></font><font color="#FF00FF">Lea DX,fName                </font><font color="#008000"><i>{ Now load DX with the offset of DX.    }
    </i></font><font color="#FF00FF">Inc DX
    Mov AH,$41                  </font><font color="#008000"><i>{ Function to erase a file.             }
    </i></font><font color="#FF00FF">Int $21                     </font><font color="#008000"><i>{ Call dos to erase file.               }
    </i></font><font color="#FF00FF">Jnc @Exit                   </font><font color="#008000"><i>{ If no error exit.                     }
    </i></font><font color="#FF00FF">Mov fError,AX               </font><font color="#008000"><i>{ if there was error save error code.   }
  </i></font><font color="#FF00FF">@Exit:
    Pop DS                      </font><font color="#008000"><i>{ Pop DS off the stack.                 }
  </i></font><font color="#FF0000"><b>END</b></font><font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;</font><font color="#008000"><i>{fErase}

</i></font><font color="#FF0000"><b>FUNCTION  </b></font>fPos<font color="#000080">( </font>fHandle <font color="#000080">:</font>WORD <font color="#000080">) :</font>LONGINT<font color="#000080">; </font><font color="#FF0000"><b>ASSEMBLER</b></font><font color="#000080">;
                         </font><font color="#008000"><i>{ Routine to return the current position within}
                         { 'fHandle'.                                   }
                         { Uses Int 21h/AH=42.                          }
</i></font><font color="#FF0000"><b>ASM
  </b></font><font color="#FF00FF">Mov fError,0                  </font><font color="#008000"><i>{ Clear error flag.                     }
  </i></font><font color="#FF00FF">Mov AH,$42                    </font><font color="#008000"><i>{ Function to move file pointer.        }
  </i></font><font color="#FF00FF">Mov BX,fHandle                </font><font color="#008000"><i>{ Handle of file.                       }
  </i></font><font color="#FF00FF">Mov AL,1                      </font><font color="#008000"><i>{ Offset relative to current pos.       }
  </i></font><font color="#FF00FF">Mov CX,0                      </font><font color="#008000"><i>{ CX:DX = offset from current position  }
  </i></font><font color="#FF00FF">Mov DX,0                      </font><font color="#008000"><i>{ to move to.                           }
  </i></font><font color="#FF00FF">Int $21                       </font><font color="#008000"><i>{ Call dos to change file pointer.      }
  </i></font><font color="#FF00FF">Jnc @Exit                     </font><font color="#008000"><i>{ If there was no error return result.  }
  </i></font><font color="#FF00FF">Mov fError,AX                 </font><font color="#008000"><i>{ If there was save error code.         }
</i></font><font color="#FF00FF">@Exit:                          </font><font color="#008000"><i>{ Int already returns DX:AX as file pos.}
</i></font><font color="#FF0000"><b>END</b></font><font color="#000080">;</font><font color="#008000"><i>{fPos}

</i></font><font color="#FF0000"><b>FUNCTION  </b></font>fEof<font color="#000080">( </font>fHandle <font color="#000080">:</font>WORD <font color="#000080">) :</font>BOOLEAN<font color="#000080">;
                         </font><font color="#008000"><i>{ Routine to determine whether or not we're    }
                         { currently at the end of file 'fHandle'.      }
</i></font><font color="#FF0000"><b>VAR
   </b></font>CurOfs <font color="#000080">:</font>LONGINT<font color="#000080">;             </font><font color="#008000"><i>{ current file offset.                  }
</i></font><font color="#FF0000"><b>BEGIN
  </b></font>CurOfs <font color="#000080">:= </font>fPos<font color="#000080">(</font>fHandle<font color="#000080">);      </font><font color="#008000"><i>{ Save Current Pos.                     }
  </i></font>fAppend<font color="#000080">(</font>fHandle<font color="#000080">);             </font><font color="#008000"><i>{ Move to the end of the file.          }
  </i></font>fEof <font color="#000080">:= (</font>CurOfs <font color="#000080">= </font>fPos<font color="#000080">(</font>fHandle<font color="#000080">)); </font><font color="#008000"><i>{ was current pos = end pos?.       }
  </i></font>fSeek<font color="#000080">(</font>fHandle<font color="#000080">,</font>CurOfs<font color="#000080">);        </font><font color="#008000"><i>{ Restore to original file position.    }
</i></font><font color="#FF0000"><b>END</b></font><font color="#000080">;</font><font color="#008000"><i>{fEof}

</i></font><font color="#FF0000"><b>FUNCTION  </b></font>fExist<font color="#000080">( </font>fName <font color="#000080">:</font><font color="#FF0000"><b>STRING </b></font><font color="#000080">) :</font>BOOLEAN<font color="#000080">;
                         </font><font color="#008000"><i>{ Routine to determine whether or not 'fName'  }
                         { exists.                                      }
</i></font><font color="#FF0000"><b>BEGIN
  </b></font>fExist <font color="#000080">:= ( </font>FSearch<font color="#000080">(</font>fName<font color="#000080">,</font><font color="#800000">''</font><font color="#000080">) &lt;&gt; </font><font color="#800000">''</font><font color="#000080">);
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;</font><font color="#008000"><i>{fExist}

</i></font><font color="#FF0000"><b>FUNCTION  </b></font>fGetAttr<font color="#000080">( </font>fName <font color="#000080">:</font><font color="#FF0000"><b>STRING </b></font><font color="#000080">) :</font>BYTE<font color="#000080">;
                         </font><font color="#008000"><i>{ Routine to return the current file attribute }
                         { of 'fName'.                                  }
                         { Uses Int 21h/AH=43h,AL=00h.                  }
</i></font><font color="#FF0000"><b>BEGIN
  </b></font>ASCIIZ<font color="#000080">(</font>fName<font color="#000080">);                </font><font color="#008000"><i>{ Convert fName to an ASCIIZ string.    }
  </i></font><font color="#FF0000"><b>ASM
    </b></font><font color="#FF00FF">Push DS                     </font><font color="#008000"><i>{ Push DS onto the stack.               }
    </i></font><font color="#FF00FF">Mov fError,0                </font><font color="#008000"><i>{ Clear error flag.                     }
    </i></font><font color="#FF00FF">Mov AX,SS                   </font><font color="#008000"><i>{ Load AX with SS.                      }
    </i></font><font color="#FF00FF">Mov DS,AX                   </font><font color="#008000"><i>{ Now load that value into DS.          }
    </i></font><font color="#FF00FF">Lea DX,fName                </font><font color="#008000"><i>{ Now load DX with the offset of DX.    }
    </i></font><font color="#FF00FF">Inc DX
    Mov AX,$4300                </font><font color="#008000"><i>{ Function to Get file Attrib.          }
    </i></font><font color="#FF00FF">Int $21                     </font><font color="#008000"><i>{ Call dos to get attr.                 }
    </i></font><font color="#FF00FF">Jnc @Success                </font><font color="#008000"><i>{ If no error return proper info.       }
    </i></font><font color="#FF00FF">Mov fError,AX               </font><font color="#008000"><i>{ if there was error save error code.   }
  </i></font><font color="#FF00FF">@Success:
    Mov AX,CX
    Mov @Result,AL              </font><font color="#008000"><i>{ Return proper result to user.         }
    </i></font><font color="#FF00FF">Pop DS                      </font><font color="#008000"><i>{ Pop DS off the stack.                 }
  </i></font><font color="#FF0000"><b>END</b></font><font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;</font><font color="#008000"><i>{fGetAttr}

</i></font><font color="#FF0000"><b>PROCEDURE </b></font>fSetAttr<font color="#000080">( </font>fName <font color="#000080">:</font><font color="#FF0000"><b>STRING</b></font><font color="#000080">; </font>NAttr <font color="#000080">:</font>BYTE <font color="#000080">);
                         </font><font color="#008000"><i>{ Routine to set file attribute of 'fName' to  }
                         { 'NAttr'.                                     }
                         { Uses Int 21h/AH=43h,AL=01h.                  }
</i></font><font color="#FF0000"><b>BEGIN
  </b></font>ASCIIZ<font color="#000080">(</font>fName<font color="#000080">);                </font><font color="#008000"><i>{ Convert fName to an ASCIIZ string.    }
  </i></font><font color="#FF0000"><b>ASM
    </b></font><font color="#FF00FF">Push DS                     </font><font color="#008000"><i>{ Push DS onto the stack.               }
    </i></font><font color="#FF00FF">Mov fError,0                </font><font color="#008000"><i>{ Clear error flag.                     }
    </i></font><font color="#FF00FF">Mov AX,SS                   </font><font color="#008000"><i>{ Load AX with SS.                      }
    </i></font><font color="#FF00FF">Mov DS,AX                   </font><font color="#008000"><i>{ Now load that value into DS.          }
    </i></font><font color="#FF00FF">Lea DX,fName                </font><font color="#008000"><i>{ Now load DX with the offset of DX.    }
    </i></font><font color="#FF00FF">Inc DX                      </font><font color="#008000"><i>{ Point to first char after length byte.}
    </i></font><font color="#FF00FF">Xor CX,CX                   </font><font color="#008000"><i>{ Clear CX.                             }
    </i></font><font color="#FF00FF">Mov CL,NAttr                </font><font color="#008000"><i>{ Load New attribute byte.              }
    </i></font><font color="#FF00FF">Mov AX,$4301                </font><font color="#008000"><i>{ Function to Set file Attrib.          }
    </i></font><font color="#FF00FF">Int $21                     </font><font color="#008000"><i>{ Call dos to set attrib.               }
    </i></font><font color="#FF00FF">Jnc @Exit                   </font><font color="#008000"><i>{ If no error exit.                     }
    </i></font><font color="#FF00FF">Mov fError,AX               </font><font color="#008000"><i>{ if there was error save error code.   }
  </i></font><font color="#FF00FF">@Exit:
    Pop DS                      </font><font color="#008000"><i>{ Pop DS off the stack.                 }
  </i></font><font color="#FF0000"><b>END</b></font><font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;</font><font color="#008000"><i>{fSetAttr}

</i></font><font color="#FF0000"><b>PROCEDURE </b></font>fSetVerify<font color="#000080">( </font>On_Off <font color="#000080">:</font>BOOLEAN <font color="#000080">); </font><font color="#FF0000"><b>ASSEMBLER</b></font><font color="#000080">;
                         </font><font color="#008000"><i>{ Routine to set the DOS verify flag ON or OFF.}
                         { depending on 'On_Off'.                       }
                         { TRUE = ON, FALSE = OFF.                      }
                         { Uses Int 21h/AH=2Eh.                         }
</i></font><font color="#FF0000"><b>ASM
  </b></font><font color="#FF00FF">Mov AH,$2E                        </font><font color="#008000"><i>{  Interrupt Subfunction.               }
  </i></font><font color="#FF00FF">Mov DL,0                      </font><font color="#008000"><i>{  Clear DL.                            }
  </i></font><font color="#FF00FF">Mov AL,On_Off                        </font><font color="#008000"><i>{  0(FALSE) = off, 1(TRUE) = on.        }
  </i></font><font color="#FF00FF">Int $21                        </font><font color="#008000"><i>{  Call Dos.                            }
</i></font><font color="#FF0000"><b>END</b></font><font color="#000080">;</font><font color="#008000"><i>{fSetVerify}

</i></font><font color="#FF0000"><b>FUNCTION  </b></font>fGetVerify <font color="#000080">:</font>BOOLEAN<font color="#000080">; </font><font color="#FF0000"><b>ASSEMBLER</b></font><font color="#000080">;
                         </font><font color="#008000"><i>{ Routine to return the current state of the   }
                         { DOS verify flag.                             }
                         { Uses Int 21h/AH=54h.                         }
</i></font><font color="#FF0000"><b>ASM
  </b></font><font color="#FF00FF">Mov AH,$54                        </font><font color="#008000"><i>{  Interrupt Subfunction                }
  </i></font><font color="#FF00FF">Int $21                        </font><font color="#008000"><i>{  Call Dos                             }
</i></font><font color="#FF0000"><b>END</b></font><font color="#000080">;</font><font color="#008000"><i>{fGetVerify}

</i></font><font color="#FF0000"><b>FUNCTION  </b></font>fSize<font color="#000080">( </font>fHandle <font color="#000080">:</font>WORD <font color="#000080">) :</font>LONGINT<font color="#000080">;
                         </font><font color="#008000"><i>{ Routine to determine the size in bytes of    }
                         { 'fHandle'.                                   }
</i></font><font color="#FF0000"><b>VAR
   </b></font>CurOfs <font color="#000080">:</font>LONGINT<font color="#000080">;             </font><font color="#008000"><i>{ Holds original file pointer.          }
</i></font><font color="#FF0000"><b>BEGIN
  </b></font>CurOfs <font color="#000080">:= </font>fPos<font color="#000080">(</font>fHandle<font color="#000080">);      </font><font color="#008000"><i>{ Save current file pointer.            }
  </i></font>fAppend<font color="#000080">(</font>fHandle<font color="#000080">);             </font><font color="#008000"><i>{ Move to end of file.                  }
  </i></font>fSize <font color="#000080">:= </font>fPos<font color="#000080">(</font>fHandle<font color="#000080">);       </font><font color="#008000"><i>{ Save current pos which equals size.   }
  </i></font>fSeek<font color="#000080">(</font>fHandle<font color="#000080">,</font>CurOfs<font color="#000080">);        </font><font color="#008000"><i>{ Restore original file pos.            }
</i></font><font color="#FF0000"><b>END</b></font><font color="#000080">;</font><font color="#008000"><i>{fSize}

</i></font><font color="#FF0000"><b>PROCEDURE </b></font>fFlush<font color="#000080">( </font>fHandle <font color="#000080">:</font>WORD <font color="#000080">); </font><font color="#FF0000"><b>ASSEMBLER</b></font><font color="#000080">;
                         </font><font color="#008000"><i>{ Flushes any File buffers for 'fHandle'       }
                         { immediately and updates the directory entry. }
                         { Uses Int 21h/AH=68h.                         }
</i></font><font color="#FF0000"><b>ASM
  </b></font><font color="#FF00FF">Mov fError,0                  </font><font color="#008000"><i>{ Clear error flag.                     }
  </i></font><font color="#FF00FF">Mov AH,$68                    </font><font color="#008000"><i>{ Function to Commit file to disk.      }
  </i></font><font color="#FF00FF">Mov BX,fHandle                </font><font color="#008000"><i>{ Load handle of file to Commit.        }
  </i></font><font color="#FF00FF">Int $21                       </font><font color="#008000"><i>{ Call dos to flush file.               }
  </i></font><font color="#FF00FF">Jnc @Exit                     </font><font color="#008000"><i>{ If no error exit.                     }
  </i></font><font color="#FF00FF">Mov fError,AX                 </font><font color="#008000"><i>{ if there was error save error code.   }
</i></font><font color="#FF00FF">@Exit:
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;</font><font color="#008000"><i>{fSetAttr}

</i></font><font color="#FF0000"><b>PROCEDURE </b></font>fLock<font color="#000080">( </font>fHandle <font color="#000080">:</font>WORD<font color="#000080">; </font>LockInf <font color="#000080">:</font>LockType<font color="#000080">; </font>StartOfs<font color="#000080">,</font>Len <font color="#000080">:</font>LONGINT <font color="#000080">);
                         </font><font color="#008000"><i>{ Routine to lock/unlock parts of a open file.  }
</i></font><font color="#FF0000"><b>ASSEMBLER</b></font><font color="#000080">;               </font><font color="#008000"><i>{ Locking or unlock is determined by 'LockInf'. }
                         { Uses Int 21h/AH=5Ch.                          }

</i></font><font color="#FF0000"><b>ASM
  </b></font><font color="#FF00FF">Mov fError,0                  </font><font color="#008000"><i>{ Clear Error Flag.                     }
  </i></font><font color="#FF00FF">Mov AH,$5C                    </font><font color="#008000"><i>{ Function to lock/unlock part of a file.}
  </i></font><font color="#FF00FF">Mov AL,LockInf                </font><font color="#008000"><i>{ Load whether to lock/unlock file area.}
  </i></font><font color="#FF00FF">Mov BX,fHandle                </font><font color="#008000"><i>{ Handle of file to lock.               }
  </i></font><font color="#FF00FF">Mov CX,StartOfs.WORD[0]       </font><font color="#008000"><i>{ Load StartOfs Into  CX:DX.            }
  </i></font><font color="#FF00FF">Mov DX,StartOfs.WORD[2]
  Mov SI,Len.WORD[0]            </font><font color="#008000"><i>{ Load Len Into SI:DI.                  }
  </i></font><font color="#FF00FF">Mov DI,Len.WORD[2]
  Int $21                       </font><font color="#008000"><i>{ Call dos to lock area.                }
  </i></font><font color="#FF00FF">Jnc @Exit                     </font><font color="#008000"><i>{ If no error exit.                     }
  </i></font><font color="#FF00FF">Mov fError,AX                 </font><font color="#008000"><i>{ If there was an  error save it.       }
</i></font><font color="#FF00FF">@Exit:
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;</font><font color="#008000"><i>{fLock}

</i></font><font color="#FF0000"><b>BEGIN
END</b></font><font color="#000080">.</font><font color="#008000"><i>{FileIO}
</i></font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to FILES SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0049.PAS">Original</a><b>]</b></p></body>
</html>
