<html>
<head><title> "Buffered file unit" by RYAN THOMPSON</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to FILES SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0070.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
  This is a relatively simple, fairly small, marginally tested, but extremely
useful object I cooked up last week to provide a familiar interface while
allowing almost a full 64K data buffer on all sorts of typed and untyped
files (except for textfiles--come on, what do you think SetTextBuf is for!).

  Enjoy, and please let me know of any bugs, fixes, enhancements, ridicule,
pity, thankfullness, or admiration you might have for me, thanks!

{- FastFile unit: Buffered file I/O object -}

</i></font><font color="#FF0000"><b>Unit </b></font>FastFile<font color="#000080">;

</font><font color="#008000"><i>{
     Updated 12/1/94

     Copyright 1994 by Ryan Thompson, Osiris Development.

     You are free to use this code in your programs, however,
     it may not be included for-profit software, or source/unit
     libraries, without my permission.

       Voice: (707)443-4803
         FAX: (707)445-0599
         BBS: (707)445-0500 v.32terbo/HST
     FidoNet: 1:125/37.0
       Email: sysop@f37.n125.z1.fidonet.org

}

</i></font><font color="#FF0000"><b>INTERFACE


Type
  </b></font>FileBuffer <font color="#000080">= </font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">$fff0</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">;


  </font>BufFileObj <font color="#000080">= </font><font color="#FF0000"><b>Object
    </b></font>BufFile <font color="#000080">: </font><font color="#FF0000"><b>File</b></font><font color="#000080">;
    </font>Buf <font color="#000080">: ^</font>FileBuffer<font color="#000080">;
    </font>IOResult <font color="#000080">: </font>Integer<font color="#000080">;
    </font>Filename <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
    </font>Open<font color="#000080">,
    </font>Dirty <font color="#000080">: </font>Boolean<font color="#000080">;
    </font>BufFilePos <font color="#000080">: </font>Longint<font color="#000080">;
    </font>RecordSize<font color="#000080">,
    </font>BufSize<font color="#000080">,
    </font>BufPos<font color="#000080">,
    </font>BufTop <font color="#000080">: </font>Word<font color="#000080">;
    </font><font color="#FF0000"><b>Constructor </b></font>Init<font color="#000080">(</font>BufferSize <font color="#000080">: </font>Word<font color="#000080">);
    </font><font color="#FF0000"><b>Destructor </b></font>Done<font color="#000080">;

    </font><font color="#FF0000"><b>Procedure </b></font>Assign<font color="#000080">(</font>Fname <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">);
    </font><font color="#FF0000"><b>Procedure </b></font>Reset<font color="#000080">(</font>RecSize <font color="#000080">: </font>Word<font color="#000080">);
    </font><font color="#FF0000"><b>Procedure </b></font>Rewrite<font color="#000080">(</font>RecSize <font color="#000080">: </font>Word<font color="#000080">);
    </font><font color="#FF0000"><b>Procedure </b></font>Close<font color="#000080">;
    </font><font color="#FF0000"><b>Procedure </b></font>Rename<font color="#000080">(</font>Fname <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">);
    </font><font color="#FF0000"><b>Procedure </b></font>Erase<font color="#000080">;

    </font><font color="#FF0000"><b>Function </b></font>EOF <font color="#000080">: </font>Boolean<font color="#000080">;
    </font><font color="#FF0000"><b>Function </b></font>FilePos <font color="#000080">: </font>Longint<font color="#000080">;
    </font><font color="#FF0000"><b>Function </b></font>FileSize <font color="#000080">: </font>Longint<font color="#000080">;
    </font><font color="#FF0000"><b>Procedure </b></font>Seek<font color="#000080">(</font>Pos <font color="#000080">: </font>Longint<font color="#000080">);

    </font><font color="#FF0000"><b>Procedure </b></font>Read<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>V<font color="#000080">);
    </font><font color="#FF0000"><b>Procedure </b></font>Write<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>V<font color="#000080">);
    </font><font color="#FF0000"><b>Procedure </b></font>BlockRead<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>V<font color="#000080">; </font>Count <font color="#000080">: </font>Word<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>Result <font color="#000080">: </font>Word<font color="#000080">);
    </font><font color="#FF0000"><b>Procedure </b></font>BlockWrite<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>V<font color="#000080">; </font>Count <font color="#000080">: </font>Word<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>Result <font color="#000080">: </font>Word<font color="#000080">);

    </font><font color="#FF0000"><b>Procedure </b></font>FillBuffer<font color="#000080">;
    </font><font color="#FF0000"><b>Procedure </b></font>FlushBuffer<font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
  </font>BufferedFile <font color="#000080">= ^</font>BufFileObj<font color="#000080">;


</font><font color="#FF0000"><b>IMPLEMENTATION


Constructor </b></font>BufFileObj<font color="#000080">.</font>Init<font color="#000080">(</font>BufferSize <font color="#000080">: </font>Word<font color="#000080">);
  </font><font color="#FF0000"><b>Begin
    </b></font>Filename<font color="#000080">:= </font><font color="#800000">''</font><font color="#000080">;
    </font>Open<font color="#000080">:= </font>false<font color="#000080">;
    </font>Dirty<font color="#000080">:= </font>false<font color="#000080">;
    </font>BufFilePos<font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
    </font>RecordSize<font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
    </font>BufSize<font color="#000080">:= </font>BufferSize<font color="#000080">;
    </font>BufPos<font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
    </font>BufTop<font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
    </font>Getmem<font color="#000080">(</font>Buf<font color="#000080">, </font>BufSize<font color="#000080">);
    </font><font color="#FF0000"><b>if </b></font>Buf <font color="#000080">= </font><font color="#FF0000"><b>nil then </b></font>Fail<font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;


</font><font color="#FF0000"><b>Destructor </b></font>BufFileObj<font color="#000080">.</font>Done<font color="#000080">;
  </font><font color="#FF0000"><b>Begin
    If </b></font>Open <font color="#FF0000"><b>then </b></font>Close<font color="#000080">;
    </font><font color="#FF0000"><b>if </b></font>Buf <font color="#000080">&lt;&gt; </font><font color="#FF0000"><b>nil then </b></font>Freemem<font color="#000080">(</font>Buf<font color="#000080">, </font>BufSize<font color="#000080">);
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;


</font><font color="#FF0000"><b>Procedure </b></font>BufFileObj<font color="#000080">.</font>Assign<font color="#000080">(</font>Fname <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">);
  </font><font color="#FF0000"><b>Begin
    if </b></font>Open <font color="#FF0000"><b>then </b></font>Close<font color="#000080">;
    </font>Filename<font color="#000080">:= </font>FName<font color="#000080">;
    </font>system<font color="#000080">.</font>Assign<font color="#000080">(</font>BufFile<font color="#000080">, </font>Fname<font color="#000080">);
    </font>IOResult<font color="#000080">:= </font>system<font color="#000080">.</font>IOResult<font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;


</font><font color="#FF0000"><b>Procedure </b></font>BufFileObj<font color="#000080">.</font>Reset<font color="#000080">(</font>RecSize <font color="#000080">: </font>Word<font color="#000080">);
  </font><font color="#FF0000"><b>Begin
    if </b></font>Open <font color="#FF0000"><b>then </b></font>Close<font color="#000080">;
    </font><font color="#FF0000"><b>if </b></font>RecSize <font color="#000080">= </font><font color="#800000">0
    </font><font color="#FF0000"><b>then </b></font>RecordSize<font color="#000080">:= </font><font color="#800000">128
    </font><font color="#FF0000"><b>else </b></font>RecordSize<font color="#000080">:= </font>RecSize<font color="#000080">;
    </font>system<font color="#000080">.</font>Reset<font color="#000080">(</font>BufFile<font color="#000080">, </font><font color="#800000">1</font><font color="#000080">);
    </font>IOResult<font color="#000080">:= </font>system<font color="#000080">.</font>IOResult<font color="#000080">;
    </font>BufFilePos<font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
    </font>BufPos<font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
    </font>FillBuffer<font color="#000080">;
    </font><font color="#FF0000"><b>if </b></font>IOResult <font color="#000080">= </font><font color="#800000">0
    </font><font color="#FF0000"><b>then </b></font>Open<font color="#000080">:= </font>true
    <font color="#FF0000"><b>else </b></font>Open<font color="#000080">:= </font>false<font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;


</font><font color="#FF0000"><b>Procedure </b></font>BufFileObj<font color="#000080">.</font>Rewrite<font color="#000080">(</font>RecSize <font color="#000080">: </font>Word<font color="#000080">);
  </font><font color="#FF0000"><b>Begin
    if </b></font>Open <font color="#FF0000"><b>then </b></font>Close<font color="#000080">;
    </font><font color="#FF0000"><b>if </b></font>RecSize <font color="#000080">= </font><font color="#800000">0
    </font><font color="#FF0000"><b>then </b></font>RecordSize<font color="#000080">:= </font><font color="#800000">128
    </font><font color="#FF0000"><b>else </b></font>RecordSize<font color="#000080">:= </font>RecSize<font color="#000080">;
    </font>BufTop<font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
    </font>system<font color="#000080">.</font>Rewrite<font color="#000080">(</font>BufFile<font color="#000080">, </font><font color="#800000">1</font><font color="#000080">);
    </font>IOResult<font color="#000080">:= </font>system<font color="#000080">.</font>IOResult<font color="#000080">;
    </font><font color="#FF0000"><b>if </b></font>IOResult <font color="#000080">= </font><font color="#800000">0
    </font><font color="#FF0000"><b>then </b></font>Open<font color="#000080">:= </font>true
    <font color="#FF0000"><b>else </b></font>Open<font color="#000080">:= </font>false<font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;


</font><font color="#FF0000"><b>Procedure </b></font>BufFileObj<font color="#000080">.</font>Close<font color="#000080">;
  </font><font color="#FF0000"><b>Begin
    If </b></font>Dirty <font color="#FF0000"><b>then </b></font>FlushBuffer<font color="#000080">;
    </font>system<font color="#000080">.</font>Close<font color="#000080">(</font>BufFile<font color="#000080">);
    </font>IOResult<font color="#000080">:= </font>system<font color="#000080">.</font>IoResult<font color="#000080">;
    </font>Open<font color="#000080">:= </font>false<font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;


</font><font color="#FF0000"><b>Procedure </b></font>BufFileObj<font color="#000080">.</font>Rename<font color="#000080">(</font>Fname <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">);
  </font><font color="#FF0000"><b>Begin
    </b></font>system<font color="#000080">.</font>Rename<font color="#000080">(</font>BufFile<font color="#000080">, </font>Fname<font color="#000080">);
    </font>IOResult<font color="#000080">:= </font>system<font color="#000080">.</font>IOResult<font color="#000080">;
    </font><font color="#FF0000"><b>if </b></font>IOResult <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>Filename<font color="#000080">:= </font>FName<font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;


</font><font color="#FF0000"><b>Procedure </b></font>BufFileObj<font color="#000080">.</font>Erase<font color="#000080">;
  </font><font color="#FF0000"><b>Begin
    if </b></font>Open <font color="#FF0000"><b>then </b></font>Close<font color="#000080">;
    </font>system<font color="#000080">.</font>Erase<font color="#000080">(</font>BufFile<font color="#000080">);
    </font>IOResult<font color="#000080">:= </font>system<font color="#000080">.</font>IOResult<font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;


</font><font color="#FF0000"><b>Function </b></font>BufFileObj<font color="#000080">.</font>EOF <font color="#000080">: </font>Boolean<font color="#000080">;
  </font><font color="#FF0000"><b>Begin
    </b></font>EOF<font color="#000080">:= </font>BufFileObj<font color="#000080">.</font>FilePos <font color="#000080">&gt;= </font>BufFileObj<font color="#000080">.</font>FileSize<font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;


</font><font color="#FF0000"><b>Function </b></font>BufFileObj<font color="#000080">.</font>FileSize <font color="#000080">: </font>Longint<font color="#000080">;
  </font><font color="#FF0000"><b>Begin
    </b></font>FileSize<font color="#000080">:= </font>system<font color="#000080">.</font>FileSize<font color="#000080">(</font>BufFile<font color="#000080">) </font><font color="#FF0000"><b>div </b></font>RecordSize<font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;


</font><font color="#FF0000"><b>Function </b></font>BufFileObj<font color="#000080">.</font>FilePos <font color="#000080">: </font>Longint<font color="#000080">;
  </font><font color="#FF0000"><b>Begin
    </b></font>FilePos<font color="#000080">:= (</font>BufFilePos <font color="#000080">+ </font>BufPos<font color="#000080">) </font><font color="#FF0000"><b>div </b></font>RecordSize<font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;


</font><font color="#FF0000"><b>Procedure </b></font>BufFileObj<font color="#000080">.</font>Seek<font color="#000080">(</font>Pos <font color="#000080">: </font>Longint<font color="#000080">);
  </font><font color="#FF0000"><b>Begin
    </b></font>Pos<font color="#000080">:= </font>Pos <font color="#000080">* </font>RecordSize<font color="#000080">;
    </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>Pos <font color="#000080">&gt;= </font>BufFilePos <font color="#000080">+ </font>BufSize<font color="#000080">) </font><font color="#FF0000"><b>or
       </b></font><font color="#000080">(</font>Pos <font color="#000080">&lt; </font>BufFilePos<font color="#000080">)
    </font><font color="#FF0000"><b>then begin
      if </b></font>Dirty <font color="#FF0000"><b>then </b></font>FlushBuffer<font color="#000080">;
      </font>system<font color="#000080">.</font>seek<font color="#000080">(</font>BufFile<font color="#000080">, </font>Pos<font color="#000080">);
      </font>BufFilePos<font color="#000080">:= </font>Pos<font color="#000080">;
      </font>BufPos<font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
      </font>FillBuffer<font color="#000080">;
    </font><font color="#FF0000"><b>end
    else </b></font>BufPos<font color="#000080">:= </font>Pos <font color="#000080">- </font>BufFilePos<font color="#000080">;
    </font>IoResult<font color="#000080">:= </font>system<font color="#000080">.</font>IoResult<font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;


</font><font color="#FF0000"><b>Procedure </b></font>BufFileObj<font color="#000080">.</font>Read<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>V<font color="#000080">);
  </font><font color="#FF0000"><b>Var
    </b></font>Overflow <font color="#000080">: </font>Word<font color="#000080">;
  </font><font color="#FF0000"><b>Begin
    If </b></font>BufPos <font color="#000080">+ </font>RecordSize <font color="#000080">&gt; </font>BufTop
    <font color="#FF0000"><b>then begin
      </b></font>Overflow<font color="#000080">:= </font>BufSize <font color="#000080">- </font>BufPos<font color="#000080">;
      </font>Move<font color="#000080">(</font>Buf<font color="#000080">^[</font>BufPos<font color="#000080">], </font>V<font color="#000080">, </font>Overflow<font color="#000080">);
      </font>inc<font color="#000080">(</font>BufFilePos<font color="#000080">, </font>BufSize<font color="#000080">);
      </font>BufPos<font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
      </font>FillBuffer<font color="#000080">;
      </font>Move<font color="#000080">(</font>Buf<font color="#000080">^[</font>BufPos<font color="#000080">], </font>FileBuffer<font color="#000080">(</font>V<font color="#000080">)[</font>Overflow<font color="#000080">], </font>RecordSize <font color="#000080">- </font>Overflow<font color="#000080">);
      </font>BufPos<font color="#000080">:= </font>BufPos <font color="#000080">+ </font>RecordSize <font color="#000080">- </font>Overflow<font color="#000080">;
    </font><font color="#FF0000"><b>end
    else begin
      </b></font>Move<font color="#000080">(</font>Buf<font color="#000080">^[</font>BufPos<font color="#000080">], </font>V<font color="#000080">, </font>RecordSize<font color="#000080">);
      </font>inc<font color="#000080">(</font>BufPos<font color="#000080">, </font>RecordSize<font color="#000080">);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font>IoResult<font color="#000080">:= </font>system<font color="#000080">.</font>IoResult<font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;


</font><font color="#FF0000"><b>Procedure </b></font>BufFileObj<font color="#000080">.</font>BlockRead<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>V<font color="#000080">; </font>Count <font color="#000080">: </font>Word<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>Result <font color="#000080">: </font>Word<font color="#000080">);
  </font><font color="#FF0000"><b>Begin
    </b></font>Result<font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
    </font><font color="#FF0000"><b>While </b></font><font color="#000080">(</font>Result <font color="#000080">&lt; </font>Count<font color="#000080">) </font><font color="#FF0000"><b>and
          </b></font><font color="#000080">(</font>IoResult <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>and
          not </b></font>EOF
    <font color="#FF0000"><b>do begin
      </b></font>Read<font color="#000080">(</font>FileBuffer<font color="#000080">(</font>V<font color="#000080">)[</font>Result <font color="#000080">* </font>RecordSize<font color="#000080">]);
      </font>Inc<font color="#000080">(</font>Result<font color="#000080">);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;


</font><font color="#FF0000"><b>Procedure </b></font>BufFileObj<font color="#000080">.</font>Write<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>V<font color="#000080">);
  </font><font color="#FF0000"><b>Var
    </b></font>Overflow <font color="#000080">: </font>Word<font color="#000080">;
  </font><font color="#FF0000"><b>Begin
    </b></font>Dirty<font color="#000080">:= </font>true<font color="#000080">;
    </font><font color="#FF0000"><b>If </b></font>BufPos <font color="#000080">+ </font>RecordSize <font color="#000080">&gt; </font>BufSize
    <font color="#FF0000"><b>then begin
      </b></font>Overflow<font color="#000080">:= </font>BufSize <font color="#000080">- </font>BufPos<font color="#000080">;
      </font><font color="#FF0000"><b>if </b></font>Overflow <font color="#000080">&gt; </font><font color="#800000">0
      </font><font color="#FF0000"><b>then </b></font>Move<font color="#000080">(</font>V<font color="#000080">, </font>Buf<font color="#000080">^[</font>BufPos<font color="#000080">], </font>Overflow<font color="#000080">);
      </font>BufTop<font color="#000080">:= </font>BufSize<font color="#000080">;
      </font>FlushBuffer<font color="#000080">;
      </font>inc<font color="#000080">(</font>BufFilePos<font color="#000080">, </font>BufSize<font color="#000080">);
      </font>BufPos<font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
      </font>FillBuffer<font color="#000080">;
      </font>Move<font color="#000080">(</font>FileBuffer<font color="#000080">(</font>V<font color="#000080">)[</font>Overflow<font color="#000080">], </font>Buf<font color="#000080">^[</font>BufPos<font color="#000080">], </font>RecordSize <font color="#000080">- </font>Overflow<font color="#000080">);
      </font>BufPos<font color="#000080">:= </font>BufPos <font color="#000080">+ </font>RecordSize <font color="#000080">- </font>Overflow<font color="#000080">;
    </font><font color="#FF0000"><b>end
    else begin
      </b></font>Move<font color="#000080">(</font>V<font color="#000080">, </font>Buf<font color="#000080">^[</font>BufPos<font color="#000080">], </font>RecordSize<font color="#000080">);
      </font>inc<font color="#000080">(</font>BufPos<font color="#000080">, </font>RecordSize<font color="#000080">);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>if </b></font>BufTop <font color="#000080">&lt; </font>BufPos
    <font color="#FF0000"><b>then </b></font>BufTop<font color="#000080">:= </font>BufPos<font color="#000080">;
    </font>IoResult<font color="#000080">:= </font>system<font color="#000080">.</font>IoResult<font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;


</font><font color="#FF0000"><b>Procedure </b></font>BufFileObj<font color="#000080">.</font>BlockWrite<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>V<font color="#000080">; </font>Count <font color="#000080">: </font>Word<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>Result <font color="#000080">: </font>Word<font color="#000080">);
  </font><font color="#FF0000"><b>Begin
    </b></font>Result<font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
    </font><font color="#FF0000"><b>While </b></font><font color="#000080">(</font>Result <font color="#000080">&lt; </font>Count<font color="#000080">) </font><font color="#FF0000"><b>and
          </b></font><font color="#000080">(</font>IoResult <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">)
    </font><font color="#FF0000"><b>do begin
      </b></font>Write<font color="#000080">(</font>FileBuffer<font color="#000080">(</font>V<font color="#000080">)[</font>Result <font color="#000080">* </font>RecordSize<font color="#000080">]);
      </font>Inc<font color="#000080">(</font>Result<font color="#000080">);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;


</font><font color="#FF0000"><b>Procedure </b></font>BufFileObj<font color="#000080">.</font>FillBuffer<font color="#000080">;
  </font><font color="#FF0000"><b>Begin
    </b></font>system<font color="#000080">.</font>Seek<font color="#000080">(</font>BufFile<font color="#000080">, </font>BufFilePos<font color="#000080">);
    </font>system<font color="#000080">.</font>BlockRead<font color="#000080">(</font>BufFile<font color="#000080">, </font>Buf<font color="#000080">^, </font>BufSize<font color="#000080">, </font>BufTop<font color="#000080">);
    </font>IoResult<font color="#000080">:= </font>system<font color="#000080">.</font>IoResult<font color="#000080">;
    </font><font color="#FF0000"><b>if </b></font>IoResult <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>Dirty<font color="#000080">:= </font>false<font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;


</font><font color="#FF0000"><b>Procedure </b></font>BufFileObj<font color="#000080">.</font>FlushBuffer<font color="#000080">;
  </font><font color="#FF0000"><b>Begin
    </b></font>system<font color="#000080">.</font>Seek<font color="#000080">(</font>BufFile<font color="#000080">, </font>BufFilePos<font color="#000080">);
    </font>system<font color="#000080">.</font>BlockWrite<font color="#000080">(</font>BufFile<font color="#000080">, </font>Buf<font color="#000080">^, </font>BufTop<font color="#000080">, </font>BufTop<font color="#000080">);
    </font>IoResult<font color="#000080">:= </font>system<font color="#000080">.</font>IoResult<font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;


</font><font color="#FF0000"><b>Begin
End</b></font><font color="#000080">.

</font><font color="#008000"><i>{ -------------------------   DEMO ----------------- }
</i></font><font color="#FF0000"><b>Program </b></font>TestFile<font color="#000080">;

</font><font color="#FF0000"><b>Uses
  </b></font>FastFile<font color="#000080">;

</font><font color="#FF0000"><b>Var
  </b></font>InFile<font color="#000080">,
  </font>OutFile <font color="#000080">: </font>BufferedFile<font color="#000080">;
  </font>Data <font color="#000080">: </font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">120</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">;

</font><font color="#FF0000"><b>Begin
  </b></font>New<font color="#000080">(</font>InFile<font color="#000080">, </font>Init<font color="#000080">(</font><font color="#800000">$8000</font><font color="#000080">));            </font><font color="#008000"><i>{ Allocate a 32K buffer }</i></font><font color="#000080">;
  </font>New<font color="#000080">(</font>OutFile<font color="#000080">, </font>Init<font color="#000080">(</font><font color="#800000">$4000</font><font color="#000080">));           </font><font color="#008000"><i>{ 16K Buffer }
  </i></font>InFile<font color="#000080">^.</font>Assign<font color="#000080">(</font>Parameter<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">));        </font><font color="#008000"><i>{ Assign input to a filename }
  </i></font>InFile<font color="#000080">^.</font>Reset<font color="#000080">(</font>sizeof<font color="#000080">(</font>data<font color="#000080">));        
  </font>OutFile<font color="#000080">^.</font>Assign<font color="#000080">(</font>Parameter<font color="#000080">(</font><font color="#800000">2</font><font color="#000080">));
  </font>OutFile<font color="#000080">^.</font>Rewrite<font color="#000080">(</font>sizeof<font color="#000080">(</font>data<font color="#000080">));
  </font><font color="#FF0000"><b>While not </b></font>InFile<font color="#000080">^.</font>EOF <font color="#FF0000"><b>do begin 
    </b></font>InFile<font color="#000080">^.</font>Read<font color="#000080">(</font>Data<font color="#000080">);
    </font><font color="#FF0000"><b>if </b></font>Data<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">] &lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>OutFile<font color="#000080">^.</font>Write<font color="#000080">(</font>Data<font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>InFile<font color="#000080">^.</font>Close<font color="#000080">;
  </font>OutFile<font color="#000080">^.</font>Close<font color="#000080">;
  </font>InFile<font color="#000080">^.</font>Erase<font color="#000080">;
  </font>OutFile<font color="#000080">^.</font>Rename<font color="#000080">(</font>Parameter<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">)); 
  </font>Dispose<font color="#000080">(</font>InFile<font color="#000080">);                     </font><font color="#008000"><i>{ Close the file and free the memory }
  </i></font>Dispose<font color="#000080">(</font>OutFile<font color="#000080">);
</font><font color="#FF0000"><b>End</b></font><font color="#000080">.

  </font><font color="#FF0000"><b>As </b></font>you see<font color="#000080">, </font>this implements a very silly <font color="#FF0000"><b>program </b></font>which removes the original
after stripping unwanted records from it<font color="#000080">.  </font>Without the large RAM buffers<font color="#000080">, </font>this
would be an extremely slow<font color="#000080">, </font>but since all READs <font color="#FF0000"><b>and </b></font>WRITEs <font color="#FF0000"><b>and </b></font>SEEKs <font color="#FF0000"><b>and 
</b></font>everything <font color="#FF0000"><b>else </b></font>are done <font color="#FF0000"><b>to </b></font>RAM<font color="#000080">, </font>few actual disk accesses result<font color="#000080">.  </font>I used this
<font color="#FF0000"><b>in </b></font>a USEnet mail processing <font color="#FF0000"><b>program and </b></font>the speed went from <font color="#800000">15</font>K<font color="#000080">/</font>sec <font color="#FF0000"><b>to
</b></font><font color="#800000">130</font>K<font color="#000080">/</font>sec<font color="#000080">.

  </font>The easiest way <font color="#FF0000"><b>to </b></font>use it <font color="#FF0000"><b>is to </b></font>simply change structures like<font color="#000080">:

</font>Assign<font color="#000080">(</font>Filehandle<font color="#000080">, </font>name<font color="#000080">);   ---&gt;   </font>Filehandle<font color="#000080">^.</font>Assign<font color="#000080">(</font>name<font color="#000080">);
 
  ...</font><font color="#FF0000"><b>in </b></font>many cases a couple <font color="#FF0000"><b>of </b></font>Search<font color="#000080">..</font>Replace passes are all that you need <font color="#FF0000"><b>to
</b></font>modify your software <font color="#FF0000"><b>to </b></font>use this<font color="#000080">.  </font>I<font color="#800000">'ve done it will all of my own and am very
</font>pleased<font color="#000080">.  

  </font>Again<font color="#000080">, </font><font color="#FF0000"><b>if </b></font>you run into any problems<font color="#000080">, </font>please let me know<font color="#000080">!  </font>I can guarantee
you only that it works fine <font color="#FF0000"><b>for </b></font>me<font color="#000080">.  :-)
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to FILES SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0070.PAS">Original</a><b>]</b></p></body>
</html>
