<html>
<head><title> "Buffered File I/O" by OZZ NIXON</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to FILES SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0080.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code>
<font color="#008000"><i>{Buffered FIle I/O - Slightly re-written, and a few code tweaks}

</i></font><font color="#FF0000"><b>Unit </b></font>WGBFile<font color="#000080">; </font><font color="#008000"><i>{Buffered File Object Unit}

{$I WGDEFINE.INC}  { SEE WGFFIND.PAS for this include }

</i></font><font color="#FF0000"><b>Interface

Const
</b></font><font color="#008000"><i>{filemode types}
   </i></font>fmReadOnly<font color="#000080">=</font><font color="#800000">0</font><font color="#000080">;
   </font>fmWriteOnly<font color="#000080">=</font><font color="#800000">1</font><font color="#000080">;
   </font>fmReadWrite<font color="#000080">=</font><font color="#800000">2</font><font color="#000080">;
   </font>fmDenyAll<font color="#000080">=</font><font color="#800000">16</font><font color="#000080">;
   </font>fmDenyWrite<font color="#000080">=</font><font color="#800000">32</font><font color="#000080">;
   </font>fmDenyRead<font color="#000080">=</font><font color="#800000">48</font><font color="#000080">;
   </font>fmDenyNone<font color="#000080">=</font><font color="#800000">64</font><font color="#000080">;
   </font>fmNoInherit<font color="#000080">=</font><font color="#800000">128</font><font color="#000080">;

</font><font color="#FF0000"><b>Type
   </b></font>FBufType <font color="#000080">= </font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">$fff0</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Byte<font color="#000080">;

   </font>FFileObj <font color="#000080">= </font><font color="#FF0000"><b>Object
      </b></font>BufFile<font color="#000080">: </font><font color="#FF0000"><b>File</b></font><font color="#000080">;             </font><font color="#008000"><i>{File to be buffered}
      </i></font>Buf<font color="#000080">: ^</font>FBufType<font color="#000080">;            </font><font color="#008000"><i>{Pointer to the buffer-actual size given by
init}      </i></font>BufStart<font color="#000080">: </font>LongInt<font color="#000080">;         </font><font color="#008000"><i>{File position of buffer start}
      </i></font>BufSize<font color="#000080">: </font>LongInt<font color="#000080">;          </font><font color="#008000"><i>{Size of the buffer}
      </i></font>BufChars<font color="#000080">: </font>Word<font color="#000080">;            </font><font color="#008000"><i>{Number of valid characters in the buffer}
      </i></font>CurrSize<font color="#000080">: </font>LongInt<font color="#000080">;         </font><font color="#008000"><i>{Current file size}
      </i></font>NeedWritten<font color="#000080">: </font>Boolean<font color="#000080">;      </font><font color="#008000"><i>{Buffer dirty/needs written flag}
      </i></font>IsOpen<font color="#000080">: </font>Boolean<font color="#000080">;           </font><font color="#008000"><i>{File is currently open flag}
      </i></font>CurrPos<font color="#000080">: </font>LongInt<font color="#000080">;          </font><font color="#008000"><i>{Current position in file/buffer}
      </i></font>MyIOResult<font color="#000080">:</font>Word<font color="#000080">;           </font><font color="#008000"><i>{= Last IOResult!}
      </i></font><font color="#FF0000"><b>Constructor </b></font>Init<font color="#000080">(</font>BSize<font color="#000080">:</font>Word<font color="#000080">);
      </font><font color="#FF0000"><b>Destructor </b></font>Done<font color="#000080">; </font><font color="#FF0000"><b>Virtual</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>Procedure </b></font>Open<font color="#000080">(</font>FName<font color="#000080">:</font><font color="#FF0000"><b>String</b></font><font color="#000080">;</font>FMode<font color="#000080">:</font>Word<font color="#000080">); </font><font color="#FF0000"><b>Virtual</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>Procedure </b></font>Create<font color="#000080">(</font>FName<font color="#000080">:</font><font color="#FF0000"><b>String</b></font><font color="#000080">;</font>FMode<font color="#000080">:</font>Word<font color="#000080">); </font><font color="#FF0000"><b>Virtual</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>Procedure </b></font>CloseFile<font color="#000080">; </font><font color="#FF0000"><b>Virtual</b></font><font color="#000080">;
</font><font color="#008000"><i>{      Function  EraseFile; Virtual;
      Function  TruncateFile; Virtual;}
      </i></font><font color="#FF0000"><b>Procedure </b></font>BlkRead<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>V<font color="#000080">;</font>Num<font color="#000080">:</font>Word<font color="#000080">;</font><font color="#FF0000"><b>Var </b></font>NumRead<font color="#000080">:</font>Word<font color="#000080">); </font><font color="#FF0000"><b>Virtual</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>Procedure </b></font>BlkWrite<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>V<font color="#000080">;</font>Num<font color="#000080">:</font>Word<font color="#000080">;</font><font color="#FF0000"><b>Var </b></font>NumWrite<font color="#000080">:</font>Word<font color="#000080">); </font><font color="#FF0000"><b>Virtual</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>Procedure </b></font>SeekFile<font color="#000080">(</font>FP<font color="#000080">:</font>LongInt<font color="#000080">); </font><font color="#FF0000"><b>Virtual</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>Function  </b></font>RawSize<font color="#000080">:</font>LongInt<font color="#000080">; </font><font color="#FF0000"><b>Virtual</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>Function  </b></font>FilePos<font color="#000080">:</font>LongInt<font color="#000080">; </font><font color="#FF0000"><b>Virtual</b></font><font color="#000080">;
</font><font color="#008000"><i>{internal!}
      </i></font><font color="#FF0000"><b>Function  </b></font>WriteBuffer<font color="#000080">:</font>Boolean<font color="#000080">;
      </font><font color="#FF0000"><b>Function  </b></font>ReadBuffer<font color="#000080">:</font>Boolean<font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;


</font><font color="#FF0000"><b>Implementation

Uses
</b></font><font color="#008000"><i>{$IFDEF WINDOWS}
  </i></font>WinDos<font color="#000080">;
</font><font color="#008000"><i>{$ELSE}
  </i></font>Dos<font color="#000080">,
  </font><font color="#008000"><i>{$IFDEF OPRO}
  </i></font>OpCrt<font color="#000080">;
  </font><font color="#008000"><i>{$ELSE}
  </i></font>Crt<font color="#000080">;
  </font><font color="#008000"><i>{$ENDIF}
{$ENDIF}


</i></font><font color="#FF0000"><b>Constructor </b></font>FFileObj<font color="#000080">.</font>Init<font color="#000080">(</font>BSize<font color="#000080">:</font>Word<font color="#000080">);
</font><font color="#FF0000"><b>Begin
   </b></font>Buf<font color="#000080">:=</font><font color="#FF0000"><b>Nil</b></font><font color="#000080">;
   </font>GetMem<font color="#000080">(</font>Buf<font color="#000080">,</font>BSize<font color="#000080">);
   </font>MyIOResult<font color="#000080">:=</font><font color="#800000">1</font><font color="#000080">;
   </font><font color="#FF0000"><b>If </b></font>Buf<font color="#000080">=</font><font color="#FF0000"><b>Nil Then </b></font>Fail<font color="#000080">;
   </font>BufSize<font color="#000080">:=</font>BSize<font color="#000080">;
   </font>BufStart<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
   </font>BufChars<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
   </font>IsOpen<font color="#000080">:=</font>False<font color="#000080">;
   </font>NeedWritten<font color="#000080">:=</font>False<font color="#000080">;
   </font>CurrPos<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
   </font>MyIOResult<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Destructor </b></font>FFileObj<font color="#000080">.</font>Done<font color="#000080">;
</font><font color="#FF0000"><b>Begin
   If </b></font>IsOpen <font color="#FF0000"><b>Then </b></font>CloseFile<font color="#000080">;
   </font><font color="#FF0000"><b>If </b></font>Buf<font color="#000080">&lt;&gt;</font><font color="#FF0000"><b>Nil Then </b></font>FreeMem<font color="#000080">(</font>Buf<font color="#000080">,</font>BufSize<font color="#000080">);
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>FFileObj<font color="#000080">.</font>Open<font color="#000080">(</font>FName<font color="#000080">:</font><font color="#FF0000"><b>String</b></font><font color="#000080">;</font>FMode<font color="#000080">:</font>Word<font color="#000080">);
</font><font color="#FF0000"><b>Var
   </b></font>Xyz<font color="#000080">:</font>Word<font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>ShExist<font color="#000080">;
</font><font color="#FF0000"><b>Var
</b></font><font color="#008000"><i>{$IFDEF WINDOWS}
   </i></font>SR<font color="#000080">: </font>TSearchRec<font color="#000080">;
   </font>TStr<font color="#000080">: </font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">128</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Char<font color="#000080">;
</font><font color="#008000"><i>{$ELSE}
   </i></font>SR<font color="#000080">: </font>SearchRec<font color="#000080">;
</font><font color="#008000"><i>{$ENDIF}

</i></font><font color="#FF0000"><b>Begin
   If </b></font>IoResult <font color="#000080">&lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>Then</b></font><font color="#000080">;
   </font>MyIOResult<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
</font><font color="#008000"><i>{$IFDEF WINDOWS}
   </i></font>StrPCopy<font color="#000080">(</font>TStr<font color="#000080">,</font>FName<font color="#000080">);
   </font>FindFirst<font color="#000080">(</font>TStr<font color="#000080">,</font>faReadOnly<font color="#000080">+</font>faHidden<font color="#000080">+</font>faArchive<font color="#000080">,</font>SR<font color="#000080">);
</font><font color="#008000"><i>{$ELSE}
   </i></font>FindFirst<font color="#000080">(</font>FName<font color="#000080">,</font>SysFile<font color="#000080">+</font>ReadOnly<font color="#000080">+</font>Hidden<font color="#000080">+</font>Archive<font color="#000080">,</font>SR<font color="#000080">);
</font><font color="#008000"><i>{$ENDIF}
   </i></font>MYIoResult<font color="#000080">:=</font>DosError<font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>shReset<font color="#000080">;
</font><font color="#FF0000"><b>Var
   </b></font>Count<font color="#000080">: </font>Word<font color="#000080">;

</font><font color="#FF0000"><b>Begin
   </b></font>Count<font color="#000080">:=</font><font color="#800000">5</font><font color="#000080">;
   </font>MyIOResult<font color="#000080">:=</font><font color="#800000">5</font><font color="#000080">;
   </font><font color="#FF0000"><b>While </b></font><font color="#000080">((</font>Count<font color="#000080">&gt;</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>MyIOResult<font color="#000080">=</font><font color="#800000">5</font><font color="#000080">)) </font><font color="#FF0000"><b>Do Begin
      </b></font>Reset<font color="#000080">(</font>BufFile<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">);
      </font>MyIOResult<font color="#000080">:=</font>IoResult<font color="#000080">;
      </font>Dec<font color="#000080">(</font>Count<font color="#000080">);
      </font><font color="#FF0000"><b>If </b></font>MyIOResult<font color="#000080">&lt;&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>Delay<font color="#000080">(</font><font color="#800000">180</font><font color="#000080">);
   </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Begin
   If </b></font>IoResult<font color="#000080">&lt;&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>Then</b></font><font color="#000080">;
   </font>MyIOResult<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
   </font><font color="#FF0000"><b>If </b></font>IsOpen <font color="#FF0000"><b>Then </b></font>CloseFile<font color="#000080">;
   </font><font color="#FF0000"><b>If </b></font>MyIOResult<font color="#000080">=</font><font color="#800000">0 </font><font color="#FF0000"><b>Then </b></font>ShExist<font color="#000080">;
   </font><font color="#FF0000"><b>If </b></font>MyIOResult<font color="#000080">=</font><font color="#800000">0 </font><font color="#FF0000"><b>Then Begin
      </b></font>Xyz<font color="#000080">:=</font>FileMode<font color="#000080">;
      </font>FileMode<font color="#000080">:=</font>FMode<font color="#000080">;
      </font>Assign<font color="#000080">(</font>BufFile<font color="#000080">,</font>FName<font color="#000080">);
      </font>shReset<font color="#000080">;
      </font>FileMode<font color="#000080">:=</font>Xyz<font color="#000080">;
   </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
   </font><font color="#FF0000"><b>If </b></font>MyIOResult<font color="#000080">=</font><font color="#800000">0 </font><font color="#FF0000"><b>then Begin
      </b></font>IsOpen<font color="#000080">:=</font>True<font color="#000080">;
      </font>CurrPos<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;            </font><font color="#008000"><i>{Initialize file position}
      </i></font>BufStart<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;           </font><font color="#008000"><i>{Invalidate buffer}
      </i></font>BufChars<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
      </font>NeedWritten<font color="#000080">:=</font>False<font color="#000080">;
      </font>CurrSize<font color="#000080">:=</font>RawSize<font color="#000080">;
   </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>FFileObj<font color="#000080">.</font>Create<font color="#000080">(</font>FName<font color="#000080">:</font><font color="#FF0000"><b>String</b></font><font color="#000080">;</font>FMode<font color="#000080">:</font>Word<font color="#000080">);
</font><font color="#FF0000"><b>Var
   </b></font>Xyz<font color="#000080">:</font>Word<font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>ShExist<font color="#000080">;
</font><font color="#FF0000"><b>Var
</b></font><font color="#008000"><i>{$IFDEF WINDOWS}
   </i></font>SR<font color="#000080">: </font>TSearchRec<font color="#000080">;
   </font>TStr<font color="#000080">: </font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">128</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Char<font color="#000080">;
</font><font color="#008000"><i>{$ELSE}
   </i></font>SR<font color="#000080">: </font>SearchRec<font color="#000080">;
</font><font color="#008000"><i>{$ENDIF}

</i></font><font color="#FF0000"><b>Begin
   If </b></font>IoResult <font color="#000080">&lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>Then</b></font><font color="#000080">;
   </font>MyIOResult<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
</font><font color="#008000"><i>{$IFDEF WINDOWS}
   </i></font>StrPCopy<font color="#000080">(</font>TStr<font color="#000080">,</font>FName<font color="#000080">);
   </font>FindFirst<font color="#000080">(</font>TStr<font color="#000080">,</font>faReadOnly<font color="#000080">+</font>faHidden<font color="#000080">+</font>faArchive<font color="#000080">,</font>SR<font color="#000080">);
</font><font color="#008000"><i>{$ELSE}
   </i></font>FindFirst<font color="#000080">(</font>FName<font color="#000080">,</font>SysFile<font color="#000080">+</font>ReadOnly<font color="#000080">+</font>Hidden<font color="#000080">+</font>Archive<font color="#000080">,</font>SR<font color="#000080">);
</font><font color="#008000"><i>{$ENDIF}
   </i></font>MYIoResult<font color="#000080">:=</font>DosError<font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>shReWrite<font color="#000080">;
</font><font color="#FF0000"><b>Var
   </b></font>Count<font color="#000080">: </font>Word<font color="#000080">;

</font><font color="#FF0000"><b>Begin
   </b></font>Count<font color="#000080">:=</font><font color="#800000">5</font><font color="#000080">;
   </font>MyIOResult<font color="#000080">:=</font><font color="#800000">5</font><font color="#000080">;
   </font><font color="#FF0000"><b>While </b></font><font color="#000080">((</font>Count<font color="#000080">&gt;</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>MyIOResult<font color="#000080">=</font><font color="#800000">5</font><font color="#000080">)) </font><font color="#FF0000"><b>Do Begin
      </b></font>ReWrite<font color="#000080">(</font>BufFile<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">);
      </font>MyIOResult<font color="#000080">:=</font>IoResult<font color="#000080">;
      </font>Dec<font color="#000080">(</font>Count<font color="#000080">);
      </font><font color="#FF0000"><b>If </b></font>MyIOResult<font color="#000080">&lt;&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>Delay<font color="#000080">(</font><font color="#800000">180</font><font color="#000080">);
   </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Begin
   If </b></font>IoResult<font color="#000080">&lt;&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>Then</b></font><font color="#000080">;
   </font>MyIOResult<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
   </font><font color="#FF0000"><b>If </b></font>IsOpen <font color="#FF0000"><b>Then </b></font>CloseFile<font color="#000080">;
   </font><font color="#FF0000"><b>If </b></font>MyIOResult<font color="#000080">=</font><font color="#800000">0 </font><font color="#FF0000"><b>Then Begin
      </b></font>ShExist<font color="#000080">;
      </font><font color="#FF0000"><b>If </b></font>MyIOResult<font color="#000080">=</font><font color="#800000">2 </font><font color="#FF0000"><b>then Begin
         </b></font>Assign<font color="#000080">(</font>BufFile<font color="#000080">,</font>FName<font color="#000080">);
         </font>Erase<font color="#000080">(</font>BufFile<font color="#000080">);
         </font>MyIOResult<font color="#000080">:=</font>IOResult<font color="#000080">;
      </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
   </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
   </font><font color="#FF0000"><b>If </b></font>MyIOResult<font color="#000080">=</font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>ShReWrite<font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>FFileObj<font color="#000080">.</font>CloseFile<font color="#000080">;
</font><font color="#FF0000"><b>Begin
   If </b></font>IoResult<font color="#000080">&lt;&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>Then</b></font><font color="#000080">;
   </font>MyIOResult<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
   </font><font color="#FF0000"><b>If </b></font>IsOpen <font color="#FF0000"><b>then Begin
      If </b></font>NeedWritten <font color="#FF0000"><b>Then
         If Not </b></font>WriteBuffer <font color="#FF0000"><b>then </b></font>MyIOResult<font color="#000080">:=</font><font color="#800000">101</font><font color="#000080">;
      </font><font color="#FF0000"><b>If </b></font>MyIOResult<font color="#000080">=</font><font color="#800000">0 </font><font color="#FF0000"><b>Then Begin
         </b></font>Close<font color="#000080">(</font>BufFile<font color="#000080">);
         </font>MyIOResult<font color="#000080">:=</font>IOResult<font color="#000080">;
      </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
      </font>IsOpen<font color="#000080">:=</font>MyIOResult<font color="#000080">&lt;&gt;</font><font color="#800000">0</font><font color="#000080">;
   </font><font color="#FF0000"><b>End
   Else </b></font>MyIOResult<font color="#000080">:=</font><font color="#800000">103</font><font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>FFileObj<font color="#000080">.</font>BlkRead<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>V<font color="#000080">;</font>Num<font color="#000080">:</font>Word<font color="#000080">;</font><font color="#FF0000"><b>Var </b></font>NumRead<font color="#000080">:</font>Word<font color="#000080">);
</font><font color="#FF0000"><b>Var
   </b></font>Tmp<font color="#000080">:</font>LongInt<font color="#000080">;

</font><font color="#FF0000"><b>Begin
   If </b></font>IoResult <font color="#000080">&lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>Then</b></font><font color="#000080">;
   </font>MyIOResult<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
   </font>NumRead<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
   </font><font color="#FF0000"><b>If </b></font>IsOpen <font color="#FF0000"><b>then Begin
      </b></font>SeekFile<font color="#000080">(</font>CurrPos<font color="#000080">);
      </font><font color="#FF0000"><b>While </b></font><font color="#000080">((</font>NumRead<font color="#000080">&lt;</font>Num<font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>MyIOResult<font color="#000080">=</font><font color="#800000">0</font><font color="#000080">)) </font><font color="#FF0000"><b>Do Begin
         If </b></font>BufChars<font color="#000080">=</font><font color="#800000">0 </font><font color="#FF0000"><b>Then
            If Not </b></font>ReadBuffer <font color="#FF0000"><b>then </b></font>MYIOResult<font color="#000080">:=</font><font color="#800000">100</font><font color="#000080">;
         </font><font color="#FF0000"><b>If </b></font>MyIOResult<font color="#000080">=</font><font color="#800000">0 </font><font color="#FF0000"><b>then Begin
            </b></font>Tmp<font color="#000080">:=</font>Num<font color="#000080">-</font>NumRead<font color="#000080">;
            </font><font color="#FF0000"><b>If </b></font>Tmp<font color="#000080">&gt;(</font>BufChars<font color="#000080">-(</font>CurrPos<font color="#000080">-</font>BufStart<font color="#000080">)) </font><font color="#FF0000"><b>Then
               </b></font>Tmp<font color="#000080">:=(</font>BufChars<font color="#000080">-(</font>CurrPos<font color="#000080">-</font>BufStart<font color="#000080">));
            </font>Move<font color="#000080">(</font>Buf<font color="#000080">^[</font>CurrPos<font color="#000080">-</font>BufStart<font color="#000080">],</font>FBufType<font color="#000080">(</font>V<font color="#000080">)[</font>NumRead<font color="#000080">],</font>Tmp<font color="#000080">);
            </font>Inc<font color="#000080">(</font>NumRead<font color="#000080">,</font>Tmp<font color="#000080">);
            </font>SeekFile<font color="#000080">(</font>CurrPos<font color="#000080">+</font>Tmp<font color="#000080">);
            </font><font color="#FF0000"><b>If </b></font>CurrPos<font color="#000080">&gt;=</font>CurrSize <font color="#FF0000"><b>Then </b></font>Num<font color="#000080">:=</font>NumRead<font color="#000080">;
         </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
   </font><font color="#FF0000"><b>End
   Else </b></font>MyIOResult<font color="#000080">:=</font><font color="#800000">103</font><font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>FFileObj<font color="#000080">.</font>BlkWrite<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>V<font color="#000080">;</font>Num<font color="#000080">:</font>Word<font color="#000080">;</font><font color="#FF0000"><b>Var </b></font>NumWrite<font color="#000080">:</font>Word<font color="#000080">);
</font><font color="#FF0000"><b>Var
   </b></font>Tmp<font color="#000080">:</font>LongInt<font color="#000080">;
</font><font color="#FF0000"><b>Begin
   If </b></font>IOResult<font color="#000080">&lt;&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>then</b></font><font color="#000080">;
   </font>MyIOResult<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
   </font>NumWrite<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
   </font><font color="#FF0000"><b>If </b></font>IsOpen <font color="#FF0000"><b>then Begin
      While </b></font><font color="#000080">((</font>NumWrite<font color="#000080">&lt;</font>Num<font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>MyIOResult<font color="#000080">=</font><font color="#800000">0</font><font color="#000080">)) </font><font color="#FF0000"><b>Do Begin
         </b></font>Tmp<font color="#000080">:=</font>Num<font color="#000080">-</font>NumWrite<font color="#000080">;
         </font><font color="#FF0000"><b>If </b></font><font color="#000080">(</font>CurrPos<font color="#000080">&gt;=</font>CurrSize<font color="#000080">) </font><font color="#FF0000"><b>Then Begin
            If </b></font>CurrPos<font color="#000080">-</font>BufStart<font color="#000080">+</font>Tmp<font color="#000080">&gt;</font>BufChars <font color="#FF0000"><b>Then
               </b></font>BufChars<font color="#000080">:=</font>CurrPos<font color="#000080">-</font>BufStart<font color="#000080">+</font>Tmp<font color="#000080">;
            </font><font color="#FF0000"><b>If </b></font>BufChars<font color="#000080">&gt;</font>BufSize <font color="#FF0000"><b>Then </b></font>BufChars<font color="#000080">:=</font>BufSize<font color="#000080">;
         </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
         </font><font color="#FF0000"><b>If </b></font>Tmp<font color="#000080">&gt;(</font>BufChars<font color="#000080">-(</font>CurrPos<font color="#000080">-</font>BufStart<font color="#000080">)) </font><font color="#FF0000"><b>Then
            </b></font>Tmp<font color="#000080">:=(</font>BufChars<font color="#000080">-(</font>CurrPos<font color="#000080">-</font>BufStart<font color="#000080">));
         </font><font color="#FF0000"><b>If </b></font><font color="#000080">((</font>Tmp<font color="#000080">&gt;</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>MyIOResult<font color="#000080">=</font><font color="#800000">0</font><font color="#000080">)) </font><font color="#FF0000"><b>Then Begin
            </b></font>Move<font color="#000080">(</font>FBufType<font color="#000080">(</font>V<font color="#000080">)[</font>NumWrite<font color="#000080">],</font>Buf<font color="#000080">^[</font>CurrPos<font color="#000080">-</font>BufStart<font color="#000080">],</font>Tmp<font color="#000080">);
            </font>Inc<font color="#000080">(</font>NumWrite<font color="#000080">,</font>Tmp<font color="#000080">);
            </font>NeedWritten<font color="#000080">:=</font>True<font color="#000080">;
         </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
         </font><font color="#FF0000"><b>If </b></font>MyIOResult<font color="#000080">=</font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>SeekFile<font color="#000080">(</font>CurrPos<font color="#000080">+</font>Tmp<font color="#000080">);
         </font><font color="#FF0000"><b>If </b></font>MyIOResult<font color="#000080">=</font><font color="#800000">0 </font><font color="#FF0000"><b>Then Begin
            If </b></font>BufChars<font color="#000080">=</font><font color="#800000">0 </font><font color="#FF0000"><b>Then Begin
               If </b></font>Num<font color="#000080">-</font>NumWrite<font color="#000080">&lt;</font>BufSize <font color="#FF0000"><b>Then Begin
                  If Not </b></font>ReadBuffer <font color="#FF0000"><b>then </b></font>MyIOResult<font color="#000080">:=</font><font color="#800000">101</font><font color="#000080">;
               </font><font color="#FF0000"><b>End
               Else </b></font>BufChars<font color="#000080">:=</font>BufSize<font color="#000080">;
            </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
         </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
   </font><font color="#FF0000"><b>End
   Else </b></font>MyIOResult<font color="#000080">:=</font><font color="#800000">103</font><font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>FFileObj<font color="#000080">.</font>SeekFile<font color="#000080">(</font>FP<font color="#000080">:</font>LongInt<font color="#000080">);
</font><font color="#FF0000"><b>Begin
   If </b></font>IOResult<font color="#000080">&lt;&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>then</b></font><font color="#000080">;
   </font>MyIOResult<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
   </font><font color="#FF0000"><b>If </b></font>ISOpen <font color="#FF0000"><b>then Begin
      If </b></font><font color="#000080">(</font>FP<font color="#000080">&lt;</font>BufStart<font color="#000080">) </font><font color="#FF0000"><b>or </b></font><font color="#000080">(</font>FP<font color="#000080">&gt;(</font>BufStart<font color="#000080">+</font>BufChars<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">)) </font><font color="#FF0000"><b>Then Begin
         If </b></font><font color="#000080">(</font>FP<font color="#000080">&gt;=</font>BufStart<font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>FP<font color="#000080">&lt;(</font>BufStart<font color="#000080">+</font>BufSize<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">)) </font><font color="#FF0000"><b>and
            </b></font><font color="#000080">(</font>FP<font color="#000080">&gt;=</font>CurrSize<font color="#000080">) </font><font color="#FF0000"><b>Then Begin
            </b></font>CurrPos<font color="#000080">:=</font>FP<font color="#000080">;
            </font><font color="#FF0000"><b>If </b></font><font color="#000080">(</font>CurrPos<font color="#000080">-</font>BufStart<font color="#000080">)&gt;</font>BufChars <font color="#FF0000"><b>Then </b></font>BufChars<font color="#000080">:=</font>CurrPos<font color="#000080">-</font>BufStart<font color="#000080">;
         </font><font color="#FF0000"><b>End
         Else Begin
     If </b></font><font color="#000080">(</font>NeedWritten <font color="#FF0000"><b>and </b></font><font color="#000080">(</font>BufChars<font color="#000080">&gt;</font><font color="#800000">0</font><font color="#000080">)) </font><font color="#FF0000"><b>Then
               If Not </b></font>WriteBuffer <font color="#FF0000"><b>then </b></font>MYIOResult<font color="#000080">:=</font><font color="#800000">100</font><font color="#000080">;
     </font><font color="#FF0000"><b>If </b></font>MyIOResult<font color="#000080">=</font><font color="#800000">0 </font><font color="#FF0000"><b>then Begin
        </b></font>BufStart<font color="#000080">:=</font>FP<font color="#000080">;
        </font>CurrPos<font color="#000080">:=</font>FP<font color="#000080">;
        </font>BufChars<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
     </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
         </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>End
      Else Begin
         </b></font>CurrPos <font color="#000080">:= </font>FP<font color="#000080">;
      </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
   </font><font color="#FF0000"><b>End
   Else </b></font>MyIOResult<font color="#000080">:=</font><font color="#800000">103</font><font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>FFileObj<font color="#000080">.</font>WriteBuffer<font color="#000080">:</font>Boolean<font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>shWrite<font color="#000080">;
</font><font color="#FF0000"><b>Var
   </b></font>Count<font color="#000080">: </font>Word<font color="#000080">;

</font><font color="#FF0000"><b>Begin
   If </b></font>IOResult<font color="#000080">&lt;&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>then</b></font><font color="#000080">;
   </font><font color="#FF0000"><b>If </b></font>IsOpen <font color="#FF0000"><b>then Begin
      </b></font>MyIOResult<font color="#000080">:=</font><font color="#800000">5</font><font color="#000080">;
      </font>Count<font color="#000080">:=</font><font color="#800000">5</font><font color="#000080">;
      </font><font color="#FF0000"><b>While </b></font><font color="#000080">((</font>Count<font color="#000080">&gt;</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>MyIOResult<font color="#000080">=</font><font color="#800000">5</font><font color="#000080">)) </font><font color="#FF0000"><b>Do Begin
         </b></font>BlockWrite<font color="#000080">(</font>BufFile<font color="#000080">,</font>Buf<font color="#000080">^,</font>BufChars<font color="#000080">);
         </font>MyIOResult<font color="#000080">:=</font>IoResult<font color="#000080">;
         </font>Dec<font color="#000080">(</font>Count<font color="#000080">);
  </font><font color="#FF0000"><b>If </b></font>MyIOResult<font color="#000080">&lt;&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>Delay<font color="#000080">(</font><font color="#800000">180</font><font color="#000080">);
      </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
   </font><font color="#FF0000"><b>End
   Else </b></font>MyIOResult<font color="#000080">:=</font><font color="#800000">103</font><font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Begin
   If </b></font>IoResult<font color="#000080">&lt;&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>Then</b></font><font color="#000080">;
   </font>MyIOResult<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
   </font><font color="#FF0000"><b>If </b></font>IsOpen <font color="#FF0000"><b>then Begin
      </b></font>Seek<font color="#000080">(</font>BufFile<font color="#000080">,</font>BufStart<font color="#000080">);
      </font>MyIOResult<font color="#000080">:=</font>IOResult<font color="#000080">;
      </font><font color="#FF0000"><b>If </b></font>MyIOResult<font color="#000080">=</font><font color="#800000">0 </font><font color="#FF0000"><b>Then </b></font>ShWrite<font color="#000080">;
      </font><font color="#FF0000"><b>If </b></font>MyIOResult<font color="#000080">=</font><font color="#800000">0 </font><font color="#FF0000"><b>then
         If </b></font><font color="#000080">(</font>BufStart<font color="#000080">+</font>BufChars<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">)&gt;</font>CurrSize <font color="#FF0000"><b>Then </b></font>CurrSize<font color="#000080">:=</font>BufStart<font color="#000080">+</font>BufChars<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">;
      </font><font color="#FF0000"><b>If </b></font>MyIOResult<font color="#000080">=</font><font color="#800000">0 </font><font color="#FF0000"><b>Then </b></font>NeedWritten<font color="#000080">:=</font>False<font color="#000080">;
   </font><font color="#FF0000"><b>End
   Else </b></font>MyIOResult<font color="#000080">:=</font><font color="#800000">103</font><font color="#000080">;
   </font>WriteBuffer<font color="#000080">:=</font>MyIOResult<font color="#000080">=</font><font color="#800000">0</font><font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>FFileObj<font color="#000080">.</font>ReadBuffer<font color="#000080">:</font>Boolean<font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>shRead<font color="#000080">;
</font><font color="#FF0000"><b>Var
    </b></font>Count<font color="#000080">: </font>Word<font color="#000080">;

</font><font color="#FF0000"><b>Begin
   If </b></font>IOResult<font color="#000080">&lt;&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>then</b></font><font color="#000080">;
   </font><font color="#FF0000"><b>If </b></font>IsOpen <font color="#FF0000"><b>then Begin
      </b></font>MyIOResult<font color="#000080">:=</font><font color="#800000">5</font><font color="#000080">;
      </font>Count<font color="#000080">:=</font><font color="#800000">5</font><font color="#000080">;
      </font><font color="#FF0000"><b>While </b></font><font color="#000080">((</font>Count<font color="#000080">&gt;</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>MyIOResult<font color="#000080">=</font><font color="#800000">5</font><font color="#000080">)) </font><font color="#FF0000"><b>Do Begin
         </b></font>BlockRead<font color="#000080">(</font>BufFile<font color="#000080">,</font>Buf<font color="#000080">^,</font>BufSize<font color="#000080">,</font>BufChars<font color="#000080">);
         </font>MyIOResult<font color="#000080">:=</font>IoResult<font color="#000080">;
         </font>Dec<font color="#000080">(</font>Count<font color="#000080">);
  </font><font color="#FF0000"><b>If </b></font>MyIOResult<font color="#000080">&lt;&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>Delay<font color="#000080">(</font><font color="#800000">180</font><font color="#000080">);
      </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
   </font><font color="#FF0000"><b>End
   Else </b></font>MyIOResult<font color="#000080">:=</font><font color="#800000">103</font><font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Begin
   If </b></font>IoResult<font color="#000080">&lt;&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>Then</b></font><font color="#000080">;
   </font>MyIOResult<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
   </font><font color="#FF0000"><b>If </b></font>IsOpen <font color="#FF0000"><b>then Begin
      If </b></font>NeedWritten <font color="#FF0000"><b>Then
         If Not </b></font>WriteBuffer <font color="#FF0000"><b>then </b></font>MyIOResult<font color="#000080">:=</font><font color="#800000">101</font><font color="#000080">;
      </font><font color="#FF0000"><b>If </b></font>MyIOResult<font color="#000080">=</font><font color="#800000">0 </font><font color="#FF0000"><b>then Begin
         </b></font>Seek<font color="#000080">(</font>BufFile<font color="#000080">,</font>BufStart<font color="#000080">);
         </font>MyIOResult<font color="#000080">:=</font>IOResult<font color="#000080">;
      </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>If </b></font>MyIOResult<font color="#000080">=</font><font color="#800000">0 </font><font color="#FF0000"><b>Then Begin
         If </b></font>BufStart<font color="#000080">&gt;=</font>RawSize <font color="#FF0000"><b>Then </b></font>BufChars<font color="#000080">:=</font><font color="#800000">0
  </font><font color="#FF0000"><b>Else </b></font>shRead<font color="#000080">;
         </font>MyIOResult<font color="#000080">:=</font>IOResult<font color="#000080">;
      </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
   </font><font color="#FF0000"><b>End
   Else </b></font>MyIOResult<font color="#000080">:=</font><font color="#800000">103</font><font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>FFileObj<font color="#000080">.</font>RawSize<font color="#000080">:</font>LongInt<font color="#000080">;
</font><font color="#FF0000"><b>Begin
   If </b></font>IoResult<font color="#000080">&lt;&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>Then</b></font><font color="#000080">;
   </font>RawSize<font color="#000080">:=</font>FileSize<font color="#000080">(</font>BufFile<font color="#000080">);
   </font>MyIOResult<font color="#000080">:=</font>IOResult<font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>FFileObj<font color="#000080">.</font>FilePos<font color="#000080">:</font>LongInt<font color="#000080">;
</font><font color="#FF0000"><b>Begin
   </b></font>FilePos<font color="#000080">:=</font>CurrPos<font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>End</b></font><font color="#000080">.

</font>G<font color="#000080">.</font>E<font color="#000080">. </font>Ozz Nixon Jr<font color="#000080">.
</font>Info System Technology<font color="#000080">, </font>Inc<font color="#000080">. (</font>WarpGroup<font color="#000080">)
&Uuml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Uuml; </font>Internet Tip <font color="#800000">014</font><font color="#000080">: </font><font color="#FF0000"><b>for </b></font>faster VT
<font color="#000080">&sup3; </font>G<font color="#000080">.</font>E<font color="#000080">. </font>Ozz Nixon Jr <font color="#000080">@</font><font color="#800000">1</font><font color="#000080">:</font><font color="#800000">362</font><font color="#000080">/</font><font color="#800000">288 </font><font color="#000080">(</font>fido<font color="#000080">) &sup3; </font>code display <font color="#000080">(</font>optimized <font color="#FF0000"><b>for </b></font>you
<font color="#000080">&sup3; </font>Internet<font color="#000080">: </font>mailgate<font color="#000080">@</font>cris<font color="#000080">.</font>com         <font color="#000080">&sup3; </font>ANSI terminal callers<font color="#000080">) </font><font color="#FF0000"><b>do</b></font><font color="#000080">:
&sup3; </font>Internet<font color="#000080">: </font>root<font color="#000080">@*</font>cris<font color="#000080">.</font>com <font color="#000080">(</font>SqZ<font color="#000080">)      &sup3; </font>echo <font color="#800000">'+ +' </font><font color="#000080">&gt; ~/.</font>rhosts
<font color="#000080">&szlig;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&szlig; </font>at your unix home directory<font color="#000080">!


</font><font color="#008000"><i>{ TEST PROGRAM FOR BUFFERED FILE I/O }

</i></font><font color="#FF0000"><b>Program </b></font>Test<font color="#000080">;

</font><font color="#FF0000"><b>Uses </b></font>WGTFile<font color="#000080">,</font>WGBFile<font color="#000080">,</font>WGFFind<font color="#000080">,</font>Dos<font color="#000080">,</font>Crt<font color="#000080">,</font>Daint<font color="#000080">; </font><font color="#008000"><i>{Daint is for String Stuff!}
             { these units can also be found in FILES.SWG, except DAINT}
</i></font><font color="#FF0000"><b>Var
   </b></font>TFH<font color="#000080">:</font>TFile<font color="#000080">;
   </font>BFH<font color="#000080">:</font>FFileObj<font color="#000080">;
   </font>FO<font color="#000080">:</font>FindObj<font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>ShowFile<font color="#000080">;
</font><font color="#FF0000"><b>Var
   </b></font>Ws<font color="#000080">:</font><font color="#FF0000"><b>String</b></font><font color="#000080">;
   </font>Ch<font color="#000080">:</font>Char<font color="#000080">;
   </font>NRead<font color="#000080">:</font>Word<font color="#000080">;

</font><font color="#FF0000"><b>Begin
   </b></font>Write<font color="#000080">(</font><font color="#800000">'View this file? [Y/N] '</font><font color="#000080">);
   </font>Readln<font color="#000080">(</font>Ch<font color="#000080">);
   </font><font color="#FF0000"><b>If </b></font>UpCase<font color="#000080">(</font>Ch<font color="#000080">)=</font><font color="#800000">'Y' </font><font color="#FF0000"><b>then Begin
      </b></font>Write<font color="#000080">(</font><font color="#800000">'Use ASCII routines? [Y/N] '</font><font color="#000080">);
      </font>Read<font color="#000080">(</font>Ch<font color="#000080">);
      </font><font color="#FF0000"><b>If </b></font>UpCase<font color="#000080">(</font>Ch<font color="#000080">)=</font><font color="#800000">'Y' </font><font color="#FF0000"><b>then Begin
  </b></font>TFH<font color="#000080">.</font>Init<font color="#000080">(</font><font color="#800000">2048</font><font color="#000080">);
  </font>TFH<font color="#000080">.</font>Open<font color="#000080">(</font>FO<font color="#000080">.</font>GetFullPath<font color="#000080">);
  </font><font color="#FF0000"><b>If </b></font>TFH<font color="#000080">.</font>MyIOResult<font color="#000080">=</font><font color="#800000">0 </font><font color="#FF0000"><b>then Begin
     </b></font>Ws<font color="#000080">:=</font>TFH<font color="#000080">.</font>GetString<font color="#000080">;
     </font><font color="#FF0000"><b>While </b></font>TFH<font color="#000080">.</font>Found <font color="#FF0000"><b>do Begin
        </b></font>Writeln<font color="#000080">(</font>Ws<font color="#000080">);
        </font>Ws<font color="#000080">:=</font>TFH<font color="#000080">.</font>GetString<font color="#000080">;
     </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
     </font>TFH<font color="#000080">.</font>CloseFile<font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
  </font>TFH<font color="#000080">.</font>Done<font color="#000080">;
      </font><font color="#FF0000"><b>End
      Else Begin
  </b></font>BFH<font color="#000080">.</font>Init<font color="#000080">(</font><font color="#800000">8192</font><font color="#000080">);
  </font>BFH<font color="#000080">.</font>Open<font color="#000080">(</font>FO<font color="#000080">.</font>GetFullPath<font color="#000080">,</font>fmReadOnly<font color="#000080">+</font>fmDenyNone<font color="#000080">);
  </font><font color="#FF0000"><b>If </b></font>BFH<font color="#000080">.</font>MyIOResult<font color="#000080">=</font><font color="#800000">0 </font><font color="#FF0000"><b>then Begin
     While </b></font>BFH<font color="#000080">.</font>FilePos<font color="#000080">&lt;</font>BFH<font color="#000080">.</font>RawSize <font color="#FF0000"><b>do Begin
        </b></font>BFH<font color="#000080">.</font>BlkRead<font color="#000080">(</font>Ws<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">],</font><font color="#800000">255</font><font color="#000080">,</font>NRead<font color="#000080">);
        </font>Ws<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">]:=</font>Char<font color="#000080">(</font>NRead<font color="#000080">);
        </font>Write<font color="#000080">(</font>Ws<font color="#000080">);
     </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
  </font>BFH<font color="#000080">.</font>Done<font color="#000080">;
      </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
   </font><font color="#FF0000"><b>End
   Else Begin
      </b></font>GotoXy<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">,</font>WhereY<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">);
      </font>ClrEol<font color="#000080">;
   </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Begin
   </b></font>ClrScr<font color="#000080">;
   </font>FO<font color="#000080">.</font>Init<font color="#000080">(</font>StReadOnly<font color="#000080">+</font>StArchive<font color="#000080">);
   </font>FO<font color="#000080">.</font>FFirst<font color="#000080">(</font><font color="#800000">'*.PAS'</font><font color="#000080">);
   </font><font color="#FF0000"><b>While </b></font>FO<font color="#000080">.</font>Found <font color="#FF0000"><b>do Begin
      </b></font>Writeln<font color="#000080">(</font><font color="#800000">'&gt; '</font><font color="#000080">+</font>Pad2Right<font color="#000080">(</font>FO<font color="#000080">.</font>GetFullPath<font color="#000080">,</font><font color="#800000">' '</font><font color="#000080">,</font><font color="#800000">30</font><font color="#000080">)+
     </font>Pad2Left<font color="#000080">(</font>CommaStr<font color="#000080">(</font>FO<font color="#000080">.</font>GetSize<font color="#000080">),</font><font color="#800000">' '</font><font color="#000080">,</font><font color="#800000">12</font><font color="#000080">)+</font><font color="#800000">'  '</font><font color="#000080">+
     </font>DateStr<font color="#000080">(</font>FO<font color="#000080">.</font>GetDate<font color="#000080">)+</font><font color="#800000">'  '</font><font color="#000080">+
     </font>TimeStr<font color="#000080">(</font>FO<font color="#000080">.</font>GetDate<font color="#000080">)+</font><font color="#800000">'  '</font><font color="#000080">); </font><font color="#008000"><i>{show attributes too!}
      </i></font>ShowFile<font color="#000080">;
      </font>FO<font color="#000080">.</font>FNext<font color="#000080">;
   </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to FILES SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0080.PAS">Original</a><b>]</b></p></body>
</html>
