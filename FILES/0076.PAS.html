<html>
<head><title> "Delete All Files + Sub-Dirs" by RUSS CHINOY</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to FILES SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0076.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
From: russchinoy@aol.com (RussChinoy)
&gt;Does anyone have know of where I can get a hold of a routine to delete
&gt;all files off a floppy disk regardless, including all subdirectores?

Here's the source to a little DOS utility that I wrote to do exactly what
you are looking for (actually, it's slightly more flexible since you can
specify the starting directory; you can just specify the root), using a
recursive routine.
}

{$A-,B-,D-,E-,F-,G-,I-,L-,N-,O-,R-,S-,V-,X+}
{$M 65520, 0, 0}

</i></font><font color="#FF0000"><b>PROGRAM </b></font>XRD<font color="#000080">;

</font><font color="#008000"><i>{ This program deletes all files and subdirectories below the specified
  directory, and then removes the specified directory as well.          }

</i></font><font color="#FF0000"><b>USES
    </b></font>Dos<font color="#000080">,
    </font>OpDos<font color="#000080">,
    </font>OpCrt<font color="#000080">,
    </font>OpString<font color="#000080">;

</font><font color="#FF0000"><b>CONST
     </b></font>Version <font color="#000080">= </font><font color="#800000">'1.01'</font><font color="#000080">;

</font><font color="#FF0000"><b>VAR
   </b></font>XRDPath <font color="#000080">: </font>PathStr<font color="#000080">;
   </font>f       <font color="#000080">: </font><font color="#FF0000"><b>file</b></font><font color="#000080">;

</font><font color="#008000"><i>{*************************************************************************
**}

</i></font><font color="#FF0000"><b>PROCEDURE </b></font>Init<font color="#000080">;
</font><font color="#FF0000"><b>VAR
   </b></font>TempPath <font color="#000080">: </font>PathStr<font color="#000080">;
   </font>c        <font color="#000080">: </font>char<font color="#000080">;
</font><font color="#FF0000"><b>BEGIN
</b></font>writeln<font color="#000080">;
</font>writeln<font color="#000080">(</font><font color="#800000">'XRD, Version '</font><font color="#000080">, </font>Version<font color="#000080">, </font><font color="#800000">', Copyright (c) 1992 RC Software'</font><font color="#000080">);
</font>writeln<font color="#000080">;
</font><font color="#FF0000"><b>IF </b></font>paramcount <font color="#000080">&lt;&gt; </font><font color="#800000">1 </font><font color="#FF0000"><b>THEN
   BEGIN
   </b></font>writeln<font color="#000080">(</font><font color="#800000">'   Purpose:  XRD removes the specified directory, and'</font><font color="#000080">);
   </font>writeln<font color="#000080">(</font><font color="#800000">'             all files and subdirectories under it.'</font><font color="#000080">);
   </font>writeln<font color="#000080">;
   </font>writeln<font color="#000080">(</font><font color="#800000">'   Syntax:   XRD [d:]&lt;path&gt;'</font><font color="#000080">);
   </font>writeln<font color="#000080">;
   </font>writeln<font color="#000080">(</font><font color="#800000">'   Where:    d: is an optional drive specifier, and'</font><font color="#000080">);
   </font>writeln<font color="#000080">(</font><font color="#800000">'             &lt;path&gt; is the path to be removed.'</font><font color="#000080">);
   </font>writeln<font color="#000080">;
   </font>halt<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">);
   </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font>XRDPath <font color="#000080">:= </font>paramstr<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">);

</font><font color="#FF0000"><b>IF NOT </b></font>IsDirectory<font color="#000080">(</font>XRDPath<font color="#000080">) </font><font color="#FF0000"><b>THEN
   BEGIN
   </b></font>writeln<font color="#000080">(</font><font color="#800000">'Error: specified path not found.'</font><font color="#000080">);
   </font>writeln<font color="#000080">;
   </font>halt<font color="#000080">(</font><font color="#800000">2</font><font color="#000080">);
   </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font>XRDPath <font color="#000080">:= </font>fexpand<font color="#000080">(</font>XRDPath<font color="#000080">);

</font><font color="#FF0000"><b>IF </b></font>XRDPath<font color="#000080">[</font>length<font color="#000080">(</font>XRDPath<font color="#000080">)] &lt;&gt; </font><font color="#800000">'\'
   </font><font color="#FF0000"><b>THEN </b></font>XRDPath <font color="#000080">:= </font>XRDPath <font color="#000080">+ </font><font color="#800000">'\'</font><font color="#000080">;

</font>XRDPath <font color="#000080">:= </font>StUpCase<font color="#000080">(</font>XRDPath<font color="#000080">);

</font>TempPath <font color="#000080">:= </font>copy<font color="#000080">(</font>XRDPath<font color="#000080">, </font><font color="#800000">1</font><font color="#000080">, </font>length<font color="#000080">(</font>XRDPath<font color="#000080">) - </font><font color="#800000">1</font><font color="#000080">);

</font>writeln<font color="#000080">(</font><font color="#800000">'WARNING!!  You are about to remove the following directory'</font><font color="#000080">);
</font>writeln<font color="#000080">(</font><font color="#800000">'           (and delete all files and subdirectories under it):'</font><font color="#000080">);
</font>writeln<font color="#000080">(</font><font color="#800000">'           '#16' '</font><font color="#000080">, </font>TempPath<font color="#000080">, </font><font color="#800000">' '</font><font color="#000080">, </font><font color="#800000">#17</font><font color="#000080">);
</font>write<font color="#000080">(</font><font color="#800000">'Continue (Y/N)? '</font><font color="#000080">);

</font><font color="#FF0000"><b>REPEAT
</b></font>c <font color="#000080">:= </font>upcase<font color="#000080">(</font>readkey<font color="#000080">);
</font><font color="#FF0000"><b>IF </b></font>c <font color="#000080">= </font><font color="#800000">#0 </font><font color="#FF0000"><b>THEN
   BEGIN
   </b></font>c <font color="#000080">:= </font>readkey<font color="#000080">;
   </font>c <font color="#000080">:= </font><font color="#800000">#255</font><font color="#000080">;
   </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
</font><font color="#FF0000"><b>UNTIL </b></font>c <font color="#FF0000"><b>in </b></font><font color="#000080">[</font><font color="#800000">'Y'</font><font color="#000080">, </font><font color="#800000">'N'</font><font color="#000080">];
</font>writeln<font color="#000080">(</font>c<font color="#000080">);
</font>writeln<font color="#000080">;

</font><font color="#FF0000"><b>IF </b></font>c <font color="#000080">= </font><font color="#800000">'N' </font><font color="#FF0000"><b>THEN </b></font>halt<font color="#000080">(</font><font color="#800000">3</font><font color="#000080">);
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#008000"><i>{*************************************************************************
**}

</i></font><font color="#FF0000"><b>PROCEDURE </b></font>DeleteAllFilesInDir<font color="#000080">(</font>DirName <font color="#000080">: </font>PathStr<font color="#000080">);
</font><font color="#FF0000"><b>VAR
   </b></font>s <font color="#000080">: </font>searchrec<font color="#000080">;
</font><font color="#FF0000"><b>BEGIN
</b></font>FindFirst<font color="#000080">(</font>DirName <font color="#000080">+ </font><font color="#800000">'*.*'</font><font color="#000080">, </font>AnyFile<font color="#000080">, </font>s<font color="#000080">);
</font><font color="#FF0000"><b>WHILE </b></font>DosError <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>DO
      BEGIN
      IF </b></font><font color="#000080">(</font>s<font color="#000080">.</font>Attr <font color="#000080">&lt;&gt; </font>Directory<font color="#000080">) </font><font color="#FF0000"><b>AND
         </b></font><font color="#000080">(</font>s<font color="#000080">.</font>name <font color="#000080">&lt;&gt; </font><font color="#800000">'.'</font><font color="#000080">) </font><font color="#FF0000"><b>AND
         </b></font><font color="#000080">(</font>s<font color="#000080">.</font>name <font color="#000080">&lt;&gt; </font><font color="#800000">'..'</font><font color="#000080">)
         </font><font color="#FF0000"><b>THEN BEGIN
              </b></font>gotoxy<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">, </font>wherey<font color="#000080">);
              </font>clreol<font color="#000080">;
              </font>write<font color="#000080">(</font><font color="#800000">'Deleting: '</font><font color="#000080">, </font>DirName <font color="#000080">+ </font>s<font color="#000080">.</font>name<font color="#000080">);
              </font>Assign<font color="#000080">(</font>f<font color="#000080">, </font>DirName <font color="#000080">+ </font>s<font color="#000080">.</font>name<font color="#000080">);
              </font>erase<font color="#000080">(</font>f<font color="#000080">);
              </font><font color="#FF0000"><b>IF </b></font>IOResult <font color="#000080">&lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>THEN
                 BEGIN
                 </b></font>SetFAttr<font color="#000080">(</font>f<font color="#000080">, </font>Archive<font color="#000080">);
                 </font>erase<font color="#000080">(</font>f<font color="#000080">);
                 </font><font color="#FF0000"><b>IF </b></font>IOResult <font color="#000080">&lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>THEN
                   BEGIN
                   </b></font>gotoxy<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">, </font>wherey<font color="#000080">);
                   </font>clreol<font color="#000080">;
                   </font>writeln<font color="#000080">(</font><font color="#800000">'Error: unable to delete '</font><font color="#000080">, </font>DirName <font color="#000080">+ </font>s<font color="#000080">.</font>name<font color="#000080">);
                   </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
                 </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
              </font><font color="#FF0000"><b>END
         ELSE IF </b></font><font color="#000080">(</font>s<font color="#000080">.</font>Attr <font color="#000080">= </font>Directory<font color="#000080">) </font><font color="#FF0000"><b>AND
                 </b></font><font color="#000080">(</font>s<font color="#000080">.</font>name <font color="#000080">&lt;&gt; </font><font color="#800000">'.'</font><font color="#000080">) </font><font color="#FF0000"><b>AND
                 </b></font><font color="#000080">(</font>s<font color="#000080">.</font>name <font color="#000080">&lt;&gt; </font><font color="#800000">'..'</font><font color="#000080">)
                 </font><font color="#FF0000"><b>THEN </b></font>DeleteAllFilesInDir<font color="#000080">(</font>DirName <font color="#000080">+ </font>s<font color="#000080">.</font>name <font color="#000080">+ </font><font color="#800000">'\'</font><font color="#000080">);
      </font>FindNext<font color="#000080">(</font>s<font color="#000080">);
      </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>length<font color="#000080">(</font>DirName<font color="#000080">) &gt; </font><font color="#800000">1</font><font color="#000080">) </font><font color="#FF0000"><b>AND
   NOT </b></font><font color="#000080">((</font>length<font color="#000080">(</font>DirName<font color="#000080">) = </font><font color="#800000">3</font><font color="#000080">) </font><font color="#FF0000"><b>AND </b></font><font color="#000080">(</font>DirName<font color="#000080">[</font><font color="#800000">3</font><font color="#000080">] = </font><font color="#800000">'\'</font><font color="#000080">)) </font><font color="#FF0000"><b>THEN
   BEGIN
   </b></font>gotoxy<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">, </font>wherey<font color="#000080">);
   </font>clreol<font color="#000080">;
   </font>write<font color="#000080">(</font><font color="#800000">'Removing: '</font><font color="#000080">, </font>copy<font color="#000080">(</font>DirName<font color="#000080">, </font><font color="#800000">1</font><font color="#000080">, </font>length<font color="#000080">(</font>DirName<font color="#000080">) - </font><font color="#800000">1</font><font color="#000080">));

   </font>rmdir<font color="#000080">(</font>copy<font color="#000080">(</font>DirName<font color="#000080">, </font><font color="#800000">1</font><font color="#000080">, </font>length<font color="#000080">(</font>DirName<font color="#000080">) - </font><font color="#800000">1</font><font color="#000080">));

   </font><font color="#FF0000"><b>IF </b></font>IOResult <font color="#000080">&lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>THEN
      BEGIN
      </b></font>gotoxy<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">, </font>wherey<font color="#000080">);
      </font>clreol<font color="#000080">;
      </font>writeln<font color="#000080">(</font><font color="#800000">'Error: unable to remove '</font><font color="#000080">, </font>copy<font color="#000080">(</font>DirName<font color="#000080">, </font><font color="#800000">1</font><font color="#000080">, </font>length<font color="#000080">(</font>DirName<font color="#000080">)
- </font><font color="#800000">1</font><font color="#000080">));
      </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
   </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#008000"><i>{*************************************************************************
**}

</i></font><font color="#FF0000"><b>BEGIN
</b></font>Init<font color="#000080">;

</font>DeleteAllFilesInDir<font color="#000080">(</font>XRDPath<font color="#000080">);

</font>gotoxy<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">, </font>wherey<font color="#000080">);
</font>clreol<font color="#000080">;
</font>writeln<font color="#000080">(</font><font color="#800000">'Done.'</font><font color="#000080">);
</font>writeln<font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">.

</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to FILES SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0076.PAS">Original</a><b>]</b></p></body>
</html>
