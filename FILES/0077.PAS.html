<html>
<head><title> "Updated File Exists" by JOHN O'HARROW</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to FILES SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0077.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>(*
In an earlier release of SWAG Andrew Eigus provided code for a fast
'FileExist' function.

The function however has a potential bug in that the filename passed
into the function must be ASCIIZ (null terminated) to work correctly.
It will also return a TRUE result for a directory name or the volume ID.

My 'EntryExists' function below includes the extra code to convert the
filename to ASCIIZ and has been optimised for speed slightly by replacing
the Jump instruction.

My 'FileExists' function below is an extended version which returns TRUE
for files only (not a directory entry or volume ID).

*)

</i></font><font color="#FF0000"><b>FUNCTION </b></font>EntryExists<font color="#000080">(</font>FileName <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">) : </font>Boolean<font color="#000080">; </font><font color="#FF0000"><b>ASSEMBLER</b></font><font color="#000080">;
</font><font color="#FF0000"><b>ASM
  </b></font><font color="#FF00FF">PUSH DS          </font><font color="#008000"><i>{Save DS                         }
  </i></font><font color="#FF00FF">LDS  SI,Filename </font><font color="#008000"><i>{DS:SI =&gt; Filename               }
  </i></font><font color="#FF00FF">XOR  BX,BX       </font><font color="#008000"><i>{Clear BX                        }
  </i></font><font color="#FF00FF">MOV  BL,[SI]     </font><font color="#008000"><i>{BX = Length(Filename)           }
  </i></font><font color="#FF00FF">INC  SI          </font><font color="#008000"><i>{DS:SI =&gt; Filename[1]            }
  </i></font><font color="#FF00FF">MOV  DX,SI       </font><font color="#008000"><i>{DS:DX =&gt; Filename[1]            }
  </i></font><font color="#FF00FF">MOV  [SI+BX],BH  </font><font color="#008000"><i>{Append Ascii 0 to Filename      }
  </i></font><font color="#FF00FF">MOV  AX,4300h    </font><font color="#008000"><i>{Get Attribute Function Code     }
  </i></font><font color="#FF00FF">INT  21h         </font><font color="#008000"><i>{Get File Attributes             }
  </i></font><font color="#FF00FF">MOV  AL,BH       </font><font color="#008000"><i>{Set Default Result to FALSE     }
  </i></font><font color="#FF00FF">CMC              </font><font color="#008000"><i>{Toggle Carry Flag               }
  </i></font><font color="#FF00FF">ADC  AL,AL       </font><font color="#008000"><i>{Change Result to TRUE if Failed }
  </i></font><font color="#FF00FF">POP  DS          </font><font color="#008000"><i>{Restore DS                      }
</i></font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>{EntryExists}

</i></font><font color="#FF0000"><b>FUNCTION </b></font>FileExists<font color="#000080">(</font>FileName <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">) : </font>Boolean<font color="#000080">; </font><font color="#FF0000"><b>ASSEMBLER</b></font><font color="#000080">;
</font><font color="#FF0000"><b>ASM
  </b></font><font color="#FF00FF">PUSH DS          </font><font color="#008000"><i>{Save DS                         }
  </i></font><font color="#FF00FF">LDS  SI,Filename </font><font color="#008000"><i>{DS:SI =&gt; Filename               }
  </i></font><font color="#FF00FF">XOR  BX,BX       </font><font color="#008000"><i>{Clear BX                        }
  </i></font><font color="#FF00FF">MOV  BL,[SI]     </font><font color="#008000"><i>{BX = Length(Filename)           }
  </i></font><font color="#FF00FF">INC  SI          </font><font color="#008000"><i>{DS:SI =&gt; Filename[1]            }
  </i></font><font color="#FF00FF">MOV  DX,SI       </font><font color="#008000"><i>{DS:DX =&gt; Filename[1]            }
  </i></font><font color="#FF00FF">MOV  [SI+BX],BH  </font><font color="#008000"><i>{Append Ascii 0 to Filename      }
  </i></font><font color="#FF00FF">MOV  AX,4300h    </font><font color="#008000"><i>{Get Attribute Function Code     }
  </i></font><font color="#FF00FF">INT  21h         </font><font color="#008000"><i>{Get File Attributes             }
  </i></font><font color="#FF00FF">MOV  AL,BH       </font><font color="#008000"><i>{Default Result = FALSE          }
  </i></font><font color="#FF00FF">ADC  CL,CL       </font><font color="#008000"><i>{Attribute * 2 + Carry Flag      }
  </i></font><font color="#FF00FF">AND  CL,31h      </font><font color="#008000"><i>{Directory or VolumeID or Failed }
  </i></font><font color="#FF00FF">JNZ  @@Done      </font><font color="#008000"><i>{Yes - Exit                      }
  </i></font><font color="#FF00FF">INC  AL          </font><font color="#008000"><i>{No - Change Result to TRUE      }
</i></font><font color="#FF00FF">@@Done:
  POP  DS          </font><font color="#008000"><i>{Restore DS                      }
</i></font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>{FileExists}

</i></font><font color="#FF0000"><b>CONST
  </b></font>Found <font color="#000080">: </font><font color="#FF0000"><b>ARRAY</b></font><font color="#000080">[</font>Boolean<font color="#000080">] </font><font color="#FF0000"><b>OF String</b></font><font color="#000080">[</font><font color="#800000">10</font><font color="#000080">] = (</font><font color="#800000">'Not Found'</font><font color="#000080">, </font><font color="#800000">'Found'</font><font color="#000080">);
</font><font color="#FF0000"><b>VAR
  </b></font>FileName <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;

</font><font color="#FF0000"><b>BEGIN
  </b></font>Write<font color="#000080">(</font><font color="#800000">'Enter file name to search: '</font><font color="#000080">);
  </font>ReadLn<font color="#000080">(</font>FileName<font color="#000080">);
  </font>WriteLn<font color="#000080">(</font><font color="#800000">'File &quot;'</font><font color="#000080">, </font>FileName<font color="#000080">, </font><font color="#800000">'&quot; '</font><font color="#000080">, </font>Found<font color="#000080">[</font>EntryExists<font color="#000080">(</font>FileName<font color="#000080">)], </font><font color="#800000">'.'</font><font color="#000080">);
</font><font color="#FF0000"><b>END</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to FILES SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0077.PAS">Original</a><b>]</b></p></body>
</html>
