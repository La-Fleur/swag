<html>
<head><title> "Secure File Wiping" by JOHN STEPHENSON</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to FILES SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0069.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
Although, I can not gaurentee this is correct, but it WILL stop Undel
from PCTools, Undel from nortons, and undelete from dos. (tested) Although
I don't have the time to play around with a sector editor:
}

{$A+,B-,D+,E+,F-,G-,I-,L+,N-,O-,P-,Q-,R-,S+,T-,V+,X+}
{$M 16384,0,655360}
</i></font><font color="#FF0000"><b>Uses </b></font>crt<font color="#000080">,</font>dos<font color="#000080">;
</font><font color="#FF0000"><b>Const
  </b></font>Product <font color="#000080">= </font><font color="#800000">'WipeFile'</font><font color="#000080">;
  </font>Version <font color="#000080">= </font><font color="#800000">'1.00a'</font><font color="#000080">;
  </font>Release <font color="#000080">= </font><font color="#800000">'Gamma'</font><font color="#000080">;
  </font>Author  <font color="#000080">= </font><font color="#800000">'John Stephenson'</font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>WipeFile<font color="#000080">(</font>fn<font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">);
</font><font color="#FF0000"><b>Var
  </b></font>size<font color="#000080">,
  </font>total<font color="#000080">: </font>longint<font color="#000080">;
  </font>loop<font color="#000080">,</font>towrite<font color="#000080">,</font>numwritten<font color="#000080">: </font>word<font color="#000080">;
  </font>f<font color="#000080">: </font><font color="#FF0000"><b>file</b></font><font color="#000080">;
  </font>buffer<font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">1024</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>assign<font color="#000080">(</font>f<font color="#000080">,</font>fn<font color="#000080">);
  </font>setfattr<font color="#000080">(</font>f<font color="#000080">,</font><font color="#800000">0</font><font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font>doserror <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>then begin
    </b></font><font color="#008000"><i>{ DOS will normally keep the rest of the file name, and just truncate
      it with a null. But when the full filename is renamed then that can't
      be done. Then it renames it to ~ so that undelete will just show
      a question mark, and same with a sector editor on the hd }
    </i></font>rename<font color="#000080">(</font>f<font color="#000080">,</font><font color="#800000">'~~~~~~~~.~~~'</font><font color="#000080">);
    </font>rename<font color="#000080">(</font>f<font color="#000080">,</font><font color="#800000">'~'</font><font color="#000080">);

    </font><font color="#008000"><i>{ Randomize a buffer for later use when we erase the file }
    </i></font><font color="#FF0000"><b>for </b></font>loop <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>sizeof<font color="#000080">(</font>buffer<font color="#000080">) </font><font color="#FF0000"><b>do </b></font>buffer<font color="#000080">[</font>loop<font color="#000080">] := </font>random<font color="#000080">(</font><font color="#800000">256</font><font color="#000080">);

    </font><font color="#008000"><i>{ Then we must completely rewrite the file, starting from byte one
      to the filesize, completely erasing all sector data. Very easily
      done, using a random buffer to write with. }
    </i></font>reset<font color="#000080">(</font>f<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">);
    </font>size <font color="#000080">:= </font>filesize<font color="#000080">(</font>f<font color="#000080">);
    </font>total <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
    </font><font color="#FF0000"><b>repeat
      </b></font><font color="#008000"><i>{ Figure out how much to write }
      </i></font>towrite <font color="#000080">:= </font>sizeof<font color="#000080">(</font>buffer<font color="#000080">);
      </font><font color="#FF0000"><b>if </b></font>towrite<font color="#000080">+</font>total <font color="#000080">&gt; </font>size <font color="#FF0000"><b>then </b></font>towrite <font color="#000080">:= </font>size <font color="#000080">- </font>total<font color="#000080">;

      </font>blockwrite<font color="#000080">(</font>f<font color="#000080">,</font>buffer<font color="#000080">,</font>towrite<font color="#000080">,</font>numwritten<font color="#000080">);
      </font>inc<font color="#000080">(</font>total<font color="#000080">,</font>numwritten<font color="#000080">);
    </font><font color="#FF0000"><b>until </b></font>total <font color="#000080">= </font>size<font color="#000080">;

    </font><font color="#008000"><i>{ Now we seek to the first byte of the file, and truncate it there,
      leaving it a measly 0 bytes }
    </i></font>Seek<font color="#000080">(</font>f<font color="#000080">,</font><font color="#800000">0</font><font color="#000080">);
    </font>Truncate<font color="#000080">(</font>f<font color="#000080">);

    </font><font color="#008000"><i>{ Now we will close up the file, and delete it }
    </i></font>close<font color="#000080">(</font>f<font color="#000080">);
    </font>erase<font color="#000080">(</font>f<font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>var
  </b></font>loop<font color="#000080">: </font>byte<font color="#000080">;
  </font>fn<font color="#000080">: </font>pathstr<font color="#000080">;
</font><font color="#FF0000"><b>begin
  if </b></font>paramcount <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>then begin
    </b></font>textattr <font color="#000080">:= </font>lightcyan<font color="#000080">;
    </font>writeln<font color="#000080">(</font>product<font color="#000080">+</font><font color="#800000">' v'</font><font color="#000080">+</font>version<font color="#000080">+</font><font color="#800000">' '</font><font color="#000080">+</font>release<font color="#000080">+</font><font color="#800000">' by '</font><font color="#000080">+</font>author<font color="#000080">+</font><font color="#800000">#10</font><font color="#000080">);
    </font>textattr <font color="#000080">:= </font>lightgray<font color="#000080">;
    </font>writeln<font color="#000080">(</font><font color="#800000">'Completely erases file contents, and filename from FAT and'</font><font color="#000080">);
    </font>writeln<font color="#000080">(</font><font color="#800000">'from the actual disk. Very throughly done!'#10</font><font color="#000080">);
    </font>writeln<font color="#000080">(</font><font color="#800000">'Summary of action: &thorn; Un-attributes file.'</font><font color="#000080">);
    </font>writeln<font color="#000080">(</font><font color="#800000">'                   &thorn; Renames FAT file name.'</font><font color="#000080">);
    </font>writeln<font color="#000080">(</font><font color="#800000">'                   &thorn; Rewrites file contents with a random buffer'</font><font color="#000080">);
    </font>writeln<font color="#000080">(</font><font color="#800000">'                   &thorn; Truncates file to 0 bytes.'</font><font color="#000080">);
    </font>writeln<font color="#000080">(</font><font color="#800000">'                   &thorn; Erases file.'</font><font color="#000080">);
    </font>halt<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>randomize<font color="#000080">;
  </font><font color="#FF0000"><b>for </b></font>loop <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>paramcount <font color="#FF0000"><b>do begin
    </b></font>Fn <font color="#000080">:= </font>paramstr<font color="#000080">(</font>loop<font color="#000080">);
    </font>write<font color="#000080">(</font><font color="#800000">'Wiping: '</font><font color="#000080">,</font>fn<font color="#000080">,</font><font color="#800000">'...'</font><font color="#000080">);
    </font>wipefile<font color="#000080">(</font>fn<font color="#000080">);
    </font>writeln<font color="#000080">(</font><font color="#800000">' Done!'</font><font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to FILES SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0069.PAS">Original</a><b>]</b></p></body>
</html>
