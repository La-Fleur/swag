<html>
<head><title> "Appending Data onto the EXE" by STEVE ROGERS</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to FILES SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0058.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
&gt;I am trying to write a program that will extract a linked list from data
&gt;appended to the executable with the MS-Dos COPY /B command.  Is such a thing
&gt;possible?  I have been unable to do it with standard text file procedures.

You can't extract a linked list but you can retreive data and then
put it into a linked list. The linked list is a memory data
structure whereas the data on disk is just collections of data. You
could probably do what you want with streams, though.

Here's a unit I wrote for using appended data which may help:
}

</i></font><font color="#FF0000"><b>unit </b></font>appnddat<font color="#000080">;

</font><font color="#008000"><i>(*
  APPNDDAT - Copyright (c) Steve Rogers, 1994

  Allows user to store configuration data at the end of an EXE file.
  The putConfig procedure stores a record at the end of the EXE file.
  If data is already present in the EXE, it will be overwritten.
  GetConfig will retreive data that has been appended to the EXE.

  NOTE: The pCfgRec parameter passed to both putConfig &amp; getConfig is
        a raw pointer, RecSize is the size of the config record.

        Also, since this unit gets its data from the data following
        the executeable code, it won't work if you compile your EXE
        in the $d+ state (include debug information).
*)

(* We'll do our own i/o checking, thanks. *)
{$i-}

</i></font><font color="#FF0000"><b>interface

function </b></font>EXESize<font color="#000080">(</font>fname <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">) : </font>longint<font color="#000080">;
</font><font color="#FF0000"><b>function </b></font>DataAppended<font color="#000080">(</font>fname <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">) : </font>boolean<font color="#000080">;
</font><font color="#FF0000"><b>procedure </b></font>putConfig<font color="#000080">(</font>fname <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;</font>pCfgRec <font color="#000080">: </font>pointer<font color="#000080">;</font>RecSize <font color="#000080">: </font>word<font color="#000080">);
</font><font color="#FF0000"><b>procedure </b></font>getConfig<font color="#000080">(</font>fname <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;</font>pCfgRec <font color="#000080">: </font>pointer<font color="#000080">;</font>RecSize <font color="#000080">: </font>word<font color="#000080">);

</font><font color="#FF0000"><b>implementation
uses
  </b></font>dos<font color="#000080">;

</font><font color="#008000"><i>{----------------------}
</i></font><font color="#FF0000"><b>function </b></font>EXESize<font color="#000080">(</font>fname <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">) : </font>longint<font color="#000080">;
</font><font color="#008000"><i>{ Returns size of executable code in EXE file }

</i></font><font color="#FF0000"><b>type
  </b></font>tSizeRec<font color="#000080">=</font><font color="#FF0000"><b>record    </b></font><font color="#008000"><i>{ first 6 bytes of EXE header }
    </i></font>mz<font color="#000080">,
    </font>remainder<font color="#000080">,
    </font>pages <font color="#000080">: </font>word<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>var
  </b></font>f <font color="#000080">: </font><font color="#FF0000"><b>file of </b></font>tSizeRec<font color="#000080">;
  </font>sz <font color="#000080">: </font>tSizeRec<font color="#000080">;

</font><font color="#FF0000"><b>begin
  </b></font>assign<font color="#000080">(</font>f<font color="#000080">,</font>fname<font color="#000080">);
  </font>reset<font color="#000080">(</font>f<font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>ioresult<font color="#000080">&lt;&gt;</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>then </b></font>EXESize<font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>else begin
    </b></font>read<font color="#000080">(</font>f<font color="#000080">,</font>sz<font color="#000080">);
    </font>close<font color="#000080">(</font>f<font color="#000080">);
    </font><font color="#FF0000"><b>with </b></font>sz <font color="#FF0000"><b>do </b></font>EXESize<font color="#000080">:= </font>remainder<font color="#000080">+(</font>longint<font color="#000080">(</font>pred<font color="#000080">(</font>pages<font color="#000080">))*</font><font color="#800000">512</font><font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{----------------------}
</i></font><font color="#FF0000"><b>function </b></font>DataAppended<font color="#000080">(</font>fname <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">) : </font>boolean<font color="#000080">;
</font><font color="#FF0000"><b>var
  </b></font>f <font color="#000080">: </font><font color="#FF0000"><b>file</b></font><font color="#000080">;
  </font>sz <font color="#000080">: </font>longint<font color="#000080">;

</font><font color="#FF0000"><b>begin
  </b></font>assign<font color="#000080">(</font>f<font color="#000080">,</font>fname<font color="#000080">);
  </font>reset<font color="#000080">(</font>f<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>ioresult<font color="#000080">&lt;&gt;</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>then </b></font>DataAppended<font color="#000080">:= </font>false <font color="#FF0000"><b>else begin
    </b></font>sz<font color="#000080">:= </font>filesize<font color="#000080">(</font>f<font color="#000080">);
    </font>close<font color="#000080">(</font>f<font color="#000080">);
    </font>DataAppended<font color="#000080">:= (</font>sz<font color="#000080">&gt;</font>EXESize<font color="#000080">(</font>fname<font color="#000080">));
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{-----------------------}
</i></font><font color="#FF0000"><b>procedure </b></font>putConfig<font color="#000080">(</font>fname <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;</font>pCfgRec <font color="#000080">: </font>pointer<font color="#000080">;</font>RecSize <font color="#000080">: </font>word<font color="#000080">);
</font><font color="#FF0000"><b>var
  </b></font>f <font color="#000080">: </font><font color="#FF0000"><b>file</b></font><font color="#000080">;
  </font>DataOffset <font color="#000080">: </font>longint<font color="#000080">;

</font><font color="#FF0000"><b>begin
  </b></font>DataOffset<font color="#000080">:= </font>EXESize<font color="#000080">(</font>fname<font color="#000080">);

  </font>assign<font color="#000080">(</font>f<font color="#000080">,</font>fname<font color="#000080">);
  </font>reset<font color="#000080">(</font>f<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">);
  </font>seek<font color="#000080">(</font>f<font color="#000080">,</font>DataOffset<font color="#000080">);
  </font>blockwrite<font color="#000080">(</font>f<font color="#000080">,</font>pCfgRec<font color="#000080">^,</font>RecSize<font color="#000080">);
  </font>close<font color="#000080">(</font>f<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{-----------------------}
</i></font><font color="#FF0000"><b>procedure </b></font>getConfig<font color="#000080">(</font>fname <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;</font>pCfgRec <font color="#000080">: </font>pointer<font color="#000080">;</font>RecSize <font color="#000080">: </font>word<font color="#000080">);
</font><font color="#FF0000"><b>var
  </b></font>f <font color="#000080">: </font><font color="#FF0000"><b>file</b></font><font color="#000080">;
  </font>DataOffset <font color="#000080">: </font>longint<font color="#000080">;

</font><font color="#FF0000"><b>begin
  if </b></font><font color="#000080">(</font>DataAppended<font color="#000080">(</font>fname<font color="#000080">)) </font><font color="#FF0000"><b>then begin
    </b></font>DataOffset<font color="#000080">:= </font>EXESize<font color="#000080">(</font>fname<font color="#000080">);
    </font>assign<font color="#000080">(</font>f<font color="#000080">,</font>fname<font color="#000080">);
    </font>reset<font color="#000080">(</font>f<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">);
    </font>seek<font color="#000080">(</font>f<font color="#000080">,</font>DataOffset<font color="#000080">);
    </font>blockread<font color="#000080">(</font>f<font color="#000080">,</font>pCfgRec<font color="#000080">^,</font>RecSize<font color="#000080">);
    </font>close<font color="#000080">(</font>f<font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{----------------------}
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to FILES SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0058.PAS">Original</a><b>]</b></p></body>
</html>
