<html>
<head><title> "Managing the .INI type datafile" by ANTON ZHUCHKOV</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to FILES SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0104.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{.$DEFINE SECURE}

</i></font><font color="#FF0000"><b>unit </b></font>DataFile<font color="#000080">; </font><font color="#008000"><i>{- managing the .ini - type datafile}

</i></font><font color="#FF0000"><b>interface

type
  </b></font>DataStr <font color="#000080">= </font><font color="#FF0000"><b>String</b></font><font color="#000080">[</font><font color="#800000">80</font><font color="#000080">];

  </font>PDataFile <font color="#000080">= ^</font>TDataFile<font color="#000080">;
  </font>TDataFile <font color="#000080">= </font><font color="#FF0000"><b>object
    </b></font>F<font color="#000080">, </font>FTmp  <font color="#000080">: </font>Text<font color="#000080">;
    </font>FileName <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
    </font>EndTopic <font color="#000080">: </font>Boolean<font color="#000080">;
    </font>CurTopic <font color="#000080">: </font>DataStr<font color="#000080">;
    </font><font color="#FF0000"><b>constructor </b></font>Init<font color="#000080">(</font>FN <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">);
    </font><font color="#FF0000"><b>destructor  </b></font>Done<font color="#000080">;
    </font><font color="#FF0000"><b>procedure   </b></font>WriteMode<font color="#000080">(</font>Topic<font color="#000080">: </font>DataStr<font color="#000080">);
    </font><font color="#FF0000"><b>procedure   </b></font>Flush<font color="#000080">;
    </font><font color="#FF0000"><b>procedure   </b></font>ReadMode<font color="#000080">(</font>Topic<font color="#000080">: </font>DataStr<font color="#000080">);
    </font><font color="#FF0000"><b>procedure   </b></font>Write<font color="#000080">(</font>S<font color="#000080">: </font>DataStr<font color="#000080">);
    </font><font color="#FF0000"><b>function    </b></font>Read<font color="#000080">: </font>DataStr<font color="#000080">;
    </font><font color="#FF0000"><b>procedure   </b></font>Delete<font color="#000080">(</font>Topic<font color="#000080">: </font>DataStr<font color="#000080">);
    </font><font color="#FF0000"><b>function    </b></font>IsTopicExist<font color="#000080">(</font>Topic<font color="#000080">: </font>DataStr<font color="#000080">): </font>Boolean<font color="#000080">;
    </font><font color="#FF0000"><b>function    </b></font>GenerateNewTopic<font color="#000080">: </font>DataStr<font color="#000080">;
    </font><font color="#FF0000"><b>function    </b></font>CountTopics <font color="#000080">: </font>LongInt<font color="#000080">;
  </font><font color="#FF0000"><b>private
    </b></font>ReserveStr <font color="#000080">: </font>DataStr<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>CodeFile<font color="#000080">(</font>FN<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">);

</font><font color="#FF0000"><b>const
  </b></font>GenTopicSize<font color="#000080">: </font>Byte <font color="#000080">= </font><font color="#800000">7</font><font color="#000080">;
  </font>TopicChar <font color="#000080">= </font><font color="#800000">'&thorn;'</font><font color="#000080">;

</font><font color="#FF0000"><b>implementation
uses </b></font>Dos<font color="#000080">;

</font><font color="#008000"><i>{$I-}

</i></font><font color="#FF0000"><b>const
  </b></font>CodeStr <font color="#000080">: </font>DataStr <font color="#000080">=
  </font><font color="#800000">'(c) 1996 Tigers of SoftLand. Coded by Anton Zhuchkov. All rights not reserved. AZ'</font><font color="#000080">;

</font><font color="#FF0000"><b>var
  </b></font>PC <font color="#000080">: </font>Integer<font color="#000080">;
</font><font color="#FF0000"><b>function </b></font>Code<font color="#000080">(</font>S<font color="#000080">: </font>DataStr<font color="#000080">): </font>DataStr<font color="#000080">;
</font><font color="#FF0000"><b>var
  </b></font>I <font color="#000080">: </font>Integer<font color="#000080">;
  </font>St <font color="#000080">: </font>DataStr<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>St <font color="#000080">:= </font>S<font color="#000080">;
  </font>PC <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;
  </font><font color="#FF0000"><b>for </b></font>I <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>Length<font color="#000080">(</font>S<font color="#000080">) </font><font color="#FF0000"><b>do
  begin
    </b></font>Byte<font color="#000080">(</font>St<font color="#000080">[</font>I<font color="#000080">]) := </font>Byte<font color="#000080">(</font>St<font color="#000080">[</font>I<font color="#000080">]) </font><font color="#FF0000"><b>xor </b></font>Byte<font color="#000080">(</font>CodeStr<font color="#000080">[</font>PC<font color="#000080">]);
    </font>inc<font color="#000080">(</font>PC<font color="#000080">);
    </font><font color="#FF0000"><b>if </b></font>PC <font color="#000080">&gt; </font>Length<font color="#000080">(</font>CodeStr<font color="#000080">) </font><font color="#FF0000"><b>then </b></font>PC <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>Code <font color="#000080">:= </font>St<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>CodeFile<font color="#000080">(</font>FN<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">);
</font><font color="#FF0000"><b>var
  </b></font>F<font color="#000080">, </font>FTo<font color="#000080">: </font>Text<font color="#000080">;
  </font>St    <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>Assign<font color="#000080">(</font>F<font color="#000080">, </font>FN<font color="#000080">);
  </font>Reset<font color="#000080">(</font>F<font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font>IOResult <font color="#000080">&lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then
  begin
    </b></font>Writeln<font color="#000080">(</font><font color="#800000">'&thorn; CodeFile &thorn; File not found: '</font><font color="#000080">, </font>FN<font color="#000080">);
    </font>Halt<font color="#000080">(</font><font color="#800000">10</font><font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>Assign<font color="#000080">(</font>FTo<font color="#000080">, </font><font color="#800000">'$CODE$.$$$'</font><font color="#000080">);
  </font>Rewrite<font color="#000080">(</font>FTo<font color="#000080">);
  </font><font color="#FF0000"><b>while not </b></font>EOF<font color="#000080">(</font>F<font color="#000080">) </font><font color="#FF0000"><b>do
  begin
    </b></font>Readln<font color="#000080">(</font>F<font color="#000080">, </font>St<font color="#000080">);
    </font><font color="#FF0000"><b>if </b></font>St<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">] &lt;&gt; </font>TopicChar <font color="#FF0000"><b>then </b></font>Writeln<font color="#000080">(</font>FTo<font color="#000080">, </font>Code<font color="#000080">(</font>St<font color="#000080">)) </font><font color="#FF0000"><b>else </b></font>Writeln<font color="#000080">(</font>FTo<font color="#000080">, </font>St<font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>Close<font color="#000080">(</font>F<font color="#000080">);
  </font>Close<font color="#000080">(</font>FTo<font color="#000080">);
  </font>Erase<font color="#000080">(</font>F<font color="#000080">);
  </font>Rename<font color="#000080">(</font>FTo<font color="#000080">, </font>FN<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>function </b></font>ReplaceExt<font color="#000080">(</font>FN<font color="#000080">, </font>NewExt<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">): </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
</font><font color="#FF0000"><b>var
  </b></font>D<font color="#000080">, </font>N<font color="#000080">, </font>E<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>FSplit<font color="#000080">(</font>FN<font color="#000080">, </font>D<font color="#000080">, </font>N<font color="#000080">, </font>E<font color="#000080">);
  </font>ReplaceExt <font color="#000080">:= </font>D <font color="#000080">+ </font>N <font color="#000080">+ </font>NewExt<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>TrimStr<font color="#000080">(</font>S<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">): </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
</font><font color="#FF0000"><b>var
  </b></font>STmp<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
  </font>I   <font color="#000080">: </font>Integer<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>STmp <font color="#000080">:= </font>S<font color="#000080">;
  </font><font color="#FF0000"><b>while </b></font>STmp<font color="#000080">[</font>Byte<font color="#000080">(</font>STmp<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">])] = </font><font color="#800000">' ' </font><font color="#FF0000"><b>do
     </b></font>Dec<font color="#000080">(</font>Byte<font color="#000080">(</font>STmp<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">]));
  </font>TrimStr <font color="#000080">:= </font>STmp<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;



</font><font color="#FF0000"><b>constructor </b></font>TDataFile<font color="#000080">.</font>Init<font color="#000080">(</font>FN <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">);
</font><font color="#FF0000"><b>begin
  </b></font>FileName <font color="#000080">:= </font>FN<font color="#000080">;
  </font>Assign<font color="#000080">(</font>F<font color="#000080">, </font>FileName<font color="#000080">);
  </font>Reset<font color="#000080">(</font>F<font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font>IOResult <font color="#000080">&lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then
    </b></font>Rewrite<font color="#000080">(</font>F<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>destructor </b></font>TDataFile<font color="#000080">.</font>Done<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>Close<font color="#000080">(</font>F<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>procedure </b></font>TDataFile<font color="#000080">.</font>WriteMode<font color="#000080">(</font>Topic<font color="#000080">: </font>DataStr<font color="#000080">);
</font><font color="#FF0000"><b>var
  </b></font>St<font color="#000080">: </font>DataStr<font color="#000080">;
  </font>Search <font color="#000080">: </font>DataStr<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>Assign<font color="#000080">(</font>FTmp<font color="#000080">,</font>ReplaceExt<font color="#000080">(</font>FileName<font color="#000080">, </font><font color="#800000">'.$$$'</font><font color="#000080">));
  </font>Rewrite<font color="#000080">(</font>FTmp<font color="#000080">);
  </font>Search <font color="#000080">:= </font>TopicChar<font color="#000080">+</font>TrimStr<font color="#000080">(</font>Topic<font color="#000080">);
  </font><font color="#FF0000"><b>if not </b></font>EOF<font color="#000080">(</font>F<font color="#000080">) </font><font color="#FF0000"><b>then
    repeat
      </b></font>Readln<font color="#000080">(</font>F<font color="#000080">, </font>St<font color="#000080">);
      </font>Writeln<font color="#000080">(</font>FTmp<font color="#000080">, </font>St<font color="#000080">);
    </font><font color="#FF0000"><b>until </b></font><font color="#000080">(</font>St <font color="#000080">= </font>Search<font color="#000080">) </font><font color="#FF0000"><b>or </b></font>EOF<font color="#000080">(</font>F<font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font>EOF<font color="#000080">(</font>F<font color="#000080">) </font><font color="#FF0000"><b>then </b></font>Writeln<font color="#000080">(</font>FTmp<font color="#000080">, </font>Search<font color="#000080">);
  </font>CurTopic <font color="#000080">:= </font>Topic<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>TDataFile<font color="#000080">.</font>Flush<font color="#000080">;
</font><font color="#FF0000"><b>var
  </b></font>St<font color="#000080">: </font>DataStr<font color="#000080">;
</font><font color="#FF0000"><b>begin
  if not </b></font>EOF<font color="#000080">(</font>F<font color="#000080">) </font><font color="#FF0000"><b>then
  begin
    repeat
      </b></font>Readln<font color="#000080">(</font>F<font color="#000080">, </font>St<font color="#000080">);
    </font><font color="#FF0000"><b>until </b></font>EOF<font color="#000080">(</font>F<font color="#000080">) </font><font color="#FF0000"><b>or </b></font><font color="#000080">(</font>St<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">] = </font>TopicChar<font color="#000080">);
    </font><font color="#FF0000"><b>if not </b></font>EOF<font color="#000080">(</font>F<font color="#000080">) </font><font color="#FF0000"><b>then
    begin
      </b></font>Writeln<font color="#000080">(</font>FTmp<font color="#000080">, </font>St<font color="#000080">);
      </font><font color="#FF0000"><b>repeat
        </b></font>Readln<font color="#000080">(</font>F<font color="#000080">, </font>St<font color="#000080">);
        </font>Writeln<font color="#000080">(</font>FTmp<font color="#000080">, </font>St<font color="#000080">);
      </font><font color="#FF0000"><b>until </b></font>EOF<font color="#000080">(</font>F<font color="#000080">);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>Close<font color="#000080">(</font>F<font color="#000080">);
  </font>Close<font color="#000080">(</font>FTmp<font color="#000080">);
  </font>Erase<font color="#000080">(</font>F<font color="#000080">);
  </font>Rename<font color="#000080">(</font>FTmp<font color="#000080">, </font>FileName<font color="#000080">);
  </font>Reset<font color="#000080">(</font>F<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>TDataFile<font color="#000080">.</font>ReadMode<font color="#000080">(</font>Topic<font color="#000080">: </font>DataStr<font color="#000080">);
</font><font color="#FF0000"><b>var
  </b></font>St<font color="#000080">: </font>DataStr<font color="#000080">;
  </font>Search <font color="#000080">: </font>DataStr<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>Close<font color="#000080">(</font>F<font color="#000080">);
  </font>Reset<font color="#000080">(</font>F<font color="#000080">);
  </font>Search <font color="#000080">:= </font>TopicChar<font color="#000080">+</font>TrimStr<font color="#000080">(</font>Topic<font color="#000080">);
  </font><font color="#FF0000"><b>repeat
    </b></font>Readln<font color="#000080">(</font>F<font color="#000080">, </font>St<font color="#000080">);
  </font><font color="#FF0000"><b>until </b></font><font color="#000080">(</font>St <font color="#000080">= </font>Search<font color="#000080">) </font><font color="#FF0000"><b>or </b></font>EOF<font color="#000080">(</font>F<font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font>EOF<font color="#000080">(</font>F<font color="#000080">) </font><font color="#FF0000"><b>then
  begin
    </b></font>Writeln<font color="#000080">(</font><font color="#800000">'&thorn; TDataFile.Readmode &thorn;  Topic not found: '</font><font color="#000080">,</font>Topic<font color="#000080">);
    </font>Halt<font color="#000080">(</font><font color="#800000">10</font><font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>Readln<font color="#000080">(</font>F<font color="#000080">, </font>ReserveStr<font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font>EOF<font color="#000080">(</font>F<font color="#000080">) </font><font color="#FF0000"><b>or </b></font><font color="#000080">(</font>ReserveStr<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">] = </font>TopicChar<font color="#000080">) </font><font color="#FF0000"><b>then
    </b></font>EndTopic <font color="#000080">:= </font>True <font color="#FF0000"><b>else </b></font>EndTopic <font color="#000080">:= </font>False<font color="#000080">;
  </font>CurTopic <font color="#000080">:= </font>Topic<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>TDataFile<font color="#000080">.</font>Write<font color="#000080">(</font>S<font color="#000080">: </font>DataStr<font color="#000080">);
</font><font color="#FF0000"><b>begin
</b></font><font color="#008000"><i>{$IFDEF SECURE}
  </i></font>Writeln<font color="#000080">(</font>FTmp<font color="#000080">, </font>Code<font color="#000080">(</font>S<font color="#000080">));
</font><font color="#008000"><i>{$ELSE}
  </i></font>Writeln<font color="#000080">(</font>FTmp<font color="#000080">, </font>S<font color="#000080">);
</font><font color="#008000"><i>{$ENDIF}
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>TDataFile<font color="#000080">.</font>Read<font color="#000080">: </font>DataStr<font color="#000080">;
</font><font color="#FF0000"><b>begin
  if </b></font>EndTopic <font color="#FF0000"><b>then
  begin
    </b></font>Writeln<font color="#000080">(</font><font color="#800000">'&thorn; TDataFile.Read &thorn; Topic data overflow: '</font><font color="#000080">, </font>CurTopic<font color="#000080">);
    </font>Halt<font color="#000080">(</font><font color="#800000">10</font><font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{$IFDEF SECURE}
  </i></font>Read <font color="#000080">:= </font>Code<font color="#000080">(</font>ReserveStr<font color="#000080">);
</font><font color="#008000"><i>{$ELSE}
  </i></font>Read <font color="#000080">:= </font>ReserveStr<font color="#000080">;
</font><font color="#008000"><i>{$ENDIF}
  </i></font><font color="#FF0000"><b>if not </b></font>EOF<font color="#000080">(</font>F<font color="#000080">) </font><font color="#FF0000"><b>then
  begin
    </b></font>Readln<font color="#000080">(</font>F<font color="#000080">, </font>ReserveStr<font color="#000080">);
    </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>ReserveStr<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">] = </font>TopicChar<font color="#000080">) </font><font color="#FF0000"><b>then
      </b></font>EndTopic <font color="#000080">:= </font>True <font color="#FF0000"><b>else </b></font>EndTopic <font color="#000080">:= </font>False<font color="#000080">;
  </font><font color="#FF0000"><b>end else </b></font>EndTopic <font color="#000080">:= </font>True<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>TDataFile<font color="#000080">.</font>Delete<font color="#000080">(</font>Topic<font color="#000080">: </font>DataStr<font color="#000080">);
</font><font color="#FF0000"><b>var
  </b></font>Search<font color="#000080">,
  </font>Current <font color="#000080">: </font>DataStr<font color="#000080">;
  </font>LastOne <font color="#000080">: </font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>Assign<font color="#000080">(</font>FTmp<font color="#000080">,</font>ReplaceExt<font color="#000080">(</font>FileName<font color="#000080">, </font><font color="#800000">'.$$$'</font><font color="#000080">));
  </font>Rewrite<font color="#000080">(</font>FTmp<font color="#000080">);
  </font>Search <font color="#000080">:= </font>TopicChar<font color="#000080">+</font>TrimStr<font color="#000080">(</font>Topic<font color="#000080">);
  </font>Close<font color="#000080">(</font>F<font color="#000080">);
  </font>Reset<font color="#000080">(</font>F<font color="#000080">);
  </font>Readln<font color="#000080">(</font>F<font color="#000080">, </font>Current<font color="#000080">);
  </font>LastOne <font color="#000080">:= </font>False<font color="#000080">;
  </font><font color="#FF0000"><b>while </b></font><font color="#000080">(</font>Current <font color="#000080">&lt;&gt; </font>Search<font color="#000080">) </font><font color="#FF0000"><b>and not </b></font>LastOne <font color="#FF0000"><b>do
  begin
    </b></font>Writeln<font color="#000080">(</font>FTmp<font color="#000080">, </font>Current<font color="#000080">);
    </font><font color="#FF0000"><b>if </b></font>EOF<font color="#000080">(</font>F<font color="#000080">) </font><font color="#FF0000"><b>then </b></font>LastOne <font color="#000080">:= </font>True<font color="#000080">;
    </font><font color="#FF0000"><b>if not </b></font>LastOne <font color="#FF0000"><b>then </b></font>Readln<font color="#000080">(</font>F<font color="#000080">, </font>Current<font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>if </b></font>LastOne <font color="#FF0000"><b>then
  begin
    </b></font>Writeln<font color="#000080">(</font><font color="#800000">'&thorn; TDataFile.Delete &thorn; Topic not found: '</font><font color="#000080">,</font>Topic<font color="#000080">);
    </font>Halt<font color="#000080">(</font><font color="#800000">100</font><font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font>Readln<font color="#000080">(</font>F<font color="#000080">, </font>Current<font color="#000080">);
  </font><font color="#FF0000"><b>while </b></font><font color="#000080">(</font>Current<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">] &lt;&gt; </font>TopicChar<font color="#000080">) </font><font color="#FF0000"><b>and not </b></font>EOF<font color="#000080">(</font>F<font color="#000080">) </font><font color="#FF0000"><b>do
    </b></font>Readln<font color="#000080">(</font>F<font color="#000080">, </font>Current<font color="#000080">);

  </font><font color="#FF0000"><b>if not </b></font>EOF<font color="#000080">(</font>F<font color="#000080">) </font><font color="#FF0000"><b>then
  begin
    </b></font>Writeln<font color="#000080">(</font>FTmp<font color="#000080">, </font>Current<font color="#000080">);
    </font><font color="#FF0000"><b>while not </b></font>EOF<font color="#000080">(</font>F<font color="#000080">) </font><font color="#FF0000"><b>do
    begin
      </b></font>Readln<font color="#000080">(</font>F<font color="#000080">, </font>Current<font color="#000080">);
      </font>Writeln<font color="#000080">(</font>FTmp<font color="#000080">, </font>Current<font color="#000080">);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font>Close<font color="#000080">(</font>F<font color="#000080">);
  </font>Close<font color="#000080">(</font>FTmp<font color="#000080">);
  </font>Erase<font color="#000080">(</font>F<font color="#000080">);
  </font>Rename<font color="#000080">(</font>FTmp<font color="#000080">, </font>FileName<font color="#000080">);
  </font>Reset<font color="#000080">(</font>F<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>TDataFile<font color="#000080">.</font>IsTopicExist<font color="#000080">(</font>Topic<font color="#000080">: </font>DataStr<font color="#000080">): </font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>var
  </b></font>Found <font color="#000080">: </font>Boolean<font color="#000080">;
  </font>S1    <font color="#000080">: </font>DataStr<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>Reset<font color="#000080">(</font>F<font color="#000080">);
  </font>Found <font color="#000080">:= </font>False<font color="#000080">;
  </font><font color="#FF0000"><b>while not </b></font>EOF<font color="#000080">(</font>F<font color="#000080">) </font><font color="#FF0000"><b>and not </b></font>Found <font color="#FF0000"><b>do
  begin
    </b></font>Readln<font color="#000080">(</font>F<font color="#000080">, </font>S1<font color="#000080">);
    </font><font color="#FF0000"><b>if </b></font>S1<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">] = </font>TopicChar <font color="#FF0000"><b>then
    begin
      </b></font>System<font color="#000080">.</font>Delete<font color="#000080">(</font>S1<font color="#000080">, </font><font color="#800000">1</font><font color="#000080">, </font><font color="#800000">1</font><font color="#000080">);
      </font><font color="#FF0000"><b>if </b></font>S1 <font color="#000080">= </font>Topic <font color="#FF0000"><b>then </b></font>Found <font color="#000080">:= </font>True<font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>IsTopicExist <font color="#000080">:= </font>Found<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>TDataFile<font color="#000080">.</font>GenerateNewTopic<font color="#000080">: </font>DataStr<font color="#000080">;
</font><font color="#FF0000"><b>var
  </b></font>S<font color="#000080">: </font>DataStr<font color="#000080">;
  </font>I<font color="#000080">: </font>Byte<font color="#000080">;
  </font>Valid <font color="#000080">: </font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>S<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">] := </font>Char<font color="#000080">(</font>GenTopicSize<font color="#000080">);
  </font><font color="#FF0000"><b>repeat
    for </b></font>I <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>GenTopicSize <font color="#FF0000"><b>do
      </b></font>S<font color="#000080">[</font>I<font color="#000080">] := </font>Char<font color="#000080">(</font>Random<font color="#000080">(</font><font color="#800000">25</font><font color="#000080">) + </font><font color="#800000">65</font><font color="#000080">);
    </font><font color="#FF0000"><b>if </b></font>IsTopicExist<font color="#000080">(</font>S<font color="#000080">) </font><font color="#FF0000"><b>then </b></font>Valid <font color="#000080">:= </font>False <font color="#FF0000"><b>else </b></font>Valid <font color="#000080">:= </font>False<font color="#000080">;
  </font><font color="#FF0000"><b>until </b></font>Valid<font color="#000080">;
  </font>GenerateNewTopic <font color="#000080">:= </font>S<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>TDataFile<font color="#000080">.</font>CountTopics <font color="#000080">: </font>LongInt<font color="#000080">;
</font><font color="#FF0000"><b>var
  </b></font>I <font color="#000080">: </font>LongInt<font color="#000080">;
  </font>S <font color="#000080">: </font>DataStr<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>Reset<font color="#000080">(</font>F<font color="#000080">);
  </font>I <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font><font color="#FF0000"><b>while not </b></font>EOF<font color="#000080">(</font>F<font color="#000080">) </font><font color="#FF0000"><b>do
  begin
    </b></font>Readln<font color="#000080">(</font>F<font color="#000080">, </font>S<font color="#000080">);
    </font><font color="#FF0000"><b>if </b></font>S<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">] = </font>TopicChar <font color="#FF0000"><b>then </b></font>Inc<font color="#000080">(</font>I<font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>CountTopics <font color="#000080">:= </font>I<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>end</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to FILES SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0104.PAS">Original</a><b>]</b></p></body>
</html>
