<html>
<head><title> "Opening Locked/Protected files" by PHIL NICKELL</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to FILES SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0087.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>(*
MH&sup3;Anyone have any suggestions on protecting source code against this sort
  &sup3;of piracy? I have tried using a CRC calculation on the .EXE but run
  &sup3;into &quot;FILE ACCESS DENIED&quot; if the game is running on a network (the
  &sup3;program is meant for networks...)
MH&sup3;Any suggestions would be appreciated.

 You are probably opening the .exe file with RESET command using the
 default file open mode of read/write which tries to open it with
 read/write access privileges.  Normal access to network programs is
 probably set to read-only access.  Below is how I open a binary file in
 read-only mode in Turbo Pascal v6.  The filemode variable is located in
 the TP system unit. 0=read/only 1=write/only 2=read/write 64=shared-r/o
 65=shared-w/o 66=shared-r/w.  In your case there may be no need to test
 the file attribute first, as the r/o attribute may not be set. But you
 could attempt to always open it with file mode 2 and then try mode 0 or
 64 if mode 2 wasn't successful. Remember to set the file mode back to
 'normal' before opening normal r/w files.
 *)

 </i></font><font color="#FF0000"><b>Function  </b></font>OpenF<font color="#000080">(</font>name<font color="#000080">:</font>pathstr<font color="#000080">):</font>boolean<font color="#000080">;
     </font><font color="#FF0000"><b>var
       </b></font>readonly <font color="#000080">: </font>boolean<font color="#000080">;
       </font>goodfile <font color="#000080">: </font>boolean<font color="#000080">;
       </font>attrword  <font color="#000080">: </font>word<font color="#000080">;
   </font><font color="#FF0000"><b>begin
     </b></font>Assign<font color="#000080">(</font>f<font color="#000080">,</font>name<font color="#000080">);  </font><font color="#008000"><i>{ f is global untyped file ie.  var f:file; }
     </i></font>GetFAttr<font color="#000080">(</font>f<font color="#000080">,</font>attrword<font color="#000080">);
     </font>readonly <font color="#000080">:= </font>odd<font color="#000080">(</font>attrword<font color="#000080">);  </font><font color="#008000"><i>{ if file read-only attribute is set }
     </i></font><font color="#FF0000"><b>if </b></font>readonly <font color="#FF0000"><b>then
       </b></font>filemode <font color="#000080">:= </font><font color="#800000">0   </font><font color="#008000"><i>{ allows open of untyped file r/o }
      </i></font><font color="#FF0000"><b>else
       </b></font>filemode <font color="#000080">:= </font><font color="#800000">2</font><font color="#000080">;  </font><font color="#008000"><i>{ normal readwrite untyped file }
     {$I-}
     </i></font>Reset<font color="#000080">(</font>f<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">);   </font><font color="#008000"><i>{ recordsize = 1 byte }
     {$I+}
     </i></font>goodfile <font color="#000080">:= (</font>ioresult <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">);
     </font><font color="#FF0000"><b>if </b></font>goodfile <font color="#FF0000"><b>then </b></font>goodfile <font color="#000080">:= (</font><font color="#FF0000"><b>not </b></font>eof<font color="#000080">(</font>f<font color="#000080">));  </font><font color="#008000"><i>{protect against
                                                  0 byte files}
     </i></font>OpenF <font color="#000080">:= </font>goodfile<font color="#000080">;
   </font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{openf}
</i></font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to FILES SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0087.PAS">Original</a><b>]</b></p></body>
</html>
