<html>
<head><title> "Totally Erased files" by DAVID DRZYZGA</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to FILES SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0067.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code>
<font color="#FF0000"><b>Program </b></font>Zap<font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>ZapIt<font color="#000080">(</font>FileName <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">; </font>Pattern <font color="#000080">: </font>Char<font color="#000080">; </font>LastPass <font color="#000080">: </font>Boolean<font color="#000080">);
</font><font color="#FF0000"><b>Var
  </b></font>NumRead<font color="#000080">,
  </font>NumWritten  <font color="#000080">: </font>Word<font color="#000080">;
  </font>Buffer      <font color="#000080">: </font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">4096</font><font color="#000080">] </font><font color="#FF0000"><b>Of </b></font>Char<font color="#000080">;
  </font>BufferSize  <font color="#000080">: </font>Word<font color="#000080">;
  </font>ZapFile     <font color="#000080">: </font><font color="#FF0000"><b>File</b></font><font color="#000080">;
  </font>ZapFilePos  <font color="#000080">: </font>LongInt<font color="#000080">;

</font><font color="#FF0000"><b>Begin
  </b></font>BufferSize <font color="#000080">:= </font>SizeOf<font color="#000080">(</font>Buffer<font color="#000080">);
  </font>Assign<font color="#000080">(</font>ZapFile<font color="#000080">, </font>FileName<font color="#000080">);
  </font><font color="#008000"><i>{$I-} </i></font>Reset<font color="#000080">(</font>ZapFile<font color="#000080">, </font><font color="#800000">1</font><font color="#000080">); </font><font color="#008000"><i>{$I+}
  </i></font><font color="#FF0000"><b>If </b></font>IOResult <font color="#000080">&lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>Then Begin
    </b></font>WriteLn<font color="#000080">(</font><font color="#800000">'File not found'</font><font color="#000080">);
    </font>Halt<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>Repeat
    </b></font>ZapFilePos <font color="#000080">:= </font>FilePos<font color="#000080">(</font>ZapFile<font color="#000080">);
    </font>BlockRead<font color="#000080">(</font>ZapFile<font color="#000080">, </font>Buffer<font color="#000080">, </font>BufferSize<font color="#000080">, </font>NumRead<font color="#000080">);
    </font>FillChar<font color="#000080">(</font>Buffer<font color="#000080">, </font>BufferSize<font color="#000080">, </font>Pattern<font color="#000080">);
    </font>Seek<font color="#000080">(</font>ZapFile<font color="#000080">, </font>ZapFilePos<font color="#000080">);
    </font>BlockWrite<font color="#000080">(</font>ZapFile<font color="#000080">, </font>Buffer<font color="#000080">, </font>NumRead<font color="#000080">, </font>NumWritten<font color="#000080">);
  </font><font color="#FF0000"><b>Until </b></font><font color="#000080">(</font>NumRead <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>Or </b></font><font color="#000080">(</font>NumWritten <font color="#000080">&lt;&gt; </font>NumRead<font color="#000080">);
  </font>Close<font color="#000080">(</font>ZapFile<font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font>LastPass <font color="#FF0000"><b>Then </b></font>Erase<font color="#000080">(</font>ZapFile<font color="#000080">);
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>begin
  </b></font>ZapIt<font color="#000080">(</font>ParamStr<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">), </font><font color="#800000">#005</font><font color="#000080">, </font>False<font color="#000080">);  </font><font color="#008000"><i>{0101}
  </i></font>ZapIt<font color="#000080">(</font>ParamStr<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">), </font><font color="#800000">#010</font><font color="#000080">, </font>False<font color="#000080">);  </font><font color="#008000"><i>{1010}
  </i></font>ZapIt<font color="#000080">(</font>ParamStr<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">), </font><font color="#800000">#000</font><font color="#000080">, </font>False<font color="#000080">);  </font><font color="#008000"><i>{0000}
  </i></font>ZapIt<font color="#000080">(</font>ParamStr<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">), </font><font color="#800000">#255</font><font color="#000080">, </font>True <font color="#000080">);  </font><font color="#008000"><i>{1111}
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">.

</font><font color="#008000"><i>{
Here's the comments for the above procedure:

   Get the buffer size for later use
   Get the file name from the first command line parameter
   Try to open the file
   If there was an error opening file, show the user and exit
   otherwise repeat this code
     Save the current file position
     Read a block of data from the file into a buffer
     Fill buffer with specified bit pattern
     Reset file position to where we read this block from and
     write the block back to the file
   until we're done or there was a conflict in the read/write size
   close the file
   delete the file from disk if it's the last pass
}

</i></font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to FILES SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0067.PAS">Original</a><b>]</b></p></body>
</html>
