<html>
<head><title> "Find Object Unit" by OZZ NIXON</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to FILES SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0081.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code>
<font color="#FF0000"><b>Unit </b></font>WGFFind<font color="#000080">; </font><font color="#008000"><i>{File Find Object Unit}
{$I WGDEFINE.INC}  { see below for WGDEFINE !! }

</i></font><font color="#FF0000"><b>Interface

Uses
</b></font><font color="#008000"><i>{$IFDEF WINDOWS}
   </i></font>WinDos<font color="#000080">;
</font><font color="#008000"><i>{$ELSE}
   </i></font>Dos<font color="#000080">;
</font><font color="#008000"><i>{$ENDIF}

</i></font><font color="#FF0000"><b>Const
</b></font><font color="#008000"><i>{searchtypes}
   </i></font>stReadOnly<font color="#000080">=</font><font color="#800000">$01</font><font color="#000080">;
   </font>stHidden<font color="#000080">=</font><font color="#800000">$02</font><font color="#000080">;
   </font>stSysFile<font color="#000080">=</font><font color="#800000">$04</font><font color="#000080">;
   </font>stVolumeID<font color="#000080">=</font><font color="#800000">$08</font><font color="#000080">;
   </font>stDirectory<font color="#000080">=</font><font color="#800000">$10</font><font color="#000080">;
   </font>stArchive<font color="#000080">=</font><font color="#800000">$20</font><font color="#000080">;
   </font>stAnyFile<font color="#000080">=</font><font color="#800000">$3F</font><font color="#000080">;

</font><font color="#FF0000"><b>Type
</b></font><font color="#008000"><i>{$IFDEF WINDOWS}
   </i></font>PathStr<font color="#000080">=</font><font color="#FF0000"><b>String</b></font><font color="#000080">[</font><font color="#800000">128</font><font color="#000080">];
   </font>DirStr<font color="#000080">=</font><font color="#FF0000"><b>String</b></font><font color="#000080">[</font><font color="#800000">128</font><font color="#000080">];
   </font>NameStr<font color="#000080">=</font><font color="#FF0000"><b>String</b></font><font color="#000080">[</font><font color="#800000">13</font><font color="#000080">];
   </font>ExtStr<font color="#000080">=</font><font color="#FF0000"><b>String</b></font><font color="#000080">[</font><font color="#800000">4</font><font color="#000080">];
</font><font color="#008000"><i>{$ENDIF}

   </i></font>FindRec<font color="#000080">=</font><font color="#FF0000"><b>Record
</b></font><font color="#008000"><i>{$IFDEF WINDOWS}
      </i></font>SR<font color="#000080">:</font>TSearchRec<font color="#000080">;
      </font>TStr<font color="#000080">:</font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">180</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Char<font color="#000080">;
</font><font color="#008000"><i>{$ELSE}
      </i></font>SR<font color="#000080">:</font>SearchRec<font color="#000080">;
</font><font color="#008000"><i>{$ENDIF}
      </i></font>Dir<font color="#000080">:</font>DirStr<font color="#000080">;
      </font>Name<font color="#000080">:</font>NameStr<font color="#000080">;
      </font>Ext<font color="#000080">:</font>ExtStr<font color="#000080">;
      </font>DError<font color="#000080">:</font>Word<font color="#000080">;
      </font>SearchType<font color="#000080">:</font>Word<font color="#000080">;
   </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

   </font>FindObj <font color="#000080">= </font><font color="#FF0000"><b>Object
      </b></font>FI<font color="#000080">: ^</font>FindRec<font color="#000080">;
      </font><font color="#FF0000"><b>Constructor </b></font>Init<font color="#000080">(</font>ST<font color="#000080">:</font>Word<font color="#000080">);    </font><font color="#008000"><i>{SearchType: Sysfile, AnyFile, Archive}
      </i></font><font color="#FF0000"><b>Destructor </b></font>Done<font color="#000080">;
      </font><font color="#FF0000"><b>Procedure </b></font>FFirst<font color="#000080">(</font>FN<font color="#000080">:</font><font color="#FF0000"><b>String</b></font><font color="#000080">);
      </font><font color="#FF0000"><b>Procedure </b></font>FNext<font color="#000080">;
      </font><font color="#FF0000"><b>Function  </b></font>Found<font color="#000080">:</font>Boolean<font color="#000080">;
      </font><font color="#FF0000"><b>Function  </b></font>GetName<font color="#000080">:</font><font color="#FF0000"><b>String</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>Function  </b></font>GetFullPath<font color="#000080">:</font><font color="#FF0000"><b>String</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>Function  </b></font>GetDate<font color="#000080">:</font>LongInt<font color="#000080">;
      </font><font color="#FF0000"><b>Function  </b></font>GetSize<font color="#000080">:</font>LongInt<font color="#000080">;
      </font><font color="#FF0000"><b>Function  </b></font>GetAttr<font color="#000080">:</font>Word<font color="#000080">;
   </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Implementation

</b></font><font color="#008000"><i>{$IFDEF WINDOWS}
</i></font><font color="#FF0000"><b>Function </b></font>FExpand<font color="#000080">(</font>Str<font color="#000080">:</font><font color="#FF0000"><b>String</b></font><font color="#000080">):</font><font color="#FF0000"><b>String</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Var
   </b></font>IStr<font color="#000080">:</font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">128</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Char<font color="#000080">;
   </font>OStr<font color="#000080">:</font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">128</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Char<font color="#000080">;

</font><font color="#FF0000"><b>Begin
   </b></font>StrPCopy<font color="#000080">(</font>IStr<font color="#000080">,</font>Str<font color="#000080">);
   </font>FileExpand<font color="#000080">(</font>OStr<font color="#000080">,</font>IStr<font color="#000080">);
   </font>FExpand<font color="#000080">:=</font>StrPas<font color="#000080">(</font>OStr<font color="#000080">);
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;
</font><font color="#008000"><i>{$ENDIF}

{$IFDEF WINDOWS}
</i></font><font color="#FF0000"><b>Procedure </b></font>FSplit<font color="#000080">(</font>Path<font color="#000080">:</font><font color="#FF0000"><b>String</b></font><font color="#000080">;</font><font color="#FF0000"><b>Var </b></font>Dir<font color="#000080">:</font><font color="#FF0000"><b>String</b></font><font color="#000080">;</font><font color="#FF0000"><b>Var </b></font>Name<font color="#000080">:</font><font color="#FF0000"><b>String</b></font><font color="#000080">;</font><font color="#FF0000"><b>Var </b></font>Ext<font color="#000080">:</font><font color="#FF0000"><b>String</b></font><font color="#000080">);
</font><font color="#FF0000"><b>Var
   </b></font>FPath<font color="#000080">:</font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">129</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Char<font color="#000080">;
   </font>TD<font color="#000080">:</font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">129</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Char<font color="#000080">;
   </font>TN<font color="#000080">:</font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">14</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Char<font color="#000080">;
   </font>TE<font color="#000080">:</font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">5</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Char<font color="#000080">;

</font><font color="#FF0000"><b>Begin
   </b></font>StrPCopy<font color="#000080">(</font>FPath<font color="#000080">,</font>Path<font color="#000080">);
   </font>FileSplit<font color="#000080">(</font>FPath<font color="#000080">,</font>TD<font color="#000080">,</font>TN<font color="#000080">,</font>TE<font color="#000080">);
   </font>Dir<font color="#000080">:=</font>StrPas<font color="#000080">(</font>TD<font color="#000080">);
   </font>Name<font color="#000080">:=</font>StrPas<font color="#000080">(</font>TN<font color="#000080">);
   </font>Ext<font color="#000080">:=</font>StrPas<font color="#000080">(</font>TE<font color="#000080">);
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;
</font><font color="#008000"><i>{$ENDIF}

</i></font><font color="#FF0000"><b>Constructor </b></font>FindObj<font color="#000080">.</font>Init<font color="#000080">;
</font><font color="#FF0000"><b>Begin
   </b></font>New<font color="#000080">(</font>FI<font color="#000080">);
   </font><font color="#FF0000"><b>If </b></font>FI<font color="#000080">=</font><font color="#FF0000"><b>Nil then </b></font>Fail<font color="#000080">;
   </font>FI<font color="#000080">^.</font>DError<font color="#000080">:=</font><font color="#800000">1</font><font color="#000080">;
   </font>FI<font color="#000080">^.</font>SearchType<font color="#000080">:=</font>StArchive<font color="#000080">+</font>StReadOnly<font color="#000080">; </font><font color="#008000"><i>{default}
</i></font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Destructor </b></font>FindObj<font color="#000080">.</font>Done<font color="#000080">;
</font><font color="#FF0000"><b>Begin
   If </b></font>FI<font color="#000080">&lt;&gt;</font><font color="#FF0000"><b>Nil then </b></font>Dispose<font color="#000080">(</font>FI<font color="#000080">);
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>FindObj<font color="#000080">.</font>FFirst<font color="#000080">(</font>FN<font color="#000080">:</font><font color="#FF0000"><b>String</b></font><font color="#000080">);
</font><font color="#FF0000"><b>Begin
   If </b></font>FI<font color="#000080">&lt;&gt;</font><font color="#FF0000"><b>Nil then Begin
      </b></font>FN<font color="#000080">:=</font>FExpand<font color="#000080">(</font>FN<font color="#000080">);
      </font>FSplit<font color="#000080">(</font>FN<font color="#000080">,</font>FI<font color="#000080">^.</font>Dir<font color="#000080">,</font>FI<font color="#000080">^.</font>Name<font color="#000080">,</font>FI<font color="#000080">^.</font>Ext<font color="#000080">);
</font><font color="#008000"><i>{$IFDEF WINDOWS}
      </i></font>StrPCopy<font color="#000080">(</font>FI<font color="#000080">^.</font>TStr<font color="#000080">, </font>FN<font color="#000080">);
      </font>FindFirst<font color="#000080">(</font>FI<font color="#000080">^.</font>TStr<font color="#000080">,</font>FI<font color="#000080">^.</font>SearchType<font color="#000080">,</font>FI<font color="#000080">^.</font>SR<font color="#000080">);
</font><font color="#008000"><i>{$ELSE}
      </i></font>FindFirst<font color="#000080">(</font>FN<font color="#000080">,</font>FI<font color="#000080">^.</font>SearchType<font color="#000080">,</font>FI<font color="#000080">^.</font>SR<font color="#000080">);
</font><font color="#008000"><i>{$ENDIF}
      </i></font>FI<font color="#000080">^.</font>DError<font color="#000080">:=</font>DosError<font color="#000080">;
   </font><font color="#FF0000"><b>End
   Else </b></font>FI<font color="#000080">^.</font>DError<font color="#000080">:=</font><font color="#800000">1</font><font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function  </b></font>FindObj<font color="#000080">.</font>GetName<font color="#000080">:</font><font color="#FF0000"><b>String</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Begin
   </b></font>GetName<font color="#000080">:=</font><font color="#800000">''</font><font color="#000080">;
   </font><font color="#FF0000"><b>If </b></font>FI<font color="#000080">&lt;&gt;</font><font color="#FF0000"><b>Nil then
      If </b></font>Found <font color="#FF0000"><b>Then
</b></font><font color="#008000"><i>{$IFDEF WINDOWS}
         </i></font>GetName<font color="#000080">:=</font>StrPas<font color="#000080">(</font>FI<font color="#000080">^.</font>SR<font color="#000080">.</font>Name<font color="#000080">);
</font><font color="#008000"><i>{$ELSE}
       </i></font>GetName<font color="#000080">:=</font>FI<font color="#000080">^.</font>SR<font color="#000080">.</font>Name<font color="#000080">;
</font><font color="#008000"><i>{$ENDIF}
</i></font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>FindObj<font color="#000080">.</font>GetFullPath<font color="#000080">:</font><font color="#FF0000"><b>String</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Begin
   If </b></font>FI<font color="#000080">&lt;&gt;</font><font color="#FF0000"><b>Nil then </b></font>GetFullPath<font color="#000080">:=</font>FI<font color="#000080">^.</font>Dir<font color="#000080">+</font>GetName
   <font color="#FF0000"><b>Else </b></font>GetFullPath<font color="#000080">:=</font><font color="#800000">''</font><font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>FindObj<font color="#000080">.</font>GetSize<font color="#000080">:</font>LongInt<font color="#000080">;
</font><font color="#FF0000"><b>Begin
   </b></font>GetSize<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
   </font><font color="#FF0000"><b>If </b></font>FI<font color="#000080">&lt;&gt;</font><font color="#FF0000"><b>Nil then
      If </b></font>Found <font color="#FF0000"><b>Then </b></font>GetSize<font color="#000080">:=</font>FI<font color="#000080">^.</font>SR<font color="#000080">.</font>Size<font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function  </b></font>FindObj<font color="#000080">.</font>GetDate<font color="#000080">: </font>LongInt<font color="#000080">;
</font><font color="#FF0000"><b>Begin
   </b></font>GetDate<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
   </font><font color="#FF0000"><b>If </b></font>FI<font color="#000080">&lt;&gt;</font><font color="#FF0000"><b>Nil then
      If </b></font>Found <font color="#FF0000"><b>Then </b></font>GetDate<font color="#000080">:=</font>FI<font color="#000080">^.</font>SR<font color="#000080">.</font>Time<font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function  </b></font>FindObj<font color="#000080">.</font>GetAttr<font color="#000080">:</font>Word<font color="#000080">;
</font><font color="#FF0000"><b>Begin
   </b></font>GetAttr<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
   </font><font color="#FF0000"><b>If </b></font>FI<font color="#000080">&lt;&gt;</font><font color="#FF0000"><b>Nil then
      If </b></font>Found <font color="#FF0000"><b>Then </b></font>GetAttr<font color="#000080">:=</font>FI<font color="#000080">^.</font>SR<font color="#000080">.</font>Attr<font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>FindObj<font color="#000080">.</font>FNext<font color="#000080">;
</font><font color="#FF0000"><b>Begin
   If </b></font>FI<font color="#000080">&lt;&gt;</font><font color="#FF0000"><b>Nil then Begin
      </b></font>FindNext<font color="#000080">(</font>FI<font color="#000080">^.</font>SR<font color="#000080">);
      </font>FI<font color="#000080">^.</font>DError<font color="#000080">:=</font>DosError<font color="#000080">;
   </font><font color="#FF0000"><b>End
   Else </b></font>FI<font color="#000080">^.</font>DError<font color="#000080">:=</font><font color="#800000">1</font><font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>FindObj<font color="#000080">.</font>Found<font color="#000080">:</font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>Begin
   </b></font>Found<font color="#000080">:=(</font>FI<font color="#000080">^.</font>DError<font color="#000080">=</font><font color="#800000">0</font><font color="#000080">);
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>End</b></font><font color="#000080">.

[</font>WGDEFINE<font color="#000080">.</font>INC<font color="#000080">]
</font><font color="#008000"><i>{$I-}
{$V-}
{$S+}
{$F+}
{$D-}
{$L-}
{$R-}
{$X+}

{$IFNDEF WINDOWS}
{$O+}                       {Make units overlayable}
{$IFNDEF OS2}
{$X-}                       {Turn off extended syntax}
{$ENDIF}
{$ENDIF}

{$IFDEF WINDOWS}
  {$DEFINE BASMINT}         {Use BASM for interrupts under windows}
{$ENDIF}

{.$.DEFINE OPRO}
{.$.DEFINE DEBUG}
{BBS Definitions below (some that I have tested the new WGMSG*.PAS w/!)}
{$IFDEF MAXIMUS}
   {$DEFINE SQUISH}
{$ENDIF}
{$IFDEF RA2}
   {$DEFINE JAM}
   {$DEFINE HUDSON}
{$ENDIF}
{$IFDEF XENOPHOBE}
   {$DEFINE FIDO}
   {$DEFINE SQUISH}
   {$DEFINE JAM}
{$ENDIF}
</i></font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to FILES SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0081.PAS">Original</a><b>]</b></p></body>
</html>
