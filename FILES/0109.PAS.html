<html>
<head><title> "Long filename support unit" by PINO NAVATO</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to FILES SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0109.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#000000"> <font color="#008000"><i>{***************************************************************************}
 {                                                                           }
 {   LFN  -  Free unit for long filename support.  100% asm code.            }
 {           All functions return an error code                              }
 {           and also store it in DosError in the Dos unit.                  }
 {           A demo program is at the end of this unit.                      }
 {                                                                           }
 {   Author: Pino Navato                                                     }
 {   E-Mail: pnavato@poboxes.com                                             }
 {           pnavato@geocities.com                                           }
 {           Pino Navato, 2:335/225.18  (The Bits BBS, Fidonet)              }
 {   WWW:    www.poboxes.com/pnavato                                         }
 {           (currently forwards to  www.geocities.com/SiliconValley/4421)   }
 {                                                                           }
 {   Advertisement:                                                          }
 {     Do you need new CHR fonts for the BGI?  Visit my home page!           }
 {                                                                           }
 {   Acknowledgments:                                                        }
 {     - This unit is partially based on the LDOS unit by Arne de Bruijn.    }
 {     - Technical info obtained from the Ralf Brown's Interrupt List.       }
 {                                                                           }
 {***************************************************************************}


</i></font><font color="#FF0000"><b>Unit </b></font>LFN<font color="#000080">;

</font><font color="#FF0000"><b>interface

uses </b></font>DOS<font color="#000080">;


</font><font color="#FF0000"><b>type </b></font>QuadWord   <font color="#000080">= </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">3</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>word<font color="#000080">;  </font><font color="#008000"><i>{ For W95 file date/time }

     </i></font>LSearchRec <font color="#000080">= </font><font color="#FF0000"><b>record
                     </b></font>Attr            <font color="#000080">: </font>LongInt<font color="#000080">;
                     </font>CreationTime<font color="#000080">,
                     </font>LastAccessTime<font color="#000080">,
                     </font>LastModTime     <font color="#000080">: </font>QuadWord<font color="#000080">; </font><font color="#008000"><i>{ See below for conversion }
                     </i></font>HiSize<font color="#000080">,
                     </font>LoSize          <font color="#000080">: </font>LongInt<font color="#000080">;
                     </font>reserved        <font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">7</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">;
                     </font>name            <font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">259</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>char<font color="#000080">;
                     </font>ShortName       <font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">13</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>char<font color="#000080">; </font><font color="#008000"><i>{ Only if longname exists }
                     </i></font>Handle          <font color="#000080">: </font>word<font color="#000080">;
                  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>function </b></font>LFileSystemInfo<font color="#000080">(</font>RootName<font color="#000080">: </font>PChar<font color="#000080">; </font>FSName<font color="#000080">: </font>PChar<font color="#000080">; </font>FSNameBufSize<font color="#000080">: </font>word<font color="#000080">;
                         </font><font color="#FF0000"><b>var </b></font>Flags<font color="#000080">, </font>MaxFileNameLen<font color="#000080">, </font>MaxPathLen<font color="#000080">: </font>word<font color="#000080">): </font>word<font color="#000080">;
</font><font color="#008000"><i>{ Return File System Information, for FSName 32 bytes should be sufficient }
{ Rootname is, for example, 'C:\' }

{ WARNING: due to a bug in Windows95, this function returns MaxPathLen = 0 }
{          for CD-ROMs!                                                    }

{ Bitfields for long filename volume information flags:       }
{ Bit(s)  Description                                         }
{  0      searches are case sensitive                         }
{  1      preserves case in directory entries                 }
{  2      uses Unicode characters in file and directory names }
{  3-13   reserved (0)                                        }
{  14     supports DOS long filename functions                }
{  15     volume is compressed                                }


</i></font><font color="#FF0000"><b>function </b></font>LFindFirst<font color="#000080">(</font>FileSpec<font color="#000080">: </font>PChar<font color="#000080">; </font>Attr<font color="#000080">: </font>word<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>SRec<font color="#000080">: </font>LSearchRec<font color="#000080">): </font>word<font color="#000080">;
</font><font color="#008000"><i>{ Search for files }

</i></font><font color="#FF0000"><b>function </b></font>LFindNext<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>SRec<font color="#000080">: </font>LSearchRec<font color="#000080">): </font>word<font color="#000080">;
</font><font color="#008000"><i>{ Find next file }

</i></font><font color="#FF0000"><b>function </b></font>LFindClose<font color="#000080">(</font>SRec<font color="#000080">: </font>LSearchRec<font color="#000080">): </font>word<font color="#000080">;
</font><font color="#008000"><i>{ Free search handle }


</i></font><font color="#FF0000"><b>function </b></font>LGetTrueName<font color="#000080">(</font>FileName<font color="#000080">, </font>TrueName<font color="#000080">: </font>PChar<font color="#000080">): </font>word<font color="#000080">;
</font><font color="#008000"><i>{ Return complete path, in buffer TrueName (261 bytes) }

</i></font><font color="#FF0000"><b>function </b></font>LGetShortName<font color="#000080">(</font>FileName<font color="#000080">, </font>ShortName<font color="#000080">: </font>PChar<font color="#000080">): </font>word<font color="#000080">;
</font><font color="#008000"><i>{ Return complete short name/path for input file/path in buffer ShortName (128 bytes) }

</i></font><font color="#FF0000"><b>function </b></font>LGetLongName<font color="#000080">(</font>FileName<font color="#000080">, </font>LongName<font color="#000080">: </font>PChar<font color="#000080">): </font>word<font color="#000080">;
</font><font color="#008000"><i>{ Return complete long name/path for input file/path in buffer LongName (261 bytes) }


</i></font><font color="#FF0000"><b>function </b></font>LRename<font color="#000080">(</font>OldName<font color="#000080">, </font>NewName<font color="#000080">: </font>PChar<font color="#000080">): </font>word<font color="#000080">;
</font><font color="#008000"><i>{ Rename file }

</i></font><font color="#FF0000"><b>function </b></font>LErase<font color="#000080">(</font>Filename<font color="#000080">: </font>PChar<font color="#000080">): </font>word<font color="#000080">;
</font><font color="#008000"><i>{ Erase file }

</i></font><font color="#FF0000"><b>function </b></font>LMultiErase<font color="#000080">(</font>FileMask<font color="#000080">: </font>PChar<font color="#000080">; </font>SearchAttr<font color="#000080">, </font>MustMatchAttr<font color="#000080">: </font>byte<font color="#000080">): </font>word<font color="#000080">;
</font><font color="#008000"><i>{ Erase files (wildcards allowed) }


</i></font><font color="#FF0000"><b>function </b></font>LMkDir<font color="#000080">(</font>Dir<font color="#000080">: </font>PChar<font color="#000080">): </font>word<font color="#000080">;
</font><font color="#008000"><i>{ Make directory }

</i></font><font color="#FF0000"><b>function </b></font>LRmDir<font color="#000080">(</font>Dir<font color="#000080">: </font>PChar<font color="#000080">): </font>word<font color="#000080">;
</font><font color="#008000"><i>{ Remove directory }

</i></font><font color="#FF0000"><b>function </b></font>LChDir<font color="#000080">(</font>Dir<font color="#000080">: </font>PChar<font color="#000080">): </font>word<font color="#000080">;
</font><font color="#008000"><i>{ Change current directory }

</i></font><font color="#FF0000"><b>function </b></font>LGetDir<font color="#000080">(</font>Drive<font color="#000080">: </font>byte<font color="#000080">; </font>Dir<font color="#000080">: </font>PChar<font color="#000080">): </font>word<font color="#000080">;
</font><font color="#008000"><i>{ Get current directory (no drive letter nor leading backslash).
  Drive: 0=current, 1=A: etc. }


</i></font><font color="#FF0000"><b>function </b></font>LGetFAttr<font color="#000080">(</font>Filename<font color="#000080">: </font>PChar<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>Attr<font color="#000080">: </font>word<font color="#000080">): </font>word<font color="#000080">;
</font><font color="#008000"><i>{ Get file attributes}

</i></font><font color="#FF0000"><b>function </b></font>LSetFAttr<font color="#000080">(</font>Filename<font color="#000080">: </font>PChar<font color="#000080">; </font>Attr<font color="#000080">: </font>word<font color="#000080">): </font>word<font color="#000080">;
</font><font color="#008000"><i>{ Set file attributes }

</i></font><font color="#FF0000"><b>function </b></font>LGetFTime<font color="#000080">(</font>FileName<font color="#000080">: </font>PChar<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>FTime<font color="#000080">: </font>LongInt<font color="#000080">): </font>word<font color="#000080">;
</font><font color="#008000"><i>{ Get last-write date/time }

</i></font><font color="#FF0000"><b>function </b></font>LSetFTime<font color="#000080">(</font>FileName<font color="#000080">: </font>PChar<font color="#000080">; </font>FTime<font color="#000080">: </font>LongInt<font color="#000080">): </font>word<font color="#000080">;
</font><font color="#008000"><i>{ Set last-write date/time }

</i></font><font color="#FF0000"><b>function </b></font>LGetCreationFTime<font color="#000080">(</font>FileName<font color="#000080">: </font>PChar<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>CFTime<font color="#000080">: </font>LongInt<font color="#000080">): </font>word<font color="#000080">;
</font><font color="#008000"><i>{ Get creation file date/time }

</i></font><font color="#FF0000"><b>function </b></font>LSetCreationFTime<font color="#000080">(</font>FileName<font color="#000080">: </font>PChar<font color="#000080">; </font>CFTime<font color="#000080">: </font>LongInt<font color="#000080">): </font>word<font color="#000080">;
</font><font color="#008000"><i>{ Set creation file date/time }

</i></font><font color="#FF0000"><b>function </b></font>LGetLastAccessFDate<font color="#000080">(</font>FileName<font color="#000080">: </font>PChar<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>LAFDate<font color="#000080">: </font>LongInt<font color="#000080">): </font>word<font color="#000080">;
</font><font color="#008000"><i>{ Get last-access file date }

</i></font><font color="#FF0000"><b>function </b></font>LSetLastAccessFDate<font color="#000080">(</font>FileName<font color="#000080">: </font>PChar<font color="#000080">; </font>LAFDate<font color="#000080">: </font>LongInt<font color="#000080">): </font>word<font color="#000080">;
</font><font color="#008000"><i>{ Set last-access file date }

</i></font><font color="#FF0000"><b>function </b></font>LTimeToDos<font color="#000080">(</font>LTime<font color="#000080">: </font>QuadWord<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>DosTime<font color="#000080">: </font>LongInt<font color="#000080">): </font>word<font color="#000080">;
</font><font color="#008000"><i>{ Convert 64-bit W95 file date/time to local DOS date/time (packed format) }

</i></font><font color="#FF0000"><b>function </b></font>LUnpackTime<font color="#000080">(</font>LTime<font color="#000080">: </font>QuadWord<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>DT<font color="#000080">: </font>DateTime<font color="#000080">): </font>word<font color="#000080">;
</font><font color="#008000"><i>{ Convert 64-bit time to date/time record }


</i></font><font color="#FF0000"><b>function </b></font>LGetPhysicalFSize<font color="#000080">(</font>FileName<font color="#000080">: </font>PChar<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>Size<font color="#000080">: </font>LongInt<font color="#000080">): </font>word<font color="#000080">;
</font><font color="#008000"><i>{ Get physical size of compressed file }



</i></font><font color="#FF0000"><b>implementation

function </b></font>LFileSystemInfo<font color="#000080">(</font>RootName<font color="#000080">: </font>PChar<font color="#000080">; </font>FSName<font color="#000080">: </font>PChar<font color="#000080">; </font>FSNameBufSize<font color="#000080">: </font>word<font color="#000080">;
                         </font><font color="#FF0000"><b>var </b></font>Flags<font color="#000080">, </font>MaxFileNameLen<font color="#000080">, </font>MaxPathLen<font color="#000080">: </font>word<font color="#000080">): </font>word<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#008000"><i>{ Return File System Information }
{ WARNING: due to a bug in Windows95, this function returns MaxPathLen = 0 }
{          for CD-ROMs!                                                    }
</i></font><font color="#FF0000"><b>asm
  </b></font><font color="#FF00FF">push  ds
  lds   dx,RootName
  les   di,FSName
  mov   cx,FSNameBufSize
  mov   ax,71A0h
  stc
  int   21h
  lds   di,Flags
  mov   ds:[di],bx
  lds   di,MaxFileNameLen
  mov   ds:[di],cx
  lds   di,MaxPathLen
  mov   ds:[di],dx
  pop   ds
  sbb   bx,bx      </font><font color="#008000"><i>{ if CF=1 then BX:=$FFFF else BX:=0 }
  </i></font><font color="#FF00FF">and   ax,bx
  mov   [DosError],ax
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;



</font><font color="#FF0000"><b>function </b></font>LFindFirst<font color="#000080">(</font>FileSpec<font color="#000080">: </font>PChar<font color="#000080">; </font>Attr<font color="#000080">: </font>word<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>SRec<font color="#000080">: </font>LSearchRec<font color="#000080">): </font>word<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#008000"><i>{ Search for files }
</i></font><font color="#FF0000"><b>asm
  </b></font><font color="#FF00FF">push  ds
  lds   dx,FileSpec
  mov   cx,Attr
  les   di,SRec
  xor   si,si
  mov   ax,714Eh
  stc
  int   21h
  pop   ds
  mov   es:[di].LSearchRec.Handle,ax
  sbb   bx,bx
  and   ax,bx
  mov   [DosError],ax
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>function </b></font>LFindNext<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>SRec<font color="#000080">: </font>LSearchRec<font color="#000080">): </font>word<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#008000"><i>{ Find next file }
</i></font><font color="#FF0000"><b>asm
  </b></font><font color="#FF00FF">les   di,SRec
  mov   bx,es:[di].LSearchRec.Handle
  xor   si,si
  mov   ax,714Fh
  stc
  int   21h
  sbb   bx,bx
  and   ax,bx
  mov   [DosError],ax
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>function </b></font>LFindClose<font color="#000080">(</font>SRec<font color="#000080">: </font>LSearchRec<font color="#000080">): </font>word<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#008000"><i>{ Free search handle }
</i></font><font color="#FF0000"><b>asm
  </b></font><font color="#FF00FF">les   di,SRec
  mov   bx,es:[di].LSearchRec.Handle
  mov   ax,71A1h
  stc
  int   21h
  sbb   bx,bx
  and   ax,bx
  mov   [DosError],ax
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;



</font><font color="#FF0000"><b>function </b></font>LGetTrueName<font color="#000080">(</font>FileName<font color="#000080">, </font>TrueName<font color="#000080">: </font>PChar<font color="#000080">): </font>word<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#008000"><i>{ Return complete path, in buffer TrueName (261 bytes) }
</i></font><font color="#FF0000"><b>asm
  </b></font><font color="#FF00FF">push  ds
  lds   si,FileName
  les   di,TrueName
  mov   ax,7160h
  xor   cx,cx
  stc
  int   21h
  pop   ds
  sbb   bx,bx
  and   ax,bx
  mov   [DosError],ax
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>function </b></font>LGetShortName<font color="#000080">(</font>FileName<font color="#000080">, </font>ShortName<font color="#000080">: </font>PChar<font color="#000080">): </font>word<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#008000"><i>{ Return complete short name/path for input file/path in buffer ShortName (128 bytes) }
</i></font><font color="#FF0000"><b>asm
  </b></font><font color="#FF00FF">push  ds
  lds   si,FileName
  les   di,ShortName
  mov   ax,7160h
  mov   cx,1    </font><font color="#008000"><i>{ Return a path containing true path for a SUBSTed drive letter }
  </i></font><font color="#FF00FF">stc
  int   21h
  pop   ds
  sbb   bx,bx
  and   ax,bx
  mov   [DosError],ax
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>function </b></font>LGetLongName<font color="#000080">(</font>FileName<font color="#000080">, </font>LongName<font color="#000080">: </font>PChar<font color="#000080">): </font>word<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#008000"><i>{ Return complete long name/path for input file/path in buffer LongName (261 bytes) }
</i></font><font color="#FF0000"><b>asm
  </b></font><font color="#FF00FF">push  ds
  lds   si,FileName
  les   di,LongName
  mov   ax,7160h
  mov   cx,2    </font><font color="#008000"><i>{ Return a path containing true path for a SUBSTed drive letter }
  </i></font><font color="#FF00FF">stc
  int   21h
  pop   ds
  sbb   bx,bx
  and   ax,bx
  mov   [DosError],ax
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;



</font><font color="#FF0000"><b>function </b></font>LRename<font color="#000080">(</font>OldName<font color="#000080">, </font>NewName<font color="#000080">: </font>PChar<font color="#000080">): </font>word<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>asm
  </b></font><font color="#FF00FF">push  ds
  lds   dx,OldName
  les   di,NewName
  mov   ax,7156h
  stc
  int   21h
  pop   ds
  sbb   bx,bx
  and   ax,bx
  mov   [DosError],ax
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>function </b></font>LErase<font color="#000080">(</font>Filename<font color="#000080">: </font>PChar<font color="#000080">): </font>word<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>asm
  </b></font><font color="#FF00FF">push  ds
  lds   dx,Filename
  xor   si,si        </font><font color="#008000"><i>{ Wildcards not allowed }
  </i></font><font color="#FF00FF">mov   ax,7141h
  stc
  int   21h
  pop   ds
  sbb   bx,bx
  and   ax,bx
  mov   [DosError],ax
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>function </b></font>LMultiErase<font color="#000080">(</font>FileMask<font color="#000080">: </font>PChar<font color="#000080">; </font>SearchAttr<font color="#000080">, </font>MustMatchAttr<font color="#000080">: </font>byte<font color="#000080">): </font>word<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#008000"><i>{ Erase files (wildcards allowed) }
</i></font><font color="#FF0000"><b>asm
  </b></font><font color="#FF00FF">push  ds
  lds   dx,FileMask
  mov   si,1        </font><font color="#008000"><i>{ Wildcards allowed }
  </i></font><font color="#FF00FF">mov   cl,[SearchAttr]
  mov   ch,[MustMatchAttr]
  mov   ax,7141h
  stc
  int   21h
  pop   ds
  sbb   bx,bx
  and   ax,bx
  mov   [DosError],ax
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;



</font><font color="#FF0000"><b>function </b></font>LMkDir<font color="#000080">(</font>Dir<font color="#000080">: </font>PChar<font color="#000080">): </font>word<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>asm
  </b></font><font color="#FF00FF">push  ds
  lds   dx,Dir
  mov   ax,7139h
  stc
  int   21h
  pop   ds
  sbb   bx,bx
  and   ax,bx
  mov   [DosError],ax
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>function </b></font>LRmDir<font color="#000080">(</font>Dir<font color="#000080">: </font>PChar<font color="#000080">): </font>word<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>asm
  </b></font><font color="#FF00FF">push  ds
  lds   dx,Dir
  mov   ax,713Ah
  stc
  int   21h
  pop   ds
  sbb   bx,bx
  and   ax,bx
  mov   [DosError],ax
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>function </b></font>LChDir<font color="#000080">(</font>Dir<font color="#000080">: </font>PChar<font color="#000080">): </font>word<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>asm
  </b></font><font color="#FF00FF">push  ds
  lds   dx,Dir
  mov   ax,713Bh
  int   21h
  pop   ds
  sbb   bx,bx
  and   ax,bx
  mov   [DosError],ax
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>function </b></font>LGetDir<font color="#000080">(</font>Drive<font color="#000080">:</font>byte<font color="#000080">; </font>Dir<font color="#000080">: </font>PChar<font color="#000080">): </font>word<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>asm
  </b></font><font color="#FF00FF">push  ds
  mov   dl,[Drive]
  lds   si,Dir
  mov   ax,7147h
  stc
  int   21h
  pop   ds
  sbb   bx,bx
  and   ax,bx
  mov   [DosError],ax
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;



</font><font color="#FF0000"><b>function </b></font>LGetFAttr<font color="#000080">(</font>Filename<font color="#000080">: </font>PChar<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>Attr<font color="#000080">: </font>word<font color="#000080">): </font>word<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>asm
  </b></font><font color="#FF00FF">push  ds
  lds   dx,Filename
  mov   ax,7143h
  xor   bl,bl
  stc
  int   21h
  lds   di,Attr
  mov   ds:[di],cx
  pop   ds
  sbb   bx,bx
  and   ax,bx
  mov   [DosError],ax
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>function </b></font>LSetFAttr<font color="#000080">(</font>Filename<font color="#000080">: </font>PChar<font color="#000080">; </font>Attr<font color="#000080">: </font>word<font color="#000080">): </font>word<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>asm
  </b></font><font color="#FF00FF">push  ds
  lds   dx,Filename
  mov   cx,[Attr]
  mov   ax,7143h
  mov   bl,1
  stc
  int   21h
  pop   ds
  sbb   bx,bx
  and   ax,bx
  mov   [DosError],ax
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>function </b></font>LGetFTime<font color="#000080">(</font>FileName<font color="#000080">: </font>PChar<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>FTime<font color="#000080">: </font>LongInt<font color="#000080">): </font>word<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#008000"><i>{ Get last-write date/time }
</i></font><font color="#FF0000"><b>asm
  </b></font><font color="#FF00FF">push  ds
  lds   dx,Filename
  mov   ax,7143h
  mov   bl,4
  stc
  int   21h
  lds   bx,FTime
  mov   ds:[bx],cx
  mov   ds:[bx+2],di
  pop   ds
  sbb   bx,bx
  and   ax,bx
  mov   [DosError],ax
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>function </b></font>LSetFTime<font color="#000080">(</font>FileName<font color="#000080">: </font>PChar<font color="#000080">; </font>FTime<font color="#000080">: </font>LongInt<font color="#000080">): </font>word<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#008000"><i>{ Set last-write date/time }
</i></font><font color="#FF0000"><b>asm
  </b></font><font color="#FF00FF">push  ds
  lds   dx,Filename
  mov   cx,word ptr [FTime]
  mov   di,word ptr [FTime+2]
  mov   ax,7143h
  mov   bl,3
  stc
  int   21h
  pop   ds
  sbb   bx,bx
  and   ax,bx
  mov   [DosError],ax
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>function </b></font>LGetCreationFTime<font color="#000080">(</font>FileName<font color="#000080">: </font>PChar<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>CFTime<font color="#000080">: </font>LongInt<font color="#000080">): </font>word<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#008000"><i>{ Get creation file date/time }
</i></font><font color="#FF0000"><b>asm
  </b></font><font color="#FF00FF">push  ds
  lds   dx,Filename
  mov   ax,7143h
  mov   bl,8
  stc
  int   21h
  lds   bx,CFTime
  mov   ds:[bx],cx
  mov   ds:[bx+2],di
  pop   ds
  sbb   bx,bx
  and   ax,bx
  mov   [DosError],ax
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>function </b></font>LSetCreationFTime<font color="#000080">(</font>FileName<font color="#000080">: </font>PChar<font color="#000080">; </font>CFTime<font color="#000080">: </font>LongInt<font color="#000080">): </font>word<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#008000"><i>{ Set creation file date/time }
</i></font><font color="#FF0000"><b>asm
  </b></font><font color="#FF00FF">push  ds
  lds   dx,Filename
  mov   cx,word ptr [CFTime]
  mov   di,word ptr [CFTime+2]
  xor   si,si
  mov   ax,7143h
  mov   bl,7
  stc
  int   21h
  pop   ds
  sbb   bx,bx
  and   ax,bx
  mov   [DosError],ax
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>function </b></font>LGetLastAccessFDate<font color="#000080">(</font>FileName<font color="#000080">: </font>PChar<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>LAFDate<font color="#000080">: </font>LongInt<font color="#000080">): </font>word<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#008000"><i>{ Get last-access file date }
</i></font><font color="#FF0000"><b>asm
  </b></font><font color="#FF00FF">push  ds
  lds   dx,Filename
  mov   ax,7143h
  mov   bl,6
  stc
  int   21h
  lds   bx,LAFDate
  mov   ds:[bx],cx
  mov   ds:[bx+2],di
  pop   ds
  sbb   bx,bx
  and   ax,bx
  mov   [DosError],ax
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>function </b></font>LSetLastAccessFDate<font color="#000080">(</font>FileName<font color="#000080">: </font>PChar<font color="#000080">; </font>LAFDate<font color="#000080">: </font>LongInt<font color="#000080">): </font>word<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#008000"><i>{ Set last-access file date }
</i></font><font color="#FF0000"><b>asm
  </b></font><font color="#FF00FF">push  ds
  lds   dx,Filename
  mov   di,word ptr [LAFDate+2]
  mov   ax,7143h
  mov   bl,5
  stc
  int   21h
  pop   ds
  sbb   bx,bx
  and   ax,bx
  mov   [DosError],ax
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>function </b></font>LTimeToDos<font color="#000080">(</font>LTime<font color="#000080">: </font>QuadWord<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>DosTime<font color="#000080">: </font>LongInt<font color="#000080">): </font>word<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#008000"><i>{ Convert 64-bit W95 file date/time to local DOS date/time (packed format) }
</i></font><font color="#FF0000"><b>asm
  </b></font><font color="#FF00FF">push  ds
  lds   si,LTime
  mov   ax,71A7h
  xor   bl,bl
  stc
  int   21h
  lds   di,DosTime
  mov   ds:[di],cx
  mov   ds:[di+2],dx
  pop   ds
  sbb   bx,bx
  and   ax,bx
  mov   [DosError],ax
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>function </b></font>LUnpackTime<font color="#000080">(</font>LTime<font color="#000080">: </font>QuadWord<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>DT<font color="#000080">: </font>DateTime<font color="#000080">): </font>word<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#008000"><i>{ Convert 64-bit time to date/time record }
</i></font><font color="#FF0000"><b>var </b></font>DosTime <font color="#000080">: </font>LongInt<font color="#000080">;
</font><font color="#FF0000"><b>asm
  </b></font><font color="#FF00FF">les   di,Ltime
  push  es
  push  di
  lea   di,DosTime
  push  ss
  push  di
  push  cs                    </font><font color="#008000"><i>{ PUSH CS + CALL NEAR is faster than CALL FAR }
  </i></font><font color="#FF00FF">call  near ptr LTimeToDos   </font><font color="#008000"><i>{ LTimeToDos(Ltime, DosTime) }
  </i></font><font color="#FF00FF">jc    @</font><font color="#FF0000"><b>end
  </b></font>push  word ptr <font color="#000080">[</font>DosTime<font color="#000080">+</font><font color="#800000">2</font><font color="#000080">]
  </font>push  word ptr <font color="#000080">[</font>DosTime<font color="#000080">]
  </font>les   di<font color="#000080">,</font>DT
  push  es
  push  di
  call  UnpackTime            <font color="#008000"><i>{ UnpackTime(DosTime, DT) }
  </i></font><font color="#FF0000"><b>xor   </b></font>ax<font color="#000080">,</font>ax
<font color="#000080">@</font><font color="#FF0000"><b>end</b></font><font color="#000080">:
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;



</font><font color="#FF0000"><b>function </b></font>LGetPhysicalFSize<font color="#000080">(</font>FileName<font color="#000080">: </font>PChar<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>Size<font color="#000080">: </font>LongInt<font color="#000080">): </font>word<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#008000"><i>{ Get physical size of compressed file }
</i></font><font color="#FF0000"><b>asm
  </b></font><font color="#FF00FF">push  ds
  lds   dx,Filename
  mov   ax,7143h
  mov   bl,2
  stc
  int   21h
  lds   bx,Size
  mov   ds:[bx],ax
  mov   ds:[bx+2],dx
  pop   ds
  sbb   bx,bx
  and   ax,bx
  mov   [DosError],ax
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>end</b></font><font color="#000080">.



</font><font color="#008000"><i>{***************************************************************************}
{***************************************************************************}

</i></font><font color="#FF0000"><b>Program </b></font>LFN_demo<font color="#000080">;
</font><font color="#008000"><i>{$M 4096,0,0}
{$X+}

</i></font><font color="#FF0000"><b>uses </b></font>LFN<font color="#000080">, </font>strings<font color="#000080">, </font>DOS<font color="#000080">;

</font><font color="#FF0000"><b>type </b></font>string2 <font color="#000080">= </font><font color="#FF0000"><b>string</b></font><font color="#000080">[</font><font color="#800000">2</font><font color="#000080">];

</font><font color="#FF0000"><b>const  </b></font>RootName    <font color="#000080">= </font><font color="#800000">'C:\'</font><font color="#000080">;
       </font>TempDirName <font color="#000080">= </font><font color="#800000">'Temporary Directory'</font><font color="#000080">;
       </font>TempFile0   <font color="#000080">= </font><font color="#800000">'temp$$$$.tmp'</font><font color="#000080">;
       </font>TempFile1   <font color="#000080">= </font><font color="#800000">'Temporary File.tmp'</font><font color="#000080">;
       </font>TempFile2   <font color="#000080">= </font><font color="#800000">'Another Temporary File.tmp'</font><font color="#000080">;
       </font>TempFile3   <font color="#000080">= </font><font color="#800000">'Yet another temporary file.tmp'</font><font color="#000080">;

</font><font color="#FF0000"><b>var </b></font>Buf        <font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">1023</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>char<font color="#000080">;
    </font>W1<font color="#000080">, </font>W2<font color="#000080">, </font>W3 <font color="#000080">: </font>word<font color="#000080">;
    </font>f          <font color="#000080">: </font>text<font color="#000080">;
    </font>SRec       <font color="#000080">: </font>LSearchRec<font color="#000080">;
    </font>DT         <font color="#000080">: </font>DateTime<font color="#000080">;
    </font>LN<font color="#000080">, </font>SN     <font color="#000080">: </font>Pchar<font color="#000080">;
    </font>size       <font color="#000080">: </font>LongInt<font color="#000080">;
    </font>PDT        <font color="#000080">: </font>LongInt<font color="#000080">;  </font><font color="#008000"><i>{ Packed-format file date/time }


</i></font><font color="#FF0000"><b>function </b></font>Str0<font color="#000080">(</font>B<font color="#000080">: </font>byte<font color="#000080">): </font>string2<font color="#000080">;  </font><font color="#008000"><i>{ Put a 0 in front of numbers &lt;10 }
</i></font><font color="#FF0000"><b>begin
   </b></font>Str0<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">] := </font><font color="#800000">#2</font><font color="#000080">;
   </font>Str0<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">] := </font>char<font color="#000080">(</font>B <font color="#FF0000"><b>div </b></font><font color="#800000">10 </font><font color="#000080">+ </font><font color="#800000">48</font><font color="#000080">);
   </font>Str0<font color="#000080">[</font><font color="#800000">2</font><font color="#000080">] := </font>char<font color="#000080">(</font>B <font color="#FF0000"><b>mod </b></font><font color="#800000">10 </font><font color="#000080">+ </font><font color="#800000">48</font><font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>begin </b></font><font color="#008000"><i>{ Main }
    </i></font>writeln<font color="#000080">;
    </font>writeln<font color="#000080">;
    </font><font color="#FF0000"><b>if </b></font>LFileSystemInfo<font color="#000080">(</font>RootName<font color="#000080">, </font>Buf<font color="#000080">, </font><font color="#800000">32</font><font color="#000080">, </font>W1<font color="#000080">, </font>W2<font color="#000080">, </font>W3<font color="#000080">) &lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then
       begin
          </b></font>writeln<font color="#000080">(</font><font color="#800000">'Long names not supported!'</font><font color="#000080">);
          </font>halt
       <font color="#FF0000"><b>end</b></font><font color="#000080">;

    </font><font color="#FF0000"><b>if </b></font>Buf<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">] = </font><font color="#800000">#0 </font><font color="#FF0000"><b>then                         </b></font><font color="#008000"><i>{ This extra check is necessary    }
       </i></font><font color="#FF0000"><b>begin                                    </b></font><font color="#008000"><i>{ if you run the demo from the IDE }
          </i></font>writeln<font color="#000080">(</font><font color="#800000">'Long names not supported!'</font><font color="#000080">); </font><font color="#008000"><i>{ under MS-DOS v6.22               }
          </i></font>halt                                  <font color="#008000"><i>{ I don't know why.                }
       </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

    </font>writeln<font color="#000080">(</font><font color="#800000">'File System name: '</font><font color="#000080">, </font>Buf<font color="#000080">, </font><font color="#800000">'   Max Filename Len: '</font><font color="#000080">, </font>W2<font color="#000080">,
            </font><font color="#800000">'   Max Path Len: '</font><font color="#000080">, </font>W3<font color="#000080">);
    </font>writeln<font color="#000080">(</font><font color="#800000">'Flags:'</font><font color="#000080">);
    </font>writeln<font color="#000080">(</font><font color="#800000">'   Searches are case sensitive = '</font><font color="#000080">, </font>W1 <font color="#FF0000"><b>and </b></font><font color="#800000">1 </font><font color="#000080">= </font><font color="#800000">1</font><font color="#000080">);
    </font>writeln<font color="#000080">(</font><font color="#800000">'   Preserves case in directory entries = '</font><font color="#000080">, </font>W1 <font color="#FF0000"><b>and </b></font><font color="#800000">2 </font><font color="#000080">= </font><font color="#800000">2</font><font color="#000080">);
    </font>writeln<font color="#000080">(</font><font color="#800000">'   Uses Unicode chars for names = '</font><font color="#000080">, </font>W1 <font color="#FF0000"><b>and </b></font><font color="#800000">4 </font><font color="#000080">= </font><font color="#800000">4</font><font color="#000080">);
    </font>writeln<font color="#000080">(</font><font color="#800000">'   Support LFN functions = '</font><font color="#000080">, </font>W1 <font color="#FF0000"><b>and </b></font><font color="#800000">$4000 </font><font color="#000080">= </font><font color="#800000">$4000</font><font color="#000080">);
    </font>writeln<font color="#000080">(</font><font color="#800000">'   Volume is compressed = '</font><font color="#000080">, </font>W1 <font color="#FF0000"><b>and </b></font><font color="#800000">$8000 </font><font color="#000080">= </font><font color="#800000">$8000</font><font color="#000080">);
    </font>writeln<font color="#000080">(</font><font color="#800000">'   Reserved fields = '</font><font color="#000080">, </font>W1 <font color="#FF0000"><b>and </b></font><font color="#800000">$3FF8</font><font color="#000080">);

    </font>writeln<font color="#000080">;
    </font>writeln<font color="#000080">(</font><font color="#800000">'Press ENTER to continue'</font><font color="#000080">);
    </font>readln<font color="#000080">;

    </font>writeln<font color="#000080">(</font><font color="#800000">'Creating temporary directory.'</font><font color="#000080">);
    </font>LMkDir<font color="#000080">(</font>TempDirName<font color="#000080">);
    </font>writeln<font color="#000080">(</font><font color="#800000">'Changing default directory.'</font><font color="#000080">);
    </font>LChDir<font color="#000080">(</font>TempDirName<font color="#000080">);
    </font>write<font color="#000080">(</font><font color="#800000">'Default directory is now  '</font><font color="#000080">);
    </font>LGetDir<font color="#000080">(</font><font color="#800000">0</font><font color="#000080">, </font>Buf<font color="#000080">);
    </font>writeln<font color="#000080">(</font>Buf<font color="#000080">);

    </font>writeln<font color="#000080">;
    </font>writeln<font color="#000080">(</font><font color="#800000">'Creating temporary file #1.'</font><font color="#000080">);
    </font>assign<font color="#000080">(</font>f<font color="#000080">, </font>TempFile0<font color="#000080">);
    </font>rewrite<font color="#000080">(</font>f<font color="#000080">);
    </font>writeln<font color="#000080">(</font>f<font color="#000080">, </font>TempFile1<font color="#000080">);
    </font>close<font color="#000080">(</font>f<font color="#000080">);
    </font>writeln<font color="#000080">(</font><font color="#800000">'Renaming file #1 to long name.'</font><font color="#000080">);
    </font>LRename<font color="#000080">(</font>TempFile0<font color="#000080">, </font>TempFile1<font color="#000080">);

    </font>writeln<font color="#000080">(</font><font color="#800000">'Creating temporary file #2.'</font><font color="#000080">);
    </font>rewrite<font color="#000080">(</font>f<font color="#000080">);
    </font>writeln<font color="#000080">(</font>f<font color="#000080">, </font>TempFile2<font color="#000080">);
    </font>close<font color="#000080">(</font>f<font color="#000080">);
    </font>writeln<font color="#000080">(</font><font color="#800000">'Renaming file #2 to long name.'</font><font color="#000080">);
    </font>LRename<font color="#000080">(</font>TempFile0<font color="#000080">, </font>TempFile2<font color="#000080">);

    </font>writeln<font color="#000080">(</font><font color="#800000">'Creating temporary file #3.'</font><font color="#000080">);
    </font>rewrite<font color="#000080">(</font>f<font color="#000080">);
    </font>writeln<font color="#000080">(</font>f<font color="#000080">, </font>TempFile3<font color="#000080">);
    </font>close<font color="#000080">(</font>f<font color="#000080">);
    </font>writeln<font color="#000080">(</font><font color="#800000">'Renaming file #3 to long name.'</font><font color="#000080">);
    </font>LRename<font color="#000080">(</font>TempFile0<font color="#000080">, </font>TempFile3<font color="#000080">);

    </font>writeln<font color="#000080">;
    </font>writeln<font color="#000080">;
    </font>writeln<font color="#000080">(</font><font color="#800000">'Directory of '</font><font color="#000080">, </font>Buf<font color="#000080">);
    </font>writeln<font color="#000080">;
    </font>LFindFirst<font color="#000080">(</font><font color="#800000">'*'</font><font color="#000080">, </font>AnyFile<font color="#000080">, </font>SRec<font color="#000080">);
    </font><font color="#FF0000"><b>while </b></font>DosError <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>do
       begin
          </b></font>LUnpackTime<font color="#000080">(</font>SRec<font color="#000080">.</font>LastModTime<font color="#000080">, </font>DT<font color="#000080">);
          </font><font color="#FF0000"><b>if </b></font>SRec<font color="#000080">.</font>ShortName<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">] = </font><font color="#800000">#0 </font><font color="#FF0000"><b>then
             begin
                </b></font>SN <font color="#000080">:= @</font>SRec<font color="#000080">.</font>name<font color="#000080">;
                </font>LN <font color="#000080">:= </font><font color="#FF0000"><b>nil
             end
          else
             begin
                </b></font>SN <font color="#000080">:= @</font>SRec<font color="#000080">.</font>shortname<font color="#000080">;
                </font>LN <font color="#000080">:= @</font>SRec<font color="#000080">.</font>name
             <font color="#FF0000"><b>end</b></font><font color="#000080">;
          </font><font color="#FF0000"><b>with </b></font>DT <font color="#FF0000"><b>do                              </b></font><font color="#008000"><i>{ Italian-style output }
             </i></font>WriteLn<font color="#000080">(</font>SN<font color="#000080">, </font><font color="#800000">''</font><font color="#000080">:</font><font color="#800000">13</font><font color="#000080">-</font>StrLen<font color="#000080">(</font>SN<font color="#000080">), </font>SRec<font color="#000080">.</font>LoSize<font color="#000080">:</font><font color="#800000">9</font><font color="#000080">, </font><font color="#800000">' '</font><font color="#000080">,
                     </font>Day<font color="#000080">:</font><font color="#800000">3</font><font color="#000080">, </font><font color="#800000">'/'</font><font color="#000080">, </font>Str0<font color="#000080">(</font>Month<font color="#000080">), </font><font color="#800000">'/'</font><font color="#000080">, </font>Year<font color="#000080">, </font><font color="#800000">' '</font><font color="#000080">,
                     </font>Hour<font color="#000080">:</font><font color="#800000">2</font><font color="#000080">, </font><font color="#800000">'.'</font><font color="#000080">, </font>Str0<font color="#000080">(</font>Min<font color="#000080">), </font><font color="#800000">' '</font><font color="#000080">, </font>LN<font color="#000080">);
          </font>LFindNext<font color="#000080">(</font>SRec<font color="#000080">)
       </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font>LFindClose<font color="#000080">(</font>SRec<font color="#000080">);

    </font>writeln<font color="#000080">;
    </font>writeln<font color="#000080">(</font><font color="#800000">'Press ENTER to continue'</font><font color="#000080">);
    </font>readln<font color="#000080">;

    </font>writeln<font color="#000080">(</font><font color="#800000">'True name of '</font><font color="#000080">, </font>SN<font color="#000080">, </font><font color="#800000">' ='</font><font color="#000080">);
    </font>LGetTrueName<font color="#000080">(</font>SN<font color="#000080">, </font>Buf<font color="#000080">);
    </font>writeln<font color="#000080">(</font><font color="#800000">'   '</font><font color="#000080">, </font>Buf<font color="#000080">);
    </font>writeln<font color="#000080">(</font><font color="#800000">'Short name of '</font><font color="#000080">, </font>Tempfile3<font color="#000080">, </font><font color="#800000">' ='</font><font color="#000080">);
    </font>LGetShortName<font color="#000080">(</font>TempFile3<font color="#000080">, </font>Buf<font color="#000080">);
    </font>writeln<font color="#000080">(</font><font color="#800000">'   '</font><font color="#000080">, </font>Buf<font color="#000080">);
    </font>writeln<font color="#000080">(</font><font color="#800000">'Long name of '</font><font color="#000080">, </font>Buf<font color="#000080">, </font><font color="#800000">' ='</font><font color="#000080">);
    </font>LGetLongName<font color="#000080">(</font>Buf<font color="#000080">, </font>Buf<font color="#000080">);
    </font>writeln<font color="#000080">(</font><font color="#800000">'   '</font><font color="#000080">, </font>Buf<font color="#000080">);

    </font><font color="#FF0000"><b>if </b></font>LGetPhysicalFSize<font color="#000080">(</font>SN<font color="#000080">, </font>size<font color="#000080">) &lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then
       </b></font>writeln<font color="#000080">(</font><font color="#800000">'Physical size of '</font><font color="#000080">, </font>SN<font color="#000080">, </font><font color="#800000">' = '</font><font color="#000080">, </font>size<font color="#000080">, </font><font color="#800000">' bytes.'</font><font color="#000080">);

    </font>writeln<font color="#000080">;
    </font><font color="#FF0000"><b>with </b></font>DT <font color="#FF0000"><b>do
       begin
          </b></font>Day<font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;
          </font>Month <font color="#000080">:= </font><font color="#800000">2</font><font color="#000080">;
          </font>Year <font color="#000080">:= </font><font color="#800000">1997</font><font color="#000080">;
          </font>Hour <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
          </font>Min <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;
          </font>Sec <font color="#000080">:= </font><font color="#800000">2
       </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font>PackTime<font color="#000080">(</font>DT<font color="#000080">, </font>PDT<font color="#000080">);
    </font>LSetCreationFTime<font color="#000080">(</font>TempFile1<font color="#000080">, </font>PDT<font color="#000080">);
    </font>write<font color="#000080">(</font><font color="#800000">'Creation date/time of '</font><font color="#000080">, </font>TempFile1<font color="#000080">, </font><font color="#800000">' is now  '</font><font color="#000080">);
    </font>LGetCreationFTime<font color="#000080">(</font>TempFile1<font color="#000080">, </font>PDT<font color="#000080">);
    </font>Unpacktime<font color="#000080">(</font>PDT<font color="#000080">, </font>DT<font color="#000080">);
    </font><font color="#FF0000"><b>with </b></font>DT <font color="#FF0000"><b>do                              </b></font><font color="#008000"><i>{ Italian-style output }
       </i></font>WriteLn<font color="#000080">(</font>Day<font color="#000080">:</font><font color="#800000">3</font><font color="#000080">, </font><font color="#800000">'/'</font><font color="#000080">, </font>Str0<font color="#000080">(</font>Month<font color="#000080">), </font><font color="#800000">'/'</font><font color="#000080">, </font>Year<font color="#000080">, </font><font color="#800000">' '</font><font color="#000080">,
               </font>Hour<font color="#000080">:</font><font color="#800000">2</font><font color="#000080">, </font><font color="#800000">'.'</font><font color="#000080">, </font>Str0<font color="#000080">(</font>Min<font color="#000080">), </font><font color="#800000">'.'</font><font color="#000080">, </font>Str0<font color="#000080">(</font>sec<font color="#000080">));

    </font><font color="#FF0000"><b>with </b></font>DT <font color="#FF0000"><b>do
       begin
          </b></font>Day<font color="#000080">:= </font><font color="#800000">3</font><font color="#000080">;
          </font>Month <font color="#000080">:= </font><font color="#800000">4</font><font color="#000080">;
          </font>Year <font color="#000080">:= </font><font color="#800000">1997</font><font color="#000080">;
          </font>Hour <font color="#000080">:= </font><font color="#800000">4</font><font color="#000080">;
          </font>Min <font color="#000080">:= </font><font color="#800000">5</font><font color="#000080">;
          </font>Sec <font color="#000080">:= </font><font color="#800000">6
       </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font>PackTime<font color="#000080">(</font>DT<font color="#000080">, </font>PDT<font color="#000080">);
    </font>LSetFTime<font color="#000080">(</font>TempFile1<font color="#000080">, </font>PDT<font color="#000080">);
    </font>write<font color="#000080">(</font><font color="#800000">'Last-write date/time of '</font><font color="#000080">, </font>TempFile1<font color="#000080">, </font><font color="#800000">' is now'</font><font color="#000080">);
    </font>LGetFTime<font color="#000080">(</font>TempFile1<font color="#000080">, </font>PDT<font color="#000080">);
    </font>Unpacktime<font color="#000080">(</font>PDT<font color="#000080">, </font>DT<font color="#000080">);
    </font><font color="#FF0000"><b>with </b></font>DT <font color="#FF0000"><b>do                              </b></font><font color="#008000"><i>{ Italian-style output }
       </i></font>WriteLn<font color="#000080">(</font>Day<font color="#000080">:</font><font color="#800000">3</font><font color="#000080">, </font><font color="#800000">'/'</font><font color="#000080">, </font>Str0<font color="#000080">(</font>Month<font color="#000080">), </font><font color="#800000">'/'</font><font color="#000080">, </font>Year<font color="#000080">, </font><font color="#800000">' '</font><font color="#000080">,
               </font>Hour<font color="#000080">:</font><font color="#800000">2</font><font color="#000080">, </font><font color="#800000">'.'</font><font color="#000080">, </font>Str0<font color="#000080">(</font>Min<font color="#000080">), </font><font color="#800000">'.'</font><font color="#000080">, </font>Str0<font color="#000080">(</font>sec<font color="#000080">));

    </font><font color="#FF0000"><b>with </b></font>DT <font color="#FF0000"><b>do
       begin
          </b></font>Day<font color="#000080">:= </font><font color="#800000">5</font><font color="#000080">;
          </font>Month <font color="#000080">:= </font><font color="#800000">6</font><font color="#000080">;
          </font>Year <font color="#000080">:= </font><font color="#800000">1997</font><font color="#000080">;
       </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font>PackTime<font color="#000080">(</font>DT<font color="#000080">, </font>PDT<font color="#000080">);
    </font>LSetLastAccessFDate<font color="#000080">(</font>TempFile1<font color="#000080">, </font>PDT<font color="#000080">);
    </font>write<font color="#000080">(</font><font color="#800000">'Last-access date of '</font><font color="#000080">, </font>TempFile1<font color="#000080">, </font><font color="#800000">' is now    '</font><font color="#000080">);
    </font>LGetLastAccessFDate<font color="#000080">(</font>TempFile1<font color="#000080">, </font>PDT<font color="#000080">);
    </font>Unpacktime<font color="#000080">(</font>PDT<font color="#000080">, </font>DT<font color="#000080">);
    </font><font color="#FF0000"><b>with </b></font>DT <font color="#FF0000"><b>do                              </b></font><font color="#008000"><i>{ Italian-style output }
       </i></font>WriteLn<font color="#000080">(</font>Day<font color="#000080">:</font><font color="#800000">3</font><font color="#000080">, </font><font color="#800000">'/'</font><font color="#000080">, </font>Str0<font color="#000080">(</font>Month<font color="#000080">), </font><font color="#800000">'/'</font><font color="#000080">, </font>Year<font color="#000080">);

    </font>writeln<font color="#000080">;
    </font>writeln<font color="#000080">(</font><font color="#800000">'Setting the hidden file-attribute of '</font><font color="#000080">, </font>TempFile1<font color="#000080">);
    </font>LSetFAttr<font color="#000080">(</font>TempFile1<font color="#000080">, </font>archive <font color="#000080">+ </font>hidden<font color="#000080">);
    </font>write<font color="#000080">(</font><font color="#800000">'Checking... '</font><font color="#000080">);
    </font>LGetFAttr<font color="#000080">(</font>TempFile1<font color="#000080">, </font>W1<font color="#000080">);
    </font><font color="#FF0000"><b>if </b></font>W1 <font color="#000080">= </font>archive <font color="#000080">+ </font>hidden <font color="#FF0000"><b>then </b></font>writeln<font color="#000080">(</font><font color="#800000">'OK'</font><font color="#000080">)
    </font><font color="#FF0000"><b>else
       begin
          </b></font>writeln<font color="#000080">(</font><font color="#800000">'Error!'</font><font color="#000080">);
          </font>halt
       <font color="#FF0000"><b>end</b></font><font color="#000080">;

    </font>writeln<font color="#000080">;
    </font>writeln<font color="#000080">(</font><font color="#800000">'Deleting '</font><font color="#000080">, </font>TempFile1<font color="#000080">);
    </font>LErase<font color="#000080">(</font>TempFile1<font color="#000080">);

    </font>writeln<font color="#000080">(</font><font color="#800000">'Deleting *.tmp'</font><font color="#000080">);
    </font>LMultiErase<font color="#000080">(</font><font color="#800000">'*.tmp'</font><font color="#000080">, </font>Archive<font color="#000080">, </font>Archive<font color="#000080">);
    </font>LChDir<font color="#000080">(</font><font color="#800000">'..'</font><font color="#000080">);
    </font>writeln<font color="#000080">(</font><font color="#800000">'Deleting temporary directory.'</font><font color="#000080">);
    </font>LRmDir<font color="#000080">(</font>TempDirName<font color="#000080">);

    </font>writeln<font color="#000080">;
    </font>writeln<font color="#000080">(</font><font color="#800000">'Done.'</font><font color="#000080">)
</font><font color="#FF0000"><b>end</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to FILES SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0109.PAS">Original</a><b>]</b></p></body>
</html>
