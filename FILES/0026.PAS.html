<html>
<head><title> "File spliting" by MICHAEL REECE</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to FILES SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0026.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
MICHAEL REECE

&gt; Hi!  I was wondering.  How would you in Turbo Pascal be able to split a
&gt; single File into two.  I want it to split it to a precise Byte For both
&gt; Files. I want to be able to combine to Files together and split it to its
&gt; original sizes and still be able to work (that no codes are missing etc.).

The following is kludgy and only semi tested, but may help you get started.
It's an old little thing I wrote to split large Files to put on a floppy, and
then put it back together again.
}

(* usage:  split &lt;Filename&gt; &lt;new-name-for-second-half&gt;
   ex: split nodelist.zip nodelist.zi2
*)
</i></font><font color="#FF0000"><b>Program </b></font>Split<font color="#000080">;

</font><font color="#FF0000"><b>Const
  </b></font>MaxBuffSize <font color="#000080">= </font><font color="#800000">61140</font><font color="#000080">;

</font><font color="#FF0000"><b>Type
  </b></font>BuffType <font color="#000080">= </font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font>MaxBuffSize<font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Byte<font color="#000080">;

</font><font color="#FF0000"><b>Var
  </b></font>F1<font color="#000080">, </font>F2   <font color="#000080">: </font><font color="#FF0000"><b>File</b></font><font color="#000080">;
  </font>Mid      <font color="#000080">: </font>LongInt<font color="#000080">;
  </font>Buffer   <font color="#000080">: ^</font>BuffType<font color="#000080">;
  </font>BuffSize <font color="#000080">: </font>LongInt<font color="#000080">;
  </font>NumRead<font color="#000080">,
  </font>NumWrite <font color="#000080">: </font>Word<font color="#000080">;

</font><font color="#FF0000"><b>begin
  </b></font>Writeln<font color="#000080">(</font><font color="#800000">'Splitting File &quot;'</font><font color="#000080">, </font>ParamStr<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">), </font><font color="#800000">'&quot;'</font><font color="#000080">);
  </font>Assign<font color="#000080">(</font>F1<font color="#000080">, </font>ParamStr<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">));
  </font>Reset<font color="#000080">(</font>F1<font color="#000080">, </font><font color="#800000">1</font><font color="#000080">);
  </font>Mid<font color="#000080">:=</font>FileSize<font color="#000080">(</font>F1<font color="#000080">) </font><font color="#FF0000"><b>div </b></font><font color="#800000">2</font><font color="#000080">;                     </font><font color="#008000"><i>{ calculate midpoint }
  </i></font>Writeln<font color="#000080">(</font><font color="#800000">'  Original size: '</font><font color="#000080">, </font>FileSize<font color="#000080">(</font>F1<font color="#000080">));
  </font>Writeln<font color="#000080">(</font><font color="#800000">'  File midpoint: '</font><font color="#000080">, </font>Mid<font color="#000080">);
  </font>Writeln<font color="#000080">(</font><font color="#800000">'Creating File &quot;'</font><font color="#000080">, </font>ParamStr<font color="#000080">(</font><font color="#800000">2</font><font color="#000080">), </font><font color="#800000">'&quot;'</font><font color="#000080">);
  </font>Assign<font color="#000080">(</font>F2<font color="#000080">, </font>ParamStr<font color="#000080">(</font><font color="#800000">2</font><font color="#000080">));
  </font>ReWrite<font color="#000080">(</font>F2<font color="#000080">, </font><font color="#800000">1</font><font color="#000080">);
  </font>Writeln<font color="#000080">(</font><font color="#800000">'Memory available: '</font><font color="#000080">, </font>MaxAvail<font color="#000080">);    </font><font color="#008000"><i>{ allocate max buffer }
  </i></font>BuffSize<font color="#000080">:=</font>MaxAvail<font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>BuffSize <font color="#000080">&gt; </font>MaxBuffSize<font color="#000080">) </font><font color="#FF0000"><b>then
    </b></font>BuffSize<font color="#000080">:=</font>MaxBuffSize<font color="#000080">;
  </font>GetMem<font color="#000080">(</font>Buffer<font color="#000080">, </font>BuffSize<font color="#000080">);
  </font>Writeln<font color="#000080">(</font><font color="#800000">'  Buffer size: '</font><font color="#000080">, </font>BuffSize<font color="#000080">);
  </font>Writeln<font color="#000080">(</font><font color="#800000">'Seeking to midpoint'</font><font color="#000080">);
  </font>Seek<font color="#000080">(</font>F1<font color="#000080">, </font>Mid<font color="#000080">);
  </font>Writeln<font color="#000080">(</font><font color="#800000">'  Copying remainder of File'</font><font color="#000080">);
  </font><font color="#FF0000"><b>While </b></font><font color="#000080">(</font><font color="#FF0000"><b>not </b></font>Eof<font color="#000080">(</font>F1<font color="#000080">)) </font><font color="#FF0000"><b>do
  begin
    </b></font>BlockRead<font color="#000080">(</font>F1<font color="#000080">, </font>Buffer<font color="#000080">^, </font>BuffSize<font color="#000080">, </font>NumRead<font color="#000080">);
    </font>BlockWrite<font color="#000080">(</font>F2<font color="#000080">, </font>Buffer<font color="#000080">^, </font>NumRead<font color="#000080">, </font>NumWrite<font color="#000080">);
    </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>NumRead <font color="#000080">&lt;&gt; </font>NumWrite<font color="#000080">) </font><font color="#FF0000"><b>then
    begin
      </b></font>Writeln<font color="#000080">(</font><font color="#800000">'Error in copy'</font><font color="#000080">);
      </font>Halt<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>Writeln<font color="#000080">(</font><font color="#800000">'Seeking to midpoint'</font><font color="#000080">);
  </font>Seek<font color="#000080">(</font>F1<font color="#000080">, </font>Mid<font color="#000080">);
  </font>Writeln<font color="#000080">(</font><font color="#800000">'  Truncating File'</font><font color="#000080">);
  </font>Truncate<font color="#000080">(</font>F1<font color="#000080">);
  </font>Writeln<font color="#000080">(</font><font color="#800000">'Closing Files'</font><font color="#000080">);
  </font>Close<font color="#000080">(</font>F2<font color="#000080">);
  </font>Close<font color="#000080">(</font>F1<font color="#000080">);
  </font>Writeln<font color="#000080">(</font><font color="#800000">'Done.'</font><font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">.

</font><font color="#008000"><i>{ That one splits a File in half. }

(* usage:  splice &lt;Filename&gt; &lt;name-of-second-half&gt;
   ex: split nodelist.zip nodelist.zi2
   this will append/splice nodelist.zi1 to nodelist.zip
*)
</i></font><font color="#FF0000"><b>Program </b></font>Splice<font color="#000080">;

</font><font color="#FF0000"><b>Const
  </b></font>MaxBuffSize <font color="#000080">= </font><font color="#800000">61140</font><font color="#000080">;

</font><font color="#FF0000"><b>Type
  </b></font>BuffType <font color="#000080">= </font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font>MaxBuffSize<font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Byte<font color="#000080">;

</font><font color="#FF0000"><b>Var
  </b></font>F1<font color="#000080">, </font>F2   <font color="#000080">: </font><font color="#FF0000"><b>File</b></font><font color="#000080">;
  </font>Buffer   <font color="#000080">: ^</font>BuffType<font color="#000080">;
  </font>BuffSize <font color="#000080">: </font>LongInt<font color="#000080">;
  </font>NumRead<font color="#000080">,
  </font>NumWrite <font color="#000080">: </font>Word<font color="#000080">;

</font><font color="#FF0000"><b>begin
  </b></font>Writeln<font color="#000080">(</font><font color="#800000">'Splicing File &quot;'</font><font color="#000080">, </font>ParamStr<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">), </font><font color="#800000">'&quot;'</font><font color="#000080">);
  </font>Assign<font color="#000080">(</font>F1<font color="#000080">, </font>ParamStr<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">));
  </font>Reset<font color="#000080">(</font>F1<font color="#000080">, </font><font color="#800000">1</font><font color="#000080">);
  </font>Writeln<font color="#000080">(</font><font color="#800000">'  Original size: '</font><font color="#000080">, </font>FileSize<font color="#000080">(</font>F1<font color="#000080">));
  </font>Writeln<font color="#000080">(</font><font color="#800000">'Appending File &quot;'</font><font color="#000080">, </font>ParamStr<font color="#000080">(</font><font color="#800000">2</font><font color="#000080">), </font><font color="#800000">'&quot;'</font><font color="#000080">);
  </font>Assign<font color="#000080">(</font>F2<font color="#000080">, </font>ParamStr<font color="#000080">(</font><font color="#800000">2</font><font color="#000080">));
  </font>Reset<font color="#000080">(</font>F2<font color="#000080">, </font><font color="#800000">1</font><font color="#000080">);
  </font>Writeln<font color="#000080">(</font><font color="#800000">'  Original size: '</font><font color="#000080">, </font>FileSize<font color="#000080">(</font>F1<font color="#000080">));
  </font>Writeln<font color="#000080">(</font><font color="#800000">'Memory available: '</font><font color="#000080">, </font>MaxAvail<font color="#000080">);    </font><font color="#008000"><i>{ allocate max buffer }
  </i></font>BuffSize<font color="#000080">:=</font>MaxAvail<font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>BuffSize <font color="#000080">&gt; </font>MaxBuffSize<font color="#000080">) </font><font color="#FF0000"><b>then
    </b></font>BuffSize<font color="#000080">:=</font>MaxBuffSize<font color="#000080">;
  </font>GetMem<font color="#000080">(</font>Buffer<font color="#000080">, </font>BuffSize<font color="#000080">);
  </font>Writeln<font color="#000080">(</font><font color="#800000">'  Buffer size: '</font><font color="#000080">, </font>BuffSize<font color="#000080">);
  </font>Writeln<font color="#000080">(</font><font color="#800000">'Seeking to end'</font><font color="#000080">);
  </font>Seek<font color="#000080">(</font>F1<font color="#000080">, </font>FileSize<font color="#000080">(</font>F1<font color="#000080">));
  </font>Writeln<font color="#000080">(</font><font color="#800000">'  Copying File'</font><font color="#000080">);
  </font><font color="#FF0000"><b>While </b></font><font color="#000080">(</font><font color="#FF0000"><b>not </b></font>Eof<font color="#000080">(</font>F2<font color="#000080">)) </font><font color="#FF0000"><b>do
  begin
    </b></font>BlockRead<font color="#000080">(</font>F2<font color="#000080">, </font>Buffer<font color="#000080">^, </font>BuffSize<font color="#000080">, </font>NumRead<font color="#000080">);
    </font>BlockWrite<font color="#000080">(</font>F1<font color="#000080">, </font>Buffer<font color="#000080">^, </font>NumRead<font color="#000080">, </font>NumWrite<font color="#000080">);
    </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>NumRead <font color="#000080">&lt;&gt; </font>NumWrite<font color="#000080">) </font><font color="#FF0000"><b>then
    begin
      </b></font>Writeln<font color="#000080">(</font><font color="#800000">'Error in copy'</font><font color="#000080">);
      </font>Halt<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>Writeln<font color="#000080">(</font><font color="#800000">'Closing Files'</font><font color="#000080">);
  </font>Writeln<font color="#000080">(</font><font color="#800000">'Done.'</font><font color="#000080">);
  </font>Close<font color="#000080">(</font>F2<font color="#000080">);
  </font>Close<font color="#000080">(</font>F1<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">.

</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to FILES SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0026.PAS">Original</a><b>]</b></p></body>
</html>
