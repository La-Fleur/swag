<html>
<head><title> "LOCKFILE.PAS" by SWAG SUPPORT TEAM</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to FILES SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0011.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
&gt; Does anyone have any multi-tasking/File sharing Units (preferably
&gt; With well documented code).  Specifically, I need to Write a Program
&gt; that _may_ be active on one node, and I'd like to open the Files in
&gt; read-only Form, amung other things, so that I can load that in
&gt; multi-node (shared) environment.

}

</i></font><font color="#FF0000"><b>Function </b></font>LockFile<font color="#000080">(</font>f <font color="#000080">: </font><font color="#FF0000"><b>File</b></font><font color="#000080">) : </font>Boolean<font color="#000080">;  </font><font color="#008000"><i>{ returns True if lock achieved. }
                                        { if not, File locked by other   }
                                        { application running.           }

</i></font><font color="#FF0000"><b>Var
  </b></font>r <font color="#000080">: </font>Registers<font color="#000080">;   </font><font color="#008000"><i>{Defined in Dos Unit}
  </i></font>l <font color="#000080">: </font>LongInt<font color="#000080">;

</font><font color="#FF0000"><b>begin
  </b></font>r<font color="#000080">.</font>ah <font color="#000080">:= </font><font color="#800000">$5C</font><font color="#000080">;
  </font>r<font color="#000080">.</font>al <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font>Move<font color="#000080">(</font>f<font color="#000080">,</font>r<font color="#000080">.</font>bx<font color="#000080">,</font><font color="#800000">2</font><font color="#000080">);   </font><font color="#008000"><i>{Places File handle into BX register.}
  </i></font>r<font color="#000080">.</font>cx <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;  </font><font color="#008000"><i>{Most significant, region offset (0 - beginning of File)}
  </i></font>r<font color="#000080">.</font>dx <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;  </font><font color="#008000"><i>{Least significant, region offset (0 - beginning of File)}
  </i></font>l <font color="#000080">:= </font>FileSize<font color="#000080">(</font>f<font color="#000080">);         </font><font color="#008000"><i>{ Get File size }
  </i></font>r<font color="#000080">.</font>di <font color="#000080">:= </font>l <font color="#FF0000"><b>and </b></font><font color="#800000">$ffff</font><font color="#000080">;      </font><font color="#008000"><i>{ Devide File size to most/least parts }
  </i></font>r<font color="#000080">.</font>si <font color="#000080">:= </font>l <font color="#FF0000"><b>div </b></font><font color="#800000">$10000</font><font color="#000080">;     </font><font color="#008000"><i>{ For locking the entire File.         }
  </i></font>MsDos<font color="#000080">(</font>r<font color="#000080">);
  </font>LockFile <font color="#000080">:= ((</font>r<font color="#000080">.</font>flags <font color="#FF0000"><b>and </b></font><font color="#800000">1</font><font color="#000080">)=</font><font color="#800000">0</font><font color="#000080">);
  </font><font color="#008000"><i>{ if carry flag is set File locking failed, reason in AX }
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{
BTW: to unlock it use the same routine, but change the  r.al to 1.

if this routine fails, it means that the File is locked in the other
task, and cannot be used.
}</i></font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to FILES SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0011.PAS">Original</a><b>]</b></p></body>
</html>
