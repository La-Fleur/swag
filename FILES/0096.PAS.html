<html>
<head><title> "File disk storage and retrieval program" by JACK NEELY</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to FILES SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0096.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#FF0000"><b>program </b></font>CAT<font color="#000080">;

</font><font color="#008000"><i>{$I-}

</i></font><font color="#FF0000"><b>uses
   </b></font>dos<font color="#000080">,
   </font>files<font color="#000080">, </font><font color="#008000"><i>{ see end for this unit }
   </i></font>crt<font color="#000080">;

</font><font color="#FF0000"><b>type
   </b></font>arraybuf <font color="#000080">= </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">65535</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">;
   </font>buffer <font color="#000080">= ^</font>arraybuf<font color="#000080">;
   </font>chksum <font color="#000080">= </font><font color="#FF0000"><b>file of </b></font>searchrec<font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>error<font color="#000080">(</font>mess<font color="#000080">:</font><font color="#FF0000"><b>string</b></font><font color="#000080">);
</font><font color="#FF0000"><b>var
   </b></font>code<font color="#000080">:</font>integer<font color="#000080">;
</font><font color="#FF0000"><b>begin
   </b></font>code<font color="#000080">:= </font>ioresult<font color="#000080">;
   </font>writeln<font color="#000080">(</font><font color="#800000">'ERROR:  '</font><font color="#000080">, </font>mess<font color="#000080">);
   </font><font color="#008000"><i>{writeln('ERROR CODE:  ', code);}
   </i></font>halt<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>delete<font color="#000080">(</font>drive<font color="#000080">:</font>char<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>success<font color="#000080">:</font>boolean<font color="#000080">);
   </font><font color="#FF0000"><b>procedure </b></font>recurse<font color="#000080">(</font>tree<font color="#000080">:</font>directory_tree<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>success<font color="#000080">:</font>boolean<font color="#000080">);
   </font><font color="#FF0000"><b>var
      </b></font>info<font color="#000080">:</font>searchrec<font color="#000080">;
      </font>buffer<font color="#000080">:</font>text<font color="#000080">;
      </font>success2<font color="#000080">:</font>boolean<font color="#000080">;
      </font>d<font color="#000080">:</font><font color="#FF0000"><b>string</b></font><font color="#000080">[</font><font color="#800000">79</font><font color="#000080">];
   </font><font color="#FF0000"><b>begin
      if </b></font>tree <font color="#000080">&lt;&gt; </font><font color="#FF0000"><b>nil then begin
      </b></font>success2<font color="#000080">:= </font>true<font color="#000080">;
      </font>d<font color="#000080">:= </font>tree<font color="#000080">^.</font>dir<font color="#000080">;
         </font><font color="#FF0000"><b>begin
            </b></font>recurse<font color="#000080">(</font>tree<font color="#000080">^.</font>lower_dir<font color="#000080">, </font>success2<font color="#000080">);
            </font>tree<font color="#000080">:= </font>tree<font color="#000080">^.</font>next<font color="#000080">;
            </font>success<font color="#000080">:= </font>success <font color="#FF0000"><b>and </b></font>success2<font color="#000080">;
            </font>recurse<font color="#000080">(</font>tree<font color="#000080">, </font>success2<font color="#000080">);
            </font>success<font color="#000080">:= </font>success <font color="#FF0000"><b>and </b></font>success2<font color="#000080">;
         </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font>chdir<font color="#000080">(</font>d<font color="#000080">);
      </font>findfirst<font color="#000080">(</font><font color="#800000">'*.*'</font><font color="#000080">, </font>anyfile<font color="#000080">, </font>info<font color="#000080">);
      </font><font color="#FF0000"><b>while </b></font><font color="#000080">(</font>doserror <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>success<font color="#000080">) </font><font color="#FF0000"><b>do
         begin
            if </b></font><font color="#000080">(</font>info<font color="#000080">.</font>name <font color="#000080">&lt;&gt; </font><font color="#800000">'.'</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>info<font color="#000080">.</font>name <font color="#000080">&lt;&gt; </font><font color="#800000">'..'</font><font color="#000080">) </font><font color="#FF0000"><b>then
               begin
                  </b></font>assign<font color="#000080">(</font>buffer<font color="#000080">, </font>info<font color="#000080">.</font>name<font color="#000080">);
                  </font><font color="#FF0000"><b>case </b></font>info<font color="#000080">.</font>attr <font color="#FF0000"><b>of
                     </b></font><font color="#800000">$10</font><font color="#000080">: </font>rmdir<font color="#000080">(</font>info<font color="#000080">.</font>name<font color="#000080">);
                     </font><font color="#800000">$20</font><font color="#000080">: </font>erase<font color="#000080">(</font>buffer<font color="#000080">);
                  </font><font color="#FF0000"><b>else
                     </b></font>success<font color="#000080">:= </font>false<font color="#000080">;
                  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
               </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
            </font>findnext<font color="#000080">(</font>info<font color="#000080">);
         </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
   </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
   </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>var
   </b></font>tree<font color="#000080">:</font>directory_tree<font color="#000080">;
</font><font color="#FF0000"><b>begin
   </b></font>tree<font color="#000080">:= </font><font color="#FF0000"><b>nil</b></font><font color="#000080">;
   </font>chdir<font color="#000080">(</font>drive<font color="#000080">+</font><font color="#800000">':\'</font><font color="#000080">);
   </font>fill_dirtree<font color="#000080">(</font>drive<font color="#000080">+</font><font color="#800000">':\'</font><font color="#000080">, </font>tree<font color="#000080">);
   </font>success<font color="#000080">:= </font>true<font color="#000080">;
   </font>recurse<font color="#000080">(</font>tree<font color="#000080">, </font>success<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>DriveExist<font color="#000080">(</font>drive<font color="#000080">:</font>char<font color="#000080">):</font>boolean<font color="#000080">;
</font><font color="#FF0000"><b>var
   </b></font>fileinfo<font color="#000080">:</font>searchrec<font color="#000080">;
</font><font color="#FF0000"><b>begin
   </b></font>findfirst<font color="#000080">(</font>drive<font color="#000080">+</font><font color="#800000">':\*.*'</font><font color="#000080">, </font>anyfile<font color="#000080">, </font>fileinfo<font color="#000080">);
   </font><font color="#FF0000"><b>if </b></font>doserror <font color="#000080">= </font><font color="#800000">3 </font><font color="#FF0000"><b>then
      </b></font>driveexist<font color="#000080">:= </font>false
   <font color="#FF0000"><b>else
      </b></font>driveexist<font color="#000080">:= </font>true<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>work<font color="#000080">(</font>max<font color="#000080">,</font>done<font color="#000080">:</font>longint<font color="#000080">);
</font><font color="#FF0000"><b>begin
   </b></font>write<font color="#000080">(</font><font color="#800000">100</font><font color="#000080">*(</font>done<font color="#000080">/</font>max<font color="#000080">):</font><font color="#800000">4</font><font color="#000080">:</font><font color="#800000">1</font><font color="#000080">, </font><font color="#800000">'% complete.'</font><font color="#000080">);
   </font>gotoxy<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">, </font>wherey<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>help<font color="#000080">;
</font><font color="#FF0000"><b>begin
   </b></font>writeln<font color="#000080">(</font><font color="#800000">'The Concatinator   Version 1.0   Copyright 1996 by Jack Neely'</font><font color="#000080">);
   </font>writeln<font color="#000080">(</font><font color="#800000">'A large file disk storage and retrieval program.'</font><font color="#000080">);
   </font>writeln<font color="#000080">;
   </font>writeln<font color="#000080">(</font><font color="#800000">'Usage:   CAT s &lt;storage drive&gt; &lt;filename&gt;'</font><font color="#000080">);
   </font>writeln<font color="#000080">(</font><font color="#800000">'         CAT r &lt;storage dirve&gt; &lt;path&gt;'</font><font color="#000080">);
   </font>writeln<font color="#000080">;
   </font>writeln<font color="#000080">(</font><font color="#800000">'Commands: ''s'' = Store   ''r'' = Retrive'</font><font color="#000080">);
   </font>writeln<font color="#000080">(</font><font color="#800000">'Storage drive must be the disk drive to store or that a large file is'</font><font color="#000080">);
   </font>writeln<font color="#000080">(</font><font color="#800000">'stored apon.  Specify a path where the file will be placed when'</font><font color="#000080">);
   </font>writeln<font color="#000080">(</font><font color="#800000">'retriving a file.  Specify a filemane when storing a large file.'</font><font color="#000080">);
   </font>writeln<font color="#000080">;
   </font>writeln<font color="#000080">(</font><font color="#800000">'You can use this program to store those large files that are larger'</font><font color="#000080">);
   </font>writeln<font color="#000080">(</font><font color="#800000">'than a single disk onto multiple disks.  Anything on the disk prior'</font><font color="#000080">);
   </font>writeln<font color="#000080">(</font><font color="#800000">'to storage will be erased.  A checksum file will also be stored on the'</font><font color="#000080">);
   </font>writeln<font color="#000080">(</font><font color="#800000">'first disk of each set.'</font><font color="#000080">);
   </font>writeln<font color="#000080">;
   </font>writeln<font color="#000080">(</font><font color="#800000">'The author can be reached at hneely@ac.net'</font><font color="#000080">);
   </font>writeln<font color="#000080">;
   </font>halt<font color="#000080">(</font><font color="#800000">0</font><font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>num<font color="#000080">(</font>d<font color="#000080">:</font>char<font color="#000080">):</font>word<font color="#000080">;
</font><font color="#FF0000"><b>begin
   </b></font>num<font color="#000080">:= </font>ord<font color="#000080">(</font>upcase<font color="#000080">(</font>d<font color="#000080">)) - </font><font color="#800000">64</font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>strn<font color="#000080">(</font>a<font color="#000080">:</font>integer<font color="#000080">):</font><font color="#FF0000"><b>string</b></font><font color="#000080">;
</font><font color="#FF0000"><b>var
   </b></font>s<font color="#000080">:</font><font color="#FF0000"><b>string</b></font><font color="#000080">;
   </font>i<font color="#000080">:</font>integer<font color="#000080">;
</font><font color="#FF0000"><b>begin
   </b></font>str<font color="#000080">(</font>a<font color="#000080">, </font>s<font color="#000080">);
   </font><font color="#FF0000"><b>if </b></font>length<font color="#000080">(</font>s<font color="#000080">) &lt; </font><font color="#800000">4 </font><font color="#FF0000"><b>then
      for </b></font>i<font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font><font color="#800000">4 </font><font color="#000080">- </font>length<font color="#000080">(</font>s<font color="#000080">) </font><font color="#FF0000"><b>do
         </b></font>s<font color="#000080">:= </font><font color="#800000">'0' </font><font color="#000080">+ </font>s<font color="#000080">;
   </font>strn<font color="#000080">:= </font>s<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>return<font color="#000080">(</font>s<font color="#000080">:</font><font color="#FF0000"><b>string</b></font><font color="#000080">; </font>b<font color="#000080">:</font>boolean<font color="#000080">):</font>integer<font color="#000080">;
</font><font color="#FF0000"><b>var
   </b></font>str<font color="#000080">:</font><font color="#FF0000"><b>string</b></font><font color="#000080">;
   </font>i<font color="#000080">, </font>c<font color="#000080">:</font>integer<font color="#000080">;
</font><font color="#FF0000"><b>begin
   </b></font>str<font color="#000080">:= </font><font color="#800000">''</font><font color="#000080">;
   </font><font color="#FF0000"><b>if </b></font>b <font color="#FF0000"><b>then
      for </b></font>i<font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font><font color="#800000">4 </font><font color="#FF0000"><b>do
         </b></font>str<font color="#000080">:= </font>str <font color="#000080">+ </font>s<font color="#000080">[</font>i<font color="#000080">]
   </font><font color="#FF0000"><b>else
      for </b></font>i<font color="#000080">:= </font><font color="#800000">5 </font><font color="#FF0000"><b>to </b></font><font color="#800000">8 </font><font color="#FF0000"><b>do
         </b></font>str<font color="#000080">:= </font>str <font color="#000080">+ </font>s<font color="#000080">[</font>i<font color="#000080">];
   </font>val<font color="#000080">(</font>str<font color="#000080">, </font>i<font color="#000080">, </font>c<font color="#000080">);
   </font>return<font color="#000080">:= </font>i<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>store<font color="#000080">(</font>filename<font color="#000080">:</font><font color="#FF0000"><b>string</b></font><font color="#000080">; </font>drive<font color="#000080">:</font>char<font color="#000080">);
</font><font color="#FF0000"><b>var
   </b></font>input<font color="#000080">, </font>output<font color="#000080">:</font><font color="#FF0000"><b>file</b></font><font color="#000080">;
   </font>fileinfo<font color="#000080">, </font>test<font color="#000080">:</font>searchrec<font color="#000080">;
   </font>filedata<font color="#000080">:</font>chksum<font color="#000080">;
   </font>c<font color="#000080">, </font>full<font color="#000080">, </font>disk<font color="#000080">:</font>longint<font color="#000080">;
   </font>diskdone<font color="#000080">:</font>boolean<font color="#000080">;
   </font>fset<font color="#000080">, </font>disknum<font color="#000080">:</font>word<font color="#000080">;
   </font>success<font color="#000080">:</font>boolean<font color="#000080">;
   </font>data<font color="#000080">:</font>buffer<font color="#000080">;
   </font>buffersize<font color="#000080">, </font>readcount<font color="#000080">, </font>writecount<font color="#000080">:</font>word<font color="#000080">;
   </font>ch<font color="#000080">:</font>char<font color="#000080">;
</font><font color="#FF0000"><b>begin
   </b></font>findfirst<font color="#000080">(</font>filename<font color="#000080">, </font>anyfile<font color="#000080">, </font>fileinfo<font color="#000080">);
   </font><font color="#FF0000"><b>if </b></font>doserror <font color="#000080">&lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then
      </b></font>error<font color="#000080">(</font><font color="#800000">'File not found: ' </font><font color="#000080">+ </font>filename<font color="#000080">);
   </font>new<font color="#000080">(</font>data<font color="#000080">);
   </font>c<font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
   </font>disknum<font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
   </font>diskdone<font color="#000080">:= </font>true<font color="#000080">;
   </font><font color="#FF0000"><b>if not </b></font>DriveExist<font color="#000080">(</font>drive<font color="#000080">) </font><font color="#FF0000"><b>then </b></font>error<font color="#000080">(</font>drive<font color="#000080">+</font><font color="#800000">': does not exist.'</font><font color="#000080">);
   </font>randomize<font color="#000080">;
   </font>fset<font color="#000080">:= </font>random<font color="#000080">(</font><font color="#800000">9999</font><font color="#000080">);
   </font>writeln<font color="#000080">(</font><font color="#800000">'This is file set number '</font><font color="#000080">, </font>fset<font color="#000080">, </font><font color="#800000">'.'</font><font color="#000080">);
   </font>assign<font color="#000080">(</font>input<font color="#000080">, </font>filename<font color="#000080">);
   </font>reset<font color="#000080">(</font>input<font color="#000080">, </font><font color="#800000">1</font><font color="#000080">);
   </font><font color="#FF0000"><b>while </b></font>c <font color="#000080">&lt; </font>fileinfo<font color="#000080">.</font>size <font color="#FF0000"><b>do
      begin
         if </b></font>diskdone <font color="#FF0000"><b>then
            begin
               if </b></font>disknum <font color="#000080">&lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then
                  </b></font>close<font color="#000080">(</font>output<font color="#000080">);
               </font>clreol<font color="#000080">;
               </font>disk<font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
               </font>disknum<font color="#000080">:= </font>disknum <font color="#000080">+ </font><font color="#800000">1</font><font color="#000080">;
               </font>write<font color="#000080">(</font><font color="#800000">'Insert disk '</font><font color="#000080">, </font>disknum<font color="#000080">, </font><font color="#800000">' and press [ENTER].'</font><font color="#000080">);
               </font>readln<font color="#000080">;
               </font>diskdone<font color="#000080">:= </font>false<font color="#000080">;
               </font>buffersize<font color="#000080">:= </font>sizeof<font color="#000080">(</font>arraybuf<font color="#000080">);
               </font>full<font color="#000080">:= </font>disksize<font color="#000080">(</font>num<font color="#000080">(</font>drive<font color="#000080">));
               </font><font color="#FF0000"><b>if </b></font>disknum <font color="#000080">= </font><font color="#800000">1 </font><font color="#FF0000"><b>then
                  begin
                     </b></font>writeln<font color="#000080">(</font><font color="#800000">'Approximately '</font><font color="#000080">, (</font><font color="#800000">1</font><font color="#000080">+(</font>fileinfo<font color="#000080">.</font>size <font color="#FF0000"><b>div </b></font>disksize<font color="#000080">(</font>num<font color="#000080">(</font>drive<font color="#000080">)))), </font><font color="#800000">' of these disks are needed.'</font><font color="#000080">);
                     </font>write<font color="#000080">(</font><font color="#800000">'Continue? (Y/N)'</font><font color="#000080">);
                     </font>ch<font color="#000080">:= </font>readkey<font color="#000080">;
                     </font><font color="#FF0000"><b>if not </b></font><font color="#000080">((</font>ch <font color="#000080">= </font><font color="#800000">'y'</font><font color="#000080">) </font><font color="#FF0000"><b>or </b></font><font color="#000080">(</font>ch <font color="#000080">= </font><font color="#800000">'Y'</font><font color="#000080">)) </font><font color="#FF0000"><b>then
                        </b></font>halt<font color="#000080">(</font><font color="#800000">0</font><font color="#000080">);
                     </font>writeln<font color="#000080">;
                  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
               </font><font color="#FF0000"><b>if </b></font>disksize<font color="#000080">(</font>num<font color="#000080">(</font>drive<font color="#000080">)) &lt;&gt; </font>diskfree<font color="#000080">(</font>num<font color="#000080">(</font>drive<font color="#000080">)) </font><font color="#FF0000"><b>then
                  begin
                     </b></font>findfirst<font color="#000080">(</font>drive<font color="#000080">+</font><font color="#800000">':\*.cat'</font><font color="#000080">, </font>anyfile<font color="#000080">, </font>test<font color="#000080">);
                     </font><font color="#FF0000"><b>if </b></font>return<font color="#000080">(</font>test<font color="#000080">.</font>name<font color="#000080">, </font>true<font color="#000080">) = </font>fset <font color="#FF0000"><b>then
                        </b></font>error<font color="#000080">(</font><font color="#800000">'This disk is of this same set.'</font><font color="#000080">);
                     </font>delete<font color="#000080">(</font>drive<font color="#000080">, </font>success<font color="#000080">);
                     </font><font color="#FF0000"><b>if not </b></font>success <font color="#FF0000"><b>then
                        </b></font>error<font color="#000080">(</font><font color="#800000">'Some existing file(s) on destination disk could not be removed.'</font><font color="#000080">);
                  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
                  </font>assign<font color="#000080">(</font>output<font color="#000080">, </font>drive<font color="#000080">+</font><font color="#800000">':\'</font><font color="#000080">+</font>strn<font color="#000080">(</font>fset<font color="#000080">)+</font>strn<font color="#000080">(</font>disknum<font color="#000080">)+</font><font color="#800000">'.cat'</font><font color="#000080">);
                  </font>rewrite<font color="#000080">(</font>output<font color="#000080">, </font><font color="#800000">1</font><font color="#000080">);
               </font><font color="#FF0000"><b>if </b></font>disknum <font color="#000080">= </font><font color="#800000">1 </font><font color="#FF0000"><b>then
                  begin
                     </b></font>assign<font color="#000080">(</font>filedata<font color="#000080">, </font>drive<font color="#000080">+</font><font color="#800000">':\check.sum'</font><font color="#000080">);
                     </font>rewrite<font color="#000080">(</font>filedata<font color="#000080">);
                     </font>write<font color="#000080">(</font>filedata<font color="#000080">, </font>fileinfo<font color="#000080">);
                     </font>close<font color="#000080">(</font>filedata<font color="#000080">);
                     </font>full<font color="#000080">:= </font>diskfree<font color="#000080">(</font>num<font color="#000080">(</font>drive<font color="#000080">));
                  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
            </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
         </font><font color="#FF0000"><b>if </b></font>full <font color="#000080">- </font>disk <font color="#000080">&lt; </font>buffersize <font color="#FF0000"><b>then
            begin
               </b></font>buffersize<font color="#000080">:= </font>full <font color="#000080">- </font>disk<font color="#000080">;
               </font>diskdone<font color="#000080">:= </font>true<font color="#000080">;
            </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
         </font>blockread<font color="#000080">(</font>input<font color="#000080">, </font>data<font color="#000080">^, </font>buffersize<font color="#000080">, </font>readcount<font color="#000080">);
         </font><font color="#FF0000"><b>if </b></font>ioresult <font color="#000080">&lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then
            </b></font>error<font color="#000080">(</font><font color="#800000">'Errors on source disk.'</font><font color="#000080">);
         </font>blockwrite<font color="#000080">(</font>output<font color="#000080">, </font>data<font color="#000080">^, </font>readcount<font color="#000080">, </font>writecount<font color="#000080">);
         </font><font color="#FF0000"><b>if </b></font>ioresult <font color="#000080">&lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then
            </b></font>error<font color="#000080">(</font><font color="#800000">'Errors on target disk.'</font><font color="#000080">);
         </font>c<font color="#000080">:= </font>c <font color="#000080">+ </font>readcount<font color="#000080">;
         </font>disk<font color="#000080">:= </font>disk <font color="#000080">+ </font>readcount<font color="#000080">;
         </font>work<font color="#000080">(</font>fileinfo<font color="#000080">.</font>size<font color="#000080">, </font>c<font color="#000080">);
         </font><font color="#FF0000"><b>if </b></font>readcount <font color="#000080">&lt;&gt; </font>writecount <font color="#FF0000"><b>then </b></font>error<font color="#000080">(</font><font color="#800000">'Unable to write to disk'</font><font color="#000080">);
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
   </font>clreol<font color="#000080">;
   </font>close<font color="#000080">(</font>input<font color="#000080">);
   </font>close<font color="#000080">(</font>output<font color="#000080">);
   </font>dispose<font color="#000080">(</font>data<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>retrive<font color="#000080">(</font>drive<font color="#000080">:</font>char<font color="#000080">; </font>path<font color="#000080">:</font><font color="#FF0000"><b>string</b></font><font color="#000080">);
</font><font color="#FF0000"><b>var
   </b></font>setnum<font color="#000080">, </font>disknum<font color="#000080">:</font>word<font color="#000080">;
   </font>diskdone<font color="#000080">, </font>complete<font color="#000080">:</font>boolean<font color="#000080">;
   </font>newfile<font color="#000080">, </font>store<font color="#000080">:</font><font color="#FF0000"><b>file</b></font><font color="#000080">;
   </font>cs<font color="#000080">:</font>chksum<font color="#000080">;
   </font>fileinfo<font color="#000080">, </font>data<font color="#000080">:</font>searchrec<font color="#000080">;
   </font>d<font color="#000080">:</font>buffer<font color="#000080">;
   </font>c<font color="#000080">:</font>longint<font color="#000080">;
   </font>buffersize<font color="#000080">, </font>readcount<font color="#000080">, </font>writecount<font color="#000080">:</font>word<font color="#000080">;
</font><font color="#FF0000"><b>begin
   </b></font>complete<font color="#000080">:= </font>false<font color="#000080">;
   </font>chdir<font color="#000080">(</font>path<font color="#000080">);
   </font>new<font color="#000080">(</font>d<font color="#000080">);
   </font>c<font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
   </font><font color="#FF0000"><b>if </b></font>ioresult <font color="#000080">&lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then
      </b></font>error<font color="#000080">(</font>path<font color="#000080">+</font><font color="#800000">' does not exist.'</font><font color="#000080">);
   </font>diskdone<font color="#000080">:= </font>true<font color="#000080">;
   </font>disknum<font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
   </font><font color="#FF0000"><b>while not </b></font>complete <font color="#FF0000"><b>do
      begin
         if </b></font>diskdone <font color="#FF0000"><b>then
            begin
               </b></font>clreol<font color="#000080">;
               </font>disknum<font color="#000080">:= </font>disknum <font color="#000080">+ </font><font color="#800000">1</font><font color="#000080">;
               </font><font color="#FF0000"><b>if </b></font>disknum <font color="#000080">&gt; </font><font color="#800000">1 </font><font color="#FF0000"><b>then
                  </b></font>close<font color="#000080">(</font>store<font color="#000080">);
               </font>diskdone<font color="#000080">:= </font>false<font color="#000080">;
               </font>write<font color="#000080">(</font><font color="#800000">'Insert disk '</font><font color="#000080">, </font>disknum<font color="#000080">, </font><font color="#800000">' and press [ENTER].'</font><font color="#000080">);
               </font>readln<font color="#000080">;
               </font>buffersize<font color="#000080">:= </font>sizeof<font color="#000080">(</font>arraybuf<font color="#000080">);
               </font><font color="#FF0000"><b>if </b></font>disknum <font color="#000080">= </font><font color="#800000">1 </font><font color="#FF0000"><b>then
                  begin
                     </b></font>assign<font color="#000080">(</font>cs<font color="#000080">, </font>drive<font color="#000080">+</font><font color="#800000">':\check.sum'</font><font color="#000080">);
                     </font>reset<font color="#000080">(</font>cs<font color="#000080">);
                     </font><font color="#FF0000"><b>if </b></font>ioresult <font color="#000080">&lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>error<font color="#000080">(</font><font color="#800000">'No check sum file.'</font><font color="#000080">);
                     </font>read<font color="#000080">(</font>cs<font color="#000080">, </font>fileinfo<font color="#000080">);
                     </font>close<font color="#000080">(</font>cs<font color="#000080">);
                     </font>assign<font color="#000080">(</font>newfile<font color="#000080">, </font>fileinfo<font color="#000080">.</font>name<font color="#000080">);
                     </font>rewrite<font color="#000080">(</font>newfile<font color="#000080">, </font><font color="#800000">1</font><font color="#000080">);
                     </font>findfirst<font color="#000080">(</font>drive<font color="#000080">+</font><font color="#800000">':\*.cat'</font><font color="#000080">, </font>archive<font color="#000080">, </font>data<font color="#000080">);
                     </font><font color="#FF0000"><b>if </b></font>doserror <font color="#000080">= </font><font color="#800000">18 </font><font color="#FF0000"><b>then
                        begin
                           </b></font>close<font color="#000080">(</font>newfile<font color="#000080">);
                           </font>erase<font color="#000080">(</font>newfile<font color="#000080">);
                           </font>error<font color="#000080">(</font><font color="#800000">'Disk does not contain storage data.'</font><font color="#000080">);
                        </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
                     </font>assign<font color="#000080">(</font>store<font color="#000080">, </font>drive<font color="#000080">+</font><font color="#800000">':\'</font><font color="#000080">+</font>data<font color="#000080">.</font>name<font color="#000080">);
                     </font>reset<font color="#000080">(</font>store<font color="#000080">, </font><font color="#800000">1</font><font color="#000080">);
                     </font>setnum<font color="#000080">:= </font>return<font color="#000080">(</font>data<font color="#000080">.</font>name<font color="#000080">, </font>true<font color="#000080">);
                     </font><font color="#FF0000"><b>if </b></font>return<font color="#000080">(</font>data<font color="#000080">.</font>name<font color="#000080">, </font>false<font color="#000080">) &lt;&gt; </font>disknum <font color="#FF0000"><b>then
                        begin
                           </b></font>close<font color="#000080">(</font>newfile<font color="#000080">);
                           </font>erase<font color="#000080">(</font>newfile<font color="#000080">);
                           </font>error<font color="#000080">(</font><font color="#800000">'Wrong disk.'</font><font color="#000080">);
                        </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
                     </font>writeln<font color="#000080">(</font><font color="#800000">'File set number is: '</font><font color="#000080">, </font>setnum<font color="#000080">);
                  </font><font color="#FF0000"><b>end
               else
                  begin
                     </b></font>findfirst<font color="#000080">(</font>drive<font color="#000080">+</font><font color="#800000">':\*.cat'</font><font color="#000080">, </font>archive<font color="#000080">, </font>data<font color="#000080">);
                     </font><font color="#FF0000"><b>if </b></font>doserror <font color="#000080">= </font><font color="#800000">18 </font><font color="#FF0000"><b>then
                        begin
                           </b></font>close<font color="#000080">(</font>newfile<font color="#000080">);
                           </font>erase<font color="#000080">(</font>newfile<font color="#000080">);
                           </font>error<font color="#000080">(</font><font color="#800000">'Disk does not contain storage data.'</font><font color="#000080">);
                        </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
                     </font>assign<font color="#000080">(</font>store<font color="#000080">, </font>drive<font color="#000080">+</font><font color="#800000">':\'</font><font color="#000080">+</font>data<font color="#000080">.</font>name<font color="#000080">);
                     </font>reset<font color="#000080">(</font>store<font color="#000080">, </font><font color="#800000">1</font><font color="#000080">);
                     </font><font color="#FF0000"><b>if </b></font>setnum <font color="#000080">&lt;&gt; </font>return<font color="#000080">(</font>data<font color="#000080">.</font>name<font color="#000080">, </font>true<font color="#000080">) </font><font color="#FF0000"><b>then
                        begin
                           </b></font>close<font color="#000080">(</font>newfile<font color="#000080">);
                           </font>erase<font color="#000080">(</font>newfile<font color="#000080">);
                           </font>error<font color="#000080">(</font><font color="#800000">'Disk is of a different set.'</font><font color="#000080">);
                        </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
                     </font><font color="#FF0000"><b>if </b></font>disknum <font color="#000080">&lt;&gt; </font>return<font color="#000080">(</font>data<font color="#000080">.</font>name<font color="#000080">, </font>false<font color="#000080">) </font><font color="#FF0000"><b>then
                        begin
                           </b></font>close<font color="#000080">(</font>newfile<font color="#000080">);
                           </font>erase<font color="#000080">(</font>newfile<font color="#000080">);
                           </font>error<font color="#000080">(</font><font color="#800000">'Wrong disk.'</font><font color="#000080">);
                        </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
                  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
            </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
         </font>blockread<font color="#000080">(</font>store<font color="#000080">, </font>d<font color="#000080">^, </font>buffersize<font color="#000080">, </font>readcount<font color="#000080">);
         </font><font color="#FF0000"><b>if </b></font>ioresult <font color="#000080">&lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then
            begin
               </b></font>close<font color="#000080">(</font>newfile<font color="#000080">);
               </font>erase<font color="#000080">(</font>newfile<font color="#000080">);
               </font>error<font color="#000080">(</font><font color="#800000">'Errors on source disk.'</font><font color="#000080">);
            </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
         </font>blockwrite<font color="#000080">(</font>newfile<font color="#000080">, </font>d<font color="#000080">^, </font>readcount<font color="#000080">, </font>writecount<font color="#000080">);
         </font><font color="#FF0000"><b>if </b></font>ioresult <font color="#000080">&lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then
            begin
               </b></font>close<font color="#000080">(</font>newfile<font color="#000080">);
               </font>erase<font color="#000080">(</font>newfile<font color="#000080">);
               </font>error<font color="#000080">(</font><font color="#800000">'Errors on target disk.'</font><font color="#000080">);
            </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
         </font>c<font color="#000080">:= </font>c <font color="#000080">+ </font>readcount<font color="#000080">;
         </font><font color="#FF0000"><b>if </b></font>writecount <font color="#000080">&lt;&gt; </font>readcount <font color="#FF0000"><b>then
            begin
               </b></font>close<font color="#000080">(</font>newfile<font color="#000080">);
               </font>erase<font color="#000080">(</font>newfile<font color="#000080">);
               </font>error<font color="#000080">(</font><font color="#800000">'Unable to write to disk.'</font><font color="#000080">);
            </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
         </font><font color="#FF0000"><b>if </b></font>buffersize <font color="#000080">&lt;&gt; </font>readcount <font color="#FF0000"><b>then
            </b></font>diskdone<font color="#000080">:= </font>true<font color="#000080">;
         </font><font color="#FF0000"><b>if </b></font>fileinfo<font color="#000080">.</font>size <font color="#000080">= </font>c <font color="#FF0000"><b>then </b></font>complete<font color="#000080">:= </font>true<font color="#000080">;
         </font>work<font color="#000080">(</font>fileinfo<font color="#000080">.</font>size<font color="#000080">, </font>c<font color="#000080">);
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
   </font>clreol<font color="#000080">;
   </font>close<font color="#000080">(</font>newfile<font color="#000080">);
   </font>close<font color="#000080">(</font>store<font color="#000080">);
   </font>dispose<font color="#000080">(</font>d<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>var
   </b></font>c1<font color="#000080">, </font>c2<font color="#000080">:</font><font color="#FF0000"><b>string</b></font><font color="#000080">;

</font><font color="#FF0000"><b>begin
   if </b></font>paramcount <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>then
      </b></font>help<font color="#000080">;
   </font><font color="#FF0000"><b>if </b></font>paramcount <font color="#000080">&lt;&gt; </font><font color="#800000">3 </font><font color="#FF0000"><b>then
      </b></font>error<font color="#000080">(</font><font color="#800000">'Incorect number of parameters.'</font><font color="#000080">);
   </font>c1<font color="#000080">:= </font>paramstr<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">);
   </font>c2<font color="#000080">:= </font>paramstr<font color="#000080">(</font><font color="#800000">2</font><font color="#000080">);
   </font><font color="#FF0000"><b>case </b></font>c1<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">] </font><font color="#FF0000"><b>of
      </b></font><font color="#800000">'s'</font><font color="#000080">, </font><font color="#800000">'S' </font><font color="#000080">: </font>store<font color="#000080">(</font>paramstr<font color="#000080">(</font><font color="#800000">3</font><font color="#000080">), </font>c2<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">]);
      </font><font color="#800000">'r'</font><font color="#000080">, </font><font color="#800000">'R' </font><font color="#000080">: </font>retrive<font color="#000080">(</font>c2<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">], </font>paramstr<font color="#000080">(</font><font color="#800000">3</font><font color="#000080">));
   </font><font color="#FF0000"><b>else
      </b></font>error<font color="#000080">(</font><font color="#800000">'Incorect parameters.'</font><font color="#000080">);
   </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
   </font>writeln<font color="#000080">(</font><font color="#800000">'Complete!'</font><font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">.

</font><font color="#008000"><i>{ ---------------  CUT ---------------- }

</i></font><font color="#FF0000"><b>unit </b></font>files<font color="#000080">;

</font><font color="#FF0000"><b>interface

uses
   </b></font>dos<font color="#000080">;

</font><font color="#FF0000"><b>type
   </b></font>filetype <font color="#000080">= </font><font color="#FF0000"><b>string</b></font><font color="#000080">[</font><font color="#800000">12</font><font color="#000080">];
   </font><font color="#008000"><i>{searchrec = record    This is how searchrec is defined in the DOS unit.
      Fill: array[1..21] of Byte;
      Attr: Byte;
      Time: Longint;
      Size: Longint;
      Name: string[12];
   end;  }
   </i></font>filestack <font color="#000080">= ^ </font>node<font color="#000080">;
   </font>node <font color="#000080">= </font><font color="#FF0000"><b>record
      </b></font>fileinfo<font color="#000080">:</font>searchrec<font color="#000080">;
      </font>next<font color="#000080">:</font>filestack<font color="#000080">;
   </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
   </font>directory_tree <font color="#000080">= ^</font>dnode<font color="#000080">;
   </font>dnode <font color="#000080">= </font><font color="#FF0000"><b>record
      </b></font>dir<font color="#000080">:</font><font color="#FF0000"><b>string</b></font><font color="#000080">;
      </font>lower_dir<font color="#000080">:</font>directory_tree<font color="#000080">;
      </font>next<font color="#000080">:</font>directory_tree<font color="#000080">;
   </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>fill_filestack<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>stack<font color="#000080">:</font>filestack<font color="#000080">);
   </font><font color="#008000"><i>{Fills stack of type filestack with all the file enteries in the
   current directory.  Includes directoies and hidden file types.}

</i></font><font color="#FF0000"><b>procedure </b></font>push_filestack<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>stack<font color="#000080">:</font>filestack<font color="#000080">; </font>item<font color="#000080">:</font>searchrec<font color="#000080">);
   </font><font color="#008000"><i>{Pushes in alfa order a new node on a filestack.}

</i></font><font color="#FF0000"><b>procedure </b></font>fill_dirtree<font color="#000080">(</font>dir<font color="#000080">:</font><font color="#FF0000"><b>string</b></font><font color="#000080">; </font><font color="#FF0000"><b>var </b></font>tree<font color="#000080">:</font>directory_tree<font color="#000080">);
   </font><font color="#008000"><i>{Fills a tree sturcture with the directory structure using dir string
   as the root.}

</i></font><font color="#FF0000"><b>implementation

procedure </b></font>push_filestack<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>stack<font color="#000080">:</font>filestack<font color="#000080">; </font>item<font color="#000080">:</font>searchrec<font color="#000080">);
</font><font color="#FF0000"><b>var
   </b></font>temp<font color="#000080">:</font>filestack<font color="#000080">;

   </font><font color="#FF0000"><b>procedure </b></font>insert<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>stack<font color="#000080">, </font>prev<font color="#000080">:</font>filestack<font color="#000080">);
   </font><font color="#FF0000"><b>begin
      if </b></font><font color="#000080">(</font>stack <font color="#000080">= </font><font color="#FF0000"><b>nil</b></font><font color="#000080">) </font><font color="#FF0000"><b>then
         begin
            </b></font>temp<font color="#000080">^.</font>next<font color="#000080">:= </font>stack<font color="#000080">;
            </font>stack<font color="#000080">:= </font>temp<font color="#000080">;
         </font><font color="#FF0000"><b>end
      else
         if </b></font>temp<font color="#000080">^.</font>fileinfo<font color="#000080">.</font>name <font color="#000080">&gt; </font>stack<font color="#000080">^.</font>fileinfo<font color="#000080">.</font>name <font color="#FF0000"><b>then
            </b></font>insert<font color="#000080">(</font>stack<font color="#000080">^.</font>next<font color="#000080">, </font>stack<font color="#000080">)
         </font><font color="#FF0000"><b>else
            if </b></font>temp<font color="#000080">^.</font>fileinfo<font color="#000080">.</font>name <font color="#000080">&lt; </font>stack<font color="#000080">^.</font>fileinfo<font color="#000080">.</font>name <font color="#FF0000"><b>then
               begin
                  if </b></font>prev <font color="#000080">= </font>stack <font color="#FF0000"><b>then
                     begin
                        </b></font>temp<font color="#000080">^.</font>next<font color="#000080">:= </font>stack<font color="#000080">;
                        </font>stack<font color="#000080">:= </font>temp<font color="#000080">;
                     </font><font color="#FF0000"><b>end
                  else
                     begin
                        </b></font>temp<font color="#000080">^.</font>next<font color="#000080">:= </font>stack<font color="#000080">;
                        </font>prev<font color="#000080">^.</font>next<font color="#000080">:= </font>temp<font color="#000080">;
                     </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
               </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
   </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>begin
   </b></font>new<font color="#000080">(</font>temp<font color="#000080">);
   </font>temp<font color="#000080">^.</font>fileinfo<font color="#000080">:= </font>item<font color="#000080">;
   </font>insert<font color="#000080">(</font>stack<font color="#000080">, </font>stack<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>fill_filestack<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>stack<font color="#000080">:</font>filestack<font color="#000080">);
</font><font color="#FF0000"><b>var
   </b></font>dirinfo<font color="#000080">:</font>searchrec<font color="#000080">;
</font><font color="#FF0000"><b>begin
   </b></font>findfirst<font color="#000080">(</font><font color="#800000">'*.*'</font><font color="#000080">, </font>anyfile<font color="#000080">, </font>dirinfo<font color="#000080">);
   </font><font color="#FF0000"><b>while </b></font>doserror <font color="#000080">&lt;&gt; </font><font color="#800000">18 </font><font color="#FF0000"><b>do
      begin
         </b></font>push_filestack<font color="#000080">(</font>stack<font color="#000080">, </font>dirinfo<font color="#000080">);
         </font>findnext<font color="#000080">(</font>dirinfo<font color="#000080">);
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>push<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>head<font color="#000080">:</font>directory_tree<font color="#000080">; </font>item<font color="#000080">:</font><font color="#FF0000"><b>string</b></font><font color="#000080">);
</font><font color="#FF0000"><b>var
   </b></font>temp<font color="#000080">:</font>directory_tree<font color="#000080">;
</font><font color="#FF0000"><b>begin
   </b></font>new<font color="#000080">(</font>temp<font color="#000080">);
   </font>temp<font color="#000080">^.</font>dir<font color="#000080">:= </font>item<font color="#000080">;
   </font>temp<font color="#000080">^.</font>next<font color="#000080">:= </font>head<font color="#000080">;
   </font>head<font color="#000080">:= </font>temp<font color="#000080">;
   </font>head<font color="#000080">^.</font>lower_dir<font color="#000080">:= </font><font color="#FF0000"><b>nil</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>fill_dirtree<font color="#000080">(</font>dir<font color="#000080">:</font><font color="#FF0000"><b>string</b></font><font color="#000080">; </font><font color="#FF0000"><b>var </b></font>tree<font color="#000080">:</font>directory_tree<font color="#000080">);
</font><font color="#FF0000"><b>procedure </b></font>fill_dirlist<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>head<font color="#000080">:</font>directory_tree<font color="#000080">; </font>directory<font color="#000080">:</font><font color="#FF0000"><b>string</b></font><font color="#000080">; </font>s<font color="#000080">:</font>integer<font color="#000080">);
</font><font color="#FF0000"><b>var
   </b></font>place<font color="#000080">:</font>directory_tree<font color="#000080">;
   </font>dirinfo<font color="#000080">:</font>searchrec<font color="#000080">;
   </font>found<font color="#000080">:</font>boolean<font color="#000080">;
</font><font color="#FF0000"><b>begin
   </b></font>writeln<font color="#000080">(</font>directory<font color="#000080">);
   </font>chdir<font color="#000080">(</font>directory<font color="#000080">);
   </font>findfirst<font color="#000080">(</font><font color="#800000">'*.*'</font><font color="#000080">, </font><font color="#800000">16</font><font color="#000080">, </font>dirinfo<font color="#000080">);
   </font><font color="#FF0000"><b>while </b></font>doserror <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>do
      begin
         if </b></font><font color="#000080">(</font>dirinfo<font color="#000080">.</font>attr <font color="#000080">= </font><font color="#800000">16</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">((</font>dirinfo<font color="#000080">.</font>name <font color="#000080">&lt;&gt; </font><font color="#800000">'..'</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>dirinfo<font color="#000080">.</font>name <font color="#000080">&lt;&gt; </font><font color="#800000">'.'</font><font color="#000080">))</font><font color="#FF0000"><b>then
            begin
               </b></font>push<font color="#000080">(</font>head<font color="#000080">, </font>fexpand<font color="#000080">(</font>dirinfo<font color="#000080">.</font>name<font color="#000080">));
               </font>found<font color="#000080">:= </font>true<font color="#000080">;
            </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
            </font>findnext<font color="#000080">(</font>dirinfo<font color="#000080">);
         </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>if </b></font>found <font color="#FF0000"><b>then
         begin
            </b></font>place<font color="#000080">:= </font>head<font color="#000080">;
            </font><font color="#FF0000"><b>while </b></font>place <font color="#000080">&lt;&gt; </font><font color="#FF0000"><b>nil do
               begin
                  </b></font>fill_dirlist<font color="#000080">(</font>place<font color="#000080">^.</font>lower_dir<font color="#000080">, </font>place<font color="#000080">^.</font>dir<font color="#000080">, </font>s<font color="#000080">+</font><font color="#800000">3</font><font color="#000080">);
                  </font>place<font color="#000080">:= </font>place<font color="#000080">^.</font>next<font color="#000080">;
               </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
         </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>var
   </b></font>temp<font color="#000080">:</font>directory_tree<font color="#000080">;
</font><font color="#FF0000"><b>begin
   </b></font>tree<font color="#000080">:= </font><font color="#FF0000"><b>nil</b></font><font color="#000080">;
   </font>fill_dirlist<font color="#000080">(</font>tree<font color="#000080">, </font>dir<font color="#000080">, </font><font color="#800000">0</font><font color="#000080">);
   </font>new<font color="#000080">(</font>temp<font color="#000080">);
   </font>temp<font color="#000080">^.</font>dir<font color="#000080">:= </font>dir<font color="#000080">;
   </font>temp<font color="#000080">^.</font>lower_dir<font color="#000080">:= </font>tree<font color="#000080">;
   </font>temp<font color="#000080">^.</font>next<font color="#000080">:= </font><font color="#FF0000"><b>nil</b></font><font color="#000080">;
   </font>tree<font color="#000080">:= </font>temp<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>end</b></font><font color="#000080">.</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to FILES SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0096.PAS">Original</a><b>]</b></p></body>
</html>
