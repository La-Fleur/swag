<html>
<head><title> "WIN95 Long Filenames" by DUNCUN MURDOCH</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to FILES SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0086.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
&gt;&gt;Has anyone done anything to address Win95 long file names yet?
&gt;&gt;I just need to be able to read them 4 now.

&gt;I haven't done anything with it, but the current version of Ralf Brown's
&gt;interrupt list describes the way for a DOS program to deal with them.
&gt;(Search for Windows95 *and* Chicago.)  I don't know if that's the best way for
&gt;a Win16 program to deal with them, but it's certainly a possibility.

There's actually a typo in release 47 of the list, as I've found out this
evening while trying to handle these in BP (hence the cross-post to
comp.lang.pascal.borland).

Here's my BP code for a little program that prints both the short and
long version of any longnamed file on C:.  it'll be pretty similar in Delphi,
if the INT 21 approach is what you're supposed to use in Win16.
}

</i></font><font color="#FF0000"><b>USES </b></font>Strings<font color="#000080">;

</font><font color="#FF0000"><b>type
  </b></font>TSearchRec <font color="#000080">= </font><font color="#FF0000"><b>record                    
    </b></font>attr <font color="#000080">: </font>longint<font color="#000080">;                      
    </font>creation <font color="#000080">: </font>comp<font color="#000080">;                     
    </font>lastaccess <font color="#000080">: </font>comp<font color="#000080">;                   
    </font>lastmodification <font color="#000080">: </font>comp<font color="#000080">;             
    </font>highfilesize <font color="#000080">: </font>longint<font color="#000080">;              
    </font>lowfilesize <font color="#000080">: </font>longint<font color="#000080">;               
    </font>reserved <font color="#000080">: </font>comp<font color="#000080">;                     
    </font>name <font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">259</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>char<font color="#000080">;        
    </font>shortname <font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">13</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>char<font color="#000080">;    
    </font>handle <font color="#000080">: </font>word<font color="#000080">;                       
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;                                   

</font><font color="#FF0000"><b>const                                    
  </b></font>faReadOnly      <font color="#000080">=  </font><font color="#800000">$01</font><font color="#000080">;                
  </font>faHidden        <font color="#000080">=  </font><font color="#800000">$02</font><font color="#000080">;
  </font>faSysFile       <font color="#000080">=  </font><font color="#800000">$04</font><font color="#000080">;                
  </font>faVolumeID      <font color="#000080">=  </font><font color="#800000">$08</font><font color="#000080">;
  </font>faDirectory     <font color="#000080">=  </font><font color="#800000">$10</font><font color="#000080">;                
  </font>faArchive       <font color="#000080">=  </font><font color="#800000">$20</font><font color="#000080">;                
  </font>faAnyFile       <font color="#000080">=  </font><font color="#800000">$3F</font><font color="#000080">;                

</font><font color="#FF0000"><b>function </b></font>findfirst<font color="#000080">(</font>filespec<font color="#000080">:</font><font color="#FF0000"><b>string</b></font><font color="#000080">;</font>attr<font color="#000080">:</font>word<font color="#000080">;</font><font color="#FF0000"><b>var </b></font>S<font color="#000080">:</font>TSearchRec<font color="#000080">):</font>integer<font color="#000080">;  
</font><font color="#FF0000"><b>begin                                                                    
  </b></font>filespec <font color="#000080">:= </font>filespec <font color="#000080">+ </font><font color="#800000">#0</font><font color="#000080">;                                             
  </font>S<font color="#000080">.</font>attr <font color="#000080">:= </font>attr<font color="#000080">;                                                        
  </font><font color="#FF0000"><b>asm                                                                    
    </b></font><font color="#FF00FF">push ds                                                              
    push ss                                                              
    pop ds                                                               
    lea dx,filespec+1                                                    
    les di,S
    mov ax,$714e                                                         
    mov cx,attr                                                          
    mov si,0
    int $21                                                              
    les di,S
    mov word ptr es:[di+TSearchRec.handle], ax                           
    jc @1                                                                
    xor ax,ax                                                            
  @1:                                                                    
    mov @result,ax                                                       
    pop ds                                                               
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;                                                                   
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;                                                                     

                                                 
</font><font color="#FF0000"><b>function </b></font>FindNext<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>S<font color="#000080">:</font>TSearchRec<font color="#000080">):</font>integer<font color="#000080">;     
</font><font color="#FF0000"><b>begin                                            
  asm                                            
    </b></font><font color="#FF00FF">mov ax,$714f
    mov si,0                                     
    les di,S                                     
    mov bx,word ptr es:[di+TSearchRec.Handle]
    int $21                                      
    jc @1
    xor ax,ax                                    
  @1:                                            
    mov @result,ax                               
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;                                           
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;                                             
                                                 
</font><font color="#FF0000"><b>function </b></font>FindClose<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>S<font color="#000080">:</font>TSearchRec<font color="#000080">):</font>integer<font color="#000080">;    
</font><font color="#FF0000"><b>begin                                            
  asm                                            
    </b></font><font color="#FF00FF">mov ax,$71a1                                 
    les di,S                                     
    mov bx,word ptr es:[di+TSearchRec.Handle]    
    int $21                                      
    jc @1
    xor ax,ax                                                            
  @1:                                                                    
    mov @result,ax
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;                                                                   
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;
                                                                         
</font><font color="#FF0000"><b>procedure </b></font>ShowLongNames<font color="#000080">(</font><font color="#FF0000"><b>const </b></font>path<font color="#000080">:</font><font color="#FF0000"><b>string</b></font><font color="#000080">);                              
</font><font color="#FF0000"><b>var                                                                      
  </b></font>S <font color="#000080">: </font>TSearchRec<font color="#000080">;                                                        
  </font>Res <font color="#000080">: </font>Integer<font color="#000080">;                                                         
</font><font color="#FF0000"><b>begin                                                                    
  </b></font>Res <font color="#000080">:= </font>findfirst<font color="#000080">(</font>path<font color="#000080">+</font><font color="#800000">'\*.*'</font><font color="#000080">,</font>faAnyFile<font color="#000080">-</font>faVolumeID<font color="#000080">,</font>S<font color="#000080">);                  
  </font><font color="#FF0000"><b>while </b></font>Res <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>do                                                       
  begin                                                                  
    with </b></font>S <font color="#FF0000"><b>do                                                            
    begin                                                                
      if </b></font><font color="#000080">(</font>S<font color="#000080">.</font>Attr <font color="#FF0000"><b>and </b></font>faDirectory<font color="#000080">) &lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then                              
      begin                                                              
        if </b></font><font color="#000080">(</font>StrComp<font color="#000080">(</font>Name<font color="#000080">,</font><font color="#800000">'.'</font><font color="#000080">) &lt;&gt; </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>StrComp<font color="#000080">(</font>Name<font color="#000080">,</font><font color="#800000">'..'</font><font color="#000080">) &lt;&gt; </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>then
        begin                                                            
          if </b></font>ShortName<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">] &lt;&gt; </font><font color="#800000">#0 </font><font color="#FF0000"><b>then                                     
            </b></font>ShowLongNames<font color="#000080">(</font>path<font color="#000080">+</font><font color="#800000">'\'</font><font color="#000080">+</font>StrPas<font color="#000080">(</font>ShortName<font color="#000080">))
          </font><font color="#FF0000"><b>else                                                           
            </b></font>ShowLongNames<font color="#000080">(</font>path<font color="#000080">+</font><font color="#800000">'\'</font><font color="#000080">+</font>StrPas<font color="#000080">(</font>Name<font color="#000080">));
        </font><font color="#FF0000"><b>end</b></font><font color="#000080">;                                                             
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;                                                               
      </font><font color="#FF0000"><b>if </b></font>ShortName<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">] &lt;&gt; </font><font color="#800000">#0 </font><font color="#FF0000"><b>then                                         
        </b></font>writeln<font color="#000080">(</font><font color="#800000">'ren '</font><font color="#000080">,</font>path<font color="#000080">+</font><font color="#800000">'\'</font><font color="#000080">+</font>StrPas<font color="#000080">(</font>ShortName<font color="#000080">),</font><font color="#800000">' &quot;'</font><font color="#000080">,</font>name<font color="#000080">,</font><font color="#800000">'&quot;'</font><font color="#000080">);        
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;                                                                 
    </font>Res <font color="#000080">:= </font>FindNext<font color="#000080">(</font>S<font color="#000080">);                                                  
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;                                                                   
  </font>FindClose<font color="#000080">(</font>S<font color="#000080">);                                                          
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;                                                                     
                                                                         
</font><font color="#FF0000"><b>var                                                                      
  </b></font>x <font color="#000080">: </font>integer<font color="#000080">;                                                           
</font><font color="#FF0000"><b>begin                                                                    
  </b></font>showlongnames<font color="#000080">(</font><font color="#800000">'D:'</font><font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">.

</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to FILES SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0086.PAS">Original</a><b>]</b></p></body>
</html>
