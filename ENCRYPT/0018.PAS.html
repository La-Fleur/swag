<html>
<head><title> "Xor Encryption/Decryption" by JOHN FREESE</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to ENCRYPT SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0018.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>(* $Header:   A:/vcs/mash.pav   1.0   15 Jul 1991  7:21:38   K_McCoy  $ *)
(****************************************************************************)
 
</i></font><font color="#FF0000"><b>UNIT </b></font>MASH<font color="#000080">;
 
</font><font color="#008000"><i>{$IFDEF DOCUMENTATION}
 
(****************************************************************************)
 </i></font><font color="#000080">*  
 *  </font><font color="#800000">$</font>Log<font color="#000080">:   </font>A<font color="#000080">:/</font>vcs<font color="#000080">/</font>mash<font color="#000080">.</font>pav  <font color="#800000">$
 </font><font color="#000080">* 
 *    </font>Rev <font color="#800000">1.0   15 </font>Jul <font color="#800000">1991  7</font><font color="#000080">:</font><font color="#800000">21</font><font color="#000080">:</font><font color="#800000">38   </font>K_McCoy
 <font color="#000080">*    </font>Added encryption <font color="#FF0000"><b>unit</b></font><font color="#000080">, </font>cleaned up<font color="#000080">.
 * 
 *  
</font><font color="#008000"><i>(****************************************************************************)
 
{$V-}
 
 
                  </i></font>Mash <font color="#000080">- </font>The McCoy <font color="#000080">&amp; </font>Associates <font color="#FF0000"><b>File </b></font>Mangler
 
    Purpose<font color="#000080">:


    </font>General purpose text <font color="#FF0000"><b>file </b></font>encrypter<font color="#000080">.  </font>Keeps the honest people honest<font color="#000080">.
    </font>Does simple <font color="#FF0000"><b>XOR of </b></font>text characters <font color="#FF0000"><b>with </b></font>user settable key<font color="#000080">.  </font>Creates
    a binary <font color="#FF0000"><b>file with </b></font>the extension <font color="#000080">.</font>CRP containing the encrypted text<font color="#000080">.
    </font>Binary files will be a little shorter than their ascii counterparts
    <font color="#FF0000"><b>as </b></font>there will be no CR<font color="#000080">/</font>LF delimiters<font color="#000080">: </font>only a length byte preceeding
    each <font color="#000080">&quot;</font>line<font color="#000080">&quot; </font><font color="#FF0000"><b>of </b></font>binary characters<font color="#000080">.  </font>There <font color="#FF0000"><b>is </b></font>a <font color="#800000">255 </font>character limit <font color="#FF0000"><b>on
    </b></font>the text files<font color="#000080">, </font>but no limit <font color="#FF0000"><b>on </b></font>the number <font color="#FF0000"><b>of </b></font>lines <font color="#000080">(</font>up <font color="#FF0000"><b>to </b></font>the capacity
    <font color="#FF0000"><b>of </b></font>the disk<font color="#000080">).
 
    </font>Drawbacks<font color="#000080">:  </font>This <font color="#FF0000"><b>is </b></font>nowhere <font color="#FF0000"><b>near as </b></font>secure <font color="#FF0000"><b>as </b></font>DES algorithm<font color="#000080">, </font>although
    it <font color="#FF0000"><b>is </b></font>much faster<font color="#000080">.  </font>This <font color="#FF0000"><b>unit </b></font>won<font color="#800000">'t keep the CIA / KGB out of your
    </font>financial records <font color="#FF0000"><b>for </b></font>long<font color="#000080">, </font>but it might work <font color="#FF0000"><b>on </b></font>your ex<font color="#000080">-</font>wife
    <font color="#FF0000"><b>and </b></font>her laywer<font color="#000080">.
 
    </font>Note<font color="#000080">:  </font>This <font color="#FF0000"><b>unit uses </b></font>the TPSTRING <font color="#FF0000"><b>unit </b></font>from Turbo Power<font color="#000080">.  </font>You could
    easily change this <font color="#FF0000"><b>to </b></font>use the OPSTRING <font color="#FF0000"><b>unit or </b></font>write your own
    Trim <font color="#000080">[</font>trailing blanks<font color="#000080">] </font><font color="#FF0000"><b>function</b></font><font color="#000080">.
 
    </font>I wrote this <font color="#FF0000"><b>for </b></font>an <font color="#FF0000"><b>automated </b></font>test <font color="#FF0000"><b>program to </b></font>keep unauthorized people
    from changing the test specifications <font color="#FF0000"><b>out on </b></font>the assembly line<font color="#000080">.
    (</font>You wouldn<font color="#800000">'t want airplanes falling on your head, would you?)
 
    </font>Suggested improvements<font color="#000080">:

    </font>Allow other <font color="#FF0000"><b>file </b></font>extensions <font color="#FF0000"><b>for </b></font>input <font color="#FF0000"><b>and </b></font>output files<font color="#000080">.
    </font>Modify this <font color="#FF0000"><b>to </b></font>work <font color="#FF0000"><b>with </b></font>binary input files<font color="#000080">.
    </font>Modify the Mangle routine <font color="#FF0000"><b>to not </b></font>reset <font color="#FF0000"><b>to </b></font>the beginning <font color="#FF0000"><b>of </b></font>the key <font color="#FF0000"><b>on </b></font>each
    line <font color="#FF0000"><b>of </b></font>text<font color="#000080">.
 
    </font><font color="#FF0000"><b>Public </b></font>Domain<font color="#000080">, </font>but be nice <font color="#FF0000"><b>and </b></font>give me credit <font color="#FF0000"><b>if </b></font>you use it <font color="#FF0000"><b>in </b></font>your
    own stuff<font color="#000080">.
 
    </font>_Use at your own risk_  <font color="#FF0000"><b>If </b></font>the KGB de<font color="#000080">-</font>encrypts your Mangled bowling
    scores<font color="#000080">, </font>tough<font color="#000080">!

    </font><font color="#FF0000"><b>Do </b></font>an IO redirect <font color="#FF0000"><b>of </b></font>complaints <font color="#FF0000"><b>to </b></font>NUL<font color="#000080">.  </font>Questions may be sent <font color="#FF0000"><b>to</b></font><font color="#000080">:
 
    </font>Kevin McCoy <font color="#000080">- </font>CompuServe ID<font color="#800000"># </font><font color="#000080">[</font><font color="#800000">72470</font><font color="#000080">,</font><font color="#800000">1233</font><font color="#000080">]
    </font><font color="#800000">2217 </font>Aspenpark Ct<font color="#000080">.
    </font>Thousand Oaks<font color="#000080">, </font>CA <font color="#800000">91362</font><font color="#000080">-</font><font color="#800000">1731
 
 
                                </font>Sample Usage<font color="#000080">:
</font><font color="#FF0000"><b>USES
    </b></font>DOS<font color="#000080">,
    </font>CRT<font color="#000080">,
    </font>MASH<font color="#000080">;
</font><font color="#FF0000"><b>VAR
    </b></font>Strg<font color="#000080">,
    </font>InName         <font color="#000080">: </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">;
    </font>M              <font color="#000080">: </font>Mangler<font color="#000080">;
</font><font color="#FF0000"><b>BEGIN                             </b></font><font color="#008000"><i>{main}
    </i></font>ClrScr<font color="#000080">;
 
    </font>WRITE<font color="#000080">(</font><font color="#800000">'Enter name of .CFG file: '</font><font color="#000080">);
    </font>READLN<font color="#000080">(</font>InName<font color="#000080">);
 
    </font><font color="#008000"><i>{I think this came from an old &quot;Man from U.N.C.L.E.&quot; episode}
    </i></font>M<font color="#000080">.</font>SetSequence<font color="#000080">(</font><font color="#800000">'OuR CaRs On IcE'</font><font color="#000080">);

    </font><font color="#008000"><i>{open the two files}
    </i></font><font color="#FF0000"><b>IF NOT </b></font>M<font color="#000080">.</font>Init<font color="#000080">(</font>InName<font color="#000080">, </font>MASHMODE<font color="#000080">) </font><font color="#FF0000"><b>THEN BEGIN
        </b></font>WRITELN<font color="#000080">(</font>M<font color="#000080">.</font>MashError<font color="#000080">);
        </font>HALT<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">);
    </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
 
    </font><font color="#008000"><i>{encrypt the .CFG file}
    </i></font><font color="#FF0000"><b>IF NOT </b></font>M<font color="#000080">.</font>MashFile <font color="#FF0000"><b>THEN BEGIN
        </b></font>WRITELN<font color="#000080">(</font>M<font color="#000080">.</font>MashError<font color="#000080">);
        </font>HALT<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">);
    </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

    </font><font color="#008000"><i>{close the files}
    </i></font>M<font color="#000080">.</font>Done<font color="#000080">;
 
    </font><font color="#008000"><i>{Open just the encrypted file}
    </i></font><font color="#FF0000"><b>IF NOT </b></font>M<font color="#000080">.</font>Init<font color="#000080">(</font>InName<font color="#000080">, </font>UNMASHMODE<font color="#000080">) </font><font color="#FF0000"><b>THEN BEGIN
        </b></font>WRITELN<font color="#000080">(</font>M<font color="#000080">.</font>MashError<font color="#000080">);
        </font>HALT<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">);
    </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
 
    </font><font color="#008000"><i>{read and decrypt each line until EOF}
    </i></font><font color="#FF0000"><b>WHILE </b></font>M<font color="#000080">.</font>Getline<font color="#000080">(</font>Strg<font color="#000080">) </font><font color="#FF0000"><b>DO
        </b></font>WRITELN<font color="#000080">(</font>Strg<font color="#000080">);
 
    </font><font color="#008000"><i>{close the .CRP file}
    </i></font>M<font color="#000080">.</font>Done<font color="#000080">;
 
</font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>{of sample program}
 
 
{$ENDIF}
{ The real stuff starts here... }
 
</i></font><font color="#FF0000"><b>INTERFACE

TYPE
    </b></font>MMType         <font color="#000080">= (</font>MASHMODE<font color="#000080">, </font>UNMASHMODE<font color="#000080">, </font>SOURMASH<font color="#000080">);
 
    </font>Mangler        <font color="#000080">= </font><font color="#FF0000"><b>OBJECT
                         </b></font>TFile          <font color="#000080">: </font>TEXT<font color="#000080">;
                         </font>BFile          <font color="#000080">: </font><font color="#FF0000"><b>FILE</b></font><font color="#000080">;
                         </font>LastError      <font color="#000080">: </font>WORD<font color="#000080">;
                         </font>FileName       <font color="#000080">: </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">;
                         </font>InitMode       <font color="#000080">: </font>MMType<font color="#000080">;
                         </font><font color="#FF0000"><b>FUNCTION </b></font>Init<font color="#000080">(</font>Fname <font color="#000080">: </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">; </font>Mode <font color="#000080">: </font>MMType<font color="#000080">) :
</font>BOOLEAN<font color="#000080">;
                         </font><font color="#FF0000"><b>FUNCTION </b></font>Getline<font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>Line <font color="#000080">: </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">) : </font>BOOLEAN<font color="#000080">;
                         </font><font color="#FF0000"><b>FUNCTION </b></font>MashFile <font color="#000080">: </font>BOOLEAN<font color="#000080">;
                         </font><font color="#FF0000"><b>FUNCTION  </b></font>MashError<font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>S <font color="#000080">: </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">) : </font>BOOLEAN<font color="#000080">;
                         </font><font color="#FF0000"><b>PROCEDURE </b></font>SetSequence<font color="#000080">(</font>Seq <font color="#000080">: </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">);
                         </font><font color="#FF0000"><b>PROCEDURE </b></font>Done<font color="#000080">;
                     </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
 
   
</font><font color="#008000"><i>(****************************************************************************)
 
</i></font><font color="#FF0000"><b>IMPLEMENTATION

USES
    </b></font><font color="#008000"><i>{.U-}
    </i></font>TPSTRING
    <font color="#008000"><i>{.U+}
    </i></font><font color="#000080">;
 
</font><font color="#FF0000"><b>CONST
    </b></font><font color="#008000"><i>{Default key.  May be reset with the SetSequence method}
    </i></font>Id             <font color="#000080">: </font><font color="#FF0000"><b>STRING </b></font><font color="#000080">=
</font><font color="#800000">'^%12hY7eujEDZ|R9a341~~#2DBC3fn7mSDVvUY@hbFD`6093fdk79*7a-|-  Q`'</font><font color="#000080">;
 
    </font><font color="#008000"><i>{error number constants}
    </i></font>INVINAM <font color="#000080">= </font><font color="#800000">500</font><font color="#000080">;
    </font>INVINIT <font color="#000080">= </font>INVINAM <font color="#000080">+ </font><font color="#800000">1</font><font color="#000080">;
    </font>CORRUPT <font color="#000080">= </font>INVINIT <font color="#000080">+ </font><font color="#800000">1</font><font color="#000080">;
 
 
   
</font><font color="#008000"><i>(****************************************************************************)
 
    </i></font><font color="#FF0000"><b>FUNCTION </b></font>Mangle<font color="#000080">(</font>L <font color="#000080">: </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">) : </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">;
        </font><font color="#008000"><i>{ Low budget encryption / decryption of Line}
    </i></font><font color="#FF0000"><b>VAR
        </b></font>I              <font color="#000080">: </font>INTEGER<font color="#000080">;
    </font><font color="#FF0000"><b>BEGIN
        FOR </b></font>I <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>TO </b></font>LENGTH<font color="#000080">(</font>L<font color="#000080">) </font><font color="#FF0000"><b>DO
            </b></font>L<font color="#000080">[</font>I<font color="#000080">] := </font>CHR<font color="#000080">(</font>ORD<font color="#000080">(</font>L<font color="#000080">[</font>I<font color="#000080">]) </font><font color="#FF0000"><b>XOR NOT</b></font><font color="#000080">(</font>ORD<font color="#000080">(</font>Id<font color="#000080">[</font>I <font color="#FF0000"><b>MOD </b></font>LENGTH<font color="#000080">(</font>Id<font color="#000080">) + </font><font color="#800000">1</font><font color="#000080">])));
        </font>Mangle <font color="#000080">:= </font>L<font color="#000080">;
    </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
 
   
</font><font color="#008000"><i>(****************************************************************************)
 
    </i></font><font color="#FF0000"><b>FUNCTION </b></font>Mangler<font color="#000080">.</font>Init<font color="#000080">(</font>Fname <font color="#000080">: </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">; </font>Mode <font color="#000080">: </font>MMType<font color="#000080">) : </font>BOOLEAN<font color="#000080">;
        </font><font color="#008000"><i>{- Gozintas:  Fname = Name (no extension) of the input/output files}
        {             Mode  = MASHMODE / UNMASHMODE (encrypt / decrypt)    }
        {  Gozoutas:  TRUE if everything was OK, FALSE if not              }
    </i></font><font color="#FF0000"><b>VAR
        </b></font>InName<font color="#000080">,
        </font>OutName        <font color="#000080">: </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>BEGIN
        </b></font>InitMode <font color="#000080">:= </font>Mode<font color="#000080">;
        </font>FileName <font color="#000080">:= </font>Fname<font color="#000080">;
        </font>Init <font color="#000080">:= </font>TRUE<font color="#000080">;
        </font><font color="#FF0000"><b>IF </b></font>LENGTH<font color="#000080">(</font>Trim<font color="#000080">(</font>Fname<font color="#000080">)) = </font><font color="#800000">0 </font><font color="#FF0000"><b>THEN BEGIN
            </b></font>LastError <font color="#000080">:= </font>INVINAM<font color="#000080">;
            </font>Init <font color="#000080">:= </font>FALSE<font color="#000080">;
            </font>EXIT<font color="#000080">;
        </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
        </font>InName <font color="#000080">:= </font>Fname <font color="#000080">+ </font><font color="#800000">'.CFG'</font><font color="#000080">;
        </font>OutName <font color="#000080">:= </font>Fname <font color="#000080">+ </font><font color="#800000">'.CRP'</font><font color="#000080">;
 
        </font><font color="#008000"><i>{ Open the appropriate file(s) }
 
        </i></font><font color="#FF0000"><b>IF </b></font>Mode <font color="#000080">= </font>MASHMODE <font color="#FF0000"><b>THEN BEGIN
            </b></font>ASSIGN<font color="#000080">(</font>TFile<font color="#000080">, </font>InName<font color="#000080">); </font><font color="#008000"><i>{open data files}
            {$I-}
            </i></font>RESET<font color="#000080">(</font>TFile<font color="#000080">);
            </font><font color="#008000"><i>{$I+}
            </i></font>LastError <font color="#000080">:= </font>IORESULT<font color="#000080">;
            </font><font color="#FF0000"><b>IF </b></font>LastError <font color="#000080">&lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>THEN BEGIN
                </b></font><font color="#008000"><i>{crash if file error}
                </i></font>Init <font color="#000080">:= </font>FALSE<font color="#000080">;
                </font>EXIT<font color="#000080">;
            </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
            </font>ASSIGN<font color="#000080">(</font>BFile<font color="#000080">, </font>OutName<font color="#000080">);
            </font><font color="#008000"><i>{$I-}
            </i></font>REWRITE<font color="#000080">(</font>BFile<font color="#000080">, </font><font color="#800000">1</font><font color="#000080">);
            </font><font color="#008000"><i>{$I+}
            </i></font>LastError <font color="#000080">:= </font>IORESULT<font color="#000080">;
            </font><font color="#FF0000"><b>IF </b></font>LastError <font color="#000080">&lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>THEN BEGIN
                </b></font><font color="#008000"><i>{crash if file error}
                </i></font>Init <font color="#000080">:= </font>FALSE<font color="#000080">;
                </font>EXIT<font color="#000080">;
            </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
            </font>Init <font color="#000080">:= </font>TRUE<font color="#000080">;
        </font><font color="#FF0000"><b>END
        ELSE BEGIN
            </b></font>ASSIGN<font color="#000080">(</font>BFile<font color="#000080">, </font>OutName<font color="#000080">); </font><font color="#008000"><i>{open data files}
            {$I-}
            </i></font>RESET<font color="#000080">(</font>BFile<font color="#000080">, </font><font color="#800000">1</font><font color="#000080">);
            </font><font color="#008000"><i>{$I+}
            </i></font>LastError <font color="#000080">:= </font>IORESULT<font color="#000080">;
            </font><font color="#FF0000"><b>IF </b></font>LastError <font color="#000080">&lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>THEN BEGIN
                </b></font><font color="#008000"><i>{crash if file error}
                </i></font>Init <font color="#000080">:= </font>FALSE<font color="#000080">;
                </font>EXIT<font color="#000080">;
            </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
        </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
 
   
</font><font color="#008000"><i>(****************************************************************************)
 
    </i></font><font color="#FF0000"><b>FUNCTION </b></font>Mangler<font color="#000080">.</font>Getline<font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>Line <font color="#000080">: </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">) : </font>BOOLEAN<font color="#000080">;
        </font><font color="#008000"><i>{- Read a single line of binary gunk from the MSH file and decrypt it}
        {  Gozintas = Nothing                                                }
        {  Gozoutas:  Line = Decrypted ASCII string                          }
        {             Returns TRUE if everything was OK, FALSE if not        }
    </i></font><font color="#FF0000"><b>VAR
        </b></font>Result         <font color="#000080">: </font>WORD<font color="#000080">;
    </font><font color="#FF0000"><b>BEGIN
 
        </b></font>Line <font color="#000080">:= </font><font color="#800000">''</font><font color="#000080">;
        </font>Getline <font color="#000080">:= </font>FALSE<font color="#000080">;
 
        </font><font color="#FF0000"><b>IF </b></font>InitMode <font color="#000080">&lt;&gt; </font>UNMASHMODE <font color="#FF0000"><b>THEN BEGIN
            </b></font>LastError <font color="#000080">:= </font>INVINIT<font color="#000080">;
            </font>EXIT<font color="#000080">;
        </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
 
        </font>BLOCKREAD<font color="#000080">(</font>BFile<font color="#000080">, </font>Line<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">], </font><font color="#800000">1</font><font color="#000080">, </font>Result<font color="#000080">);
        </font><font color="#FF0000"><b>IF </b></font>Result <font color="#000080">&lt;&gt; </font><font color="#800000">1 </font><font color="#FF0000"><b>THEN BEGIN
            </b></font>LastError <font color="#000080">:= </font>CORRUPT<font color="#000080">;
            </font>EXIT<font color="#000080">;
        </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
 
        </font>BLOCKREAD<font color="#000080">(</font>BFile<font color="#000080">, </font>Line<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">], </font>ORD<font color="#000080">(</font>Line<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">]), </font>Result<font color="#000080">);
        </font><font color="#FF0000"><b>IF </b></font>Result <font color="#000080">= </font>ORD<font color="#000080">(</font>Line<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">]) </font><font color="#FF0000"><b>THEN BEGIN
            </b></font>Line <font color="#000080">:= </font>Mangle<font color="#000080">(</font>Line<font color="#000080">);
            </font>Getline <font color="#000080">:= </font>TRUE<font color="#000080">;
        </font><font color="#FF0000"><b>END
    END</b></font><font color="#000080">;
 
   
</font><font color="#008000"><i>(****************************************************************************)
 
    </i></font><font color="#FF0000"><b>FUNCTION </b></font>WTOA<font color="#000080">(</font>N <font color="#000080">: </font>WORD<font color="#000080">; </font>W <font color="#000080">: </font>INTEGER<font color="#000080">) : </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>VAR
        </b></font>Strg           <font color="#000080">: </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>BEGIN
        </b></font>STR<font color="#000080">(</font>N<font color="#000080">:</font>W<font color="#000080">, </font>Strg<font color="#000080">);
        </font>WTOA <font color="#000080">:= </font>Strg<font color="#000080">;
    </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
 
   
</font><font color="#008000"><i>(******************************************************************************)
 
    </i></font><font color="#FF0000"><b>FUNCTION </b></font>Mangler<font color="#000080">.</font>MashError<font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>S <font color="#000080">: </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">) : </font>BOOLEAN<font color="#000080">;
        </font><font color="#008000"><i>{- return the last error string }
    </i></font><font color="#FF0000"><b>BEGIN
        </b></font><font color="#008000"><i>{most of these messages are unlikely to occur.  You may remove most }
        {of them to save memory }

        </i></font>MashError <font color="#000080">:= </font>TRUE<font color="#000080">;
        </font><font color="#FF0000"><b>CASE </b></font>LastError <font color="#FF0000"><b>OF
            </b></font><font color="#800000">000 </font><font color="#000080">: </font><font color="#FF0000"><b>BEGIN </b></font><font color="#008000"><i>{no error}
                      </i></font>S <font color="#000080">:= </font><font color="#800000">''</font><font color="#000080">;
                      </font>MashError <font color="#000080">:= </font>FALSE<font color="#000080">; 
                  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
            </font><font color="#800000">002 </font><font color="#000080">: </font>S <font color="#000080">:= </font><font color="#800000">'File not found'</font><font color="#000080">;
            </font><font color="#800000">003 </font><font color="#000080">: </font>S <font color="#000080">:= </font><font color="#800000">'Path not found'</font><font color="#000080">;
            </font><font color="#800000">004 </font><font color="#000080">: </font>S <font color="#000080">:= </font><font color="#800000">'Too many open files'</font><font color="#000080">;
            </font><font color="#800000">005 </font><font color="#000080">: </font>S <font color="#000080">:= </font><font color="#800000">'File access denied'</font><font color="#000080">;
            </font><font color="#800000">006 </font><font color="#000080">: </font>S <font color="#000080">:= </font><font color="#800000">'Invalid file handle'</font><font color="#000080">;
            </font><font color="#800000">012 </font><font color="#000080">: </font>S <font color="#000080">:= </font><font color="#800000">'Invalid file access code'</font><font color="#000080">;
            </font><font color="#800000">015 </font><font color="#000080">: </font>S <font color="#000080">:= </font><font color="#800000">'Invalid drive number'</font><font color="#000080">;
            </font><font color="#800000">016 </font><font color="#000080">: </font>S <font color="#000080">:= </font><font color="#800000">'Cannot remove current directory'</font><font color="#000080">;
            </font><font color="#800000">017 </font><font color="#000080">: </font>S <font color="#000080">:= </font><font color="#800000">'Cannot rename across drives'</font><font color="#000080">;
            </font><font color="#800000">100 </font><font color="#000080">: </font>S <font color="#000080">:= </font><font color="#800000">'Disk read error'</font><font color="#000080">;
            </font><font color="#800000">101 </font><font color="#000080">: </font>S <font color="#000080">:= </font><font color="#800000">'Disk write error'</font><font color="#000080">;
            </font><font color="#800000">102 </font><font color="#000080">: </font>S <font color="#000080">:= </font><font color="#800000">'File not assigned'</font><font color="#000080">;
            </font><font color="#800000">103 </font><font color="#000080">: </font>S <font color="#000080">:= </font><font color="#800000">'File not open'</font><font color="#000080">;
            </font><font color="#800000">104 </font><font color="#000080">: </font>S <font color="#000080">:= </font><font color="#800000">'File not open for input'</font><font color="#000080">;
            </font><font color="#800000">105 </font><font color="#000080">: </font>S <font color="#000080">:= </font><font color="#800000">'File not open for output'</font><font color="#000080">;
            </font><font color="#800000">150 </font><font color="#000080">: </font>S <font color="#000080">:= </font><font color="#800000">'Disk is write-protected'</font><font color="#000080">;
            </font><font color="#800000">151 </font><font color="#000080">: </font>S <font color="#000080">:= </font><font color="#800000">'Unknown unit'</font><font color="#000080">;
            </font><font color="#800000">152 </font><font color="#000080">: </font>S <font color="#000080">:= </font><font color="#800000">'Drive not ready'</font><font color="#000080">;
            </font><font color="#800000">154 </font><font color="#000080">: </font>S <font color="#000080">:= </font><font color="#800000">'CRC error in data'</font><font color="#000080">;
            </font><font color="#800000">156 </font><font color="#000080">: </font>S <font color="#000080">:= </font><font color="#800000">'Disk seek error'</font><font color="#000080">;
            </font><font color="#800000">157 </font><font color="#000080">: </font>S <font color="#000080">:= </font><font color="#800000">'Unknown media type'</font><font color="#000080">;
            </font><font color="#800000">158 </font><font color="#000080">: </font>S <font color="#000080">:= </font><font color="#800000">'Sector not found'</font><font color="#000080">;
            </font><font color="#800000">160 </font><font color="#000080">: </font>S <font color="#000080">:= </font><font color="#800000">'Device write fault'</font><font color="#000080">;
            </font><font color="#800000">161 </font><font color="#000080">: </font>S <font color="#000080">:= </font><font color="#800000">'Device read fault'</font><font color="#000080">;
            </font><font color="#800000">162 </font><font color="#000080">: </font>S <font color="#000080">:= </font><font color="#800000">'Hardware failure'</font><font color="#000080">;
            </font><font color="#800000">203 </font><font color="#000080">: </font>S <font color="#000080">:= </font><font color="#800000">'Insufficient memory'</font><font color="#000080">;
            </font>INVINAM <font color="#000080">:</font>S <font color="#000080">:= </font><font color="#800000">'Invalid filename'</font><font color="#000080">;
            </font>INVINIT <font color="#000080">:</font>S <font color="#000080">:= </font><font color="#800000">'Invalid Mash unit init'</font><font color="#000080">;
            </font>CORRUPT <font color="#000080">: </font>S <font color="#000080">:= </font><font color="#800000">'Invalid or corrupt MSH file'</font><font color="#000080">;
            </font><font color="#FF0000"><b>ELSE
                </b></font>S <font color="#000080">:= </font><font color="#800000">'Turbo runtime error ' </font><font color="#000080">+ </font>WTOA<font color="#000080">(</font>LastError<font color="#000080">, </font><font color="#800000">4</font><font color="#000080">);
        </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
 
   
</font><font color="#008000"><i>(****************************************************************************)
 
    </i></font><font color="#FF0000"><b>PROCEDURE </b></font>Mangler<font color="#000080">.</font>SetSequence<font color="#000080">(</font>Seq <font color="#000080">: </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">);
        </font><font color="#008000"><i>{- Set the encryption sequence (key) to be something other than the
default   }
        {  Gozintas: A string (the longer the better) containing any characters
in    }
        {  the range of (0-255)  Try to avoid using strings that will be
duplicated   }
        {  in the text to be encrypted.  A match between the key and the text
results }
        {  in strings of $FF characters in the MSH file that make the key
easier to   }
        {  crack by determined hackers                                         
      }
 
    </i></font><font color="#FF0000"><b>BEGIN
        </b></font>Id <font color="#000080">:= </font>Seq<font color="#000080">;
    </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

   
</font><font color="#008000"><i>(****************************************************************************)
 
    </i></font><font color="#FF0000"><b>FUNCTION </b></font>Mangler<font color="#000080">.</font>MashFile <font color="#000080">: </font>BOOLEAN<font color="#000080">;
        </font><font color="#008000"><i>{- File conversion method.  Encrypts text file specified in Init method
call }
        {  and places encrypted binary junk into the .MSH file                 
     }
        {  Returns TRUE if success, FALSE if not                               
     }
    </i></font><font color="#FF0000"><b>VAR
        </b></font>Strg           <font color="#000080">: </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">;
        </font>Result         <font color="#000080">: </font>WORD<font color="#000080">;
    </font><font color="#FF0000"><b>BEGIN
        WHILE </b></font><font color="#000080">(</font><font color="#FF0000"><b>NOT </b></font>EOF<font color="#000080">(</font>TFile<font color="#000080">)) </font><font color="#FF0000"><b>DO BEGIN
            </b></font>READLN<font color="#000080">(</font>TFile<font color="#000080">, </font>Strg<font color="#000080">);
            </font>WRITELN<font color="#000080">(</font>Strg<font color="#000080">);
            </font>Strg <font color="#000080">:= </font>Mangle<font color="#000080">(</font>Strg<font color="#000080">);
            </font>BLOCKWRITE<font color="#000080">(</font>BFile<font color="#000080">, </font>Strg<font color="#000080">, </font>ORD<font color="#000080">(</font>Strg<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">]) + </font><font color="#800000">1</font><font color="#000080">, </font>Result<font color="#000080">);
            </font><font color="#FF0000"><b>IF </b></font>Result <font color="#000080">&lt;&gt; </font>LENGTH<font color="#000080">(</font>Strg<font color="#000080">) + </font><font color="#800000">1 </font><font color="#FF0000"><b>THEN BEGIN
                </b></font>WRITELN<font color="#000080">(</font><font color="#800000">'Problem writing ' </font><font color="#000080">+ </font>FileName <font color="#000080">+ </font><font color="#800000">'.MSH'</font><font color="#000080">);
                </font>HALT<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">);
            </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
        </font><font color="#FF0000"><b>END</b></font><font color="#000080">;                      </font><font color="#008000"><i>{while}
 
    </i></font><font color="#FF0000"><b>END</b></font><font color="#000080">;
 
   
</font><font color="#008000"><i>(****************************************************************************)
 
    </i></font><font color="#FF0000"><b>PROCEDURE </b></font>Mangler<font color="#000080">.</font>Done<font color="#000080">;
        </font><font color="#008000"><i>{- Close up shop and boogie method}
    </i></font><font color="#FF0000"><b>BEGIN
        </b></font>CLOSE<font color="#000080">(</font>BFile<font color="#000080">);
        </font><font color="#FF0000"><b>IF </b></font>InitMode <font color="#000080">= </font>MASHMODE <font color="#FF0000"><b>THEN
            </b></font>CLOSE<font color="#000080">(</font>TFile<font color="#000080">);
 
        </font>InitMode <font color="#000080">:= </font>SOURMASH<font color="#000080">;
    </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
 
   
</font><font color="#008000"><i>(****************************************************************************)
    {unit initialization}
</i></font><font color="#FF0000"><b>END</b></font><font color="#000080">.                              </font><font color="#008000"><i>{of unit mash}
(****************************************************************************)
(****************************************************************************)
</i></font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to ENCRYPT SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0018.PAS">Original</a><b>]</b></p></body>
</html>
