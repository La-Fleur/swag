<html>
<head><title> "ENDECODE.PAS" by SWAG SUPPORT TEAM</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to ENCRYPT SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0008.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#FF0000"><b>Unit </b></font>endecode<font color="#000080">;
 </font><font color="#008000"><i>{ Simple encryption/decryption routines.                  }

</i></font><font color="#FF0000"><b>Interface

Type
  </b></font>stArray <font color="#000080">= </font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">255</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Byte<font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>Key<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>s<font color="#000080">): </font>LongInt<font color="#000080">;
</font><font color="#FF0000"><b>Function </b></font>EncryptStr<font color="#000080">(</font>key <font color="#000080">: </font>LongInt<font color="#000080">; </font>s<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">): </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Function </b></font>DecryptStr<font color="#000080">(</font>key <font color="#000080">: </font>LongInt<font color="#000080">; </font>s<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">): </font><font color="#FF0000"><b>String</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Implementation

Function </b></font>MakeCodeStr<font color="#000080">(</font>key <font color="#000080">: </font>LongInt<font color="#000080">; </font><font color="#FF0000"><b>Var </b></font>s<font color="#000080">): </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
  </font><font color="#008000"><i>{--------------------------------------------------------}
  { Creates a &quot;randomly&quot; Constructed String of a similar   }
  { length as the String which is to be encrypted. A       }
  { LongInt key is used to permit &quot;passWord&quot; Type          }
  { encryption. This key may be passed as a literal or     }
  { some passWord used to calculate it. Using this key,    }
  { the last Character of the String to be encrypted and   }
  { the length of the String, a &quot;code String&quot; is produced. }
  { This code String is then xord With the original String }
  { to produce the encrypted String. The last Character    }
  { however must be treated differently so that it can be  }
  { easily decoded in order to reproduce the coded String  }
  { used For decoding. This is done by xoring it With the  }
  { length of the String. to decrypt a String the last     }
  { Character must be decoded first and then the key coded }
  { String produced in order to decrypt each Character.    }
  {--------------------------------------------------------}

  </i></font><font color="#FF0000"><b>Var
    </b></font>x   <font color="#000080">: </font>Word<font color="#000080">;
    </font>len <font color="#000080">: </font>Byte <font color="#FF0000"><b>Absolute </b></font>s<font color="#000080">;
    </font>st  <font color="#000080">: </font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">255</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Byte <font color="#FF0000"><b>Absolute </b></font>s<font color="#000080">;

  </font><font color="#FF0000"><b>begin
    </b></font>RandSeed <font color="#000080">:= (</font>key <font color="#000080">* </font>len<font color="#000080">) </font><font color="#FF0000"><b>div </b></font>st<font color="#000080">[</font>len<font color="#000080">];
    </font><font color="#008000"><i>{This ensures that no two code Strings will be similar UNLESS they are
     of identical length, have identical last Characters and the same
     key is used.}
    </i></font>MakeCodeStr<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">] := </font>chr<font color="#000080">(</font>len<font color="#000080">);
    </font><font color="#FF0000"><b>For </b></font>x <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>len <font color="#FF0000"><b>do
      </b></font>MakeCodeStr<font color="#000080">[</font>x<font color="#000080">] := </font>chr<font color="#000080">(</font><font color="#800000">32 </font><font color="#000080">+ </font>Random<font color="#000080">(</font><font color="#800000">95</font><font color="#000080">));
      </font><font color="#008000"><i>{Keeping the Character between 32 and 127 ensures that the high bit
       is never set on the original encrypted Character and thereFore allows
       this to be used as flag to indicate that the coded Char was &lt; #32.
       This will then permit the encrypted String to be printed without fear
       of having embedded control codes play havoc With the Printer.}
  </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>Key<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>s<font color="#000080">): </font>LongInt<font color="#000080">;
  </font><font color="#008000"><i>{ Creates a key For seeding the random number generator. st can be a
    passWord }
  </i></font><font color="#FF0000"><b>Var
    </b></font>x     <font color="#000080">: </font>Byte<font color="#000080">;
    </font>temp  <font color="#000080">: </font>LongInt<font color="#000080">;
    </font>c     <font color="#000080">: </font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">64</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>LongInt <font color="#FF0000"><b>Absolute </b></font>s<font color="#000080">;
    </font>len   <font color="#000080">: </font>Byte <font color="#FF0000"><b>Absolute </b></font>s<font color="#000080">;
  </font><font color="#FF0000"><b>begin
    </b></font>temp  <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
    </font><font color="#FF0000"><b>For </b></font>x <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>len <font color="#FF0000"><b>div </b></font><font color="#800000">4 </font><font color="#FF0000"><b>do
      </b></font>temp <font color="#000080">:= </font>temp <font color="#FF0000"><b>xor </b></font>c<font color="#000080">[</font>x<font color="#000080">];
    </font>Key <font color="#000080">:= </font>Abs<font color="#000080">(</font>temp<font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>EncryptStr<font color="#000080">(</font>key <font color="#000080">: </font>LongInt<font color="#000080">; </font>s<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">): </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>Var
    </b></font>cnt<font color="#000080">,</font>x          <font color="#000080">: </font>Byte<font color="#000080">;
    </font>len            <font color="#000080">: </font>Byte <font color="#FF0000"><b>Absolute </b></font>s<font color="#000080">;
    </font>st             <font color="#000080">: </font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">255</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Byte <font color="#FF0000"><b>Absolute </b></font>s<font color="#000080">;
    </font>CodeStr        <font color="#000080">: </font>stArray<font color="#000080">;
    </font>temp           <font color="#000080">: </font><font color="#FF0000"><b>String Absolute </b></font>CodeStr<font color="#000080">;
  </font><font color="#FF0000"><b>begin
    </b></font>temp           <font color="#000080">:= </font>MakeCodeStr<font color="#000080">(</font>key<font color="#000080">,</font>st<font color="#000080">);
    </font>EncryptStr<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">]  := </font>chr<font color="#000080">(</font>len<font color="#000080">);
    </font>EncryptStr<font color="#000080">[</font>len<font color="#000080">]:= </font>chr<font color="#000080">(</font>st<font color="#000080">[</font>len<font color="#000080">]);
    </font><font color="#FF0000"><b>For </b></font>x <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>len<font color="#000080">-</font><font color="#800000">1 </font><font color="#FF0000"><b>do begin
      </b></font>cnt <font color="#000080">:= </font>st<font color="#000080">[</font>x<font color="#000080">] </font><font color="#FF0000"><b>xor </b></font>CodeStr<font color="#000080">[</font>x<font color="#000080">];
      </font>inc<font color="#000080">(</font>cnt<font color="#000080">,</font><font color="#800000">128 </font><font color="#000080">* </font>ord<font color="#000080">(</font>cnt <font color="#000080">&lt; </font><font color="#800000">32</font><font color="#000080">));
      </font>EncryptStr<font color="#000080">[</font>x<font color="#000080">]:= </font>chr<font color="#000080">(</font>cnt<font color="#000080">);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;  </font><font color="#008000"><i>{ For }
    </i></font>cnt <font color="#000080">:= </font>st<font color="#000080">[</font>len<font color="#000080">] </font><font color="#FF0000"><b>xor </b></font><font color="#000080">(</font>len <font color="#FF0000"><b>and </b></font><font color="#800000">127</font><font color="#000080">);
    </font>inc<font color="#000080">(</font>cnt<font color="#000080">,</font><font color="#800000">128 </font><font color="#000080">* </font>ord<font color="#000080">(</font>cnt <font color="#000080">&lt; </font><font color="#800000">32</font><font color="#000080">));
    </font>EncryptStr<font color="#000080">[</font>len<font color="#000080">]:= </font>chr<font color="#000080">(</font>cnt<font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>DecryptStr<font color="#000080">(</font>key <font color="#000080">: </font>LongInt<font color="#000080">; </font>s<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">): </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>Var
    </b></font>cnt<font color="#000080">,</font>x        <font color="#000080">: </font>Byte<font color="#000080">;
    </font>st           <font color="#000080">: </font>stArray <font color="#FF0000"><b>Absolute </b></font>s<font color="#000080">;
    </font>len          <font color="#000080">: </font>Byte <font color="#FF0000"><b>Absolute </b></font>s<font color="#000080">;
    </font>CodeStr      <font color="#000080">: </font>stArray<font color="#000080">;
    </font>temp         <font color="#000080">: </font><font color="#FF0000"><b>String Absolute </b></font>CodeStr<font color="#000080">;
    </font>ch           <font color="#000080">: </font>Char<font color="#000080">;
  </font><font color="#FF0000"><b>begin
    </b></font>cnt          <font color="#000080">:= </font>st<font color="#000080">[</font>len<font color="#000080">] </font><font color="#FF0000"><b>and </b></font><font color="#800000">127</font><font color="#000080">;
    </font>st<font color="#000080">[</font>len<font color="#000080">]      := </font>cnt <font color="#FF0000"><b>xor </b></font>len<font color="#000080">;
    </font>temp         <font color="#000080">:= </font>MakeCodeStr<font color="#000080">(</font>key<font color="#000080">,</font>st<font color="#000080">);
    </font>DecryptStr<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">]:= </font>chr<font color="#000080">(</font>len<font color="#000080">);
    </font>DecryptStr<font color="#000080">[</font>len<font color="#000080">]:= </font>chr<font color="#000080">(</font>st<font color="#000080">[</font>len<font color="#000080">]);
    </font><font color="#FF0000"><b>For </b></font>x <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>len<font color="#000080">-</font><font color="#800000">1 </font><font color="#FF0000"><b>do begin
      </b></font>cnt        <font color="#000080">:= </font>st<font color="#000080">[</font>x<font color="#000080">];
      </font>dec<font color="#000080">(</font>cnt<font color="#000080">,</font><font color="#800000">128 </font><font color="#000080">* </font>ord<font color="#000080">(</font>st<font color="#000080">[</font>x<font color="#000080">] &gt; </font><font color="#800000">127</font><font color="#000080">));
      </font>DecryptStr<font color="#000080">[</font>x<font color="#000080">] := </font>chr<font color="#000080">(</font>cnt <font color="#FF0000"><b>xor </b></font>CodeStr<font color="#000080">[</font>x<font color="#000080">]);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;  </font><font color="#008000"><i>{ For }
  </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>end</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to ENCRYPT SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0008.PAS">Original</a><b>]</b></p></body>
</html>
