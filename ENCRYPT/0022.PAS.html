<html>
<head><title> "File decoding" by OZZ NIXON</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to ENCRYPT SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0022.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code>
<font color="#FF0000"><b>uses
   </b></font>crt<font color="#000080">,
   </font>dos<font color="#000080">;

</font><font color="#FF0000"><b>var
  </b></font>key<font color="#000080">:</font><font color="#FF0000"><b>string</b></font><font color="#000080">[</font><font color="#800000">8</font><font color="#000080">];

</font><font color="#008000"><i>{ decode file ---------------------------------------------------------------}
{your code here}
</i></font><font color="#FF0000"><b>procedure </b></font>decode<font color="#000080">(</font>infname<font color="#000080">:</font>pathstr<font color="#000080">);
</font><font color="#FF0000"><b>var
  </b></font>infile<font color="#000080">,</font>outfile<font color="#000080">:</font><font color="#FF0000"><b>file</b></font><font color="#000080">;
  </font>fdir<font color="#000080">:</font>dirstr<font color="#000080">; </font>fname<font color="#000080">:</font>namestr<font color="#000080">; </font>fext<font color="#000080">:</font>extstr<font color="#000080">;
  </font>dbuf<font color="#000080">,</font>sbuf<font color="#000080">:</font>pointer<font color="#000080">;
  </font>idx<font color="#000080">,</font>i<font color="#000080">,</font>j<font color="#000080">,</font>srcseg<font color="#000080">,</font>srcofs<font color="#000080">,</font>dstseg<font color="#000080">,</font>dstofs<font color="#000080">,</font>start<font color="#000080">,</font>csize<font color="#000080">:</font>word<font color="#000080">;
  </font>src<font color="#000080">,</font>rep<font color="#000080">:</font>byte<font color="#000080">;
</font><font color="#FF0000"><b>begin
  if </b></font>maxavail<font color="#000080">&lt;</font><font color="#800000">2</font><font color="#000080">*</font><font color="#800000">65500 </font><font color="#FF0000"><b>then Begin
     </b></font>Writeln<font color="#000080">(</font><font color="#800000">#13#10</font><font color="#000080">,</font><font color="#800000">'No Memory'</font><font color="#000080">);
     </font>halt<font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
  </font>getmem<font color="#000080">(</font>dbuf<font color="#000080">,</font><font color="#800000">65500</font><font color="#000080">);
  </font>getmem<font color="#000080">(</font>sbuf<font color="#000080">,</font><font color="#800000">65500</font><font color="#000080">);
  </font>srcseg<font color="#000080">:=</font>seg<font color="#000080">(</font>sbuf<font color="#000080">^); </font>srcofs<font color="#000080">:=</font>ofs<font color="#000080">(</font>sbuf<font color="#000080">^);
  </font>dstseg<font color="#000080">:=</font>seg<font color="#000080">(</font>dbuf<font color="#000080">^); </font>dstofs<font color="#000080">:=</font>ofs<font color="#000080">(</font>dbuf<font color="#000080">^); </font>start<font color="#000080">:=</font>dstofs<font color="#000080">;
  </font>assign<font color="#000080">(</font>infile<font color="#000080">,</font>infname<font color="#000080">);
  </font><font color="#008000"><i>{$i-} </i></font>reset<font color="#000080">(</font>infile<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">); </font><font color="#008000"><i>{$i+}
  </i></font><font color="#FF0000"><b>if </b></font>ioresult<font color="#000080">&lt;&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>then Begin
     </b></font>Writeln<font color="#000080">(</font><font color="#800000">#13#10'File I/O!'</font><font color="#000080">);
     </font>halt<font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font>filesize<font color="#000080">(</font>infile<font color="#000080">)&gt;</font><font color="#800000">65500 </font><font color="#FF0000"><b>then </b></font>halt<font color="#000080">;
  </font>blockread<font color="#000080">(</font>infile<font color="#000080">,</font>sbuf<font color="#000080">^,</font>filesize<font color="#000080">(</font>infile<font color="#000080">));
  </font>csize<font color="#000080">:=</font>filesize<font color="#000080">(</font>infile<font color="#000080">);
  </font>close<font color="#000080">(</font>infile<font color="#000080">);
  </font>randseed<font color="#000080">:=</font>ord<font color="#000080">(</font>key<font color="#000080">[</font>length<font color="#000080">(</font>key<font color="#000080">)]); </font>j<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
  </font><font color="#FF0000"><b>for </b></font>i<font color="#000080">:=</font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font>csize <font color="#FF0000"><b>do begin
    </b></font>mem<font color="#000080">[</font>srcseg<font color="#000080">:</font>srcofs<font color="#000080">+</font>i<font color="#000080">]:=</font>mem<font color="#000080">[</font>srcseg<font color="#000080">:</font>srcofs<font color="#000080">+</font>i<font color="#000080">] </font><font color="#FF0000"><b>xor
</b></font><font color="#000080">(</font>ord<font color="#000080">(</font>key<font color="#000080">[</font>j<font color="#000080">])+</font>random<font color="#000080">(</font>ord<font color="#000080">(</font>key<font color="#000080">[</font>j<font color="#000080">])));
    </font>j<font color="#000080">:=</font><font color="#800000">1</font><font color="#000080">+</font>j <font color="#FF0000"><b>mod </b></font><font color="#800000">8</font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>idx<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
  </font><font color="#FF0000"><b>while </b></font>idx<font color="#000080">&lt;</font>csize <font color="#FF0000"><b>do begin
    </b></font>src<font color="#000080">:=</font>mem<font color="#000080">[</font>srcseg<font color="#000080">:</font>srcofs<font color="#000080">+</font>idx<font color="#000080">];
    </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>src <font color="#FF0000"><b>and </b></font><font color="#800000">$f0</font><font color="#000080">)=</font><font color="#800000">$f0 </font><font color="#FF0000"><b>then begin
      </b></font>rep<font color="#000080">:=</font>src <font color="#FF0000"><b>and </b></font><font color="#800000">$f</font><font color="#000080">;
      </font>src<font color="#000080">:=</font>mem<font color="#000080">[</font>srcseg<font color="#000080">:</font>srcofs<font color="#000080">+</font>idx<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">];
      </font>fillchar<font color="#000080">(</font>mem<font color="#000080">[</font>dstseg<font color="#000080">:</font>dstofs<font color="#000080">],</font>rep<font color="#000080">,</font>src<font color="#000080">);
      </font>inc<font color="#000080">(</font>dstofs<font color="#000080">,</font>rep<font color="#000080">);
      </font>inc<font color="#000080">(</font>idx<font color="#000080">,</font><font color="#800000">2</font><font color="#000080">);
    </font><font color="#FF0000"><b>end
    else begin
      </b></font>mem<font color="#000080">[</font>dstseg<font color="#000080">:</font>dstofs<font color="#000080">]:=</font>src<font color="#000080">;
      </font>inc<font color="#000080">(</font>dstofs<font color="#000080">);
      </font>inc<font color="#000080">(</font>idx<font color="#000080">);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>csize<font color="#000080">:=</font>dstofs<font color="#000080">-</font>start<font color="#000080">;
  </font>fsplit<font color="#000080">(</font>infname<font color="#000080">,</font>fdir<font color="#000080">,</font>fname<font color="#000080">,</font>fext<font color="#000080">);
  </font>assign<font color="#000080">(</font>outfile<font color="#000080">,</font>fdir<font color="#000080">+</font>fname<font color="#000080">+</font><font color="#800000">'.org'</font><font color="#000080">);
  </font><font color="#008000"><i>{$i-} </i></font>reset<font color="#000080">(</font>outfile<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">); </font><font color="#008000"><i>{$i+}
  {$i-} </i></font>seek<font color="#000080">(</font>outfile<font color="#000080">,</font>FileSize<font color="#000080">(</font>outfile<font color="#000080">)); </font><font color="#008000"><i>{$i+} {append to 1 long output!}
  </i></font><font color="#FF0000"><b>if </b></font>ioresult<font color="#000080">&lt;&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>then Begin
     </b></font>Writeln<font color="#000080">(</font><font color="#800000">#13#10'Output Error!'</font><font color="#000080">);
     </font>halt<font color="#000080">(</font><font color="#800000">4</font><font color="#000080">);
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
  </font>blockwrite<font color="#000080">(</font>outfile<font color="#000080">,</font>key<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">],</font>length<font color="#000080">(</font>key<font color="#000080">)); </font><font color="#008000"><i>{so I know which key did it!}
  </i></font>blockwrite<font color="#000080">(</font>outfile<font color="#000080">,</font>dbuf<font color="#000080">^,</font>csize<font color="#000080">);        </font><font color="#008000"><i>{un encoded}
  </i></font>close<font color="#000080">(</font>outfile<font color="#000080">);
  </font>freemem<font color="#000080">(</font>sbuf<font color="#000080">,</font><font color="#800000">65500</font><font color="#000080">);
  </font>freemem<font color="#000080">(</font>dbuf<font color="#000080">,</font><font color="#800000">65500</font><font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{ main ----------------------------------------------------------------------}

</i></font><font color="#FF0000"><b>Procedure </b></font>ShowFile<font color="#000080">(</font>FName<font color="#000080">:</font><font color="#FF0000"><b>String</b></font><font color="#000080">); </font><font color="#008000"><i>{just a test ... not used in live version!}
</i></font><font color="#FF0000"><b>Var
   </b></font>T<font color="#000080">:</font>Text<font color="#000080">;
   </font>S<font color="#000080">:</font><font color="#FF0000"><b>String</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Begin
   </b></font>Assign<font color="#000080">(</font>T<font color="#000080">,</font>FName<font color="#000080">);
   </font>ReSet<font color="#000080">(</font>T<font color="#000080">);
   </font><font color="#FF0000"><b>While not </b></font>eof<font color="#000080">(</font>t<font color="#000080">) </font><font color="#FF0000"><b>do begin
</b></font><font color="#008000"><i>{$I-}      </i></font>Readln<font color="#000080">(</font>t<font color="#000080">,</font>s<font color="#000080">); </font><font color="#008000"><i>{$I+}
      </i></font>Writeln<font color="#000080">(</font>s<font color="#000080">);
   </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
   </font>Close<font color="#000080">(</font>T<font color="#000080">);
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Var
   </b></font>Cnt1<font color="#000080">:</font>Integer<font color="#000080">;        </font><font color="#008000"><i>{character 1}
   </i></font>Cnt2<font color="#000080">:</font>Integer<font color="#000080">;        </font><font color="#008000"><i>{2}
   </i></font>Cnt3<font color="#000080">:</font>Integer<font color="#000080">;        </font><font color="#008000"><i>{3}
   </i></font>Cnt4<font color="#000080">:</font>Integer<font color="#000080">;        </font><font color="#008000"><i>{4}
   </i></font>Cnt5<font color="#000080">:</font>Integer<font color="#000080">;        </font><font color="#008000"><i>{5}
   </i></font>Cnt6<font color="#000080">:</font>Integer<font color="#000080">;        </font><font color="#008000"><i>{6}
   </i></font>Cnt7<font color="#000080">:</font>Integer<font color="#000080">;        </font><font color="#008000"><i>{7}
   </i></font>Cnt8<font color="#000080">:</font>Integer<font color="#000080">;        </font><font color="#008000"><i>{8}
   </i></font>Ch<font color="#000080">:</font>Char<font color="#000080">;             </font><font color="#008000"><i>{did I press a local key?}
   </i></font>outfile<font color="#000080">:</font><font color="#FF0000"><b>file</b></font><font color="#000080">;        </font><font color="#008000"><i>{just for making an empty file to append to}
   </i></font>Dumb<font color="#000080">:</font>Byte<font color="#000080">;           </font><font color="#008000"><i>{dumb!}
   </i></font>done<font color="#000080">:</font>boolean<font color="#000080">;        </font><font color="#008000"><i>{tried from '' to #255#255#255#255#255#255#255#255}

</i></font><font color="#FF0000"><b>begin
   </b></font>assign<font color="#000080">(</font>outfile<font color="#000080">,</font><font color="#800000">'hack.org'</font><font color="#000080">);
   </font><font color="#008000"><i>{$i-} </i></font>rewrite<font color="#000080">(</font>outfile<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">); </font><font color="#008000"><i>{$i+}
   </i></font>Close<font color="#000080">(</font>outfile<font color="#000080">); </font><font color="#008000"><i>{made a 0 byte file to append to}
{init}
   </i></font>Cnt1<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
   </font>Cnt2<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
   </font>Cnt3<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
   </font>Cnt4<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
   </font>Cnt5<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
   </font>Cnt6<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
   </font>Cnt7<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
   </font>Cnt8<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
   </font>done<font color="#000080">:=</font>false<font color="#000080">;
   </font><font color="#FF0000"><b>While not </b></font>done <font color="#FF0000"><b>do begin
</b></font><font color="#008000"><i>{not I inc 1 char at a time}
      </i></font>Inc<font color="#000080">(</font>Cnt1<font color="#000080">);
      </font><font color="#FF0000"><b>If </b></font>Cnt1<font color="#000080">&gt;</font><font color="#800000">255 </font><font color="#FF0000"><b>then Begin
  </b></font>Cnt1<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
  </font>Inc<font color="#000080">(</font>Cnt2<font color="#000080">);
      </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>If </b></font>Cnt2<font color="#000080">&gt;</font><font color="#800000">255 </font><font color="#FF0000"><b>then Begin
  </b></font>Cnt2<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
  </font>Inc<font color="#000080">(</font>Cnt3<font color="#000080">);
      </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>If </b></font>Cnt3<font color="#000080">&gt;</font><font color="#800000">255 </font><font color="#FF0000"><b>then Begin
  </b></font>Cnt3<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
  </font>Inc<font color="#000080">(</font>Cnt4<font color="#000080">);
      </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>If </b></font>Cnt4<font color="#000080">&gt;</font><font color="#800000">255 </font><font color="#FF0000"><b>then Begin
  </b></font>Cnt4<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
  </font>Inc<font color="#000080">(</font>Cnt5<font color="#000080">);
      </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>If </b></font>Cnt5<font color="#000080">&gt;</font><font color="#800000">255 </font><font color="#FF0000"><b>then Begin
  </b></font>Cnt5<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
  </font>Inc<font color="#000080">(</font>Cnt6<font color="#000080">);
      </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>If </b></font>Cnt6<font color="#000080">&gt;</font><font color="#800000">255 </font><font color="#FF0000"><b>then Begin
  </b></font>Cnt6<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
  </font>Inc<font color="#000080">(</font>Cnt7<font color="#000080">);
      </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>If </b></font>Cnt7<font color="#000080">&gt;</font><font color="#800000">255 </font><font color="#FF0000"><b>then Begin
  </b></font>Cnt7<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
  </font>Inc<font color="#000080">(</font>Cnt8<font color="#000080">);
      </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>If </b></font>Cnt8<font color="#000080">&gt;</font><font color="#800000">255 </font><font color="#FF0000"><b>then </b></font>Halt<font color="#000080">;
      </font>Key<font color="#000080">:=</font><font color="#800000">''</font><font color="#000080">;
      </font><font color="#FF0000"><b>If </b></font>Cnt1<font color="#000080">&lt;&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>key<font color="#000080">:=</font>key<font color="#000080">+</font>chr<font color="#000080">(</font>cnt1<font color="#000080">);
      </font><font color="#FF0000"><b>If </b></font>Cnt2<font color="#000080">&lt;&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>key<font color="#000080">:=</font>key<font color="#000080">+</font>chr<font color="#000080">(</font>cnt2<font color="#000080">);
      </font><font color="#FF0000"><b>If </b></font>Cnt3<font color="#000080">&lt;&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>key<font color="#000080">:=</font>key<font color="#000080">+</font>chr<font color="#000080">(</font>cnt3<font color="#000080">);
      </font><font color="#FF0000"><b>If </b></font>Cnt4<font color="#000080">&lt;&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>key<font color="#000080">:=</font>key<font color="#000080">+</font>chr<font color="#000080">(</font>cnt4<font color="#000080">);
      </font><font color="#FF0000"><b>If </b></font>Cnt5<font color="#000080">&lt;&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>key<font color="#000080">:=</font>key<font color="#000080">+</font>chr<font color="#000080">(</font>cnt5<font color="#000080">);
      </font><font color="#FF0000"><b>If </b></font>Cnt6<font color="#000080">&lt;&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>key<font color="#000080">:=</font>key<font color="#000080">+</font>chr<font color="#000080">(</font>cnt6<font color="#000080">);
      </font><font color="#FF0000"><b>If </b></font>Cnt7<font color="#000080">&lt;&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>key<font color="#000080">:=</font>key<font color="#000080">+</font>chr<font color="#000080">(</font>cnt7<font color="#000080">);
      </font><font color="#FF0000"><b>If </b></font>Cnt8<font color="#000080">&lt;&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>key<font color="#000080">:=</font>key<font color="#000080">+</font>chr<font color="#000080">(</font>cnt8<font color="#000080">);
</font><font color="#008000"><i>{call your decode method}
      </i></font>Decode<font color="#000080">(</font><font color="#800000">'HACK.DAT'</font><font color="#000080">);
      </font><font color="#008000"><i>{ShowFile('HACK.ORG');}
{so I can see its running:}
      </i></font>Writeln<font color="#000080">(</font><font color="#800000">'KEY: '</font><font color="#000080">,</font>Key<font color="#000080">);
      </font><font color="#FF0000"><b>If </b></font>Keypressed <font color="#FF0000"><b>then Begin
  </b></font>Ch<font color="#000080">:=</font>Readkey<font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font>ch<font color="#000080">=</font><font color="#800000">#27 </font><font color="#FF0000"><b>then </b></font>halt<font color="#000080">;
      </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
   </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
</font><font color="#008000"><i>(*  if (paramcount&lt;&gt;2) or (pos('?',paramstr(1))&gt;0) then begin
    writeln('Syntax: DECODE &lt;filename&gt; &lt;key&gt;');
    writeln('Both parameters are required!');
    halt;
  end;
  key:=paramstr(2);
  decode(paramstr(1));
  writeln('File successfully decoded!'); *)
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to ENCRYPT SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0022.PAS">Original</a><b>]</b></p></body>
</html>
