<html>
<head><title> "Fast File Encryption" by SUNE MARCHER</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to ENCRYPT SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0029.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{$g+,a+}
</i></font><font color="#FF0000"><b>unit </b></font>crypt<font color="#000080">;

</font><font color="#FF0000"><b>INTERFACE

procedure </b></font>maketable<font color="#000080">(</font><font color="#FF0000"><b>const </b></font>seed<font color="#000080">:</font>word<font color="#000080">);
</font><font color="#FF0000"><b>procedure </b></font>encrypt<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>data<font color="#000080">;</font><font color="#FF0000"><b>const </b></font>size<font color="#000080">,</font>xoa<font color="#000080">:</font>word<font color="#000080">);
</font><font color="#FF0000"><b>procedure </b></font>setslide<font color="#000080">(</font><font color="#FF0000"><b>const </b></font>slide<font color="#000080">:</font>word<font color="#000080">);
</font><font color="#FF0000"><b>function  </b></font>maxslide<font color="#000080">:</font>word<font color="#000080">;

</font><font color="#FF0000"><b>IMPLEMENTATION

const
  </b></font>maxx<font color="#000080">=</font><font color="#800000">2028</font><font color="#000080">; </font><font color="#008000"><i>{ Max is a word! }
</i></font><font color="#FF0000"><b>var
  </b></font>xortable<font color="#000080">:</font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font>maxx<font color="#000080">]</font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">;
  </font>slidepos<font color="#000080">:</font>word<font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>maketable<font color="#000080">(</font><font color="#FF0000"><b>const </b></font>seed<font color="#000080">:</font>word<font color="#000080">); </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>asm
  </b></font><font color="#FF00FF">mov ax,seg xortable
  mov es,ax
  mov di,offset xortable
  xor cx,cx
  mov cx,maxx
  mov si,seed
  xor ax,ax
  @@loop:
    not ax
    inc ax
    neg ax
    add ax,cx
    and ax,si
    ror si,3
    rol ax,2
    xor ax,si
    inc si
    mov es:[di],al
    inc di
    dec cx
  jnz @@loop
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>encrypt<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>data<font color="#000080">;</font><font color="#FF0000"><b>const </b></font>size<font color="#000080">,</font>xoa<font color="#000080">:</font>word<font color="#000080">); </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#008000"><i>{
  ds:si =&gt; pointer to XorTable
  es:di =&gt; pointer to data
  ax    =&gt; temporary
           =&gt; al is used for the thing that get changed,
              ah to hold a byte from the XORTABLE.
  bx    =&gt; used for temporary calculation.
  cx    =&gt; holds total end-up size for loop-end-check :-)
  dx    =&gt; holds additional XOR value. }
</i></font><font color="#FF0000"><b>asm
  </b></font><font color="#FF00FF">mov ax,seg [xortable]
  mov ds,ax
  mov si,offset [xortable]
  les di,[data]
  mov cx,di
  add cx,[size]
  mov dx,[xoa]
  jmp @@loop
  @@zeroit:
    mov [slidepos],0
  @@loop:
    cmp [slidepos],maxx
    jg @@zeroit </font><font color="#008000"><i>{ Slidepos become to big? }
    </i></font><font color="#FF00FF">mov bx,si
    add bx,slidepos
    mov ah,ds:[bx]
    mov bx,[slidepos]

    mov al,es:[di]
    not al
    xor al,ah
    xor al,dl
    xor al,bl
    xor al,dh
    not al
    xor al,bh
    mov es:[di],al
    inc [slidepos]
    inc di
    cmp di,cx
    jb @@loop
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>setslide<font color="#000080">(</font><font color="#FF0000"><b>const </b></font>slide<font color="#000080">:</font>word<font color="#000080">); </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>asm
  </b></font><font color="#FF00FF">cmp [slide],maxx
  ja @@exit2
  mov ax,[slide]
  mov [slidepos],ax
  jmp @@exit
  @@exit2:
    mov [slidepos],0
  @@exit:
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>maxslide<font color="#000080">:</font>word<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>asm
  </b></font><font color="#FF00FF">mov ax,[maxx]
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>begin
  </b></font>slidepos<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">.</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to ENCRYPT SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0029.PAS">Original</a><b>]</b></p></body>
</html>
