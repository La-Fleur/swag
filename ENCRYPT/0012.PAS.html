<html>
<head><title> "PATCHEXE.PAS" by SWAG SUPPORT TEAM</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to ENCRYPT SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0012.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{ PD&gt; This looks like something I would like to add to my Programs.  My
 PD&gt; question is, how do you modify the .exe from the Program.  I can do the
 PD&gt; encryption but don't know how to store the encrypted passWords in the
 PD&gt; Program's own .exe.  Any help would be appreciated.
}

</i></font><font color="#FF0000"><b>Procedure </b></font>PatchExeFile<font color="#000080">(</font>ItemAddr<font color="#000080">:</font>Pointer<font color="#000080">;</font>itemsize<font color="#000080">:</font>LongInt<font color="#000080">);
</font><font color="#FF0000"><b>Var
  </b></font>FiletoPatch <font color="#000080">: </font><font color="#FF0000"><b>File</b></font><font color="#000080">;
  </font>HeaderSize  <font color="#000080">: </font>Word<font color="#000080">;
  </font>seeksize    <font color="#000080">: </font>LongInt<font color="#000080">;
  </font>offset      <font color="#000080">: </font>Word<font color="#000080">;
  </font>LDseg       <font color="#000080">: </font>LongInt<font color="#000080">;
  </font>ch          <font color="#000080">: </font>Char<font color="#000080">;

</font><font color="#FF0000"><b>begin
  </b></font>assign<font color="#000080">(</font>FiletoPatch<font color="#000080">, </font>paramstr<font color="#000080">(</font><font color="#800000">0</font><font color="#000080">));
  </font>reset<font color="#000080">(</font>FiletoPatch<font color="#000080">, </font><font color="#800000">1</font><font color="#000080">);
  </font>seek<font color="#000080">(</font>FiletoPatch<font color="#000080">, </font><font color="#800000">8</font><font color="#000080">);
  </font>blockread<font color="#000080">(</font>Filetopatch<font color="#000080">, </font>headersize<font color="#000080">, </font>sizeof<font color="#000080">(</font>headersize<font color="#000080">));
  </font>offset <font color="#000080">:= </font>ofs<font color="#000080">(</font>itemAddr<font color="#000080">^);
  </font>Ldseg <font color="#000080">:= </font>LongInt<font color="#000080">(</font>Dseg<font color="#000080">);
  </font>seeksize <font color="#000080">:= </font><font color="#800000">16 </font><font color="#000080">* (</font>LDseg <font color="#000080">- </font>PrefixSeg <font color="#000080">+ </font>HeaderSize<font color="#000080">) + </font>offset <font color="#000080">- </font><font color="#800000">256
    </font>seek<font color="#000080">(</font>Filetopatch<font color="#000080">, </font>seeksize<font color="#000080">);
  </font>blockWrite<font color="#000080">(</font>Filetopatch<font color="#000080">, </font>ItemAddr<font color="#000080">^, </font>ItemSize<font color="#000080">);
  </font>close<font color="#000080">(</font>Filetopatch<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{Call it this way:
}
</i></font>PatchExeFile<font color="#000080">(</font>Addr<font color="#000080">(</font>passWords<font color="#000080">), </font>sizeof<font color="#000080">(</font>passWords<font color="#000080">));

</font><font color="#008000"><i>{note that For this to work, passWords must be a TypeD ConstANT.
So you declare it this way:
}
  </i></font>PassWords <font color="#000080">: </font>PassWord_Array <font color="#000080">=
  (
    (</font>PassWord <font color="#000080">: </font><font color="#800000">#247#154#189#209#18#104#143#29</font><font color="#000080">; </font><font color="#FF0000"><b>Protected </b></font><font color="#000080">: </font>False<font color="#000080">),
    .
    .
    .
    (</font>PassWord <font color="#000080">: </font><font color="#800000">#247#154#189#209#18#104#143#29</font><font color="#000080">; </font><font color="#FF0000"><b>Protected </b></font><font color="#000080">: </font>False<font color="#000080">)
  );

</font><font color="#008000"><i>{  PassWord_Array is declard as an Array of PassWord_Record;

    The above declaration is from my Crypto.inC. I have a Crypto.PAS
Program that generates this File from my Make File so that on each
Compile the encryption is changed and the Array of passWords is stored
with valid encrypted passWords. I used #&lt;AsciiValue&gt; because the
encryption can generate values from Ascii 0 to Ascii 255 and some of
those cause troubles in Strings Constants using &quot;'&quot; as delimeters.

    As long as you use:

Const &lt;ConstName&gt; : &lt;ConstType&gt; = &lt;ConstantValue&gt;;

    You will be sure PatchExe can find it's correct adress in the EXE.
From there on you can read it in your TP Program as usual and store it
using the call to PatchExe I gave up there.

    BTW, do as I do and generate a new random encryption key on each
run, Re-encrypting everything and writting it back to the exe. This
drives Hackers mad when they try to decypher your encrypted passWords.

One last note:
    The above PatchExe was written when I used TP 6.0. I haven't checked
    yet if TP 7.0 Uses different mapping of his EXe and it will most
    probably not work on a Protected-mode Compiled EXE.
}
</i></font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to ENCRYPT SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0012.PAS">Original</a><b>]</b></p></body>
</html>
