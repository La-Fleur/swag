<html>
<head><title> "File Encoder/Decoder" by BAS VAN GAALEN</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to ENCRYPT SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0024.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code>
<font color="#008000"><i>{Here follow the two files to encode and decode files...}

</i></font><font color="#000080">&gt;--- </font><font color="#FF0000"><b>Begin of file </b></font>ENCODE<font color="#000080">.</font>PAS

<font color="#008000"><i>{$v-,x+}

(*
** 'Encode' ASCII textfile to binary mess.
** Written by Bas van Gaalen.
**
** This is suposed to be unhackable...
*)

</i></font><font color="#FF0000"><b>program </b></font>_encode<font color="#000080">; </font><font color="#008000"><i>{ ENCODE.PAS }

</i></font><font color="#FF0000"><b>uses
  </b></font>dos<font color="#000080">;

</font><font color="#FF0000"><b>var
  </b></font>key<font color="#000080">:</font><font color="#FF0000"><b>string</b></font><font color="#000080">[</font><font color="#800000">8</font><font color="#000080">];

</font><font color="#008000"><i>{ encode file ---------------------------------------------------------------}

</i></font><font color="#FF0000"><b>procedure </b></font>encode<font color="#000080">(</font>infname<font color="#000080">:</font>pathstr<font color="#000080">);
</font><font color="#FF0000"><b>var
  </b></font>infile<font color="#000080">,</font>outfile<font color="#000080">:</font><font color="#FF0000"><b>file</b></font><font color="#000080">;
  </font>fdir<font color="#000080">:</font>dirstr<font color="#000080">; </font>fname<font color="#000080">:</font>namestr<font color="#000080">; </font>fext<font color="#000080">:</font>extstr<font color="#000080">;
  </font>inbuf<font color="#000080">,</font>outbuf<font color="#000080">:</font>pointer<font color="#000080">;
  </font>fsize<font color="#000080">:</font>longint<font color="#000080">;
  </font>srcseg<font color="#000080">,</font>dstseg<font color="#000080">,
  </font>srcofs<font color="#000080">,</font>dstofs<font color="#000080">,
  </font>nofbytes<font color="#000080">,</font>idx<font color="#000080">,</font>start<font color="#000080">,</font>rep<font color="#000080">,</font>outsize<font color="#000080">:</font>word<font color="#000080">;
  </font>i<font color="#000080">,</font>src<font color="#000080">:</font>byte<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>assign<font color="#000080">(</font>infile<font color="#000080">,</font>infname<font color="#000080">);
  </font><font color="#008000"><i>{$i-} </i></font>reset<font color="#000080">(</font>infile<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">); </font><font color="#008000"><i>{$i+}
  </i></font><font color="#FF0000"><b>if </b></font>ioresult<font color="#000080">&lt;&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>halt<font color="#000080">;
  </font>fsize<font color="#000080">:=</font>filesize<font color="#000080">(</font>infile<font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font>fsize<font color="#000080">&gt;</font><font color="#800000">65500 </font><font color="#FF0000"><b>then </b></font>halt<font color="#000080">;
  </font>getmem<font color="#000080">(</font>inbuf<font color="#000080">,</font>fsize<font color="#000080">);
  </font>blockread<font color="#000080">(</font>infile<font color="#000080">,</font>inbuf<font color="#000080">^,</font>fsize<font color="#000080">,</font>nofbytes<font color="#000080">);
  </font>close<font color="#000080">(</font>infile<font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font>nofbytes<font color="#000080">&lt;&gt;</font>fsize <font color="#FF0000"><b>then </b></font>halt<font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font>maxavail<font color="#000080">&lt;</font>fsize <font color="#FF0000"><b>then </b></font>halt<font color="#000080">;
  </font>getmem<font color="#000080">(</font>outbuf<font color="#000080">,</font>fsize<font color="#000080">);
  </font>srcseg<font color="#000080">:=</font>seg<font color="#000080">(</font>inbuf<font color="#000080">^); </font>dstseg<font color="#000080">:=</font>seg<font color="#000080">(</font>outbuf<font color="#000080">^);
  </font>srcofs<font color="#000080">:=</font>ofs<font color="#000080">(</font>inbuf<font color="#000080">^); </font>dstofs<font color="#000080">:=</font>ofs<font color="#000080">(</font>outbuf<font color="#000080">^); </font>start<font color="#000080">:=</font>dstofs<font color="#000080">;
  </font>idx<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
  </font><font color="#FF0000"><b>while </b></font>idx<font color="#000080">&lt;</font>fsize <font color="#FF0000"><b>do begin
    </b></font>src<font color="#000080">:=</font>mem<font color="#000080">[</font>srcseg<font color="#000080">:</font>srcofs<font color="#000080">+</font>idx<font color="#000080">];
    </font>rep<font color="#000080">:=</font><font color="#800000">1</font><font color="#000080">;
    </font><font color="#FF0000"><b>while </b></font><font color="#000080">(</font>mem<font color="#000080">[</font>srcseg<font color="#000080">:</font>srcofs<font color="#000080">+</font>idx<font color="#000080">+</font>rep<font color="#000080">]=</font>src<font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>rep<font color="#000080">&lt;</font><font color="#800000">$f</font><font color="#000080">) </font><font color="#FF0000"><b>do </b></font>inc<font color="#000080">(</font>rep<font color="#000080">);
    </font><font color="#FF0000"><b>if </b></font>rep<font color="#000080">&gt;</font><font color="#800000">1 </font><font color="#FF0000"><b>then begin
      </b></font>mem<font color="#000080">[</font>dstseg<font color="#000080">:</font>dstofs<font color="#000080">]:=</font><font color="#800000">$f0 </font><font color="#FF0000"><b>or </b></font>rep<font color="#000080">;
      </font>mem<font color="#000080">[</font>dstseg<font color="#000080">:</font>dstofs<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">]:=</font>src<font color="#000080">;
      </font>inc<font color="#000080">(</font>dstofs<font color="#000080">,</font><font color="#800000">2</font><font color="#000080">);
    </font><font color="#FF0000"><b>end
    else begin
      if </b></font>src<font color="#000080">&gt;=</font><font color="#800000">$f0 </font><font color="#FF0000"><b>then begin </b></font>mem<font color="#000080">[</font>dstseg<font color="#000080">:</font>dstofs<font color="#000080">]:=</font><font color="#800000">$f1</font><font color="#000080">; </font>inc<font color="#000080">(</font>dstofs<font color="#000080">); </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font>mem<font color="#000080">[</font>dstseg<font color="#000080">:</font>dstofs<font color="#000080">]:=</font>src<font color="#000080">; </font>inc<font color="#000080">(</font>dstofs<font color="#000080">);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font>inc<font color="#000080">(</font>idx<font color="#000080">,</font>rep<font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>outsize<font color="#000080">:=</font>dstofs<font color="#000080">-</font>start<font color="#000080">;
  </font>freemem<font color="#000080">(</font>inbuf<font color="#000080">,</font>fsize<font color="#000080">);
  </font>randseed<font color="#000080">:=</font>ord<font color="#000080">(</font>key<font color="#000080">[</font>length<font color="#000080">(</font>key<font color="#000080">)]); </font>i<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
  </font><font color="#FF0000"><b>for </b></font>idx<font color="#000080">:=</font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font>outsize <font color="#FF0000"><b>do begin
    </b></font>mem<font color="#000080">[</font>dstseg<font color="#000080">:</font>start<font color="#000080">+</font>idx<font color="#000080">]:=</font>mem<font color="#000080">[</font>dstseg<font color="#000080">:</font>start<font color="#000080">+</font>idx<font color="#000080">] </font><font color="#FF0000"><b>xor
</b></font><font color="#000080">(</font>ord<font color="#000080">(</font>key<font color="#000080">[</font>i<font color="#000080">])+</font>random<font color="#000080">(</font>ord<font color="#000080">(</font>key<font color="#000080">[</font>i<font color="#000080">])));    </font>i<font color="#000080">:=</font><font color="#800000">1</font><font color="#000080">+</font>i <font color="#FF0000"><b>mod </b></font><font color="#800000">8</font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>fsplit<font color="#000080">(</font>infname<font color="#000080">,</font>fdir<font color="#000080">,</font>fname<font color="#000080">,</font>fext<font color="#000080">);
  </font>assign<font color="#000080">(</font>outfile<font color="#000080">,</font>fdir<font color="#000080">+</font>fname<font color="#000080">+</font><font color="#800000">'.dat'</font><font color="#000080">);
  </font>rewrite<font color="#000080">(</font>outfile<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">);
  </font>blockwrite<font color="#000080">(</font>outfile<font color="#000080">,</font>outbuf<font color="#000080">^,</font>outsize<font color="#000080">);
  </font>freemem<font color="#000080">(</font>outbuf<font color="#000080">,</font>fsize<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{ main ----------------------------------------------------------------------}

</i></font><font color="#FF0000"><b>begin
  if </b></font><font color="#000080">(</font>paramcount<font color="#000080">&lt;&gt;</font><font color="#800000">2</font><font color="#000080">) </font><font color="#FF0000"><b>or </b></font><font color="#000080">(</font>pos<font color="#000080">(</font><font color="#800000">'?'</font><font color="#000080">,</font>paramstr<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">))&gt;</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>then begin
    </b></font>writeln<font color="#000080">(</font><font color="#800000">'Syntax: ENCODE &lt;filename&gt; &lt;key&gt;'</font><font color="#000080">);
    </font>writeln<font color="#000080">(</font><font color="#800000">'Both parameters are required!'</font><font color="#000080">);
    </font>halt<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>key<font color="#000080">:=</font>paramstr<font color="#000080">(</font><font color="#800000">2</font><font color="#000080">);
  </font>encode<font color="#000080">(</font>paramstr<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">));
  </font>writeln<font color="#000080">(</font><font color="#800000">'File successfully encoded!'</font><font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">.

&gt;--- </font><font color="#FF0000"><b>End of file </b></font>ENCODE<font color="#000080">.</font>PAS

<font color="#000080">&gt;--- </font><font color="#FF0000"><b>Begin of file </b></font>DECODE<font color="#000080">.</font>PAS

<font color="#008000"><i>{$v-}

(*
** 'Decode' Binary mess to textfile.
** Written by Bas van Gaalen.
**
** This is suposed to be unhackable...
*)

</i></font><font color="#FF0000"><b>program </b></font>_decode<font color="#000080">; </font><font color="#008000"><i>{ DECODE.PAS }

</i></font><font color="#FF0000"><b>uses
  </b></font>dos<font color="#000080">;

</font><font color="#FF0000"><b>var
  </b></font>key<font color="#000080">:</font><font color="#FF0000"><b>string</b></font><font color="#000080">[</font><font color="#800000">8</font><font color="#000080">];

</font><font color="#008000"><i>{ decode file ---------------------------------------------------------------}

</i></font><font color="#FF0000"><b>procedure </b></font>decode<font color="#000080">(</font>infname<font color="#000080">:</font>pathstr<font color="#000080">);
</font><font color="#FF0000"><b>var
  </b></font>infile<font color="#000080">,</font>outfile<font color="#000080">:</font><font color="#FF0000"><b>file</b></font><font color="#000080">;
  </font>fdir<font color="#000080">:</font>dirstr<font color="#000080">; </font>fname<font color="#000080">:</font>namestr<font color="#000080">; </font>fext<font color="#000080">:</font>extstr<font color="#000080">;
  </font>dbuf<font color="#000080">,</font>sbuf<font color="#000080">:</font>pointer<font color="#000080">;
  </font>idx<font color="#000080">,</font>i<font color="#000080">,</font>j<font color="#000080">,</font>srcseg<font color="#000080">,</font>srcofs<font color="#000080">,</font>dstseg<font color="#000080">,</font>dstofs<font color="#000080">,</font>start<font color="#000080">,</font>csize<font color="#000080">:</font>word<font color="#000080">;
  </font>src<font color="#000080">,</font>rep<font color="#000080">:</font>byte<font color="#000080">;
</font><font color="#FF0000"><b>begin
  if </b></font>maxavail<font color="#000080">&lt;</font><font color="#800000">2</font><font color="#000080">*</font><font color="#800000">65500 </font><font color="#FF0000"><b>then </b></font>halt<font color="#000080">;
  </font>getmem<font color="#000080">(</font>dbuf<font color="#000080">,</font><font color="#800000">65500</font><font color="#000080">);
  </font>getmem<font color="#000080">(</font>sbuf<font color="#000080">,</font><font color="#800000">65500</font><font color="#000080">);
  </font>srcseg<font color="#000080">:=</font>seg<font color="#000080">(</font>sbuf<font color="#000080">^); </font>srcofs<font color="#000080">:=</font>ofs<font color="#000080">(</font>sbuf<font color="#000080">^);
  </font>dstseg<font color="#000080">:=</font>seg<font color="#000080">(</font>dbuf<font color="#000080">^); </font>dstofs<font color="#000080">:=</font>ofs<font color="#000080">(</font>dbuf<font color="#000080">^); </font>start<font color="#000080">:=</font>dstofs<font color="#000080">;
  </font>assign<font color="#000080">(</font>infile<font color="#000080">,</font>infname<font color="#000080">);
  </font><font color="#008000"><i>{$i-} </i></font>reset<font color="#000080">(</font>infile<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">); </font><font color="#008000"><i>{$i+}
  </i></font><font color="#FF0000"><b>if </b></font>ioresult<font color="#000080">&lt;&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>halt<font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font>filesize<font color="#000080">(</font>infile<font color="#000080">)&gt;</font><font color="#800000">65500 </font><font color="#FF0000"><b>then </b></font>halt<font color="#000080">;
  </font>blockread<font color="#000080">(</font>infile<font color="#000080">,</font>sbuf<font color="#000080">^,</font>filesize<font color="#000080">(</font>infile<font color="#000080">));
  </font>csize<font color="#000080">:=</font>filesize<font color="#000080">(</font>infile<font color="#000080">);
  </font>close<font color="#000080">(</font>infile<font color="#000080">);
  </font>randseed<font color="#000080">:=</font>ord<font color="#000080">(</font>key<font color="#000080">[</font>length<font color="#000080">(</font>key<font color="#000080">)]); </font>j<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
  </font><font color="#FF0000"><b>for </b></font>i<font color="#000080">:=</font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font>csize <font color="#FF0000"><b>do begin
    </b></font>mem<font color="#000080">[</font>srcseg<font color="#000080">:</font>srcofs<font color="#000080">+</font>i<font color="#000080">]:=</font>mem<font color="#000080">[</font>srcseg<font color="#000080">:</font>srcofs<font color="#000080">+</font>i<font color="#000080">] </font><font color="#FF0000"><b>xor
</b></font><font color="#000080">(</font>ord<font color="#000080">(</font>key<font color="#000080">[</font>j<font color="#000080">])+</font>random<font color="#000080">(</font>ord<font color="#000080">(</font>key<font color="#000080">[</font>j<font color="#000080">])));    </font>j<font color="#000080">:=</font><font color="#800000">1</font><font color="#000080">+</font>j <font color="#FF0000"><b>mod </b></font><font color="#800000">8</font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>idx<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
  </font><font color="#FF0000"><b>while </b></font>idx<font color="#000080">&lt;</font>csize <font color="#FF0000"><b>do begin
    </b></font>src<font color="#000080">:=</font>mem<font color="#000080">[</font>srcseg<font color="#000080">:</font>srcofs<font color="#000080">+</font>idx<font color="#000080">];
    </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>src <font color="#FF0000"><b>and </b></font><font color="#800000">$f0</font><font color="#000080">)=</font><font color="#800000">$f0 </font><font color="#FF0000"><b>then begin
      </b></font>rep<font color="#000080">:=</font>src <font color="#FF0000"><b>and </b></font><font color="#800000">$f</font><font color="#000080">;
      </font>src<font color="#000080">:=</font>mem<font color="#000080">[</font>srcseg<font color="#000080">:</font>srcofs<font color="#000080">+</font>idx<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">];
      </font>fillchar<font color="#000080">(</font>mem<font color="#000080">[</font>dstseg<font color="#000080">:</font>dstofs<font color="#000080">],</font>rep<font color="#000080">,</font>src<font color="#000080">);
      </font>inc<font color="#000080">(</font>dstofs<font color="#000080">,</font>rep<font color="#000080">);
      </font>inc<font color="#000080">(</font>idx<font color="#000080">,</font><font color="#800000">2</font><font color="#000080">);
    </font><font color="#FF0000"><b>end
    else begin
      </b></font>mem<font color="#000080">[</font>dstseg<font color="#000080">:</font>dstofs<font color="#000080">]:=</font>src<font color="#000080">;
      </font>inc<font color="#000080">(</font>dstofs<font color="#000080">);
      </font>inc<font color="#000080">(</font>idx<font color="#000080">);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>csize<font color="#000080">:=</font>dstofs<font color="#000080">-</font>start<font color="#000080">;
  </font>fsplit<font color="#000080">(</font>infname<font color="#000080">,</font>fdir<font color="#000080">,</font>fname<font color="#000080">,</font>fext<font color="#000080">);
  </font>assign<font color="#000080">(</font>outfile<font color="#000080">,</font>fdir<font color="#000080">+</font>fname<font color="#000080">+</font><font color="#800000">'.org'</font><font color="#000080">);
  </font><font color="#008000"><i>{$i-} </i></font>rewrite<font color="#000080">(</font>outfile<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">); </font><font color="#008000"><i>{$i+}
  </i></font><font color="#FF0000"><b>if </b></font>ioresult<font color="#000080">&lt;&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>halt<font color="#000080">(</font><font color="#800000">4</font><font color="#000080">);
  </font>blockwrite<font color="#000080">(</font>outfile<font color="#000080">,</font>dbuf<font color="#000080">^,</font>csize<font color="#000080">);
  </font>close<font color="#000080">(</font>outfile<font color="#000080">);
  </font>freemem<font color="#000080">(</font>sbuf<font color="#000080">,</font><font color="#800000">65500</font><font color="#000080">);
  </font>freemem<font color="#000080">(</font>dbuf<font color="#000080">,</font><font color="#800000">65500</font><font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{ main ----------------------------------------------------------------------}

</i></font><font color="#FF0000"><b>begin
  if </b></font><font color="#000080">(</font>paramcount<font color="#000080">&lt;&gt;</font><font color="#800000">2</font><font color="#000080">) </font><font color="#FF0000"><b>or </b></font><font color="#000080">(</font>pos<font color="#000080">(</font><font color="#800000">'?'</font><font color="#000080">,</font>paramstr<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">))&gt;</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>then begin
    </b></font>writeln<font color="#000080">(</font><font color="#800000">'Syntax: DECODE &lt;filename&gt; &lt;key&gt;'</font><font color="#000080">);
    </font>writeln<font color="#000080">(</font><font color="#800000">'Both parameters are required!'</font><font color="#000080">);
    </font>halt<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>key<font color="#000080">:=</font>paramstr<font color="#000080">(</font><font color="#800000">2</font><font color="#000080">);
  </font>decode<font color="#000080">(</font>paramstr<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">));
  </font>writeln<font color="#000080">(</font><font color="#800000">'File successfully decoded!'</font><font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">.

&gt;--- </font><font color="#FF0000"><b>End of file </b></font>DECODE<font color="#000080">.</font>PAS

</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to ENCRYPT SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0024.PAS">Original</a><b>]</b></p></body>
</html>
