<html>
<head><title> "Small UUE Encoder" by SUNE MARCHER</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to ENCRYPT SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0028.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{$q-,r-,s-,d-,l-,y-,x-,v-,t-,n-,e-}

</i></font><font color="#FF0000"><b>uses </b></font>dos<font color="#000080">;

</font><font color="#FF0000"><b>const
  </b></font>bytesperline<font color="#000080">=</font><font color="#800000">45</font><font color="#000080">;         </font><font color="#008000"><i>{ maximum bytes per encoded line }
  </i></font>masque6bits<font color="#000080">=</font><font color="#800000">$3f</font><font color="#000080">;        </font><font color="#008000"><i>{ mask for six lower bits }

</i></font><font color="#FF0000"><b>procedure </b></font>encodebuffer<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>buf<font color="#000080">; </font>len<font color="#000080">:</font>word<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>res<font color="#000080">:</font><font color="#FF0000"><b>string</b></font><font color="#000080">); </font><font color="#FF0000"><b>assembler </b></font><font color="#000080">;
</font><font color="#FF0000"><b>asm
  </b></font><font color="#FF00FF">push ds
  cld
  lds si,buf
  les di,res
  mov cx,len
  inc di
  mov al,cl
  add al,' '
  stosb
  mov dl,1
@1:
  lodsb
  mov bl,al
  shr al,2
  add al,' '
  stosb
  shl bl,4
  lodsb
  mov bh,al
  shr al,4
  or  al,bl
  and al,masque6bits
  add al,' '
  stosb
  lodsb
  mov bl,al
  and bh,$0f
  shl al,1
  rcl bh,1
  shl al,1
  rcl bh,1
  mov al,bh
  add al,' '
  stosb
  mov al,bl
  and al,masque6bits
  add al,' '
  stosb
  add dl,4
  sub cx,3
  ja  @1
  mov di,word ptr res
  mov es:[di],dl
  pop ds
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>replacespacewithbackquote<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>str<font color="#000080">:</font><font color="#FF0000"><b>string</b></font><font color="#000080">); </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>asm
  </b></font><font color="#FF00FF">les di,str
  mov cl,es:[di]
  xor ch,ch
  cld
  inc di
  mov ax,'`'*256+' '
@1:
  jcxz @2
  repne scasb
  jne @2
  mov es:[di-1],ah
  jmp @1
@2:
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>var
  </b></font>inbuf<font color="#000080">:</font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">100</font><font color="#000080">*</font>bytesperline<font color="#000080">]</font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">;
  </font>outbuf<font color="#000080">:</font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">8192</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>char<font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>encodefile<font color="#000080">(</font>fname<font color="#000080">:</font><font color="#FF0000"><b>string</b></font><font color="#000080">);
</font><font color="#FF0000"><b>var
  </b></font>inf<font color="#000080">:</font><font color="#FF0000"><b>file</b></font><font color="#000080">;
  </font>outf<font color="#000080">:</font>text<font color="#000080">;
  </font>outb<font color="#000080">:</font><font color="#FF0000"><b>string</b></font><font color="#000080">[</font>bytesperline<font color="#000080">*</font><font color="#800000">4 </font><font color="#FF0000"><b>div </b></font><font color="#800000">3</font><font color="#000080">+</font><font color="#800000">4</font><font color="#000080">];
  </font>lus<font color="#000080">:</font>word<font color="#000080">;
  </font>inp<font color="#000080">:</font>word<font color="#000080">;
  </font>nb<font color="#000080">:</font>word<font color="#000080">;
  </font>rep<font color="#000080">:</font>pathstr<font color="#000080">;
  </font>nom<font color="#000080">:</font>namestr<font color="#000080">;
  </font>ext<font color="#000080">:</font>extstr<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>assign<font color="#000080">(</font>inf<font color="#000080">,</font>fname<font color="#000080">);
  </font><font color="#008000"><i>{$i-} </i></font>reset<font color="#000080">(</font>inf<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">); </font><font color="#008000"><i>{$i+}
  </i></font><font color="#FF0000"><b>if</b></font><font color="#000080">(</font>ioresult<font color="#000080">&lt;&gt;</font><font color="#800000">0</font><font color="#000080">)</font><font color="#FF0000"><b>then
  begin
    </b></font>writeln<font color="#000080">(</font><font color="#800000">'Can''t open '</font><font color="#000080">,</font>fname<font color="#000080">);
    </font>exit<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>fsplit<font color="#000080">(</font>fname<font color="#000080">,</font>rep<font color="#000080">,</font>nom<font color="#000080">,</font>ext<font color="#000080">);
  </font>assign<font color="#000080">(</font>outf<font color="#000080">,</font>nom<font color="#000080">+</font><font color="#800000">'.uue'</font><font color="#000080">);
  </font>rewrite<font color="#000080">(</font>outf<font color="#000080">);
  </font>settextbuf<font color="#000080">(</font>outf<font color="#000080">,</font>outbuf<font color="#000080">,</font>sizeof<font color="#000080">(</font>outbuf<font color="#000080">));
  </font>writeln<font color="#000080">(</font>outf<font color="#000080">,</font><font color="#800000">'begin 644 '</font><font color="#000080">,</font>nom<font color="#000080">,</font>ext<font color="#000080">);
  </font><font color="#FF0000"><b>while not </b></font>eof<font color="#000080">(</font>inf<font color="#000080">)</font><font color="#FF0000"><b>do
  begin
    </b></font>blockread<font color="#000080">(</font>inf<font color="#000080">,</font>inbuf<font color="#000080">,</font>sizeof<font color="#000080">(</font>inbuf<font color="#000080">),</font>lus<font color="#000080">);
    </font>inp<font color="#000080">:=</font><font color="#800000">1</font><font color="#000080">;
    </font><font color="#FF0000"><b>if</b></font><font color="#000080">(</font>lus<font color="#000080">&lt;</font>sizeof<font color="#000080">(</font>inbuf<font color="#000080">))</font><font color="#FF0000"><b>then
    </b></font>fillchar<font color="#000080">(</font>inbuf<font color="#000080">[</font>lus<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">],</font>sizeof<font color="#000080">(</font>inbuf<font color="#000080">)-</font>lus<font color="#000080">,</font><font color="#800000">0</font><font color="#000080">);
    </font><font color="#FF0000"><b>while</b></font><font color="#000080">(</font>inp<font color="#000080">&lt;=</font>lus<font color="#000080">)</font><font color="#FF0000"><b>do
    begin
      </b></font>nb<font color="#000080">:=</font>lus<font color="#000080">-</font>inp<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">;
      </font><font color="#FF0000"><b>if</b></font><font color="#000080">(</font>nb<font color="#000080">&gt;</font>bytesperline<font color="#000080">)</font><font color="#FF0000"><b>then </b></font>nb<font color="#000080">:=</font>bytesperline<font color="#000080">;
      </font>encodebuffer<font color="#000080">(</font>inbuf<font color="#000080">[</font>inp<font color="#000080">],</font>nb<font color="#000080">,</font>outb<font color="#000080">);
      </font>replacespacewithbackquote<font color="#000080">(</font>outb<font color="#000080">);
      </font>writeln<font color="#000080">(</font>outf<font color="#000080">,</font>outb<font color="#000080">);
      </font>inc<font color="#000080">(</font>inp<font color="#000080">,</font>nb<font color="#000080">);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>close<font color="#000080">(</font>inf<font color="#000080">);
  </font>writeln<font color="#000080">(</font>outf<font color="#000080">,</font><font color="#800000">'`'</font><font color="#000080">);
  </font>writeln<font color="#000080">(</font>outf<font color="#000080">,</font><font color="#800000">'end'</font><font color="#000080">);
  </font>close<font color="#000080">(</font>outf<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>begin
  if</b></font><font color="#000080">(</font>paramcount<font color="#000080">&lt;&gt;</font><font color="#800000">1</font><font color="#000080">)</font><font color="#FF0000"><b>then
  begin
    </b></font>writeln<font color="#000080">(</font><font color="#800000">'uue2 &lt;file name&gt;'</font><font color="#000080">);
    </font>halt<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>encodefile<font color="#000080">(</font>paramstr<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">));
</font><font color="#FF0000"><b>end</b></font><font color="#000080">.</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to ENCRYPT SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0028.PAS">Original</a><b>]</b></p></body>
</html>
