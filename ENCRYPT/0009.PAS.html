<html>
<head><title> "HASH.PAS" by SWAG SUPPORT TEAM</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to ENCRYPT SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0009.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#FF0000"><b>Unit </b></font>Hash<font color="#000080">;

</font><font color="#008000"><i>{***************************************************************************
 *                                                                         *
 *                     Copyright 1989 Trevor J Carlsen                     *
 *                           All rights reserved                           *
 *                   Rovert Software Consulting Services                   *
 *                                PO Box 568                               *
 *                   Port Hedland Western Australia 6721                   *
 *                 Telephone  (091) 732026 or (091) 732569                 *
 *                                                                         *
 ***************************************************************************}

</i></font><font color="#FF0000"><b>Interface

Uses </b></font>Strings<font color="#000080">,
     </font>sundry<font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>hashcode<font color="#000080">(</font>st <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">; </font><font color="#FF0000"><b>Var </b></font>nwd <font color="#000080">: </font>Word<font color="#000080">): </font>Word<font color="#000080">;

</font><font color="#FF0000"><b>Implementation

Function </b></font>MakeCodeStr<font color="#000080">(</font>key <font color="#000080">: </font>LongInt<font color="#000080">; </font>st <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">): </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>Var
    </b></font>x   <font color="#000080">: </font>Word<font color="#000080">;
    </font>len <font color="#000080">: </font>Byte <font color="#FF0000"><b>Absolute </b></font>st<font color="#000080">;
  </font><font color="#FF0000"><b>begin
    </b></font>RandSeed <font color="#000080">:= (</font>key <font color="#000080">* </font>len<font color="#000080">) </font><font color="#FF0000"><b>div </b></font>ord<font color="#000080">(</font>st<font color="#000080">[</font>len<font color="#000080">]);
    </font>MakeCodeStr<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">] := </font>st<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">];
    </font><font color="#FF0000"><b>For </b></font>x <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>len <font color="#FF0000"><b>do
      </b></font>MakeCodeStr<font color="#000080">[</font>x<font color="#000080">] := </font>chr<font color="#000080">(</font>Random<font color="#000080">(</font><font color="#800000">255</font><font color="#000080">));
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>Key<font color="#000080">(</font>st<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">): </font>LongInt<font color="#000080">;
  </font><font color="#FF0000"><b>Var
    </b></font>len    <font color="#000080">: </font>Byte <font color="#FF0000"><b>Absolute </b></font>st<font color="#000080">;
    </font>x<font color="#000080">,</font>y    <font color="#000080">: </font>Byte<font color="#000080">;
    </font>temp   <font color="#000080">: </font>LongInt<font color="#000080">;
    </font>tempst <font color="#000080">: </font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">3</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Byte<font color="#000080">;

  </font><font color="#FF0000"><b>Procedure </b></font>makekey<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>k<font color="#000080">; </font><font color="#FF0000"><b>Var </b></font>s <font color="#000080">: </font>LongInt<font color="#000080">);
    </font><font color="#FF0000"><b>Var </b></font>t <font color="#000080">: </font>LongInt <font color="#FF0000"><b>Absolute </b></font>k<font color="#000080">;
      </font>rec <font color="#000080">: </font><font color="#FF0000"><b>Record
              Case </b></font>Byte <font color="#FF0000"><b>of
               </b></font><font color="#800000">1 </font><font color="#000080">:(</font>b <font color="#000080">: </font>LongInt<font color="#000080">; </font>c <font color="#000080">: </font>Word<font color="#000080">);
               </font><font color="#800000">2 </font><font color="#000080">:(</font>d <font color="#000080">: </font>Word <font color="#000080">; </font>e <font color="#000080">: </font>LongInt<font color="#000080">);
               </font><font color="#800000">3 </font><font color="#000080">:(</font>r <font color="#000080">: </font>Real<font color="#000080">);
              </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>begin
      </b></font>RandSeed <font color="#000080">:= </font>t<font color="#000080">;
      </font>rec<font color="#000080">.</font>r <font color="#000080">:= </font>random<font color="#000080">;
      </font>s <font color="#000080">:= </font>s <font color="#FF0000"><b>xor </b></font>rec<font color="#000080">.</font>b <font color="#FF0000"><b>xor </b></font>rec<font color="#000080">.</font>e<font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>begin
    </b></font>temp <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
    </font><font color="#FF0000"><b>For </b></font>x <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>len<font color="#000080">-</font><font color="#800000">3 </font><font color="#FF0000"><b>do begin
      For </b></font>y <font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font><font color="#800000">3 </font><font color="#FF0000"><b>do
        </b></font>tempst<font color="#000080">[</font>y<font color="#000080">] := </font>Byte<font color="#000080">(</font>st<font color="#000080">[</font>x <font color="#000080">+ </font>y<font color="#000080">]);
      </font>makekey<font color="#000080">(</font>tempst<font color="#000080">,</font>temp<font color="#000080">);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font>Key <font color="#000080">:= </font>temp<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>EncryptStr<font color="#000080">(</font>key <font color="#000080">: </font>LongInt<font color="#000080">; </font>st <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">): </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>Var
    </b></font>len          <font color="#000080">: </font>Byte <font color="#FF0000"><b>Absolute </b></font>st<font color="#000080">;
    </font>cnt<font color="#000080">,</font>x        <font color="#000080">: </font>Byte<font color="#000080">;
    </font>temp<font color="#000080">,</font>CodeStr <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>begin
    </b></font>CodeStr <font color="#000080">:= </font>MakeCodeStr<font color="#000080">(</font>key<font color="#000080">,</font>st<font color="#000080">);
    </font>temp<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">] := </font>st<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">];
    </font>temp<font color="#000080">[</font>len<font color="#000080">] := </font>st<font color="#000080">[</font>len<font color="#000080">];
    </font><font color="#FF0000"><b>For </b></font>x <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>len<font color="#000080">-</font><font color="#800000">1 </font><font color="#FF0000"><b>do begin
      </b></font>cnt <font color="#000080">:= </font>ord<font color="#000080">(</font>st<font color="#000080">[</font>x<font color="#000080">]) </font><font color="#FF0000"><b>xor </b></font>ord<font color="#000080">(</font>CodeStr<font color="#000080">[</font>x<font color="#000080">]);
      </font>temp<font color="#000080">[</font>x<font color="#000080">] := </font>chr<font color="#000080">(</font>cnt<font color="#000080">);
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font>cnt <font color="#000080">:= </font>ord<font color="#000080">(</font>st<font color="#000080">[</font>len<font color="#000080">]) </font><font color="#FF0000"><b>xor </b></font>len<font color="#000080">;
    </font>temp<font color="#000080">[</font>len<font color="#000080">] := </font>chr<font color="#000080">(</font>cnt<font color="#000080">);
    </font>EncryptStr <font color="#000080">:= </font>temp<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>hashcode<font color="#000080">(</font>st <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">; </font><font color="#FF0000"><b>Var </b></font>nwd <font color="#000080">: </font>Word<font color="#000080">): </font>Word<font color="#000080">;
  </font><font color="#FF0000"><b>Var </b></font>k   <font color="#000080">: </font>LongInt<font color="#000080">;
      </font>len <font color="#000080">: </font>Byte <font color="#FF0000"><b>Absolute </b></font>st<font color="#000080">;
      </font>s   <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>begin
    </b></font>k <font color="#000080">:= </font>key<font color="#000080">(</font>st<font color="#000080">) * </font>nwd<font color="#000080">;
    </font>st <font color="#000080">:= </font>StUpCase<font color="#000080">(</font>st<font color="#000080">);
    </font>s <font color="#000080">:= </font>CompressStr<font color="#000080">(</font>st<font color="#000080">);
    </font>move<font color="#000080">(</font>s<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">],</font>nwd<font color="#000080">,</font><font color="#800000">2</font><font color="#000080">);
    </font><font color="#FF0000"><b>if </b></font>len <font color="#000080">&lt; </font><font color="#800000">4 </font><font color="#FF0000"><b>then </b></font>st <font color="#000080">:= </font>st <font color="#000080">+ </font><font color="#800000">'!@#$'</font><font color="#000080">;
    </font><font color="#008000"><i>{-Force String to a minimum length}
    </i></font>st <font color="#000080">:= </font>EncryptStr<font color="#000080">(</font>k<font color="#000080">,</font>st<font color="#000080">);
    </font>st <font color="#000080">:= </font>EncryptStr<font color="#000080">(</font>Key<font color="#000080">(</font>st<font color="#000080">),</font>st<font color="#000080">);
    </font>hashcode <font color="#000080">:= </font>key<font color="#000080">(</font>st<font color="#000080">) </font><font color="#FF0000"><b>shr </b></font><font color="#800000">16</font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;  </font><font color="#008000"><i>{hash}

</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">.


</font><font color="#008000"><i>{
&gt; Procedure Hash(p : Pointer; numb : Byte; Var result: LongInt);

&gt; ... Is this the way that you were referring to storing passWords?
&gt; if so could further explain the usage of this Procedure? Thanx!!

Yes, but I take issue With the Word &quot;store&quot;.  Storing the passWord hash is not
storing the passWord as the passWord cannot be determined by examining the hash
- even if the hash algorithm is known.

to use the Procedure -

When the passWord is first created, calculate its hash and store that value
somewhere - either in a File or in the exe.

then when the passWord is used just -

  Hash(@passWord,length(passWord),EnteredHash);
  if PwdHash = EnteredHash then PassWord_Entered_is_Correct.
}</i></font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to ENCRYPT SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0009.PAS">Original</a><b>]</b></p></body>
</html>
