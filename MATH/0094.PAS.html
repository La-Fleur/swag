<html>
<head><title> "Sparse Linear Systems Solver" by MARK HORRIDGE</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to MATH SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0094.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
From: horridge@ITS-MENZ.cc.monash.edu.au (Mark Horridge)
Sparse Solver for Borland or Turbo Pascal
*****************************************

Several people asked for a copy of my Pascal Unit to solve sparse linear
systems.  Here it is.

Unit Solspar is designed to solve sparse linear systems.
These are equation systems of the form:

A X  = R

where A is a matrix of coefficients size NxN,
      R is a vector of constants size N,
and   X is a vector of variables.

The code has been in use for a number of years, being slightly adapted for
each new purpose.  This is the first attempt at a portable general purpose
version.

I expect that the code contains a few errors which are my fault - I would
be glad to hear of these.  Please check that you have not tried to solve a
singular matrix by mistake !


Below find 3 text files, separated by rows of asterisks:

Solspar.pas:
  See notes at the top for instructions.
Test1.pas:
  Simple example of using routines with medium size matrix
Test2.pas:
  Example of using routines with N = 4, showing some possible errors
{************************************************************************}
{$N+,E+}
</i></font><font color="#FF0000"><b>unit </b></font>SolSpar<font color="#000080">;
</font><font color="#008000"><i>{ Unit Solspar is designed to solve sparse linear systems.
These are equation systems of the form:

A X  = R

where A is a matrix of coefficients size NxN,
      R is a vector of constants size N,
and   X is a vector of variables.
(remember, in matrix A, 'rows' are equations and 'cols' are variables)

Solspar computes the vector X which satisfies the above equation.
It is designed to save time and space where A is fairly large but contains
few non-zero elements.

It is designed to work in either the real, protected-mode DOS, or Windows
versions of Borland/Turbo Pascal.

Limitations of Solspar:
  It only allows one Right Hand Side (RHS) column.
  It only allows one sparse structure at a time.
  Not to be used with Mark and Release !
Points to watch:
  Normally, the A matrix grows in size (becomes less sparse)
  during the Solve phase. The biggest matrix you can store
 will be to big to solve.
}
</i></font><font color="#FF0000"><b>interface

 </b></font><font color="#008000"><i>{Unit consists of the following 5 Boolean Functions and 3 procedures.
  Each function returns True if operation was successfully completed -
  otherwise False.  If False is returned, call the procedure
  GetErrorMessage to find the reason.  Finally, call the procedure
  ReleaseStruc to return memory to the heap.}

</i></font><font color="#FF0000"><b>function </b></font>InitStruc<font color="#000080">(</font>NumEq <font color="#000080">: </font>Word<font color="#000080">) : </font>Boolean<font color="#000080">;
 </font><font color="#008000"><i>{creates and initializes sparse matrix structure - call this first.
  NumEq is number of equations/variables.}

</i></font><font color="#FF0000"><b>function </b></font>AddElement<font color="#000080">(</font>ThisEqu<font color="#000080">, </font>ThisVar <font color="#000080">: </font>Word<font color="#000080">; </font>ThisVal <font color="#000080">: </font>Double<font color="#000080">) : </font>Boolean<font color="#000080">;
 </font><font color="#008000"><i>{add an element to sparse matrix for equation ThisEqu and variable ThisVar;
  if such an entry already exists, ThisVal will be added to existing value
 You can add elements in any order, but the routine will be a bit more
efficient if you add variables (columns) to any particular equation in
ascending order, and then set the RHS}

</i></font><font color="#FF0000"><b>function </b></font>SetRHS<font color="#000080">(</font>ThisEqu <font color="#000080">: </font>Word<font color="#000080">; </font>ThisVal <font color="#000080">: </font>Double<font color="#000080">) : </font>Boolean<font color="#000080">;
 </font><font color="#008000"><i>{Set RHS for equation ThisEqu; if RHS has already been set, ThisVal will be
  added to existing value}

</i></font><font color="#FF0000"><b>function </b></font>Solve1 <font color="#000080">: </font>Boolean<font color="#000080">;
  </font><font color="#008000"><i>{calculate solutions; sparse matrix is destroyed}

</i></font><font color="#FF0000"><b>function </b></font>GetAnswer<font color="#000080">(</font>ThisVar <font color="#000080">: </font>Word<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>ThisVal <font color="#000080">: </font>Double<font color="#000080">) : </font>Boolean<font color="#000080">;
 </font><font color="#008000"><i>{read solution for variable ThisVar - probably called for each variable in
  turn}

</i></font><font color="#FF0000"><b>procedure </b></font>ReleaseStruc<font color="#000080">;
 </font><font color="#008000"><i>{releases remaining memory used by sparse matrix structure - call this
  last}

</i></font><font color="#FF0000"><b>procedure </b></font>GetErrorMsg<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>S <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">; </font><font color="#FF0000"><b>var </b></font>N1<font color="#000080">, </font>N2<font color="#000080">, </font>N3 <font color="#000080">: </font>Word<font color="#000080">);
 </font><font color="#008000"><i>{N1: error number; S: Error Description; N1, N2 : other possibly useful
  numbers}

</i></font><font color="#FF0000"><b>procedure </b></font>showmat<font color="#000080">;      </font><font color="#008000"><i>{ displays small sparse matrix - not for Windows}

</i></font><font color="#FF0000"><b>var
  </b></font>SparMemUsed    <font color="#000080">: </font>LongInt<font color="#000080">; </font><font color="#008000"><i>{no of bytes of heap used by routines}

(*
procedure GetErrorMsg is used to obtain information about any problem:

procedure GetErrorMsg(var S : String; var N1, N2, N3 : Word);
 {N1: error number; S: Error Description; N1, N2 : other possibly useful
  numbers}

List of possible error messages is as follows:
(remember, 'rows' are equations and 'cols' are variables)

N1        S                          N2        N3        Comment

 0                                 0          0      No error: default
 1  Empty Row                      Row        0
 2  Row without Variables          Row        0      Equation with RHS only
 3  Empty Col                      Col        0
 4  Two Singles                    Row      PivotCol Two variables (the 2nd
                                                     is pivotcol) are each
                                                     mentioned only in the
                                                     same equation
 5  No RHS                         Row      LastCol
 6  Numerically Singular         PivotRow PivotStep  Columns (or rows)
                                                     are not linearly
                                                     independent.
 7  Out of Space                   0          1      called from InitStruc
 7  Out of Space                   0          2      called from InitStruc
 7  Out of Space                   0          3      called from AddElement
 7  Out of Space                   PivotStep  4      called from Solve1
 8  Cols out of Order              Row        Col
25  Initialize without releasing   0          0
26  Too many equations             NumEq      MaxEq
27  Too few equations              NumEq      0
30  Row &lt; 1                        ThisEqu  ThisVar  called from AddElement
31  Col &lt; 1                        ThisEqu  ThisVar  called from AddElement
32  Row &gt; Neq                      ThisEqu    Neq    called from AddElement
33  Col &gt; Neq                      ThisVar    Neq    called from AddElement
41  VarNo &lt; 1                      ThisVar    0      called from AddElement
42  VarNo &gt; Neq                    ThisVar    Neq    called from AddElement
 *)

{  Hopefully, this is as far as you need to read in order to use the unit.
   There are a few comments in the code which you can look at for interest.
  To learn more about sparse matrices read:
    Direct Methods for Sparse Matrices
    Duff, Erisman and Reid         Cambridge University Press  }


</i></font><font color="#FF0000"><b>implementation

const
  </b></font>DBug           <font color="#000080">= </font>False<font color="#000080">;
  </font><font color="#008000"><i>{due to Borland's &quot;constant folding&quot; , Debug statements cost nothing with
Dbug false}
  </i></font>Msg            <font color="#000080">= </font>False<font color="#000080">;
  </font>ParaSize       <font color="#000080">= </font><font color="#800000">16</font><font color="#000080">;  </font><font color="#008000"><i>{for paragraph alignment}
  </i></font>MaxSize        <font color="#000080">= </font><font color="#800000">65520</font><font color="#000080">; </font><font color="#008000"><i>{largest variable size allowed by Turbo Pascal}
  </i></font>MaxUsable      <font color="#000080">= </font>MaxSize<font color="#000080">-</font>ParaSize<font color="#000080">; </font><font color="#008000"><i>{allows for paragraph alignment of data}
  </i></font>MaxEq          <font color="#000080">= (</font>MaxUsable <font color="#FF0000"><b>div </b></font>SizeOf<font color="#000080">(</font>Double<font color="#000080">))-</font><font color="#800000">1</font><font color="#000080">; </font><font color="#008000"><i>{-1 for 0-based arrays}
  {based on above, MaxEq = 8187}
  </i></font>Uvalue         <font color="#000080">= </font><font color="#800000">0.1</font><font color="#000080">; </font><font color="#008000"><i>{number 0&lt;U&lt;1; if larger, time and memory usage are
                          increased at the gain, maybe, of accuracy}

</i></font><font color="#FF0000"><b>type
  </b></font>RealArr        <font color="#000080">= </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font>MaxEq<font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Double<font color="#000080">;
  </font>WordArr        <font color="#000080">= </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font>MaxEq<font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Word<font color="#000080">;
  </font>IntArr         <font color="#000080">= </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font>MaxEq<font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Integer<font color="#000080">;
  </font>PRealArr       <font color="#000080">= ^</font>RealArr<font color="#000080">;
  </font>PWordArr       <font color="#000080">= ^</font>WordArr<font color="#000080">;
  </font>PIntArr        <font color="#000080">= ^</font>IntArr<font color="#000080">;

  </font><font color="#008000"><i>{ The ElmRec record type stores a single entry in the sparse matrix.  For
  efficiency reasons, it is 16 bytes long, and will be paragraph-aligned.
  The CheckRow field is padding to make up the 16 bytes.  The 'preload
  PrevPtr' trick, see below, requires that Next field be 4 bytes [= size of a
  pointer] after the start of the record.  Hence, order of fields is
  important.
    By converting the value field to a Single, and eliminating the Checkrow
  field, the record size could be reduced to 10 bytes.  The paragraph
  alignment feature would then have to be sacrificed, and the code altered in
  various places.
    The nodes in use are arranged in a series of linked lists, one for each
  equation (or row).  Within each list variables (columns) always appear in
  ascending order.  Each list is terminated by a RHS or constant entry; this
  is treated as though it corresponded to an extra variable, numbered (Neq+1).}

  </i></font>PElmRec        <font color="#000080">= ^</font>ElmRec<font color="#000080">;
  </font>ElmRec         <font color="#000080">= </font><font color="#FF0000"><b>record
                     </b></font>Column         <font color="#000080">: </font>Word<font color="#000080">; </font><font color="#008000"><i>{variable no. of this node}
                     </i></font>CheckRow       <font color="#000080">: </font>Word<font color="#000080">; </font><font color="#008000"><i>{equation no. of this node}
                     </i></font>Next           <font color="#000080">: </font>PElmRec<font color="#000080">; </font><font color="#008000"><i>{pointer to next node in row}
                     </i></font>Value          <font color="#000080">: </font>Double<font color="#000080">; </font><font color="#008000"><i>{coefficient value}
                   </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font>PtrArr         <font color="#000080">= </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font>MaxEq<font color="#000080">] </font><font color="#FF0000"><b>of </b></font>PElmRec<font color="#000080">;
  </font>PPtrArr        <font color="#000080">= ^</font>PtrArr<font color="#000080">;

  </font><font color="#008000"><i>{ Spare nodes, not currently in use, are linked together in one list,
  pointed to by FreePtr.  FreeCount is the number of spare nodes.  Because
  there may be very many nodes, all of the same size, they are not allocated
  directly on the heap by the System Heap Manager.  Instead a more efficient
  scheme is used.  When the list of free nodes needs to be expanded, a large
  block of memory is requested, sufficient for many nodes. Another linked list
  is used to store the addresses of these blocks, for later disposal to the
  system heap}

</i></font><font color="#FF0000"><b>const
  </b></font>ElmSize        <font color="#000080">= </font>SizeOf<font color="#000080">(</font>ElmRec<font color="#000080">);
  </font>MaxElmsPerBlock <font color="#000080">= </font>MaxUsable <font color="#FF0000"><b>div </b></font>ElmSize<font color="#000080">;
  </font>ElmsPerBlock   <font color="#000080">= </font>MaxElmsPerBlock<font color="#000080">; </font><font color="#008000"><i>{could be set to less}
</i></font><font color="#FF0000"><b>type
  </b></font>TBlock         <font color="#000080">= </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font>ElmsPerBlock<font color="#000080">] </font><font color="#FF0000"><b>of </b></font>ElmRec<font color="#000080">;
  </font>PBlock         <font color="#000080">= ^</font>TBlock<font color="#000080">;
  </font>PHeapRec       <font color="#000080">= ^</font>HeapRec<font color="#000080">;
  </font>HeapRec        <font color="#000080">= </font><font color="#FF0000"><b>record
                     </b></font>BlockPtr       <font color="#000080">: </font>PBlock<font color="#000080">; </font><font color="#008000"><i>{address of block}
                     </i></font>NextRec        <font color="#000080">: </font>PHeapRec<font color="#000080">; </font><font color="#008000"><i>{address of next list item}
                   </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>var                     </b></font><font color="#008000"><i>{this list contains variables which must have unit-wide
scope}
  </i></font>OldHeapError   <font color="#000080">: </font>Pointer<font color="#000080">; </font><font color="#008000"><i>{to restore previous HeapError function}
  </i></font>Reason         <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">; </font><font color="#008000"><i>{for error messages}
  </i></font>ErrNo1<font color="#000080">, </font>ErrNo2<font color="#000080">, </font>ErrNo3 <font color="#000080">: </font>Word<font color="#000080">; </font><font color="#008000"><i>{for error messages}
  </i></font>Answer         <font color="#000080">: </font>PRealArr<font color="#000080">; </font><font color="#008000"><i>{holds solution}
  </i></font>FreePtr        <font color="#000080">: </font>PElmRec<font color="#000080">; </font><font color="#008000"><i>{points to list of free nodes}
  </i></font>BlockList      <font color="#000080">: </font>PHeapRec<font color="#000080">; </font><font color="#008000"><i>{points to list of allocated node blocks}
  </i></font>FreeCount      <font color="#000080">: </font>Word<font color="#000080">; </font><font color="#008000"><i>{number of free nodes}
  </i></font>Neq            <font color="#000080">: </font>Word<font color="#000080">; </font><font color="#008000"><i>{number of equations}
  </i></font>FirstElm       <font color="#000080">: </font>PPtrArr<font color="#000080">; </font><font color="#008000"><i>{array of pointers to first node in each equation}
  </i></font>LastElm        <font color="#000080">: </font>PPtrArr<font color="#000080">; </font><font color="#008000"><i>{array of pointers to last node in each equation}
  </i></font>OrigFirstElm   <font color="#000080">: </font>PPtrArr<font color="#000080">;
  </font>OrigLastElm    <font color="#000080">: </font>PPtrArr<font color="#000080">;
  </font>OrigAnswer     <font color="#000080">: </font>PRealArr<font color="#000080">;
  </font>OrigNextActiveRow <font color="#000080">: </font>PIntArr<font color="#000080">;
  </font>OrigColCount   <font color="#000080">: </font>PIntArr<font color="#000080">;
  </font>OrigRowCount   <font color="#000080">: </font>PWordArr<font color="#000080">;
  </font>OrigPivRow     <font color="#000080">: </font>PWordArr<font color="#000080">;
</font><font color="#FF0000"><b>const
  </b></font>Initialized    <font color="#000080">: </font>Boolean <font color="#000080">= </font>False<font color="#000080">;

  </font><font color="#FF0000"><b>procedure </b></font>Assert<font color="#000080">(</font>P <font color="#000080">: </font>Boolean<font color="#000080">; </font>S <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">);
    </font><font color="#008000"><i>{used for debugging}
  </i></font><font color="#FF0000"><b>begin
    if </b></font>P <font color="#FF0000"><b>then </b></font>Exit<font color="#000080">;
    </font>WriteLn<font color="#000080">(</font><font color="#800000">'assertion failed: '</font><font color="#000080">, </font>S<font color="#000080">);
    </font>Halt<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;                  </font><font color="#008000"><i>{Assert}

  </i></font><font color="#FF0000"><b>function </b></font>HeapFunc<font color="#000080">(</font>Size <font color="#000080">: </font>Word<font color="#000080">) : </font>Integer<font color="#000080">; </font><font color="#FF0000"><b>far</b></font><font color="#000080">; </font><font color="#008000"><i>{allows trapping GetMem
errors}
  </i></font><font color="#FF0000"><b>begin </b></font>HeapFunc <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">; </font><font color="#FF0000"><b>end</b></font><font color="#000080">;


  </font><font color="#FF0000"><b>function </b></font>GetMemParaAlign<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>P<font color="#000080">, </font>OrigP <font color="#000080">: </font>Pointer<font color="#000080">; </font>Size <font color="#000080">: </font>Word<font color="#000080">) : </font>Boolean<font color="#000080">;
  </font><font color="#008000"><i>{ Returns a pointer P which is paragraph aligned (a multiple of ParaSize)
  and which points to a new block of memory of which at least Size bytes can
  be used.  The 486 cache is well suited to paragraph aligned data.
    In more detail, GetMemParaAlign obtains a block of memory from the system
  heap which is ParaSize bytes larger than Size.  OrigP points to this
  original block.  P is the first address after OrigP which is a multiple of
  ParaSize.  OrigP must be saved for passing (with Size) to a later
  FreeMemParaAlign call.}
  </i></font><font color="#FF0000"><b>type                  </b></font><font color="#008000"><i>{used only for typecasting}
    </i></font>PtrRec         <font color="#000080">= </font><font color="#FF0000"><b>record </b></font>OfsWord<font color="#000080">, </font>SegWord <font color="#000080">: </font>Word<font color="#000080">; </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>var
    </b></font>Ofset          <font color="#000080">: </font>Word<font color="#000080">;
  </font><font color="#FF0000"><b>begin
    if </b></font>Msg <font color="#FF0000"><b>then </b></font>WriteLn<font color="#000080">(</font><font color="#800000">'Entering GetMemParaAlign'</font><font color="#000080">);
    </font>P <font color="#000080">:= </font><font color="#FF0000"><b>nil</b></font><font color="#000080">; </font>OrigP <font color="#000080">:= </font><font color="#FF0000"><b>nil</b></font><font color="#000080">;
    </font>GetMemParaAlign <font color="#000080">:= </font>False<font color="#000080">;
    </font>OldHeapError <font color="#000080">:= </font>HeapError<font color="#000080">; </font>HeapError <font color="#000080">:= @</font>HeapFunc<font color="#000080">;
    </font>GetMem<font color="#000080">(</font>OrigP<font color="#000080">, </font>Size<font color="#000080">+</font>ParaSize<font color="#000080">);
    </font>HeapError <font color="#000080">:= </font>OldHeapError<font color="#000080">;
    </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>OrigP <font color="#000080">= </font><font color="#FF0000"><b>nil</b></font><font color="#000080">) </font><font color="#FF0000"><b>then </b></font>Exit<font color="#000080">;
    </font>Inc<font color="#000080">(</font>SparMemUsed<font color="#000080">, </font>Size<font color="#000080">+</font>ParaSize<font color="#000080">);
    </font>P <font color="#000080">:= </font>OrigP<font color="#000080">;         </font><font color="#008000"><i>{to load segment}
    </i></font>Ofset <font color="#000080">:= </font>PtrRec<font color="#000080">(</font>P<font color="#000080">).</font>OfsWord<font color="#000080">;
    </font><font color="#008000"><i>{adjust offset to paragraph boundary}
    </i></font>PtrRec<font color="#000080">(</font>P<font color="#000080">).</font>OfsWord <font color="#000080">:= </font>ParaSize<font color="#000080">+</font>ParaSize<font color="#000080">*(</font>Ofset <font color="#FF0000"><b>div </b></font>ParaSize<font color="#000080">);
    </font>GetMemParaAlign <font color="#000080">:= </font>True<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;                  </font><font color="#008000"><i>{GetMemParaAlign}

  </i></font><font color="#FF0000"><b>procedure </b></font>FreeMemParaAlign<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>OrigP <font color="#000080">: </font>Pointer<font color="#000080">; </font>Size <font color="#000080">: </font>Word<font color="#000080">);
 </font><font color="#008000"><i>{If OrigP&lt;&gt;Nil, returns a block at OrigP of (Size+ParaSize) bytes to the
  system heap.  Failure will cause a runtime error.  If this occurs, it is
  most likely due to an error in this unit!  }
  </i></font><font color="#FF0000"><b>begin
    if </b></font>Msg <font color="#FF0000"><b>then </b></font>WriteLn<font color="#000080">(</font><font color="#800000">'Entering FreeMemParaAlign'</font><font color="#000080">);
    </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>OrigP <font color="#000080">= </font><font color="#FF0000"><b>nil</b></font><font color="#000080">) </font><font color="#FF0000"><b>then </b></font>Exit<font color="#000080">; </font><font color="#008000"><i>{already freed or never allocated, we presume}
    </i></font>FreeMem<font color="#000080">(</font>OrigP<font color="#000080">, </font>Size<font color="#000080">+</font>ParaSize<font color="#000080">); </font><font color="#008000"><i>{failure will cause runtime error}
    </i></font>Dec<font color="#000080">(</font>SparMemUsed<font color="#000080">, </font>Size<font color="#000080">+</font>ParaSize<font color="#000080">);
    </font>OrigP <font color="#000080">:= </font><font color="#FF0000"><b>nil</b></font><font color="#000080">;       </font><font color="#008000"><i>{to indicate now freed}
  </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;                  </font><font color="#008000"><i>{FreeMemParaAlign}

  </i></font><font color="#FF0000"><b>function </b></font>FrePrime <font color="#000080">: </font>Boolean<font color="#000080">;
  </font><font color="#FF0000"><b>type                  </b></font><font color="#008000"><i>{used only for typecasting}
    </i></font>PtrRec         <font color="#000080">= </font><font color="#FF0000"><b>record </b></font>OfsWord<font color="#000080">, </font>SegWord <font color="#000080">: </font>Word<font color="#000080">; </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>var
    </b></font>NewBlock<font color="#000080">, </font>OrigBlock <font color="#000080">: </font>PBlock<font color="#000080">;
    </font>NewRec         <font color="#000080">: </font>PHeapRec<font color="#000080">;
    </font>Ofset<font color="#000080">, </font>Count   <font color="#000080">: </font>Word<font color="#000080">;
    </font>P              <font color="#000080">: </font>PElmRec<font color="#000080">;
  </font><font color="#FF0000"><b>begin
    if </b></font>Msg <font color="#FF0000"><b>then </b></font>WriteLn<font color="#000080">(</font><font color="#800000">'Entering FrePrime'</font><font color="#000080">);
    </font>FrePrime <font color="#000080">:= </font>False<font color="#000080">;

    </font><font color="#008000"><i>{add new node to list of blocks}
    </i></font>OldHeapError <font color="#000080">:= </font>HeapError<font color="#000080">; </font>HeapError <font color="#000080">:= @</font>HeapFunc<font color="#000080">;
    </font>NewRec <font color="#000080">:= </font><font color="#FF0000"><b>nil</b></font><font color="#000080">;
    </font>New<font color="#000080">(</font>NewRec<font color="#000080">); </font>Inc<font color="#000080">(</font>SparMemUsed<font color="#000080">, </font>SizeOf<font color="#000080">(</font>HeapRec<font color="#000080">));
    </font>HeapError <font color="#000080">:= </font>OldHeapError<font color="#000080">;
    </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>NewRec <font color="#000080">= </font><font color="#FF0000"><b>nil</b></font><font color="#000080">) </font><font color="#FF0000"><b>then </b></font>Exit<font color="#000080">;
    </font>NewRec<font color="#000080">^.</font>NextRec <font color="#000080">:= </font>BlockList<font color="#000080">;
    </font>NewRec<font color="#000080">^.</font>BlockPtr <font color="#000080">:= </font><font color="#FF0000"><b>nil</b></font><font color="#000080">;
    </font>BlockList <font color="#000080">:= </font>NewRec<font color="#000080">;


    </font><font color="#008000"><i>{get new block}
    </i></font><font color="#FF0000"><b>if not </b></font>GetMemParaAlign<font color="#000080">(</font>Pointer<font color="#000080">(</font>NewBlock<font color="#000080">), </font>Pointer<font color="#000080">(</font>OrigBlock<font color="#000080">),
</font>SizeOf<font color="#000080">(</font>TBlock<font color="#000080">)) </font><font color="#FF0000"><b>then </b></font>Exit<font color="#000080">;
    </font>NewRec<font color="#000080">^.</font>BlockPtr <font color="#000080">:= </font>OrigBlock<font color="#000080">;
    </font><font color="#008000"><i>{fill new block with linked nodes}
    </i></font>P <font color="#000080">:= </font>PElmRec<font color="#000080">(</font>NewBlock<font color="#000080">);
    </font>Ofset <font color="#000080">:= </font>PtrRec<font color="#000080">(</font>P<font color="#000080">).</font>OfsWord<font color="#000080">;
    </font><font color="#FF0000"><b>for </b></font>Count <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>ElmsPerBlock <font color="#FF0000"><b>do begin
      </b></font>Inc<font color="#000080">(</font>Ofset<font color="#000080">, </font>ElmSize<font color="#000080">);
      </font>PtrRec<font color="#000080">(</font>P<font color="#000080">).</font>OfsWord <font color="#000080">:= </font>Ofset<font color="#000080">;
      </font>NewBlock<font color="#000080">^[</font>Count<font color="#000080">].</font>Next <font color="#000080">:= </font>P<font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font>Inc<font color="#000080">(</font>FreeCount<font color="#000080">, </font>ElmsPerBlock<font color="#000080">);

    </font>NewBlock<font color="#000080">^[</font>ElmsPerBlock<font color="#000080">].</font>Next <font color="#000080">:= </font>FreePtr<font color="#000080">; </font><font color="#008000"><i>{point end of new block to
FreePtr}
    </i></font>FreePtr <font color="#000080">:= </font>PElmRec<font color="#000080">(</font>NewBlock<font color="#000080">); </font><font color="#008000"><i>{point FreePtr at start of new block}

    </i></font>FrePrime <font color="#000080">:= </font>True<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;                  </font><font color="#008000"><i>{FrePrime}

  </i></font><font color="#FF0000"><b>procedure </b></font>SetErrorMsg<font color="#000080">(</font>S <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">; </font>N1<font color="#000080">, </font>N2<font color="#000080">, </font>N3 <font color="#000080">: </font>Word<font color="#000080">);
  </font><font color="#FF0000"><b>begin
    </b></font>Reason <font color="#000080">:= </font>S<font color="#000080">; </font>ErrNo1 <font color="#000080">:= </font>N1<font color="#000080">; </font>ErrNo2 <font color="#000080">:= </font>N2<font color="#000080">; </font>ErrNo3 <font color="#000080">:= </font>N3<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;                  </font><font color="#008000"><i>{SetErrorMsg}

  </i></font><font color="#FF0000"><b>procedure </b></font>GetErrorMsg<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>S <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">; </font><font color="#FF0000"><b>var </b></font>N1<font color="#000080">, </font>N2<font color="#000080">, </font>N3 <font color="#000080">: </font>Word<font color="#000080">);
  </font><font color="#FF0000"><b>begin
    </b></font>S <font color="#000080">:= </font>Reason<font color="#000080">; </font>N1 <font color="#000080">:= </font>ErrNo1<font color="#000080">; </font>N2 <font color="#000080">:= </font>ErrNo2<font color="#000080">; </font>N3 <font color="#000080">:= </font>ErrNo3<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;                  </font><font color="#008000"><i>{GetErrorMsg}

  </i></font><font color="#FF0000"><b>procedure </b></font>FillStruct<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>Dest<font color="#000080">; </font>Count <font color="#000080">: </font>Word<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>Filler<font color="#000080">; </font>FillerSize <font color="#000080">: </font>Word<font color="#000080">);
    </font><font color="#008000"><i>{-Fill memory starting at Dest with Count instances of Filler}
  </i></font><font color="#FF0000"><b>inline</b></font><font color="#000080">(
    </font><font color="#800000">$58</font><font color="#000080">/</font><font color="#800000">$5B</font><font color="#000080">/</font><font color="#800000">$5A</font><font color="#000080">/</font><font color="#800000">$59</font><font color="#000080">/</font><font color="#800000">$5F</font><font color="#000080">/</font><font color="#800000">$07</font><font color="#000080">/</font><font color="#800000">$E3</font><font color="#000080">/</font><font color="#800000">$11</font><font color="#000080">/</font><font color="#800000">$FC</font><font color="#000080">/</font><font color="#800000">$1E</font><font color="#000080">/</font><font color="#800000">$8E</font><font color="#000080">/</font><font color="#800000">$DA</font><font color="#000080">/
    </font><font color="#800000">$89</font><font color="#000080">/</font><font color="#800000">$CA</font><font color="#000080">/</font><font color="#800000">$89</font><font color="#000080">/</font><font color="#800000">$DE</font><font color="#000080">/</font><font color="#800000">$89</font><font color="#000080">/</font><font color="#800000">$C1</font><font color="#000080">/</font><font color="#800000">$F2</font><font color="#000080">/</font><font color="#800000">$A4</font><font color="#000080">/</font><font color="#800000">$89</font><font color="#000080">/</font><font color="#800000">$D1</font><font color="#000080">/</font><font color="#800000">$E2</font><font color="#000080">/</font><font color="#800000">$F4</font><font color="#000080">/</font><font color="#800000">$1F</font><font color="#000080">);

  </font><font color="#FF0000"><b>function </b></font>InitStruc<font color="#000080">(</font>NumEq <font color="#000080">: </font>Word<font color="#000080">) : </font>Boolean<font color="#000080">;
  </font><font color="#FF0000"><b>var
    </b></font>Col            <font color="#000080">: </font>Word<font color="#000080">;
  </font><font color="#FF0000"><b>label </b></font>Fail<font color="#000080">;
  </font><font color="#FF0000"><b>begin
    if </b></font>Msg <font color="#FF0000"><b>then </b></font>WriteLn<font color="#000080">(</font><font color="#800000">'Entering InitStruc'</font><font color="#000080">);
    </font>InitStruc <font color="#000080">:= </font>False<font color="#000080">;
    </font>SetErrorMsg<font color="#000080">(</font><font color="#800000">''</font><font color="#000080">, </font><font color="#800000">0</font><font color="#000080">, </font><font color="#800000">0</font><font color="#000080">, </font><font color="#800000">0</font><font color="#000080">);
    </font>SparMemUsed <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;

    </font>OrigAnswer <font color="#000080">:= </font><font color="#FF0000"><b>nil</b></font><font color="#000080">;
    </font>OrigColCount <font color="#000080">:= </font><font color="#FF0000"><b>nil</b></font><font color="#000080">;
    </font>OrigFirstElm <font color="#000080">:= </font><font color="#FF0000"><b>nil</b></font><font color="#000080">;
    </font>OrigLastElm <font color="#000080">:= </font><font color="#FF0000"><b>nil</b></font><font color="#000080">;
    </font>OrigNextActiveRow <font color="#000080">:= </font><font color="#FF0000"><b>nil</b></font><font color="#000080">;
    </font>OrigPivRow <font color="#000080">:= </font><font color="#FF0000"><b>nil</b></font><font color="#000080">;
    </font>OrigRowCount <font color="#000080">:= </font><font color="#FF0000"><b>nil</b></font><font color="#000080">;

    </font><font color="#FF0000"><b>if </b></font>Initialized <font color="#FF0000"><b>then begin
      </b></font>SetErrorMsg<font color="#000080">(</font><font color="#800000">'Initialize without releasing '</font><font color="#000080">, </font><font color="#800000">25</font><font color="#000080">, </font><font color="#800000">0</font><font color="#000080">, </font><font color="#800000">0</font><font color="#000080">);
      </font>Exit<font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font>Initialized <font color="#000080">:= </font>True<font color="#000080">;
    </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>NumEq <font color="#000080">&gt; </font>MaxEq<font color="#000080">) </font><font color="#FF0000"><b>then begin
      </b></font>SetErrorMsg<font color="#000080">(</font><font color="#800000">'Too many equations '</font><font color="#000080">, </font><font color="#800000">26</font><font color="#000080">, </font>NumEq<font color="#000080">, </font>MaxEq<font color="#000080">);
      </font>Exit<font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>NumEq <font color="#000080">&lt; </font><font color="#800000">1</font><font color="#000080">) </font><font color="#FF0000"><b>then begin
      </b></font>SetErrorMsg<font color="#000080">(</font><font color="#800000">'Too few equations '</font><font color="#000080">, </font><font color="#800000">27</font><font color="#000080">, </font>NumEq<font color="#000080">, </font><font color="#800000">0</font><font color="#000080">);
      </font>Exit<font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

    </font>Neq <font color="#000080">:= </font>NumEq<font color="#000080">;
    </font><font color="#FF0000"><b>if not </b></font>GetMemParaAlign<font color="#000080">(</font>Pointer<font color="#000080">(</font>FirstElm<font color="#000080">), </font>Pointer<font color="#000080">(</font>OrigFirstElm<font color="#000080">),
(</font><font color="#800000">1</font><font color="#000080">+</font>NumEq<font color="#000080">)*</font>SizeOf<font color="#000080">(</font>PElmRec<font color="#000080">)) </font><font color="#FF0000"><b>then begin
      </b></font>SetErrorMsg<font color="#000080">(</font><font color="#800000">'Out of Space'</font><font color="#000080">, </font><font color="#800000">7</font><font color="#000080">, </font><font color="#800000">0</font><font color="#000080">, </font><font color="#800000">1</font><font color="#000080">);
      </font>Exit<font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>if not </b></font>GetMemParaAlign<font color="#000080">(</font>Pointer<font color="#000080">(</font>LastElm<font color="#000080">), </font>Pointer<font color="#000080">(</font>OrigLastElm<font color="#000080">),
(</font><font color="#800000">1</font><font color="#000080">+</font>NumEq<font color="#000080">)*</font>SizeOf<font color="#000080">(</font>PElmRec<font color="#000080">)) </font><font color="#FF0000"><b>then begin
      </b></font>SetErrorMsg<font color="#000080">(</font><font color="#800000">'Out of Space'</font><font color="#000080">, </font><font color="#800000">7</font><font color="#000080">, </font><font color="#800000">0</font><font color="#000080">, </font><font color="#800000">2</font><font color="#000080">);
      </font>Exit<font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

    </font>BlockList <font color="#000080">:= </font><font color="#FF0000"><b>nil</b></font><font color="#000080">;
    </font>FreePtr <font color="#000080">:= </font><font color="#FF0000"><b>nil</b></font><font color="#000080">;
    </font>Col <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
    </font>FreeCount <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
    </font>FillStruct<font color="#000080">(</font>FirstElm<font color="#000080">^, </font><font color="#800000">1</font><font color="#000080">+</font>Neq<font color="#000080">, </font>FreePtr<font color="#000080">, </font>SizeOf<font color="#000080">(</font>FreePtr<font color="#000080">));
    </font>FillStruct<font color="#000080">(</font>LastElm<font color="#000080">^, </font><font color="#800000">1</font><font color="#000080">+</font>Neq<font color="#000080">, </font>FreePtr<font color="#000080">, </font>SizeOf<font color="#000080">(</font>FreePtr<font color="#000080">));
    </font>InitStruc <font color="#000080">:= </font>True<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;                  </font><font color="#008000"><i>{InitStruc}

  </i></font><font color="#FF0000"><b>procedure </b></font>ReleaseStruc<font color="#000080">;
  </font><font color="#FF0000"><b>var
    </b></font>OrigBlock      <font color="#000080">: </font>PBlock<font color="#000080">;
    </font>NextPtr        <font color="#000080">: </font>PHeapRec<font color="#000080">;
  </font><font color="#FF0000"><b>begin
    if </b></font>Msg <font color="#FF0000"><b>then </b></font>WriteLn<font color="#000080">(</font><font color="#800000">'Entering ReleaseStruc'</font><font color="#000080">);
    </font>Initialized <font color="#000080">:= </font>False<font color="#000080">;

    </font><font color="#008000"><i>{some of these may have been released already}
    </i></font>FreeMemParaAlign<font color="#000080">(</font>Pointer<font color="#000080">(</font>OrigAnswer<font color="#000080">), (</font><font color="#800000">1</font><font color="#000080">+</font>Neq<font color="#000080">)*</font>SizeOf<font color="#000080">(</font>Double<font color="#000080">));
    </font>FreeMemParaAlign<font color="#000080">(</font>Pointer<font color="#000080">(</font>OrigColCount<font color="#000080">), (</font><font color="#800000">1</font><font color="#000080">+</font>Neq<font color="#000080">)*</font>SizeOf<font color="#000080">(</font>Integer<font color="#000080">));
    </font>FreeMemParaAlign<font color="#000080">(</font>Pointer<font color="#000080">(</font>OrigFirstElm<font color="#000080">), (</font><font color="#800000">1</font><font color="#000080">+</font>Neq<font color="#000080">)*</font>SizeOf<font color="#000080">(</font>PElmRec<font color="#000080">));
    </font>FreeMemParaAlign<font color="#000080">(</font>Pointer<font color="#000080">(</font>OrigLastElm<font color="#000080">), (</font><font color="#800000">1</font><font color="#000080">+</font>Neq<font color="#000080">)*</font>SizeOf<font color="#000080">(</font>PElmRec<font color="#000080">));
    </font>FreeMemParaAlign<font color="#000080">(</font>Pointer<font color="#000080">(</font>OrigNextActiveRow<font color="#000080">), (</font><font color="#800000">1</font><font color="#000080">+</font>Neq<font color="#000080">)*</font>SizeOf<font color="#000080">(</font>Integer<font color="#000080">));
    </font>FreeMemParaAlign<font color="#000080">(</font>Pointer<font color="#000080">(</font>OrigPivRow<font color="#000080">), (</font><font color="#800000">1</font><font color="#000080">+</font>Neq<font color="#000080">)*</font>SizeOf<font color="#000080">(</font>Word<font color="#000080">));
    </font>FreeMemParaAlign<font color="#000080">(</font>Pointer<font color="#000080">(</font>OrigRowCount<font color="#000080">), (</font><font color="#800000">1</font><font color="#000080">+</font>Neq<font color="#000080">)*</font>SizeOf<font color="#000080">(</font>Word<font color="#000080">));


    </font><font color="#008000"><i>{get rid of user heap}
    </i></font><font color="#FF0000"><b>while </b></font><font color="#000080">(</font>BlockList <font color="#000080">&lt;&gt; </font><font color="#FF0000"><b>nil</b></font><font color="#000080">) </font><font color="#FF0000"><b>do begin
      </b></font>OrigBlock <font color="#000080">:= </font>BlockList<font color="#000080">^.</font>BlockPtr<font color="#000080">;
      </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>OrigBlock <font color="#000080">&lt;&gt; </font><font color="#FF0000"><b>nil</b></font><font color="#000080">) </font><font color="#FF0000"><b>then begin
        </b></font>FreeMemParaAlign<font color="#000080">(</font>Pointer<font color="#000080">(</font>OrigBlock<font color="#000080">), </font>SizeOf<font color="#000080">(</font>TBlock<font color="#000080">));
        </font><font color="#FF0000"><b>if </b></font>Msg <font color="#FF0000"><b>then </b></font>WriteLn<font color="#000080">(</font><font color="#800000">'releasing a block'</font><font color="#000080">);
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font>NextPtr <font color="#000080">:= </font>BlockList<font color="#000080">^.</font>NextRec<font color="#000080">;
      </font>Dispose<font color="#000080">(</font>BlockList<font color="#000080">); </font>Dec<font color="#000080">(</font>SparMemUsed<font color="#000080">, </font>SizeOf<font color="#000080">(</font>HeapRec<font color="#000080">));
      </font>BlockList <font color="#000080">:= </font>NextPtr<font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;                </font><font color="#008000"><i>{while}

    </i></font>Initialized <font color="#000080">:= </font>False<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;                  </font><font color="#008000"><i>{ReleaseStruc}

  </i></font><font color="#FF0000"><b>function </b></font>AddElement<font color="#000080">(</font>ThisEqu<font color="#000080">, </font>ThisVar <font color="#000080">: </font>Word<font color="#000080">; </font>ThisVal <font color="#000080">: </font>Double<font color="#000080">) : </font>Boolean<font color="#000080">;
  </font><font color="#FF0000"><b>var
    </b></font>PrevPtr<font color="#000080">, </font>ElmPtr<font color="#000080">, </font>NewPtr <font color="#000080">: </font>PElmRec<font color="#000080">;
  </font><font color="#FF0000"><b>begin                 </b></font><font color="#008000"><i>{PivRow[Row] points to last element }
    </i></font>AddElement <font color="#000080">:= </font>False<font color="#000080">;
    </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>ThisEqu <font color="#000080">&lt; </font><font color="#800000">1</font><font color="#000080">) </font><font color="#FF0000"><b>then begin </b></font>SetErrorMsg<font color="#000080">(</font><font color="#800000">'Row &lt; 1'</font><font color="#000080">, </font><font color="#800000">30</font><font color="#000080">, </font>ThisEqu<font color="#000080">, </font>ThisVar<font color="#000080">);
</font>Exit<font color="#000080">; </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>ThisVar <font color="#000080">&lt; </font><font color="#800000">1</font><font color="#000080">) </font><font color="#FF0000"><b>then begin </b></font>SetErrorMsg<font color="#000080">(</font><font color="#800000">'Col &lt; 1'</font><font color="#000080">, </font><font color="#800000">31</font><font color="#000080">, </font>ThisEqu<font color="#000080">, </font>ThisVar<font color="#000080">);
</font>Exit<font color="#000080">; </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>ThisEqu <font color="#000080">&gt; </font>Neq<font color="#000080">) </font><font color="#FF0000"><b>then begin </b></font>SetErrorMsg<font color="#000080">(</font><font color="#800000">'Row &gt; Neq'</font><font color="#000080">, </font><font color="#800000">32</font><font color="#000080">, </font>ThisEqu<font color="#000080">, </font>Neq<font color="#000080">);
</font>Exit<font color="#000080">; </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>ThisVar <font color="#000080">&gt; (</font><font color="#800000">1</font><font color="#000080">+</font>Neq<font color="#000080">)) </font><font color="#FF0000"><b>then begin </b></font>SetErrorMsg<font color="#000080">(</font><font color="#800000">'Col &gt; Neq'</font><font color="#000080">, </font><font color="#800000">33</font><font color="#000080">, </font>ThisVar<font color="#000080">,
</font>Neq<font color="#000080">); </font>Exit<font color="#000080">; </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>if </b></font>ThisVal <font color="#000080">= </font><font color="#800000">0.0 </font><font color="#FF0000"><b>then begin </b></font>AddElement <font color="#000080">:= </font>True<font color="#000080">; </font>Exit<font color="#000080">; </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>FreeCount <font color="#000080">&lt; </font>Neq<font color="#000080">) </font><font color="#FF0000"><b>then begin
      if not </b></font>FrePrime <font color="#FF0000"><b>then begin
        </b></font>SetErrorMsg<font color="#000080">(</font><font color="#800000">'Out of Space'</font><font color="#000080">, </font><font color="#800000">7</font><font color="#000080">, </font><font color="#800000">0</font><font color="#000080">, </font><font color="#800000">3</font><font color="#000080">); </font>Exit<font color="#000080">;
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font>NewPtr <font color="#000080">:= </font>FreePtr<font color="#000080">; </font>FreePtr <font color="#000080">:= </font>FreePtr<font color="#000080">^.</font>Next<font color="#000080">; </font>Dec<font color="#000080">(</font>FreeCount<font color="#000080">);

    </font>NewPtr<font color="#000080">^.</font>Value <font color="#000080">:= </font>ThisVal<font color="#000080">;
    </font>NewPtr<font color="#000080">^.</font>Column <font color="#000080">:= </font>ThisVar<font color="#000080">;
    </font>NewPtr<font color="#000080">^.</font>Next <font color="#000080">:= </font><font color="#FF0000"><b>nil</b></font><font color="#000080">;

    </font><font color="#FF0000"><b>if </b></font>FirstElm<font color="#000080">^[</font>ThisEqu<font color="#000080">] = </font><font color="#FF0000"><b>nil then begin
      </b></font>FirstElm<font color="#000080">^[</font>ThisEqu<font color="#000080">] := </font>NewPtr<font color="#000080">;
      </font>LastElm<font color="#000080">^[</font>ThisEqu<font color="#000080">] := </font>NewPtr<font color="#000080">;
    </font><font color="#FF0000"><b>end
    else if </b></font><font color="#000080">(</font>LastElm<font color="#000080">^[</font>ThisEqu<font color="#000080">]^.</font>Column <font color="#000080">&lt; </font>ThisVar<font color="#000080">) </font><font color="#FF0000"><b>then begin
      </b></font>LastElm<font color="#000080">^[</font>ThisEqu<font color="#000080">]^.</font>Next <font color="#000080">:= </font>NewPtr<font color="#000080">;
      </font>LastElm<font color="#000080">^[</font>ThisEqu<font color="#000080">] := </font>NewPtr<font color="#000080">;
    </font><font color="#FF0000"><b>end
    else begin          </b></font><font color="#008000"><i>{insertion sort}
      </i></font>ElmPtr <font color="#000080">:= </font>FirstElm<font color="#000080">^[</font>ThisEqu<font color="#000080">];
      </font>PrevPtr <font color="#000080">:= </font><font color="#FF0000"><b>nil</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>while </b></font><font color="#000080">(</font>ElmPtr<font color="#000080">^.</font>Column <font color="#000080">&lt; </font>ThisVar<font color="#000080">) </font><font color="#FF0000"><b>do begin
        </b></font>PrevPtr <font color="#000080">:= </font>ElmPtr<font color="#000080">;
        </font>ElmPtr <font color="#000080">:= </font>ElmPtr<font color="#000080">^.</font>Next<font color="#000080">;
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>ElmPtr<font color="#000080">^.</font>Column <font color="#000080">= </font>ThisVar<font color="#000080">) </font><font color="#FF0000"><b>then begin
        </b></font>ElmPtr<font color="#000080">^.</font>Value <font color="#000080">:= </font>ElmPtr<font color="#000080">^.</font>Value<font color="#000080">+</font>ThisVal<font color="#000080">;
        </font><font color="#008000"><i>{new node not needed: return to free list}
        </i></font>NewPtr<font color="#000080">^.</font>Next <font color="#000080">:= </font>FreePtr<font color="#000080">; </font>FreePtr <font color="#000080">:= </font>NewPtr<font color="#000080">; </font>Inc<font color="#000080">(</font>FreeCount<font color="#000080">);
      </font><font color="#FF0000"><b>end
      else </b></font><font color="#008000"><i>{ElmPtr^.Column &gt; ThisVar} </i></font><font color="#FF0000"><b>begin
        if </b></font>PrevPtr <font color="#000080">= </font><font color="#FF0000"><b>nil then </b></font>FirstElm<font color="#000080">^[</font>ThisEqu<font color="#000080">] := </font>NewPtr
        <font color="#FF0000"><b>else </b></font>PrevPtr<font color="#000080">^.</font>Next <font color="#000080">:= </font>NewPtr<font color="#000080">;
        </font>NewPtr<font color="#000080">^.</font>Next <font color="#000080">:= </font>ElmPtr<font color="#000080">;
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font>AddElement <font color="#000080">:= </font>True<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;                  </font><font color="#008000"><i>{AddElement}

  </i></font><font color="#FF0000"><b>function </b></font>SetRHS<font color="#000080">(</font>ThisEqu <font color="#000080">: </font>Word<font color="#000080">; </font>ThisVal <font color="#000080">: </font>Double<font color="#000080">) : </font>Boolean<font color="#000080">;
  </font><font color="#FF0000"><b>begin
    </b></font>SetRHS <font color="#000080">:= </font>AddElement<font color="#000080">(</font>ThisEqu<font color="#000080">, </font><font color="#800000">1</font><font color="#000080">+</font>Neq<font color="#000080">, </font>ThisVal<font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;                  </font><font color="#008000"><i>{SetRHS}

  </i></font><font color="#FF0000"><b>function </b></font>GetAnswer<font color="#000080">(</font>ThisVar <font color="#000080">: </font>Word<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>ThisVal <font color="#000080">: </font>Double<font color="#000080">) : </font>Boolean<font color="#000080">;
    </font><font color="#008000"><i>{should fail if solve not called}
  </i></font><font color="#FF0000"><b>begin
    if </b></font><font color="#000080">((</font>ThisVar <font color="#000080">&gt; </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>ThisVar <font color="#000080">&lt;= </font>Neq<font color="#000080">)) </font><font color="#FF0000"><b>then begin
      </b></font>GetAnswer <font color="#000080">:= </font>True<font color="#000080">;
      </font>ThisVal <font color="#000080">:= </font>Answer<font color="#000080">^[</font>ThisVar<font color="#000080">];
    </font><font color="#FF0000"><b>end
    else begin
      </b></font>GetAnswer <font color="#000080">:= </font>False<font color="#000080">;
      </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>ThisVar <font color="#000080">&lt; </font><font color="#800000">1</font><font color="#000080">) </font><font color="#FF0000"><b>then </b></font>SetErrorMsg<font color="#000080">(</font><font color="#800000">'VarNo &lt; 1'</font><font color="#000080">, </font><font color="#800000">41</font><font color="#000080">, </font>ThisVar<font color="#000080">, </font><font color="#800000">0</font><font color="#000080">);
      </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>ThisVar <font color="#000080">&gt; </font>Neq<font color="#000080">) </font><font color="#FF0000"><b>then </b></font>SetErrorMsg<font color="#000080">(</font><font color="#800000">'VarNo &gt; Neq'</font><font color="#000080">, </font><font color="#800000">42</font><font color="#000080">, </font>ThisVar<font color="#000080">, </font>Neq<font color="#000080">);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;                </font><font color="#008000"><i>{else}
  </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;                  </font><font color="#008000"><i>{GetAnswer}

  </i></font><font color="#FF0000"><b>procedure </b></font>showmat<font color="#000080">;
  </font><font color="#FF0000"><b>var
    </b></font>Row<font color="#000080">, </font>Col<font color="#000080">, </font>c<font color="#000080">, </font>LastCol <font color="#000080">: </font>Word<font color="#000080">;
    </font>ElmPtr         <font color="#000080">: </font>PElmRec<font color="#000080">;
  </font><font color="#FF0000"><b>begin
    for </b></font>Row <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>Neq <font color="#FF0000"><b>do begin
      </b></font>ElmPtr <font color="#000080">:= </font>FirstElm<font color="#000080">^[</font>Row<font color="#000080">];
      </font>LastCol <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
      </font><font color="#FF0000"><b>while </b></font>ElmPtr <font color="#000080">&lt;&gt; </font><font color="#FF0000"><b>nil do begin
        </b></font>Col <font color="#000080">:= </font>ElmPtr<font color="#000080">^.</font>Column<font color="#000080">;
        </font><font color="#FF0000"><b>for </b></font>c <font color="#000080">:= (</font>LastCol<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">) </font><font color="#FF0000"><b>to </b></font><font color="#000080">(</font>Col<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">) </font><font color="#FF0000"><b>do </b></font>Write<font color="#000080">(</font><font color="#800000">'nil'</font><font color="#000080">:</font><font color="#800000">6</font><font color="#000080">);
        </font>Write<font color="#000080">(</font>ElmPtr<font color="#000080">^.</font>Value<font color="#000080">:</font><font color="#800000">6</font><font color="#000080">:</font><font color="#800000">2</font><font color="#000080">);
        </font>LastCol <font color="#000080">:= </font>Col<font color="#000080">;
        </font>ElmPtr <font color="#000080">:= </font>ElmPtr<font color="#000080">^.</font>Next<font color="#000080">;
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>for </b></font>c <font color="#000080">:= (</font>LastCol<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">) </font><font color="#FF0000"><b>to </b></font><font color="#000080">(</font>Neq<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">) </font><font color="#FF0000"><b>do </b></font>Write<font color="#000080">(</font><font color="#800000">'nil'</font><font color="#000080">:</font><font color="#800000">6</font><font color="#000080">);
      </font>WriteLn<font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;                </font><font color="#008000"><i>{for row}
  </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;                  </font><font color="#008000"><i>{showmat}


</i></font><font color="#FF0000"><b>var
  </b></font>SumTerm        <font color="#000080">: </font>Extended<font color="#000080">;
  </font>Factor         <font color="#000080">: </font>Extended<font color="#000080">;
  </font>RHS            <font color="#000080">: </font>Extended<font color="#000080">;
  </font>Biggest        <font color="#000080">: </font>Extended<font color="#000080">;
  </font>Coeff          <font color="#000080">: </font>Extended<font color="#000080">;
  </font>PivotValue     <font color="#000080">: </font>Extended<font color="#000080">;
  </font>BestPtr        <font color="#000080">: </font>PElmRec<font color="#000080">;
  </font>PrevPtr        <font color="#000080">: </font>PElmRec<font color="#000080">;
  </font>Next_Pivot     <font color="#000080">: </font>PElmRec<font color="#000080">;
  </font>Next_Tar       <font color="#000080">: </font>PElmRec<font color="#000080">;
  </font>NewPtr         <font color="#000080">: </font>PElmRec<font color="#000080">;
  </font>ElmPtr         <font color="#000080">: </font>PElmRec<font color="#000080">;
  </font>MinRowCount    <font color="#000080">: </font>Word<font color="#000080">;
  </font>Best_Addelm    <font color="#000080">: </font>Word<font color="#000080">;
  </font>NextTarCol     <font color="#000080">: </font>Word<font color="#000080">;
  </font>NumToFind      <font color="#000080">: </font>Word<font color="#000080">;
  </font>AddElm         <font color="#000080">: </font>Word<font color="#000080">;
  </font>Col<font color="#000080">, </font>LastCol   <font color="#000080">: </font>Word<font color="#000080">;
  </font>SingleCount    <font color="#000080">: </font>Word<font color="#000080">;
  </font>PivotStep      <font color="#000080">: </font>Word<font color="#000080">;
  </font>PivotCol       <font color="#000080">: </font>Word<font color="#000080">;
  </font>NextPivotCol   <font color="#000080">: </font>Word<font color="#000080">;
  </font>LastRow        <font color="#000080">: </font>Word<font color="#000080">;
  </font>PrevRow<font color="#000080">, </font>NextRow <font color="#000080">: </font>Word<font color="#000080">;
  </font>PivotRow       <font color="#000080">: </font>Word<font color="#000080">;
  </font>Row            <font color="#000080">: </font>Word<font color="#000080">;
  </font>NextActiveRow  <font color="#000080">: </font>PIntArr<font color="#000080">;
  </font>ColCount       <font color="#000080">: </font>PIntArr<font color="#000080">;
  </font>RowCount       <font color="#000080">: </font>PWordArr<font color="#000080">;
  </font>PivRow         <font color="#000080">: </font>PWordArr<font color="#000080">;
  </font><font color="#FF0000"><b>function </b></font>Solve1 <font color="#000080">: </font>Boolean<font color="#000080">;

  </font><font color="#FF0000"><b>label </b></font>Go_on<font color="#000080">, </font>AsBigAs<font color="#000080">, </font>NextOne<font color="#000080">;
  </font><font color="#FF0000"><b>label </b></font>TwoSingles<font color="#000080">, </font>NumericallySingular<font color="#000080">, </font>NoVars<font color="#000080">, </font>EmptyRow<font color="#000080">, </font>EmptyCol<font color="#000080">,
</font>OutOfSpace<font color="#000080">, </font>ColsOutofOrder<font color="#000080">, </font>NoRHS<font color="#000080">;
  </font><font color="#FF0000"><b>label </b></font>InsertElm<font color="#000080">, </font>AdjustElm<font color="#000080">, </font>OutCase<font color="#000080">;
  </font><font color="#FF0000"><b>begin                 </b></font><font color="#008000"><i>{solve1}
    </i></font><font color="#FF0000"><b>if </b></font>Msg <font color="#FF0000"><b>then </b></font>WriteLn<font color="#000080">(</font><font color="#800000">'Entering Solve1'</font><font color="#000080">);
    </font>PivotStep <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
    </font>FreeMemParaAlign<font color="#000080">(</font>Pointer<font color="#000080">(</font>OrigLastElm<font color="#000080">), (</font><font color="#800000">1</font><font color="#000080">+</font>Neq<font color="#000080">)*</font>SizeOf<font color="#000080">(</font>PElmRec<font color="#000080">));


    </font><font color="#FF0000"><b>if not </b></font>GetMemParaAlign<font color="#000080">(</font>Pointer<font color="#000080">(</font>NextActiveRow<font color="#000080">), </font>Pointer<font color="#000080">(</font>OrigNextActiveRow<font color="#000080">),
(</font><font color="#800000">1</font><font color="#000080">+</font>Neq<font color="#000080">)*</font>SizeOf<font color="#000080">(</font>Integer<font color="#000080">)) </font><font color="#FF0000"><b>then goto </b></font>OutOfSpace<font color="#000080">;
    </font><font color="#FF0000"><b>if not </b></font>GetMemParaAlign<font color="#000080">(</font>Pointer<font color="#000080">(</font>ColCount<font color="#000080">), </font>Pointer<font color="#000080">(</font>OrigColCount<font color="#000080">),
(</font><font color="#800000">1</font><font color="#000080">+</font>Neq<font color="#000080">)*</font>SizeOf<font color="#000080">(</font>Integer<font color="#000080">)) </font><font color="#FF0000"><b>then goto </b></font>OutOfSpace<font color="#000080">;
    </font><font color="#FF0000"><b>if not </b></font>GetMemParaAlign<font color="#000080">(</font>Pointer<font color="#000080">(</font>RowCount<font color="#000080">), </font>Pointer<font color="#000080">(</font>OrigRowCount<font color="#000080">),
(</font><font color="#800000">1</font><font color="#000080">+</font>Neq<font color="#000080">)*</font>SizeOf<font color="#000080">(</font>Word<font color="#000080">)) </font><font color="#FF0000"><b>then goto </b></font>OutOfSpace<font color="#000080">;
    </font><font color="#FF0000"><b>if not </b></font>GetMemParaAlign<font color="#000080">(</font>Pointer<font color="#000080">(</font>PivRow<font color="#000080">), </font>Pointer<font color="#000080">(</font>OrigPivRow<font color="#000080">),
(</font><font color="#800000">1</font><font color="#000080">+</font>Neq<font color="#000080">)*</font>SizeOf<font color="#000080">(</font>Word<font color="#000080">)) </font><font color="#FF0000"><b>then goto </b></font>OutOfSpace<font color="#000080">;


    </font>Col <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;           </font><font color="#008000"><i>{set vectors to zero}
    </i></font>FillStruct<font color="#000080">(</font>RowCount<font color="#000080">^, </font><font color="#800000">1</font><font color="#000080">+</font>Neq<font color="#000080">, </font>Col<font color="#000080">, </font>SizeOf<font color="#000080">(</font>Word<font color="#000080">));
    </font>FillStruct<font color="#000080">(</font>PivRow<font color="#000080">^, </font><font color="#800000">1</font><font color="#000080">+</font>Neq<font color="#000080">, </font>Col<font color="#000080">, </font>SizeOf<font color="#000080">(</font>Word<font color="#000080">));
    </font>FillStruct<font color="#000080">(</font>ColCount<font color="#000080">^, </font><font color="#800000">1</font><font color="#000080">+</font>Neq<font color="#000080">, </font>Col<font color="#000080">, </font>SizeOf<font color="#000080">(</font>Word<font color="#000080">));

    </font>Solve1 <font color="#000080">:= </font>False<font color="#000080">;
    </font><font color="#FF0000"><b>if </b></font>Msg <font color="#FF0000"><b>then </b></font>WriteLn<font color="#000080">(</font><font color="#800000">'about to set up row and column counts'</font><font color="#000080">);
    </font><font color="#FF0000"><b>for </b></font>Row <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>Neq <font color="#FF0000"><b>do begin
      </b></font>ElmPtr <font color="#000080">:= </font>FirstElm<font color="#000080">^[</font>Row<font color="#000080">];
      </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>ElmPtr <font color="#000080">= </font><font color="#FF0000"><b>nil</b></font><font color="#000080">) </font><font color="#FF0000"><b>then goto </b></font>EmptyRow<font color="#000080">;
      </font>LastCol <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
      </font><font color="#FF0000"><b>while </b></font>ElmPtr <font color="#000080">&lt;&gt; </font><font color="#FF0000"><b>nil do begin
        </b></font>Col <font color="#000080">:= </font>ElmPtr<font color="#000080">^.</font>Column<font color="#000080">;
        </font><font color="#FF0000"><b>if </b></font>DBug <font color="#FF0000"><b>then </b></font>ElmPtr<font color="#000080">^.</font>CheckRow <font color="#000080">:= </font>Row<font color="#000080">;
        </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>Col <font color="#000080">&lt;= </font>LastCol<font color="#000080">) </font><font color="#FF0000"><b>then goto </b></font>ColsOutofOrder
        <font color="#FF0000"><b>else </b></font>LastCol <font color="#000080">:= </font>Col<font color="#000080">;
        </font>Inc<font color="#000080">(</font>RowCount<font color="#000080">^[</font>Row<font color="#000080">]);
        </font><font color="#FF0000"><b>if </b></font>DBug <font color="#FF0000"><b>then </b></font>Assert<font color="#000080">(</font>Col <font color="#000080">&gt; </font><font color="#800000">0</font><font color="#000080">, </font><font color="#800000">'#2133'</font><font color="#000080">);
        </font><font color="#FF0000"><b>if </b></font>DBug <font color="#FF0000"><b>then </b></font>Assert<font color="#000080">(</font>Col <font color="#000080">&lt;= (</font><font color="#800000">1</font><font color="#000080">+</font>Neq<font color="#000080">), </font><font color="#800000">'#2134'</font><font color="#000080">);
        </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>Col <font color="#000080">&lt;= </font>Neq<font color="#000080">) </font><font color="#FF0000"><b>then </b></font>Inc<font color="#000080">(</font>ColCount<font color="#000080">^[</font>Col<font color="#000080">]);
        </font>ElmPtr <font color="#000080">:= </font>ElmPtr<font color="#000080">^.</font>Next<font color="#000080">;
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>LastCol <font color="#000080">&lt;&gt; (</font><font color="#800000">1</font><font color="#000080">+</font>Neq<font color="#000080">)) </font><font color="#FF0000"><b>then goto </b></font>NoRHS<font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;                </font><font color="#008000"><i>{for row}

    </i></font><font color="#FF0000"><b>if </b></font>Msg <font color="#FF0000"><b>then </b></font>WriteLn<font color="#000080">(</font><font color="#800000">'about to complete setup'</font><font color="#000080">);
    </font>Row <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
    </font><font color="#FF0000"><b>while </b></font><font color="#000080">(</font>Row <font color="#000080">&lt; </font>Neq<font color="#000080">) </font><font color="#FF0000"><b>do begin
      </b></font>NextActiveRow<font color="#000080">^[</font>Row<font color="#000080">] := </font>Row<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">;
      </font>Inc<font color="#000080">(</font>Row<font color="#000080">);
      </font><font color="#FF0000"><b>if </b></font>ColCount<font color="#000080">^[</font>Row<font color="#000080">] = </font><font color="#800000">0 </font><font color="#FF0000"><b>then goto </b></font>EmptyCol<font color="#000080">;
      </font><font color="#FF0000"><b>if </b></font>RowCount<font color="#000080">^[</font>Row<font color="#000080">] = </font><font color="#800000">1 </font><font color="#FF0000"><b>then goto </b></font>NoVars<font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;                </font><font color="#008000"><i>{for Row:=1 to neq}
    </i></font>NextActiveRow<font color="#000080">^[</font>Neq<font color="#000080">] := </font><font color="#800000">0</font><font color="#000080">;
    </font><font color="#008000"><i>{end setup}

    </i></font><font color="#FF0000"><b>repeat              </b></font><font color="#008000"><i>{pivot on variables which are mentioned only once}
      </i></font>PivotCol <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
      </font>PrevRow <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
      </font>Row <font color="#000080">:= </font>NextActiveRow<font color="#000080">^[</font><font color="#800000">0</font><font color="#000080">];
      </font><font color="#FF0000"><b>while </b></font>Row <font color="#000080">&lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>do begin
        </b></font>NextRow <font color="#000080">:= </font>NextActiveRow<font color="#000080">^[</font>Row<font color="#000080">];
        </font><font color="#FF0000"><b>if </b></font>DBug <font color="#FF0000"><b>then </b></font>Assert<font color="#000080">(</font>Row <font color="#000080">&gt; </font><font color="#800000">0</font><font color="#000080">, </font><font color="#800000">'#8033'</font><font color="#000080">);
        </font><font color="#FF0000"><b>if </b></font>DBug <font color="#FF0000"><b>then </b></font>Assert<font color="#000080">(</font>Row <font color="#000080">&lt;= </font>Neq<font color="#000080">, </font><font color="#800000">'#9033'</font><font color="#000080">);
        </font>SingleCount <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
        </font>ElmPtr <font color="#000080">:= </font>FirstElm<font color="#000080">^[</font>Row<font color="#000080">]; </font><font color="#FF0000"><b>if </b></font>DBug <font color="#FF0000"><b>then </b></font>Assert<font color="#000080">(</font>ElmPtr <font color="#000080">&lt;&gt; </font><font color="#FF0000"><b>nil</b></font><font color="#000080">, </font><font color="#800000">'#34'</font><font color="#000080">);
        </font><font color="#FF0000"><b>if </b></font>DBug <font color="#FF0000"><b>then </b></font>Assert<font color="#000080">(</font>ElmPtr<font color="#000080">^.</font>Column <font color="#000080">&lt;= </font>Neq<font color="#000080">, </font><font color="#800000">'#77'</font><font color="#000080">);
        </font>Col <font color="#000080">:= </font>ElmPtr<font color="#000080">^.</font>Column<font color="#000080">;
        </font><font color="#FF0000"><b>while </b></font><font color="#000080">(</font>Col <font color="#000080">&lt;= </font>Neq<font color="#000080">) </font><font color="#FF0000"><b>do begin
          if </b></font><font color="#000080">(</font>ColCount<font color="#000080">^[</font>Col<font color="#000080">] = </font><font color="#800000">1</font><font color="#000080">) </font><font color="#FF0000"><b>then begin
            </b></font>PivotCol <font color="#000080">:= </font>Col<font color="#000080">;
            </font>Inc<font color="#000080">(</font>SingleCount<font color="#000080">);
          </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
          </font>ElmPtr <font color="#000080">:= </font>ElmPtr<font color="#000080">^.</font>Next<font color="#000080">; </font><font color="#FF0000"><b>if </b></font>DBug <font color="#FF0000"><b>then </b></font>Assert<font color="#000080">(</font>ElmPtr <font color="#000080">&lt;&gt; </font><font color="#FF0000"><b>nil</b></font><font color="#000080">, </font><font color="#800000">'#35'</font><font color="#000080">);
          </font>Col <font color="#000080">:= </font>ElmPtr<font color="#000080">^.</font>Column<font color="#000080">;
        </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
        </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>SingleCount <font color="#000080">&gt; </font><font color="#800000">1</font><font color="#000080">) </font><font color="#FF0000"><b>then goto </b></font>TwoSingles
        <font color="#FF0000"><b>else if </b></font><font color="#000080">(</font>SingleCount <font color="#000080">= </font><font color="#800000">1</font><font color="#000080">) </font><font color="#FF0000"><b>then begin
          </b></font>Inc<font color="#000080">(</font>PivotStep<font color="#000080">);
          </font>PivotRow <font color="#000080">:= </font>Row<font color="#000080">;
          </font>ElmPtr <font color="#000080">:= </font>FirstElm<font color="#000080">^[</font>PivotRow<font color="#000080">]; </font><font color="#FF0000"><b>if </b></font>DBug <font color="#FF0000"><b>then </b></font>Assert<font color="#000080">(</font>ElmPtr <font color="#000080">&lt;&gt; </font><font color="#FF0000"><b>nil</b></font><font color="#000080">,
</font><font color="#800000">'#34'</font><font color="#000080">);
          </font><font color="#FF0000"><b>if </b></font>DBug <font color="#FF0000"><b>then </b></font>Assert<font color="#000080">(</font>ElmPtr<font color="#000080">^.</font>Column <font color="#000080">&lt;= </font>Neq<font color="#000080">, </font><font color="#800000">'#77'</font><font color="#000080">);
          </font>Col <font color="#000080">:= </font>ElmPtr<font color="#000080">^.</font>Column<font color="#000080">;
          </font><font color="#FF0000"><b>while </b></font><font color="#000080">(</font>Col <font color="#000080">&lt;= </font>Neq<font color="#000080">) </font><font color="#FF0000"><b>do begin
            if </b></font>DBug <font color="#FF0000"><b>then </b></font>Assert<font color="#000080">(</font>ColCount<font color="#000080">^[</font>Col<font color="#000080">] &gt; </font><font color="#800000">0</font><font color="#000080">, </font><font color="#800000">'#4177'</font><font color="#000080">);
            </font>Dec<font color="#000080">(</font>ColCount<font color="#000080">^[</font>Col<font color="#000080">]);
            </font>ElmPtr <font color="#000080">:= </font>ElmPtr<font color="#000080">^.</font>Next<font color="#000080">; </font><font color="#FF0000"><b>if </b></font>DBug <font color="#FF0000"><b>then </b></font>Assert<font color="#000080">(</font>ElmPtr <font color="#000080">&lt;&gt; </font><font color="#FF0000"><b>nil</b></font><font color="#000080">, </font><font color="#800000">'#35'</font><font color="#000080">);
            </font>Col <font color="#000080">:= </font>ElmPtr<font color="#000080">^.</font>Column<font color="#000080">;
          </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
          </font>PivRow<font color="#000080">^[</font>PivotStep<font color="#000080">] := </font>PivotRow<font color="#000080">;
          </font>NextActiveRow<font color="#000080">^[</font>PrevRow<font color="#000080">] := </font>NextActiveRow<font color="#000080">^[</font>PivotRow<font color="#000080">];
          </font>NextActiveRow<font color="#000080">^[</font>PivotRow<font color="#000080">] := -</font><font color="#800000">1</font><font color="#000080">; </font><font color="#008000"><i>{useful ?}
          </i></font>RowCount<font color="#000080">^[</font>PivotRow<font color="#000080">] := </font>PivotCol<font color="#000080">; </font><font color="#008000"><i>{change of meaning}
          </i></font>ColCount<font color="#000080">^[</font>PivotCol<font color="#000080">] := -</font><font color="#800000">1</font><font color="#000080">; </font><font color="#008000"><i>{mark as done}
        </i></font><font color="#FF0000"><b>end             </b></font><font color="#008000"><i>{if (SingleCount=1) }
        </i></font><font color="#FF0000"><b>else </b></font><font color="#008000"><i>{no Singles} </i></font>PrevRow <font color="#000080">:= </font>Row<font color="#000080">;
        </font>Row <font color="#000080">:= </font>NextRow<font color="#000080">;
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

    </font><font color="#FF0000"><b>until </b></font><font color="#000080">(</font>PivotCol <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">);


    </font><font color="#008000"><i>{*************main loop}
    </i></font><font color="#FF0000"><b>while </b></font>PivotStep <font color="#000080">&lt; </font>Neq <font color="#FF0000"><b>do begin
      </b></font>Inc<font color="#000080">(</font>PivotStep<font color="#000080">);
      </font><font color="#FF0000"><b>if </b></font>Msg <font color="#FF0000"><b>then </b></font>WriteLn<font color="#000080">(</font><font color="#800000">'starting step '</font><font color="#000080">, </font>PivotStep<font color="#000080">);

      </font><font color="#008000"><i>{ Find shortest row (PivotRow) and the preceding active row (LastRow)  }
      </i></font>MinRowCount <font color="#000080">:= </font>MaxInt<font color="#000080">;
      </font>PrevRow <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">; </font>LastRow <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
      </font>Row <font color="#000080">:= </font>NextActiveRow<font color="#000080">^[</font><font color="#800000">0</font><font color="#000080">];
      </font><font color="#FF0000"><b>if </b></font>DBug <font color="#FF0000"><b>then </b></font>Assert<font color="#000080">(</font>Row <font color="#000080">&lt;&gt; </font><font color="#800000">0</font><font color="#000080">, </font><font color="#800000">'#33'</font><font color="#000080">);
      </font><font color="#FF0000"><b>while </b></font>Row <font color="#000080">&lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>do begin
        if </b></font>RowCount<font color="#000080">^[</font>Row<font color="#000080">] &lt; </font>MinRowCount <font color="#FF0000"><b>then begin
          </b></font>MinRowCount <font color="#000080">:= </font>RowCount<font color="#000080">^[</font>Row<font color="#000080">];
          </font>PivotRow <font color="#000080">:= </font>Row<font color="#000080">;

          </font>LastRow <font color="#000080">:= </font>PrevRow<font color="#000080">;
        </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
        </font>PrevRow <font color="#000080">:= </font>Row<font color="#000080">;
        </font>Row <font color="#000080">:= </font>NextActiveRow<font color="#000080">^[</font>Row<font color="#000080">];
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

      </font><font color="#FF0000"><b>if </b></font>Msg <font color="#FF0000"><b>then </b></font>WriteLn<font color="#000080">(</font><font color="#800000">'Pivotrow: '</font><font color="#000080">, </font>PivotRow<font color="#000080">, </font><font color="#800000">' Rowcount '</font><font color="#000080">, </font>MinRowCount<font color="#000080">);

      </font>Biggest <font color="#000080">:= -</font><font color="#800000">1</font><font color="#000080">;
      </font>ElmPtr <font color="#000080">:= </font>FirstElm<font color="#000080">^[</font>PivotRow<font color="#000080">]; </font><font color="#FF0000"><b>if </b></font>DBug <font color="#FF0000"><b>then </b></font>Assert<font color="#000080">(</font>ElmPtr <font color="#000080">&lt;&gt; </font><font color="#FF0000"><b>nil</b></font><font color="#000080">, </font><font color="#800000">'#34'</font><font color="#000080">);
      </font><font color="#FF0000"><b>if </b></font>DBug <font color="#FF0000"><b>then </b></font>Assert<font color="#000080">(</font>ElmPtr<font color="#000080">^.</font>Column <font color="#000080">&lt;= </font>Neq<font color="#000080">, </font><font color="#800000">'#77'</font><font color="#000080">);
      </font><font color="#FF0000"><b>while </b></font><font color="#000080">(</font>ElmPtr<font color="#000080">^.</font>Column <font color="#000080">&lt;= </font>Neq<font color="#000080">) </font><font color="#FF0000"><b>do begin
        if </b></font><font color="#000080">(</font>Abs<font color="#000080">(</font>ElmPtr<font color="#000080">^.</font>Value<font color="#000080">) &gt; </font>Biggest<font color="#000080">) </font><font color="#FF0000"><b>then </b></font>Biggest <font color="#000080">:= </font>Abs<font color="#000080">(</font>ElmPtr<font color="#000080">^.</font>Value<font color="#000080">);
        </font>ElmPtr <font color="#000080">:= </font>ElmPtr<font color="#000080">^.</font>Next<font color="#000080">; </font><font color="#FF0000"><b>if </b></font>DBug <font color="#FF0000"><b>then </b></font>Assert<font color="#000080">(</font>ElmPtr <font color="#000080">&lt;&gt; </font><font color="#FF0000"><b>nil</b></font><font color="#000080">, </font><font color="#800000">'#35'</font><font color="#000080">);
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>if </b></font>DBug <font color="#FF0000"><b>then </b></font>Assert<font color="#000080">(</font>Biggest <font color="#000080">&gt;= </font><font color="#800000">0</font><font color="#000080">, </font><font color="#800000">'#45'</font><font color="#000080">);
      </font><font color="#FF0000"><b>if </b></font>Biggest <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>then goto </b></font>NumericallySingular<font color="#000080">;

      </font><font color="#FF0000"><b>if </b></font>Msg <font color="#FF0000"><b>then </b></font>WriteLn<font color="#000080">(</font><font color="#800000">'Biggest was :'</font><font color="#000080">, </font>Biggest<font color="#000080">);

      </font>Biggest <font color="#000080">:= </font>Biggest<font color="#000080">*</font>Uvalue<font color="#000080">;
      </font>BestPtr <font color="#000080">:= </font><font color="#FF0000"><b>nil</b></font><font color="#000080">;
      </font>Best_Addelm <font color="#000080">:= </font>MaxInt<font color="#000080">;
      </font>ElmPtr <font color="#000080">:= </font>FirstElm<font color="#000080">^[</font>PivotRow<font color="#000080">]; </font><font color="#FF0000"><b>if </b></font>DBug <font color="#FF0000"><b>then </b></font>Assert<font color="#000080">(</font>ElmPtr <font color="#000080">&lt;&gt; </font><font color="#FF0000"><b>nil</b></font><font color="#000080">, </font><font color="#800000">'#36'</font><font color="#000080">);
      </font><font color="#FF0000"><b>while </b></font><font color="#000080">(</font>ElmPtr<font color="#000080">^.</font>Column <font color="#000080">&lt;= </font>Neq<font color="#000080">) </font><font color="#FF0000"><b>do begin
        </b></font>Col <font color="#000080">:= </font>ElmPtr<font color="#000080">^.</font>Column<font color="#000080">;
        </font>Dec<font color="#000080">(</font>ColCount<font color="#000080">^[</font>Col<font color="#000080">]);
        </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>Abs<font color="#000080">(</font>ElmPtr<font color="#000080">^.</font>Value<font color="#000080">) &gt;= </font>Biggest<font color="#000080">) </font><font color="#FF0000"><b>then begin
          </b></font>AddElm <font color="#000080">:= </font>ColCount<font color="#000080">^[</font>Col<font color="#000080">];
          </font><font color="#008000"><i>{addelm is the number of additional nonzeros which would be added}
          {if this Pivot were chosen}
          </i></font><font color="#FF0000"><b>if </b></font>AddElm <font color="#000080">&lt; </font>Best_Addelm <font color="#FF0000"><b>then begin
            </b></font>BestPtr <font color="#000080">:= </font>ElmPtr<font color="#000080">;
            </font>Best_Addelm <font color="#000080">:= </font>AddElm<font color="#000080">;
          </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
        </font><font color="#FF0000"><b>end</b></font><font color="#000080">;            </font><font color="#008000"><i>{if (....&gt;=UValue)}
        </i></font>ElmPtr <font color="#000080">:= </font>ElmPtr<font color="#000080">^.</font>Next<font color="#000080">;
        </font><font color="#FF0000"><b>if </b></font>DBug <font color="#FF0000"><b>then </b></font>Assert<font color="#000080">(</font>ElmPtr <font color="#000080">&lt;&gt; </font><font color="#FF0000"><b>nil</b></font><font color="#000080">, </font><font color="#800000">'#37'</font><font color="#000080">);
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>if </b></font>DBug <font color="#FF0000"><b>then </b></font>Assert<font color="#000080">(</font>BestPtr <font color="#000080">&lt;&gt; </font><font color="#FF0000"><b>nil</b></font><font color="#000080">, </font><font color="#800000">'#38'</font><font color="#000080">);

      </font>PivotCol <font color="#000080">:= </font>BestPtr<font color="#000080">^.</font>Column<font color="#000080">;
      </font>PivotValue <font color="#000080">:= </font>BestPtr<font color="#000080">^.</font>Value<font color="#000080">;
      </font><font color="#008000"><i>{Mark Pivot Row as inactive}
      </i></font>NextActiveRow<font color="#000080">^[</font>LastRow<font color="#000080">] := </font>NextActiveRow<font color="#000080">^[</font>PivotRow<font color="#000080">];

      </font><font color="#008000"><i>{Answer Values for use by backsub}
      </i></font>PivRow<font color="#000080">^[</font>PivotStep<font color="#000080">] := </font>PivotRow<font color="#000080">;
      </font><font color="#008000"><i>{note change of meaning}
      </i></font>NextActiveRow<font color="#000080">^[</font>PivotRow<font color="#000080">] := -</font><font color="#800000">1</font><font color="#000080">; </font><font color="#008000"><i>{useful ?}
      </i></font>RowCount<font color="#000080">^[</font>PivotRow<font color="#000080">] := </font>PivotCol<font color="#000080">; </font><font color="#008000"><i>{change of meaning}
      </i></font>NumToFind <font color="#000080">:= </font>ColCount<font color="#000080">^[</font>PivotCol<font color="#000080">];
      </font>ColCount<font color="#000080">^[</font>PivotCol<font color="#000080">] := -</font><font color="#800000">1</font><font color="#000080">; </font><font color="#008000"><i>{mark as done}


      </i></font><font color="#FF0000"><b>if </b></font>Msg <font color="#FF0000"><b>then </b></font>Write<font color="#000080">(</font><font color="#800000">'Start Pivot, '</font><font color="#000080">);
      </font><font color="#FF0000"><b>if </b></font>Msg <font color="#FF0000"><b>then </b></font>Write<font color="#000080">(</font><font color="#800000">' Pivotrow: '</font><font color="#000080">, </font>PivotRow<font color="#000080">, </font><font color="#800000">' Rowcount '</font><font color="#000080">, </font>MinRowCount<font color="#000080">);
      </font><font color="#FF0000"><b>if </b></font>Msg <font color="#FF0000"><b>then </b></font>WriteLn<font color="#000080">(</font><font color="#800000">' PivotCol: '</font><font color="#000080">, </font>PivotCol<font color="#000080">, </font><font color="#800000">' ColCount '</font><font color="#000080">, </font>NumToFind<font color="#000080">);

      </font>Row <font color="#000080">:= </font>NextActiveRow<font color="#000080">^[</font><font color="#800000">0</font><font color="#000080">];
      </font><font color="#FF0000"><b>while </b></font><font color="#000080">((</font>Row <font color="#000080">&lt;&gt; </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>NumToFind <font color="#000080">&gt; </font><font color="#800000">0</font><font color="#000080">)) </font><font color="#FF0000"><b>do begin
        if </b></font><font color="#000080">(</font>FreeCount <font color="#000080">&lt; </font>Neq<font color="#000080">) </font><font color="#FF0000"><b>then if not </b></font>FrePrime <font color="#FF0000"><b>then goto </b></font>OutOfSpace<font color="#000080">;

        </font><font color="#008000"><i>{preload PrevPtr so that: PrevPtr^.Next :=  FirstElm^[Row]}
        </i></font>PrevPtr <font color="#000080">:= </font>Addr<font color="#000080">(</font>FirstElm<font color="#000080">^[</font>Row<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">]);
        </font>ElmPtr <font color="#000080">:= </font>FirstElm<font color="#000080">^[</font>Row<font color="#000080">];

        </font><font color="#008000"><i>{the goto's in this section are intended to ease transition to assembly
language}

</i></font>Go_on<font color="#000080">:  </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>ElmPtr<font color="#000080">^.</font>Column <font color="#000080">&gt;= </font>PivotCol<font color="#000080">) </font><font color="#FF0000"><b>then goto </b></font>AsBigAs<font color="#000080">;
        </font>PrevPtr <font color="#000080">:= </font>ElmPtr<font color="#000080">;
        </font>ElmPtr <font color="#000080">:= </font>ElmPtr<font color="#000080">^.</font>Next<font color="#000080">; </font><font color="#008000"><i>{not got to it yet}
        </i></font><font color="#FF0000"><b>if </b></font>DBug <font color="#FF0000"><b>then </b></font>Assert<font color="#000080">(</font>ElmPtr <font color="#000080">&lt;&gt; </font><font color="#FF0000"><b>nil</b></font><font color="#000080">, </font><font color="#800000">'#55'</font><font color="#000080">);
        </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>ElmPtr<font color="#000080">^.</font>Column <font color="#000080">&gt;= </font>PivotCol<font color="#000080">) </font><font color="#FF0000"><b>then goto </b></font>AsBigAs<font color="#000080">;
        </font>PrevPtr <font color="#000080">:= </font>ElmPtr<font color="#000080">;
        </font>ElmPtr <font color="#000080">:= </font>ElmPtr<font color="#000080">^.</font>Next<font color="#000080">; </font><font color="#008000"><i>{not got to it yet}
        </i></font><font color="#FF0000"><b>if </b></font>DBug <font color="#FF0000"><b>then </b></font>Assert<font color="#000080">(</font>ElmPtr <font color="#000080">&lt;&gt; </font><font color="#FF0000"><b>nil</b></font><font color="#000080">, </font><font color="#800000">'#55'</font><font color="#000080">);

        </font><font color="#FF0000"><b>goto </b></font>Go_on<font color="#000080">;
</font>AsBigAs<font color="#000080">: </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>ElmPtr<font color="#000080">^.</font>Column <font color="#000080">&lt;&gt; </font>PivotCol<font color="#000080">) </font><font color="#FF0000"><b>then goto </b></font>NextOne<font color="#000080">;

        </font><font color="#008000"><i>{current row contains pivot col}
        </i></font><font color="#FF0000"><b>if </b></font>Msg <font color="#FF0000"><b>then </b></font>WriteLn<font color="#000080">(</font><font color="#800000">'Altering Row '</font><font color="#000080">, </font>Row<font color="#000080">);
        </font>Factor <font color="#000080">:= </font>ElmPtr<font color="#000080">^.</font>Value<font color="#000080">/</font>PivotValue<font color="#000080">;
        </font>Dec<font color="#000080">(</font>NumToFind<font color="#000080">);


        </font><font color="#008000"><i>{ DELETE pivot col in current row}
        </i></font>Dec<font color="#000080">(</font>RowCount<font color="#000080">^[</font>Row<font color="#000080">]);
        </font>PrevPtr<font color="#000080">^.</font>Next <font color="#000080">:= </font>ElmPtr<font color="#000080">^.</font>Next<font color="#000080">;
        </font>ElmPtr<font color="#000080">^.</font>Next <font color="#000080">:= </font>FreePtr<font color="#000080">; </font>FreePtr <font color="#000080">:= </font>ElmPtr<font color="#000080">; </font>Inc<font color="#000080">(</font>FreeCount<font color="#000080">);

        </font>Next_Pivot <font color="#000080">:= </font>FirstElm<font color="#000080">^[</font>PivotRow<font color="#000080">];
        </font><font color="#FF0000"><b>if </b></font>DBug <font color="#FF0000"><b>then </b></font>Assert<font color="#000080">(</font>Next_Pivot <font color="#000080">&lt;&gt; </font><font color="#FF0000"><b>nil</b></font><font color="#000080">, </font><font color="#800000">'#333'</font><font color="#000080">);
        </font>PrevPtr <font color="#000080">:= </font>Addr<font color="#000080">(</font>FirstElm<font color="#000080">^[</font>Row<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">]); </font><font color="#008000"><i>{PrevPtr^.Next :=  FirstElm^[Row]}
        </i></font>Next_Tar <font color="#000080">:= </font>FirstElm<font color="#000080">^[</font>Row<font color="#000080">];
        </font><font color="#FF0000"><b>if </b></font>DBug <font color="#FF0000"><b>then </b></font>Assert<font color="#000080">(</font>Next_Tar <font color="#000080">&lt;&gt; </font><font color="#FF0000"><b>nil</b></font><font color="#000080">, </font><font color="#800000">'#334'</font><font color="#000080">);
        </font>NextTarCol <font color="#000080">:= </font>Next_Tar<font color="#000080">^.</font>Column<font color="#000080">;
        </font><font color="#FF0000"><b>while </b></font>Next_Pivot <font color="#000080">&lt;&gt; </font><font color="#FF0000"><b>nil do begin
          </b></font>NextPivotCol <font color="#000080">:= </font>Next_Pivot<font color="#000080">^.</font>Column<font color="#000080">;
          </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>NextPivotCol <font color="#000080">= </font>PivotCol<font color="#000080">) </font><font color="#FF0000"><b>then goto </b></font>OutCase<font color="#000080">;

          </font><font color="#FF0000"><b>while </b></font>NextTarCol <font color="#000080">&lt; </font>NextPivotCol <font color="#FF0000"><b>do begin
            </b></font>PrevPtr <font color="#000080">:= </font>Next_Tar<font color="#000080">;
            </font>Next_Tar <font color="#000080">:= </font>Next_Tar<font color="#000080">^.</font>Next<font color="#000080">; </font><font color="#FF0000"><b>if </b></font>DBug <font color="#FF0000"><b>then </b></font>Assert<font color="#000080">(</font>Next_Tar <font color="#000080">&lt;&gt; </font><font color="#FF0000"><b>nil</b></font><font color="#000080">,
</font><font color="#800000">'#99'</font><font color="#000080">);
            </font>NextTarCol <font color="#000080">:= </font>Next_Tar<font color="#000080">^.</font>Column
          <font color="#FF0000"><b>end</b></font><font color="#000080">;
          </font><font color="#FF0000"><b>if </b></font>NextTarCol <font color="#000080">= </font>NextPivotCol <font color="#FF0000"><b>then goto </b></font>AdjustElm<font color="#000080">;

</font>InsertElm<font color="#000080">: </font><font color="#008000"><i>{NextTarCol &gt; NextPivotCol}
          {element in pivot row but not in current row: add in new element}
          </i></font><font color="#FF0000"><b>if </b></font>DBug <font color="#FF0000"><b>then </b></font>Assert<font color="#000080">(</font>NextTarCol <font color="#000080">&gt; </font>NextPivotCol<font color="#000080">, </font><font color="#800000">'#69'</font><font color="#000080">);
          </font><font color="#FF0000"><b>if </b></font>DBug <font color="#FF0000"><b>then </b></font>Assert<font color="#000080">(</font>FreePtr <font color="#000080">&lt;&gt; </font><font color="#FF0000"><b>nil</b></font><font color="#000080">, </font><font color="#800000">'#89'</font><font color="#000080">);
          </font>NewPtr <font color="#000080">:= </font>FreePtr<font color="#000080">;
          </font>NewPtr<font color="#000080">^.</font>Value <font color="#000080">:= -</font>Factor<font color="#000080">*</font>Next_Pivot<font color="#000080">^.</font>Value<font color="#000080">; </font><font color="#008000"><i>{up for copro}
          </i></font>FreePtr <font color="#000080">:= </font>FreePtr<font color="#000080">^.</font>Next<font color="#000080">; </font>Dec<font color="#000080">(</font>FreeCount<font color="#000080">);
          </font>PrevPtr<font color="#000080">^.</font>Next <font color="#000080">:= </font>NewPtr<font color="#000080">;
          </font>PrevPtr <font color="#000080">:= </font>NewPtr<font color="#000080">;
          </font>NewPtr<font color="#000080">^.</font>Column <font color="#000080">:= </font>NextPivotCol<font color="#000080">;
          </font><font color="#FF0000"><b>if </b></font>DBug <font color="#FF0000"><b>then </b></font>NewPtr<font color="#000080">^.</font>CheckRow <font color="#000080">:= </font>Row<font color="#000080">;
          </font>NewPtr<font color="#000080">^.</font>Next <font color="#000080">:= </font>Next_Tar<font color="#000080">;
          </font>Inc<font color="#000080">(</font>ColCount<font color="#000080">^[</font>NextPivotCol<font color="#000080">]);
          </font>Inc<font color="#000080">(</font>RowCount<font color="#000080">^[</font>Row<font color="#000080">]);
          </font><font color="#FF0000"><b>goto </b></font>OutCase<font color="#000080">;

</font>AdjustElm<font color="#000080">: </font><font color="#FF0000"><b>if </b></font>DBug <font color="#FF0000"><b>then </b></font>Assert<font color="#000080">(</font>NextTarCol <font color="#000080">= </font>NextPivotCol<font color="#000080">, </font><font color="#800000">'#67'</font><font color="#000080">);
          </font>Next_Tar<font color="#000080">^.</font>Value <font color="#000080">:= </font>Next_Tar<font color="#000080">^.</font>Value<font color="#000080">-</font>Factor<font color="#000080">*</font>Next_Pivot<font color="#000080">^.</font>Value<font color="#000080">;
          </font>PrevPtr <font color="#000080">:= </font>Next_Tar<font color="#000080">;
          </font>Next_Tar <font color="#000080">:= </font>Next_Tar<font color="#000080">^.</font>Next<font color="#000080">;
          </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>Next_Tar <font color="#000080">&lt;&gt; </font><font color="#FF0000"><b>nil</b></font><font color="#000080">) </font><font color="#FF0000"><b>then
            </b></font>NextTarCol <font color="#000080">:= </font>Next_Tar<font color="#000080">^.</font>Column
          <font color="#FF0000"><b>else </b></font>NextTarCol <font color="#000080">:= </font><font color="#800000">2</font><font color="#000080">+</font>Neq<font color="#000080">; </font><font color="#008000"><i>{sentinel value}

</i></font>OutCase<font color="#000080">:
          </font>Next_Pivot <font color="#000080">:= </font>Next_Pivot<font color="#000080">^.</font>Next<font color="#000080">; </font><font color="#008000"><i>{move along pivot row}
        </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;            </font><font color="#008000"><i>{while Next_Pivot &lt;&gt;  Nil}

</i></font>NextOne<font color="#000080">:
        </font>Row <font color="#000080">:= </font>NextActiveRow<font color="#000080">^[</font>Row<font color="#000080">];
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;              </font><font color="#008000"><i>{while row}
      </i></font><font color="#FF0000"><b>if </b></font>DBug <font color="#FF0000"><b>then </b></font>Assert<font color="#000080">(</font>NumToFind <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">, </font><font color="#800000">'#66'</font><font color="#000080">);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;                </font><font color="#008000"><i>{main loop}

    {release un-needed vectors}
    </i></font>FreeMemParaAlign<font color="#000080">(</font>Pointer<font color="#000080">(</font>OrigColCount<font color="#000080">), (</font><font color="#800000">1</font><font color="#000080">+</font>Neq<font color="#000080">)*</font>SizeOf<font color="#000080">(</font>Integer<font color="#000080">));
    </font>FreeMemParaAlign<font color="#000080">(</font>Pointer<font color="#000080">(</font>OrigNextActiveRow<font color="#000080">), (</font><font color="#800000">1</font><font color="#000080">+</font>Neq<font color="#000080">)*</font>SizeOf<font color="#000080">(</font>Integer<font color="#000080">));


    </font><font color="#008000"><i>{create Answer vector}
    </i></font><font color="#FF0000"><b>if not </b></font>GetMemParaAlign<font color="#000080">(</font>Pointer<font color="#000080">(</font>Answer<font color="#000080">), </font>Pointer<font color="#000080">(</font>OrigAnswer<font color="#000080">),
(</font><font color="#800000">1</font><font color="#000080">+</font>Neq<font color="#000080">)*</font>SizeOf<font color="#000080">(</font>Double<font color="#000080">))
    </font><font color="#FF0000"><b>then goto </b></font>OutOfSpace<font color="#000080">;
    </font><font color="#FF0000"><b>if </b></font>DBug <font color="#FF0000"><b>then for </b></font>Row <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>Neq <font color="#FF0000"><b>do </b></font>Answer<font color="#000080">^[</font>Row<font color="#000080">] := -</font><font color="#800000">99</font><font color="#000080">;


    </font>PivotStep <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">+</font>Neq<font color="#000080">;
    </font><font color="#FF0000"><b>while </b></font><font color="#000080">(</font>PivotStep <font color="#000080">&gt; </font><font color="#800000">1</font><font color="#000080">) </font><font color="#FF0000"><b>do begin
      </b></font>Dec<font color="#000080">(</font>PivotStep<font color="#000080">);
      </font>Row <font color="#000080">:= </font>PivRow<font color="#000080">^[</font>PivotStep<font color="#000080">];
      </font>PivotCol <font color="#000080">:= </font>RowCount<font color="#000080">^[</font>Row<font color="#000080">]; </font><font color="#008000"><i>{note change of meaning}
      </i></font>SumTerm <font color="#000080">:= </font><font color="#800000">0.0</font><font color="#000080">;
      </font>Coeff <font color="#000080">:= </font><font color="#800000">0.0</font><font color="#000080">;
      </font>ElmPtr <font color="#000080">:= </font>FirstElm<font color="#000080">^[</font>Row<font color="#000080">];
      </font><font color="#FF0000"><b>if </b></font>DBug <font color="#FF0000"><b>then </b></font>Assert<font color="#000080">(</font>ElmPtr <font color="#000080">&lt;&gt; </font><font color="#FF0000"><b>nil</b></font><font color="#000080">, </font><font color="#800000">'#188'</font><font color="#000080">);
      </font><font color="#FF0000"><b>while </b></font>ElmPtr <font color="#000080">&lt;&gt; </font><font color="#FF0000"><b>nil do begin
        </b></font>Col <font color="#000080">:= </font>ElmPtr<font color="#000080">^.</font>Column<font color="#000080">;
        </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>Col <font color="#000080">= </font>PivotCol<font color="#000080">) </font><font color="#FF0000"><b>then
          </b></font>Coeff <font color="#000080">:= </font>ElmPtr<font color="#000080">^.</font>Value
        <font color="#FF0000"><b>else if </b></font><font color="#000080">(</font>Col <font color="#000080">&lt;= </font>Neq<font color="#000080">) </font><font color="#FF0000"><b>then begin
          if </b></font>DBug <font color="#FF0000"><b>then </b></font>Assert<font color="#000080">(</font>Answer<font color="#000080">^[</font>Col<font color="#000080">] &lt;&gt; -</font><font color="#800000">99</font><font color="#000080">, </font><font color="#800000">'#177'</font><font color="#000080">);
          </font>SumTerm <font color="#000080">:= </font>SumTerm<font color="#000080">+</font>Answer<font color="#000080">^[</font>Col<font color="#000080">]*</font>ElmPtr<font color="#000080">^.</font>Value<font color="#000080">;
        </font><font color="#FF0000"><b>end
        else
          </b></font>RHS <font color="#000080">:= </font>ElmPtr<font color="#000080">^.</font>Value<font color="#000080">;

        </font>ElmPtr <font color="#000080">:= </font>ElmPtr<font color="#000080">^.</font>Next<font color="#000080">;
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;              </font><font color="#008000"><i>{until (elmptr=Nil)}
      </i></font><font color="#FF0000"><b>if </b></font>DBug <font color="#FF0000"><b>then </b></font>Assert<font color="#000080">(</font>Answer<font color="#000080">^[</font>PivotCol<font color="#000080">] = -</font><font color="#800000">99</font><font color="#000080">, </font><font color="#800000">'#77'</font><font color="#000080">);
      </font>Answer<font color="#000080">^[</font>PivotCol<font color="#000080">] := (</font>RHS<font color="#000080">-</font>SumTerm<font color="#000080">)/</font>Coeff<font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;                </font><font color="#008000"><i>{for PivotRow:=neq downto 1}


    </i></font>FreeMemParaAlign<font color="#000080">(</font>Pointer<font color="#000080">(</font>OrigRowCount<font color="#000080">), (</font><font color="#800000">1</font><font color="#000080">+</font>Neq<font color="#000080">)*</font>SizeOf<font color="#000080">(</font>Word<font color="#000080">));
    </font>FreeMemParaAlign<font color="#000080">(</font>Pointer<font color="#000080">(</font>OrigPivRow<font color="#000080">), (</font><font color="#800000">1</font><font color="#000080">+</font>Neq<font color="#000080">)*</font>SizeOf<font color="#000080">(</font>Word<font color="#000080">));


    </font>Solve1 <font color="#000080">:= </font>True<font color="#000080">; </font>Exit<font color="#000080">; </font><font color="#008000"><i>{normal}


</i></font>EmptyRow<font color="#000080">: </font>SetErrorMsg<font color="#000080">(</font><font color="#800000">'Empty Row'</font><font color="#000080">, </font><font color="#800000">1</font><font color="#000080">, </font>Row<font color="#000080">, </font><font color="#800000">0</font><font color="#000080">); </font>Exit<font color="#000080">;
</font>NoVars<font color="#000080">: </font>SetErrorMsg<font color="#000080">(</font><font color="#800000">'Row without Variables'</font><font color="#000080">, </font><font color="#800000">2</font><font color="#000080">, </font>Row<font color="#000080">, </font><font color="#800000">0</font><font color="#000080">); </font>Exit<font color="#000080">;
</font>EmptyCol<font color="#000080">: </font>SetErrorMsg<font color="#000080">(</font><font color="#800000">'Empty Col'</font><font color="#000080">, </font><font color="#800000">3</font><font color="#000080">, </font>Col<font color="#000080">, </font><font color="#800000">0</font><font color="#000080">); </font>Exit<font color="#000080">;
</font>TwoSingles<font color="#000080">: </font>SetErrorMsg<font color="#000080">(</font><font color="#800000">'Two Singles'</font><font color="#000080">, </font><font color="#800000">4</font><font color="#000080">, </font>Row<font color="#000080">, </font>PivotCol<font color="#000080">); </font>Exit<font color="#000080">;
</font>NoRHS<font color="#000080">: </font>SetErrorMsg<font color="#000080">(</font><font color="#800000">'No RHS'</font><font color="#000080">, </font><font color="#800000">5</font><font color="#000080">, </font>Row<font color="#000080">, </font>LastCol<font color="#000080">); </font>Exit<font color="#000080">;
</font>NumericallySingular<font color="#000080">: </font>SetErrorMsg<font color="#000080">(</font><font color="#800000">'Numerically Singular'</font><font color="#000080">, </font><font color="#800000">6</font><font color="#000080">, </font>PivotRow<font color="#000080">,
</font>PivotStep<font color="#000080">); </font>Exit<font color="#000080">;
</font>OutOfSpace<font color="#000080">: </font>SetErrorMsg<font color="#000080">(</font><font color="#800000">'Out of Space'</font><font color="#000080">, </font><font color="#800000">7</font><font color="#000080">, </font>PivotStep<font color="#000080">, </font><font color="#800000">4</font><font color="#000080">); </font>Exit<font color="#000080">;
</font>ColsOutofOrder<font color="#000080">: </font>SetErrorMsg<font color="#000080">(</font><font color="#800000">'Cols out of Order'</font><font color="#000080">, </font><font color="#800000">8</font><font color="#000080">, </font>Row<font color="#000080">, </font>Col<font color="#000080">); </font>Exit<font color="#000080">;

  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;                  </font><font color="#008000"><i>{Solve1}

</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">.
</font><font color="#008000"><i>{************************************************************************}
{$N+,E+}
</i></font><font color="#FF0000"><b>uses </b></font>SolSpar<font color="#000080">;
</font><font color="#FF0000"><b>var
  </b></font>Reason         <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
  </font>ErrNo1<font color="#000080">, </font>ErrNo2<font color="#000080">, </font>ErrNo3 <font color="#000080">: </font>Word<font color="#000080">;
  </font>Col<font color="#000080">, </font>Row<font color="#000080">, </font>N    <font color="#000080">: </font>Integer<font color="#000080">;
  </font>Total<font color="#000080">, </font>Value   <font color="#000080">: </font>Double<font color="#000080">;
</font><font color="#FF0000"><b>label </b></font>Fail<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>WriteLn<font color="#000080">(</font><font color="#800000">'Initial Heap Size '</font><font color="#000080">, </font>MemAvail<font color="#000080">);
  </font>N <font color="#000080">:= </font><font color="#800000">1500</font><font color="#000080">;            </font><font color="#008000"><i>{size of matrix}
  </i></font><font color="#FF0000"><b>if not </b></font>InitStruc<font color="#000080">(</font>N<font color="#000080">) </font><font color="#FF0000"><b>then goto </b></font>Fail<font color="#000080">;

</font><font color="#008000"><i>{constructs a 'band' matrix with column border and solves it}

{for testing purposes, the RHS is set up so that variable(n)
has value n. The 'Total' variable is part of this. In normal use
the RHS would be set to some other value}

  </i></font><font color="#FF0000"><b>for </b></font>Row <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>N <font color="#FF0000"><b>do begin
    </b></font>Total <font color="#000080">:= </font><font color="#800000">0.0</font><font color="#000080">;

    </font>Value <font color="#000080">:= </font><font color="#800000">0.1</font><font color="#000080">+</font>Random<font color="#000080">;
    </font>Col <font color="#000080">:= </font>Row<font color="#000080">;
    </font><font color="#FF0000"><b>if not </b></font>AddElement<font color="#000080">(</font>Row<font color="#000080">, </font>Col<font color="#000080">, </font>Value<font color="#000080">) </font><font color="#FF0000"><b>then goto </b></font>Fail<font color="#000080">;
    </font>Total <font color="#000080">:= </font>Total<font color="#000080">+</font>Col<font color="#000080">*</font>Value<font color="#000080">;

    </font>Col <font color="#000080">:= </font>Row<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">;
    </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>Col <font color="#000080">&gt; </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>then begin
      </b></font>Value <font color="#000080">:= </font><font color="#800000">0.1</font><font color="#000080">+</font>Random<font color="#000080">;
      </font><font color="#FF0000"><b>if not </b></font>AddElement<font color="#000080">(</font>Row<font color="#000080">, </font>Col<font color="#000080">, </font>Value<font color="#000080">) </font><font color="#FF0000"><b>then goto </b></font>Fail<font color="#000080">;
      </font>Total <font color="#000080">:= </font>Total<font color="#000080">+</font>Col<font color="#000080">*</font>Value<font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

    </font>Col <font color="#000080">:= </font>Row<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">;
    </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>Col <font color="#000080">&lt;= </font>N<font color="#000080">) </font><font color="#FF0000"><b>then begin
      </b></font>Value <font color="#000080">:= </font><font color="#800000">0.1</font><font color="#000080">+</font>Random<font color="#000080">;
      </font><font color="#FF0000"><b>if not </b></font>AddElement<font color="#000080">(</font>Row<font color="#000080">, </font>Col<font color="#000080">, </font>Value<font color="#000080">) </font><font color="#FF0000"><b>then goto </b></font>Fail<font color="#000080">;
      </font>Total <font color="#000080">:= </font>Total<font color="#000080">+</font>Col<font color="#000080">*</font>Value<font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;


    </font>Col <font color="#000080">:= </font>N<font color="#000080">;
    </font>Value <font color="#000080">:= </font><font color="#800000">0.1</font><font color="#000080">+</font>Random<font color="#000080">;
    </font><font color="#FF0000"><b>if not </b></font>AddElement<font color="#000080">(</font>Row<font color="#000080">, </font>Col<font color="#000080">, </font>Value<font color="#000080">) </font><font color="#FF0000"><b>then goto </b></font>Fail<font color="#000080">;
    </font>Total <font color="#000080">:= </font>Total<font color="#000080">+</font>Col<font color="#000080">*</font>Value<font color="#000080">;

    </font><font color="#FF0000"><b>if not </b></font>SetRHS<font color="#000080">(</font>Row<font color="#000080">, </font>Total<font color="#000080">) </font><font color="#FF0000"><b>then goto </b></font>Fail<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;                  </font><font color="#008000"><i>{for Row:= 1 TO N}
  </i></font>WriteLn<font color="#000080">(</font><font color="#800000">' Memory Used To Store Matrix '</font><font color="#000080">, </font>SparMemUsed<font color="#000080">);

  </font><font color="#FF0000"><b>if not </b></font>Solve1 <font color="#FF0000"><b>then goto </b></font>Fail<font color="#000080">;
  </font><font color="#FF0000"><b>for </b></font>Row <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>N <font color="#FF0000"><b>do if </b></font><font color="#000080">((</font>Row <font color="#FF0000"><b>mod </b></font><font color="#800000">100</font><font color="#000080">) = </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>then begin
    if not </b></font>GetAnswer<font color="#000080">(</font>Row<font color="#000080">, </font>Value<font color="#000080">) </font><font color="#FF0000"><b>then goto </b></font>Fail<font color="#000080">;
    </font>WriteLn<font color="#000080">(</font>Row<font color="#000080">:</font><font color="#800000">3</font><font color="#000080">, </font>Value<font color="#000080">:</font><font color="#800000">15</font><font color="#000080">:</font><font color="#800000">5</font><font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>WriteLn<font color="#000080">(</font><font color="#800000">' Max Memory Used To Solve Matrix '</font><font color="#000080">, </font>SparMemUsed<font color="#000080">);
  </font>ReleaseStruc<font color="#000080">;
  </font>WriteLn<font color="#000080">(</font><font color="#800000">' Memory Used after ReleaseStruc '</font><font color="#000080">, </font>SparMemUsed<font color="#000080">);
  </font>WriteLn<font color="#000080">(</font><font color="#800000">'  Final Heap Size '</font><font color="#000080">, </font>MemAvail<font color="#000080">);

  </font>Halt<font color="#000080">;

</font>Fail<font color="#000080">:
  </font>GetErrorMsg<font color="#000080">(</font>Reason<font color="#000080">, </font>ErrNo1<font color="#000080">, </font>ErrNo2<font color="#000080">, </font>ErrNo3<font color="#000080">);
  </font>WriteLn<font color="#000080">(</font><font color="#800000">'Failed:  Error '</font><font color="#000080">, </font>ErrNo1<font color="#000080">:</font><font color="#800000">0</font><font color="#000080">, </font><font color="#800000">' '</font><font color="#000080">, </font>Reason<font color="#000080">, </font><font color="#800000">' '</font><font color="#000080">, </font><font color="#800000">' '</font><font color="#000080">, </font>ErrNo2<font color="#000080">:</font><font color="#800000">3</font><font color="#000080">, </font><font color="#800000">' '</font><font color="#000080">,
</font>ErrNo3<font color="#000080">:</font><font color="#800000">3</font><font color="#000080">);
  </font>ReleaseStruc<font color="#000080">;
  </font>WriteLn<font color="#000080">(</font><font color="#800000">' Memory Used after ReleaseStruc '</font><font color="#000080">, </font>SparMemUsed<font color="#000080">);
  </font>WriteLn<font color="#000080">(</font><font color="#800000">'  Final Heap Size '</font><font color="#000080">, </font>MemAvail<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">.
</font><font color="#008000"><i>{************************************************************************}
{$N+,E+}
</i></font><font color="#FF0000"><b>uses </b></font>SolSpar<font color="#000080">;
</font><font color="#FF0000"><b>var
  </b></font>Reason         <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
  </font>ErrNo1<font color="#000080">, </font>ErrNo2<font color="#000080">, </font>ErrNo3 <font color="#000080">: </font>Word<font color="#000080">;
  </font>Example<font color="#000080">, </font>Col<font color="#000080">, </font>Row<font color="#000080">, </font>N <font color="#000080">: </font>Integer<font color="#000080">;
  </font>Total<font color="#000080">, </font>Value   <font color="#000080">: </font>Double<font color="#000080">;
</font><font color="#FF0000"><b>label </b></font>Fail<font color="#000080">, </font>EndProg<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>N <font color="#000080">:= </font><font color="#800000">4</font><font color="#000080">;               </font><font color="#008000"><i>{size of matrix}

{Shows how error messages work. Compile and run
   test2 &gt;tem
 off DOS command line.  Then compare file 'tem' with code below}

{for testing purposes, the RHS is set up so that variable(n)
has value n. The 'Total' variable is part of this. In normal use
the RHS would be set to some other value}

  </i></font><font color="#FF0000"><b>for </b></font>Example <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font><font color="#800000">8 </font><font color="#FF0000"><b>do begin
    </b></font>WriteLn<font color="#000080">(</font><font color="#800000">'Example '</font><font color="#000080">, </font>Example<font color="#000080">);
    </font><font color="#FF0000"><b>if not </b></font>InitStruc<font color="#000080">(</font>N<font color="#000080">) </font><font color="#FF0000"><b>then goto </b></font>Fail<font color="#000080">;

    </font><font color="#FF0000"><b>if not </b></font>AddElement<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">, </font><font color="#800000">1</font><font color="#000080">, </font><font color="#800000">0.50</font><font color="#000080">) </font><font color="#FF0000"><b>then goto </b></font>Fail<font color="#000080">;
    </font><font color="#FF0000"><b>if not </b></font>AddElement<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">, </font><font color="#800000">3</font><font color="#000080">, </font><font color="#800000">2.00</font><font color="#000080">) </font><font color="#FF0000"><b>then goto </b></font>Fail<font color="#000080">;
    </font><font color="#FF0000"><b>if not </b></font>SetRHS<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">, </font><font color="#800000">6.50</font><font color="#000080">) </font><font color="#FF0000"><b>then goto </b></font>Fail<font color="#000080">;

    </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>Example <font color="#000080">&lt;&gt; </font><font color="#800000">7</font><font color="#000080">) </font><font color="#FF0000"><b>then
      if not </b></font>AddElement<font color="#000080">(</font><font color="#800000">2</font><font color="#000080">, </font><font color="#800000">2</font><font color="#000080">, </font><font color="#800000">0.20</font><font color="#000080">) </font><font color="#FF0000"><b>then goto </b></font>Fail<font color="#000080">;
    </font><font color="#FF0000"><b>if not </b></font>AddElement<font color="#000080">(</font><font color="#800000">2</font><font color="#000080">, </font><font color="#800000">4</font><font color="#000080">, </font><font color="#800000">5.00</font><font color="#000080">) </font><font color="#FF0000"><b>then goto </b></font>Fail<font color="#000080">;
    </font><font color="#FF0000"><b>if not </b></font>SetRHS<font color="#000080">(</font><font color="#800000">2</font><font color="#000080">, </font><font color="#800000">20.40</font><font color="#000080">) </font><font color="#FF0000"><b>then goto </b></font>Fail<font color="#000080">;

    </font><font color="#FF0000"><b>if not </b></font>AddElement<font color="#000080">(</font><font color="#800000">3</font><font color="#000080">, </font><font color="#800000">3</font><font color="#000080">, </font><font color="#800000">1.00</font><font color="#000080">) </font><font color="#FF0000"><b>then goto </b></font>Fail<font color="#000080">;
    </font><font color="#FF0000"><b>if not </b></font>AddElement<font color="#000080">(</font><font color="#800000">3</font><font color="#000080">, </font><font color="#800000">1</font><font color="#000080">, </font><font color="#800000">0.75</font><font color="#000080">) </font><font color="#FF0000"><b>then goto </b></font>Fail<font color="#000080">;
    </font><font color="#FF0000"><b>if not </b></font>SetRHS<font color="#000080">(</font><font color="#800000">3</font><font color="#000080">, </font><font color="#800000">3.75</font><font color="#000080">) </font><font color="#FF0000"><b>then goto </b></font>Fail<font color="#000080">;

    </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>Example <font color="#000080">= </font><font color="#800000">1</font><font color="#000080">) </font><font color="#FF0000"><b>or </b></font><font color="#000080">(</font>Example <font color="#000080">= </font><font color="#800000">7</font><font color="#000080">) </font><font color="#FF0000"><b>then begin
      if not </b></font>AddElement<font color="#000080">(</font><font color="#800000">4</font><font color="#000080">, </font><font color="#800000">4</font><font color="#000080">, </font><font color="#800000">6.00</font><font color="#000080">) </font><font color="#FF0000"><b>then goto </b></font>Fail<font color="#000080">;
      </font><font color="#FF0000"><b>if not </b></font>AddElement<font color="#000080">(</font><font color="#800000">4</font><font color="#000080">, </font><font color="#800000">1</font><font color="#000080">, </font><font color="#800000">2.00</font><font color="#000080">) </font><font color="#FF0000"><b>then goto </b></font>Fail<font color="#000080">;
      </font><font color="#FF0000"><b>if not </b></font>SetRHS<font color="#000080">(</font><font color="#800000">4</font><font color="#000080">, </font><font color="#800000">26.00</font><font color="#000080">) </font><font color="#FF0000"><b>then goto </b></font>Fail<font color="#000080">;
    </font><font color="#FF0000"><b>end
    else if </b></font><font color="#000080">(</font>Example <font color="#000080">= </font><font color="#800000">2</font><font color="#000080">) </font><font color="#FF0000"><b>then begin </b></font><font color="#008000"><i>{4th row is multiple of second}
      </i></font><font color="#FF0000"><b>if not </b></font>AddElement<font color="#000080">(</font><font color="#800000">4</font><font color="#000080">, </font><font color="#800000">2</font><font color="#000080">, </font><font color="#800000">0.40</font><font color="#000080">) </font><font color="#FF0000"><b>then goto </b></font>Fail<font color="#000080">;
      </font><font color="#FF0000"><b>if not </b></font>AddElement<font color="#000080">(</font><font color="#800000">4</font><font color="#000080">, </font><font color="#800000">4</font><font color="#000080">, </font><font color="#800000">10.0</font><font color="#000080">) </font><font color="#FF0000"><b>then goto </b></font>Fail<font color="#000080">;
      </font><font color="#FF0000"><b>if not </b></font>SetRHS<font color="#000080">(</font><font color="#800000">4</font><font color="#000080">, </font><font color="#800000">26.00</font><font color="#000080">) </font><font color="#FF0000"><b>then goto </b></font>Fail<font color="#000080">;
    </font><font color="#FF0000"><b>end
    else if </b></font><font color="#000080">(</font>Example <font color="#000080">= </font><font color="#800000">3</font><font color="#000080">) </font><font color="#FF0000"><b>then begin </b></font><font color="#008000"><i>{variables 2 and 4 each appear only in row
2}
      </i></font><font color="#FF0000"><b>if not </b></font>AddElement<font color="#000080">(</font><font color="#800000">4</font><font color="#000080">, </font><font color="#800000">3</font><font color="#000080">, </font><font color="#800000">1.00</font><font color="#000080">) </font><font color="#FF0000"><b>then goto </b></font>Fail<font color="#000080">;
      </font><font color="#FF0000"><b>if not </b></font>AddElement<font color="#000080">(</font><font color="#800000">4</font><font color="#000080">, </font><font color="#800000">1</font><font color="#000080">, </font><font color="#800000">0.75</font><font color="#000080">) </font><font color="#FF0000"><b>then goto </b></font>Fail<font color="#000080">;
      </font><font color="#FF0000"><b>if not </b></font>SetRHS<font color="#000080">(</font><font color="#800000">4</font><font color="#000080">, </font><font color="#800000">26.00</font><font color="#000080">) </font><font color="#FF0000"><b>then goto </b></font>Fail<font color="#000080">;
    </font><font color="#FF0000"><b>end
    else if </b></font><font color="#000080">(</font>Example <font color="#000080">= </font><font color="#800000">4</font><font color="#000080">) </font><font color="#FF0000"><b>then begin </b></font><font color="#008000"><i>{no vars in row 4}
      </i></font><font color="#FF0000"><b>if not </b></font>SetRHS<font color="#000080">(</font><font color="#800000">4</font><font color="#000080">, </font><font color="#800000">26.00</font><font color="#000080">) </font><font color="#FF0000"><b>then goto </b></font>Fail<font color="#000080">;
    </font><font color="#FF0000"><b>end
    else if </b></font><font color="#000080">(</font>Example <font color="#000080">= </font><font color="#800000">5</font><font color="#000080">) </font><font color="#FF0000"><b>then begin    </b></font><font color="#008000"><i>{no rhs}
      </i></font><font color="#FF0000"><b>if not </b></font>AddElement<font color="#000080">(</font><font color="#800000">4</font><font color="#000080">, </font><font color="#800000">3</font><font color="#000080">, </font><font color="#800000">1.00</font><font color="#000080">) </font><font color="#FF0000"><b>then goto </b></font>Fail<font color="#000080">;
      </font><font color="#FF0000"><b>if not </b></font>AddElement<font color="#000080">(</font><font color="#800000">4</font><font color="#000080">, </font><font color="#800000">1</font><font color="#000080">, </font><font color="#800000">0.75</font><font color="#000080">) </font><font color="#FF0000"><b>then goto </b></font>Fail<font color="#000080">;
    </font><font color="#FF0000"><b>end
    else if </b></font><font color="#000080">(</font>Example <font color="#000080">= </font><font color="#800000">6</font><font color="#000080">) </font><font color="#FF0000"><b>then begin   </b></font><font color="#008000"><i>{no row 4}
    </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font>showmat<font color="#000080">;
    </font><font color="#FF0000"><b>if not </b></font>Solve1 <font color="#FF0000"><b>then begin
      </b></font>GetErrorMsg<font color="#000080">(</font>Reason<font color="#000080">, </font>ErrNo1<font color="#000080">, </font>ErrNo2<font color="#000080">, </font>ErrNo3<font color="#000080">);
      </font>WriteLn<font color="#000080">(</font><font color="#800000">'Failed:  Error '</font><font color="#000080">, </font>ErrNo1<font color="#000080">:</font><font color="#800000">0</font><font color="#000080">, </font><font color="#800000">' '</font><font color="#000080">, </font>Reason<font color="#000080">, </font><font color="#800000">' '</font><font color="#000080">, </font><font color="#800000">' '</font><font color="#000080">, </font>ErrNo2<font color="#000080">:</font><font color="#800000">3</font><font color="#000080">, </font><font color="#800000">'
', ErrNo3:3);
    </font><font color="#FF0000"><b>end
    else begin
      </b></font>Write<font color="#000080">(</font><font color="#800000">'Solved: '</font><font color="#000080">);
      </font><font color="#FF0000"><b>for </b></font>Row <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>N <font color="#FF0000"><b>do if </b></font>GetAnswer<font color="#000080">(</font>Row<font color="#000080">, </font>Value<font color="#000080">)
        </font><font color="#FF0000"><b>then </b></font>Write<font color="#000080">(</font><font color="#800000">'  X('</font><font color="#000080">, </font>Row<font color="#000080">, </font><font color="#800000">')='</font><font color="#000080">, </font>Value<font color="#000080">:</font><font color="#800000">0</font><font color="#000080">:</font><font color="#800000">3</font><font color="#000080">)
        </font><font color="#FF0000"><b>else goto </b></font>Fail<font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font>WriteLn<font color="#000080">;

    </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>Example <font color="#000080">&lt; </font><font color="#800000">7</font><font color="#000080">) </font><font color="#FF0000"><b>then </b></font>ReleaseStruc<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;                  </font><font color="#008000"><i>{for example}

  </i></font>Halt<font color="#000080">;

</font>Fail<font color="#000080">:
  </font>GetErrorMsg<font color="#000080">(</font>Reason<font color="#000080">, </font>ErrNo1<font color="#000080">, </font>ErrNo2<font color="#000080">, </font>ErrNo3<font color="#000080">);
  </font>WriteLn<font color="#000080">(</font><font color="#800000">'Failed:  Error '</font><font color="#000080">, </font>ErrNo1<font color="#000080">:</font><font color="#800000">0</font><font color="#000080">, </font><font color="#800000">' '</font><font color="#000080">, </font>Reason<font color="#000080">, </font><font color="#800000">' '</font><font color="#000080">, </font><font color="#800000">' '</font><font color="#000080">, </font>ErrNo2<font color="#000080">:</font><font color="#800000">3</font><font color="#000080">, </font><font color="#800000">' '</font><font color="#000080">,
</font>ErrNo3<font color="#000080">:</font><font color="#800000">3</font><font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to MATH SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0094.PAS">Original</a><b>]</b></p></body>
</html>
