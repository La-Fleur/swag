<html>
<head><title> "Fixed Point Math Unit" by DIMITRI SMITS</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to MATH SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0116.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>(*

    This unit has been typed from the top of my head, so test
    it first with the examples in my previous message to Eli.
    As a matter of fact, this is a Unit that is based upon
    my explanations to Eli, so it somewhat NEEDS it ;)

    But I tested it though, just before posting it ;)

    This unit may be published in the next SWAGs (at least I
    think something like this belongs at least in the MISC SWAG
    becos it doesn't have one yet (I think).)
    but include the other mail too! (the previous one)

    If any questions, direct them to

    Gongo/Insecabilis
       dsmits@zorro.ruca.ua.ac.be
    or 2:292/8013.12 (fido)
*)

    </i></font><font color="#FF0000"><b>Unit </b></font>FixP<font color="#000080">;

    </font><font color="#008000"><i>{
        (c) 1996 by Dimitri Smits aka Gongo/Insecabilis
        Released to the public Domain on june 22 '96
        You may use this in any production you want
        just notice me of the result, always happy to
        see such stuff ;) ... not needed to credit me,
        just greet me (either in the documentation or
        in the demo/game/softpackage ;)
    }

    </i></font><font color="#FF0000"><b>INTERFACE

    TYPE </b></font>fp <font color="#000080">= </font>LONGINT<font color="#000080">;
        </font><font color="#008000"><i>{ 16.16 fixed point, signed
            So all numbers -32768.0000 &lt;= x &lt; 32767.9999
            should be sufficiently supported (although mul             and div
might lose some precision, or give odd results            for large numbers
(integer part)}
    </i></font><font color="#FF0000"><b>FUNCTION </b></font>fp_add <font color="#000080">( </font>fp1<font color="#000080">,</font>fp2<font color="#000080">: </font>fp<font color="#000080">): </font>fp<font color="#000080">;
    </font><font color="#008000"><i>{ Not really needed, but when going to
      overloading functions in C++ or so, this method is needed ;)
     in other words, just here to make things complete }
    { an fp3 := fp1 + fp2  is enough :) }

    </i></font><font color="#FF0000"><b>FUNCTION </b></font>fp_sub <font color="#000080">( </font>fp1<font color="#000080">,</font>fp2<font color="#000080">: </font>fp<font color="#000080">): </font>fp<font color="#000080">;
   </font><font color="#008000"><i>{ same as with fp_add, only + is - now }

    </i></font><font color="#FF0000"><b>FUNCTION </b></font>fp_mul <font color="#000080">( </font>fp1<font color="#000080">,</font>fp2<font color="#000080">: </font>fp<font color="#000080">): </font>fp<font color="#000080">;
    </font><font color="#FF0000"><b>FUNCTION </b></font>fp_div <font color="#000080">( </font>fp1<font color="#000080">,</font>fp2<font color="#000080">: </font>fp<font color="#000080">): </font>fp<font color="#000080">;

    </font><font color="#FF0000"><b>FUNCTION </b></font>fp2float <font color="#000080">(</font>fpt <font color="#000080">: </font>fp<font color="#000080">) : </font>REAL<font color="#000080">;
    </font><font color="#FF0000"><b>FUNCTION </b></font>float2fp <font color="#000080">(</font>fl <font color="#000080">: </font>REAL<font color="#000080">) : </font>fp<font color="#000080">;

    </font><font color="#FF0000"><b>IMPLEMENTATION

    FUNCTION </b></font>fp_add <font color="#000080">(</font>fp1<font color="#000080">,</font>fp2 <font color="#000080">: </font>fp<font color="#000080">) : </font>fp<font color="#000080">;
        </font><font color="#FF0000"><b>BEGIN
           </b></font>fp_add <font color="#000080">:= </font>fp1 <font color="#000080">+ </font>fp2<font color="#000080">;
        </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

    </font><font color="#FF0000"><b>FUNCTION </b></font>fp_sub <font color="#000080">(</font>fp1<font color="#000080">,</font>fp2 <font color="#000080">: </font>fp<font color="#000080">) : </font>fp<font color="#000080">;
        </font><font color="#FF0000"><b>BEGIN
           </b></font>fp_sub <font color="#000080">:= </font>fp1 <font color="#000080">- </font>fp2<font color="#000080">;
        </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

    </font><font color="#FF0000"><b>FUNCTION </b></font>fp_mul <font color="#000080">(</font>fp1<font color="#000080">,</font>fp2 <font color="#000080">: </font>fp<font color="#000080">) : </font>fp<font color="#000080">;
        </font><font color="#FF0000"><b>BEGIN
             IF </b></font>abs<font color="#000080">(</font>fp1<font color="#000080">) &gt; </font>abs<font color="#000080">(</font>fp2<font color="#000080">) </font><font color="#FF0000"><b>THEN
               </b></font>fp_mul <font color="#000080">:= (</font>fp1 <font color="#FF0000"><b>SHR </b></font><font color="#800000">8 </font><font color="#000080">* </font>fp2<font color="#000080">) </font><font color="#FF0000"><b>SHR </b></font><font color="#800000">8
             </font><font color="#FF0000"><b>ELSE
               </b></font>fp_mul <font color="#000080">:= (</font>fp2 <font color="#FF0000"><b>SHR </b></font><font color="#800000">8 </font><font color="#000080">* </font>fp1<font color="#000080">) </font><font color="#FF0000"><b>SHR </b></font><font color="#800000">8</font><font color="#000080">;
            </font><font color="#008000"><i>{16-bit precision needed, not 32 =)}
        </i></font><font color="#FF0000"><b>END</b></font><font color="#000080">;

    </font><font color="#FF0000"><b>FUNCTION </b></font>fp_div <font color="#000080">(</font>fp1<font color="#000080">,</font>fp2 <font color="#000080">:</font>fp<font color="#000080">) : </font>fp<font color="#000080">;
        </font><font color="#FF0000"><b>BEGIN
            </b></font>fp_div <font color="#000080">:= (</font>fp1 <font color="#FF0000"><b>SHL </b></font><font color="#800000">8</font><font color="#000080">) </font><font color="#FF0000"><b>DIV </b></font><font color="#000080">(</font>fp2 <font color="#FF0000"><b>SHR </b></font><font color="#800000">8</font><font color="#000080">);
            </font><font color="#008000"><i>{ May lose some precision there}
        </i></font><font color="#FF0000"><b>END</b></font><font color="#000080">;

    </font><font color="#FF0000"><b>FUNCTION </b></font>fp2Float <font color="#000080">(</font>fpt <font color="#000080">: </font>fp<font color="#000080">) : </font>REAL<font color="#000080">;
        </font><font color="#FF0000"><b>BEGIN
            </b></font>fp2Float <font color="#000080">:= </font>fpt <font color="#000080">/ </font><font color="#800000">65536</font><font color="#000080">;
        </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

    </font><font color="#FF0000"><b>FUNCTION </b></font>float2fp <font color="#000080">(</font>fl <font color="#000080">: </font>REAL<font color="#000080">) : </font>fp<font color="#000080">;
        </font><font color="#FF0000"><b>BEGIN
            </b></font>float2fp <font color="#000080">:= </font>ROUND <font color="#000080">(</font>fl <font color="#000080">* </font><font color="#800000">65536</font><font color="#000080">);
        </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>BEGIN
END</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to MATH SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0116.PAS">Original</a><b>]</b></p></body>
</html>
