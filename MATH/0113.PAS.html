<html>
<head><title> "Handling Massive Number functions" by JES R. KLINKE</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to MATH SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0113.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
You may use the following unit I have made for an encryption program
of mine. It implements real binary arithmetic, no BCD. But be careful,
there is currently no range checking at all, and overflows may result
in endless loops. If you need 2048 bit integers you have to set
BigNumLength to at least 128, a little more would be safer. Also
notice that the routines cannot handle negative numbers.

I hope you find this one useful.

        Jes R Klinke
}


</i></font><font color="#FF0000"><b>PROGRAM </b></font>BigNum<font color="#000080">;

</font><font color="#FF0000"><b>USES

  </b></font>Crt<font color="#000080">, </font>Dos<font color="#000080">;

</font><font color="#FF0000"><b>CONST

  </b></font>BigNumLength <font color="#000080">= </font><font color="#800000">20</font><font color="#000080">; </font><font color="#008000"><i>{Number of words in value}

</i></font><font color="#FF0000"><b>TYPE

  </b></font>PBigNum <font color="#000080">= ^</font>TBigNum<font color="#000080">;
  </font>TBigNum <font color="#000080">= </font><font color="#FF0000"><b>object

    </b></font>Value <font color="#000080">: </font><font color="#FF0000"><b>ARRAY </b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font>BigNumLength <font color="#000080">- </font><font color="#800000">1</font><font color="#000080">] </font><font color="#FF0000"><b>OF </b></font>WORD<font color="#000080">;

    </font><font color="#FF0000"><b>PROCEDURE </b></font>ASSIGN <font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>AValue <font color="#000080">: </font>TBigNum<font color="#000080">);
    </font><font color="#FF0000"><b>PROCEDURE </b></font>AssignLong <font color="#000080">(</font>AValue <font color="#000080">: </font>LONGINT<font color="#000080">);
    </font><font color="#FF0000"><b>PROCEDURE </b></font>ADD <font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>AValue <font color="#000080">: </font>TBigNum<font color="#000080">);
    </font><font color="#FF0000"><b>PROCEDURE </b></font>Subtract <font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>AValue <font color="#000080">: </font>TBigNum<font color="#000080">);
    </font><font color="#FF0000"><b>PROCEDURE </b></font>Multiply <font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>AMultiplicator <font color="#000080">: </font>TBigNum<font color="#000080">);
    </font><font color="#FF0000"><b>FUNCTION </b></font>Divide <font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>ADivisor <font color="#000080">: </font>TBigNum<font color="#000080">) : </font>BOOLEAN<font color="#000080">;
    </font><font color="#FF0000"><b>FUNCTION </b></font>Modulus <font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>ADivisor <font color="#000080">: </font>TBigNum<font color="#000080">) : </font>BOOLEAN<font color="#000080">;
    </font><font color="#FF0000"><b>PROCEDURE </b></font>SquareRoot<font color="#000080">;
    </font><font color="#FF0000"><b>PROCEDURE </b></font>Increment <font color="#000080">(</font>By <font color="#000080">: </font>WORD<font color="#000080">);
    </font><font color="#FF0000"><b>PROCEDURE </b></font>Decrement <font color="#000080">(</font>By <font color="#000080">: </font>WORD<font color="#000080">);
    </font><font color="#FF0000"><b>PROCEDURE </b></font>BitwiseOr <font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>AMaske <font color="#000080">: </font>TBigNum<font color="#000080">);
    </font><font color="#FF0000"><b>FUNCTION </b></font>Compare <font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>AValue <font color="#000080">: </font>TBigNum<font color="#000080">) : </font>INTEGER<font color="#000080">;
    </font><font color="#FF0000"><b>PROCEDURE </b></font>Mult10<font color="#000080">;
    </font><font color="#FF0000"><b>PROCEDURE </b></font>Div10<font color="#000080">;
    </font><font color="#FF0000"><b>PROCEDURE </b></font>Mult2<font color="#000080">;
    </font><font color="#FF0000"><b>PROCEDURE </b></font>Div2<font color="#000080">;
    </font><font color="#FF0000"><b>FUNCTION </b></font>STR <font color="#000080">: </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>FUNCTION </b></font>Str16 <font color="#000080">: </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>PROCEDURE </b></font>VAL <font color="#000080">(</font><font color="#FF0000"><b>CONST </b></font>S <font color="#000080">: </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">);
    </font><font color="#FF0000"><b>FUNCTION </b></font>AsLong <font color="#000080">: </font>LONGINT<font color="#000080">;
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;



</font><font color="#FF0000"><b>PROCEDURE </b></font>TBigNum<font color="#000080">.</font>ASSIGN <font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>AValue <font color="#000080">: </font>TBigNum<font color="#000080">);
</font><font color="#FF0000"><b>BEGIN
  </b></font>MOVE <font color="#000080">(</font>AValue<font color="#000080">.</font>Value<font color="#000080">, </font>Value<font color="#000080">, </font>SIZEOF <font color="#000080">(</font>Value<font color="#000080">) );;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>PROCEDURE </b></font>TBigNum<font color="#000080">.</font>AssignLong <font color="#000080">(</font>AValue <font color="#000080">: </font>LONGINT<font color="#000080">);
</font><font color="#FF0000"><b>BEGIN
  </b></font>MOVE <font color="#000080">(</font>AValue<font color="#000080">, </font>Value <font color="#000080">[</font><font color="#800000">0</font><font color="#000080">], </font>SIZEOF <font color="#000080">(</font>LONGINT<font color="#000080">) );;
  </font>FILLCHAR <font color="#000080">(</font>Value <font color="#000080">[</font>SIZEOF <font color="#000080">(</font>LONGINT<font color="#000080">) </font><font color="#FF0000"><b>SHR </b></font><font color="#800000">1</font><font color="#000080">], </font>BigNumLength <font color="#FF0000"><b>SHL </b></font><font color="#800000">1 </font><font color="#000080">-
</font>SIZEOF <font color="#000080">(</font>LONGINT<font color="#000080">), </font><font color="#800000">0</font><font color="#000080">);
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>PROCEDURE </b></font>TBigNum<font color="#000080">.</font>ADD <font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>AValue <font color="#000080">: </font>TBigNum<font color="#000080">); </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>asm

    </b></font><font color="#FF00FF">PUSH  DS
    LES    DI, Self
    ADD    DI, OFFSET TBigNum.Value
    LDS    SI, AValue
    ADD    SI, OFFSET TBigNum.Value
    MOV    CX, BigNumLength
    CLD
    CLC
@@0 : LODSW
    ADC    [ES : DI], AX
    INC    DI
    INC    DI
    LOOP  @@0
    POP    DS
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>PROCEDURE </b></font>TBigNum<font color="#000080">.</font>Subtract <font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>AValue <font color="#000080">: </font>TBigNum<font color="#000080">); </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;

</font><font color="#FF0000"><b>asm

    </b></font><font color="#FF00FF">PUSH  DS
    LES    DI, Self
    ADD    DI, OFFSET TBigNum.Value
    LDS    SI, AValue
    ADD    SI, OFFSET TBigNum.Value
    MOV    CX, BigNumLength
    CLD
    CLC
@@0 : LODSW
    SBB    [ES : DI], AX
    INC    DI
    INC    DI
    LOOP  @@0
    POP    DS
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>PROCEDURE </b></font>TBigNum<font color="#000080">.</font>Multiply <font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>AMultiplicator <font color="#000080">: </font>TBigNum<font color="#000080">); </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;

</font><font color="#FF0000"><b>VAR

  </b></font>Res <font color="#000080">: </font><font color="#FF0000"><b>ARRAY </b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font>BigNumLength<font color="#000080">] </font><font color="#FF0000"><b>OF </b></font>WORD<font color="#000080">;
</font><font color="#FF0000"><b>asm

    </b></font><font color="#FF00FF">PUSH  DS
    PUSH  BP
    STD
    LES    DI, AMultiplicator
    ADD    DI, OFFSET TBigNum.Value
    LDS    SI, Self
    ADD    SI, OFFSET TBigNum.Value
    PUSH  SI
    LEA    BP, Res
    XOR    SI, SI
    MOV    CX, BigNumLength
    XOR    AX, AX
@@8 : MOV    SS : [BP + SI], AX
    ADD    SI, 2
    LOOP  @@8
    POP    SI
    XOR    BX, BX
@@0 : MOV    CX, BX
    MOV    DX, CX
    SHL    DX, 1
    ADD    SI, DX
    INC    CX
@@1 : LODSW
    MOV    DX, ES : [DI]
    ADD    DI, 2
    MUL    DX
    ADD    SS : [BP], AX
    ADC    SS : [BP + 2], DX
    JC    @@3
@@2 : LOOP  @@1
    MOV    DX, BX
    INC    DX
    SHL    DX, 1
    SUB    DI, DX
    ADD    SI, 2
    ADD    BP, 2
    INC    BX
    CMP    BX, BigNumLength
    JNE    @@0
    CLD
    POP    BP
    LEA    SI, Res
    PUSH  SS
    POP    DS
    LES    DI, Self
    ADD    DI, OFFSET TBigNum.Value
    MOV    CX, BigNumLength
    REP    MOVSW
    POP    DS
    JMP    @@9
@@3 : PUSH  SI
    MOV    DX, 1
    MOV    SI, 4
@@4 : ADD    [BP + SI], DX
    INC   SI
    INC    SI
    JC    @@4
    POP    SI
    JMP    @@2
@@9 :
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>FUNCTION </b></font>TBigNum<font color="#000080">.</font>Divide <font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>ADivisor <font color="#000080">: </font>TBigNum<font color="#000080">) : </font>BOOLEAN<font color="#000080">;

</font><font color="#FF0000"><b>VAR
  </b></font>Bit<font color="#000080">, </font>Res<font color="#000080">, </font>Divisor <font color="#000080">: </font>TBigNum<font color="#000080">;
  </font>WholeResult <font color="#000080">: </font>BOOLEAN<font color="#000080">;
</font><font color="#FF0000"><b>BEGIN

  </b></font>Divisor<font color="#000080">.</font>ASSIGN <font color="#000080">(</font>ADivisor<font color="#000080">);
  </font>WholeResult <font color="#000080">:= </font>FALSE<font color="#000080">;
  </font>Bit<font color="#000080">.</font>AssignLong <font color="#000080">(</font><font color="#800000">1</font><font color="#000080">);
  </font>Res<font color="#000080">.</font>AssignLong <font color="#000080">(</font><font color="#800000">0</font><font color="#000080">);
  </font><font color="#FF0000"><b>WHILE </b></font>Compare <font color="#000080">(</font>Divisor<font color="#000080">) &gt;= </font><font color="#800000">0 </font><font color="#FF0000"><b>DO
  BEGIN
    </b></font>Bit<font color="#000080">.</font>Mult2<font color="#000080">;
    </font>Divisor<font color="#000080">.</font>Mult2<font color="#000080">;
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>WHILE </b></font><font color="#000080">(</font>Bit<font color="#000080">.</font>Value <font color="#000080">[</font><font color="#800000">0</font><font color="#000080">] </font><font color="#FF0000"><b>AND </b></font><font color="#800000">1 </font><font color="#000080">= </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>AND NOT </b></font>WholeResult <font color="#FF0000"><b>DO
  BEGIN
    </b></font>Bit<font color="#000080">.</font>Div2<font color="#000080">;
    </font>Divisor<font color="#000080">.</font>Div2<font color="#000080">;
    </font><font color="#FF0000"><b>CASE </b></font>Compare <font color="#000080">(</font>Divisor<font color="#000080">) </font><font color="#FF0000"><b>OF
      </b></font><font color="#800000">1 </font><font color="#000080">:
      </font><font color="#FF0000"><b>BEGIN
        </b></font>Res<font color="#000080">.</font>BitwiseOr <font color="#000080">(</font>Bit<font color="#000080">);
        </font>Subtract <font color="#000080">(</font>Divisor<font color="#000080">);
      </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

      </font><font color="#800000">0 </font><font color="#000080">:
      </font><font color="#FF0000"><b>BEGIN
        </b></font>WholeResult <font color="#000080">:= </font>TRUE<font color="#000080">;
        </font>Res<font color="#000080">.</font>BitwiseOr <font color="#000080">(</font>Bit<font color="#000080">);
        </font>Subtract <font color="#000080">(</font>Divisor<font color="#000080">);
      </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

  </font>ASSIGN <font color="#000080">(</font>Res<font color="#000080">);
  </font>Divide <font color="#000080">:= </font>WholeResult<font color="#000080">;

</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>FUNCTION </b></font>TBigNum<font color="#000080">.</font>Modulus <font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>ADivisor <font color="#000080">: </font>TBigNum<font color="#000080">) : </font>BOOLEAN<font color="#000080">;

</font><font color="#FF0000"><b>VAR

  </b></font>Bit<font color="#000080">, </font>Res<font color="#000080">, </font>Divisor <font color="#000080">: </font>TBigNum<font color="#000080">;
  </font>WholeResult <font color="#000080">: </font>BOOLEAN<font color="#000080">;

</font><font color="#FF0000"><b>BEGIN

  </b></font>Divisor<font color="#000080">.</font>ASSIGN <font color="#000080">(</font>ADivisor<font color="#000080">);
  </font>WholeResult <font color="#000080">:= </font>FALSE<font color="#000080">;
  </font>Bit<font color="#000080">.</font>AssignLong <font color="#000080">(</font><font color="#800000">1</font><font color="#000080">);
  </font>Res<font color="#000080">.</font>AssignLong <font color="#000080">(</font><font color="#800000">0</font><font color="#000080">);

  </font><font color="#FF0000"><b>WHILE </b></font>Compare <font color="#000080">(</font>Divisor<font color="#000080">) &gt;= </font><font color="#800000">0 </font><font color="#FF0000"><b>DO
  BEGIN

    </b></font>Bit<font color="#000080">.</font>Mult2<font color="#000080">;
    </font>Divisor<font color="#000080">.</font>Mult2<font color="#000080">;

  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>WHILE </b></font><font color="#000080">(</font>Bit<font color="#000080">.</font>Value <font color="#000080">[</font><font color="#800000">0</font><font color="#000080">] </font><font color="#FF0000"><b>AND </b></font><font color="#800000">1 </font><font color="#000080">= </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>AND NOT </b></font>WholeResult <font color="#FF0000"><b>DO
  BEGIN
    </b></font>Bit<font color="#000080">.</font>Div2<font color="#000080">;
    </font>Divisor<font color="#000080">.</font>Div2<font color="#000080">;

    </font><font color="#FF0000"><b>CASE </b></font>Compare <font color="#000080">(</font>Divisor<font color="#000080">) </font><font color="#FF0000"><b>OF
      </b></font><font color="#800000">1 </font><font color="#000080">:
      </font><font color="#FF0000"><b>BEGIN
        </b></font>Res<font color="#000080">.</font>BitwiseOr <font color="#000080">(</font>Bit<font color="#000080">);
        </font>Subtract <font color="#000080">(</font>Divisor<font color="#000080">);
      </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

      </font><font color="#800000">0 </font><font color="#000080">:
      </font><font color="#FF0000"><b>BEGIN
        </b></font>WholeResult <font color="#000080">:= </font>TRUE<font color="#000080">;
        </font>Res<font color="#000080">.</font>BitwiseOr <font color="#000080">(</font>Bit<font color="#000080">);
        </font>Subtract <font color="#000080">(</font>Divisor<font color="#000080">);
      </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

    </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

  </font>Modulus <font color="#000080">:= </font>WholeResult<font color="#000080">;

</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>PROCEDURE </b></font>TBigNum<font color="#000080">.</font>SquareRoot<font color="#000080">;

</font><font color="#FF0000"><b>VAR

  </b></font>Guess<font color="#000080">, </font>NewGuess <font color="#000080">: </font>TBigNum<font color="#000080">;

</font><font color="#FF0000"><b>BEGIN

  </b></font>NewGuess<font color="#000080">.</font>ASSIGN <font color="#000080">(</font>Self<font color="#000080">);
  </font>NewGuess<font color="#000080">.</font>Div2<font color="#000080">;

  </font><font color="#FF0000"><b>REPEAT

    </b></font>Guess<font color="#000080">.</font>ASSIGN <font color="#000080">(</font>NewGuess<font color="#000080">);
    </font>NewGuess<font color="#000080">.</font>ASSIGN <font color="#000080">(</font>Self<font color="#000080">);
    </font>NewGuess<font color="#000080">.</font>Divide <font color="#000080">(</font>Guess<font color="#000080">);
    </font>NewGuess<font color="#000080">.</font>ADD <font color="#000080">(</font>Guess<font color="#000080">);
    </font>NewGuess<font color="#000080">.</font>Div2<font color="#000080">;

  </font><font color="#FF0000"><b>UNTIL </b></font>NewGuess<font color="#000080">.</font>Compare <font color="#000080">(</font>Guess<font color="#000080">) = </font><font color="#800000">0</font><font color="#000080">;

  </font>ASSIGN <font color="#000080">(</font>NewGuess<font color="#000080">);

</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>PROCEDURE </b></font>TBigNum<font color="#000080">.</font>Increment <font color="#000080">(</font>By <font color="#000080">: </font>WORD<font color="#000080">); </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;

</font><font color="#FF0000"><b>asm

    </b></font><font color="#FF00FF">LES    DI, Self
    ADD    DI, OFFSET TBigNum.Value
    CLD
    MOV    AX, ES : [DI]
    ADD    AX, By
    STOSW
    MOV    CX, BigNumLength - 1
@@0 : MOV    AX, ES : [DI]
    ADC    AX, 0
    STOSW
    LOOP  @@0
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;


</font><font color="#FF0000"><b>PROCEDURE </b></font>TBigNum<font color="#000080">.</font>Decrement <font color="#000080">(</font>By <font color="#000080">: </font>WORD<font color="#000080">); </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;

</font><font color="#FF0000"><b>asm

    </b></font><font color="#FF00FF">LES    DI, Self
    ADD    DI, OFFSET TBigNum.Value
    CLD
    MOV    AX, ES : [DI]
    SUB    AX, By
    STOSW
    MOV    CX, BigNumLength - 1
@@0 : MOV    AX, ES : [DI]
    SBB    AX, 0
    STOSW
    LOOP  @@0
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>PROCEDURE </b></font>TBigNum<font color="#000080">.</font>BitwiseOr <font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>AMaske <font color="#000080">: </font>TBigNum<font color="#000080">); </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;

</font><font color="#FF0000"><b>asm

    </b></font><font color="#FF00FF">PUSH  DS
    LES    DI, Self
    ADD    DI, OFFSET TBigNum.Value
    LDS    SI, AMaske
    ADD    SI, OFFSET TBigNum.Value
    MOV    CX, BigNumLength
    CLD
@@0 : LODSW
    OR    AX, ES : [DI]
    STOSW
    LOOP  @@0
    POP    DS
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>FUNCTION </b></font>TBigNum<font color="#000080">.</font>Compare <font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>AValue <font color="#000080">: </font>TBigNum<font color="#000080">) : </font>INTEGER<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;

</font><font color="#FF0000"><b>asm
    </b></font><font color="#FF00FF">PUSH  DS
    LES    DI, Self
    ADD    DI, OFFSET TBigNum.Value
    LDS    SI, AValue
    ADD    SI, OFFSET TBigNum.Value
    MOV    CX, BigNumLength
    MOV    DX, CX
    DEC    DX
    SHL    DX, 1
    ADD    DI, DX
    ADD    SI, DX
    STD
    REPZ  CMPSW
    MOV    AX, 0FFFFh
    JA    @@1
    MOV    AX, 0000h
    JE    @@1
    MOV    AX, 0001h
@@1 : POP    DS
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>PROCEDURE </b></font>TBigNum<font color="#000080">.</font>Mult10<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;

</font><font color="#FF0000"><b>asm

    </b></font><font color="#FF00FF">LES    DI, Self
    ADD    DI, OFFSET TBigNum.Value
    XOR    BX, BX
    MOV    CX, BigNumLength
@@0 : MOV    AX, [ES : DI]
    MOV    DX, 10
    MUL    DX
    ADD    AX, BX
    ADC    DX, 0
    MOV    [ES : DI], AX
    INC    DI
    INC    DI
    MOV    BX, DX
    LOOP  @@0
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>PROCEDURE </b></font>TBigNum<font color="#000080">.</font>Div10<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;

</font><font color="#FF0000"><b>asm
    </b></font><font color="#FF00FF">LES    DI, Self
    ADD    DI, OFFSET TBigNum.Value
    MOV    CX, BigNumLength
    MOV    DX, CX
    DEC    DX
    SHL    DX, 1
    ADD    DI, DX
    XOR    DX, DX
@@0 : MOV    AX, [ES : DI]
    MOV    BX, 10
    DIV    BX
    MOV    [ES : DI], AX
    DEC    DI
    DEC    DI
    LOOP  @@0
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>PROCEDURE </b></font>TBigNum<font color="#000080">.</font>Mult2<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;

</font><font color="#FF0000"><b>asm
    </b></font><font color="#FF00FF">LES    DI, Self
    ADD    DI, OFFSET TBigNum.Value
    XOR    BX, BX
    MOV    CX, BigNumLength
    CLC
    CLD
@@0 : MOV    AX, [ES : DI]
    RCL    AX, 1
    STOSW
    LOOP  @@0
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>PROCEDURE </b></font>TBigNum<font color="#000080">.</font>Div2<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;

</font><font color="#FF0000"><b>asm
    </b></font><font color="#FF00FF">LES    DI, Self
    ADD    DI, OFFSET TBigNum.Value
    MOV    CX, BigNumLength
    MOV    DX, CX
    DEC    DX
    SHL    DX, 1
    ADD    DI, DX
    XOR    DX, DX
    CLC
    STD
@@0 : MOV    AX, [ES : DI]
    RCR    AX, 1
    STOSW
    LOOP  @@0
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>FUNCTION </b></font>TBigNum<font color="#000080">.</font>STR <font color="#000080">: </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">;

</font><font color="#FF0000"><b>VAR

  </b></font>M<font color="#000080">, </font>T <font color="#000080">: </font>TBigNum<font color="#000080">;
  </font>Res <font color="#000080">: </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">;
  </font>I<font color="#000080">, </font>Ciffer <font color="#000080">: </font>INTEGER<font color="#000080">;

</font><font color="#FF0000"><b>BEGIN

  </b></font>M<font color="#000080">.</font>ASSIGN <font color="#000080">(</font>Self<font color="#000080">);
  </font>T<font color="#000080">.</font>AssignLong <font color="#000080">(</font><font color="#800000">1</font><font color="#000080">);
  </font>I <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font><font color="#FF0000"><b>WHILE </b></font>M<font color="#000080">.</font>Compare <font color="#000080">(</font>T<font color="#000080">) &gt;= </font><font color="#800000">0 </font><font color="#FF0000"><b>DO
  BEGIN
    </b></font>T<font color="#000080">.</font>Mult10<font color="#000080">;
    </font>INC <font color="#000080">(</font>I<font color="#000080">);
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>IF </b></font>I <font color="#000080">&lt;= </font><font color="#800000">1 </font><font color="#FF0000"><b>THEN
  BEGIN
    </b></font>STR <font color="#000080">:= </font>CHAR <font color="#000080">(</font>BYTE <font color="#000080">(</font><font color="#800000">'0'</font><font color="#000080">) + </font>M<font color="#000080">.</font>Value <font color="#000080">[</font><font color="#800000">0</font><font color="#000080">]);
  </font><font color="#FF0000"><b>END
  ELSE
  BEGIN
    </b></font>Res <font color="#000080">:= </font><font color="#800000">''</font><font color="#000080">;
    </font>T<font color="#000080">.</font>Div10<font color="#000080">;
    </font><font color="#FF0000"><b>WHILE </b></font>I <font color="#000080">&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>DO
    BEGIN
      </b></font>Ciffer <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
      </font><font color="#FF0000"><b>WHILE </b></font><font color="#000080">(</font>M<font color="#000080">.</font>Compare <font color="#000080">(</font>T<font color="#000080">) &gt;= </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>DO
      BEGIN
        </b></font>M<font color="#000080">.</font>Subtract <font color="#000080">(</font>T<font color="#000080">);
        </font>INC <font color="#000080">(</font>Ciffer<font color="#000080">);
      </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
      </font>Res <font color="#000080">:= </font>Res <font color="#000080">+ </font>CHAR <font color="#000080">(</font>BYTE <font color="#000080">(</font><font color="#800000">'0'</font><font color="#000080">) + </font>Ciffer<font color="#000080">);
      </font>DEC <font color="#000080">(</font>I<font color="#000080">);
      </font>T<font color="#000080">.</font>Div10<font color="#000080">;
    </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
    </font>STR <font color="#000080">:= </font>Res<font color="#000080">;
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>FUNCTION </b></font>TBigNum<font color="#000080">.</font>Str16 <font color="#000080">: </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">;

</font><font color="#FF0000"><b>CONST
  </b></font>HexCif <font color="#000080">: </font><font color="#FF0000"><b>ARRAY </b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">15</font><font color="#000080">] </font><font color="#FF0000"><b>OF </b></font>CHAR <font color="#000080">= </font><font color="#800000">'0123456789ABCDEF'</font><font color="#000080">;
</font><font color="#FF0000"><b>VAR
  </b></font>Res <font color="#000080">: </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">;
  </font>I <font color="#000080">: </font>INTEGER<font color="#000080">;
  </font>ErMed <font color="#000080">: </font>BOOLEAN<font color="#000080">;
</font><font color="#FF0000"><b>BEGIN
  </b></font>ErMed <font color="#000080">:= </font>FALSE<font color="#000080">;
  </font>Res <font color="#000080">:= </font><font color="#800000">''</font><font color="#000080">;
  </font><font color="#FF0000"><b>FOR </b></font>I <font color="#000080">:= </font>BigNumLength <font color="#000080">- </font><font color="#800000">1 </font><font color="#FF0000"><b>DOWNTO </b></font><font color="#800000">0 </font><font color="#FF0000"><b>DO
  BEGIN
    IF </b></font>ErMed <font color="#FF0000"><b>OR </b></font><font color="#000080">(</font>Value <font color="#000080">[</font>I<font color="#000080">] &lt;&gt; </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>THEN
    BEGIN
      IF </b></font>ErMed <font color="#FF0000"><b>OR </b></font><font color="#000080">(</font>Value <font color="#000080">[</font>I<font color="#000080">] </font><font color="#FF0000"><b>SHR </b></font><font color="#800000">12 </font><font color="#FF0000"><b>AND </b></font><font color="#800000">$F </font><font color="#000080">&lt;&gt; </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>THEN
      BEGIN
        </b></font>Res <font color="#000080">:= </font>Res <font color="#000080">+ </font>HexCif <font color="#000080">[</font>Value <font color="#000080">[</font>I<font color="#000080">] </font><font color="#FF0000"><b>SHR </b></font><font color="#800000">12 </font><font color="#FF0000"><b>AND </b></font><font color="#800000">$F</font><font color="#000080">];
        </font>ErMed <font color="#000080">:= </font>TRUE<font color="#000080">;
      </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>IF </b></font>ErMed <font color="#FF0000"><b>OR </b></font><font color="#000080">(</font>Value <font color="#000080">[</font>I<font color="#000080">] </font><font color="#FF0000"><b>SHR </b></font><font color="#800000">8 </font><font color="#FF0000"><b>AND </b></font><font color="#800000">$F </font><font color="#000080">&lt;&gt; </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>THEN
      BEGIN
        </b></font>Res <font color="#000080">:= </font>Res <font color="#000080">+ </font>HexCif <font color="#000080">[</font>Value <font color="#000080">[</font>I<font color="#000080">] </font><font color="#FF0000"><b>SHR </b></font><font color="#800000">8 </font><font color="#FF0000"><b>AND </b></font><font color="#800000">$F</font><font color="#000080">];
        </font>ErMed <font color="#000080">:= </font>TRUE<font color="#000080">;
      </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>IF </b></font>ErMed <font color="#FF0000"><b>OR </b></font><font color="#000080">(</font>Value <font color="#000080">[</font>I<font color="#000080">] </font><font color="#FF0000"><b>SHR </b></font><font color="#800000">4 </font><font color="#FF0000"><b>AND </b></font><font color="#800000">$F </font><font color="#000080">&lt;&gt; </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>THEN
      BEGIN
        </b></font>Res <font color="#000080">:= </font>Res <font color="#000080">+ </font>HexCif <font color="#000080">[</font>Value <font color="#000080">[</font>I<font color="#000080">] </font><font color="#FF0000"><b>SHR </b></font><font color="#800000">4 </font><font color="#FF0000"><b>AND </b></font><font color="#800000">$F</font><font color="#000080">];
        </font>ErMed <font color="#000080">:= </font>TRUE<font color="#000080">;
      </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
      </font>Res <font color="#000080">:= </font>Res <font color="#000080">+ </font>HexCif <font color="#000080">[</font>Value <font color="#000080">[</font>I<font color="#000080">] </font><font color="#FF0000"><b>AND </b></font><font color="#800000">$F</font><font color="#000080">];
      </font>ErMed <font color="#000080">:= </font>TRUE<font color="#000080">;
    </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
  </font>Str16 <font color="#000080">:= </font>Res<font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>PROCEDURE </b></font>TBigNum<font color="#000080">.</font>VAL <font color="#000080">(</font><font color="#FF0000"><b>CONST </b></font>S <font color="#000080">: </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">);
</font><font color="#FF0000"><b>VAR
  </b></font>I <font color="#000080">: </font>INTEGER<font color="#000080">;
</font><font color="#FF0000"><b>BEGIN
  </b></font>AssignLong <font color="#000080">(</font><font color="#800000">0</font><font color="#000080">);
  </font>I <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;
  </font><font color="#FF0000"><b>WHILE </b></font>I <font color="#000080">&lt;= </font>LENGTH <font color="#000080">(</font>S<font color="#000080">) </font><font color="#FF0000"><b>DO
  BEGIN
    </b></font>Mult10<font color="#000080">;
    </font>Increment <font color="#000080">(</font>BYTE <font color="#000080">(</font>S <font color="#000080">[</font>I<font color="#000080">]) - </font>BYTE <font color="#000080">(</font><font color="#800000">'0'</font><font color="#000080">) );
    </font>INC <font color="#000080">(</font>I<font color="#000080">);
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>FUNCTION </b></font>TBigNum<font color="#000080">.</font>AsLong <font color="#000080">: </font>LONGINT<font color="#000080">;
</font><font color="#FF0000"><b>VAR
 </b></font>Res <font color="#000080">: ^</font>LONGINT<font color="#000080">;

</font><font color="#FF0000"><b>BEGIN
  </b></font>Res <font color="#000080">:= @</font>Value <font color="#000080">[</font><font color="#800000">0</font><font color="#000080">];
  </font>AsLong <font color="#000080">:= </font>Res<font color="#000080">^;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>VAR
  </b></font>ABigNum <font color="#000080">: </font>TBigNum<font color="#000080">;
  </font>I <font color="#000080">: </font>INTEGER<font color="#000080">;


</font><font color="#FF0000"><b>BEGIN
  </b></font>ABigNum<font color="#000080">.</font>AssignLong <font color="#000080">(</font><font color="#800000">1</font><font color="#000080">);
  </font><font color="#FF0000"><b>FOR </b></font>I <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>TO </b></font><font color="#800000">260 </font><font color="#FF0000"><b>DO
  BEGIN
    </b></font>WRITELN <font color="#000080">(</font>ABigNum<font color="#000080">.</font>STR <font color="#000080">: </font><font color="#800000">79</font><font color="#000080">);
    </font>ABigNum<font color="#000080">.</font>Mult2<font color="#000080">;
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>FOR </b></font>I <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>TO </b></font><font color="#800000">260 </font><font color="#FF0000"><b>DO
  BEGIN
    </b></font>WRITELN <font color="#000080">(</font>ABigNum<font color="#000080">.</font>STR <font color="#000080">: </font><font color="#800000">79</font><font color="#000080">);
    </font>ABigNum<font color="#000080">.</font>Div2<font color="#000080">;
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
  </font>WRITELN <font color="#000080">(</font>ABigNum<font color="#000080">.</font>STR <font color="#000080">: </font><font color="#800000">79</font><font color="#000080">);
  </font>WRITE <font color="#000080">(</font><font color="#800000">'Press enter to exit.'</font><font color="#000080">);
  </font>READLN<font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">.


</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to MATH SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0113.PAS">Original</a><b>]</b></p></body>
</html>
