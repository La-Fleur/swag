<html>
<head><title> "Text Formula Parser" by WIM VAN DER VEGT</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to MATH SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0073.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{---------------------------------------------------------}
{  Project : Text Formula Parser                          }
{  Auteur  : G.W. van der Vegt                            }
{---------------------------------------------------------}
{  Datum .tijd  Revisie                                   }
{  900530.1900  Creatie (function call/exits removed).    }
{  900531.1900  Revisie (Boolean expressions).            }
{  900104.2100  Revisie (HEAP Function Storage).          }
{  910327.1345  External Real string vars (tfp_realstr)   }
{               are corrected the same way as the parser  }
{               corrects them before using TURBO's VAL.   }
{  910829.1200  Support added for recursion with string   }
{               variables so they may contain formula's   }
{               now.                                      }
{  940411.1300  Hyperbolic, reciproke &amp; inverse           }
{               goniometric functions added,              }
{               Type of tfp_lnr changed to Byte.          }
{               Bug fixed in tfp_check (tfp_lnr not always}
{               initialized to 0)                         }
{---------------------------------------------------------}

</i></font><font color="#FF0000"><b>UNIT </b></font>Tfp_02<font color="#000080">;

</font><font color="#FF0000"><b>INTERFACE

CONST
  </b></font>tfp_true      <font color="#000080">= </font><font color="#800000">1.0</font><font color="#000080">;                   </font><font color="#008000"><i>{----REAL value for BOOLEAN TRUE     }
  </i></font>tfp_false     <font color="#000080">= </font><font color="#800000">0.0</font><font color="#000080">;                   </font><font color="#008000"><i>{----REAL value for BOOLEAN FALSE    }
  </i></font>tfp_maxparm   <font color="#000080">= </font><font color="#800000">16</font><font color="#000080">;                    </font><font color="#008000"><i>{----Maximum number of parameters    }
  </i></font>tfp_funclen   <font color="#000080">= </font><font color="#800000">12</font><font color="#000080">;                    </font><font color="#008000"><i>{----Maximum function name length    }

</i></font><font color="#FF0000"><b>TYPE
  </b></font>tfp_fname     <font color="#000080">= </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">[</font>tfp_funclen<font color="#000080">];   </font><font color="#008000"><i>{----Function Name or Alias          }
  </i></font>tfp_ftype     <font color="#000080">= (</font>tfp_noparm<font color="#000080">,           </font><font color="#008000"><i>{----Function or Function()          }
                   </i></font>tfp_1real<font color="#000080">,                  </font><font color="#008000"><i>{----Function(VAR r)                 }
                   </i></font>tfp_2real<font color="#000080">,                  </font><font color="#008000"><i>{----Function(VAR r1,r2)             }
                   </i></font>tfp_nreal<font color="#000080">,                  </font><font color="#008000"><i>{----Function(VAR r;n  INTEGER)      }
                   </i></font>tfp_realvar<font color="#000080">,            </font><font color="#008000"><i>{----Real VAR                        }
                   </i></font>tfp_intvar<font color="#000080">,           </font><font color="#008000"><i>{----Integer VAR                     }
                   </i></font>tfp_boolvar<font color="#000080">,                 </font><font color="#008000"><i>{----Boolean VAR                     }
                   </i></font>tfp_strvar<font color="#000080">);                 </font><font color="#008000"><i>{----String VAR (Formula)            }

  </i></font>tfp_rarray    <font color="#000080">= </font><font color="#FF0000"><b>ARRAY</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font>tfp_maxparm<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">] </font><font color="#FF0000"><b>OF </b></font>REAL<font color="#000080">;

</font><font color="#FF0000"><b>FUNCTION </b></font>Tfp_parse2real<font color="#000080">(</font>s <font color="#000080">: </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">): </font>REAL<font color="#000080">;

</font><font color="#FF0000"><b>FUNCTION </b></font>Tfp_parse2str<font color="#000080">(</font>s <font color="#000080">: </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">;</font>m<font color="#000080">,</font>n <font color="#000080">: </font>INTEGER<font color="#000080">) : </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">;

</font><font color="#008000"><i>{---------------------------------------------------------}
{----Interface to error functions for external addons     }
{---------------------------------------------------------}

</i></font><font color="#FF0000"><b>VAR
  </b></font>tfp_erpos<font color="#000080">,
  </font>tfp_ernr      <font color="#000080">: </font>BYTE<font color="#000080">;

</font><font color="#FF0000"><b>PROCEDURE </b></font>Tfp_seternr<font color="#000080">(</font>ernr <font color="#000080">: </font>INTEGER<font color="#000080">);

</font><font color="#FF0000"><b>FUNCTION  </b></font>Tfp_errormsg<font color="#000080">(</font>nr <font color="#000080">: </font>INTEGER<font color="#000080">) : </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">;

</font><font color="#008000"><i>{---------------------------------------------------------}
{----Initialize &amp; Expand internal parser datastructure    }
{---------------------------------------------------------}

</i></font><font color="#FF0000"><b>PROCEDURE </b></font>Tfp_init  <font color="#000080">(</font>no <font color="#000080">: </font>WORD<font color="#000080">);

</font><font color="#FF0000"><b>PROCEDURE </b></font>Tfp_expand<font color="#000080">(</font>no <font color="#000080">: </font>WORD<font color="#000080">);

</font><font color="#008000"><i>{---------------------------------------------------------}
{----Keep first no function+vars of parser                }
{---------------------------------------------------------}

</i></font><font color="#FF0000"><b>PROCEDURE </b></font>Tfp_keep  <font color="#000080">(</font>no <font color="#000080">: </font>WORD<font color="#000080">);

</font><font color="#008000"><i>{---------------------------------------------------------}
{----Number of functions+vars added to parser             }
{---------------------------------------------------------}

</i></font><font color="#FF0000"><b>FUNCTION  </b></font>Tfp_noobj <font color="#000080">: </font>WORD<font color="#000080">;

</font><font color="#008000"><i>{---------------------------------------------------------}
{----Adds own FUNCTION or VAR to the parser               }
{    All FUNCTIONS &amp; VARS must be compiled                }
{    with the FAR switch on                               }
{---------------------------------------------------------}

</i></font><font color="#FF0000"><b>PROCEDURE </b></font>Tfp_addobj<font color="#000080">(</font>adres <font color="#000080">: </font>POINTER<font color="#000080">;
                     </font>name  <font color="#000080">: </font>tfp_fname<font color="#000080">;
                     </font>ftype <font color="#000080">: </font>tfp_ftype<font color="#000080">);

</font><font color="#008000"><i>{---------------------------------------------------------}
{----Add Internal Function Packs                          }
{---------------------------------------------------------}

</i></font><font color="#FF0000"><b>PROCEDURE </b></font>Tfp_addgonio<font color="#000080">;
</font><font color="#FF0000"><b>PROCEDURE </b></font>Tfp_addlogic<font color="#000080">;
</font><font color="#FF0000"><b>PROCEDURE </b></font>Tfp_addmath<font color="#000080">;
</font><font color="#FF0000"><b>PROCEDURE </b></font>Tfp_addmisc<font color="#000080">;
</font><font color="#FF0000"><b>PROCEDURE </b></font>Tfp_addall<font color="#000080">;

</font><font color="#008000"><i>{---------------------------------------------------------}

</i></font><font color="#FF0000"><b>IMPLEMENTATION

TYPE
  </b></font>tfp_parse_state <font color="#000080">= </font><font color="#FF0000"><b>RECORD
                      </b></font>tfp_line     <font color="#000080">: </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">; </font><font color="#008000"><i>{----Copy of string to Parse   }
                      </i></font>tfp_lp       <font color="#000080">: </font>BYTE<font color="#000080">;   </font><font color="#008000"><i>{----Parsing Pointer into Line }
                      </i></font>tfp_nextchar <font color="#000080">: </font>CHAR<font color="#000080">;   </font><font color="#008000"><i>{----Character at Lp Postion   }
                     </i></font><font color="#FF0000"><b>END</b></font><font color="#000080">;

  </font>tfp_state_ptr   <font color="#000080">= ^</font>tfp_parse_state<font color="#000080">;

</font><font color="#FF0000"><b>CONST
  </b></font>tfp_maxreal     <font color="#000080">= +</font><font color="#800000">9.99999999e37</font><font color="#000080">;          </font><font color="#008000"><i>{----Internal maxreal                }
  </i></font>tfp_maxlongint  <font color="#000080">= </font>maxlongint<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">;       </font><font color="#008000"><i>{----Internal longint                }

</i></font><font color="#FF0000"><b>VAR
  </b></font>maxfie      <font color="#000080">: </font>INTEGER<font color="#000080">;                    </font><font color="#008000"><i>{----max no of functions &amp; vars      }
  </i></font>fiesiz      <font color="#000080">: </font>INTEGER<font color="#000080">;                    </font><font color="#008000"><i>{----current no of functions &amp; vars  }
  </i></font>p           <font color="#000080">: </font>tfp_state_ptr<font color="#000080">;          </font><font color="#008000"><i>{----Top level formula               }

</i></font><font color="#FF0000"><b>TYPE
  </b></font>tfp_fie_typ <font color="#000080">= </font><font color="#FF0000"><b>RECORD
                  </b></font>tfp_fname <font color="#000080">: </font>tfp_fname<font color="#000080">;</font><font color="#008000"><i>{----Name of function or var       }
                  </i></font>tfp_faddr <font color="#000080">: </font>POINTER<font color="#000080">;  </font><font color="#008000"><i>{----FAR POINTER to function or var}
                  </i></font>tfp_ftype <font color="#000080">: </font>tfp_ftype<font color="#000080">;</font><font color="#008000"><i>{----Type of entry                 }
                </i></font><font color="#FF0000"><b>END</b></font><font color="#000080">;

  </font>tfp_fieptr  <font color="#000080">= </font><font color="#FF0000"><b>ARRAY</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">1</font><font color="#000080">] </font><font color="#FF0000"><b>OF </b></font>tfp_fie_typ<font color="#000080">; </font><font color="#008000"><i>{----Open Array Construction   }

</i></font><font color="#FF0000"><b>VAR
  </b></font>fiearr      <font color="#000080">: ^</font>tfp_fieptr<font color="#000080">;                  </font><font color="#008000"><i>{----Array of functions &amp; vars     }

{---------------------------------------------------------}
{----Tricky stuff to call FUNCTIONS                       }
{    Idea from Borland's DataBase ToolKit                 }
{---------------------------------------------------------}

{$F+}

</i></font><font color="#FF0000"><b>VAR
  </b></font>glueptr <font color="#000080">: </font>POINTER<font color="#000080">;

</font><font color="#FF0000"><b>FUNCTION </b></font>Tfp_call_noparm <font color="#000080">: </font>REAL<font color="#000080">;

 </font><font color="#FF0000"><b>INLINE</b></font><font color="#000080">(</font><font color="#800000">$ff</font><font color="#000080">/</font><font color="#800000">$1e</font><font color="#000080">/</font>glueptr<font color="#000080">);  </font><font color="#008000"><i>{CALL DWORD PTR GluePtr}

</i></font><font color="#FF0000"><b>FUNCTION </b></font>Tfp_call_1real<font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>lu_r<font color="#000080">) : </font>REAL<font color="#000080">;

 </font><font color="#FF0000"><b>INLINE</b></font><font color="#000080">(</font><font color="#800000">$ff</font><font color="#000080">/</font><font color="#800000">$1e</font><font color="#000080">/</font>glueptr<font color="#000080">);  </font><font color="#008000"><i>{CALL DWORD PTR GluePtr}

</i></font><font color="#FF0000"><b>FUNCTION </b></font>Tfp_call_2real<font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>lu_r1<font color="#000080">,</font>lu_r2<font color="#000080">) : </font>REAL<font color="#000080">;

 </font><font color="#FF0000"><b>INLINE</b></font><font color="#000080">(</font><font color="#800000">$ff</font><font color="#000080">/</font><font color="#800000">$1e</font><font color="#000080">/</font>glueptr<font color="#000080">);  </font><font color="#008000"><i>{CALL DWORD PTR GluePtr}

</i></font><font color="#FF0000"><b>FUNCTION </b></font>Tfp_call_nreal<font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>lu_r<font color="#000080">,</font>lu_n<font color="#000080">) : </font>REAL<font color="#000080">;

 </font><font color="#FF0000"><b>INLINE</b></font><font color="#000080">(</font><font color="#800000">$ff</font><font color="#000080">/</font><font color="#800000">$1e</font><font color="#000080">/</font>glueptr<font color="#000080">);  </font><font color="#008000"><i>{CALL DWORD PTR GluePtr}

{$F-}

{---------------------------------------------------------}
{----TP round function not useable                        }
{---------------------------------------------------------}

</i></font><font color="#FF0000"><b>FUNCTION </b></font>Tfp_round<font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>r <font color="#000080">: </font>REAL<font color="#000080">) : </font>LONGINT<font color="#000080">;

</font><font color="#FF0000"><b>BEGIN
  IF </b></font><font color="#000080">(</font>r<font color="#000080">&lt;</font><font color="#800000">0</font><font color="#000080">)
    </font><font color="#FF0000"><b>THEN </b></font>Tfp_round<font color="#000080">:= </font>Trunc<font color="#000080">(</font>r <font color="#000080">- </font><font color="#800000">0.5</font><font color="#000080">)
    </font><font color="#FF0000"><b>ELSE </b></font>Tfp_round<font color="#000080">:= </font>Trunc<font color="#000080">(</font>r <font color="#000080">+ </font><font color="#800000">0.5</font><font color="#000080">);
</font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>{of Tfp_round}

{---------------------------------------------------------}
{----This routine set the tfp_ernr if not set already     }
{---------------------------------------------------------}

</i></font><font color="#FF0000"><b>PROCEDURE </b></font>Tfp_seternr<font color="#000080">(</font>ernr <font color="#000080">: </font>INTEGER<font color="#000080">);

</font><font color="#FF0000"><b>BEGIN
  IF </b></font><font color="#000080">(</font>tfp_ernr<font color="#000080">=</font><font color="#800000">0</font><font color="#000080">)
    </font><font color="#FF0000"><b>THEN
      BEGIN
        </b></font>tfp_erpos<font color="#000080">:=</font>p<font color="#000080">^.</font>tfp_lp<font color="#000080">;
        </font>tfp_ernr <font color="#000080">:=</font>ernr<font color="#000080">;
      </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>{of Tfp_Seternr}

{---------------------------------------------------------}
{----This routine skips one character                     }
{---------------------------------------------------------}

</i></font><font color="#FF0000"><b>PROCEDURE </b></font>Tfp_newchar<font color="#000080">(</font>p <font color="#000080">: </font>tfp_state_ptr<font color="#000080">);

</font><font color="#FF0000"><b>BEGIN
  WITH </b></font>p<font color="#000080">^ </font><font color="#FF0000"><b>DO
    BEGIN
      IF </b></font><font color="#000080">(</font>tfp_lp<font color="#000080">&lt;</font>Length<font color="#000080">(</font>tfp_line<font color="#000080">))
        </font><font color="#FF0000"><b>THEN </b></font>Inc<font color="#000080">(</font>tfp_lp<font color="#000080">);
      </font>tfp_nextchar<font color="#000080">:=</font>Upcase<font color="#000080">(</font>tfp_line<font color="#000080">[</font>tfp_lp<font color="#000080">]);
    </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>{of Tfp_Newchar}

{---------------------------------------------------------}
{----This routine skips one character and                 }
{    all folowing spaces from an expression               }
{---------------------------------------------------------}

</i></font><font color="#FF0000"><b>PROCEDURE </b></font>Tfp_skip<font color="#000080">(</font>p <font color="#000080">: </font>tfp_state_ptr<font color="#000080">);

</font><font color="#FF0000"><b>BEGIN
  WITH </b></font>p<font color="#000080">^ </font><font color="#FF0000"><b>DO
    REPEAT
      </b></font>Tfp_newchar<font color="#000080">(</font>p<font color="#000080">);
    </font><font color="#FF0000"><b>UNTIL </b></font><font color="#000080">(</font>tfp_nextchar<font color="#000080">&lt;&gt;</font><font color="#800000">' '</font><font color="#000080">);
</font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>{of Tfp_Skip}

{---------------------------------------------------------}
{----This Routine does some trivial check &amp;               }
{    Inits Tfp_State_Ptr^                                   }
{---------------------------------------------------------}

</i></font><font color="#FF0000"><b>PROCEDURE </b></font>Tfp_check<font color="#000080">(</font>s <font color="#000080">: </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">;</font>p <font color="#000080">: </font>tfp_state_ptr<font color="#000080">);

</font><font color="#FF0000"><b>VAR
  </b></font>i<font color="#000080">,</font>j        <font color="#000080">: </font>INTEGER<font color="#000080">;

</font><font color="#FF0000"><b>BEGIN
  WITH </b></font>p<font color="#000080">^ </font><font color="#FF0000"><b>DO
    BEGIN
       </b></font>tfp_lp<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;

    </font><font color="#008000"><i>{----Test for match on numbers of ( and ) }
      </i></font>j<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
      </font><font color="#FF0000"><b>FOR </b></font>i<font color="#000080">:=</font><font color="#800000">1 </font><font color="#FF0000"><b>TO </b></font>Length<font color="#000080">(</font>s<font color="#000080">) </font><font color="#FF0000"><b>DO
        CASE </b></font>s<font color="#000080">[</font>i<font color="#000080">] </font><font color="#FF0000"><b>OF
          </b></font><font color="#800000">'(' </font><font color="#000080">: </font>Inc<font color="#000080">(</font>j<font color="#000080">);
          </font><font color="#800000">')' </font><font color="#000080">: </font>Dec<font color="#000080">(</font>j<font color="#000080">);
        </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

      </font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>j<font color="#000080">=</font><font color="#800000">0</font><font color="#000080">)
        </font><font color="#FF0000"><b>THEN
        </b></font><font color="#008000"><i>{----Continue init}
          </i></font><font color="#FF0000"><b>BEGIN
          </b></font><font color="#008000"><i>{----Add a CHR(0) as an EOLN marker}
            </i></font>tfp_line<font color="#000080">:=</font>s<font color="#000080">+</font><font color="#800000">#00</font><font color="#000080">;
            </font>Tfp_skip<font color="#000080">(</font>p<font color="#000080">);

          </font><font color="#008000"><i>{----Try parsing if any characters left}
            </i></font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>tfp_line<font color="#000080">[</font>tfp_lp<font color="#000080">]=</font><font color="#800000">#00</font><font color="#000080">) </font><font color="#FF0000"><b>THEN </b></font>Tfp_seternr<font color="#000080">(</font><font color="#800000">6</font><font color="#000080">);
          </font><font color="#FF0000"><b>END
      ELSE </b></font>Tfp_seternr<font color="#000080">(</font><font color="#800000">3</font><font color="#000080">);
    </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>{of Tfp_Check}

{---------------------------------------------------------}
{  Number     = Real    (Bv 23.4E-5)                      }
{               Integer (Bv -45)                          }
{---------------------------------------------------------}

</i></font><font color="#FF0000"><b>FUNCTION </b></font>Tfp_eval_number<font color="#000080">(</font>p <font color="#000080">: </font>tfp_state_ptr<font color="#000080">) : </font>REAL<font color="#000080">;

</font><font color="#FF0000"><b>VAR
  </b></font>temp  <font color="#000080">: </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">;
  </font>err   <font color="#000080">: </font>INTEGER<font color="#000080">;
  </font>value <font color="#000080">: </font>REAL<font color="#000080">;

</font><font color="#FF0000"><b>BEGIN
  WITH </b></font>p<font color="#000080">^ </font><font color="#FF0000"><b>DO
    BEGIN
    </b></font><font color="#008000"><i>{----Correct .xx to 0.xx}
      </i></font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>tfp_nextchar<font color="#000080">=</font><font color="#800000">'.'</font><font color="#000080">)
        </font><font color="#FF0000"><b>THEN </b></font>temp<font color="#000080">:=</font><font color="#800000">'0'</font><font color="#000080">+</font>tfp_nextchar
        <font color="#FF0000"><b>ELSE </b></font>temp<font color="#000080">:=</font>tfp_nextchar<font color="#000080">;

      </font>Tfp_newchar<font color="#000080">(</font>p<font color="#000080">);

    </font><font color="#008000"><i>{----Correct &ntilde;.xx to &ntilde;0.xx}
      </i></font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>Length<font color="#000080">(</font>temp<font color="#000080">)=</font><font color="#800000">1</font><font color="#000080">) </font><font color="#FF0000"><b>AND
         </b></font><font color="#000080">(</font>temp<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">] </font><font color="#FF0000"><b>IN </b></font><font color="#000080">[</font><font color="#800000">'+'</font><font color="#000080">,</font><font color="#800000">'-'</font><font color="#000080">]) </font><font color="#FF0000"><b>AND
         </b></font><font color="#000080">(</font>tfp_nextchar<font color="#000080">=</font><font color="#800000">'.'</font><font color="#000080">)
        </font><font color="#FF0000"><b>THEN </b></font>temp<font color="#000080">:=</font>temp<font color="#000080">+</font><font color="#800000">'0'</font><font color="#000080">;

      </font><font color="#FF0000"><b>WHILE </b></font>tfp_nextchar <font color="#FF0000"><b>IN </b></font><font color="#000080">[</font><font color="#800000">'0'</font><font color="#000080">..</font><font color="#800000">'9'</font><font color="#000080">,</font><font color="#800000">'.'</font><font color="#000080">,</font><font color="#800000">'E'</font><font color="#000080">] </font><font color="#FF0000"><b>DO
        BEGIN
          </b></font>temp<font color="#000080">:=</font>temp<font color="#000080">+</font>tfp_nextchar<font color="#000080">;
          </font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>tfp_nextchar<font color="#000080">=</font><font color="#800000">'E'</font><font color="#000080">)
            </font><font color="#FF0000"><b>THEN
              BEGIN
              </b></font><font color="#008000"><i>{----Correct &ntilde;xxx.E to &ntilde;xxx.0E}
                </i></font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>temp<font color="#000080">[</font>Length<font color="#000080">(</font>temp<font color="#000080">)-</font><font color="#800000">1</font><font color="#000080">]=</font><font color="#800000">'.'</font><font color="#000080">)
                  </font><font color="#FF0000"><b>THEN </b></font>Insert<font color="#000080">(</font><font color="#800000">'0'</font><font color="#000080">,</font>temp<font color="#000080">,</font>Length<font color="#000080">(</font>temp<font color="#000080">));
                </font>Tfp_newchar<font color="#000080">(</font>p<font color="#000080">);
                </font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>tfp_nextchar <font color="#FF0000"><b>IN </b></font><font color="#000080">[</font><font color="#800000">'+'</font><font color="#000080">,</font><font color="#800000">'-'</font><font color="#000080">])
                  </font><font color="#FF0000"><b>THEN
                    BEGIN
                      </b></font>temp<font color="#000080">:=</font>temp<font color="#000080">+</font>tfp_nextchar<font color="#000080">;
                      </font>Tfp_newchar<font color="#000080">(</font>p<font color="#000080">);
                    </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
              </font><font color="#FF0000"><b>END
            ELSE </b></font>Tfp_newchar<font color="#000080">(</font>p<font color="#000080">);
        </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

    </font><font color="#008000"><i>{----Skip trailing spaces}
      </i></font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>tfp_nextchar<font color="#000080">=</font><font color="#800000">' '</font><font color="#000080">)
        </font><font color="#FF0000"><b>THEN </b></font>Tfp_skip<font color="#000080">(</font>p<font color="#000080">);

    </font><font color="#008000"><i>{----Correct &ntilde;xx. to &ntilde;xx.0 but NOT &ntilde;xxE&ntilde;yy.}
      </i></font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>temp<font color="#000080">[</font>Length<font color="#000080">(</font>temp<font color="#000080">)]=</font><font color="#800000">'.'</font><font color="#000080">) </font><font color="#FF0000"><b>AND
         </b></font><font color="#000080">(</font>Pos<font color="#000080">(</font><font color="#800000">'E'</font><font color="#000080">,</font>temp<font color="#000080">)=</font><font color="#800000">0</font><font color="#000080">)
        </font><font color="#FF0000"><b>THEN </b></font>temp<font color="#000080">:=</font>temp<font color="#000080">+</font><font color="#800000">'0'</font><font color="#000080">;

      </font>Val<font color="#000080">(</font>temp<font color="#000080">,</font>value<font color="#000080">,</font>err<font color="#000080">);

      </font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>err<font color="#000080">&lt;&gt;</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>THEN </b></font>Tfp_seternr<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">);
    </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>tfp_ernr<font color="#000080">=</font><font color="#800000">0</font><font color="#000080">)
    </font><font color="#FF0000"><b>THEN </b></font>Tfp_eval_number<font color="#000080">:=</font>value
    <font color="#FF0000"><b>ELSE </b></font>Tfp_eval_number<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;

</font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>{of Tfp_Eval_Number}

{---------------------------------------------------------}
{  Factor     = Number                                    }
{    (External) Function()                                }
{    (External) Function(Expr)                            }
{    (External) Function(Expr,Expr)                       }
{     External  Var Real                                  }
{     External  Var Integer                               }
{     External  Var Boolean                               }
{     External  Var realstring                            }
{               (R_Expr)                                  }
{---------------------------------------------------------}

</i></font><font color="#FF0000"><b>FUNCTION </b></font>Tfp_eval_b_expr<font color="#000080">(</font>p <font color="#000080">: </font>tfp_state_ptr<font color="#000080">) : </font>REAL<font color="#000080">; </font><font color="#FF0000"><b>forward</b></font><font color="#000080">;

</font><font color="#FF0000"><b>FUNCTION </b></font>Tfp_eval_factor<font color="#000080">(</font>p <font color="#000080">: </font>tfp_state_ptr<font color="#000080">) : </font>REAL<font color="#000080">;

</font><font color="#FF0000"><b>VAR
  </b></font>ferr     <font color="#000080">: </font>BOOLEAN<font color="#000080">;
  </font>param    <font color="#000080">: </font>INTEGER<font color="#000080">;
  </font>dummy    <font color="#000080">: </font>tfp_rarray<font color="#000080">;
  </font>value<font color="#000080">,
  </font>dummy1<font color="#000080">,
  </font>dummy2   <font color="#000080">: </font>REAL<font color="#000080">;
  </font>temp     <font color="#000080">: </font>tfp_fname<font color="#000080">;
  </font>e<font color="#000080">,
  </font>i<font color="#000080">,
  </font>index    <font color="#000080">: </font>INTEGER<font color="#000080">;
  </font>temps    <font color="#000080">: </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">;
  </font>tmpstate <font color="#000080">: </font>tfp_state_ptr<font color="#000080">;

</font><font color="#FF0000"><b>BEGIN
  WITH </b></font>p<font color="#000080">^ </font><font color="#FF0000"><b>DO
    CASE </b></font>tfp_nextchar <font color="#FF0000"><b>OF
      </b></font><font color="#800000">'+' </font><font color="#000080">: </font><font color="#FF0000"><b>BEGIN
              </b></font>Tfp_newchar<font color="#000080">(</font>p<font color="#000080">);
              </font>value<font color="#000080">:=+</font>Tfp_eval_factor<font color="#000080">(</font>p<font color="#000080">);
            </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

      </font><font color="#800000">'-' </font><font color="#000080">: </font><font color="#FF0000"><b>BEGIN
              </b></font>Tfp_newchar<font color="#000080">(</font>p<font color="#000080">);
              </font>value<font color="#000080">:=-</font>Tfp_eval_factor<font color="#000080">(</font>p<font color="#000080">);
            </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

      </font><font color="#800000">'0'</font><font color="#000080">..
      </font><font color="#800000">'9'</font><font color="#000080">,
      </font><font color="#800000">'.' </font><font color="#000080">: </font>value<font color="#000080">:=</font>Tfp_eval_number<font color="#000080">(</font>p<font color="#000080">);

      </font><font color="#800000">'A'</font><font color="#000080">..
      </font><font color="#800000">'Z' </font><font color="#000080">: </font><font color="#FF0000"><b>BEGIN
              </b></font>ferr<font color="#000080">:=</font>true<font color="#000080">;
              </font>temp<font color="#000080">:=</font>tfp_nextchar<font color="#000080">;
              </font>Tfp_skip<font color="#000080">(</font>p<font color="#000080">);
              </font><font color="#FF0000"><b>WHILE </b></font>tfp_nextchar <font color="#FF0000"><b>IN </b></font><font color="#000080">[</font><font color="#800000">'0'</font><font color="#000080">..</font><font color="#800000">'9'</font><font color="#000080">,</font><font color="#800000">'_'</font><font color="#000080">,</font><font color="#800000">'A'</font><font color="#000080">..</font><font color="#800000">'Z'</font><font color="#000080">] </font><font color="#FF0000"><b>DO
                BEGIN
                  </b></font>temp<font color="#000080">:=</font>temp<font color="#000080">+</font>tfp_nextchar<font color="#000080">;
                  </font>Tfp_skip<font color="#000080">(</font>p<font color="#000080">);
                </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

            </font><font color="#008000"><i>{----Seek function and CALL it}
              {$R-}
              </i></font><font color="#FF0000"><b>FOR </b></font>index<font color="#000080">:=</font><font color="#800000">1 </font><font color="#FF0000"><b>TO </b></font>fiesiz <font color="#FF0000"><b>DO
                WITH </b></font>fiearr<font color="#000080">^[</font>index<font color="#000080">] </font><font color="#FF0000"><b>DO
                  IF </b></font><font color="#000080">(</font>tfp_fname<font color="#000080">=</font>temp<font color="#000080">) </font><font color="#FF0000"><b>THEN
                    BEGIN
                      </b></font>ferr<font color="#000080">:=</font>false<font color="#000080">;

                      </font><font color="#FF0000"><b>CASE </b></font>tfp_ftype <font color="#FF0000"><b>OF

                      </b></font><font color="#008000"><i>{----Function or Function()}
                        </i></font>tfp_noparm <font color="#000080">: </font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>tfp_nextchar<font color="#000080">=</font><font color="#800000">'('</font><font color="#000080">)
                                       </font><font color="#FF0000"><b>THEN
                                         BEGIN
                                           </b></font>Tfp_skip<font color="#000080">(</font>p<font color="#000080">);

                                           </font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>tfp_nextchar<font color="#000080">&lt;&gt;</font><font color="#800000">')'</font><font color="#000080">)
                                             </font><font color="#FF0000"><b>THEN </b></font>Tfp_seternr<font color="#000080">(</font><font color="#800000">14</font><font color="#000080">);

                                           </font>Tfp_skip<font color="#000080">(</font>p<font color="#000080">);
                                         </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

                      </font><font color="#008000"><i>{----Function(r)}
                        </i></font>tfp_1real  <font color="#000080">: </font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>tfp_nextchar<font color="#000080">=</font><font color="#800000">'('</font><font color="#000080">)
                                       </font><font color="#FF0000"><b>THEN
                                         BEGIN
                                           </b></font>Tfp_skip<font color="#000080">(</font>p<font color="#000080">);

                                           </font>dummy1<font color="#000080">:=</font>Tfp_eval_b_expr<font color="#000080">(</font>p<font color="#000080">);

                                           </font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>tfp_ernr<font color="#000080">=</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>AND
                                              </b></font><font color="#000080">(</font>tfp_nextchar<font color="#000080">&lt;&gt;</font><font color="#800000">')'</font><font color="#000080">)
                                             </font><font color="#FF0000"><b>THEN </b></font>Tfp_seternr<font color="#000080">(</font><font color="#800000">14</font><font color="#000080">);

                                           </font>Tfp_skip<font color="#000080">(</font>p<font color="#000080">); </font><font color="#008000"><i>{----Dump the ')'}
                                         </i></font><font color="#FF0000"><b>END
                                       ELSE </b></font>Tfp_seternr<font color="#000080">(</font><font color="#800000">14</font><font color="#000080">);

                      </font><font color="#008000"><i>{----Function(r1,r2)}
                        </i></font>tfp_2real  <font color="#000080">: </font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>tfp_nextchar<font color="#000080">=</font><font color="#800000">'('</font><font color="#000080">)
                                       </font><font color="#FF0000"><b>THEN
                                         BEGIN
                                           </b></font>Tfp_skip<font color="#000080">(</font>p<font color="#000080">);

                                           </font>dummy1<font color="#000080">:=</font>Tfp_eval_b_expr<font color="#000080">(</font>p<font color="#000080">);

                                           </font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>tfp_ernr<font color="#000080">=</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>AND
                                              </b></font><font color="#000080">(</font>tfp_nextchar<font color="#000080">&lt;&gt;</font><font color="#800000">','</font><font color="#000080">)
                                             </font><font color="#FF0000"><b>THEN </b></font>Tfp_seternr<font color="#000080">(</font><font color="#800000">14</font><font color="#000080">);

                                           </font>Tfp_skip<font color="#000080">(</font>p<font color="#000080">); </font><font color="#008000"><i>{----Dump the ','}
                                           </i></font>dummy2<font color="#000080">:=</font>Tfp_eval_b_expr<font color="#000080">(</font>p<font color="#000080">);

                                            </font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>tfp_ernr<font color="#000080">=</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>AND
                                               </b></font><font color="#000080">(</font>tfp_nextchar<font color="#000080">&lt;&gt;</font><font color="#800000">')'</font><font color="#000080">)
                                              </font><font color="#FF0000"><b>THEN </b></font>Tfp_seternr<font color="#000080">(</font><font color="#800000">14</font><font color="#000080">);

                                            </font>Tfp_skip<font color="#000080">(</font>p<font color="#000080">); </font><font color="#008000"><i>{----Dump the ')'}
                                          </i></font><font color="#FF0000"><b>END
                                        ELSE </b></font>Tfp_seternr<font color="#000080">(</font><font color="#800000">14</font><font color="#000080">);

                      </font><font color="#008000"><i>{----Function(r,n)}
                        </i></font>tfp_nreal <font color="#000080">: </font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>tfp_nextchar<font color="#000080">=</font><font color="#800000">'('</font><font color="#000080">)
                                      </font><font color="#FF0000"><b>THEN
                                        BEGIN
                                          </b></font>param<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;

                                          </font>Tfp_skip<font color="#000080">(</font>p<font color="#000080">);
                                          </font>dummy<font color="#000080">[</font>param<font color="#000080">]:=</font>Tfp_eval_b_expr<font color="#000080">(</font>p<font color="#000080">);

                                          </font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>tfp_ernr<font color="#000080">=</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>AND
                                             </b></font><font color="#000080">(</font>tfp_nextchar<font color="#000080">&lt;&gt;</font><font color="#800000">','</font><font color="#000080">)
                                            </font><font color="#FF0000"><b>THEN </b></font>Tfp_seternr<font color="#000080">(</font><font color="#800000">14</font><font color="#000080">)
                                            </font><font color="#FF0000"><b>ELSE
                                              WHILE </b></font><font color="#000080">(</font>tfp_ernr<font color="#000080">=</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>AND
                                                    </b></font><font color="#000080">(</font>tfp_nextchar<font color="#000080">=</font><font color="#800000">','</font><font color="#000080">) </font><font color="#FF0000"><b>AND
                                                    </b></font><font color="#000080">(</font>param<font color="#000080">&lt;</font>tfp_maxparm<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">) </font><font color="#FF0000"><b>DO
                                                BEGIN
                                                  </b></font>Tfp_skip<font color="#000080">(</font>p<font color="#000080">); </font><font color="#008000"><i>{----Dump the ','}
                                                  </i></font>Inc<font color="#000080">(</font>param<font color="#000080">);
                                                  </font>dummy<font color="#000080">[</font>param<font color="#000080">]:=</font>Tfp_eval_b_expr<font color="#000080">(</font>p<font color="#000080">);
                                                </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

                                          </font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>tfp_ernr<font color="#000080">=</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>AND
                                             </b></font><font color="#000080">(</font>tfp_nextchar<font color="#000080">&lt;&gt;</font><font color="#800000">')'</font><font color="#000080">)
                                            </font><font color="#FF0000"><b>THEN </b></font>Tfp_seternr<font color="#000080">(</font><font color="#800000">14</font><font color="#000080">);

                                          </font>Tfp_skip<font color="#000080">(</font>p<font color="#000080">); </font><font color="#008000"><i>{----Dump the ')'}
                                        </i></font><font color="#FF0000"><b>END
                                      ELSE </b></font>Tfp_seternr<font color="#000080">(</font><font color="#800000">14</font><font color="#000080">);

                      </font><font color="#008000"><i>{----Real Var}
                        </i></font>tfp_realvar <font color="#000080">: </font>dummy1<font color="#000080">:=</font>REAL<font color="#000080">(</font>tfp_faddr<font color="#000080">^);

                      </font><font color="#008000"><i>{----Integer Var}
                        </i></font>tfp_intvar  <font color="#000080">: </font>dummy1<font color="#000080">:=</font><font color="#800000">1.0</font><font color="#000080">*</font>INTEGER<font color="#000080">(</font>tfp_faddr<font color="#000080">^);

                      </font><font color="#008000"><i>{----Boolean Var}
                        </i></font>tfp_boolvar <font color="#000080">: </font>dummy1<font color="#000080">:=</font><font color="#800000">1.0</font><font color="#000080">*</font>Ord<font color="#000080">(</font>BOOLEAN<font color="#000080">(</font>tfp_faddr<font color="#000080">^));

                      </font><font color="#008000"><i>{----Real string Var}
                        </i></font>tfp_strvar  <font color="#000080">: </font><font color="#FF0000"><b>BEGIN
                                        </b></font>temps<font color="#000080">:=</font><font color="#FF0000"><b>STRING</b></font><font color="#000080">(</font>tfp_faddr<font color="#000080">^);
                                        </font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>Maxavail<font color="#000080">&gt;=</font>Sizeof<font color="#000080">(</font>tfp_parse_state<font color="#000080">))
                                          </font><font color="#FF0000"><b>THEN
                                            BEGIN
                                              </b></font>New<font color="#000080">(</font>tmpstate<font color="#000080">);
                                              </font>Tfp_check<font color="#000080">(</font>temps<font color="#000080">,</font>tmpstate<font color="#000080">);
                                              </font>dummy1<font color="#000080">:=</font>Tfp_eval_b_expr<font color="#000080">(</font>tmpstate<font color="#000080">);
                                              </font>Dispose<font color="#000080">(</font>tmpstate<font color="#000080">);
                                            </font><font color="#FF0000"><b>END
                                          ELSE </b></font>Tfp_seternr<font color="#000080">(</font><font color="#800000">15</font><font color="#000080">);
                                      </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
                      </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

                      </font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>tfp_ernr<font color="#000080">=</font><font color="#800000">0</font><font color="#000080">)
                        </font><font color="#FF0000"><b>THEN
                          BEGIN
                            </b></font>glueptr<font color="#000080">:=</font>tfp_faddr<font color="#000080">;

                            </font><font color="#FF0000"><b>CASE </b></font>tfp_ftype <font color="#FF0000"><b>OF
                              </b></font>tfp_noparm  <font color="#000080">: </font>value<font color="#000080">:=</font>Tfp_call_noparm<font color="#000080">;
                              </font>tfp_1real   <font color="#000080">: </font>value<font color="#000080">:=</font>Tfp_call_1real<font color="#000080">(</font>dummy1<font color="#000080">);
                              </font>tfp_2real   <font color="#000080">: </font>value<font color="#000080">:=</font>Tfp_call_2real<font color="#000080">(</font>dummy1<font color="#000080">,</font>dummy2<font color="#000080">);
                              </font>tfp_nreal   <font color="#000080">: </font>value<font color="#000080">:=</font>Tfp_call_nreal<font color="#000080">(</font>dummy<font color="#000080">,</font>param<font color="#000080">);
                              </font>tfp_realvar<font color="#000080">,
                              </font>tfp_intvar<font color="#000080">,
                              </font>tfp_boolvar<font color="#000080">,
                              </font>tfp_strvar  <font color="#000080">: </font>value<font color="#000080">:=</font>dummy1<font color="#000080">;
                            </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
                          </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
                    </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
              </font><font color="#008000"><i>{$R+}

              </i></font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>ferr<font color="#000080">=</font>true<font color="#000080">)
                </font><font color="#FF0000"><b>THEN </b></font>Tfp_seternr<font color="#000080">(</font><font color="#800000">2</font><font color="#000080">);
            </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

      </font><font color="#800000">'(' </font><font color="#000080">: </font><font color="#FF0000"><b>BEGIN
              </b></font>Tfp_skip<font color="#000080">(</font>p<font color="#000080">);

              </font>value<font color="#000080">:=</font>Tfp_eval_b_expr<font color="#000080">(</font>p<font color="#000080">);

              </font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>tfp_ernr<font color="#000080">=</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>AND
                 </b></font><font color="#000080">(</font>tfp_nextchar<font color="#000080">&lt;&gt;</font><font color="#800000">')'</font><font color="#000080">)
                </font><font color="#FF0000"><b>THEN </b></font>Tfp_seternr<font color="#000080">(</font><font color="#800000">3</font><font color="#000080">);

              </font>Tfp_skip<font color="#000080">(</font>p<font color="#000080">); </font><font color="#008000"><i>{----Dump the ')'}
            </i></font><font color="#FF0000"><b>END</b></font><font color="#000080">;

    </font><font color="#FF0000"><b>ELSE </b></font>Tfp_seternr<font color="#000080">(</font><font color="#800000">2</font><font color="#000080">);
    </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>tfp_ernr<font color="#000080">=</font><font color="#800000">0</font><font color="#000080">)
    </font><font color="#FF0000"><b>THEN </b></font>Tfp_eval_factor<font color="#000080">:=</font>value
    <font color="#FF0000"><b>ELSE </b></font>Tfp_eval_factor<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;

</font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>{of Tfp_Eval_factor}

{---------------------------------------------------------}
{  Term       = Factor ^ Factor                           }
{---------------------------------------------------------}

</i></font><font color="#FF0000"><b>FUNCTION </b></font>Tfp_eval_term<font color="#000080">(</font>p <font color="#000080">: </font>tfp_state_ptr<font color="#000080">) : </font>REAL<font color="#000080">;

</font><font color="#FF0000"><b>VAR
  </b></font>value<font color="#000080">,
  </font>exponent<font color="#000080">,
  </font>dummy<font color="#000080">,
  </font>base      <font color="#000080">: </font>REAL<font color="#000080">;

</font><font color="#FF0000"><b>BEGIN
  WITH </b></font>p<font color="#000080">^ </font><font color="#FF0000"><b>DO
    BEGIN
      </b></font>value<font color="#000080">:=</font>Tfp_eval_factor<font color="#000080">(</font>p<font color="#000080">);

      </font><font color="#FF0000"><b>WHILE </b></font><font color="#000080">(</font>tfp_ernr<font color="#000080">=</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>AND </b></font><font color="#000080">(</font>tfp_nextchar<font color="#000080">=</font><font color="#800000">'^'</font><font color="#000080">) </font><font color="#FF0000"><b>DO
        BEGIN
          </b></font>Tfp_skip<font color="#000080">(</font>p<font color="#000080">);

          </font>exponent<font color="#000080">:=</font>Tfp_eval_factor<font color="#000080">(</font>p<font color="#000080">);

          </font>base<font color="#000080">:=</font>value<font color="#000080">;
          </font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>tfp_ernr<font color="#000080">=</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>AND </b></font><font color="#000080">(</font>base<font color="#000080">=</font><font color="#800000">0</font><font color="#000080">)
            </font><font color="#FF0000"><b>THEN </b></font>value<font color="#000080">:=</font><font color="#800000">0
            </font><font color="#FF0000"><b>ELSE
              BEGIN

              </b></font><font color="#008000"><i>{----Over/Underflow Protected}
                </i></font>dummy<font color="#000080">:=</font>exponent<font color="#000080">*</font>Ln<font color="#000080">(</font>Abs<font color="#000080">(</font>base<font color="#000080">));
                </font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>dummy<font color="#000080">&lt;=</font>Ln<font color="#000080">(</font>tfp_maxreal<font color="#000080">))
                   </font><font color="#FF0000"><b>THEN </b></font>value<font color="#000080">:=</font>Exp<font color="#000080">(</font>dummy<font color="#000080">)
                   </font><font color="#FF0000"><b>ELSE </b></font>Tfp_seternr<font color="#000080">(</font><font color="#800000">11</font><font color="#000080">);
              </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

          </font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>tfp_ernr<font color="#000080">=</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>AND </b></font><font color="#000080">(</font>base<font color="#000080">&lt;</font><font color="#800000">0</font><font color="#000080">)
            </font><font color="#FF0000"><b>THEN
              BEGIN
              </b></font><font color="#008000"><i>{----Allow only whole number exponents,
                   others will result in complex numbers}
                </i></font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>Int<font color="#000080">(</font>exponent<font color="#000080">)&lt;&gt;</font>exponent<font color="#000080">)
                  </font><font color="#FF0000"><b>THEN </b></font>Tfp_seternr<font color="#000080">(</font><font color="#800000">4</font><font color="#000080">);

                </font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>tfp_ernr<font color="#000080">=</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>AND </b></font>Odd<font color="#000080">(</font>Tfp_round<font color="#000080">(</font>exponent<font color="#000080">))
                  </font><font color="#FF0000"><b>THEN </b></font>value<font color="#000080">:=-</font>value<font color="#000080">;
              </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
        </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>tfp_ernr<font color="#000080">=</font><font color="#800000">0</font><font color="#000080">)
    </font><font color="#FF0000"><b>THEN </b></font>Tfp_eval_term<font color="#000080">:=</font>value
    <font color="#FF0000"><b>ELSE </b></font>Tfp_eval_term<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;

</font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>{of Tfp_Eval_term}

{---------------------------------------------------------}
{----Subterm  = Term * Term                               }
{               Term / Term                               }
{---------------------------------------------------------}

</i></font><font color="#FF0000"><b>FUNCTION </b></font>Tfp_eval_subterm<font color="#000080">(</font>p <font color="#000080">: </font>tfp_state_ptr<font color="#000080">) : </font>REAL<font color="#000080">;

</font><font color="#FF0000"><b>VAR
  </b></font>value<font color="#000080">,
  </font>dummy  <font color="#000080">: </font>REAL<font color="#000080">;

</font><font color="#FF0000"><b>BEGIN
  WITH </b></font>p<font color="#000080">^ </font><font color="#FF0000"><b>DO
    BEGIN
      </b></font>value<font color="#000080">:=</font>Tfp_eval_term<font color="#000080">(</font>p<font color="#000080">);

      </font><font color="#FF0000"><b>WHILE </b></font><font color="#000080">(</font>tfp_ernr<font color="#000080">=</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>AND </b></font><font color="#000080">(</font>tfp_nextchar <font color="#FF0000"><b>IN </b></font><font color="#000080">[</font><font color="#800000">'*'</font><font color="#000080">,</font><font color="#800000">'/'</font><font color="#000080">]) </font><font color="#FF0000"><b>DO
        CASE </b></font>tfp_nextchar <font color="#FF0000"><b>OF

        </b></font><font color="#008000"><i>{----Over/Underflow Protected}
          </i></font><font color="#800000">'*' </font><font color="#000080">: </font><font color="#FF0000"><b>BEGIN
                  </b></font>Tfp_skip<font color="#000080">(</font>p<font color="#000080">);

                  </font>dummy<font color="#000080">:=</font>Tfp_eval_term<font color="#000080">(</font>p<font color="#000080">);

                  </font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>tfp_ernr<font color="#000080">&lt;&gt;</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>OR
                     </b></font><font color="#000080">(</font>value<font color="#000080">=</font><font color="#800000">0</font><font color="#000080">)     </font><font color="#FF0000"><b>OR
                     </b></font><font color="#000080">(</font>dummy<font color="#000080">=</font><font color="#800000">0</font><font color="#000080">)
                    </font><font color="#FF0000"><b>THEN </b></font>value<font color="#000080">:=</font><font color="#800000">0
                    </font><font color="#FF0000"><b>ELSE
                      IF </b></font><font color="#000080">(</font>Abs<font color="#000080">( </font>Ln<font color="#000080">(</font>Abs<font color="#000080">(</font>value<font color="#000080">)) +
                          </font>Ln<font color="#000080">(</font>Abs<font color="#000080">(</font>dummy<font color="#000080">)) ) &lt; </font>Ln<font color="#000080">(</font>tfp_maxreal<font color="#000080">))
                        </font><font color="#FF0000"><b>THEN </b></font>value<font color="#000080">:= </font>value <font color="#000080">* </font>dummy
                        <font color="#FF0000"><b>ELSE </b></font>Tfp_seternr<font color="#000080">(</font><font color="#800000">11</font><font color="#000080">);
                </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

        </font><font color="#008000"><i>{----Over/Underflow Protected}
          </i></font><font color="#800000">'/' </font><font color="#000080">: </font><font color="#FF0000"><b>BEGIN
                  </b></font>Tfp_skip<font color="#000080">(</font>p<font color="#000080">);

                  </font>dummy<font color="#000080">:=</font>Tfp_eval_term<font color="#000080">(</font>p<font color="#000080">);

                  </font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>tfp_ernr<font color="#000080">=</font><font color="#800000">0</font><font color="#000080">)
                    </font><font color="#FF0000"><b>THEN
                      BEGIN

                      </b></font><font color="#008000"><i>{----Division by ZERO Protected}
                        </i></font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>dummy<font color="#000080">&lt;&gt;</font><font color="#800000">0</font><font color="#000080">)
                          </font><font color="#FF0000"><b>THEN
                            BEGIN

                            </b></font><font color="#008000"><i>{----Underflow Protected}
                              </i></font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>value<font color="#000080">&lt;&gt;</font><font color="#800000">0</font><font color="#000080">)
                                </font><font color="#FF0000"><b>THEN
                                  BEGIN
                                    IF </b></font><font color="#000080">(</font>Abs<font color="#000080">( </font>Ln<font color="#000080">(</font>Abs<font color="#000080">(</font>value<font color="#000080">)) -
                                        </font>Ln<font color="#000080">(</font>Abs<font color="#000080">(</font>dummy<font color="#000080">)) ) &lt; </font>Ln<font color="#000080">(</font>tfp_maxreal<font color="#000080">))
                                      </font><font color="#FF0000"><b>THEN </b></font>value<font color="#000080">:=</font>value<font color="#000080">/</font>dummy
                                      <font color="#FF0000"><b>ELSE </b></font>Tfp_seternr<font color="#000080">(</font><font color="#800000">11</font><font color="#000080">)
                                  </font><font color="#FF0000"><b>END
                                ELSE </b></font>value<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
                            </font><font color="#FF0000"><b>END
                          ELSE </b></font>Tfp_seternr<font color="#000080">(</font><font color="#800000">9</font><font color="#000080">);
                      </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
                </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
        </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>tfp_ernr<font color="#000080">=</font><font color="#800000">0</font><font color="#000080">)
    </font><font color="#FF0000"><b>THEN </b></font>Tfp_eval_subterm<font color="#000080">:=</font>value
    <font color="#FF0000"><b>ELSE </b></font>Tfp_eval_subterm<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;</font><font color="#008000"><i>{of Tfp_Eval_subterm}

{---------------------------------------------------------}
{  Real Expr  = Subterm + Subterm                         }
{               Subterm - Subterm                         }
{---------------------------------------------------------}

</i></font><font color="#FF0000"><b>FUNCTION </b></font>Tfp_eval_r_expr<font color="#000080">(</font>p <font color="#000080">: </font>tfp_state_ptr<font color="#000080">) : </font>REAL<font color="#000080">;

</font><font color="#FF0000"><b>VAR
  </b></font>dummy<font color="#000080">,
  </font>dummy2<font color="#000080">,
  </font>value <font color="#000080">: </font>REAL<font color="#000080">;

</font><font color="#FF0000"><b>BEGIN
  WITH </b></font>p<font color="#000080">^ </font><font color="#FF0000"><b>DO
    BEGIN
      </b></font>value<font color="#000080">:=</font>Tfp_eval_subterm<font color="#000080">(</font>p<font color="#000080">);

      </font><font color="#FF0000"><b>WHILE </b></font><font color="#000080">(</font>tfp_ernr<font color="#000080">=</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>AND </b></font><font color="#000080">(</font>tfp_nextchar <font color="#FF0000"><b>IN </b></font><font color="#000080">[</font><font color="#800000">'+'</font><font color="#000080">,</font><font color="#800000">'-'</font><font color="#000080">]) </font><font color="#FF0000"><b>DO
        CASE </b></font>tfp_nextchar <font color="#FF0000"><b>OF

          </b></font><font color="#800000">'+' </font><font color="#000080">: </font><font color="#FF0000"><b>BEGIN
                  </b></font>Tfp_skip<font color="#000080">(</font>p<font color="#000080">);

                  </font>dummy<font color="#000080">:=</font>Tfp_eval_subterm<font color="#000080">(</font>p<font color="#000080">);

                  </font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>tfp_ernr<font color="#000080">=</font><font color="#800000">0</font><font color="#000080">)
                    </font><font color="#FF0000"><b>THEN
                      BEGIN

                      </b></font><font color="#008000"><i>{----Overflow Protected}
                        </i></font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>Abs<font color="#000080">( (</font>value<font color="#000080">/</font><font color="#800000">10</font><font color="#000080">) + (</font>dummy<font color="#000080">/</font><font color="#800000">10</font><font color="#000080">) ) &lt; (</font>tfp_maxreal<font color="#000080">/</font><font color="#800000">10</font><font color="#000080">))
                          </font><font color="#FF0000"><b>THEN </b></font>value<font color="#000080">:=</font>value<font color="#000080">+</font>dummy
                          <font color="#FF0000"><b>ELSE </b></font>Tfp_seternr<font color="#000080">(</font><font color="#800000">11</font><font color="#000080">);
                      </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
                </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

          </font><font color="#800000">'-' </font><font color="#000080">: </font><font color="#FF0000"><b>BEGIN
                  </b></font>Tfp_skip<font color="#000080">(</font>p<font color="#000080">);
                  </font>dummy2<font color="#000080">:=</font>value<font color="#000080">;

                  </font>dummy<font color="#000080">:=</font>Tfp_eval_subterm<font color="#000080">(</font>p<font color="#000080">);

                  </font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>tfp_ernr<font color="#000080">=</font><font color="#800000">0</font><font color="#000080">)
                    </font><font color="#FF0000"><b>THEN
                      BEGIN

                      </b></font><font color="#008000"><i>{----Overflow Protected}
                        </i></font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>Abs<font color="#000080">( (</font>value<font color="#000080">/</font><font color="#800000">10</font><font color="#000080">) - (</font>dummy<font color="#000080">/</font><font color="#800000">10</font><font color="#000080">) )&lt;(</font>tfp_maxreal<font color="#000080">/</font><font color="#800000">10</font><font color="#000080">))
                          </font><font color="#FF0000"><b>THEN </b></font>value<font color="#000080">:=</font>value<font color="#000080">-</font>dummy
                          <font color="#FF0000"><b>ELSE </b></font>Tfp_seternr<font color="#000080">(</font><font color="#800000">11</font><font color="#000080">);

                      </font><font color="#008000"><i>{----Underflow Protected}
                        </i></font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>value<font color="#000080">=</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>AND </b></font><font color="#000080">(</font>dummy<font color="#000080">&lt;&gt;</font>dummy2<font color="#000080">)
                          </font><font color="#FF0000"><b>THEN </b></font>Tfp_seternr<font color="#000080">(</font><font color="#800000">11</font><font color="#000080">);
                      </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
                </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
        </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

    </font><font color="#008000"><i>{----at this point the current char must be }
    {       1. the eoln marker or               }
    {       2. a right bracket                  }
    {       3. start of a boolean operator      }

      </i></font><font color="#FF0000"><b>IF NOT </b></font><font color="#000080">(</font>tfp_nextchar <font color="#FF0000"><b>IN </b></font><font color="#000080">[</font><font color="#800000">#00</font><font color="#000080">,</font><font color="#800000">')'</font><font color="#000080">,</font><font color="#800000">'&gt;'</font><font color="#000080">,</font><font color="#800000">'&lt;'</font><font color="#000080">,</font><font color="#800000">'='</font><font color="#000080">,</font><font color="#800000">','</font><font color="#000080">])
        </font><font color="#FF0000"><b>THEN </b></font>Tfp_seternr<font color="#000080">(</font><font color="#800000">2</font><font color="#000080">);
    </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>tfp_ernr<font color="#000080">=</font><font color="#800000">0</font><font color="#000080">)
    </font><font color="#FF0000"><b>THEN </b></font>Tfp_eval_r_expr<font color="#000080">:=</font>value
    <font color="#FF0000"><b>ELSE </b></font>Tfp_eval_r_expr<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>{of Tfp_Eval_R_Expr}

{---------------------------------------------------------}
{  Boolean Expr  = R_Expr &lt;  R_Expr                       }
{                  R_Expr &lt;= R_Expr                       }
{                  R_Expr &lt;&gt; R_Expr                       }
{                  R_Expr =  R_Expr                       }
{                  R_Expr &gt;= R_Expr                       }
{                  R_Expr &gt;  R_Expr                       }
{---------------------------------------------------------}

</i></font><font color="#FF0000"><b>FUNCTION </b></font>Tfp_eval_b_expr<font color="#000080">(</font>p <font color="#000080">: </font>tfp_state_ptr<font color="#000080">) : </font>REAL<font color="#000080">;

</font><font color="#FF0000"><b>VAR
  </b></font>value <font color="#000080">: </font>REAL<font color="#000080">;

</font><font color="#FF0000"><b>BEGIN
  WITH </b></font>p<font color="#000080">^ </font><font color="#FF0000"><b>DO
    BEGIN
      </b></font>value<font color="#000080">:=</font>Tfp_eval_r_expr<font color="#000080">(</font>p<font color="#000080">);

      </font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>tfp_ernr<font color="#000080">=</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>AND </b></font><font color="#000080">(</font>tfp_nextchar <font color="#FF0000"><b>IN </b></font><font color="#000080">[</font><font color="#800000">'&lt;'</font><font color="#000080">,</font><font color="#800000">'&gt;'</font><font color="#000080">,</font><font color="#800000">'='</font><font color="#000080">]) </font><font color="#FF0000"><b>THEN
        CASE </b></font>tfp_nextchar <font color="#FF0000"><b>OF

          </b></font><font color="#800000">'&lt;' </font><font color="#000080">: </font><font color="#FF0000"><b>BEGIN
                  </b></font>Tfp_skip<font color="#000080">(</font>p<font color="#000080">);
                  </font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>tfp_nextchar <font color="#FF0000"><b>IN </b></font><font color="#000080">[</font><font color="#800000">'&gt;'</font><font color="#000080">,</font><font color="#800000">'='</font><font color="#000080">])
                    </font><font color="#FF0000"><b>THEN
                      CASE </b></font>tfp_nextchar <font color="#FF0000"><b>OF
                        </b></font><font color="#800000">'&gt;' </font><font color="#000080">: </font><font color="#FF0000"><b>BEGIN
                                </b></font>Tfp_skip<font color="#000080">(</font>p<font color="#000080">);
                                </font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>value<font color="#000080">&lt;&gt;</font>Tfp_eval_r_expr<font color="#000080">(</font>p<font color="#000080">))
                                  </font><font color="#FF0000"><b>THEN </b></font>value<font color="#000080">:=</font>tfp_true
                                  <font color="#FF0000"><b>ELSE </b></font>value<font color="#000080">:=</font>tfp_false<font color="#000080">;
                              </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

                        </font><font color="#800000">'=' </font><font color="#000080">: </font><font color="#FF0000"><b>BEGIN
                                </b></font>Tfp_skip<font color="#000080">(</font>p<font color="#000080">);
                                </font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>value<font color="#000080">&lt;=</font>Tfp_eval_r_expr<font color="#000080">(</font>p<font color="#000080">))
                                  </font><font color="#FF0000"><b>THEN </b></font>value<font color="#000080">:=</font>tfp_true
                                  <font color="#FF0000"><b>ELSE </b></font>value<font color="#000080">:=</font>tfp_false<font color="#000080">;
                              </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
                      </font><font color="#FF0000"><b>END
                      ELSE
                        BEGIN
                          IF </b></font><font color="#000080">(</font>value<font color="#000080">&lt;</font>Tfp_eval_r_expr<font color="#000080">(</font>p<font color="#000080">))
                            </font><font color="#FF0000"><b>THEN </b></font>value<font color="#000080">:=</font>tfp_true
                            <font color="#FF0000"><b>ELSE </b></font>value<font color="#000080">:=</font>tfp_false<font color="#000080">;
                        </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
                </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

          </font><font color="#800000">'&gt;' </font><font color="#000080">: </font><font color="#FF0000"><b>BEGIN
                  </b></font>Tfp_skip<font color="#000080">(</font>p<font color="#000080">);
                  </font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>tfp_nextchar<font color="#000080">=</font><font color="#800000">'='</font><font color="#000080">)
                    </font><font color="#FF0000"><b>THEN
                      BEGIN
                        </b></font>Tfp_skip<font color="#000080">(</font>p<font color="#000080">);
                        </font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>value<font color="#000080">&gt;=</font>Tfp_eval_r_expr<font color="#000080">(</font>p<font color="#000080">))
                          </font><font color="#FF0000"><b>THEN </b></font>value<font color="#000080">:=</font>tfp_true
                          <font color="#FF0000"><b>ELSE </b></font>value<font color="#000080">:=</font>tfp_false<font color="#000080">;
                      </font><font color="#FF0000"><b>END
                    ELSE
                      BEGIN
                        IF </b></font><font color="#000080">(</font>value<font color="#000080">&gt;</font>Tfp_eval_r_expr<font color="#000080">(</font>p<font color="#000080">))
                          </font><font color="#FF0000"><b>THEN </b></font>value<font color="#000080">:=</font>tfp_true
                          <font color="#FF0000"><b>ELSE </b></font>value<font color="#000080">:=</font>tfp_false<font color="#000080">;
                      </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
                </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

          </font><font color="#800000">'=' </font><font color="#000080">: </font><font color="#FF0000"><b>BEGIN
                  </b></font>Tfp_skip<font color="#000080">(</font>p<font color="#000080">);
                  </font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>value<font color="#000080">=</font>Tfp_eval_r_expr<font color="#000080">(</font>p<font color="#000080">))
                    </font><font color="#FF0000"><b>THEN </b></font>value<font color="#000080">:=</font>tfp_true
                    <font color="#FF0000"><b>ELSE </b></font>value<font color="#000080">:=</font>tfp_false<font color="#000080">;
                </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
        </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>tfp_ernr<font color="#000080">=</font><font color="#800000">0</font><font color="#000080">)
    </font><font color="#FF0000"><b>THEN </b></font>Tfp_eval_b_expr<font color="#000080">:=</font>value
    <font color="#FF0000"><b>ELSE </b></font>Tfp_eval_b_expr<font color="#000080">:=</font><font color="#800000">0.0</font><font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>{of Tfp_Eval_B_Expr}

{---------------------------------------------------------}

</i></font><font color="#FF0000"><b>FUNCTION </b></font>Tfp_parse2real<font color="#000080">(</font>s <font color="#000080">: </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">): </font>REAL<font color="#000080">;

</font><font color="#FF0000"><b>VAR
  </b></font>value   <font color="#000080">: </font>REAL<font color="#000080">;

</font><font color="#FF0000"><b>BEGIN
  </b></font>tfp_erpos<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
  </font>tfp_ernr <font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;

  </font><font color="#FF0000"><b>IF </b></font>Maxavail<font color="#000080">&gt;=</font>Sizeof<font color="#000080">(</font>tfp_parse_state<font color="#000080">)
    </font><font color="#FF0000"><b>THEN
      BEGIN
        </b></font>New<font color="#000080">(</font>p<font color="#000080">);
        </font>Tfp_check<font color="#000080">(</font>s<font color="#000080">,</font>p<font color="#000080">);

        </font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>tfp_ernr<font color="#000080">=</font><font color="#800000">0</font><font color="#000080">)
          </font><font color="#FF0000"><b>THEN </b></font>value<font color="#000080">:=</font>Tfp_eval_b_expr<font color="#000080">(</font>p<font color="#000080">);

        </font>Dispose<font color="#000080">(</font>p<font color="#000080">);
      </font><font color="#FF0000"><b>END
    ELSE </b></font>Tfp_seternr<font color="#000080">(</font><font color="#800000">15</font><font color="#000080">);

  </font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>tfp_ernr<font color="#000080">&lt;&gt;</font><font color="#800000">0</font><font color="#000080">)
    </font><font color="#FF0000"><b>THEN </b></font>Tfp_parse2real<font color="#000080">:=</font><font color="#800000">0.0
    </font><font color="#FF0000"><b>ELSE </b></font>Tfp_parse2real<font color="#000080">:=</font>value<font color="#000080">;

</font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>{of Tfp_Parse2Real}

{---------------------------------------------------------}

</i></font><font color="#FF0000"><b>FUNCTION </b></font>Tfp_parse2str<font color="#000080">(</font>s <font color="#000080">: </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">;</font>m<font color="#000080">,</font>n <font color="#000080">: </font>INTEGER<font color="#000080">) : </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">;

</font><font color="#FF0000"><b>VAR
  </b></font>r   <font color="#000080">: </font>REAL<font color="#000080">;
  </font>tmp <font color="#000080">: </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">;

</font><font color="#FF0000"><b>BEGIN
  </b></font>r<font color="#000080">:=</font>Tfp_parse2real<font color="#000080">(</font>s<font color="#000080">);
  </font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>tfp_ernr<font color="#000080">=</font><font color="#800000">0</font><font color="#000080">)
    </font><font color="#FF0000"><b>THEN </b></font>Str<font color="#000080">(</font>r<font color="#000080">:</font>m<font color="#000080">:</font>n<font color="#000080">,</font>tmp<font color="#000080">)
    </font><font color="#FF0000"><b>ELSE </b></font>tmp<font color="#000080">:=</font><font color="#800000">''</font><font color="#000080">;
  </font>Tfp_parse2str<font color="#000080">:=</font>tmp<font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>{of Tfp_Parse2str}

{---------------------------------------------------------}

</i></font><font color="#FF0000"><b>FUNCTION </b></font>Tfp_errormsg<font color="#000080">(</font>nr <font color="#000080">: </font>INTEGER<font color="#000080">) : </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">;

</font><font color="#FF0000"><b>BEGIN
  CASE </b></font>nr <font color="#FF0000"><b>OF
    </b></font><font color="#800000">0 </font><font color="#000080">: </font>Tfp_errormsg<font color="#000080">:=</font><font color="#800000">'Result ok'</font><font color="#000080">;                                  </font><font color="#008000"><i>{Error 0 }
    </i></font><font color="#800000">1 </font><font color="#000080">: </font>Tfp_errormsg<font color="#000080">:=</font><font color="#800000">'Invalid format of a number'</font><font color="#000080">;                 </font><font color="#008000"><i>{Error 1 }
    </i></font><font color="#800000">2 </font><font color="#000080">: </font>Tfp_errormsg<font color="#000080">:=</font><font color="#800000">'Unkown function'</font><font color="#000080">;                            </font><font color="#008000"><i>{Error 2 }
    </i></font><font color="#800000">3 </font><font color="#000080">: </font>Tfp_errormsg<font color="#000080">:=</font><font color="#800000">'( ) mismatch'</font><font color="#000080">;                               </font><font color="#008000"><i>{Error 3 }
    </i></font><font color="#800000">4 </font><font color="#000080">: </font>Tfp_errormsg<font color="#000080">:=</font><font color="#800000">'Real exponent -&gt; complex number'</font><font color="#000080">;            </font><font color="#008000"><i>{Error 4 }
    </i></font><font color="#800000">5 </font><font color="#000080">: </font>Tfp_errormsg<font color="#000080">:=</font><font color="#800000">'TAN( (2n+1)*PI/2 ) not defined'</font><font color="#000080">;             </font><font color="#008000"><i>{Error 5 }
    </i></font><font color="#800000">6 </font><font color="#000080">: </font>Tfp_errormsg<font color="#000080">:=</font><font color="#800000">'Empty string'</font><font color="#000080">;                               </font><font color="#008000"><i>{Error 6 }
    </i></font><font color="#800000">7 </font><font color="#000080">: </font>Tfp_errormsg<font color="#000080">:=</font><font color="#800000">'LN(x) or LOG(x) for x&lt;=0 -&gt; complex number'</font><font color="#000080">; </font><font color="#008000"><i>{Error 7 }
    </i></font><font color="#800000">8 </font><font color="#000080">: </font>Tfp_errormsg<font color="#000080">:=</font><font color="#800000">'SQRT(x) for x&lt;0 -&gt; complex number'</font><font color="#000080">;          </font><font color="#008000"><i>{Error 8 }
    </i></font><font color="#800000">9 </font><font color="#000080">: </font>Tfp_errormsg<font color="#000080">:=</font><font color="#800000">'Divide by zero'</font><font color="#000080">;                             </font><font color="#008000"><i>{Error 9 }
   </i></font><font color="#800000">10 </font><font color="#000080">: </font>Tfp_errormsg<font color="#000080">:=</font><font color="#800000">'To many function or constants'</font><font color="#000080">;              </font><font color="#008000"><i>{Error 10}
   </i></font><font color="#800000">11 </font><font color="#000080">: </font>Tfp_errormsg<font color="#000080">:=</font><font color="#800000">'Intermediate result out of range'</font><font color="#000080">;           </font><font color="#008000"><i>{Error 11}
   </i></font><font color="#800000">12 </font><font color="#000080">: </font>Tfp_errormsg<font color="#000080">:=</font><font color="#800000">'Illegal characters in functionname'</font><font color="#000080">;         </font><font color="#008000"><i>{Error 12}
   </i></font><font color="#800000">13 </font><font color="#000080">: </font>Tfp_errormsg<font color="#000080">:=</font><font color="#800000">'Not a boolean expression'</font><font color="#000080">;                   </font><font color="#008000"><i>{Error 13}
   </i></font><font color="#800000">14 </font><font color="#000080">: </font>Tfp_errormsg<font color="#000080">:=</font><font color="#800000">'Wrong number of parameters'</font><font color="#000080">;                 </font><font color="#008000"><i>{Error 14}
   </i></font><font color="#800000">15 </font><font color="#000080">: </font>Tfp_errormsg<font color="#000080">:=</font><font color="#800000">'Memory problems'</font><font color="#000080">;                            </font><font color="#008000"><i>{Error 15}
   </i></font><font color="#800000">16 </font><font color="#000080">: </font>Tfp_errormsg<font color="#000080">:=</font><font color="#800000">'Not enough functions or constants'</font><font color="#000080">;          </font><font color="#008000"><i>{Error 16}
   </i></font><font color="#800000">17 </font><font color="#000080">: </font>Tfp_errormsg<font color="#000080">:=</font><font color="#800000">'Csc( n*PI ) not defined'</font><font color="#000080">;                    </font><font color="#008000"><i>{Error 17}
   </i></font><font color="#800000">18 </font><font color="#000080">: </font>Tfp_errormsg<font color="#000080">:=</font><font color="#800000">'Sec( (2n+1)*PI/2 ) not defined'</font><font color="#000080">;             </font><font color="#008000"><i>{Error 18}
   </i></font><font color="#800000">19 </font><font color="#000080">: </font>Tfp_errormsg<font color="#000080">:=</font><font color="#800000">'Cot( n*PI ) not defined'</font><font color="#000080">;                    </font><font color="#008000"><i>{Error 19}
   </i></font><font color="#800000">20 </font><font color="#000080">: </font>Tfp_errormsg<font color="#000080">:=</font><font color="#800000">'Parameter to large'</font><font color="#000080">;                         </font><font color="#008000"><i>{Error 20}
   </i></font><font color="#800000">21 </font><font color="#000080">: </font>Tfp_errormsg<font color="#000080">:=</font><font color="#800000">'Csch(0) not defined'</font><font color="#000080">;                        </font><font color="#008000"><i>{Error 21}
   </i></font><font color="#800000">22 </font><font color="#000080">: </font>Tfp_errormsg<font color="#000080">:=</font><font color="#800000">'Coth(0) not defined'</font><font color="#000080">;                        </font><font color="#008000"><i>{Error 22}
   </i></font><font color="#800000">23 </font><font color="#000080">: </font>Tfp_errormsg<font color="#000080">:=</font><font color="#800000">'ArcCosh(x) not defined for x&lt;1'</font><font color="#000080">;             </font><font color="#008000"><i>{Error 23}
   </i></font><font color="#800000">24 </font><font color="#000080">: </font>Tfp_errormsg<font color="#000080">:=</font><font color="#800000">'ArcTanh(x) not defined for Abs(x)=&gt;1'</font><font color="#000080">;       </font><font color="#008000"><i>{Error 24}
   </i></font><font color="#800000">25 </font><font color="#000080">: </font>Tfp_errormsg<font color="#000080">:=</font><font color="#800000">'Arccsch(0) not defined'</font><font color="#000080">;                     </font><font color="#008000"><i>{Error 25}
   </i></font><font color="#800000">26 </font><font color="#000080">: </font>Tfp_errormsg<font color="#000080">:=</font><font color="#800000">'Arcsech(x) not defined for x&lt;=0 or x&gt;1'</font><font color="#000080">;     </font><font color="#008000"><i>{Error 26}
   </i></font><font color="#800000">27 </font><font color="#000080">: </font>Tfp_errormsg<font color="#000080">:=</font><font color="#800000">'Arccoth(x) not defined for Abs(x)&lt;=1'</font><font color="#000080">;       </font><font color="#008000"><i>{Error 27}
  </i></font><font color="#FF0000"><b>ELSE  </b></font>Tfp_errormsg<font color="#000080">:=</font><font color="#800000">'Unkown error'</font><font color="#000080">;                               </font><font color="#008000"><i>{Error xx}
  </i></font><font color="#FF0000"><b>END</b></font><font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>{of Tfp_ermsg}

{---------------------------------------------------------}

</i></font><font color="#FF0000"><b>PROCEDURE </b></font>Tfp_init<font color="#000080">(</font>no <font color="#000080">: </font>WORD<font color="#000080">);

</font><font color="#FF0000"><b>BEGIN
  IF </b></font><font color="#000080">(</font>maxfie<font color="#000080">&gt;</font><font color="#800000">0</font><font color="#000080">)
    </font><font color="#FF0000"><b>THEN </b></font>Freemem<font color="#000080">(</font>fiearr<font color="#000080">,</font>maxfie<font color="#000080">*</font>Sizeof<font color="#000080">(</font>tfp_fie_typ<font color="#000080">));

  </font>maxfie<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
  </font>fiesiz<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;

  </font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>Maxavail<font color="#000080">&gt;=(</font>no<font color="#000080">*</font>Sizeof<font color="#000080">(</font>tfp_fie_typ<font color="#000080">))) </font><font color="#FF0000"><b>AND </b></font><font color="#000080">(</font>no<font color="#000080">&gt;</font><font color="#800000">0</font><font color="#000080">)
    </font><font color="#FF0000"><b>THEN
      BEGIN
        </b></font>getmem<font color="#000080">(</font>fiearr<font color="#000080">,</font>no<font color="#000080">*</font>Sizeof<font color="#000080">(</font>tfp_fie_typ<font color="#000080">));
        </font>maxfie<font color="#000080">:=</font>no<font color="#000080">;
      </font><font color="#FF0000"><b>END
    ELSE </b></font>Tfp_seternr<font color="#000080">(</font><font color="#800000">15</font><font color="#000080">);
</font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>{of Tfp_Init}

{---------------------------------------------------------}

</i></font><font color="#FF0000"><b>PROCEDURE </b></font>Tfp_expand<font color="#000080">(</font>no <font color="#000080">: </font>WORD<font color="#000080">);

</font><font color="#FF0000"><b>VAR
  </b></font>temp <font color="#000080">: ^</font>tfp_fieptr<font color="#000080">;

</font><font color="#FF0000"><b>BEGIN
  IF </b></font><font color="#000080">(</font>maxfie<font color="#000080">&gt;</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>AND </b></font><font color="#000080">(</font>no<font color="#000080">&gt;</font><font color="#800000">0</font><font color="#000080">)
    </font><font color="#FF0000"><b>THEN
      BEGIN
        IF </b></font><font color="#000080">(</font>Maxavail<font color="#000080">&gt;=(</font>maxfie<font color="#000080">+</font>no<font color="#000080">)*</font>Sizeof<font color="#000080">(</font>tfp_fie_typ<font color="#000080">))
          </font><font color="#FF0000"><b>THEN
            BEGIN
              </b></font>getmem<font color="#000080">(</font>temp<font color="#000080">,(</font>maxfie<font color="#000080">+</font>no<font color="#000080">)*</font>Sizeof<font color="#000080">(</font>tfp_fie_typ<font color="#000080">));
              </font>Move<font color="#000080">(</font>fiearr<font color="#000080">^,</font>temp<font color="#000080">^,</font>maxfie<font color="#000080">*</font>Sizeof<font color="#000080">(</font>tfp_fie_typ<font color="#000080">));
              </font>Freemem<font color="#000080">(</font>fiearr<font color="#000080">,</font>maxfie<font color="#000080">*</font>Sizeof<font color="#000080">(</font>tfp_fie_typ<font color="#000080">));
              </font>fiearr<font color="#000080">:=</font>POINTER<font color="#000080">(</font>temp<font color="#000080">);
              </font>maxfie<font color="#000080">:=</font>maxfie<font color="#000080">+</font>no<font color="#000080">;
              </font>fiesiz<font color="#000080">:=</font>fiesiz<font color="#000080">;
            </font><font color="#FF0000"><b>END
          ELSE </b></font>Tfp_seternr<font color="#000080">(</font><font color="#800000">15</font><font color="#000080">)
      </font><font color="#FF0000"><b>END
    ELSE </b></font>Tfp_init<font color="#000080">(</font>no<font color="#000080">);
</font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>{of Tfp_Expand}

{---------------------------------------------------------}

</i></font><font color="#FF0000"><b>PROCEDURE </b></font>Tfp_keep<font color="#000080">(</font>no <font color="#000080">: </font>WORD<font color="#000080">);

</font><font color="#FF0000"><b>BEGIN
  IF </b></font><font color="#000080">(</font>maxfie<font color="#000080">&lt;</font>no<font color="#000080">)
    </font><font color="#FF0000"><b>THEN </b></font>Tfp_seternr<font color="#000080">(</font><font color="#800000">16</font><font color="#000080">)
    </font><font color="#FF0000"><b>ELSE </b></font>maxfie<font color="#000080">:=</font>no<font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>{of Tfp_Keep}

{---------------------------------------------------------}

</i></font><font color="#FF0000"><b>FUNCTION </b></font>Tfp_noobj <font color="#000080">: </font>WORD<font color="#000080">;

</font><font color="#FF0000"><b>BEGIN
  </b></font>Tfp_noobj<font color="#000080">:=</font>maxfie<font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>{of Tfp_Noobj}

{---------------------------------------------------------}

</i></font><font color="#FF0000"><b>PROCEDURE </b></font>Tfp_addobj<font color="#000080">(</font>adres <font color="#000080">: </font>POINTER<font color="#000080">;</font>name <font color="#000080">: </font>tfp_fname<font color="#000080">;</font>ftype <font color="#000080">: </font>tfp_ftype<font color="#000080">);

</font><font color="#FF0000"><b>VAR
  </b></font>i <font color="#000080">: </font>INTEGER<font color="#000080">;

</font><font color="#FF0000"><b>BEGIN
</b></font><font color="#008000"><i>{$R-}
  </i></font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>fiesiz<font color="#000080">&lt;</font>maxfie<font color="#000080">)
    </font><font color="#FF0000"><b>THEN
      BEGIN
        </b></font>Inc<font color="#000080">(</font>fiesiz<font color="#000080">);
        </font><font color="#FF0000"><b>WITH </b></font>fiearr<font color="#000080">^[</font>fiesiz<font color="#000080">] </font><font color="#FF0000"><b>DO
          BEGIN
            </b></font>tfp_faddr<font color="#000080">:=</font>adres<font color="#000080">;
            </font>tfp_fname<font color="#000080">:=</font>name<font color="#000080">;
            </font><font color="#FF0000"><b>FOR </b></font>i<font color="#000080">:=</font><font color="#800000">1 </font><font color="#FF0000"><b>TO </b></font>Length<font color="#000080">(</font>tfp_fname<font color="#000080">) </font><font color="#FF0000"><b>DO
              IF </b></font><font color="#000080">(</font>Upcase<font color="#000080">(</font>tfp_fname<font color="#000080">[</font>i<font color="#000080">]) </font><font color="#FF0000"><b>IN </b></font><font color="#000080">[</font><font color="#800000">'0'</font><font color="#000080">..</font><font color="#800000">'9'</font><font color="#000080">,</font><font color="#800000">'_'</font><font color="#000080">,</font><font color="#800000">'A'</font><font color="#000080">..</font><font color="#800000">'Z'</font><font color="#000080">])
                </font><font color="#FF0000"><b>THEN </b></font>tfp_fname<font color="#000080">[</font>i<font color="#000080">]:=</font>Upcase<font color="#000080">(</font>tfp_fname<font color="#000080">[</font>i<font color="#000080">])
                </font><font color="#FF0000"><b>ELSE </b></font>Tfp_seternr<font color="#000080">(</font><font color="#800000">12</font><font color="#000080">);

            </font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>Length<font color="#000080">(</font>tfp_fname<font color="#000080">)&gt;</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>AND
               NOT </b></font><font color="#000080">(</font>tfp_fname<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">] </font><font color="#FF0000"><b>IN </b></font><font color="#000080">[</font><font color="#800000">'A'</font><font color="#000080">..</font><font color="#800000">'Z'</font><font color="#000080">])
              </font><font color="#FF0000"><b>THEN </b></font>Tfp_seternr<font color="#000080">(</font><font color="#800000">12</font><font color="#000080">);

            </font>tfp_ftype<font color="#000080">:=</font>ftype<font color="#000080">;
          </font><font color="#FF0000"><b>END
      END
    ELSE </b></font>Tfp_seternr<font color="#000080">(</font><font color="#800000">10</font><font color="#000080">);
</font><font color="#008000"><i>{$R+}
</i></font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>{of Tfp_Addobject}

{---------------------------------------------------------}
{----Internal Functions                                   }
{---------------------------------------------------------}

{$F+}

</i></font><font color="#FF0000"><b>FUNCTION </b></font>Xabs<font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>r <font color="#000080">: </font>REAL<font color="#000080">) : </font>REAL<font color="#000080">;

</font><font color="#FF0000"><b>BEGIN
  </b></font>Xabs<font color="#000080">:=</font>Abs<font color="#000080">(</font>r<font color="#000080">);
</font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>{of xABS}

{---------------------------------------------------------}

</i></font><font color="#FF0000"><b>FUNCTION </b></font>Xand<font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>lu_r<font color="#000080">;</font><font color="#FF0000"><b>VAR </b></font>n <font color="#000080">: </font>INTEGER<font color="#000080">) : </font>REAL<font color="#000080">;

</font><font color="#FF0000"><b>VAR
  </b></font>r  <font color="#000080">: </font>REAL<font color="#000080">;
  </font>i  <font color="#000080">: </font>INTEGER<font color="#000080">;

</font><font color="#FF0000"><b>BEGIN
  FOR </b></font>i<font color="#000080">:=</font><font color="#800000">0 </font><font color="#FF0000"><b>TO </b></font>n <font color="#FF0000"><b>DO
    IF </b></font><font color="#000080">(</font>tfp_rarray<font color="#000080">(</font>lu_r<font color="#000080">)[</font>i<font color="#000080">]&lt;&gt;</font>tfp_false<font color="#000080">) </font><font color="#FF0000"><b>AND
       </b></font><font color="#000080">(</font>tfp_rarray<font color="#000080">(</font>lu_r<font color="#000080">)[</font>i<font color="#000080">]&lt;&gt;</font>tfp_true<font color="#000080">)
      </font><font color="#FF0000"><b>THEN
        BEGIN
          IF </b></font><font color="#000080">(</font>tfp_ernr<font color="#000080">=</font><font color="#800000">0</font><font color="#000080">)
            </font><font color="#FF0000"><b>THEN </b></font>Tfp_seternr<font color="#000080">(</font><font color="#800000">13</font><font color="#000080">);
        </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>tfp_ernr<font color="#000080">=</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>AND </b></font><font color="#000080">(</font>n<font color="#000080">&gt;</font><font color="#800000">0</font><font color="#000080">)
    </font><font color="#FF0000"><b>THEN
      BEGIN
        </b></font>r<font color="#000080">:=</font>tfp_true<font color="#000080">*</font>Ord<font color="#000080">(</font>tfp_rarray<font color="#000080">(</font>lu_r<font color="#000080">)[</font><font color="#800000">0</font><font color="#000080">]=</font>tfp_true<font color="#000080">);
        </font><font color="#FF0000"><b>FOR </b></font>i<font color="#000080">:=</font><font color="#800000">1 </font><font color="#FF0000"><b>TO </b></font>n <font color="#FF0000"><b>DO
          </b></font>r<font color="#000080">:=</font>tfp_true<font color="#000080">*</font>Ord<font color="#000080">( (</font>r<font color="#000080">=</font>tfp_true<font color="#000080">) </font><font color="#FF0000"><b>AND </b></font><font color="#000080">(</font>tfp_rarray<font color="#000080">(</font>lu_r<font color="#000080">)[</font>i<font color="#000080">]=</font>tfp_true<font color="#000080">))
      </font><font color="#FF0000"><b>END
    ELSE </b></font>Tfp_seternr<font color="#000080">(</font><font color="#800000">14</font><font color="#000080">);

  </font><font color="#FF0000"><b>IF </b></font>tfp_ernr<font color="#000080">=</font><font color="#800000">0
    </font><font color="#FF0000"><b>THEN </b></font>Xand<font color="#000080">:=</font>r
    <font color="#FF0000"><b>ELSE </b></font>Xand<font color="#000080">:=</font><font color="#800000">0.0</font><font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>{of xAND}

{---------------------------------------------------------}

</i></font><font color="#FF0000"><b>FUNCTION </b></font>Xarctan<font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>r <font color="#000080">: </font>REAL<font color="#000080">) : </font>REAL<font color="#000080">;

</font><font color="#FF0000"><b>BEGIN
  </b></font>Xarctan<font color="#000080">:=</font>Arctan<font color="#000080">(</font>r<font color="#000080">);
</font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>{of xArctan}

{---------------------------------------------------------}

</i></font><font color="#FF0000"><b>FUNCTION </b></font>Xcos<font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>r <font color="#000080">: </font>REAL<font color="#000080">) : </font>REAL<font color="#000080">;

</font><font color="#FF0000"><b>BEGIN
  </b></font>Xcos<font color="#000080">:=</font>Cos<font color="#000080">(</font>r<font color="#000080">);
</font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>{of xCos}

{---------------------------------------------------------}

</i></font><font color="#FF0000"><b>FUNCTION </b></font>Xdeg<font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>r <font color="#000080">: </font>REAL<font color="#000080">) : </font>REAL<font color="#000080">;

</font><font color="#FF0000"><b>BEGIN
  </b></font>Xdeg<font color="#000080">:=(</font>r<font color="#000080">/</font>pi<font color="#000080">)*</font><font color="#800000">180</font><font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>{of xDEG}

{---------------------------------------------------------}

</i></font><font color="#FF0000"><b>FUNCTION </b></font>Xe <font color="#000080">: </font>REAL<font color="#000080">;

</font><font color="#FF0000"><b>BEGIN
  </b></font>Xe<font color="#000080">:=</font>Exp<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">);
</font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>{of xE}

{---------------------------------------------------------}

</i></font><font color="#FF0000"><b>FUNCTION </b></font>Xexp<font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>r <font color="#000080">: </font>REAL<font color="#000080">) : </font>REAL<font color="#000080">;

</font><font color="#FF0000"><b>BEGIN
  </b></font>Xexp<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
  </font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>Abs<font color="#000080">(</font>r<font color="#000080">)&lt;</font>Ln<font color="#000080">(</font>tfp_maxreal<font color="#000080">))
    </font><font color="#FF0000"><b>THEN </b></font>Xexp<font color="#000080">:=</font>Exp<font color="#000080">(</font>r<font color="#000080">)
    </font><font color="#FF0000"><b>ELSE </b></font>Tfp_seternr<font color="#000080">(</font><font color="#800000">11</font><font color="#000080">);
</font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>{of xExp}

{---------------------------------------------------------}

</i></font><font color="#FF0000"><b>FUNCTION </b></font>Xfalse <font color="#000080">: </font>REAL<font color="#000080">;

</font><font color="#FF0000"><b>BEGIN
  </b></font>Xfalse<font color="#000080">:=</font>tfp_false<font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>{of xFalse}

{---------------------------------------------------------}

</i></font><font color="#FF0000"><b>FUNCTION </b></font>Xfrac<font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>r <font color="#000080">: </font>REAL<font color="#000080">) : </font>REAL<font color="#000080">;

</font><font color="#FF0000"><b>BEGIN
  </b></font>Xfrac<font color="#000080">:=</font>Frac<font color="#000080">(</font>r<font color="#000080">);
</font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>{of xFrac}

{---------------------------------------------------------}

</i></font><font color="#FF0000"><b>FUNCTION </b></font>Xint<font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>r <font color="#000080">: </font>REAL<font color="#000080">) : </font>REAL<font color="#000080">;

</font><font color="#FF0000"><b>BEGIN
  </b></font>Xint<font color="#000080">:=</font>Int<font color="#000080">(</font>r<font color="#000080">);
</font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>{of xInt}

{---------------------------------------------------------}

</i></font><font color="#FF0000"><b>FUNCTION </b></font>Xln<font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>r <font color="#000080">: </font>REAL<font color="#000080">) : </font>REAL<font color="#000080">;

</font><font color="#FF0000"><b>BEGIN
  </b></font>Xln<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
  </font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>r<font color="#000080">&gt;</font><font color="#800000">0</font><font color="#000080">)
    </font><font color="#FF0000"><b>THEN </b></font>Xln<font color="#000080">:=</font>Ln<font color="#000080">(</font>r<font color="#000080">)
    </font><font color="#FF0000"><b>ELSE </b></font>Tfp_seternr<font color="#000080">(</font><font color="#800000">7</font><font color="#000080">);
</font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>{of xLn}

{---------------------------------------------------------}

</i></font><font color="#FF0000"><b>FUNCTION </b></font>Xlog<font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>r <font color="#000080">: </font>REAL<font color="#000080">) : </font>REAL<font color="#000080">;

</font><font color="#FF0000"><b>BEGIN
  </b></font>Xlog<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
  </font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>r<font color="#000080">&gt;</font><font color="#800000">0</font><font color="#000080">)
    </font><font color="#FF0000"><b>THEN </b></font>Xlog<font color="#000080">:=</font>Ln<font color="#000080">(</font>r<font color="#000080">)/</font>ln<font color="#000080">(</font><font color="#800000">10</font><font color="#000080">)
    </font><font color="#FF0000"><b>ELSE </b></font>Tfp_seternr<font color="#000080">(</font><font color="#800000">7</font><font color="#000080">);
</font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>{of xLog}

{---------------------------------------------------------}

</i></font><font color="#FF0000"><b>FUNCTION </b></font>Xmax<font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>lu_r<font color="#000080">;</font><font color="#FF0000"><b>VAR </b></font>n <font color="#000080">: </font>INTEGER<font color="#000080">) : </font>REAL<font color="#000080">;

</font><font color="#FF0000"><b>VAR
  </b></font>max   <font color="#000080">: </font>REAL<font color="#000080">;
  </font>i        <font color="#000080">: </font>INTEGER<font color="#000080">;

</font><font color="#FF0000"><b>BEGIN
  </b></font>max<font color="#000080">:=</font>tfp_rarray<font color="#000080">(</font>lu_r<font color="#000080">)[</font><font color="#800000">0</font><font color="#000080">];
  </font><font color="#FF0000"><b>FOR </b></font>i<font color="#000080">:=</font><font color="#800000">1 </font><font color="#FF0000"><b>TO </b></font>n <font color="#FF0000"><b>DO
    IF </b></font><font color="#000080">(</font>tfp_rarray<font color="#000080">(</font>lu_r<font color="#000080">)[</font>i<font color="#000080">]&gt;</font>max<font color="#000080">)
      </font><font color="#FF0000"><b>THEN </b></font>max<font color="#000080">:=</font>tfp_rarray<font color="#000080">(</font>lu_r<font color="#000080">)[</font>i<font color="#000080">];
  </font>Xmax<font color="#000080">:=</font>max<font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>{of xMax}

{---------------------------------------------------------}

</i></font><font color="#FF0000"><b>FUNCTION </b></font>Xmin<font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>lu_r<font color="#000080">;</font><font color="#FF0000"><b>VAR </b></font>n <font color="#000080">: </font>INTEGER<font color="#000080">) : </font>REAL<font color="#000080">;

</font><font color="#FF0000"><b>VAR
  </b></font>min   <font color="#000080">: </font>REAL<font color="#000080">;
  </font>i     <font color="#000080">: </font>INTEGER<font color="#000080">;

</font><font color="#FF0000"><b>BEGIN
  </b></font>min<font color="#000080">:=</font>tfp_rarray<font color="#000080">(</font>lu_r<font color="#000080">)[</font><font color="#800000">0</font><font color="#000080">];
  </font><font color="#FF0000"><b>FOR </b></font>i<font color="#000080">:=</font><font color="#800000">1 </font><font color="#FF0000"><b>TO </b></font>n <font color="#FF0000"><b>DO
    IF </b></font><font color="#000080">(</font>tfp_rarray<font color="#000080">(</font>lu_r<font color="#000080">)[</font>i<font color="#000080">]&lt;</font>min<font color="#000080">)
      </font><font color="#FF0000"><b>THEN </b></font>min<font color="#000080">:=</font>tfp_rarray<font color="#000080">(</font>lu_r<font color="#000080">)[</font>i<font color="#000080">];
  </font>Xmin<font color="#000080">:=</font>min<font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>{of xMin}

{---------------------------------------------------------}

</i></font><font color="#FF0000"><b>FUNCTION </b></font>Xior<font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>lu_r<font color="#000080">;</font><font color="#FF0000"><b>VAR </b></font>n <font color="#000080">: </font>INTEGER<font color="#000080">) : </font>REAL<font color="#000080">;

</font><font color="#FF0000"><b>VAR
  </b></font>r <font color="#000080">: </font>REAL<font color="#000080">;
  </font>i <font color="#000080">: </font>INTEGER<font color="#000080">;

</font><font color="#FF0000"><b>BEGIN
  FOR </b></font>i<font color="#000080">:=</font><font color="#800000">0 </font><font color="#FF0000"><b>TO </b></font>n <font color="#FF0000"><b>DO
    IF </b></font><font color="#000080">(</font>tfp_rarray<font color="#000080">(</font>lu_r<font color="#000080">)[</font>i<font color="#000080">]&lt;&gt;</font>tfp_false<font color="#000080">) </font><font color="#FF0000"><b>AND
       </b></font><font color="#000080">(</font>tfp_rarray<font color="#000080">(</font>lu_r<font color="#000080">)[</font>i<font color="#000080">]&lt;&gt;</font>tfp_true<font color="#000080">)
      </font><font color="#FF0000"><b>THEN
        BEGIN
          IF </b></font><font color="#000080">(</font>tfp_ernr<font color="#000080">=</font><font color="#800000">0</font><font color="#000080">)
            </font><font color="#FF0000"><b>THEN </b></font>Tfp_seternr<font color="#000080">(</font><font color="#800000">13</font><font color="#000080">);
        </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>tfp_ernr<font color="#000080">=</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>AND
     </b></font><font color="#000080">(</font>n<font color="#000080">&gt;</font><font color="#800000">0</font><font color="#000080">)
    </font><font color="#FF0000"><b>THEN
      BEGIN
        </b></font>r<font color="#000080">:=</font>tfp_true<font color="#000080">*</font>Ord<font color="#000080">(</font>tfp_rarray<font color="#000080">(</font>lu_r<font color="#000080">)[</font><font color="#800000">0</font><font color="#000080">]=</font>tfp_true<font color="#000080">);
        </font><font color="#FF0000"><b>FOR </b></font>i<font color="#000080">:=</font><font color="#800000">1 </font><font color="#FF0000"><b>TO </b></font>n <font color="#FF0000"><b>DO
          </b></font>r<font color="#000080">:=</font>tfp_true<font color="#000080">*</font>Ord<font color="#000080">((</font>r<font color="#000080">=</font>tfp_true<font color="#000080">) </font><font color="#FF0000"><b>OR </b></font><font color="#000080">(</font>tfp_rarray<font color="#000080">(</font>lu_r<font color="#000080">)[</font>i<font color="#000080">]=</font>tfp_true<font color="#000080">))
      </font><font color="#FF0000"><b>END
    ELSE </b></font>Tfp_seternr<font color="#000080">(</font><font color="#800000">14</font><font color="#000080">);

  </font><font color="#FF0000"><b>IF </b></font>tfp_ernr<font color="#000080">=</font><font color="#800000">0
    </font><font color="#FF0000"><b>THEN </b></font>Xior<font color="#000080">:=</font>r
    <font color="#FF0000"><b>ELSE </b></font>Xior<font color="#000080">:=</font>Tfp_false<font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>{of xIor}

{---------------------------------------------------------}

</i></font><font color="#FF0000"><b>FUNCTION </b></font>Xpi <font color="#000080">: </font>REAL<font color="#000080">;

</font><font color="#FF0000"><b>BEGIN
  </b></font>Xpi<font color="#000080">:=</font>Pi<font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>{of xPi}

{---------------------------------------------------------}

</i></font><font color="#FF0000"><b>FUNCTION </b></font>Xrad<font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>r <font color="#000080">: </font>REAL<font color="#000080">) : </font>REAL<font color="#000080">;

</font><font color="#FF0000"><b>BEGIN
  </b></font>Xrad<font color="#000080">:=(</font>r<font color="#000080">/</font><font color="#800000">180</font><font color="#000080">)*</font>Pi<font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>{of xRad}

{---------------------------------------------------------}

</i></font><font color="#FF0000"><b>FUNCTION </b></font>Xround<font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>r <font color="#000080">: </font>REAL<font color="#000080">) : </font>REAL<font color="#000080">;

</font><font color="#FF0000"><b>BEGIN
  IF </b></font><font color="#000080">(</font>Abs<font color="#000080">(</font>r<font color="#000080">)&lt;</font>tfp_maxlongint<font color="#000080">)
    </font><font color="#FF0000"><b>THEN </b></font>Xround<font color="#000080">:=</font>Tfp_round<font color="#000080">(</font>r<font color="#000080">)
    </font><font color="#FF0000"><b>ELSE </b></font>Xround<font color="#000080">:=</font>r<font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>{of xRound}

{---------------------------------------------------------}

</i></font><font color="#FF0000"><b>FUNCTION </b></font>Xsgn<font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>r <font color="#000080">: </font>REAL<font color="#000080">) : </font>REAL<font color="#000080">;

</font><font color="#FF0000"><b>BEGIN
  IF </b></font><font color="#000080">(</font>r<font color="#000080">&gt;=</font><font color="#800000">0</font><font color="#000080">)
    </font><font color="#FF0000"><b>THEN </b></font>Xsgn<font color="#000080">:=+</font><font color="#800000">1
    </font><font color="#FF0000"><b>ELSE </b></font>Xsgn<font color="#000080">:=-</font><font color="#800000">1</font><font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>{of xSgn}

{---------------------------------------------------------}

</i></font><font color="#FF0000"><b>FUNCTION </b></font>Xsin<font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>r <font color="#000080">: </font>REAL<font color="#000080">) : </font>REAL<font color="#000080">;

</font><font color="#FF0000"><b>BEGIN
  </b></font>Xsin<font color="#000080">:=</font>Sin<font color="#000080">(</font>r<font color="#000080">);
</font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>{of xSin}

{---------------------------------------------------------}

</i></font><font color="#FF0000"><b>FUNCTION </b></font>Xsqr<font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>r <font color="#000080">: </font>REAL<font color="#000080">) : </font>REAL<font color="#000080">;

</font><font color="#FF0000"><b>BEGIN
  </b></font>Xsqr<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
  </font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>Abs<font color="#000080">(</font>r<font color="#000080">)&gt;</font><font color="#800000">0</font><font color="#000080">)
    </font><font color="#FF0000"><b>THEN
      BEGIN
        IF </b></font><font color="#000080">( </font>Abs<font color="#000080">(</font><font color="#800000">2</font><font color="#000080">*</font>Ln<font color="#000080">(</font>Abs<font color="#000080">(</font>r<font color="#000080">))) )&lt;</font>Ln<font color="#000080">(</font>tfp_maxreal<font color="#000080">)
          </font><font color="#FF0000"><b>THEN </b></font>Xsqr<font color="#000080">:=</font>Exp<font color="#000080">( </font><font color="#800000">2</font><font color="#000080">*</font>Ln<font color="#000080">(</font>Abs<font color="#000080">(</font>r<font color="#000080">)) )
          </font><font color="#FF0000"><b>ELSE </b></font>Tfp_seternr<font color="#000080">(</font><font color="#800000">11</font><font color="#000080">);
      </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>{of xSqr}

{---------------------------------------------------------}

</i></font><font color="#FF0000"><b>FUNCTION </b></font>Xsqrt<font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>r <font color="#000080">: </font>REAL<font color="#000080">) : </font>REAL<font color="#000080">;

</font><font color="#FF0000"><b>BEGIN
  </b></font>Xsqrt<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
  </font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>r<font color="#000080">&gt;=</font><font color="#800000">0</font><font color="#000080">)
    </font><font color="#FF0000"><b>THEN </b></font>Xsqrt<font color="#000080">:=</font>Sqrt<font color="#000080">(</font>r<font color="#000080">)
    </font><font color="#FF0000"><b>ELSE </b></font>Tfp_seternr<font color="#000080">(</font><font color="#800000">8</font><font color="#000080">);
</font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>{of xSqrt}

{---------------------------------------------------------}

</i></font><font color="#FF0000"><b>FUNCTION </b></font>Xtan<font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>r <font color="#000080">: </font>REAL<font color="#000080">) : </font>REAL<font color="#000080">;

</font><font color="#FF0000"><b>BEGIN
  </b></font>Xtan<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
  </font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>Cos<font color="#000080">(</font>r<font color="#000080">)=</font><font color="#800000">0</font><font color="#000080">)
    </font><font color="#FF0000"><b>THEN </b></font>Tfp_seternr<font color="#000080">(</font><font color="#800000">5</font><font color="#000080">)
    </font><font color="#FF0000"><b>ELSE </b></font>Xtan<font color="#000080">:=</font>Sin<font color="#000080">(</font>r<font color="#000080">)/</font>cos<font color="#000080">(</font>r<font color="#000080">);
</font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>{of xTan}

{---------------------------------------------------------}

</i></font><font color="#FF0000"><b>FUNCTION </b></font>Xtrue <font color="#000080">: </font>REAL<font color="#000080">;

</font><font color="#FF0000"><b>BEGIN
  </b></font>Xtrue<font color="#000080">:=</font>tfp_true<font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>{of xTrue}

{---------------------------------------------------------}

</i></font><font color="#FF0000"><b>FUNCTION </b></font>Xxor<font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>r1<font color="#000080">,</font>r2 <font color="#000080">: </font>REAL<font color="#000080">) : </font>REAL<font color="#000080">;

</font><font color="#FF0000"><b>BEGIN
 </b></font>Xxor<font color="#000080">:=</font>tfp_false<font color="#000080">;
 </font><font color="#FF0000"><b>IF </b></font><font color="#000080">((</font>r1<font color="#000080">&lt;&gt;</font>tfp_false<font color="#000080">) </font><font color="#FF0000"><b>AND </b></font><font color="#000080">(</font>r1<font color="#000080">&lt;&gt;</font>tfp_true<font color="#000080">)) </font><font color="#FF0000"><b>OR
    </b></font><font color="#000080">((</font>r2<font color="#000080">&lt;&gt;</font>tfp_false<font color="#000080">) </font><font color="#FF0000"><b>AND </b></font><font color="#000080">(</font>r2<font color="#000080">&lt;&gt;</font>tfp_true<font color="#000080">))
   </font><font color="#FF0000"><b>THEN
     BEGIN
       IF </b></font><font color="#000080">(</font>tfp_ernr<font color="#000080">=</font><font color="#800000">0</font><font color="#000080">)
         </font><font color="#FF0000"><b>THEN </b></font>Tfp_seternr<font color="#000080">(</font><font color="#800000">13</font><font color="#000080">);
     </font><font color="#FF0000"><b>END
   ELSE </b></font>Xxor<font color="#000080">:=</font>tfp_true<font color="#000080">*</font>Ord<font color="#000080">((</font>r1<font color="#000080">=</font>tfp_true<font color="#000080">) </font><font color="#FF0000"><b>XOR </b></font><font color="#000080">(</font>r2<font color="#000080">=</font>tfp_true<font color="#000080">));
</font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>{of xXOR}

{---------------------------------------------------------}
{----Hyperbolic, reciproce and inverse goniometric        }
{    functions                                            }
{---------------------------------------------------------}

</i></font><font color="#FF0000"><b>Function </b></font>xCsc<font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>r<font color="#000080">: </font>Real<font color="#000080">): </font>Real<font color="#000080">;

</font><font color="#FF0000"><b>Begin</b></font><font color="#000080">;
  </font>xCsc<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
  </font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>Sin<font color="#000080">(</font>r<font color="#000080">)=</font><font color="#800000">0</font><font color="#000080">)
    </font><font color="#FF0000"><b>THEN </b></font>Tfp_seternr<font color="#000080">(</font><font color="#800000">17</font><font color="#000080">)
    </font><font color="#FF0000"><b>ELSE </b></font>xCsc<font color="#000080">:=</font><font color="#800000">1</font><font color="#000080">/</font>Sin<font color="#000080">(</font>r<font color="#000080">);
</font><font color="#FF0000"><b>End</b></font><font color="#000080">; </font><font color="#008000"><i>{xCsc}

{---------------------------------------------------------}

</i></font><font color="#FF0000"><b>Function </b></font>xSec<font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>r<font color="#000080">: </font>Real<font color="#000080">): </font>Real<font color="#000080">;

</font><font color="#FF0000"><b>Begin</b></font><font color="#000080">;
  </font>xSec<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
  </font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>Cos<font color="#000080">(</font>r<font color="#000080">)=</font><font color="#800000">0</font><font color="#000080">)
    </font><font color="#FF0000"><b>THEN </b></font>Tfp_seternr<font color="#000080">(</font><font color="#800000">18</font><font color="#000080">)
    </font><font color="#FF0000"><b>ELSE </b></font>xSec<font color="#000080">:=</font><font color="#800000">1</font><font color="#000080">/</font>Cos<font color="#000080">(</font>r<font color="#000080">);
</font><font color="#FF0000"><b>End</b></font><font color="#000080">; </font><font color="#008000"><i>{xSec}

{---------------------------------------------------------}

</i></font><font color="#FF0000"><b>Function </b></font>xCot<font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>r <font color="#000080">: </font>Real<font color="#000080">): </font>Real<font color="#000080">;

</font><font color="#FF0000"><b>Begin</b></font><font color="#000080">;
  </font>xCot<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
  </font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>Sin<font color="#000080">(</font>r<font color="#000080">)=</font><font color="#800000">0</font><font color="#000080">)
    </font><font color="#FF0000"><b>THEN </b></font>Tfp_seternr<font color="#000080">(</font><font color="#800000">19</font><font color="#000080">)
    </font><font color="#FF0000"><b>ELSE </b></font>xCot<font color="#000080">:=</font>Cos<font color="#000080">(</font>r<font color="#000080">)/</font>Sin<font color="#000080">(</font>r<font color="#000080">);
</font><font color="#FF0000"><b>End</b></font><font color="#000080">; </font><font color="#008000"><i>{xCot}

{---------------------------------------------------------}

</i></font><font color="#FF0000"><b>FUNCTION </b></font>xCosh<font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>r <font color="#000080">: </font>REAL<font color="#000080">) : </font>REAL<font color="#000080">;

</font><font color="#FF0000"><b>BEGIN
  </b></font>xCosh<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
  </font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>Abs<font color="#000080">(</font>r<font color="#000080">)&gt;</font>Ln<font color="#000080">(</font>tfp_maxreal<font color="#000080">))
    </font><font color="#FF0000"><b>THEN </b></font>Tfp_seternr<font color="#000080">(</font><font color="#800000">20</font><font color="#000080">)
    </font><font color="#FF0000"><b>ELSE </b></font>xCosh<font color="#000080">:=(</font>Exp<font color="#000080">(</font>r<font color="#000080">)+</font>Exp<font color="#000080">(-</font>r<font color="#000080">))/</font><font color="#800000">2</font><font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>{of xCosh}

{---------------------------------------------------------}

</i></font><font color="#FF0000"><b>FUNCTION </b></font>xSinh<font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>r <font color="#000080">: </font>REAL<font color="#000080">) : </font>REAL<font color="#000080">;

</font><font color="#FF0000"><b>BEGIN
  </b></font>xSinh<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
  </font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>Abs<font color="#000080">(</font>r<font color="#000080">)&gt;</font>Ln<font color="#000080">(</font>tfp_maxreal<font color="#000080">))
    </font><font color="#FF0000"><b>THEN </b></font>Tfp_seternr<font color="#000080">(</font><font color="#800000">20</font><font color="#000080">)
    </font><font color="#FF0000"><b>ELSE </b></font>xSinh<font color="#000080">:=(</font>Exp<font color="#000080">(</font>r<font color="#000080">)-</font>Exp<font color="#000080">(-</font>r<font color="#000080">))/</font><font color="#800000">2</font><font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;  </font><font color="#008000"><i>{of xSinh}

{---------------------------------------------------------}

</i></font><font color="#FF0000"><b>FUNCTION </b></font>xTanh<font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>r <font color="#000080">: </font>REAL<font color="#000080">) : </font>REAL<font color="#000080">;

</font><font color="#FF0000"><b>BEGIN
  </b></font>xTanh<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
  </font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>Abs<font color="#000080">(</font>r<font color="#000080">)&gt;</font>Ln<font color="#000080">(</font>tfp_maxreal<font color="#000080">))
    </font><font color="#FF0000"><b>THEN </b></font>Tfp_seternr<font color="#000080">(</font><font color="#800000">20</font><font color="#000080">)
    </font><font color="#FF0000"><b>ELSE </b></font>xTanh<font color="#000080">:=(</font>Exp<font color="#000080">(</font>r<font color="#000080">)-</font>Exp<font color="#000080">(-</font>r<font color="#000080">))/(</font>Exp<font color="#000080">(</font>r<font color="#000080">)+</font>Exp<font color="#000080">(-</font>r<font color="#000080">));
</font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>{of xTanh}

{---------------------------------------------------------}

</i></font><font color="#FF0000"><b>FUNCTION </b></font>xCsch<font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>r <font color="#000080">: </font>REAL<font color="#000080">) : </font>REAL<font color="#000080">;

</font><font color="#FF0000"><b>BEGIN
  </b></font>xCsch<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
  </font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>Abs<font color="#000080">(</font>r<font color="#000080">)&gt;</font>Ln<font color="#000080">(</font>tfp_maxreal<font color="#000080">))
    </font><font color="#FF0000"><b>THEN </b></font>Tfp_seternr<font color="#000080">(</font><font color="#800000">20</font><font color="#000080">)
    </font><font color="#FF0000"><b>ELSE
      BEGIN
        IF </b></font><font color="#000080">(</font>r<font color="#000080">=</font><font color="#800000">0</font><font color="#000080">)
          </font><font color="#FF0000"><b>THEN </b></font>Tfp_seternr<font color="#000080">(</font><font color="#800000">21</font><font color="#000080">)
          </font><font color="#FF0000"><b>ELSE </b></font>xCsch<font color="#000080">:=</font><font color="#800000">2</font><font color="#000080">/(</font>Exp<font color="#000080">(</font>r<font color="#000080">)-</font>Exp<font color="#000080">(-</font>r<font color="#000080">))
      </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>{of xCsch}

{---------------------------------------------------------}

</i></font><font color="#FF0000"><b>FUNCTION </b></font>xSech<font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>r <font color="#000080">: </font>REAL<font color="#000080">) : </font>REAL<font color="#000080">;

</font><font color="#FF0000"><b>BEGIN
  </b></font>xSech<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
  </font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>Abs<font color="#000080">(</font>r<font color="#000080">)&gt;</font>Ln<font color="#000080">(</font>tfp_maxreal<font color="#000080">))
    </font><font color="#FF0000"><b>THEN </b></font>Tfp_seternr<font color="#000080">(</font><font color="#800000">20</font><font color="#000080">)
    </font><font color="#FF0000"><b>ELSE </b></font>xSech<font color="#000080">:=</font><font color="#800000">2</font><font color="#000080">/(</font>Exp<font color="#000080">(</font>r<font color="#000080">)+</font>Exp<font color="#000080">(-</font>r<font color="#000080">));
</font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>{of xSech}

{---------------------------------------------------------}

</i></font><font color="#FF0000"><b>FUNCTION </b></font>xCoth<font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>r <font color="#000080">: </font>REAL<font color="#000080">) : </font>REAL<font color="#000080">;

</font><font color="#FF0000"><b>BEGIN
  </b></font>xCoth<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
  </font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>Abs<font color="#000080">(</font>r<font color="#000080">)&gt;</font>Ln<font color="#000080">(</font>tfp_maxreal<font color="#000080">))
    </font><font color="#FF0000"><b>THEN </b></font>Tfp_seternr<font color="#000080">(</font><font color="#800000">20</font><font color="#000080">)
    </font><font color="#FF0000"><b>ELSE
      BEGIN
        IF </b></font><font color="#000080">(</font>r<font color="#000080">=</font><font color="#800000">0</font><font color="#000080">)
          </font><font color="#FF0000"><b>THEN </b></font>Tfp_seternr<font color="#000080">(</font><font color="#800000">22</font><font color="#000080">)
          </font><font color="#FF0000"><b>ELSE </b></font>xCoth<font color="#000080">:=(</font>Exp<font color="#000080">(</font>r<font color="#000080">)+</font>Exp<font color="#000080">(-</font>r<font color="#000080">))/(</font>Exp<font color="#000080">(</font>r<font color="#000080">)-</font>Exp<font color="#000080">(-</font>r<font color="#000080">))
      </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>{of xCoth}

{---------------------------------------------------------}

</i></font><font color="#FF0000"><b>FUNCTION </b></font>xArcsinh<font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>r <font color="#000080">: </font>REAL<font color="#000080">) : </font>REAL<font color="#000080">;

</font><font color="#FF0000"><b>BEGIN
  </b></font>xArcsinh<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
  </font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>Abs<font color="#000080">(</font>r<font color="#000080">)&lt;</font>SQRT<font color="#000080">(</font>tfp_maxreal<font color="#000080">))
    </font><font color="#FF0000"><b>THEN </b></font>xArcsinh<font color="#000080">:=</font>Ln<font color="#000080">(</font>r<font color="#000080">+</font>Sqrt<font color="#000080">(</font>Sqr<font color="#000080">(</font>r<font color="#000080">)+</font><font color="#800000">1</font><font color="#000080">))
    </font><font color="#FF0000"><b>ELSE </b></font>Tfp_seternr<font color="#000080">(</font><font color="#800000">20</font><font color="#000080">)
</font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>{of xArcsinh}

{---------------------------------------------------------}

</i></font><font color="#FF0000"><b>FUNCTION </b></font>xArccosh<font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>r <font color="#000080">: </font>REAL<font color="#000080">) : </font>REAL<font color="#000080">;

</font><font color="#FF0000"><b>BEGIN
  </b></font>xArccosh<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
  </font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>Abs<font color="#000080">(</font>r<font color="#000080">)&lt;</font>SQRT<font color="#000080">(</font>tfp_maxreal<font color="#000080">))
    </font><font color="#FF0000"><b>THEN
      BEGIN
        IF </b></font><font color="#000080">(</font>r<font color="#000080">&gt;=</font><font color="#800000">1</font><font color="#000080">)
          </font><font color="#FF0000"><b>THEN </b></font>xArccosh<font color="#000080">:=</font>ln<font color="#000080">(</font>r<font color="#000080">+</font>Sqrt<font color="#000080">(</font>Sqr<font color="#000080">(</font>r<font color="#000080">)-</font><font color="#800000">1</font><font color="#000080">))
          </font><font color="#FF0000"><b>ELSE </b></font>Tfp_seternr<font color="#000080">(</font><font color="#800000">23</font><font color="#000080">);
      </font><font color="#FF0000"><b>END
    ELSE </b></font>Tfp_seternr<font color="#000080">(</font><font color="#800000">20</font><font color="#000080">)
</font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>{of xArccosh}

{---------------------------------------------------------}

</i></font><font color="#FF0000"><b>FUNCTION </b></font>xArctanh<font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>r <font color="#000080">: </font>REAL<font color="#000080">) : </font>REAL<font color="#000080">;

</font><font color="#FF0000"><b>BEGIN
  </b></font>xArctanh<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
  </font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>Abs<font color="#000080">(</font>r<font color="#000080">)&lt;</font><font color="#800000">1</font><font color="#000080">)
    </font><font color="#FF0000"><b>THEN </b></font>xArctanh<font color="#000080">:=</font>ln<font color="#000080">( (</font><font color="#800000">1</font><font color="#000080">+</font>r<font color="#000080">)/(</font><font color="#800000">1</font><font color="#000080">-</font>r<font color="#000080">) )/</font><font color="#800000">2
    </font><font color="#FF0000"><b>ELSE </b></font>Tfp_seternr<font color="#000080">(</font><font color="#800000">24</font><font color="#000080">)
</font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>{of xArctanh}

{---------------------------------------------------------}

</i></font><font color="#FF0000"><b>FUNCTION </b></font>xArccsch<font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>r <font color="#000080">: </font>REAL<font color="#000080">) : </font>REAL<font color="#000080">;

</font><font color="#FF0000"><b>BEGIN
  </b></font>xArccsch<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
  </font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>r<font color="#000080">&lt;</font>SQRT<font color="#000080">(</font>Tfp_maxreal<font color="#000080">))
    </font><font color="#FF0000"><b>THEN
      BEGIN
        IF </b></font><font color="#000080">(</font>r<font color="#000080">&lt;&gt;</font><font color="#800000">0</font><font color="#000080">)
          </font><font color="#FF0000"><b>THEN </b></font>xArccsch<font color="#000080">:=</font>Ln<font color="#000080">( (</font><font color="#800000">1</font><font color="#000080">/</font>r<font color="#000080">) + </font>SQRT<font color="#000080">( (</font><font color="#800000">1</font><font color="#000080">/</font>SQR<font color="#000080">(</font>r<font color="#000080">))+</font><font color="#800000">1</font><font color="#000080">))
          </font><font color="#FF0000"><b>ELSE </b></font>Tfp_seternr<font color="#000080">(</font><font color="#800000">25</font><font color="#000080">)
      </font><font color="#FF0000"><b>END
    ELSE </b></font>Tfp_seternr<font color="#000080">(</font><font color="#800000">20</font><font color="#000080">);
</font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>{of xArccsch}

{---------------------------------------------------------}

</i></font><font color="#FF0000"><b>FUNCTION </b></font>xArcsech<font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>r <font color="#000080">: </font>REAL<font color="#000080">) : </font>REAL<font color="#000080">;

</font><font color="#FF0000"><b>BEGIN
  </b></font>xArcsech<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
  </font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>r<font color="#000080">&lt;</font>SQRT<font color="#000080">(</font>Tfp_maxreal<font color="#000080">))
    </font><font color="#FF0000"><b>THEN
      BEGIN
        IF </b></font><font color="#000080">(</font>r<font color="#000080">&gt;</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>AND </b></font><font color="#000080">(</font>r<font color="#000080">&lt;=</font><font color="#800000">1</font><font color="#000080">)
          </font><font color="#FF0000"><b>THEN </b></font>xArcsech<font color="#000080">:=</font>Ln<font color="#000080">( (</font><font color="#800000">1</font><font color="#000080">/</font>r<font color="#000080">) + </font>SQRT<font color="#000080">( (</font><font color="#800000">1</font><font color="#000080">/</font>SQR<font color="#000080">(</font>r<font color="#000080">))-</font><font color="#800000">1</font><font color="#000080">))
          </font><font color="#FF0000"><b>ELSE </b></font>Tfp_seternr<font color="#000080">(</font><font color="#800000">26</font><font color="#000080">)
      </font><font color="#FF0000"><b>END
    ELSE </b></font>Tfp_seternr<font color="#000080">(</font><font color="#800000">20</font><font color="#000080">)
</font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>{of xArcsech}

{---------------------------------------------------------}

</i></font><font color="#FF0000"><b>FUNCTION </b></font>xArccoth<font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>r <font color="#000080">: </font>REAL<font color="#000080">) : </font>REAL<font color="#000080">;

</font><font color="#FF0000"><b>BEGIN
  </b></font>xArccoth<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
  </font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>Abs<font color="#000080">(</font>r<font color="#000080">)&gt;</font><font color="#800000">1</font><font color="#000080">)
    </font><font color="#FF0000"><b>THEN </b></font>xArccoth<font color="#000080">:=</font>Ln<font color="#000080">( (</font>r<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">)/(</font>r<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">) )/</font><font color="#800000">2
    </font><font color="#FF0000"><b>ELSE </b></font>Tfp_seternr<font color="#000080">(</font><font color="#800000">27</font><font color="#000080">)
</font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>{of xArccoth}

{$F-}

{---------------------------------------------------------}

</i></font><font color="#FF0000"><b>PROCEDURE </b></font>Tfp_addgonio<font color="#000080">;

</font><font color="#FF0000"><b>BEGIN
  </b></font>Tfp_expand<font color="#000080">(</font><font color="#800000">7</font><font color="#000080">);
  </font>Tfp_addobj<font color="#000080">(@</font>xarctan<font color="#000080">,</font><font color="#800000">'ARCTAN'</font><font color="#000080">,</font>tfp_1real<font color="#000080">);
  </font>Tfp_addobj<font color="#000080">(@</font>xcos   <font color="#000080">,</font><font color="#800000">'COS'   </font><font color="#000080">,</font>tfp_1real<font color="#000080">);
  </font>Tfp_addobj<font color="#000080">(@</font>xdeg   <font color="#000080">,</font><font color="#800000">'DEG'   </font><font color="#000080">,</font>tfp_1real<font color="#000080">);
  </font>Tfp_addobj<font color="#000080">(@</font>xpi    <font color="#000080">,</font><font color="#800000">'PI'    </font><font color="#000080">,</font>tfp_noparm<font color="#000080">);
  </font>Tfp_addobj<font color="#000080">(@</font>xrad   <font color="#000080">,</font><font color="#800000">'RAD'   </font><font color="#000080">,</font>tfp_1real<font color="#000080">);
  </font>Tfp_addobj<font color="#000080">(@</font>xsin   <font color="#000080">,</font><font color="#800000">'SIN'   </font><font color="#000080">,</font>tfp_1real<font color="#000080">);
  </font>Tfp_addobj<font color="#000080">(@</font>xtan   <font color="#000080">,</font><font color="#800000">'TAN'   </font><font color="#000080">,</font>tfp_1real<font color="#000080">);
</font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>{of Tfp_Addgonio}

{---------------------------------------------------------}

</i></font><font color="#FF0000"><b>PROCEDURE </b></font>Tfp_addlogic<font color="#000080">;

</font><font color="#FF0000"><b>BEGIN
  </b></font>Tfp_expand<font color="#000080">(</font><font color="#800000">5</font><font color="#000080">);
  </font>Tfp_addobj<font color="#000080">(@</font>xand      <font color="#000080">,</font><font color="#800000">'AND'   </font><font color="#000080">,</font>tfp_nreal<font color="#000080">);
  </font>Tfp_addobj<font color="#000080">(@</font>xfalse    <font color="#000080">,</font><font color="#800000">'FALSE' </font><font color="#000080">,</font>tfp_noparm<font color="#000080">);
  </font>Tfp_addobj<font color="#000080">(@</font>xior      <font color="#000080">,</font><font color="#800000">'OR'    </font><font color="#000080">,</font>tfp_nreal<font color="#000080">);
  </font>Tfp_addobj<font color="#000080">(@</font>xtrue     <font color="#000080">,</font><font color="#800000">'TRUE'  </font><font color="#000080">,</font>tfp_noparm<font color="#000080">);
  </font>Tfp_addobj<font color="#000080">(@</font>xxor      <font color="#000080">,</font><font color="#800000">'XOR'   </font><font color="#000080">,</font>tfp_2real<font color="#000080">);
</font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>{of Tfp_Addlogic}

{---------------------------------------------------------}

</i></font><font color="#FF0000"><b>PROCEDURE </b></font>Tfp_addmath<font color="#000080">;

</font><font color="#FF0000"><b>BEGIN
  </b></font>Tfp_expand<font color="#000080">(</font><font color="#800000">7</font><font color="#000080">);
  </font>Tfp_addobj<font color="#000080">(@</font>xabs   <font color="#000080">,</font><font color="#800000">'ABS'   </font><font color="#000080">,</font>tfp_1real<font color="#000080">);
  </font>Tfp_addobj<font color="#000080">(@</font>xexp   <font color="#000080">,</font><font color="#800000">'EXP'   </font><font color="#000080">,</font>tfp_1real<font color="#000080">);
  </font>Tfp_addobj<font color="#000080">(@</font>xe     <font color="#000080">,</font><font color="#800000">'E'     </font><font color="#000080">,</font>tfp_noparm<font color="#000080">);
  </font>Tfp_addobj<font color="#000080">(@</font>xln    <font color="#000080">,</font><font color="#800000">'LN'    </font><font color="#000080">,</font>tfp_1real<font color="#000080">);
  </font>Tfp_addobj<font color="#000080">(@</font>xlog   <font color="#000080">,</font><font color="#800000">'LOG'   </font><font color="#000080">,</font>tfp_1real<font color="#000080">);
  </font>Tfp_addobj<font color="#000080">(@</font>xsqr   <font color="#000080">,</font><font color="#800000">'SQR'   </font><font color="#000080">,</font>tfp_1real<font color="#000080">);
  </font>Tfp_addobj<font color="#000080">(@</font>xsqrt  <font color="#000080">,</font><font color="#800000">'SQRT'  </font><font color="#000080">,</font>tfp_1real<font color="#000080">);
</font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>{of Tfp_Addmath}

{---------------------------------------------------------}

</i></font><font color="#FF0000"><b>PROCEDURE </b></font>Tfp_addmisc<font color="#000080">;

</font><font color="#FF0000"><b>BEGIN
  </b></font>Tfp_expand<font color="#000080">(</font><font color="#800000">6</font><font color="#000080">);
  </font>Tfp_addobj<font color="#000080">(@</font>xfrac  <font color="#000080">,</font><font color="#800000">'FRAC'  </font><font color="#000080">,</font>tfp_1real<font color="#000080">);
  </font>Tfp_addobj<font color="#000080">(@</font>xint   <font color="#000080">,</font><font color="#800000">'INT'   </font><font color="#000080">,</font>tfp_1real<font color="#000080">);
  </font>Tfp_addobj<font color="#000080">(@</font>xmax   <font color="#000080">,</font><font color="#800000">'MAX'   </font><font color="#000080">,</font>tfp_nreal<font color="#000080">);
  </font>Tfp_addobj<font color="#000080">(@</font>xmin   <font color="#000080">,</font><font color="#800000">'MIN'   </font><font color="#000080">,</font>tfp_nreal<font color="#000080">);
  </font>Tfp_addobj<font color="#000080">(@</font>xround <font color="#000080">,</font><font color="#800000">'ROUND' </font><font color="#000080">,</font>tfp_1real<font color="#000080">);
  </font>Tfp_addobj<font color="#000080">(@</font>xsgn   <font color="#000080">,</font><font color="#800000">'SGN'   </font><font color="#000080">,</font>tfp_1real<font color="#000080">);
</font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>{of Tfp_Addmisc}

{---------------------------------------------------------}

</i></font><font color="#FF0000"><b>PROCEDURE </b></font>Tfp_addinvarchyper<font color="#000080">;

</font><font color="#FF0000"><b>BEGIN
  </b></font>Tfp_expand<font color="#000080">(</font><font color="#800000">15</font><font color="#000080">);
  </font>Tfp_addobj<font color="#000080">(@</font>xcsc    <font color="#000080">,</font><font color="#800000">'CSC'    </font><font color="#000080">,</font>tfp_1real<font color="#000080">);
  </font>Tfp_addobj<font color="#000080">(@</font>xsec    <font color="#000080">,</font><font color="#800000">'SEC'    </font><font color="#000080">,</font>tfp_1real<font color="#000080">);
  </font>Tfp_addobj<font color="#000080">(@</font>xcot    <font color="#000080">,</font><font color="#800000">'COT'    </font><font color="#000080">,</font>tfp_1real<font color="#000080">);

  </font>Tfp_addobj<font color="#000080">(@</font>xsinh   <font color="#000080">,</font><font color="#800000">'SINH'   </font><font color="#000080">,</font>tfp_1real<font color="#000080">);
  </font>Tfp_addobj<font color="#000080">(@</font>xcosh   <font color="#000080">,</font><font color="#800000">'COSH'   </font><font color="#000080">,</font>tfp_1real<font color="#000080">);
  </font>Tfp_addobj<font color="#000080">(@</font>xtanh   <font color="#000080">,</font><font color="#800000">'TANH'   </font><font color="#000080">,</font>tfp_1real<font color="#000080">);

  </font>Tfp_addobj<font color="#000080">(@</font>xcsch   <font color="#000080">,</font><font color="#800000">'CSCH'   </font><font color="#000080">,</font>tfp_1real<font color="#000080">);
  </font>Tfp_addobj<font color="#000080">(@</font>xsech   <font color="#000080">,</font><font color="#800000">'SECH'   </font><font color="#000080">,</font>tfp_1real<font color="#000080">);
  </font>Tfp_addobj<font color="#000080">(@</font>xcoth   <font color="#000080">,</font><font color="#800000">'COTH'   </font><font color="#000080">,</font>tfp_1real<font color="#000080">);

  </font>Tfp_addobj<font color="#000080">(@</font>xarcsinh<font color="#000080">,</font><font color="#800000">'ARCSINH'</font><font color="#000080">,</font>tfp_1real<font color="#000080">);
  </font>Tfp_addobj<font color="#000080">(@</font>xarccosh<font color="#000080">,</font><font color="#800000">'ARCCOSH'</font><font color="#000080">,</font>tfp_1real<font color="#000080">);
  </font>Tfp_addobj<font color="#000080">(@</font>xarctanh<font color="#000080">,</font><font color="#800000">'ARCTANH'</font><font color="#000080">,</font>tfp_1real<font color="#000080">);

  </font>Tfp_addobj<font color="#000080">(@</font>xarccsch<font color="#000080">,</font><font color="#800000">'ARCCSCH'</font><font color="#000080">,</font>tfp_1real<font color="#000080">);
  </font>Tfp_addobj<font color="#000080">(@</font>xarcsech<font color="#000080">,</font><font color="#800000">'ARCSECH'</font><font color="#000080">,</font>tfp_1real<font color="#000080">);
  </font>Tfp_addobj<font color="#000080">(@</font>xarccoth<font color="#000080">,</font><font color="#800000">'ARCCOTH'</font><font color="#000080">,</font>tfp_1real<font color="#000080">);
</font><font color="#FF0000"><b>End</b></font><font color="#000080">; </font><font color="#008000"><i>{of Add_invandhyper}

{---------------------------------------------------------}

</i></font><font color="#FF0000"><b>PROCEDURE </b></font>Tfp_addall<font color="#000080">;

</font><font color="#FF0000"><b>BEGIN
  </b></font>Tfp_addgonio<font color="#000080">;
  </font>Tfp_addlogic<font color="#000080">;
  </font>Tfp_addmath<font color="#000080">;
  </font>Tfp_addmisc<font color="#000080">;
  </font>Tfp_addinvarchyper<font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>{of Tfp_addall}

{---------------------------------------------------------}

</i></font><font color="#FF0000"><b>BEGIN
</b></font><font color="#008000"><i>{----Module Init}
  </i></font>tfp_erpos <font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
  </font>tfp_ernr  <font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
  </font>fiesiz<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
  </font>maxfie<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
  </font>fiearr<font color="#000080">:=</font><font color="#FF0000"><b>NIL</b></font><font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to MATH SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0073.PAS">Original</a><b>]</b></p></body>
</html>
