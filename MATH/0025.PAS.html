<html>
<head><title> "Dividing Fixed Integers" by SEAN PALMER</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to MATH SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0025.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
SEAN PALMER

I'm using TP. Here are the fixed division routines I'm currently using
(they are, as you can see, quite specialized)

I had to abandon the original fixed division routines because I didn't
know how to translate the 386-specific instructions using DB. (MOVSX,
SHLD, etc)
}

</i></font><font color="#FF0000"><b>type
  </b></font>fixed <font color="#000080">= </font><font color="#FF0000"><b>record
    </b></font>f <font color="#000080">: </font>word<font color="#000080">;
    </font>i <font color="#000080">: </font>integer<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font>shortFixed <font color="#000080">= </font><font color="#FF0000"><b>record
    </b></font>f <font color="#000080">: </font>byte<font color="#000080">;
    </font>i <font color="#000080">: </font>shortint<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{ this one divides a fixed by a fixed, result is fixed needs 386 }

</i></font><font color="#FF0000"><b>function </b></font>fixedDiv<font color="#000080">(</font>d1<font color="#000080">, </font>d2 <font color="#000080">: </font>longint<font color="#000080">) : </font>longint<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>asm
  </b></font><font color="#FF00FF">db $66; xor dx, dx
  mov cx, word ptr D1 + 2
  or cx, cx
  jns @S
  db $66; dec dx
 @S:
  mov dx, cx
  mov ax, word ptr D1
  db $66; shl ax, 16
  db $66; idiv word ptr d2
  db $66; mov dx, ax
  db $66; shr dx, 16
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{ this one divides a longint by a longint, result is fixed needs 386 }

</i></font><font color="#FF0000"><b>function </b></font>div2Fixed<font color="#000080">(</font>d1<font color="#000080">, </font>d2 <font color="#000080">: </font>longint<font color="#000080">) : </font>longint<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>asm
  </b></font><font color="#FF00FF">db $66; xor dx, dx
  db $66; mov ax, word ptr d1
  db $66; shl ax, 16
  jns @S;
  db $66; dec dx
 @S:
  db $66; idiv word ptr d2
  db $66; mov dx, ax
  db $66; shr dx, 16
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{ this one divides an integer by and integer, result is shortFixed }

</i></font><font color="#FF0000"><b>function </b></font>divfix<font color="#000080">(</font>d1<font color="#000080">, </font>d2 <font color="#000080">: </font>integer<font color="#000080">) : </font>integer<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>asm
  </b></font><font color="#FF00FF">mov al, byte
  ptr d1 + 1
  cbw
  mov dx, ax
  xor al, al
  mov ah, byte ptr d1
  idiv d2
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to MATH SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0025.PAS">Original</a><b>]</b></p></body>
</html>
