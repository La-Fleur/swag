<html>
<head><title> "Fourier Transformations" by JACK BAKKER</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to MATH SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0092.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
&gt; I'm Looking for a source for a FFT of the Soundblaster
&gt; Input. Could somebody help me?

Do you know the basics of Fourier Transformation?
Not that you need to, for this routine, but it might be handy to know.
Anyhow, here's something I still didn't test:
}

</i></font><font color="#FF0000"><b>Program </b></font>FOURIER<font color="#000080">;

</font><font color="#008000"><i>{ Real FFT with single sine look-up per pass }

</i></font><font color="#FF0000"><b>Const
  </b></font>Asize <font color="#000080">= </font><font color="#800000">4096</font><font color="#000080">;           </font><font color="#008000"><i>{ Size of array goes here }
  </i></font>PI2   <font color="#000080">= </font><font color="#800000">1.570796327</font><font color="#000080">;    </font><font color="#008000"><i>{ PI/2 }
  </i></font>F     <font color="#000080">= </font><font color="#800000">16</font><font color="#000080">;             </font><font color="#008000"><i>{ Format constants }
  </i></font>D     <font color="#000080">= </font><font color="#800000">6</font><font color="#000080">;              </font><font color="#008000"><i>{   &quot;      &quot; }

</i></font><font color="#FF0000"><b>Type
  </b></font>Xform <font color="#000080">= (</font>Fwd<font color="#000080">,</font>Inverse<font color="#000080">);  </font><font color="#008000"><i>{ Transform types }
  </i></font>Xary  <font color="#000080">= </font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font>Asize<font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Real<font color="#000080">;

</font><font color="#FF0000"><b>Var
  </b></font>I<font color="#000080">,</font>j<font color="#000080">,</font>N<font color="#000080">,</font>modulo   <font color="#000080">: </font>Integer<font color="#000080">;
  </font>F1    <font color="#000080">: </font>Text<font color="#000080">;  </font><font color="#008000"><i>{ File of Real;}
  </i></font>X     <font color="#000080">: </font>Xary<font color="#000080">;           </font><font color="#008000"><i>{ Array to transform }
  </i></font>Inv   <font color="#000080">: </font>Xform<font color="#000080">;          </font><font color="#008000"><i>{ Transform type - Forward or Inverse }
  </i></font>w     <font color="#000080">: </font>Real<font color="#000080">;           </font><font color="#008000"><i>{ Frequency of wave }

{*****************************************************************************}

</i></font><font color="#FF0000"><b>Procedure </b></font>Debug<font color="#000080">;          </font><font color="#008000"><i>{ Used to print intermediate results }

</i></font><font color="#FF0000"><b>Var </b></font>I3 <font color="#000080">: </font>Integer<font color="#000080">;

</font><font color="#FF0000"><b>Begin
  For </b></font>I3 <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>N <font color="#FF0000"><b>Do
    </b></font>Writeln<font color="#000080">((</font>I3<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">):</font><font color="#800000">3</font><font color="#000080">,</font>X<font color="#000080">[</font>I3<font color="#000080">]:</font>F<font color="#000080">:</font>D<font color="#000080">);
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;    </font><font color="#008000"><i>{ Debug }

{*****************************************************************************}

</i></font><font color="#FF0000"><b>Function </b></font>Ibitr<font color="#000080">(</font>j<font color="#000080">,</font>nu <font color="#000080">: </font>Integer<font color="#000080">) : </font>Integer<font color="#000080">;
  </font><font color="#008000"><i>{ Function to bit invert the number j by nu bits }

</i></font><font color="#FF0000"><b>Var
  </b></font>i<font color="#000080">,</font>j2<font color="#000080">,</font>ib    <font color="#000080">: </font>Integer<font color="#000080">;

</font><font color="#FF0000"><b>Begin
  </b></font>ib <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;   </font><font color="#008000"><i>{ Default return integer }
  </i></font><font color="#FF0000"><b>For </b></font>i <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>nu <font color="#FF0000"><b>do
  Begin
    </b></font>j2 <font color="#000080">:= </font>j <font color="#FF0000"><b>Div </b></font><font color="#800000">2</font><font color="#000080">;          </font><font color="#008000"><i>{ Divide by 2 and compare lowest bits }
    { ib is doubled and bit 0 set to 1 if j is odd }
    </i></font>ib <font color="#000080">:= </font>ib<font color="#000080">*</font><font color="#800000">2 </font><font color="#000080">+ (</font>j <font color="#000080">- </font><font color="#800000">2</font><font color="#000080">*</font>j2<font color="#000080">);
    </font>j <font color="#000080">:= </font>j2<font color="#000080">;                </font><font color="#008000"><i>{ For next pass }
  </i></font><font color="#FF0000"><b>End</b></font><font color="#000080">;  </font><font color="#008000"><i>{For}
  </i></font>ibitr <font color="#000080">:= </font>ib<font color="#000080">;              </font><font color="#008000"><i>{ Return bit inverted value }
</i></font><font color="#FF0000"><b>End</b></font><font color="#000080">;    </font><font color="#008000"><i>{ Ibitr }

{*****************************************************************************}

</i></font><font color="#FF0000"><b>Procedure </b></font>Expand<font color="#000080">;

</font><font color="#FF0000"><b>Var
  </b></font>i<font color="#000080">,</font>nn2<font color="#000080">,</font>nx2    <font color="#000080">: </font>Integer<font color="#000080">;

</font><font color="#FF0000"><b>Begin
  </b></font>nn2 <font color="#000080">:= </font>n <font color="#FF0000"><b>div </b></font><font color="#800000">2</font><font color="#000080">;
  </font>nx2 <font color="#000080">:= </font>n <font color="#000080">+ </font>n<font color="#000080">;
  </font><font color="#FF0000"><b>For </b></font>i <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>nn2 <font color="#FF0000"><b>do </b></font>x<font color="#000080">[</font>i<font color="#000080">+</font>n<font color="#000080">] := </font>x<font color="#000080">[</font>i<font color="#000080">+</font>nn2<font color="#000080">]; </font><font color="#008000"><i>{ Copy IM to 1st half IM position }
  </i></font><font color="#FF0000"><b>For </b></font>i <font color="#000080">:= </font><font color="#800000">2 </font><font color="#FF0000"><b>to </b></font>nn2 <font color="#FF0000"><b>do
  Begin
    </b></font>x<font color="#000080">[</font>nx2<font color="#000080">-</font>i<font color="#000080">+</font><font color="#800000">2</font><font color="#000080">] := -</font>x<font color="#000080">[</font>i<font color="#000080">+</font>n<font color="#000080">];    </font><font color="#008000"><i>{ Replicate 2nd half Imag as negative }
    </i></font>x<font color="#000080">[</font>n<font color="#000080">-</font>i<font color="#000080">+</font><font color="#800000">2</font><font color="#000080">] := </font>x<font color="#000080">[</font>i<font color="#000080">];         </font><font color="#008000"><i>{ Replicate 2nd half Real as mirror image }
  </i></font><font color="#FF0000"><b>End</b></font><font color="#000080">;
  </font>n <font color="#000080">:= </font>nx2<font color="#000080">;       </font><font color="#008000"><i>{ We have doubled number of points }
</i></font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#008000"><i>{*****************************************************************************}

</i></font><font color="#FF0000"><b>Procedure </b></font>Post<font color="#000080">(</font>inv <font color="#000080">: </font>Xform<font color="#000080">);
  </font><font color="#008000"><i>{ Post processing for forward real transforms and pre-processing for inverse
    real transforms, depending on state of the variable inv. }

</i></font><font color="#FF0000"><b>Var
  </b></font>nn2<font color="#000080">,</font>nn4<font color="#000080">,</font>l<font color="#000080">,</font>i<font color="#000080">,</font>m<font color="#000080">,</font>ipn2<font color="#000080">,</font>mpn2   <font color="#000080">: </font>Integer<font color="#000080">;
  </font>arg<font color="#000080">,</font>rmsin<font color="#000080">,</font>rmcos<font color="#000080">,</font>ipcos<font color="#000080">,</font>ipsin<font color="#000080">,</font>ic<font color="#000080">,</font>is1<font color="#000080">,</font>rp<font color="#000080">,</font>rm<font color="#000080">,</font>ip<font color="#000080">,</font>im   <font color="#000080">: </font>Real<font color="#000080">;

</font><font color="#FF0000"><b>Begin
  </b></font>nn2 <font color="#000080">:= </font>n <font color="#FF0000"><b>div </b></font><font color="#800000">2</font><font color="#000080">;   </font><font color="#008000"><i>{ n is global }
  </i></font>nn4 <font color="#000080">:= </font>n <font color="#FF0000"><b>div </b></font><font color="#800000">4</font><font color="#000080">;
  </font><font color="#008000"><i>{ imax represents PI/2 }
  </i></font><font color="#FF0000"><b>For </b></font>l <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>nn4 <font color="#FF0000"><b>Do
  </b></font><font color="#008000"><i>{ Start at ends of array and work towards middle }
  </i></font><font color="#FF0000"><b>Begin
    </b></font>i <font color="#000080">:= </font>l<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">;       </font><font color="#008000"><i>{ Point near beginning }
    </i></font>m <font color="#000080">:= </font>nn2<font color="#000080">-</font>i<font color="#000080">+</font><font color="#800000">2</font><font color="#000080">;   </font><font color="#008000"><i>{ Point near end }
    </i></font>ipn2 <font color="#000080">:= </font>i<font color="#000080">+</font>nn2<font color="#000080">;  </font><font color="#008000"><i>{ Avoids recalculation each time }
    </i></font>mpn2 <font color="#000080">:= </font>m<font color="#000080">+</font>nn2<font color="#000080">;  </font><font color="#008000"><i>{ Calcs ptrs to imaginary part }
    </i></font>rp <font color="#000080">:= </font>x<font color="#000080">[</font>i<font color="#000080">]+</font>x<font color="#000080">[</font>m<font color="#000080">];
    </font>rm <font color="#000080">:= </font>x<font color="#000080">[</font>i<font color="#000080">]-</font>x<font color="#000080">[</font>m<font color="#000080">];
    </font>ip <font color="#000080">:= </font>x<font color="#000080">[</font>ipn2<font color="#000080">]+</font>x<font color="#000080">[</font>mpn2<font color="#000080">];
    </font>im <font color="#000080">:= </font>x<font color="#000080">[</font>ipn2<font color="#000080">]-</font>x<font color="#000080">[</font>mpn2<font color="#000080">];
    </font><font color="#008000"><i>{ Take cosine of PI/2 }
    </i></font>arg <font color="#000080">:= (</font>Pi2<font color="#000080">/</font>nn4<font color="#000080">)*(</font>i<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">);
    </font>ic <font color="#000080">:= </font>Cos<font color="#000080">(</font>arg<font color="#000080">);
    </font><font color="#008000"><i>{ Cosine term is minus if inverse }
    </i></font><font color="#FF0000"><b>If </b></font>inv <font color="#000080">= </font>Inverse <font color="#FF0000"><b>Then </b></font>ic <font color="#000080">:= -</font>ic<font color="#000080">;
    </font>Is1 <font color="#000080">:= </font>Sin<font color="#000080">(</font>arg<font color="#000080">);
    </font>ipcos <font color="#000080">:= </font>ip<font color="#000080">*</font>ic<font color="#000080">;  </font><font color="#008000"><i>{ Avoid remultiplication below }
    </i></font>ipsin <font color="#000080">:= </font>ip<font color="#000080">*</font>is1<font color="#000080">;
    </font>rmsin <font color="#000080">:= </font>rm<font color="#000080">*</font>is1<font color="#000080">;
    </font>rmcos <font color="#000080">:= </font>rm<font color="#000080">*</font>ic<font color="#000080">;
    </font>x<font color="#000080">[</font>i<font color="#000080">] := (</font>rp <font color="#000080">+ </font>ipcos <font color="#000080">- </font>rmsin<font color="#000080">)/</font><font color="#800000">2.0</font><font color="#000080">;    </font><font color="#008000"><i>{* Combine for real-1st pt }
    </i></font>x<font color="#000080">[</font>ipn2<font color="#000080">] := (</font>im <font color="#000080">- </font>ipsin <font color="#000080">- </font>rmcos<font color="#000080">)/</font><font color="#800000">2.0</font><font color="#000080">; </font><font color="#008000"><i>{* Imag-1st point }
    </i></font>x<font color="#000080">[</font>m<font color="#000080">] := (</font>rp <font color="#000080">- </font>ipcos <font color="#000080">+ </font>rmsin<font color="#000080">)/</font><font color="#800000">2.0</font><font color="#000080">;    </font><font color="#008000"><i>{* Real - last pt }
    </i></font>x<font color="#000080">[</font>mpn2<font color="#000080">] := -(</font>im <font color="#000080">+</font>ipsin <font color="#000080">+</font>rmcos<font color="#000080">)/</font><font color="#800000">2.0</font><font color="#000080">;  </font><font color="#008000"><i>{* Imag, last pt }
  </i></font><font color="#FF0000"><b>End</b></font><font color="#000080">;  </font><font color="#008000"><i>{ For }
  </i></font>x<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">] := </font>x<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">]+</font>x<font color="#000080">[</font>nn2<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">];    </font><font color="#008000"><i>{** For first complex pair}
  </i></font>x<font color="#000080">[</font>nn2<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">] := </font><font color="#800000">0.0</font><font color="#000080">;          </font><font color="#008000"><i>{**}
</i></font><font color="#FF0000"><b>End</b></font><font color="#000080">;    </font><font color="#008000"><i>{ Post }

{*****************************************************************************}

</i></font><font color="#FF0000"><b>Procedure </b></font>Shuffl<font color="#000080">(</font>inv <font color="#000080">: </font>Xform<font color="#000080">);
  </font><font color="#008000"><i>{ This procedure shuffels points from alternate real-imaginary to
    1st-half real, 2nd-half imaginary order if inv=Fwd, and reverses the
    process if inv=Inverse.  Algorithm is much like Cooley-Tukey:
      Starts with large cells and works to smaller ones for Fwd
      Starts with small cells and increases if inverse }

</i></font><font color="#FF0000"><b>Var
  </b></font>i<font color="#000080">,</font>j<font color="#000080">,</font>k<font color="#000080">,</font>ipcm1<font color="#000080">,</font>celdis<font color="#000080">,</font>celnum<font color="#000080">,</font>parnum  <font color="#000080">: </font>Integer<font color="#000080">;
  </font>xtemp                             <font color="#000080">: </font>Real<font color="#000080">;

</font><font color="#FF0000"><b>Begin
  </b></font><font color="#008000"><i>{ Choose whether to start with large cells and go down or start with small
    cells and increase }

  </i></font><font color="#FF0000"><b>Case </b></font>inv <font color="#FF0000"><b>Of

  </b></font>Fwd<font color="#000080">: </font><font color="#FF0000"><b>Begin
    </b></font>celdis <font color="#000080">:= </font>n <font color="#FF0000"><b>div </b></font><font color="#800000">2</font><font color="#000080">;     </font><font color="#008000"><i>{ Distance between cells }
    </i></font>celnum <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;           </font><font color="#008000"><i>{ One cell in first pass }
    </i></font>parnum <font color="#000080">:= </font>n <font color="#FF0000"><b>div </b></font><font color="#800000">4</font><font color="#000080">;     </font><font color="#008000"><i>{ n/4 pairs per cell in 1st pass }
    </i></font><font color="#FF0000"><b>End</b></font><font color="#000080">;   </font><font color="#008000"><i>{ Fwd case }

  </i></font>Inverse<font color="#000080">: </font><font color="#FF0000"><b>Begin
    </b></font>celdis <font color="#000080">:= </font><font color="#800000">2</font><font color="#000080">;           </font><font color="#008000"><i>{ Cells are adjacent }
    </i></font>celnum <font color="#000080">:= </font>n <font color="#FF0000"><b>div </b></font><font color="#800000">4</font><font color="#000080">;     </font><font color="#008000"><i>{ n/4 cells in first pass }
    </i></font>parnum <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;
    </font><font color="#FF0000"><b>End</b></font><font color="#000080">;  </font><font color="#008000"><i>{ Inverse case }

  </i></font><font color="#FF0000"><b>End</b></font><font color="#000080">;  </font><font color="#008000"><i>{ Case }

  </i></font><font color="#FF0000"><b>Repeat      </b></font><font color="#008000"><i>{ Until cells large if Fwd or small if Inverse }
    </i></font>i <font color="#000080">:= </font><font color="#800000">2</font><font color="#000080">;
    </font><font color="#FF0000"><b>For </b></font>j<font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>celnum <font color="#FF0000"><b>do
    Begin
      For </b></font>k <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>parnum <font color="#FF0000"><b>do  </b></font><font color="#008000"><i>{ Do all pairs in each cell }
      </i></font><font color="#FF0000"><b>Begin
        </b></font>Xtemp <font color="#000080">:= </font>x<font color="#000080">[</font>i<font color="#000080">];
        </font>ipcm1 <font color="#000080">:= </font>i<font color="#000080">+</font>celdis<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">;   </font><font color="#008000"><i>{ Index of other pts }
        </i></font>x<font color="#000080">[</font>i<font color="#000080">] := </font>x<font color="#000080">[</font>ipcm1<font color="#000080">];
        </font>x<font color="#000080">[</font>ipcm1<font color="#000080">] := </font>xtemp<font color="#000080">;
        </font>i <font color="#000080">:= </font>i<font color="#000080">+</font><font color="#800000">2</font><font color="#000080">;
      </font><font color="#FF0000"><b>End</b></font><font color="#000080">;  </font><font color="#008000"><i>{ For k }

      { End of cell, advance to next one }
      </i></font>i <font color="#000080">:= </font>i<font color="#000080">+</font>celdis<font color="#000080">;
    </font><font color="#FF0000"><b>End</b></font><font color="#000080">;    </font><font color="#008000"><i>{ For j }

    { Change values for next pass }

    </i></font><font color="#FF0000"><b>Case </b></font>inv <font color="#FF0000"><b>Of
    </b></font>Fwd<font color="#000080">:    </font><font color="#FF0000"><b>Begin
      </b></font>celdis <font color="#000080">:= </font>celdis <font color="#FF0000"><b>div </b></font><font color="#800000">2</font><font color="#000080">;         </font><font color="#008000"><i>{ Decrease cell distance }
      </i></font>celnum <font color="#000080">:= </font>celnum <font color="#000080">* </font><font color="#800000">2</font><font color="#000080">;           </font><font color="#008000"><i>{ More cells }
      </i></font>parnum <font color="#000080">:= </font>parnum <font color="#FF0000"><b>div </b></font><font color="#800000">2</font><font color="#000080">;         </font><font color="#008000"><i>{ Less pairs per cell }
      </i></font><font color="#FF0000"><b>End</b></font><font color="#000080">;   </font><font color="#008000"><i>{ Case Fwd }

    </i></font>Inverse<font color="#000080">: </font><font color="#FF0000"><b>Begin
      </b></font>celdis <font color="#000080">:= </font>celdis <font color="#000080">* </font><font color="#800000">2</font><font color="#000080">;           </font><font color="#008000"><i>{ More distance between cells }
      </i></font>celnum <font color="#000080">:= </font>celnum <font color="#FF0000"><b>div </b></font><font color="#800000">2</font><font color="#000080">;         </font><font color="#008000"><i>{ Less cells }
      </i></font>parnum <font color="#000080">:= </font>parnum <font color="#000080">* </font><font color="#800000">2</font><font color="#000080">;           </font><font color="#008000"><i>{ More pairs per cell }
      </i></font><font color="#FF0000"><b>End</b></font><font color="#000080">;   </font><font color="#008000"><i>{ Case Inverse }
    </i></font><font color="#FF0000"><b>End</b></font><font color="#000080">;  </font><font color="#008000"><i>{ Case }

  </i></font><font color="#FF0000"><b>Until  </b></font><font color="#000080">(((</font>inv <font color="#000080">= </font>Fwd<font color="#000080">) </font><font color="#FF0000"><b>And </b></font><font color="#000080">(</font>Celdis <font color="#000080">&lt; </font><font color="#800000">2</font><font color="#000080">)) </font><font color="#FF0000"><b>Or </b></font><font color="#000080">((</font>inv<font color="#000080">=</font>Inverse<font color="#000080">) </font><font color="#FF0000"><b>And </b></font><font color="#000080">(</font>celnum <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">)));

</font><font color="#FF0000"><b>End</b></font><font color="#000080">;  </font><font color="#008000"><i>{ Shuffl }

{*****************************************************************************}

</i></font><font color="#FF0000"><b>Procedure </b></font>FFT<font color="#000080">(</font>inv <font color="#000080">: </font>Xform<font color="#000080">);
  </font><font color="#008000"><i>{ Fast Fourier transform procedure operating on data in 1st half real,
    2nd half imaginary order and produces a complex result }

</i></font><font color="#FF0000"><b>Var
  </b></font>n1<font color="#000080">,</font>n2<font color="#000080">,</font>nu<font color="#000080">,</font>celnum<font color="#000080">,</font>celdis<font color="#000080">,</font>parnum<font color="#000080">,</font>ipn2<font color="#000080">,</font>kpn2<font color="#000080">,</font>jpn2<font color="#000080">,
  </font>i<font color="#000080">,</font>j<font color="#000080">,</font>k<font color="#000080">,</font>l<font color="#000080">,</font>i2<font color="#000080">,</font>imax<font color="#000080">,</font>index      <font color="#000080">: </font>Integer<font color="#000080">;
  </font>arg<font color="#000080">,</font>cosy<font color="#000080">,</font>siny<font color="#000080">,</font>r2cosy<font color="#000080">,</font>r2siny<font color="#000080">,</font>i2cosy<font color="#000080">,</font>i2siny<font color="#000080">,</font>picons<font color="#000080">,
  </font>y<font color="#000080">,</font>deltay<font color="#000080">,</font>k1<font color="#000080">,</font>k2<font color="#000080">,</font>tr<font color="#000080">,</font>ti<font color="#000080">,</font>xtemp  <font color="#000080">: </font>Real<font color="#000080">;

</font><font color="#FF0000"><b>Begin
  </b></font><font color="#008000"><i>{ Calculate nu = log2(n) }
  </i></font>nu <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font>n1 <font color="#000080">:= </font>n <font color="#FF0000"><b>div </b></font><font color="#800000">2</font><font color="#000080">;
  </font>n2 <font color="#000080">:= </font>n1<font color="#000080">;
  </font><font color="#FF0000"><b>While </b></font>n1 <font color="#000080">&gt;= </font><font color="#800000">2 </font><font color="#FF0000"><b>Do
  Begin
    </b></font>nu <font color="#000080">:= </font>nu <font color="#000080">+ </font><font color="#800000">1</font><font color="#000080">;            </font><font color="#008000"><i>{ Increment power-of-2 counter }
    </i></font>n1 <font color="#000080">:= </font>n1 <font color="#FF0000"><b>div </b></font><font color="#800000">2</font><font color="#000080">;          </font><font color="#008000"><i>{ divide by 2 until zero }
  </i></font><font color="#FF0000"><b>End</b></font><font color="#000080">;
  </font><font color="#008000"><i>{ Shuffel the data into bit-inverted order }
  </i></font><font color="#FF0000"><b>For </b></font>i <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>n2 <font color="#FF0000"><b>Do
  Begin
    </b></font>k <font color="#000080">:= </font>ibitr<font color="#000080">(</font>i<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">,</font>nu<font color="#000080">)+</font><font color="#800000">1</font><font color="#000080">;  </font><font color="#008000"><i>{ Calc bit-inverted position in array }
    </i></font><font color="#FF0000"><b>If </b></font>i<font color="#000080">&gt;</font>k <font color="#FF0000"><b>Then            </b></font><font color="#008000"><i>{ Prevent swapping twice }
    </i></font><font color="#FF0000"><b>Begin
      </b></font>ipn2 <font color="#000080">:= </font>i<font color="#000080">+</font>n2<font color="#000080">;
      </font>kpn2 <font color="#000080">:= </font>k<font color="#000080">+</font>n2<font color="#000080">;
      </font>tr <font color="#000080">:= </font>x<font color="#000080">[</font>k<font color="#000080">];         </font><font color="#008000"><i>{ Temp storage of real }
      </i></font>ti <font color="#000080">:= </font>x<font color="#000080">[</font>kpn2<font color="#000080">];      </font><font color="#008000"><i>{ Temp imag }
      </i></font>x<font color="#000080">[</font>k<font color="#000080">] := </font>x<font color="#000080">[</font>i<font color="#000080">];
      </font>x<font color="#000080">[</font>kpn2<font color="#000080">] := </font>x<font color="#000080">[</font>ipn2<font color="#000080">];
      </font>x<font color="#000080">[</font>i<font color="#000080">] := </font>tr<font color="#000080">;
      </font>x<font color="#000080">[</font>ipn2<font color="#000080">] := </font>ti<font color="#000080">;
    </font><font color="#FF0000"><b>End</b></font><font color="#000080">;  </font><font color="#008000"><i>{ If }
  </i></font><font color="#FF0000"><b>End</b></font><font color="#000080">;  </font><font color="#008000"><i>{ For }

  { Do first pass specially, since it has no multiplications }
  </i></font>i <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;
  </font><font color="#FF0000"><b>While </b></font>i <font color="#000080">&lt;= </font>n2 <font color="#FF0000"><b>Do
  Begin
    </b></font>k <font color="#000080">:= </font>i<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">;
    </font>kpn2 <font color="#000080">:= </font>k<font color="#000080">+</font>n2<font color="#000080">;
    </font>ipn2 <font color="#000080">:= </font>i<font color="#000080">+</font>n2<font color="#000080">;
    </font>k1 <font color="#000080">:= </font>x<font color="#000080">[</font>i<font color="#000080">]+</font>x<font color="#000080">[</font>k<font color="#000080">];        </font><font color="#008000"><i>{ Save this sum }
    </i></font>x<font color="#000080">[</font>k<font color="#000080">] := </font>x<font color="#000080">[</font>i<font color="#000080">]-</font>x<font color="#000080">[</font>k<font color="#000080">];      </font><font color="#008000"><i>{ Diff to k's }
    </i></font>x<font color="#000080">[</font>i<font color="#000080">] := </font>k1<font color="#000080">;             </font><font color="#008000"><i>{ Sum to I's }
    </i></font>k1 <font color="#000080">:= </font>x<font color="#000080">[</font>ipn2<font color="#000080">]+</font>x<font color="#000080">[</font>kpn2<font color="#000080">];  </font><font color="#008000"><i>{ Sum of imag }
    </i></font>x<font color="#000080">[</font>kpn2<font color="#000080">] := </font>x<font color="#000080">[</font>ipn2<font color="#000080">]-</font>x<font color="#000080">[</font>kpn2<font color="#000080">];
    </font>x<font color="#000080">[</font>ipn2<font color="#000080">] := </font>k1<font color="#000080">;
    </font>i <font color="#000080">:= </font>i<font color="#000080">+</font><font color="#800000">2</font><font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;  </font><font color="#008000"><i>{ While }

  { Set up deltay for 2nd pass, deltay=PI/2 }
    </i></font>deltay <font color="#000080">:= </font>PI2<font color="#000080">;   </font><font color="#008000"><i>{ PI/2 }
    </i></font>celnum <font color="#000080">:= </font>n2 <font color="#FF0000"><b>div </b></font><font color="#800000">4</font><font color="#000080">;
    </font>parnum <font color="#000080">:= </font><font color="#800000">2</font><font color="#000080">;     </font><font color="#008000"><i>{ Number of pairs between cell }
    </i></font>celdis <font color="#000080">:= </font><font color="#800000">2</font><font color="#000080">;     </font><font color="#008000"><i>{ Distance between cells }


  { Each pass after 1st starts here }
  </i></font><font color="#FF0000"><b>Repeat             </b></font><font color="#008000"><i>{ Until number of cells becomes zero }

{ Writeln(Lst,'After Nth Pass:');  ### }
{ Debug; }

    { Each new cell starts here }
    </i></font>index <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;
    </font>y <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;      </font><font color="#008000"><i>{ Exponent of w }
    { Do the number of pairs in each cell }
    </i></font><font color="#FF0000"><b>For </b></font>i2 <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>To </b></font>parnum <font color="#FF0000"><b>Do
    Begin
      If </b></font>y <font color="#000080">&lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>Then
      Begin                </b></font><font color="#008000"><i>{ Use sines and cosines if y is not zero }
        </i></font>cosy <font color="#000080">:= </font>cos<font color="#000080">(</font>y<font color="#000080">);    </font><font color="#008000"><i>{ Calc sine and cosine }
        </i></font>siny <font color="#000080">:= </font>sin<font color="#000080">(</font>y<font color="#000080">);
        </font><font color="#008000"><i>{ Negate sine terms if transform is inverse }
        </i></font><font color="#FF0000"><b>If </b></font>inv <font color="#000080">= </font>Inverse <font color="#FF0000"><b>then </b></font>siny <font color="#000080">:= -</font>siny<font color="#000080">;
      </font><font color="#FF0000"><b>End</b></font><font color="#000080">;   </font><font color="#008000"><i>{ If }
      { These are the fundamental equations of the FFT }
      </i></font><font color="#FF0000"><b>For </b></font>l <font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font>celnum<font color="#000080">-</font><font color="#800000">1 </font><font color="#FF0000"><b>Do
      Begin
        </b></font>i <font color="#000080">:= (</font>celdis<font color="#000080">*</font><font color="#800000">2</font><font color="#000080">)*</font>l <font color="#000080">+ </font>index<font color="#000080">;
        </font>j <font color="#000080">:= </font>i<font color="#000080">+</font>celdis<font color="#000080">;
        </font>ipn2 <font color="#000080">:= </font>i <font color="#000080">+ </font>n2<font color="#000080">;
        </font>jpn2 <font color="#000080">:= </font>j <font color="#000080">+ </font>n2<font color="#000080">;
        </font><font color="#FF0000"><b>If </b></font>y <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>Then   </b></font><font color="#008000"><i>{ Special case for y=0 -- No sine or cosine terms }
        </i></font><font color="#FF0000"><b>Begin
          </b></font>k1 <font color="#000080">:= </font>x<font color="#000080">[</font>i<font color="#000080">]+</font>x<font color="#000080">[</font>j<font color="#000080">];
          </font>k2 <font color="#000080">:= </font>x<font color="#000080">[</font>ipn2<font color="#000080">]+</font>x<font color="#000080">[</font>jpn2<font color="#000080">];
          </font>x<font color="#000080">[</font>j<font color="#000080">] := </font>x<font color="#000080">[</font>i<font color="#000080">]-</font>x<font color="#000080">[</font>j<font color="#000080">];
          </font>x<font color="#000080">[</font>jpn2<font color="#000080">] := </font>x<font color="#000080">[</font>ipn2<font color="#000080">]-</font>x<font color="#000080">[</font>jpn2<font color="#000080">];
        </font><font color="#FF0000"><b>End   </b></font><font color="#008000"><i>{ If-Then }
        </i></font><font color="#FF0000"><b>Else
        Begin
          </b></font>r2cosy <font color="#000080">:= </font>x<font color="#000080">[</font>j<font color="#000080">]*</font>cosy<font color="#000080">;   </font><font color="#008000"><i>{ Calc intermediate constants }
          </i></font>r2siny <font color="#000080">:= </font>x<font color="#000080">[</font>j<font color="#000080">]*</font>siny<font color="#000080">;
          </font>i2cosy <font color="#000080">:= </font>x<font color="#000080">[</font>jpn2<font color="#000080">]*</font>cosy<font color="#000080">;
          </font>i2siny <font color="#000080">:= </font>x<font color="#000080">[</font>jpn2<font color="#000080">]*</font>siny<font color="#000080">;
          </font><font color="#008000"><i>{ Butterfly }
          </i></font>k1 <font color="#000080">:= </font>x<font color="#000080">[</font>i<font color="#000080">] + </font>r2cosy <font color="#000080">+ </font>i2siny<font color="#000080">;
          </font>k2 <font color="#000080">:= </font>x<font color="#000080">[</font>ipn2<font color="#000080">] - </font>r2siny <font color="#000080">+ </font>i2cosy<font color="#000080">;
          </font>x<font color="#000080">[</font>j<font color="#000080">] := </font>x<font color="#000080">[</font>i<font color="#000080">] - </font>r2cosy <font color="#000080">- </font>i2siny<font color="#000080">;
          </font>x<font color="#000080">[</font>jpn2<font color="#000080">] := </font>x<font color="#000080">[</font>ipn2<font color="#000080">] + </font>r2siny <font color="#000080">- </font>i2cosy<font color="#000080">;
        </font><font color="#FF0000"><b>End</b></font><font color="#000080">;   </font><font color="#008000"><i>{ Else }
        { Replace the i terms }
        </i></font>x<font color="#000080">[</font>i<font color="#000080">] := </font>k1<font color="#000080">;
        </font>x<font color="#000080">[</font>ipn2<font color="#000080">] := </font>k2<font color="#000080">;

      </font><font color="#008000"><i>{ Advance angle for next pair }
      </i></font><font color="#FF0000"><b>End</b></font><font color="#000080">;  </font><font color="#008000"><i>{ For l }

      </i></font>Y <font color="#000080">:= </font>y <font color="#000080">+ </font>deltay<font color="#000080">;
      </font>index <font color="#000080">:= </font>index <font color="#000080">+ </font><font color="#800000">1</font><font color="#000080">;
    </font><font color="#FF0000"><b>End</b></font><font color="#000080">;  </font><font color="#008000"><i>{ For i2 }

    { Pass done - change cell distance and number of cells }
    </i></font>celnum <font color="#000080">:= </font>celnum <font color="#FF0000"><b>div </b></font><font color="#800000">2</font><font color="#000080">;
    </font>parnum <font color="#000080">:= </font>parnum <font color="#000080">* </font><font color="#800000">2</font><font color="#000080">;
    </font>celdis <font color="#000080">:= </font>celdis <font color="#000080">* </font><font color="#800000">2</font><font color="#000080">;
    </font>deltay <font color="#000080">:= </font>deltay<font color="#000080">/</font><font color="#800000">2</font><font color="#000080">;

  </font><font color="#FF0000"><b>Until </b></font>celnum <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">;

</font><font color="#FF0000"><b>End</b></font><font color="#000080">;  </font><font color="#008000"><i>{ FFT }

{*****************************************************************************}

</i></font><font color="#FF0000"><b>Begin    </b></font><font color="#008000"><i>{ * Main program * }
  </i></font><font color="#FF0000"><b>For </b></font>i <font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>To </b></font>Asize<font color="#000080">-</font><font color="#800000">1 </font><font color="#FF0000"><b>Do
  Begin
    </b></font>x<font color="#000080">[</font>i<font color="#000080">] := </font><font color="#800000">0.0</font><font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#008000"><i>{  Write('Enter number of points: ');
  Readln(n);}
  </i></font>n <font color="#000080">:= </font><font color="#800000">32</font><font color="#000080">;
  </font><font color="#FF0000"><b>If </b></font><font color="#000080">(</font>n <font color="#000080">&gt; </font>Asize<font color="#000080">) </font><font color="#FF0000"><b>Then
  Begin
    </b></font>Writeln<font color="#000080">(</font><font color="#800000">'Too large, will use maximum'</font><font color="#000080">);
    </font>n <font color="#000080">:= </font>Round<font color="#000080">(</font>asize<font color="#000080">/</font><font color="#800000">2.0</font><font color="#000080">);
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>For </b></font>i <font color="#000080">:= </font><font color="#800000">2 </font><font color="#FF0000"><b>to </b></font>n <font color="#FF0000"><b>Do </b></font>x<font color="#000080">[</font>i<font color="#000080">] := </font>Exp<font color="#000080">((</font><font color="#800000">1</font><font color="#000080">-</font>i<font color="#000080">)*</font><font color="#800000">0.25</font><font color="#000080">); </font><font color="#008000"><i>{ Create Real array }
  </i></font>x<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">] := </font><font color="#800000">0.5</font><font color="#000080">;
  </font>Writeln<font color="#000080">(</font><font color="#800000">'Input Array:'</font><font color="#000080">);
  </font>Debug<font color="#000080">;
  </font>Shuffl<font color="#000080">(</font>Fwd<font color="#000080">);
  </font>FFT<font color="#000080">(</font>Fwd<font color="#000080">);
  </font>Post<font color="#000080">(</font>Fwd<font color="#000080">);
  </font><font color="#FF0000"><b>For </b></font>i<font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>n <font color="#FF0000"><b>Do </b></font>x<font color="#000080">[</font>i<font color="#000080">] := </font>x<font color="#000080">[</font>i<font color="#000080">]*</font><font color="#800000">8</font><font color="#000080">/</font>n<font color="#000080">;
  </font>Writeln<font color="#000080">(</font><font color="#800000">'Forward FFT with real array first:'</font><font color="#000080">);
  </font>Debug<font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">.

</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to MATH SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0092.PAS">Original</a><b>]</b></p></body>
</html>
