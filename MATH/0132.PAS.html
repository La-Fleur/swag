<html>
<head><title> "Sin/Cos Filter" by SALVATORE MESCHINI</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to MATH SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0132.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#FF0000"><b>Program </b></font>SinCosFilter<font color="#000080">;

</font><font color="#008000"><i>{Salvatore Meschini 
 E-Mail: smeschini@ermes.it - http://www.ermes.it/pws/mesk
 Check this: http://www.gdsoft.com/swag/downloads.html}
{Original idea: Dirty Abe (Albert Veli)}

{The following program ins't optimized (lookup tables,assembler...) because
it only show how to write a filter with sin/cos. Just an idea :) }

{Press ESC to quit - OTHER keys to browse filters}
{Useful routines: Keypressed/GetPixel/SetPixel/GetKey/CyclePal/Get&amp;SetPal/
 vretrace}


</i></font><font color="#FF0000"><b>const </b></font>kx<font color="#000080">=</font><font color="#800000">2</font><font color="#000080">*</font>pi<font color="#000080">/</font><font color="#800000">320</font><font color="#000080">;
      </font>ky<font color="#000080">=</font><font color="#800000">2</font><font color="#000080">*</font>pi<font color="#000080">/</font><font color="#800000">200</font><font color="#000080">;

</font><font color="#FF0000"><b>var </b></font>x<font color="#000080">,</font>y<font color="#000080">:</font>word<font color="#000080">;
    </font>i<font color="#000080">,</font>counter<font color="#000080">:</font>byte<font color="#000080">;
    </font>ch<font color="#000080">:</font>char<font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>KeyPressed<font color="#000080">: </font>Boolean<font color="#000080">; </font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;
</font><font color="#008000"><i>{FASTEST keypressed replacement! No interrupts}
  </i></font><font color="#FF0000"><b>asm
   </b></font><font color="#FF00FF">mov  ax, 40h
   mov  es, ax
   mov  dx, es:[1ah]
   mov  bx, es:[1ch]
   xor  ax, ax
   cmp  dx, bx
   je  @fine
   mov  al, 1
   @fine:
 </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>Putpixel<font color="#000080">(</font>X<font color="#000080">, </font>Y<font color="#000080">: </font>word<font color="#000080">; </font>Col<font color="#000080">: </font>Byte<font color="#000080">); </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">; </font><font color="#008000"><i>{Draw a point at x,y}
</i></font><font color="#FF0000"><b>asm
          </b></font><font color="#FF00FF">mov     ax,$A000                </font><font color="#008000"><i>{ 8  Cycles}
          </i></font><font color="#FF00FF">mov     es,ax                   </font><font color="#008000"><i>{ 2  }
          </i></font><font color="#FF00FF">mov     bx,[X]                  </font><font color="#008000"><i>{ 8  }
          </i></font><font color="#FF00FF">mov     dx,[Y]                  </font><font color="#008000"><i>{ 8  }
          </i></font><font color="#FF00FF">mov     di,bx                   </font><font color="#008000"><i>{ 2  }
          </i></font><font color="#FF00FF">mov     bx, dx                  </font><font color="#008000"><i>{ 2  }
          </i></font><font color="#FF00FF">shl     dx, 8                   </font><font color="#008000"><i>{ 8  }
          </i></font><font color="#FF00FF">shl     bx, 6                   </font><font color="#008000"><i>{ 8  }
          </i></font><font color="#FF00FF">add     dx, bx                  </font><font color="#008000"><i>{ 3  }
          </i></font><font color="#FF00FF">add     di, dx                  </font><font color="#008000"><i>{ 3  }
          </i></font><font color="#FF00FF">mov     al, [Col]               </font><font color="#008000"><i>{ 8  }
          </i></font><font color="#FF00FF">stosb                           </font><font color="#008000"><i>{ 11 }
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>GetPixel<font color="#000080">(</font>x<font color="#000080">,</font>y<font color="#000080">:</font>word<font color="#000080">):</font>byte<font color="#000080">;</font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;   </font><font color="#008000"><i>{Get color of pixel at x,y}
 </i></font><font color="#FF0000"><b>asm
   </b></font><font color="#FF00FF">mov ax,0a000h
    mov es,ax
    mov bx,y
    mov di,bx
    xchg bh,bl
    shl di,6
    add di,bx
    add di,x
    mov al,[es:di]
 </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>Setmode<font color="#000080">(</font>mode<font color="#000080">: </font>byte<font color="#000080">); </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">; </font><font color="#008000"><i>{Set graphical/text mode}
</i></font><font color="#FF0000"><b>asm
 </b></font><font color="#FF00FF">xor ah,ah
 mov al,mode
 int 10h
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>Vretrace<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">; </font><font color="#008000"><i>{Wait for vertical retrace}

</i></font><font color="#FF0000"><b>label
  </b></font>l1<font color="#000080">, </font>l2<font color="#000080">;

</font><font color="#FF0000"><b>asm
    </b></font><font color="#FF00FF">mov dx,3DAh
l1:
    in al,dx
    and al,08h
    jnz l1
l2:
    in al,dx
    and al,08h
    jz  l2
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>function </b></font>GetKey<font color="#000080">: </font>Char<font color="#000080">;   </font><font color="#008000"><i>{Get last keypressed}

  </i></font><font color="#FF0000"><b>var
    </b></font>AsciiK<font color="#000080">: </font>byte<font color="#000080">;

  </font><font color="#FF0000"><b>begin
    asm
     </b></font><font color="#FF00FF">xor ah,ah
     int 16h
     mov asciik,al
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font>getkey <font color="#000080">:= </font>chr<font color="#000080">(</font>asciik<font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>Procedure </b></font>SinCos<font color="#000080">;
 </font><font color="#FF0000"><b>var </b></font>col<font color="#000080">:</font>byte<font color="#000080">;
 </font><font color="#FF0000"><b>begin
 for </b></font>x<font color="#000080">:=</font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font><font color="#800000">320 </font><font color="#FF0000"><b>do
  for </b></font>y<font color="#000080">:=</font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font><font color="#800000">200 </font><font color="#FF0000"><b>do
  begin
  </b></font>col<font color="#000080">:=</font>round<font color="#000080">((</font>sin<font color="#000080">(</font>x<font color="#000080">*</font>KX<font color="#000080">*</font><font color="#800000">0.5</font><font color="#000080">)*</font>sin<font color="#000080">(</font>y<font color="#000080">*</font>KY<font color="#000080">*</font><font color="#800000">0.5</font><font color="#000080">))*(</font><font color="#800000">127</font><font color="#000080">-</font><font color="#800000">20</font><font color="#000080">)+</font><font color="#800000">128</font><font color="#000080">);
  </font>putpixel<font color="#000080">(</font>x<font color="#000080">,</font>y<font color="#000080">,</font>col<font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
 </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>ApplyFilter<font color="#000080">;
 </font><font color="#FF0000"><b>var </b></font>col<font color="#000080">:</font>byte<font color="#000080">;

 </font><font color="#FF0000"><b>begin
  </b></font>sincos<font color="#000080">;
  </font><font color="#FF0000"><b>for </b></font>x<font color="#000080">:=</font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font><font color="#800000">320 </font><font color="#FF0000"><b>do
   for </b></font>y<font color="#000080">:=</font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font><font color="#800000">200 </font><font color="#FF0000"><b>do
    begin
    </b></font>col<font color="#000080">:=</font>getpixel<font color="#000080">(</font>x<font color="#000080">,</font>y<font color="#000080">);
    </font><font color="#FF0000"><b>case </b></font>counter <font color="#FF0000"><b>of
    </b></font><font color="#800000">0</font><font color="#000080">:</font>col<font color="#000080">:=</font>col <font color="#000080">+ </font>y <font color="#000080">- </font>x <font color="#000080">;
    </font><font color="#800000">1</font><font color="#000080">:</font>col<font color="#000080">:=</font>col <font color="#000080">+ </font>round<font color="#000080">((</font>sin<font color="#000080">(</font>x<font color="#000080">*</font>KX<font color="#000080">*</font><font color="#800000">10</font><font color="#000080">)*</font>sin<font color="#000080">(</font>y<font color="#000080">*</font>KY<font color="#000080">*</font><font color="#800000">10</font><font color="#000080">))*</font><font color="#800000">20</font><font color="#000080">);
    </font><font color="#800000">2</font><font color="#000080">:</font>col<font color="#000080">:=</font>col <font color="#FF0000"><b>xor </b></font>x <font color="#FF0000"><b>xor </b></font>y<font color="#000080">;
    </font><font color="#800000">3</font><font color="#000080">:</font>col<font color="#000080">:=</font>col <font color="#000080">- </font>round<font color="#000080">((</font>cos<font color="#000080">(</font>x<font color="#000080">*</font>Ky<font color="#000080">*</font><font color="#800000">10</font><font color="#000080">)*</font>cos<font color="#000080">(</font>y<font color="#000080">*</font>Kx<font color="#000080">*</font><font color="#800000">10</font><font color="#000080">))*</font><font color="#800000">2</font><font color="#000080">);
    </font><font color="#800000">4</font><font color="#000080">:</font>counter<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>if </b></font>col<font color="#000080">=</font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>inc<font color="#000080">(</font>col<font color="#000080">);
    </font>putpixel<font color="#000080">(</font>x<font color="#000080">,</font>y<font color="#000080">,</font>col<font color="#000080">);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
 </font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>Procedure </b></font>SetPal<font color="#000080">(</font>ColorNo<font color="#000080">: </font>Byte<font color="#000080">; </font>R<font color="#000080">, </font>G<font color="#000080">, </font>B<font color="#000080">: </font>Byte<font color="#000080">);
  </font><font color="#FF0000"><b>begin
    </b></font>Port<font color="#000080">[</font><font color="#800000">$3c8</font><font color="#000080">] := </font>ColorNo<font color="#000080">;
    </font>Port<font color="#000080">[</font><font color="#800000">$3c9</font><font color="#000080">] := </font>R<font color="#000080">;
    </font>Port<font color="#000080">[</font><font color="#800000">$3c9</font><font color="#000080">] := </font>G<font color="#000080">;
    </font>Port<font color="#000080">[</font><font color="#800000">$3c9</font><font color="#000080">] := </font>B<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>GetPal<font color="#000080">(</font>ColorNo<font color="#000080">: </font>Byte<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>R<font color="#000080">, </font>G<font color="#000080">, </font>B<font color="#000080">: </font>Byte<font color="#000080">);
  </font><font color="#FF0000"><b>begin
    </b></font>Port<font color="#000080">[</font><font color="#800000">$3c7</font><font color="#000080">] := </font>ColorNo<font color="#000080">;
    </font>R <font color="#000080">:= </font>Port<font color="#000080">[</font><font color="#800000">$3c9</font><font color="#000080">];
    </font>G <font color="#000080">:= </font>Port<font color="#000080">[</font><font color="#800000">$3c9</font><font color="#000080">];
    </font>B <font color="#000080">:= </font>Port<font color="#000080">[</font><font color="#800000">$3c9</font><font color="#000080">];
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>CyclePal<font color="#000080">(</font>startc<font color="#000080">,</font>endc<font color="#000080">:</font>byte<font color="#000080">);
 </font><font color="#FF0000"><b>var </b></font>j<font color="#000080">,</font>r<font color="#000080">,</font>g<font color="#000080">,</font>b<font color="#000080">,</font>r1<font color="#000080">,</font>g1<font color="#000080">,</font>b1<font color="#000080">:</font>byte<font color="#000080">;
 </font><font color="#FF0000"><b>begin
  </b></font>getpal<font color="#000080">(</font>startc<font color="#000080">,</font>r1<font color="#000080">,</font>b1<font color="#000080">,</font>g1<font color="#000080">);
  </font><font color="#FF0000"><b>for </b></font>j<font color="#000080">:=</font>startc <font color="#FF0000"><b>to </b></font>endc <font color="#FF0000"><b>do
   begin
     </b></font>getpal<font color="#000080">(</font>j<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">,</font>r<font color="#000080">,</font>g<font color="#000080">,</font>b<font color="#000080">);
     </font>setpal<font color="#000080">(</font>j<font color="#000080">,</font>r<font color="#000080">,</font>g<font color="#000080">,</font>b<font color="#000080">);
   </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>setpal<font color="#000080">(</font>endc<font color="#000080">,</font>r1<font color="#000080">,</font>b1<font color="#000080">,</font>g1<font color="#000080">);
 </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

 </font><font color="#FF0000"><b>begin
 </b></font>setmode<font color="#000080">(</font><font color="#800000">$13</font><font color="#000080">);      </font><font color="#008000"><i>{GoTo mode $13}
  </i></font><font color="#FF0000"><b>for </b></font>i<font color="#000080">:=</font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font><font color="#800000">170 </font><font color="#FF0000"><b>do </b></font>setpal<font color="#000080">(</font>i<font color="#000080">,</font>i<font color="#000080">,</font>i <font color="#FF0000"><b>or </b></font><font color="#800000">32</font><font color="#000080">,</font>i<font color="#000080">); </font><font color="#008000"><i>{Set colors}
  </i></font><font color="#FF0000"><b>for </b></font>i<font color="#000080">:=</font><font color="#800000">171 </font><font color="#FF0000"><b>to </b></font><font color="#800000">255 </font><font color="#FF0000"><b>do </b></font>setpal<font color="#000080">(</font>i<font color="#000080">,</font>i <font color="#FF0000"><b>or </b></font><font color="#800000">32</font><font color="#000080">,</font>i<font color="#000080">,</font>i<font color="#000080">);
  </font>applyfilter<font color="#000080">;</font><font color="#008000"><i>{Apply custom filter to screen}
 </i></font><font color="#FF0000"><b>repeat
 </b></font>cyclepal<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">255</font><font color="#000080">);
 </font>vretrace<font color="#000080">;
 </font><font color="#FF0000"><b>if </b></font>keypressed <font color="#FF0000"><b>then begin </b></font>ch<font color="#000080">:=</font>getkey<font color="#000080">; </font><font color="#FF0000"><b>if </b></font>ch <font color="#000080">&lt;&gt; </font><font color="#800000">#27 </font><font color="#FF0000"><b>then begin
 </b></font>inc<font color="#000080">(</font>counter<font color="#000080">); </font>applyfilter<font color="#000080">;
 </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
 </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
 </font><font color="#FF0000"><b>until </b></font>ch<font color="#000080">=</font><font color="#800000">#27</font><font color="#000080">;           </font><font color="#008000"><i>{Press ESC to quit!}
 </i></font>setmode<font color="#000080">(</font><font color="#800000">3</font><font color="#000080">);
 </font><font color="#FF0000"><b>end</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to MATH SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0132.PAS">Original</a><b>]</b></p></body>
</html>
