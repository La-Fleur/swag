<html>
<head><title> "Expression Evaluator" by THAI TRAN</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to MATH SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0039.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
THAI TRAN

{
I've netmailed you the full-featured version (800 lines!) that will do
Functions, exponentiation, factorials, and has all the bells and whistles,
but I thought you might want to take a look at a simple version so you can
understand the algorithm.

This one only works With +, -, *, /, (, and ).  I wrote it quickly, so it
makes extensive use of global Variables and has no error checking; Use at
your own risk.

Algorithm to convert infix to postfix (RPN) notation
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Parse through the entire expression getting each token (number, arithmetic
operator, left or right parenthesis).  For each token, if it is:
 1. an operand (number)        Send it to the RPN calculator
 2. a left parenthesis         Push it onto the operator stack
 3. a right parenthesis        Pop operators off stack and send to RPN
                               calculator Until the a left parenthesis is
                               on top of the stack.  Pop it also, but don't
                               send it to the calculator.
 4. an operator                While the stack is not empty, pop operators
                               off the stack and send them to the RPN
                               calculator Until you reach one With a higher
                               precedence than the current operator (Note:
                               a left parenthesis has the least precendence).
                               Then push the current operator onto the stack.

This will convert (4+5)*6/(2-3) to 4 5 + 6 * 2 3 - /

Algorithm For RPN calculator
~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Note:  this Uses a different stack from the one described above.

In RPN, if an operand (a number) is entered, it is just pushed onto the
stack.  For binary arithmetic operators (+, -, *, /, and ^), the top two
operands are popped off the stack, operated on, and the result pushed back
onto the stack.  if everything has gone correctly, at the end, the answer
should be at the top of the stack.


Released to Public Domain by Thai Tran (if that matters).
}

{$X+}
</i></font><font color="#FF0000"><b>Program </b></font>Expression_Evaluator<font color="#000080">;

</font><font color="#FF0000"><b>Const
  </b></font>RPNMax <font color="#000080">= </font><font color="#800000">10</font><font color="#000080">;              </font><font color="#008000"><i>{ I think you only need 4, but just to be safe }
  </i></font>OpMax  <font color="#000080">= </font><font color="#800000">25</font><font color="#000080">;

</font><font color="#FF0000"><b>Type
  </b></font>String15 <font color="#000080">= </font><font color="#FF0000"><b>String</b></font><font color="#000080">[</font><font color="#800000">15</font><font color="#000080">];

</font><font color="#FF0000"><b>Var
  </b></font>Expression <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
  </font>RPNStack   <font color="#000080">: </font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font>RPNMax<font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Real<font color="#000080">;        </font><font color="#008000"><i>{ Stack For RPN calculator }
  </i></font>RPNTop     <font color="#000080">: </font>Integer<font color="#000080">;
  </font>OpStack    <font color="#000080">: </font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font>OpMax<font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Char<font color="#000080">;    </font><font color="#008000"><i>{ Operator stack For conversion }
  </i></font>OpTop      <font color="#000080">: </font>Integer<font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>RPNPush<font color="#000080">(</font>Num <font color="#000080">: </font>Real<font color="#000080">); </font><font color="#008000"><i>{ Add an operand to the top of the RPN stack }
</i></font><font color="#FF0000"><b>begin
  if </b></font>RPNTop <font color="#000080">&lt; </font>RPNMax <font color="#FF0000"><b>then
  begin
    </b></font>Inc<font color="#000080">(</font>RPNTop<font color="#000080">);
    </font>RPNStack<font color="#000080">[</font>RPNTop<font color="#000080">] := </font>Num<font color="#000080">;
  </font><font color="#FF0000"><b>end
  else  </b></font><font color="#008000"><i>{ Put some error handler here }
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>RPNPop <font color="#000080">: </font>Real<font color="#000080">;       </font><font color="#008000"><i>{ Get the operand at the top of the RPN stack }
</i></font><font color="#FF0000"><b>begin
  if </b></font>RPNTop <font color="#000080">&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then
  begin
    </b></font>RPNPop <font color="#000080">:= </font>RPNStack<font color="#000080">[</font>RPNTop<font color="#000080">];
    </font>Dec<font color="#000080">(</font>RPNTop<font color="#000080">);
  </font><font color="#FF0000"><b>end
  else  </b></font><font color="#008000"><i>{ Put some error handler here }
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>RPNCalc<font color="#000080">(</font>Token <font color="#000080">: </font>String15<font color="#000080">);                       </font><font color="#008000"><i>{ RPN Calculator }
</i></font><font color="#FF0000"><b>Var
  </b></font>Temp  <font color="#000080">: </font>Real<font color="#000080">;
  </font>Error <font color="#000080">: </font>Integer<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>Write<font color="#000080">(</font>Token<font color="#000080">, </font><font color="#800000">' '</font><font color="#000080">);                </font><font color="#008000"><i>{ This just outputs the RPN expression }

  </i></font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>Length<font color="#000080">(</font>Token<font color="#000080">) = </font><font color="#800000">1</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>Token<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">] </font><font color="#FF0000"><b>in </b></font><font color="#000080">[</font><font color="#800000">'+'</font><font color="#000080">, </font><font color="#800000">'-'</font><font color="#000080">, </font><font color="#800000">'*'</font><font color="#000080">, </font><font color="#800000">'/'</font><font color="#000080">]) </font><font color="#FF0000"><b>then
  Case </b></font>Token<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">] </font><font color="#FF0000"><b>of                                   </b></font><font color="#008000"><i>{ Handle operators }
    </i></font><font color="#800000">'+' </font><font color="#000080">: </font>RPNPush<font color="#000080">(</font>RPNPop <font color="#000080">+ </font>RPNPop<font color="#000080">);
    </font><font color="#800000">'-' </font><font color="#000080">: </font>RPNPush<font color="#000080">(-(</font>RPNPop <font color="#000080">- </font>RPNPop<font color="#000080">));
    </font><font color="#800000">'*' </font><font color="#000080">: </font>RPNPush<font color="#000080">(</font>RPNPop <font color="#000080">* </font>RPNPop<font color="#000080">);
    </font><font color="#800000">'/' </font><font color="#000080">:
    </font><font color="#FF0000"><b>begin
      </b></font>Temp <font color="#000080">:= </font>RPNPop<font color="#000080">;
      </font><font color="#FF0000"><b>if </b></font>Temp <font color="#000080">&lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then
        </b></font>RPNPush<font color="#000080">(</font>RPNPop<font color="#000080">/</font>Temp<font color="#000080">)
      </font><font color="#FF0000"><b>else  </b></font><font color="#008000"><i>{ Handle divide by 0 error }
    </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>end
  else
  begin                   </b></font><font color="#008000"><i>{ Convert String to number and add to stack }
    </i></font>Val<font color="#000080">(</font>Token<font color="#000080">, </font>Temp<font color="#000080">, </font>Error<font color="#000080">);
    </font><font color="#FF0000"><b>if </b></font>Error <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>then
      </b></font>RPNPush<font color="#000080">(</font>Temp<font color="#000080">)
    </font><font color="#FF0000"><b>else  </b></font><font color="#008000"><i>{ Handle error }
  </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>OpPush<font color="#000080">(</font>Operator <font color="#000080">: </font>Char<font color="#000080">);  </font><font color="#008000"><i>{ Add an operator onto top of the stack }
</i></font><font color="#FF0000"><b>begin
  if </b></font>OpTop <font color="#000080">&lt; </font>OpMax <font color="#FF0000"><b>then
  begin
    </b></font>Inc<font color="#000080">(</font>OpTop<font color="#000080">);
    </font>OpStack<font color="#000080">[</font>OpTop<font color="#000080">] := </font>Operator<font color="#000080">;
  </font><font color="#FF0000"><b>end
  else  </b></font><font color="#008000"><i>{ Put some error handler here }
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>OpPop <font color="#000080">: </font>Char<font color="#000080">;               </font><font color="#008000"><i>{ Get operator at the top of the stack }
</i></font><font color="#FF0000"><b>begin
  if </b></font>OpTop <font color="#000080">&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then
  begin
    </b></font>OpPop <font color="#000080">:= </font>OpStack<font color="#000080">[</font>OpTop<font color="#000080">];
    </font>Dec<font color="#000080">(</font>OpTop<font color="#000080">);
  </font><font color="#FF0000"><b>end
  else  </b></font><font color="#008000"><i>{ Put some error handler here }
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>Priority<font color="#000080">(</font>Operator <font color="#000080">: </font>Char<font color="#000080">) : </font>Integer<font color="#000080">; </font><font color="#008000"><i>{ Return priority of operator }
</i></font><font color="#FF0000"><b>begin
  Case </b></font>Operator <font color="#FF0000"><b>OF
    </b></font><font color="#800000">'('      </font><font color="#000080">: </font>Priority <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
    </font><font color="#800000">'+'</font><font color="#000080">, </font><font color="#800000">'-' </font><font color="#000080">: </font>Priority <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;
    </font><font color="#800000">'*'</font><font color="#000080">, </font><font color="#800000">'/' </font><font color="#000080">: </font>Priority <font color="#000080">:= </font><font color="#800000">2</font><font color="#000080">;
    </font><font color="#FF0000"><b>else  </b></font><font color="#008000"><i>{ More error handling }
  </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>Evaluate<font color="#000080">(</font>Expr <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">);                                  </font><font color="#008000"><i>{ Guess }
</i></font><font color="#FF0000"><b>Var
  </b></font>I     <font color="#000080">: </font>Integer<font color="#000080">;
  </font>Token <font color="#000080">: </font>String15<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>OpTop  <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;                                              </font><font color="#008000"><i>{ Reset stacks }
  </i></font>RPNTop <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font>Token  <font color="#000080">:= </font><font color="#800000">''</font><font color="#000080">;

  </font><font color="#FF0000"><b>For </b></font>I <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>Length<font color="#000080">(</font>Expr<font color="#000080">) </font><font color="#FF0000"><b>DO
  if </b></font>Expr<font color="#000080">[</font>I<font color="#000080">] </font><font color="#FF0000"><b>in </b></font><font color="#000080">[</font><font color="#800000">'0'</font><font color="#000080">..</font><font color="#800000">'9'</font><font color="#000080">] </font><font color="#FF0000"><b>then
  begin       </b></font><font color="#008000"><i>{ Build multi-digit numbers }
    </i></font>Token <font color="#000080">:= </font>Token <font color="#000080">+ </font>Expr<font color="#000080">[</font>I<font color="#000080">];
    </font><font color="#FF0000"><b>if </b></font>I <font color="#000080">= </font>Length<font color="#000080">(</font>Expr<font color="#000080">) </font><font color="#FF0000"><b>then          </b></font><font color="#008000"><i>{ Send last one to calculator }
      </i></font>RPNCalc<font color="#000080">(</font>Token<font color="#000080">);
  </font><font color="#FF0000"><b>end
  else
  if </b></font>Expr<font color="#000080">[</font>I<font color="#000080">] </font><font color="#FF0000"><b>in </b></font><font color="#000080">[</font><font color="#800000">'+'</font><font color="#000080">, </font><font color="#800000">'-'</font><font color="#000080">, </font><font color="#800000">'*'</font><font color="#000080">, </font><font color="#800000">'/'</font><font color="#000080">, </font><font color="#800000">'('</font><font color="#000080">, </font><font color="#800000">')'</font><font color="#000080">] </font><font color="#FF0000"><b>then
  begin
    if </b></font>Token <font color="#000080">&lt;&gt; </font><font color="#800000">'' </font><font color="#FF0000"><b>then
    begin        </b></font><font color="#008000"><i>{ Send last built number to calc. }
      </i></font>RPNCalc<font color="#000080">(</font>Token<font color="#000080">);
      </font>Token <font color="#000080">:= </font><font color="#800000">''</font><font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

    </font><font color="#FF0000"><b>Case </b></font>Expr<font color="#000080">[</font>I<font color="#000080">] </font><font color="#FF0000"><b>OF
      </b></font><font color="#800000">'(' </font><font color="#000080">: </font>OpPush<font color="#000080">(</font><font color="#800000">'('</font><font color="#000080">);
      </font><font color="#800000">')' </font><font color="#000080">:
      </font><font color="#FF0000"><b>begin
        While </b></font>OpStack<font color="#000080">[</font>OpTop<font color="#000080">] &lt;&gt; </font><font color="#800000">'(' </font><font color="#FF0000"><b>DO
          </b></font>RPNCalc<font color="#000080">(</font>OpPop<font color="#000080">);
        </font>OpPop<font color="#000080">;                          </font><font color="#008000"><i>{ Pop off and ignore the '(' }
      </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

      </font><font color="#800000">'+'</font><font color="#000080">, </font><font color="#800000">'-'</font><font color="#000080">, </font><font color="#800000">'*'</font><font color="#000080">, </font><font color="#800000">'/' </font><font color="#000080">:
      </font><font color="#FF0000"><b>begin
        While </b></font><font color="#000080">(</font>OpTop <font color="#000080">&gt; </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>AND
              </b></font><font color="#000080">(</font>Priority<font color="#000080">(</font>Expr<font color="#000080">[</font>I<font color="#000080">]) &lt;= </font>Priority<font color="#000080">(</font>OpStack<font color="#000080">[</font>OpTop<font color="#000080">])) </font><font color="#FF0000"><b>DO
          </b></font>RPNCalc<font color="#000080">(</font>OpPop<font color="#000080">);
        </font>OpPush<font color="#000080">(</font>Expr<font color="#000080">[</font>I<font color="#000080">]);
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{ Case }
  </i></font><font color="#FF0000"><b>end
  else</b></font><font color="#000080">;
      </font><font color="#008000"><i>{ Handle bad input error }

  </i></font><font color="#FF0000"><b>While </b></font>OpTop <font color="#000080">&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>do                     </b></font><font color="#008000"><i>{ Pop off the remaining operators }
    </i></font>RPNCalc<font color="#000080">(</font>OpPop<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>begin
  </b></font>Write<font color="#000080">(</font><font color="#800000">'Enter expression: '</font><font color="#000080">);
  </font>Readln<font color="#000080">(</font>Expression<font color="#000080">);

  </font>Write<font color="#000080">(</font><font color="#800000">'RPN Expression = '</font><font color="#000080">);
  </font>Evaluate<font color="#000080">(</font>Expression<font color="#000080">);
  </font>Writeln<font color="#000080">;
  </font>Writeln<font color="#000080">(</font><font color="#800000">'Answer = '</font><font color="#000080">, </font>RPNPop <font color="#000080">: </font><font color="#800000">0 </font><font color="#000080">: </font><font color="#800000">4</font><font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to MATH SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0039.PAS">Original</a><b>]</b></p></body>
</html>
