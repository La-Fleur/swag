<html>
<head><title> "Rangen Unit" by DR. W. GROSS</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to MATH SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0133.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code>
<font color="#008000"><i>{$A-,B-,D+,E+,F-,I+,L+,N+,O-,R+,S+,V+}
</i></font><font color="#FF0000"><b>UNIT </b></font>Rangen<font color="#000080">;

</font><font color="#008000"><i>{==============================================================================

MODULE:         RANDOMGENERATOR (RANGEN.PAS)

===============================================================================

VERSION:        V1.5            Turbo-Pascal 6.0, 7.0

COPYRIGHT:      (c) 1987-1993
                Dr. W. Gross, Keplerstrasse 51
                D-69120 Heidelberg, FRG
                gross@aecds.exchi.uni-heidelberg.de

CREATED:        10-NOV-87       Wolfgang Gross          on VAX/VMS, PASCAL-2

LAST UPDATE:    02-MAY-88       Wolfgang Gross          round off error in
                                                        NORRANDOM
                21-JUL-88       Wolfgang Gross          round off error in
                                                        UNIRANDOM
                15-MAR-89       Wolfgang Gross          NorRan, RanSphere

TESTED:         10-FEB-90       Wolfgang Gross

-------------------------------------------------------------------------------
TITLE:          RANDOM NUMBER GENERATES
-------------------------------------------------------------------------------

DESCRIPTION:    Random number generators for uniform, normal, exponential,
                lognormal, poisson and uniform sphere distribution.

                If the TURBO-PASCAL random generator RANDOM is used
                one must set the variable SYSTEM.RandSeed before calling
                RANDOM and save it after the call using the given
                seed variable. This allows independent streams of
                random numbers. See comment in UNIRANDOM.

                If TEST8086&gt;2 we can use 386 instructions. UNIRANDOM
                will then use its own method to generate the next
                univariate pseudo random number as described below.
                The method is approved by many independent tests
                that have been published in the literature. It has
                good Bayer coefficents which means it can be used for
                generating multi-dimensional random vectors.
                One might also utilize a floating point processor
                or switch to IEEE reals (type single, double) etc.
                Everybody may elaborate on this him/herself.

                If someone needs to modify and recompile this unit
                and doesn't have TASM, the complete ASM code is
                provided for compilation by the internal assembler.
                Some special arrangements are necessary to cope
                with 386 instructions. Define HAVETASM if you want
                to link MD2P31.OBJ. If this symbol is not defined
                the inline assembler version is used.




                This unit has evolved from a similar module worked
                out under PASCAL-2 in a VAX/VMS environment (including
                VAX assembler for MD2P31). The module can be found
                with anon ftp on aecds.exchi.uni-heidelberg.de.


CALLED BY:      &lt;module name&gt;   &lt;title&gt;


EXPORTS:        UNIRANDOM       uniformly distributed random numbers

                NORRANDOM       normally distributed random numbers

                NORRANDOM2      normally distributed random numbers,
                                polar method

                NORRANDOM3      normally distributed random numbers,
                                other mean/std-dev values than (0,1)

                EXPRANDOM       exponentially distributed random numbers

                LOGNORRANDOM    logarithmic normal distribution

                POIRANDOM       Poisson distribution

                RanSphere       uniformly distri. random numbers on sphere

INPUT:          seed            random number seed

                mean            mean value for distribution

                std             standard deviation

OUTPUT:         function value = random number

}

</i></font>
<font color="#008000"><i>{=============================================================================}

{ Exports: }
</i></font><font color="#FF0000"><b>Interface


FUNCTION  </b></font>UNIRANDOM  <font color="#000080">( </font><font color="#FF0000"><b>VAR </b></font>seed <font color="#000080">: </font>longint <font color="#000080">) : </font>real<font color="#000080">;

</font><font color="#FF0000"><b>FUNCTION  </b></font>NORRANDOM  <font color="#000080">( </font><font color="#FF0000"><b>VAR </b></font>seed <font color="#000080">: </font>longint <font color="#000080">) : </font>real<font color="#000080">;

</font><font color="#FF0000"><b>FUNCTION  </b></font>NORRANDOM2 <font color="#000080">( </font><font color="#FF0000"><b>VAR </b></font>seed <font color="#000080">: </font>longint<font color="#000080">;
                       </font><font color="#FF0000"><b>VAR </b></font>v2   <font color="#000080">: </font>real <font color="#000080">)    : </font>real<font color="#000080">;

</font><font color="#FF0000"><b>FUNCTION  </b></font>NORRANDOM3 <font color="#000080">( </font>mean<font color="#000080">, </font>std<font color="#000080">: </font>real<font color="#000080">;
                       </font><font color="#FF0000"><b>VAR </b></font>seed <font color="#000080">: </font>longint <font color="#000080">) : </font>real<font color="#000080">;

</font><font color="#FF0000"><b>FUNCTION  </b></font>EXPRANDOM  <font color="#000080">( </font>mean     <font color="#000080">: </font>real<font color="#000080">;
                       </font><font color="#FF0000"><b>VAR </b></font>seed <font color="#000080">: </font>longint <font color="#000080">) : </font>real<font color="#000080">;

</font><font color="#FF0000"><b>FUNCTION  </b></font>LOGNORRANDOM <font color="#000080">( </font>mean<font color="#000080">, </font>std <font color="#000080">: </font>real<font color="#000080">;
                       </font><font color="#FF0000"><b>VAR </b></font>seed <font color="#000080">: </font>longint <font color="#000080">) : </font>real<font color="#000080">;

</font><font color="#FF0000"><b>FUNCTION  </b></font>POIRANDOM  <font color="#000080">( </font>lambda   <font color="#000080">: </font>real<font color="#000080">;
                       </font><font color="#FF0000"><b>VAR </b></font>seed <font color="#000080">: </font>longint <font color="#000080">) : </font>longint<font color="#000080">;

</font><font color="#FF0000"><b>PROCEDURE </b></font>RanSphere  <font color="#000080">( </font><font color="#FF0000"><b>VAR </b></font>seed <font color="#000080">: </font>longint<font color="#000080">;
                       </font><font color="#FF0000"><b>VAR </b></font>x<font color="#000080">,</font>y<font color="#000080">,</font>z<font color="#000080">: </font>real <font color="#000080">);

</font>
<font color="#008000"><i>{===========================================================================}

</i></font><font color="#FF0000"><b>Implementation


</b></font><font color="#008000"><i>{DEFINE HAVETASM} {put a $ in front of DEFINE to link MD2P31.OBJ}

{$IFDEF HAVETASM}

   </i></font><font color="#FF0000"><b>PROCEDURE </b></font>MD2P31 <font color="#000080">(</font>A<font color="#000080">,</font>B <font color="#000080">: </font>longint<font color="#000080">;
                     </font><font color="#FF0000"><b>VAR </b></font>Q<font color="#000080">,</font>R <font color="#000080">: </font>longint<font color="#000080">); </font><font color="#FF0000"><b>far</b></font><font color="#000080">; </font><font color="#FF0000"><b>external</b></font><font color="#000080">;


   </font><font color="#008000"><i>{$L MD2P31.OBJ}

{$ELSE}

   </i></font><font color="#FF0000"><b>PROCEDURE </b></font>MD2P31 <font color="#000080">(</font>A<font color="#000080">,</font>B <font color="#000080">: </font>longint<font color="#000080">;
                     </font><font color="#FF0000"><b>VAR </b></font>Q<font color="#000080">,</font>R <font color="#000080">: </font>longint<font color="#000080">); </font><font color="#FF0000"><b>far</b></font><font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
     </font><font color="#008000"><i>{rather tricky: we fake TP into generating 386 intructions
      Calculate product a*b, represent product as q*2^31+r, 0&lt;=r&lt;2^31}
     </i></font><font color="#FF0000"><b>asm
       </b></font><font color="#FF00FF">push  es
       push  di

       db    $66       </font><font color="#008000"><i>{ 386 prefix for dword operation}
       </i></font><font color="#FF00FF">push  ax        </font><font color="#008000"><i>{ = push eax }

       </i></font><font color="#FF00FF">db    $66
       push  bx        </font><font color="#008000"><i>{ = push ebx }

       </i></font><font color="#FF00FF">db    $66
       push  dx        </font><font color="#008000"><i>{ = push edx }

       </i></font><font color="#FF00FF">db    $66
       mov   ax,word ptr ss:[bp+18]  </font><font color="#008000"><i>{ mov   eax,a }

       </i></font><font color="#FF00FF">db    $66
       mov   bx,word ptr ss:[bp+14]  </font><font color="#008000"><i>{ mov   ebx,b }

       </i></font><font color="#FF00FF">db    $66
       imul  bx        </font><font color="#008000"><i>{ imul ebx   ; a*b in edx:eax  (= 8 bytes !) }

       </i></font><font color="#FF00FF">db    $66
       mov   bx,ax     </font><font color="#008000"><i>{ mov ebx,eax }

       </i></font><font color="#FF00FF">db    $66,$0f,$a4,$da,$01     </font><font color="#008000"><i>{ SHLD edx,ebx,1      ; edx contains q }

       </i></font><font color="#FF00FF">db    $66,$25,$ff,$ff,$ff,$7f </font><font color="#008000"><i>{ and  eax,07fffffffh ; eax contains r }

       </i></font><font color="#FF00FF">les   di,r
       db    $66
       stosw           </font><font color="#008000"><i>{ stosd   ; mov eax to r }

       </i></font><font color="#FF00FF">db    $66
       mov   ax,dx     </font><font color="#008000"><i>{ mov eax,edx }

       </i></font><font color="#FF00FF">les   di,q
       db    $66
       stosw           </font><font color="#008000"><i>{ stosd   ; mov eax to q }


       </i></font><font color="#FF00FF">db   $66
       pop  dx         </font><font color="#008000"><i>{ = pop edx }

       </i></font><font color="#FF00FF">db   $66
       pop  bx         </font><font color="#008000"><i>{ = pop ebx }

       </i></font><font color="#FF00FF">db   $66
       pop  ax         </font><font color="#008000"><i>{ = pop eax }

       </i></font><font color="#FF00FF">pop  es
       pop  di
     </font><font color="#FF0000"><b>end</b></font><font color="#000080">;</font><font color="#008000"><i>{ PROC MD2P31 }


{$ENDIF}


</i></font><font color="#FF0000"><b>FUNCTION </b></font>UNIRANDOM<font color="#000080">;
  </font><font color="#008000"><i>{ Cf. Payne,W.H., Rabung, J.R., Bogyo, T.P. :
        &quot;Coding the Lehmer pseudo-random number generator.
	Comm. ACM 12, 85-86 (1969)                         }

  </i></font><font color="#FF0000"><b>CONST </b></font>MODULUS <font color="#000080">: </font>longint <font color="#000080">= </font><font color="#800000">2147483647</font><font color="#000080">;  </font><font color="#008000"><i>{ = 2^31-1 }
        </i></font>FACTOR  <font color="#000080">: </font>longint <font color="#000080">= </font><font color="#800000">397204094</font><font color="#000080">;   </font><font color="#008000"><i>{ primitive root, e.g. used by SAS }

  </i></font><font color="#FF0000"><b>VAR   </b></font>Q<font color="#000080">,</font>R<font color="#000080">,</font>S <font color="#000080">: </font>longint<font color="#000080">;

  </font><font color="#FF0000"><b>BEGIN </b></font><font color="#008000"><i>{ UNIRANDOM }

    </i></font><font color="#FF0000"><b>IF </b></font>TEST8086<font color="#000080">&gt;</font><font color="#800000">1 </font><font color="#FF0000"><b>THEN
      BEGIN
        </b></font><font color="#008000"><i>{ Priniple
	     seed := ( seed*FACTOR )  MOD  MODULUS;
          but can not use it due to overflow }

        </i></font>MD2P31 <font color="#000080">( </font>seed<font color="#000080">, </font>factor<font color="#000080">, </font>Q<font color="#000080">, </font>R <font color="#000080">);
        </font>S <font color="#000080">:= </font>modulus <font color="#000080">- </font>R<font color="#000080">;
        </font><font color="#FF0000"><b>IF </b></font>S <font color="#000080">&gt; </font>Q
          <font color="#FF0000"><b>THEN </b></font>seed <font color="#000080">:= </font>Q <font color="#000080">+ </font>R
          <font color="#FF0000"><b>ELSE </b></font>seed <font color="#000080">:= </font>Q <font color="#000080">- </font>S<font color="#000080">;

        </font><font color="#008000"><i>{ Single precision version. For more details on the division cf. to
          Fishman, G.S., Moore, L.R. :
          A statistical evaluation of multiplicative congruential random
          number generators with modulus 2^31-1 .
          Jour. Amer. Stat. Ass. 77, 129-136 *1982)                         }

        </i></font>UNIRANDOM <font color="#000080">:= </font>seed<font color="#000080">/</font>MODULUS<font color="#000080">;
      </font><font color="#FF0000"><b>END
     ELSE
      </b></font><font color="#008000"><i>{see comment at the beginning of unit, RandSeed from unit SYSTEM}
       </i></font><font color="#FF0000"><b>BEGIN
         </b></font>RandSeed <font color="#000080">:= </font>seed<font color="#000080">; </font>Unirandom <font color="#000080">:= </font>random<font color="#000080">; </font>seed <font color="#000080">:= </font>RandSeed<font color="#000080">;
       </font><font color="#FF0000"><b>END</b></font><font color="#000080">;


  </font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>{ FUNC UNIRANDOM }


            {--------------------------------------------}


</i></font><font color="#FF0000"><b>FUNCTION  </b></font>NORRANDOM  <font color="#000080">( </font><font color="#FF0000"><b>VAR </b></font>seed <font color="#000080">: </font>longint  <font color="#000080">)  : </font>real<font color="#000080">;
  </font><font color="#FF0000"><b>CONST </b></font>TwoPi <font color="#000080">= </font><font color="#800000">2</font><font color="#000080">*</font>Pi<font color="#000080">;
  </font><font color="#FF0000"><b>VAR     </b></font>s<font color="#000080">, </font>r1<font color="#000080">, </font>r2<font color="#000080">, </font>z1<font color="#000080">, </font>z2 <font color="#000080">: </font>real<font color="#000080">;
  </font><font color="#FF0000"><b>BEGIN </b></font><font color="#008000"><i>{ NORRANDOM }
    </i></font><font color="#FF0000"><b>REPEAT </b></font>r1 <font color="#000080">:= </font>UniRandom <font color="#000080">( </font>seed <font color="#000080">) </font><font color="#FF0000"><b>UNTIL </b></font>r1<font color="#000080">&gt;</font><font color="#800000">0</font><font color="#000080">;
    </font>r2 <font color="#000080">:= </font>UniRandom <font color="#000080">( </font>seed <font color="#000080">);
    </font>s <font color="#000080">:= -</font><font color="#800000">2</font><font color="#000080">*</font>ln<font color="#000080">(</font>r1<font color="#000080">);
    </font><font color="#FF0000"><b>IF </b></font>s<font color="#000080">&lt;</font><font color="#800000">0 </font><font color="#FF0000"><b>THEN </b></font>s <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;         </font><font color="#008000"><i>{ round off error could give negative value s }
    </i></font>NORRANDOM <font color="#000080">:= </font>SQRT <font color="#000080">( </font>s <font color="#000080">) * </font>cos <font color="#000080">( </font>TwoPi<font color="#000080">*</font>r2 <font color="#000080">);
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>{ FUNC NORRANDOM }

            {--------------------------------------------}

</i></font><font color="#FF0000"><b>FUNCTION  </b></font>NorRandom2 <font color="#000080">( </font><font color="#FF0000"><b>VAR </b></font>seed <font color="#000080">: </font>longint<font color="#000080">;
                       </font><font color="#FF0000"><b>VAR </b></font>v2   <font color="#000080">: </font>real <font color="#000080">) : </font>real<font color="#000080">;
 </font><font color="#008000"><i>{ Polar method due to Box, Mueller and Marsaglia,
   cf. D.E. Knuth, The art of computer porgramming, vol 2, 117
   first call: v2 must be &gt; 1000 }

  </i></font><font color="#FF0000"><b>VAR     </b></font>s<font color="#000080">, </font>t<font color="#000080">, </font>v1 <font color="#000080">: </font>real<font color="#000080">;

  </font><font color="#FF0000"><b>BEGIN </b></font><font color="#008000"><i>{ NORRANDOM2 }
    </i></font><font color="#FF0000"><b>IF </b></font>v2<font color="#000080">&lt;</font><font color="#800000">1000
      </font><font color="#FF0000"><b>THEN
        BEGIN
          </b></font>NORRANDOM2 <font color="#000080">:= </font>v2<font color="#000080">; </font>v2 <font color="#000080">:= </font><font color="#800000">2000
        </font><font color="#FF0000"><b>END
      ELSE
        BEGIN
          REPEAT
            </b></font>v1 <font color="#000080">:= </font>UniRandom <font color="#000080">( </font>seed <font color="#000080">); </font>v1 <font color="#000080">:= </font>v1<font color="#000080">+</font>v1<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">;
            </font>v2 <font color="#000080">:= </font>UniRandom <font color="#000080">( </font>seed <font color="#000080">); </font>v2 <font color="#000080">:= </font>v2<font color="#000080">+</font>v2<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">;
            </font>s <font color="#000080">:= </font>Sqr <font color="#000080">(</font>v1<font color="#000080">) + </font>sqr<font color="#000080">(</font>v2<font color="#000080">);
          </font><font color="#FF0000"><b>UNTIL </b></font><font color="#000080">(</font>s<font color="#000080">&lt;</font><font color="#800000">1</font><font color="#000080">) </font><font color="#FF0000"><b>AND </b></font><font color="#000080">(</font>s<font color="#000080">&gt;</font><font color="#800000">0</font><font color="#000080">);
          </font>T <font color="#000080">:= </font>Sqrt <font color="#000080">( -</font><font color="#800000">2</font><font color="#000080">*</font>Ln<font color="#000080">(</font>s<font color="#000080">)/</font>s <font color="#000080">);
          </font>NORRANDOM2 <font color="#000080">:= </font>V1<font color="#000080">*</font>T<font color="#000080">;
          </font>V2 <font color="#000080">:= </font>V2<font color="#000080">*</font>T<font color="#000080">;
        </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>{ FUNC NORRANDOM2 }


            {--------------------------------------------}

</i></font><font color="#FF0000"><b>FUNCTION  </b></font>NORRANDOM3 <font color="#000080">( </font>mean<font color="#000080">, </font>std <font color="#000080">: </font>real<font color="#000080">;
                       </font><font color="#FF0000"><b>VAR </b></font>seed <font color="#000080">: </font>longint <font color="#000080">) : </font>real<font color="#000080">;
  </font><font color="#FF0000"><b>BEGIN </b></font><font color="#008000"><i>{ NORRANDOM3 }
    </i></font>NORRANDOM3 <font color="#000080">:= </font>std<font color="#000080">*</font>NORRANDOM <font color="#000080">(</font>seed<font color="#000080">) + </font>mean<font color="#000080">;
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>{ FUNC NORRANDOM3 }

            {--------------------------------------------}

</i></font><font color="#FF0000"><b>FUNCTION  </b></font>EXPRANDOM  <font color="#000080">( </font>mean     <font color="#000080">: </font>real<font color="#000080">;
                       </font><font color="#FF0000"><b>VAR </b></font>seed <font color="#000080">: </font>longint <font color="#000080">) : </font>real<font color="#000080">;
  </font><font color="#FF0000"><b>BEGIN </b></font><font color="#008000"><i>{ EXPRANDOM }
     </i></font>EXPRANDOM <font color="#000080">:= ( -</font>ln<font color="#000080">(</font>UNIRANDOM<font color="#000080">(</font>seed<font color="#000080">))*</font>mean <font color="#000080">);
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>{ FUNC EXPRANDOM }

            {--------------------------------------------}

</i></font><font color="#FF0000"><b>FUNCTION  </b></font>LOGNORRANDOM <font color="#000080">( </font>mean<font color="#000080">, </font>std <font color="#000080">: </font>real<font color="#000080">;
                         </font><font color="#FF0000"><b>VAR </b></font>seed  <font color="#000080">: </font>longint <font color="#000080">) : </font>real<font color="#000080">;
  </font><font color="#FF0000"><b>VAR     </b></font>m2<font color="#000080">, </font>s2<font color="#000080">, </font>sum<font color="#000080">, </font>mu<font color="#000080">, </font>sigma <font color="#000080">: </font>real<font color="#000080">;
  </font><font color="#FF0000"><b>BEGIN </b></font><font color="#008000"><i>{ LOGNORRANDOM }
    </i></font>m2 <font color="#000080">:= </font>SQR<font color="#000080">(</font>mean<font color="#000080">); </font>s2 <font color="#000080">:= </font>SQR<font color="#000080">(</font>std<font color="#000080">); </font>sum <font color="#000080">:= </font>m2<font color="#000080">+</font>s2<font color="#000080">;
    </font>mu <font color="#000080">:= </font><font color="#800000">0.5</font><font color="#000080">*</font>ln<font color="#000080">(</font>SQR<font color="#000080">(</font>m2<font color="#000080">)/</font>sum<font color="#000080">);
    </font>sigma <font color="#000080">:= </font>SQRT <font color="#000080">(</font>ln<font color="#000080">(</font>sum<font color="#000080">/</font>m2<font color="#000080">));
    </font>LOGNORRANDOM <font color="#000080">:= </font>exp <font color="#000080">(</font>sigma <font color="#000080">* </font>NORRANDOM <font color="#000080">(</font>seed<font color="#000080">) + </font>mu<font color="#000080">);
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>{ FUNC LOGNORRANDOM }

            {--------------------------------------------}

</i></font><font color="#FF0000"><b>FUNCTION  </b></font>POIRANDOM  <font color="#000080">(  </font>lambda   <font color="#000080">: </font>real<font color="#000080">;
                        </font><font color="#FF0000"><b>VAR </b></font>seed <font color="#000080">: </font>longint <font color="#000080">)  : </font>longint<font color="#000080">;


  </font><font color="#FF0000"><b>VAR     </b></font>i <font color="#000080">: </font>longint<font color="#000080">;
          </font>p<font color="#000080">,</font>q<font color="#000080">,</font>r<font color="#000080">,</font>z <font color="#000080">: </font>real<font color="#000080">;

  </font><font color="#FF0000"><b>BEGIN </b></font><font color="#008000"><i>{ POIRANDOM }
    { cf. H.E. Schaffer, Generator of random numbers satisfying the
          Poisson distribution, Comm. ACM 13, 49 (1970)
          G.S. Fishman, Sampling from the Poisson distribution on
          a computer, Computing 17, 147-156 (1976) }
    </i></font><font color="#FF0000"><b>IF </b></font>lambda<font color="#000080">&lt;</font><font color="#800000">50
      </font><font color="#FF0000"><b>THEN
        BEGIN
          </b></font>z <font color="#000080">:= </font>exp <font color="#000080">( -</font>lambda <font color="#000080">); </font>p <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">; </font>i <font color="#000080">:= -</font><font color="#800000">1</font><font color="#000080">;
          </font><font color="#FF0000"><b>REPEAT
            </b></font>i <font color="#000080">:= </font>i<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">;
            </font>r <font color="#000080">:= </font>UNIRANDOM <font color="#000080">( </font>seed <font color="#000080">);
            </font>p <font color="#000080">:= </font>p<font color="#000080">*</font>r<font color="#000080">;
          </font><font color="#FF0000"><b>UNTIL </b></font>p<font color="#000080">&lt;=</font>z<font color="#000080">;
          </font>POIRANDOM <font color="#000080">:= </font>i<font color="#000080">;
        </font><font color="#FF0000"><b>END
      ELSE
        BEGIN
          </b></font>i <font color="#000080">:= </font>Round <font color="#000080">( </font>NORRANDOM3 <font color="#000080">( </font>lambda<font color="#000080">, </font>SQRT<font color="#000080">(</font>lambda<font color="#000080">), </font>seed <font color="#000080">) );
          </font><font color="#FF0000"><b>IF </b></font>i<font color="#000080">&lt;</font><font color="#800000">0 </font><font color="#FF0000"><b>THEN </b></font>i <font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
          </font>POIRANDOM <font color="#000080">:= </font>i<font color="#000080">;
        </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>{ PROC POIRANDOM }

            {--------------------------------------------}

</i></font><font color="#FF0000"><b>PROCEDURE </b></font>RanSphere <font color="#000080">( </font><font color="#FF0000"><b>VAR </b></font>seed <font color="#000080">: </font>longint<font color="#000080">;
                      </font><font color="#FF0000"><b>VAR </b></font>x<font color="#000080">,</font>y<font color="#000080">,</font>z <font color="#000080">: </font>real <font color="#000080">);
 </font><font color="#008000"><i>{ R.E. Knop, Random Vectors Uniform in Solid Angle,
   CACM 13 (1970), 326 }

  </i></font><font color="#FF0000"><b>VAR     </b></font>s<font color="#000080">, </font>t<font color="#000080">, </font>v1<font color="#000080">, </font>v2 <font color="#000080">: </font>real<font color="#000080">;

  </font><font color="#FF0000"><b>BEGIN </b></font><font color="#008000"><i>{ RanSphere }

    </i></font><font color="#FF0000"><b>REPEAT
      </b></font>v1 <font color="#000080">:= </font>UniRandom <font color="#000080">( </font>seed <font color="#000080">); </font>v1 <font color="#000080">:= </font>v1<font color="#000080">+</font>v1<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">;
      </font>v2 <font color="#000080">:= </font>UniRandom <font color="#000080">( </font>seed <font color="#000080">); </font>v2 <font color="#000080">:= </font>v2<font color="#000080">+</font>v2<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">;
      </font>s <font color="#000080">:= </font>Sqr <font color="#000080">(</font>v1<font color="#000080">) + </font>sqr<font color="#000080">(</font>v2<font color="#000080">);
    </font><font color="#FF0000"><b>UNTIL </b></font><font color="#000080">(</font>s<font color="#000080">&lt;</font><font color="#800000">1</font><font color="#000080">) </font><font color="#FF0000"><b>AND </b></font><font color="#000080">(</font>s<font color="#000080">&gt;</font><font color="#800000">0</font><font color="#000080">);

    </font>T <font color="#000080">:= </font><font color="#800000">2</font><font color="#000080">*</font>Sqrt <font color="#000080">( </font><font color="#800000">1</font><font color="#000080">-</font>S <font color="#000080">);
    </font>x <font color="#000080">:= </font>T<font color="#000080">*</font>V1<font color="#000080">; </font>y <font color="#000080">:= </font>T<font color="#000080">*</font>V2<font color="#000080">; </font>z <font color="#000080">:= </font>S<font color="#000080">+</font>S<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">;

  </font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>{ PROC RanSphere }


</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">. </font><font color="#008000"><i>{UNIT RANGEN}

{---------------------   DEMO ---------------------- }
{ ----------- CUT ---------------- }

{$A+,B-,D+,E+,F-,G-,I+,L+,N-,O-,P-,Q-,R+,S+,T-,V+,X+,Y+}
{$M 16384,0,655360}
</i></font><font color="#FF0000"><b>program </b></font>testrand<font color="#000080">;
  </font><font color="#FF0000"><b>uses </b></font>rangen<font color="#000080">;

  </font><font color="#008000"><i>{generates two independent streams of uniform random numbers}

</i></font><font color="#FF0000"><b>VAR </b></font>r1<font color="#000080">, </font>r2 <font color="#000080">: </font>real<font color="#000080">;
    </font>seed1<font color="#000080">, </font>seed2 <font color="#000080">: </font>longint<font color="#000080">;
    </font>i <font color="#000080">: </font>integer<font color="#000080">;

</font><font color="#FF0000"><b>BEGIN

  </b></font>write <font color="#000080">(</font><font color="#800000">'enter seed1, seed2 = ' </font><font color="#000080">); </font>readln <font color="#000080">( </font>seed1<font color="#000080">, </font>seed2 <font color="#000080">);
  </font><font color="#FF0000"><b>for </b></font>i <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>TO </b></font><font color="#800000">20 </font><font color="#FF0000"><b>DO
    BEGIN
      </b></font>r1 <font color="#000080">:= </font>unirandom<font color="#000080">(</font>seed1<font color="#000080">);
      </font>r2 <font color="#000080">:= </font>unirandom<font color="#000080">(</font>seed2<font color="#000080">);
      </font>writeln <font color="#000080">( </font>seed1<font color="#000080">:</font><font color="#800000">12</font><font color="#000080">, </font>r1<font color="#000080">:</font><font color="#800000">12</font><font color="#000080">:</font><font color="#800000">8</font><font color="#000080">, </font>seed2<font color="#000080">:</font><font color="#800000">12</font><font color="#000080">, </font>r2<font color="#000080">:</font><font color="#800000">12</font><font color="#000080">:</font><font color="#800000">8 </font><font color="#000080">);
    </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
  </font>readln<font color="#000080">;

</font><font color="#FF0000"><b>END</b></font><font color="#000080">.



</font><font color="#008000"><i>{ ---------------------------------  ASM UNIT THAT CAN BE USED IN THIS UNIT ------------- }
{ ----------- CUT ---------------- }

</i></font><font color="#000080">; </font>MD2P31<font color="#000080">.</font><font color="#FF0000"><b>ASM</b></font><font color="#FF00FF">, for Turbo Assembler

          .MODEL TPASCAL    ; 16-bit segments
          .386C             ; non-privileged 386 instructions

CODE      SEGMENT BYTE PUBLIC
          ASSUME cs:CODE,ds:NOTHING

; PASCAL declaration
;   PROCEDURE MD2P31 (A,B : longint;
;                     VAR Q,R : longint); far; external;

; calculate product a*b, represent product as q*2^31+r, 0&lt;=r&lt;2^31
; return q and r

; Parameters (+2 because of push bp)

R         EQU DWORD PTR ss:[bp+6]
Q         EQU DWORD PTR ss:[bp+10]
B         EQU DWORD PTR ss:[bp+14]
A         EQU DWORD PTR ss:[bp+18]


MD2P31    PROC FAR
          PUBLIC MD2P31

          push  bp
          mov   bp,sp          ;get pointer into stack
          push  es
          push  di             ;manual says we don't need to save
          push  eax            ;those registers, but safety first!
          push  ebx
          push  edx

          mov   eax,a
          mov   ebx,b
          imul  ebx            ; a*b in edx:eax

          mov   ebx,eax
          SHLD  edx,ebx,1      ; edx contains q

          and   eax,07fffffffh ; eax contains r
          les   di,r
          stosd

          mov   eax,edx
          les   di,q
          stosd

          pop   edx
          pop   ebx
          pop   eax
          pop   di
          pop   es
          pop   bp
          retf  16             ;parameters take 16 bytes
MD2P31    ENDP

CODE      ENDS

          </font><font color="#FF0000"><b>END
</b></font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to MATH SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0133.PAS">Original</a><b>]</b></p></body>
</html>
