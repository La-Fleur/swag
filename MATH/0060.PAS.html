<html>
<head><title> "Math Expression Evaluatio" by PAT DANT</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to MATH SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0060.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#FF0000"><b>unit </b></font>Eval<font color="#000080">;
</font><font color="#FF0000"><b>interface

  function </b></font>ExpValue <font color="#000080">(</font>ExpLine <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">; </font><font color="#FF0000"><b>var </b></font>Error <font color="#000080">: </font>boolean<font color="#000080">) : </font>real<font color="#000080">;

</font><font color="#FF0000"><b>implementation

  function </b></font>ExpValue <font color="#000080">(</font>ExpLine <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">; </font><font color="#FF0000"><b>var </b></font>Error <font color="#000080">: </font>boolean<font color="#000080">) : </font>real<font color="#000080">;
  </font><font color="#FF0000"><b>var
    </b></font>Index            <font color="#000080">: </font>integer<font color="#000080">;
    </font>Ltr              <font color="#000080">: </font>char<font color="#000080">;
    </font>NextLtr          <font color="#000080">: </font>char<font color="#000080">;
    </font>Token            <font color="#000080">: </font>char<font color="#000080">;
    </font>TokenValue       <font color="#000080">: </font>real<font color="#000080">;

    </font><font color="#FF0000"><b>procedure </b></font>GetLtr<font color="#000080">;
    </font><font color="#FF0000"><b>begin </b></font><font color="#008000"><i>{GetLtr}
      </i></font>Ltr <font color="#000080">:= </font>NextLtr<font color="#000080">;
      </font><font color="#FF0000"><b>if </b></font>Index <font color="#000080">&lt; </font>length <font color="#000080">(</font>ExpLine<font color="#000080">) </font><font color="#FF0000"><b>then begin
        </b></font>Index <font color="#000080">:= </font>succ <font color="#000080">(</font>Index<font color="#000080">);
        </font>NextLtr <font color="#000080">:= </font>ExpLine <font color="#000080">[</font>Index<font color="#000080">];
      </font><font color="#FF0000"><b>end else begin
        </b></font>NextLtr <font color="#000080">:= </font><font color="#800000">'%'</font><font color="#000080">;
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

    </font><font color="#FF0000"><b>procedure </b></font>GetToken<font color="#000080">;
      </font><font color="#FF0000"><b>procedure </b></font>GetNum<font color="#000080">;
        </font><font color="#FF0000"><b>var
          </b></font>Str <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
          </font>E   <font color="#000080">: </font>integer<font color="#000080">;
      </font><font color="#FF0000"><b>begin
        </b></font>Str <font color="#000080">:= </font><font color="#800000">'0'</font><font color="#000080">+</font>Ltr<font color="#000080">; </font><font color="#008000"><i>{Avoids problems if first char is '.'}
        </i></font><font color="#FF0000"><b>while </b></font>NextLtr <font color="#FF0000"><b>in </b></font><font color="#000080">[</font><font color="#800000">'0'</font><font color="#000080">..</font><font color="#800000">'9'</font><font color="#000080">] </font><font color="#FF0000"><b>do begin
          </b></font>GetLtr<font color="#000080">;
          </font>Str <font color="#000080">:= </font>Str <font color="#000080">+ </font>Ltr<font color="#000080">;
        </font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{while}
        </i></font><font color="#FF0000"><b>if </b></font>NextLtr <font color="#000080">= </font><font color="#800000">'.' </font><font color="#FF0000"><b>then begin
          </b></font>GetLtr<font color="#000080">;
          </font>Str <font color="#000080">:= </font>Str <font color="#000080">+ </font>Ltr<font color="#000080">;
          </font><font color="#FF0000"><b>while </b></font>NextLtr <font color="#FF0000"><b>in </b></font><font color="#000080">[</font><font color="#800000">'0'</font><font color="#000080">..</font><font color="#800000">'9'</font><font color="#000080">] </font><font color="#FF0000"><b>do begin
            </b></font>GetLtr<font color="#000080">;
            </font>Str <font color="#000080">:= </font>Str <font color="#000080">+ </font>Ltr<font color="#000080">;
          </font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{while}
          </i></font>Str <font color="#000080">:= </font>Str <font color="#000080">+ </font><font color="#800000">'0'</font><font color="#000080">; </font><font color="#008000"><i>{Avoids problems if last char is '.'}
        </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;
        </font>val <font color="#000080">(</font>Str<font color="#000080">,</font>TokenValue<font color="#000080">,</font>E<font color="#000080">);
        </font>Error <font color="#000080">:= </font>E <font color="#000080">&lt;&gt; </font><font color="#800000">0</font><font color="#000080">;
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

    </font><font color="#FF0000"><b>begin </b></font><font color="#008000"><i>{GetToken}
      </i></font>GetLtr<font color="#000080">;
      </font><font color="#FF0000"><b>while </b></font>Ltr <font color="#000080">= </font><font color="#800000">' ' </font><font color="#FF0000"><b>do </b></font>GetLtr<font color="#000080">;
      </font><font color="#FF0000"><b>if </b></font>Ltr <font color="#FF0000"><b>in </b></font><font color="#000080">[</font><font color="#800000">'0'</font><font color="#000080">..</font><font color="#800000">'9'</font><font color="#000080">,</font><font color="#800000">'.'</font><font color="#000080">] </font><font color="#FF0000"><b>then begin
        </b></font>GetNum<font color="#000080">;
        </font>Token <font color="#000080">:= </font><font color="#800000">'#'</font><font color="#000080">;
      </font><font color="#FF0000"><b>end else begin
        </b></font>Token <font color="#000080">:= </font>Ltr<font color="#000080">;
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>Expression <font color="#000080">: </font>real<font color="#000080">;
  </font><font color="#FF0000"><b>var
    </b></font>IExp             <font color="#000080">: </font>real<font color="#000080">;

    </font><font color="#FF0000"><b>function </b></font>Term <font color="#000080">: </font>real<font color="#000080">;
    </font><font color="#FF0000"><b>var
      </b></font>ITerm <font color="#000080">: </font>real<font color="#000080">;
      </font>TFact <font color="#000080">: </font>real<font color="#000080">;

      </font><font color="#FF0000"><b>function </b></font>Factor <font color="#000080">: </font>real<font color="#000080">;
      </font><font color="#FF0000"><b>var
        </b></font>IFact <font color="#000080">: </font>real<font color="#000080">;

      </font><font color="#FF0000"><b>begin </b></font><font color="#008000"><i>{Factor}
        </i></font><font color="#FF0000"><b>case </b></font>Token <font color="#FF0000"><b>of
          </b></font><font color="#800000">'(' </font><font color="#000080">:
            </font><font color="#FF0000"><b>begin
              </b></font>GetToken<font color="#000080">;
              </font>IFact <font color="#000080">:= </font>Expression<font color="#000080">;
              </font><font color="#FF0000"><b>if </b></font>Token <font color="#000080">&lt;&gt; </font><font color="#800000">')' </font><font color="#FF0000"><b>then </b></font>Error <font color="#000080">:= </font>true<font color="#000080">;
            </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
          </font><font color="#800000">'#' </font><font color="#000080">:
            </font><font color="#FF0000"><b>begin
              </b></font>IFact <font color="#000080">:= </font>TokenValue<font color="#000080">;
            </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
          </font><font color="#FF0000"><b>else
            </b></font>Error <font color="#000080">:= </font>true<font color="#000080">;
        </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
        </font>Factor <font color="#000080">:= </font>IFact<font color="#000080">;
        </font>GetToken<font color="#000080">;
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

    </font><font color="#FF0000"><b>begin </b></font><font color="#008000"><i>{Term}
      </i></font><font color="#FF0000"><b>if </b></font>Token <font color="#000080">= </font><font color="#800000">'-' </font><font color="#FF0000"><b>then begin
        </b></font>GetToken<font color="#000080">;
        </font>ITerm <font color="#000080">:= -</font>Factor<font color="#000080">;
      </font><font color="#FF0000"><b>end else begin
        if </b></font>Token <font color="#000080">= </font><font color="#800000">'+' </font><font color="#FF0000"><b>then begin
          </b></font>GetToken<font color="#000080">;
        </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
        </font>ITerm <font color="#000080">:= </font>Factor<font color="#000080">;
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>if not </b></font>Error <font color="#FF0000"><b>then begin
        while </b></font>Token <font color="#FF0000"><b>in </b></font><font color="#000080">[</font><font color="#800000">'*'</font><font color="#000080">,</font><font color="#800000">'/'</font><font color="#000080">] </font><font color="#FF0000"><b>do begin
          case </b></font>Token <font color="#FF0000"><b>of
            </b></font><font color="#800000">'*' </font><font color="#000080">:
              </font><font color="#FF0000"><b>begin
                </b></font>GetToken<font color="#000080">;
                </font>ITerm <font color="#000080">:= </font>ITerm <font color="#000080">* </font>Factor<font color="#000080">;
              </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
            </font><font color="#800000">'/' </font><font color="#000080">:
              </font><font color="#FF0000"><b>begin
                </b></font>GetToken<font color="#000080">;
                </font>TFact <font color="#000080">:= </font>Factor<font color="#000080">;
                </font><font color="#FF0000"><b>if </b></font>TFact <font color="#000080">&lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then begin
                  </b></font>ITerm <font color="#000080">:= </font>ITerm <font color="#000080">/ </font>TFact<font color="#000080">;
                </font><font color="#FF0000"><b>end else begin
                  </b></font>Error <font color="#000080">:= </font>true<font color="#000080">;
                </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
              </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
          </font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{case}
        </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{while}
      </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{if}
      </i></font>Term <font color="#000080">:= </font>ITerm<font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{Term}

  </i></font><font color="#FF0000"><b>begin </b></font><font color="#008000"><i>{Expression}
    </i></font>IExp <font color="#000080">:= </font>Term<font color="#000080">;
    </font><font color="#FF0000"><b>if not </b></font>Error <font color="#FF0000"><b>then begin
      while </b></font>Token <font color="#FF0000"><b>in </b></font><font color="#000080">[</font><font color="#800000">'+'</font><font color="#000080">,</font><font color="#800000">'-'</font><font color="#000080">] </font><font color="#FF0000"><b>do begin
        case </b></font>Token <font color="#FF0000"><b>of
          </b></font><font color="#800000">'+' </font><font color="#000080">:
            </font><font color="#FF0000"><b>begin
              </b></font>GetToken<font color="#000080">;
              </font>IExp <font color="#000080">:= </font>IExp <font color="#000080">+ </font>Term<font color="#000080">;
            </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
          </font><font color="#800000">'-' </font><font color="#000080">:
            </font><font color="#FF0000"><b>begin
              </b></font>GetToken<font color="#000080">;
              </font>IExp <font color="#000080">:= </font>IExp <font color="#000080">- </font>Term<font color="#000080">;
            </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
        </font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{case}
      </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{while}
    </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{if}
    </i></font>Expression <font color="#000080">:= </font>IExp<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{Expression}

  </i></font><font color="#FF0000"><b>begin </b></font><font color="#008000"><i>{ExpValue}</i></font><font color="#000080">;
    </font>Error <font color="#000080">:= </font>false<font color="#000080">;
    </font>Index <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
    </font>NextLtr <font color="#000080">:= </font><font color="#800000">' '</font><font color="#000080">;
    </font>GetLtr<font color="#000080">;
    </font>GetToken<font color="#000080">;
    </font><font color="#FF0000"><b>if </b></font>Token <font color="#000080">= </font><font color="#800000">'%' </font><font color="#FF0000"><b>then begin
      </b></font>ExpValue <font color="#000080">:= </font><font color="#800000">0.0</font><font color="#000080">;
    </font><font color="#FF0000"><b>end else begin
      </b></font>ExpValue <font color="#000080">:= </font>Expression<font color="#000080">;
      </font><font color="#FF0000"><b>if </b></font>Token <font color="#000080">&lt;&gt; </font><font color="#800000">'%' </font><font color="#FF0000"><b>then </b></font>Error <font color="#000080">:= </font>true<font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>end</b></font><font color="#000080">.

</font><font color="#008000"><i>{ --------------------------------   DEMO  --------------------- }

</i></font><font color="#FF0000"><b>Program </b></font>Evaluate<font color="#000080">;
</font><font color="#008000"><i>(* 10/1189  *)
(* Uploaded by Pat Dant  *)
(* Based on the Pascal Unit Eval that allows you to take a string
   and perform a recurssive math function on the string resulting
   in a real answer.
   This Exe version allows the command line argument to be the string
   and will print the answer on the screen at the current cursor position.*)

(* ExpValue unit is designed by Don McIver in his very well written program
   SCB Checkbook Program. Currently version 4.2.*)

</i></font><font color="#FF0000"><b>Uses  </b></font>Dos<font color="#000080">, </font>Crt<font color="#000080">, </font>Eval<font color="#000080">;

</font><font color="#FF0000"><b>const
 </b></font>EvalStrPos           <font color="#000080">=  </font><font color="#800000">1</font><font color="#000080">;

</font><font color="#FF0000"><b>var
 </b></font>EvalString           <font color="#000080">:  </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
 </font>Answer               <font color="#000080">:  </font>real<font color="#000080">;
 </font>EvalError            <font color="#000080">:  </font>Boolean<font color="#000080">;

 </font><font color="#FF0000"><b>begin
   </b></font>ClrScr<font color="#000080">;
   </font>Answer <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
   </font>EvalError <font color="#000080">:= </font>False<font color="#000080">;
   </font>Answer <font color="#000080">:= </font>ExpValue<font color="#000080">(</font>ParamStr<font color="#000080">(</font>EvalStrPos<font color="#000080">),</font>EvalError <font color="#000080">);
   </font><font color="#FF0000"><b>if </b></font>EvalError <font color="#FF0000"><b>then begin
      </b></font>Writeln<font color="#000080">(</font><font color="#800000">'Error in Command Line Format : '</font><font color="#000080">,</font>Answer<font color="#000080">:</font><font color="#800000">8</font><font color="#000080">:</font><font color="#800000">2</font><font color="#000080">);
      </font>Halt<font color="#000080">;
   </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
   </font>Write<font color="#000080">(</font>Answer<font color="#000080">:</font><font color="#800000">8</font><font color="#000080">:</font><font color="#800000">2</font><font color="#000080">);
 </font><font color="#FF0000"><b>end</b></font><font color="#000080">.


</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to MATH SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0060.PAS">Original</a><b>]</b></p></body>
</html>
