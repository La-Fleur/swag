<html>
<head><title> "Command Position" by SWAG SUPPORT TEAM</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to CMDLINE SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0007.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
I have two BAsm Procedures I have written to speed up a Program which scans a
comma delimited line.    My testing has shown 50,000 iterations of this
Function to be approx 3 seconds faster than TP's  Var := Pos(',',String);

I am fairly new to Assembly.   This Function doES in fact work, but not as fast
as I feel it should.    Can anyone see any places I have gone wrong in speed?
I've avoided copying the String to the stack, by just declaring a Pointer
Variable as the Function's input.  I'd like to squeeze a couple more seconds
out of it if I could.   The Procedures will deal With about 6 megs of data all
on comma delimited lines.

I suppose I COULD speed it up, by not declaring ANY Variable, and hard-code it
to specifically use the String Variable I am currently passing to it.
 }

</i></font><font color="#FF0000"><b>Function </b></font>Commapos<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>STRNG<font color="#000080">) : </font>Byte<font color="#000080">; </font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">; </font><font color="#FF0000"><b>Asm
 </b></font><font color="#FF00FF">LES DI, STRNG     </font><font color="#008000"><i>{ Point ES:DI to beginning of STRNG }
 </i></font><font color="#FF00FF">xor CH, CH        </font><font color="#008000"><i>{ Just in Case anything is in Register CH }
 </i></font><font color="#FF00FF">MOV CL, [ES:DI]   </font><font color="#008000"><i>{ Load String Length into CL }
 </i></font><font color="#FF00FF">MOV AH, CL        </font><font color="#008000"><i>{ Save len to Compute commapos later }
 </i></font><font color="#FF00FF">inC DI            </font><font color="#008000"><i>{ Point to First Char in String }
 </i></font><font color="#FF00FF">MOV AL, ','       </font><font color="#008000"><i>{ Looking For Comma }
 </i></font><font color="#FF00FF">CLD
@SCANForCOMMALOOP:
 SCASB             </font><font color="#008000"><i>{ Compare [ES:DI] to contents of AL, inc DI, Dec CL}
 </i></font><font color="#FF00FF">JE @FOUND_COMMA   </font><font color="#008000"><i>{ Found a Comma! }
 </i></font><font color="#FF00FF">LOOP @SCANForCOMMALOOP  </font><font color="#008000"><i>{ No Such Luck! }
 </i></font><font color="#FF00FF">MOV AL, 0         </font><font color="#008000"><i>{ Loop Fell through, no comma exists, set position to 0 }
 </i></font><font color="#FF00FF">JMP @OUTTAHERE    </font><font color="#008000"><i>{ JumpOut of Loop and Exit } </i></font><font color="#FF00FF">@FOUND_COMMA:
 DEC CL            </font><font color="#008000"><i>{ Reduce by one, since DI was advanced past the comma }
 </i></font><font color="#FF00FF">SUB AH, CL        </font><font color="#008000"><i>{ Subtract CL from AH to give the position }
 </i></font><font color="#FF00FF">MOV AL, AH        </font><font color="#008000"><i>{ Put the result into AL to return to Turbo } </i></font><font color="#FF00FF">@OUTTAHERE:
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to CMDLINE SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0007.PAS">Original</a><b>]</b></p></body>
</html>
