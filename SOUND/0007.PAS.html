<html>
<head><title> "SB-VOC.PAS" by SWAG SUPPORT TEAM</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to SOUND SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0007.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{ JR&gt; Well, Can you post the sorce code on how to play to the Sound blaster
 JR&gt; Byte by Byte? I could probley find out after that!
 JR&gt; James

Sure thing... this Program will load a File into memory then play it a Byte
at a time... It should be pretty self-explanatory.
}

</i></font><font color="#FF0000"><b>Program </b></font>rawdemo<font color="#000080">;

</font><font color="#FF0000"><b>Uses </b></font>Crt<font color="#000080">;

</font><font color="#008000"><i>{$I-}

</i></font><font color="#FF0000"><b>Const
   </b></font>fname <font color="#000080">= </font><font color="#800000">'NELLAF.VOC'</font><font color="#000080">;               </font><font color="#008000"><i>{ Can be any raw data File }
   </i></font>resetport  <font color="#000080">= </font><font color="#800000">$226</font><font color="#000080">;
   </font>readport   <font color="#000080">= </font><font color="#800000">$22A</font><font color="#000080">;
   </font>Writeport  <font color="#000080">= </font><font color="#800000">$22C</font><font color="#000080">;
   </font>statusport <font color="#000080">= </font><font color="#800000">$22E</font><font color="#000080">;
   </font>dac_Write  <font color="#000080">= </font><font color="#800000">$10</font><font color="#000080">;
   </font>adc_read   <font color="#000080">= </font><font color="#800000">$20</font><font color="#000080">;
   </font>midi_read  <font color="#000080">= </font><font color="#800000">$30</font><font color="#000080">;
   </font>midi_Write <font color="#000080">= </font><font color="#800000">$38</font><font color="#000080">;
   </font>speakeron  <font color="#000080">= </font><font color="#800000">$D1</font><font color="#000080">;
   </font>speakeroff <font color="#000080">= </font><font color="#800000">$D3</font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>reset_dsp <font color="#000080">: </font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>Var
   </b></font>count<font color="#000080">, </font>bdum <font color="#000080">: </font>Byte<font color="#000080">;
</font><font color="#FF0000"><b>begin
   </b></font>reset_dsp <font color="#000080">:= </font>False<font color="#000080">;
   </font>port<font color="#000080">[</font>resetport<font color="#000080">] := </font><font color="#800000">1</font><font color="#000080">;
   </font><font color="#FF0000"><b>For </b></font>count <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font><font color="#800000">6 </font><font color="#FF0000"><b>do
      </b></font>bdum <font color="#000080">:= </font>port<font color="#000080">[</font>statusport<font color="#000080">];
   </font>port<font color="#000080">[</font>resetport<font color="#000080">] := </font><font color="#800000">0</font><font color="#000080">;
   </font><font color="#FF0000"><b>For </b></font>count <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font><font color="#800000">6 </font><font color="#FF0000"><b>do
      </b></font>bdum <font color="#000080">:= </font>port<font color="#000080">[</font>statusport<font color="#000080">];
   </font><font color="#FF0000"><b>Repeat Until </b></font>port<font color="#000080">[</font>statusport<font color="#000080">] &gt; </font><font color="#800000">$80</font><font color="#000080">;
    </font><font color="#FF0000"><b>if </b></font>port<font color="#000080">[</font>readport<font color="#000080">] = </font><font color="#800000">$AA </font><font color="#FF0000"><b>then
      </b></font>reset_dsp <font color="#000080">:= </font>True<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>spk_on<font color="#000080">;
</font><font color="#FF0000"><b>begin
   Repeat Until </b></font>port<font color="#000080">[</font>Writeport<font color="#000080">] &lt; </font><font color="#800000">$80</font><font color="#000080">;
   </font>port<font color="#000080">[</font>Writeport<font color="#000080">] := </font><font color="#800000">$D1</font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>spk_off<font color="#000080">;
</font><font color="#FF0000"><b>begin
   Repeat Until </b></font>port<font color="#000080">[</font>Writeport<font color="#000080">] &lt; </font><font color="#800000">$80</font><font color="#000080">;
   </font>port<font color="#000080">[</font>Writeport<font color="#000080">] := </font><font color="#800000">$D3</font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>generic<font color="#000080">(</font>reg<font color="#000080">,</font>cmd<font color="#000080">:</font>Integer<font color="#000080">; </font>data<font color="#000080">:</font>Byte<font color="#000080">);
</font><font color="#FF0000"><b>begin
   Repeat Until </b></font>port<font color="#000080">[</font>Writeport<font color="#000080">] &lt; </font><font color="#800000">$80</font><font color="#000080">;
   </font>port<font color="#000080">[</font>reg<font color="#000080">] := </font>cmd<font color="#000080">;
   </font><font color="#FF0000"><b>Repeat Until </b></font>port<font color="#000080">[</font>Writeport<font color="#000080">] &lt; </font><font color="#800000">$80</font><font color="#000080">;
   </font>port<font color="#000080">[</font>reg<font color="#000080">] := </font>data<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>Write_dsp<font color="#000080">(</font>data<font color="#000080">:</font>Byte<font color="#000080">); </font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Asm
   </b></font><font color="#FF00FF">mov   dx,$22C
   mov   cx,6                          </font><font color="#008000"><i>{ Change either value of CX For }
</i></font><font color="#FF00FF">@1:
   in    al,dx
   loop  @1

   mov   al,10h
   out   dx,al
   mov   cx,36                         </font><font color="#008000"><i>{ faster or slower playing. }
</i></font><font color="#FF00FF">@2:
   in    al,dx
   loop  @2

   mov   al,data
   out   dx,al
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>read_dsp <font color="#000080">: </font>Byte<font color="#000080">;
</font><font color="#FF0000"><b>begin
   Repeat Until </b></font>port<font color="#000080">[</font>Writeport<font color="#000080">] &lt; </font><font color="#800000">$80</font><font color="#000080">;
     </font>port<font color="#000080">[</font>Writeport<font color="#000080">] := </font><font color="#800000">$20</font><font color="#000080">;
   </font><font color="#FF0000"><b>Repeat Until </b></font>port<font color="#000080">[</font>statusport<font color="#000080">] &gt; </font><font color="#800000">$80</font><font color="#000080">;
   </font>read_dsp <font color="#000080">:= </font>port<font color="#000080">[</font>readport<font color="#000080">];
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>Write_midi<font color="#000080">(</font>data<font color="#000080">:</font>Byte<font color="#000080">);
</font><font color="#FF0000"><b>begin
   Repeat Until </b></font>port<font color="#000080">[</font>Writeport<font color="#000080">] &lt; </font><font color="#800000">$80</font><font color="#000080">;
   </font>port<font color="#000080">[</font>Writeport<font color="#000080">] := </font><font color="#800000">$38</font><font color="#000080">;
   </font><font color="#FF0000"><b>Repeat Until </b></font>port<font color="#000080">[</font>Writeport<font color="#000080">] &lt; </font><font color="#800000">$80</font><font color="#000080">;
   </font>port<font color="#000080">[</font>Writeport<font color="#000080">] := </font>data<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>read_midi <font color="#000080">: </font>Byte<font color="#000080">;
</font><font color="#FF0000"><b>begin
   Repeat Until </b></font>port<font color="#000080">[</font>Writeport<font color="#000080">] &lt; </font><font color="#800000">$80</font><font color="#000080">;
   </font>port<font color="#000080">[</font>Writeport<font color="#000080">] := </font><font color="#800000">$30</font><font color="#000080">;
   </font><font color="#FF0000"><b>Repeat Until </b></font>port<font color="#000080">[</font>statusport<font color="#000080">] &gt; </font><font color="#800000">$80</font><font color="#000080">;
   </font>read_midi <font color="#000080">:= </font>port<font color="#000080">[</font>readport<font color="#000080">];
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>loadFile<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>buffer<font color="#000080">:</font>Pointer<font color="#000080">; </font>Filename<font color="#000080">:</font><font color="#FF0000"><b>String</b></font><font color="#000080">) : </font>Word<font color="#000080">;
</font><font color="#FF0000"><b>Var
   </b></font>fromf <font color="#000080">: </font><font color="#FF0000"><b>File</b></font><font color="#000080">;
   </font>size <font color="#000080">: </font>LongInt<font color="#000080">;
   </font>errcode <font color="#000080">: </font>Integer<font color="#000080">;
</font><font color="#FF0000"><b>begin
   </b></font>assign<font color="#000080">(</font>fromf<font color="#000080">,</font>Filename<font color="#000080">);
   </font>reset<font color="#000080">(</font>fromf<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">);
   </font>errcode <font color="#000080">:= </font>ioresult<font color="#000080">;
   </font><font color="#FF0000"><b>if </b></font>errcode <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>then
   begin
      </b></font>size <font color="#000080">:= </font>Filesize<font color="#000080">(</font>fromf<font color="#000080">);
      </font>Writeln<font color="#000080">(</font>size<font color="#000080">);
      </font>getmem<font color="#000080">(</font>buffer<font color="#000080">,</font>size<font color="#000080">);
      </font>blockread<font color="#000080">(</font>fromf<font color="#000080">,</font>buffer<font color="#000080">^,</font>size<font color="#000080">);
   </font><font color="#FF0000"><b>end
   else </b></font>size <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
   </font>loadFile <font color="#000080">:= </font>size<font color="#000080">;
   </font>close<font color="#000080">(</font>fromf<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>unload<font color="#000080">(</font>buffer<font color="#000080">:</font>Pointer<font color="#000080">; </font>size<font color="#000080">:</font>Word<font color="#000080">);
</font><font color="#FF0000"><b>begin
   </b></font>freemem<font color="#000080">(</font>buffer<font color="#000080">,</font>size<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Var
   </b></font>ch <font color="#000080">: </font>Char<font color="#000080">;
   </font>buf <font color="#000080">: </font>Pointer<font color="#000080">;
   </font>index<font color="#000080">, </font>fsize <font color="#000080">: </font>Word<font color="#000080">;

</font><font color="#FF0000"><b>begin
   </b></font>ClrScr<font color="#000080">;
   </font>Writeln<font color="#000080">;
   </font>Writeln<font color="#000080">;
   </font><font color="#FF0000"><b>if not </b></font>reset_dsp <font color="#FF0000"><b>then
   begin
      </b></font>Writeln<font color="#000080">(</font><font color="#800000">'Unable to initialize SoundBlaster.'</font><font color="#000080">);
      </font>halt<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">);
   </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
   </font>fsize <font color="#000080">:= </font>loadFile<font color="#000080">(</font>buf<font color="#000080">,</font>fname<font color="#000080">);
   </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>fsize <font color="#000080">&lt;= </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>then
   begin
      </b></font>Writeln<font color="#000080">(</font>fname<font color="#000080">, </font><font color="#800000">' not found.'</font><font color="#000080">);
      </font>halt<font color="#000080">(</font><font color="#800000">2</font><font color="#000080">);
   </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#008000"><i>{   For index := 1 to fsize do
      dec(mem[seg(buf^):ofs(buf^)+index-1],80);}       { For MOD samples }
   </i></font>spk_on<font color="#000080">;
   </font>Writeln<font color="#000080">(</font><font color="#800000">'Playing...'</font><font color="#000080">);
   </font><font color="#FF0000"><b>For </b></font>index <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>fsize <font color="#FF0000"><b>do
      </b></font>Write_dsp<font color="#000080">(</font>mem<font color="#000080">[</font>seg<font color="#000080">(</font>buf<font color="#000080">^):</font>ofs<font color="#000080">(</font>buf<font color="#000080">^)+</font>index<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">]);
   </font>spk_off<font color="#000080">;
   </font>unload<font color="#000080">(</font>buf<font color="#000080">,</font>fsize<font color="#000080">);
   </font>Writeln<font color="#000080">(</font><font color="#800000">'Done.'</font><font color="#000080">);
   </font>ch <font color="#000080">:= </font>ReadKey<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">.

</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to SOUND SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0007.PAS">Original</a><b>]</b></p></body>
</html>
