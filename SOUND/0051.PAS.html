<html>
<head><title> "SoundBlaster version..." by GREG VIGNEAULT</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to SOUND SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0051.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
 Someone in an Assembly conference posted a routine to determine the
 version of a Sound Blaster card. I've adapted it for use in TP ...
}

</i></font><font color="#FF0000"><b>PROGRAM </b></font>sb<font color="#000080">;               </font><font color="#008000"><i>{ Determine Sound Blaster version.  TP5+  }
                          { Jul.13.94 Greg Vigneault                }
</i></font><font color="#FF0000"><b>USES  </b></font>Dos<font color="#000080">,                </font><font color="#008000"><i>{ import GetEnv                           }
      </i></font>Crt<font color="#000080">;                </font><font color="#008000"><i>{ import Delay                            }
</i></font><font color="#FF0000"><b>VAR </b></font>Major<font color="#000080">, </font>Minor <font color="#000080">: </font>BYTE<font color="#000080">;  </font><font color="#008000"><i>{ version has major &amp; minor parts         }

(*-----------------------------------------------------------------*)
{ this procedure returns 0.0 if any error condition...              }
</i></font><font color="#FF0000"><b>PROCEDURE </b></font>SBver <font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>Maj<font color="#000080">, </font>Min <font color="#000080">: </font>BYTE<font color="#000080">);
  </font><font color="#FF0000"><b>VAR </b></font>bev <font color="#000080">: </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">[</font><font color="#800000">32</font><font color="#000080">];                       </font><font color="#008000"><i>{ environment string  }
      </i></font>j<font color="#000080">,</font>k <font color="#000080">: </font>WORD<font color="#000080">;                             </font><font color="#008000"><i>{ scratch variables   }
  </i></font><font color="#FF0000"><b>BEGIN
    </b></font>Maj <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;  </font>Min <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;                      </font><font color="#008000"><i>{ initialize          }
    </i></font>bev <font color="#000080">:= </font>GetEnv<font color="#000080">(</font><font color="#800000">'BLASTER'</font><font color="#000080">);                 </font><font color="#008000"><i>{ look in environment }
    </i></font><font color="#FF0000"><b>IF </b></font>bev<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">] = </font><font color="#800000">#0 </font><font color="#FF0000"><b>THEN </b></font>EXIT<font color="#000080">;                 </font><font color="#008000"><i>{ no sign of Blaster  }
    </i></font>j <font color="#000080">:= </font>Pos<font color="#000080">(</font><font color="#800000">'A'</font><font color="#000080">,</font>bev<font color="#000080">);                        </font><font color="#008000"><i>{ search for i/o port }
    </i></font><font color="#FF0000"><b>IF </b></font>j <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>THEN </b></font>EXIT <font color="#FF0000"><b>ELSE </b></font>INC<font color="#000080">(</font>j<font color="#000080">);           </font><font color="#008000"><i>{ none?               }
    </i></font>Val<font color="#000080">( </font><font color="#800000">'$'</font><font color="#000080">+</font>Copy<font color="#000080">(</font>bev<font color="#000080">,</font>j<font color="#000080">,</font><font color="#800000">3</font><font color="#000080">), </font>j<font color="#000080">, </font>k <font color="#000080">);           </font><font color="#008000"><i>{ base port number    }
    </i></font><font color="#FF0000"><b>IF </b></font>k <font color="#000080">&lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>THEN </b></font>EXIT<font color="#000080">;                      </font><font color="#008000"><i>{ if bad port value   }
    </i></font>INC<font color="#000080">(</font>j<font color="#000080">,</font><font color="#800000">$C</font><font color="#000080">);                                </font><font color="#008000"><i>{ command port        }
    </i></font>Port<font color="#000080">[</font>j<font color="#000080">] := </font><font color="#800000">$E1</font><font color="#000080">;                           </font><font color="#008000"><i>{ command             }
    </i></font>DEC<font color="#000080">(</font>j<font color="#000080">,</font><font color="#800000">2</font><font color="#000080">);                                 </font><font color="#008000"><i>{ input port          }
    </i></font>Delay<font color="#000080">(</font><font color="#800000">20</font><font color="#000080">);                                </font><font color="#008000"><i>{ wait for response   }
    </i></font>Maj <font color="#000080">:= </font>Port<font color="#000080">[</font>j<font color="#000080">];                           </font><font color="#008000"><i>{ version major part  }
    </i></font>Delay<font color="#000080">(</font><font color="#800000">20</font><font color="#000080">);                                </font><font color="#008000"><i>{ wait for response   }
    </i></font>Min <font color="#000080">:= </font>Port<font color="#000080">[</font>j<font color="#000080">];                           </font><font color="#008000"><i>{ version minor part  }
  </i></font><font color="#FF0000"><b>END </b></font><font color="#008000"><i>{SBver}</i></font><font color="#000080">;

</font><font color="#FF0000"><b>BEGIN

  </b></font>SBver <font color="#000080">(</font>Major<font color="#000080">, </font>Minor<font color="#000080">);
  </font>WriteLn<font color="#000080">;
  </font>WriteLn <font color="#000080">(</font><font color="#800000">'Sound Blaster version: '</font><font color="#000080">,</font>Major<font color="#000080">,</font><font color="#800000">'.'</font><font color="#000080">,</font>Minor<font color="#000080">);
  </font>WriteLn<font color="#000080">;

</font><font color="#FF0000"><b>END</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to SOUND SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0051.PAS">Original</a><b>]</b></p></body>
</html>
