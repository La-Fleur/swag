<html>
<head><title> "Controling the PC Speaker" by SEAN PALMER</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to SOUND SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0027.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
SEAN PALMER

&gt;I have TP 6.0, and I'am looking For a way to address my PC Speaker.  I don't
&gt;know what Port it is (like PORT[$30] or something), or how to send raw Sound
&gt;data to it. Could someone help me?

Try this, or actually a Variation on it. Doing VOC's and WAV's on a pc
speaker is not an easy task...

What you're looking For is embedded in the 'click' Procedure below...

'click' only works While no tone is being produced. click at different
rates to get different pitches/effects.

so I guess the simple answer to your question is that it's controlled by
bit 1 (from 0 to 7) of port $61.
}

</i></font><font color="#FF0000"><b>Unit </b></font>uTone<font color="#000080">;
</font><font color="#FF0000"><b>Interface

Procedure </b></font>tone<font color="#000080">(</font>freq <font color="#000080">: </font>Word<font color="#000080">);
</font><font color="#FF0000"><b>Procedure </b></font>noTone<font color="#000080">;
</font><font color="#FF0000"><b>Procedure </b></font>click<font color="#000080">;

</font><font color="#FF0000"><b>Implementation

Const
  </b></font>sCntrl   <font color="#000080">= </font><font color="#800000">$61</font><font color="#000080">; </font><font color="#008000"><i>{ Sound control port }
  </i></font>SoundOn  <font color="#000080">= </font><font color="#800000">$03</font><font color="#000080">; </font><font color="#008000"><i>{ bit mask to enable speaker }
  </i></font>SoundOff <font color="#000080">= </font><font color="#800000">$FC</font><font color="#000080">; </font><font color="#008000"><i>{ bit mask to disable speaker }
  </i></font>C8253    <font color="#000080">= </font><font color="#800000">$43</font><font color="#000080">; </font><font color="#008000"><i>{ port address to control 8253 }
  </i></font>seTimer  <font color="#000080">= </font><font color="#800000">$B6</font><font color="#000080">; </font><font color="#008000"><i>{ tell 8253 to expect freq data next }
  </i></font>F8253    <font color="#000080">= </font><font color="#800000">$42</font><font color="#000080">; </font><font color="#008000"><i>{ frequency address on 8253 }

</i></font><font color="#FF0000"><b>Procedure </b></font>tone<font color="#000080">(</font>freq <font color="#000080">: </font>Word<font color="#000080">); </font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Asm
  </b></font><font color="#FF00FF">mov al, $B6
  out $43, al  </font><font color="#008000"><i>{Write timer mode register}
  </i></font><font color="#FF00FF">mov dx, $14
  mov ax, $4F38
  div freq     </font><font color="#008000"><i>{1331000/Frequency pulse}
  </i></font><font color="#FF00FF">out $42, al
  mov al, ah
  out $42, al  </font><font color="#008000"><i>{Write timer a Byte at a time}
  </i></font><font color="#FF00FF">in  al, $61
  or  al, 3
  out $61, al  </font><font color="#008000"><i>{port B-switch speaker on}
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>noTone<font color="#000080">; </font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Asm
  </b></font><font color="#FF00FF">in  al, $61
  and al, $FC
  out $61, al
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>click<font color="#000080">; </font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Asm
  </b></font><font color="#FF00FF">in  al, $61
  xor al, 2
  out $61, al
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>end</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to SOUND SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0027.PAS">Original</a><b>]</b></p></body>
</html>
