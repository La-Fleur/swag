<html>
<head><title> "Play VOC files on SB" by SWAG SUPPORT TEAM</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to SOUND SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0022.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#FF0000"><b>UNIT </b></font>VOCTOOL<font color="#000080">;
</font><font color="#008000"><i>{* Unit - uses CT-VOICE.DRV. *}
</i></font><font color="#FF0000"><b>INTERFACE
TYPE
   </b></font>VOCFileTyp <font color="#000080">= </font><font color="#FF0000"><b>File</b></font><font color="#000080">;
</font><font color="#FF0000"><b>CONST
   </b></font>VOCToolVersion  <font color="#000080">= </font><font color="#800000">'v1.5'</font><font color="#000080">;
   </font>VOCBreakEnd     <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">;
   </font>VOCBreakNow     <font color="#000080">= </font><font color="#800000">1</font><font color="#000080">;
</font><font color="#FF0000"><b>VAR
   </b></font>VOCStatusWord        <font color="#000080">: </font>WORD<font color="#000080">;
   </font>VOCErrStat           <font color="#000080">: </font>WORD<font color="#000080">;
   </font>VOCFileHeader        <font color="#000080">: </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">;
   </font>VOCFileHeaderLength  <font color="#000080">: </font>BYTE<font color="#000080">;
   </font>VOCPaused            <font color="#000080">: </font>BOOLEAN<font color="#000080">;
   </font>VOCDriverInstalled   <font color="#000080">: </font>BOOLEAN<font color="#000080">;
   </font>VOCDriverVersion     <font color="#000080">: </font>WORD<font color="#000080">;
   </font>VOCPtrToDriver       <font color="#000080">: </font>Pointer<font color="#000080">;
   </font>OldExitProc          <font color="#000080">: </font>Pointer<font color="#000080">;
</font><font color="#FF0000"><b>PROCEDURE </b></font>PrintVOCErrMessage<font color="#000080">;
</font><font color="#FF0000"><b>FUNCTION  </b></font>VOCGetBuffer<font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>VoiceBuff <font color="#000080">: </font>Pointer<font color="#000080">; </font>Voicefile <font color="#000080">: </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">):</font>BOOLEAN<font color="#000080">;
</font><font color="#FF0000"><b>FUNCTION  </b></font>VOCFreeBuffer<font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>VoiceBuff <font color="#000080">: </font>Pointer<font color="#000080">):</font>BOOLEAN<font color="#000080">;
</font><font color="#FF0000"><b>FUNCTION  </b></font>VOCGetVersion<font color="#000080">:</font>WORD<font color="#000080">;
</font><font color="#FF0000"><b>PROCEDURE </b></font>VOCSetPort<font color="#000080">(</font>PortNumber <font color="#000080">: </font>WORD<font color="#000080">);
</font><font color="#FF0000"><b>PROCEDURE </b></font>VOCSetIRQ<font color="#000080">(</font>IRQNumber <font color="#000080">: </font>WORD<font color="#000080">);
</font><font color="#FF0000"><b>FUNCTION  </b></font>VOCInitDriver<font color="#000080">:</font>BOOLEAN<font color="#000080">;
</font><font color="#FF0000"><b>PROCEDURE </b></font>VOCDeInstallDriver<font color="#000080">;
</font><font color="#FF0000"><b>PROCEDURE </b></font>VOCSetSpeaker<font color="#000080">(</font>OnOff<font color="#000080">:</font>BOOLEAN<font color="#000080">);
</font><font color="#FF0000"><b>PROCEDURE </b></font>VOCOutput<font color="#000080">(</font>BufferAddress <font color="#000080">: </font>Pointer<font color="#000080">);
</font><font color="#FF0000"><b>PROCEDURE </b></font>VOCOutputLoop <font color="#000080">(</font>BufferAddress <font color="#000080">: </font>Pointer<font color="#000080">);
</font><font color="#FF0000"><b>PROCEDURE </b></font>VOCStop<font color="#000080">;
</font><font color="#FF0000"><b>PROCEDURE </b></font>VOCPause<font color="#000080">;
</font><font color="#FF0000"><b>PROCEDURE </b></font>VOCContinue<font color="#000080">;
</font><font color="#FF0000"><b>PROCEDURE </b></font>VOCBreakLoop<font color="#000080">(</font>BreakMode <font color="#000080">: </font>WORD<font color="#000080">);
</font><font color="#FF0000"><b>IMPLEMENTATION
USES </b></font>DOS<font color="#000080">,</font>Crt<font color="#000080">;
</font><font color="#FF0000"><b>TYPE
   </b></font>TypeCastType <font color="#000080">= </font><font color="#FF0000"><b>ARRAY </b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">6000</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Char<font color="#000080">;
</font><font color="#FF0000"><b>VAR
   </b></font>Regs <font color="#000080">: </font>Registers<font color="#000080">;
</font><font color="#FF0000"><b>PROCEDURE </b></font>PrintVOCErrMessage<font color="#000080">;
</font><font color="#008000"><i>{* INPUT   : None
 * OUTPUT  : None
 * PURPOSE : Displays SB error as text; no change to error status. }
</i></font><font color="#FF0000"><b>BEGIN
   CASE </b></font>VOCErrStat <font color="#FF0000"><b>OF
      </b></font><font color="#800000">100 </font><font color="#000080">: </font>Write<font color="#000080">(</font><font color="#800000">' Driver file CT-VOICE.DRV not found '</font><font color="#000080">);
      </font><font color="#800000">110 </font><font color="#000080">: </font>Write<font color="#000080">(</font><font color="#800000">' No memory available for driver file '</font><font color="#000080">);
      </font><font color="#800000">120 </font><font color="#000080">: </font>Write<font color="#000080">(</font><font color="#800000">' False driver file '</font><font color="#000080">);
      </font><font color="#800000">200 </font><font color="#000080">: </font>Write<font color="#000080">(</font><font color="#800000">' VOC file not found '</font><font color="#000080">);
      </font><font color="#800000">210 </font><font color="#000080">: </font>Write<font color="#000080">(</font><font color="#800000">' No memory available for driver file '</font><font color="#000080">);
      </font><font color="#800000">220 </font><font color="#000080">: </font>Write<font color="#000080">(</font><font color="#800000">' File not in VOC format '</font><font color="#000080">);
      </font><font color="#800000">300 </font><font color="#000080">: </font>Write<font color="#000080">(</font><font color="#800000">' Memory allocation error occurred '</font><font color="#000080">);
      </font><font color="#800000">400 </font><font color="#000080">: </font>Write<font color="#000080">(</font><font color="#800000">' No sound blaster card found '</font><font color="#000080">);
      </font><font color="#800000">410 </font><font color="#000080">: </font>Write<font color="#000080">(</font><font color="#800000">' False port address used '</font><font color="#000080">);
      </font><font color="#800000">420 </font><font color="#000080">: </font>Write<font color="#000080">(</font><font color="#800000">' False interrupt used '</font><font color="#000080">);
      </font><font color="#800000">500 </font><font color="#000080">: </font>Write<font color="#000080">(</font><font color="#800000">' No loop in process '</font><font color="#000080">);
      </font><font color="#800000">510 </font><font color="#000080">: </font>Write<font color="#000080">(</font><font color="#800000">' No sample for output '</font><font color="#000080">);
      </font><font color="#800000">520 </font><font color="#000080">: </font>Write<font color="#000080">(</font><font color="#800000">' No sample available '</font><font color="#000080">);
      </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
   </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>FUNCTION </b></font>Exists <font color="#000080">(</font>Filename <font color="#000080">: </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">):</font>BOOLEAN<font color="#000080">;
</font><font color="#008000"><i>{* INPUT   : Filename as string
 * OUTPUT  : TRUE if file is available, FALSE if not
 * PURPOSE : Checks for availability of file then returns Boolean exp. }
</i></font><font color="#FF0000"><b>VAR
   </b></font>F <font color="#000080">: </font><font color="#FF0000"><b>File</b></font><font color="#000080">;
</font><font color="#FF0000"><b>BEGIN
   </b></font>Assign<font color="#000080">(</font>F<font color="#000080">,</font>Filename<font color="#000080">);
</font><font color="#008000"><i>{$I-}
   </i></font>Reset<font color="#000080">(</font>F<font color="#000080">);
   </font>Close<font color="#000080">(</font>F<font color="#000080">);
</font><font color="#008000"><i>{$I+}
   </i></font>Exists <font color="#000080">:= (</font>IoResult <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>AND </b></font><font color="#000080">(</font>Filename <font color="#000080">&lt;&gt; </font><font color="#800000">''</font><font color="#000080">);
   </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
</font><font color="#FF0000"><b>PROCEDURE </b></font>AllocateMem <font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>Pt <font color="#000080">: </font>Pointer<font color="#000080">; </font>Size <font color="#000080">: </font>LongInt<font color="#000080">);
</font><font color="#008000"><i>{* INPUT   : Buffer variable as pointer, buffer size as LongInt
 * OUTPUT  : Pointer to buffer in variable or NIL
 * PURPOSE : Reserves as many bytes as Size allows, then moves pointer in
             the Pt variable. If not enough memory is available, Pt = NIL. }
</i></font><font color="#FF0000"><b>VAR
   </b></font>SizeIntern <font color="#000080">: </font>WORD<font color="#000080">;
</font><font color="#FF0000"><b>BEGIN
   </b></font>Inc<font color="#000080">(</font>Size<font color="#000080">,</font><font color="#800000">15</font><font color="#000080">);
   </font>SizeIntern <font color="#000080">:= (</font>Size <font color="#FF0000"><b>shr </b></font><font color="#800000">4</font><font color="#000080">);
   </font>Regs<font color="#000080">.</font>AH <font color="#000080">:= </font><font color="#800000">$48</font><font color="#000080">;
   </font>Regs<font color="#000080">.</font>BX <font color="#000080">:= </font>SizeIntern<font color="#000080">;
   </font>MsDos<font color="#000080">(</font>Regs<font color="#000080">);
   </font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>Regs<font color="#000080">.</font>BX <font color="#000080">&lt;&gt; </font>SizeIntern<font color="#000080">) </font><font color="#FF0000"><b>THEN </b></font>Pt <font color="#000080">:= </font><font color="#FF0000"><b>NIL
   ELSE </b></font>Pt <font color="#000080">:= </font>Ptr<font color="#000080">(</font>Regs<font color="#000080">.</font>AX<font color="#000080">,</font><font color="#800000">0</font><font color="#000080">);
   </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
</font><font color="#FF0000"><b>FUNCTION  </b></font>CheckFreeMem <font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>VoiceBuff <font color="#000080">: </font>Pointer<font color="#000080">; </font>VoiceSize <font color="#000080">: </font>LongInt<font color="#000080">):</font>BOOLEAN<font color="#000080">;
</font><font color="#008000"><i>{* INPUT   : Buffer variable as pointer, size as LongInt
 * OUTPUT  : Pointer to buffer, TRUE/FALSE, after AllocateMem
 * PURPOSE : Checks for sufficient memory to store a VOC file. }
</i></font><font color="#FF0000"><b>BEGIN
   </b></font>AllocateMem<font color="#000080">(</font>VoiceBuff<font color="#000080">,</font>VoiceSize<font color="#000080">);
   </font>CheckFreeMem <font color="#000080">:= </font>VoiceBuff <font color="#000080">&lt;&gt; </font><font color="#FF0000"><b>NIL</b></font><font color="#000080">;
   </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
</font><font color="#FF0000"><b>FUNCTION  </b></font>VOCGetBuffer <font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>VoiceBuff <font color="#000080">: </font>Pointer<font color="#000080">; </font>Voicefile <font color="#000080">: </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">):</font>BOOLEAN<font color="#000080">;
</font><font color="#008000"><i>{* INPUT   : Buffer variable as pointer, file name as string
 * OUTPUT  : Pointer to buffer with VOC data, TRUE/FALSE
 * PURPOSE : Loads a file into memory and returns TRUE if file loaded
             successfully, and FALSE if not. }
</i></font><font color="#FF0000"><b>VAR
   </b></font>SampleSize <font color="#000080">: </font>LongInt<font color="#000080">;
   </font>FPresent   <font color="#000080">: </font>BOOLEAN<font color="#000080">;
   </font>VFile      <font color="#000080">: </font>VOCFileTyp<font color="#000080">;
   </font>Segs       <font color="#000080">: </font>WORD<font color="#000080">;
   </font>Read       <font color="#000080">: </font>WORD<font color="#000080">;
</font><font color="#FF0000"><b>BEGIN
   </b></font>FPresent <font color="#000080">:= </font>Exists<font color="#000080">(</font>VoiceFile<font color="#000080">);
</font><font color="#008000"><i>{ VOC file not found }
   </i></font><font color="#FF0000"><b>IF Not</b></font><font color="#000080">(</font>FPresent<font color="#000080">) </font><font color="#FF0000"><b>THEN BEGIN
      </b></font>VOCGetBuffer <font color="#000080">:= </font>FALSE<font color="#000080">;
      </font>VOCErrStat   <font color="#000080">:= </font><font color="#800000">200</font><font color="#000080">;
      </font>EXIT
      <font color="#FF0000"><b>END</b></font><font color="#000080">;
   </font>Assign<font color="#000080">(</font>VFile<font color="#000080">,</font>Voicefile<font color="#000080">);
   </font>Reset<font color="#000080">(</font>VFile<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">);
   </font>SampleSize <font color="#000080">:= </font>Filesize<font color="#000080">(</font>VFile<font color="#000080">);
   </font>AllocateMem<font color="#000080">(</font>VoiceBuff<font color="#000080">,</font>SampleSize<font color="#000080">);
</font><font color="#008000"><i>{ Insufficient memory for the VOC file }
   </i></font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>VoiceBuff <font color="#000080">= </font><font color="#FF0000"><b>NIL</b></font><font color="#000080">) </font><font color="#FF0000"><b>THEN BEGIN
      </b></font>Close<font color="#000080">(</font>VFile<font color="#000080">);
      </font>VOCGetBuffer <font color="#000080">:= </font>FALSE<font color="#000080">;
      </font>VOCErrStat   <font color="#000080">:= </font><font color="#800000">210</font><font color="#000080">;
      </font>EXIT<font color="#000080">;
      </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
   </font>Segs <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
   </font><font color="#FF0000"><b>REPEAT
      </b></font>Blockread<font color="#000080">(</font>VFile<font color="#000080">,</font>Ptr<font color="#000080">(</font>seg<font color="#000080">(</font>VoiceBuff<font color="#000080">^)+</font><font color="#800000">4096</font><font color="#000080">*</font>Segs<font color="#000080">,</font>Ofs<font color="#000080">(</font>VoiceBuff<font color="#000080">^))^,</font><font color="#800000">$FFFF</font><font color="#000080">,</font>Read
<font color="#000080">);
      </font>Inc<font color="#000080">(</font>Segs<font color="#000080">);
      </font><font color="#FF0000"><b>UNTIL </b></font>Read <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">;
   </font>Close<font color="#000080">(</font>VFile<font color="#000080">);
</font><font color="#008000"><i>{ File not in VOC format }
   </i></font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>TypeCastType<font color="#000080">(</font>VoiceBuff<font color="#000080">^)[</font><font color="#800000">0</font><font color="#000080">]&lt;&gt;</font><font color="#800000">'C'</font><font color="#000080">) </font><font color="#FF0000"><b>OR
      </b></font><font color="#000080">(</font>TypeCastType<font color="#000080">(</font>VoiceBuff<font color="#000080">^)[</font><font color="#800000">1</font><font color="#000080">]&lt;&gt;</font><font color="#800000">'r'</font><font color="#000080">) </font><font color="#FF0000"><b>THEN BEGIN
      </b></font>VOCGetBuffer <font color="#000080">:= </font>FALSE<font color="#000080">;
      </font>VOCErrStat <font color="#000080">:= </font><font color="#800000">220</font><font color="#000080">;
      </font>EXIT<font color="#000080">;
      </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
</font><font color="#008000"><i>{ Load successful }
   </i></font>VOCGetBuffer <font color="#000080">:= </font>TRUE<font color="#000080">;
   </font>VOCErrStat   <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
</font><font color="#008000"><i>{ Read header length from file }
   </i></font>VOCFileHeaderLength <font color="#000080">:= </font>Ord<font color="#000080">(</font>TypeCastType<font color="#000080">(</font>VoiceBuff<font color="#000080">^)[</font><font color="#800000">20</font><font color="#000080">]);
   </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
</font><font color="#FF0000"><b>FUNCTION </b></font>VOCFreeBuffer <font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>VoiceBuff <font color="#000080">: </font>Pointer<font color="#000080">):</font>BOOLEAN<font color="#000080">;
</font><font color="#008000"><i>{* INPUT   : Buffer pointer
 * OUTPUT  : None
 * PURPOSE : Frees memory allocated for VOC data. }
</i></font><font color="#FF0000"><b>BEGIN
   </b></font>Regs<font color="#000080">.</font>AH <font color="#000080">:= </font><font color="#800000">$49</font><font color="#000080">;
   </font>Regs<font color="#000080">.</font>ES <font color="#000080">:= </font>seg<font color="#000080">(</font>VoiceBuff<font color="#000080">^);
   </font>MsDos<font color="#000080">(</font>Regs<font color="#000080">);
   </font>VOCFreeBuffer <font color="#000080">:= </font>TRUE<font color="#000080">;
   </font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>Regs<font color="#000080">.</font>AX <font color="#000080">= </font><font color="#800000">7</font><font color="#000080">) </font><font color="#FF0000"><b>OR </b></font><font color="#000080">(</font>Regs<font color="#000080">.</font>AX <font color="#000080">= </font><font color="#800000">9</font><font color="#000080">) </font><font color="#FF0000"><b>THEN BEGIN
      </b></font>VOCFreeBuffer <font color="#000080">:= </font>FALSE<font color="#000080">;
      </font>VOCErrStat <font color="#000080">:= </font><font color="#800000">300
      </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
   </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
</font><font color="#FF0000"><b>FUNCTION </b></font>VOCGetVersion<font color="#000080">:</font>WORD<font color="#000080">;
</font><font color="#008000"><i>{* INPUT   : None
 * OUTPUT  : Driver version number
 * PURPOSE : Returns driver version number. }
</i></font><font color="#FF0000"><b>VAR
   </b></font>VDummy <font color="#000080">: </font>WORD<font color="#000080">;
</font><font color="#FF0000"><b>BEGIN
   ASM
      </b></font><font color="#FF00FF">MOV       BX,0
      CALL      VOCPtrToDriver
      MOV       VDummy, AX
      </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
   </font>VOCGetVersion <font color="#000080">:= </font>VDummy<font color="#000080">;
   </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>PROCEDURE </b></font>VOCSetPort<font color="#000080">(</font>PortNumber <font color="#000080">: </font>WORD<font color="#000080">);
</font><font color="#008000"><i>{* INPUT   : Port address number
 * OUTPUT  : None
 * PURPOSE : Specifies port address before initialization. }
</i></font><font color="#FF0000"><b>BEGIN
   ASM
      </b></font><font color="#FF00FF">MOV    BX,1
      MOV    AX,PortNumber
      CALL   VOCPtrToDriver
      </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
   </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
</font><font color="#FF0000"><b>PROCEDURE </b></font>VOCSetIRQ<font color="#000080">(</font>IRQNumber <font color="#000080">: </font>WORD<font color="#000080">);
</font><font color="#008000"><i>{* INPUT   : Interrupt number
 * OUTPUT  : None
 * PURPOSE : Specifies interrupt number before initialization.}
</i></font><font color="#FF0000"><b>BEGIN
   ASM
      </b></font><font color="#FF00FF">MOV    BX,2
      MOV    AX,IRQNumber
      CALL   VOCPtrToDriver
      </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
   </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
</font><font color="#FF0000"><b>FUNCTION  </b></font>VOCInitDriver<font color="#000080">: </font>BOOLEAN<font color="#000080">;
</font><font color="#008000"><i>{* INPUT   : None
 * OUTPUT  : Error message number, and initialization result
 * PURPOSE : Initializes driver software. }
</i></font><font color="#FF0000"><b>VAR
   Out</b></font><font color="#000080">, </font>VSeg<font color="#000080">, </font>VOfs <font color="#000080">: </font>WORD<font color="#000080">;
   </font>F   <font color="#000080">: </font><font color="#FF0000"><b>File</b></font><font color="#000080">;
   </font>Drivername<font color="#000080">,
   </font>Pdir        <font color="#000080">: </font>DirStr<font color="#000080">;
   </font>Pnam        <font color="#000080">: </font>NameStr<font color="#000080">;
   </font>Pext        <font color="#000080">: </font>ExtStr<font color="#000080">;
</font><font color="#FF0000"><b>BEGIN
</b></font><font color="#008000"><i>{ Search path for CT-VOICE.DRV driver }
   </i></font>Pdir <font color="#000080">:= </font>ParamStr<font color="#000080">(</font><font color="#800000">0</font><font color="#000080">);
   </font>Fsplit<font color="#000080">(</font>ParamStr<font color="#000080">(</font><font color="#800000">0</font><font color="#000080">),</font>Pdir<font color="#000080">,</font>Pnam<font color="#000080">,</font>Pext<font color="#000080">);
   </font>Drivername <font color="#000080">:= </font>Pdir<font color="#000080">+</font><font color="#800000">'CT-VOICE.DRV'</font><font color="#000080">;
   </font>VOCInitDriver <font color="#000080">:= </font>TRUE<font color="#000080">;
</font><font color="#008000"><i>{ Driver file not found }
   </i></font><font color="#FF0000"><b>IF Not </b></font>Exists<font color="#000080">(</font>Drivername<font color="#000080">) </font><font color="#FF0000"><b>THEN BEGIN
      </b></font>VOCInitDriver <font color="#000080">:= </font>FALSE<font color="#000080">;
      </font>VOCErrStat    <font color="#000080">:= </font><font color="#800000">100</font><font color="#000080">;
      </font>EXIT<font color="#000080">;
      </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
</font><font color="#008000"><i>{ Load driver }
   </i></font>Assign<font color="#000080">(</font>F<font color="#000080">,</font>Drivername<font color="#000080">);
   </font>Reset<font color="#000080">(</font>F<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">);
   </font>AllocateMem<font color="#000080">(</font>VOCPtrToDriver<font color="#000080">,</font>Filesize<font color="#000080">(</font>F<font color="#000080">));
</font><font color="#008000"><i>{ No memory can be allocated for the driver }
   </i></font><font color="#FF0000"><b>IF </b></font>VOCPtrToDriver <font color="#000080">= </font><font color="#FF0000"><b>NIL THEN BEGIN
      </b></font>VOCInitDriver <font color="#000080">:= </font>FALSE<font color="#000080">;
      </font>VOCErrStat    <font color="#000080">:= </font><font color="#800000">110</font><font color="#000080">;
      </font>EXIT<font color="#000080">;
      </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
   </font>Blockread<font color="#000080">(</font>F<font color="#000080">,</font>VOCPtrToDriver<font color="#000080">^,</font>Filesize<font color="#000080">(</font>F<font color="#000080">));
   </font>Close<font color="#000080">(</font>F<font color="#000080">);
</font><font color="#008000"><i>{ Driver file doesn't begin with &quot;CT&quot; - false driver }
   </i></font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>TypeCastType<font color="#000080">(</font>VOCPtrToDriver<font color="#000080">^)[</font><font color="#800000">3</font><font color="#000080">]&lt;&gt;</font><font color="#800000">'C'</font><font color="#000080">) </font><font color="#FF0000"><b>OR
      </b></font><font color="#000080">(</font>TypeCastType<font color="#000080">(</font>VOCPtrToDriver<font color="#000080">^)[</font><font color="#800000">4</font><font color="#000080">]&lt;&gt;</font><font color="#800000">'T'</font><font color="#000080">) </font><font color="#FF0000"><b>THEN BEGIN
         </b></font>VOCInitDriver <font color="#000080">:= </font>FALSE<font color="#000080">;
         </font>VOCErrStat    <font color="#000080">:= </font><font color="#800000">120</font><font color="#000080">;
         </font>EXIT<font color="#000080">;
         </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
</font><font color="#008000"><i>{ Get version number and pass to global variable }
   </i></font>VOCDriverVersion <font color="#000080">:= </font>VOCGetVersion<font color="#000080">;
</font><font color="#008000"><i>{ Start driver }
   </i></font>Vseg <font color="#000080">:= </font>Seg<font color="#000080">(</font>VOCStatusWord<font color="#000080">);
   </font>VOfs <font color="#000080">:= </font>Ofs<font color="#000080">(</font>VOCStatusWord<font color="#000080">);
   </font><font color="#FF0000"><b>ASM
      </b></font><font color="#FF00FF">MOV       BX,3
      CALL      VOCPtrToDriver
      MOV       Out,AX
      MOV       BX,5
      MOV       ES,VSeg
      MOV       DI,VOfs
      CALL      VOCPtrToDriver
      </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
</font><font color="#008000"><i>{ No Sound Blaster card found }
   </i></font><font color="#FF0000"><b>IF Out </b></font><font color="#000080">= </font><font color="#800000">1 </font><font color="#FF0000"><b>THEN BEGIN
      </b></font>VOCInitDriver <font color="#000080">:= </font>FALSE<font color="#000080">;
      </font>VOCErrStat    <font color="#000080">:= </font><font color="#800000">400</font><font color="#000080">;
      </font>EXIT<font color="#000080">;
      </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
</font><font color="#008000"><i>{ False port address used }
   </i></font><font color="#FF0000"><b>IF Out </b></font><font color="#000080">= </font><font color="#800000">2 </font><font color="#FF0000"><b>THEN BEGIN
      </b></font>VOCInitDriver <font color="#000080">:= </font>FALSE<font color="#000080">;
      </font>VOCErrStat    <font color="#000080">:= </font><font color="#800000">410</font><font color="#000080">;
      </font>EXIT<font color="#000080">;
      </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
</font><font color="#008000"><i>{ False interrupt used }
   </i></font><font color="#FF0000"><b>IF Out </b></font><font color="#000080">= </font><font color="#800000">3 </font><font color="#FF0000"><b>THEN BEGIN
      </b></font>VOCInitDriver <font color="#000080">:= </font>FALSE<font color="#000080">;
      </font>VOCErrStat    <font color="#000080">:= </font><font color="#800000">420</font><font color="#000080">;
      </font>EXIT<font color="#000080">;
      </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
   </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
</font><font color="#FF0000"><b>PROCEDURE </b></font>VOCDeInstallDriver<font color="#000080">;
</font><font color="#008000"><i>{* INPUT   : None
 * OUTPUT  : None
 * PURPOSE : Disables driver and releases memory. }
</i></font><font color="#FF0000"><b>VAR
   </b></font>Check <font color="#000080">: </font>BOOLEAN<font color="#000080">;
</font><font color="#FF0000"><b>BEGIN
   IF </b></font>VOCDriverInstalled <font color="#FF0000"><b>THEN
   ASM
      </b></font><font color="#FF00FF">MOV       BX,9
      CALL      VOCPtrToDriver
      </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
   </font>Check <font color="#000080">:= </font>VOCFreeBuffer<font color="#000080">(</font>VOCPtrToDriver<font color="#000080">);
   </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
</font><font color="#FF0000"><b>PROCEDURE </b></font>VOCSetSpeaker<font color="#000080">(</font>OnOff<font color="#000080">:</font>BOOLEAN<font color="#000080">);
</font><font color="#008000"><i>{* INPUT   : TRUE=Speaker on, FALSE=Speaker off
 * OUTPUT  : None
 * PURPOSE : Sound Blaster output status. }
</i></font><font color="#FF0000"><b>VAR
   </b></font>Switch <font color="#000080">: </font>BYTE<font color="#000080">;
</font><font color="#FF0000"><b>BEGIN
   </b></font>Switch <font color="#000080">:= </font>Ord<font color="#000080">(</font>OnOff<font color="#000080">) </font><font color="#FF0000"><b>AND </b></font><font color="#800000">$01</font><font color="#000080">;
   </font><font color="#FF0000"><b>ASM
      </b></font><font color="#FF00FF">MOV       BX,4
      MOV       AL,Switch
      CALL      VOCPtrToDriver
      </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
   </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
</font><font color="#FF0000"><b>PROCEDURE </b></font>VOCOutput <font color="#000080">(</font>BufferAddress <font color="#000080">: </font>Pointer<font color="#000080">);
</font><font color="#008000"><i>{* INPUT   : Pointer to sample data
 * OUTPUT  : None
 * PURPOSE : Plays sample. }
</i></font><font color="#FF0000"><b>VAR
   </b></font>VSeg<font color="#000080">, </font>VOfs <font color="#000080">: </font>WORD<font color="#000080">;
</font><font color="#FF0000"><b>BEGIN
   </b></font>VOCSetSpeaker<font color="#000080">(</font>TRUE<font color="#000080">);
   </font>VSeg <font color="#000080">:= </font>Seg<font color="#000080">(</font>BufferAddress<font color="#000080">^);
   </font>VOfs <font color="#000080">:= </font>Ofs<font color="#000080">(</font>BufferAddress<font color="#000080">^)+</font>VOCFileHeaderLength<font color="#000080">;
   </font><font color="#FF0000"><b>ASM
      </b></font><font color="#FF00FF">MOV       BX,6
      MOV       ES,VSeg
      MOV       DI,VOfs
      CALL      VOCPtrToDriver
      </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
   </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
</font><font color="#FF0000"><b>PROCEDURE </b></font>VOCOutputLoop <font color="#000080">(</font>BufferAddress <font color="#000080">: </font>Pointer<font color="#000080">);
</font><font color="#008000"><i>{*    Different from VOCOutput :
 *    Speaker does not switch on with every sample output, so a
 *    crackling noise may occur with some Sound Blaster cards. }
</i></font><font color="#FF0000"><b>VAR
   </b></font>VSeg<font color="#000080">, </font>VOfs <font color="#000080">: </font>WORD<font color="#000080">;
</font><font color="#FF0000"><b>BEGIN
   </b></font>VSeg <font color="#000080">:= </font>Seg<font color="#000080">(</font>BufferAddress<font color="#000080">^);
   </font>VOfs <font color="#000080">:= </font>Ofs<font color="#000080">(</font>BufferAddress<font color="#000080">^)+</font>VOCFileHeaderLength<font color="#000080">;
   </font><font color="#FF0000"><b>ASM
      </b></font><font color="#FF00FF">MOV       BX,6
      MOV       ES,VSeg
      MOV       DI,VOfs
      CALL      VOCPtrToDriver
      </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
   </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
</font><font color="#FF0000"><b>PROCEDURE </b></font>VOCStop<font color="#000080">;
</font><font color="#008000"><i>{* INPUT   : None
 * OUTPUT  : None
 * PURPOSE : Stops a sample. }
</i></font><font color="#FF0000"><b>BEGIN
   ASM
      </b></font><font color="#FF00FF">MOV       BX,8
      CALL      VOCPtrToDriver
      </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
   </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
</font><font color="#FF0000"><b>PROCEDURE </b></font>VOCPause<font color="#000080">;
</font><font color="#008000"><i>{* INPUT   : None
 * OUTPUT  : None
 * PURPOSE : Pauses a sample. }
</i></font><font color="#FF0000"><b>VAR
   </b></font>Switch <font color="#000080">: </font>WORD<font color="#000080">;
</font><font color="#FF0000"><b>BEGIN
   </b></font>VOCPaused <font color="#000080">:= </font>TRUE<font color="#000080">;
   </font><font color="#FF0000"><b>ASM
      </b></font><font color="#FF00FF">MOV       BX,10
      CALL      VOCPtrToDriver
      MOV       Switch,AX
      </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
   </font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>Switch <font color="#000080">= </font><font color="#800000">1</font><font color="#000080">) </font><font color="#FF0000"><b>THEN BEGIN
      </b></font>VOCPaused <font color="#000080">:= </font>FALSE<font color="#000080">;
      </font>VOCErrStat <font color="#000080">:= </font><font color="#800000">510</font><font color="#000080">;
      </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
   </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
</font><font color="#FF0000"><b>PROCEDURE </b></font>VOCContinue<font color="#000080">;
</font><font color="#008000"><i>{* INPUT   : None
 * OUTPUT  : None
 * PURPOSE : Continues a paused sample. }
</i></font><font color="#FF0000"><b>VAR
   </b></font>Switch <font color="#000080">: </font>WORD<font color="#000080">;
</font><font color="#FF0000"><b>BEGIN
   ASM
      </b></font><font color="#FF00FF">MOV       BX,11
      CALL      VOCPtrToDriver
      MOV       Switch,AX
      </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
   </font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>Switch <font color="#000080">= </font><font color="#800000">1</font><font color="#000080">) </font><font color="#FF0000"><b>THEN BEGIN
      </b></font>VOCPaused <font color="#000080">:= </font>FALSE<font color="#000080">;
      </font>VOCErrStat <font color="#000080">:= </font><font color="#800000">520</font><font color="#000080">;
      </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
   </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
</font><font color="#FF0000"><b>PROCEDURE </b></font>VOCBreakLoop<font color="#000080">(</font>BreakMode <font color="#000080">: </font>WORD<font color="#000080">);
</font><font color="#008000"><i>{* INPUT   : Break mode
 * OUTPUT  : None
 * PURPOSE : Breaks a sample loop. }
</i></font><font color="#FF0000"><b>BEGIN
   ASM
      </b></font><font color="#FF00FF">MOV       BX,12
      MOV       AX,BreakMode
      CALL      VOCPtrToDriver
      MOV       BreakMode,AX
      </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
   </font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>BreakMode <font color="#000080">= </font><font color="#800000">1</font><font color="#000080">) </font><font color="#FF0000"><b>THEN </b></font>VOCErrStat <font color="#000080">:= </font><font color="#800000">500</font><font color="#000080">;
   </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
</font><font color="#008000"><i>{$F+}
</i></font><font color="#FF0000"><b>PROCEDURE </b></font>VoiceToolsExitProc<font color="#000080">;
</font><font color="#008000"><i>{$F-}
{* INPUT   : None
 * OUTPUT  : None
 * PURPOSE : De-installs voice driver. }
</i></font><font color="#FF0000"><b>BEGIN
   </b></font>VOCDeInstallDriver<font color="#000080">;
   </font>ExitProc <font color="#000080">:= </font>OldExitProc<font color="#000080">;
   </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
</font><font color="#FF0000"><b>BEGIN
</b></font><font color="#008000"><i>{* The following statements execute automatically, as soon as the
 * unit is linked to a program, and the program starts. }
{ Replaces old ExitProc with new one from Tool unit }
   </i></font>OldExitProc <font color="#000080">:= </font>ExitProc<font color="#000080">;
   </font>ExitProc <font color="#000080">:= @</font>VoiceToolsExitProc<font color="#000080">;
</font><font color="#008000"><i>{ Initialize values }
   </i></font>VOCStatusWord <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
   </font>VOCErrStat    <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
   </font>VOCPaused     <font color="#000080">:= </font>FALSE<font color="#000080">;
   </font>VOCFileHeaderLength <font color="#000080">:= </font><font color="#800000">$1A</font><font color="#000080">;
   </font>VOCFileHeader <font color="#000080">:=
      </font><font color="#800000">'Creative Voice File'</font><font color="#000080">+</font><font color="#800000">#$1A</font><font color="#000080">+</font><font color="#800000">#$1A</font><font color="#000080">+</font><font color="#800000">#$00</font><font color="#000080">+</font><font color="#800000">#$0A</font><font color="#000080">+</font><font color="#800000">#$01</font><font color="#000080">+</font><font color="#800000">#$29</font><font color="#000080">+</font><font color="#800000">#$11</font><font color="#000080">+</font><font color="#800000">#$01</font><font color="#000080">;
</font><font color="#008000"><i>{* After installation, VOCDriverInstalled contains either TRUE or FALSE. }
   </i></font>VOCDriverInstalled <font color="#000080">:= </font>VOCInitDriver<font color="#000080">;
   </font><font color="#FF0000"><b>END</b></font><font color="#000080">.


</font><font color="#008000"><i>{    -----------------------    DEMO PROGRAM  --------------------------}

</i></font><font color="#FF0000"><b>PROGRAM </b></font>VToolTest<font color="#000080">;
</font><font color="#008000"><i>{* VTTEST.PAS - uses VOCTOOL.TPU *}

{$M 16000,0,50000}
</i></font><font color="#FF0000"><b>USES </b></font>Crt<font color="#000080">,</font>Voctool<font color="#000080">;
</font><font color="#FF0000"><b>VAR
   </b></font>Sound <font color="#000080">: </font>Pointer<font color="#000080">;
   </font>Check <font color="#000080">: </font>BOOLEAN<font color="#000080">;
   </font>Ch    <font color="#000080">: </font>CHAR<font color="#000080">;
</font><font color="#FF0000"><b>PROCEDURE </b></font>TextNumError<font color="#000080">;
</font><font color="#008000"><i>{* INPUT   : None; data comes from the VOCErrStat global variable
 * OUTPUT  : None
 * PURPOSE : Displays SB error on the screen as text, including the
             error number. Program then ends at the error level
             corresponding to the error number. }
</i></font><font color="#FF0000"><b>BEGIN
   </b></font>Write<font color="#000080">(</font><font color="#800000">' Error #'</font><font color="#000080">,</font>VOCErrStat<font color="#000080">:</font><font color="#800000">3</font><font color="#000080">,</font><font color="#800000">' ='</font><font color="#000080">);
   </font>PrintVOCErrMessage<font color="#000080">;
   </font>WriteLn<font color="#000080">;
   </font>HALT<font color="#000080">(</font>VOCErrStat<font color="#000080">);
   </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>BEGIN
  </b></font>ClrScr<font color="#000080">;

</font><font color="#008000"><i>{ Driver not initialized }
  </i></font><font color="#FF0000"><b>IF Not</b></font><font color="#000080">(</font>VOCDriverInstalled<font color="#000080">) </font><font color="#FF0000"><b>THEN </b></font>TextNumError<font color="#000080">;
</font><font color="#008000"><i>{ Loads DEMO.VOC file into memory }
  </i></font>Check <font color="#000080">:= </font>VOCGetBuffer<font color="#000080">(</font>Sound<font color="#000080">,</font><font color="#800000">'\SBPRO\MMPLAY\SBP.VOC'</font><font color="#000080">);
</font><font color="#008000"><i>{ VOC file could not be loaded }
  </i></font><font color="#FF0000"><b>IF Not</b></font><font color="#000080">(</font>Check<font color="#000080">) </font><font color="#FF0000"><b>THEN </b></font>TextNumError<font color="#000080">;
</font><font color="#008000"><i>{ Main loop }
  </i></font>Write<font color="#000080">(</font><font color="#800000">'CT-Voice Driver Version : '</font><font color="#000080">);
  </font>WriteLn<font color="#000080">(</font>Hi<font color="#000080">(</font>VOCDriverVersion<font color="#000080">),</font><font color="#800000">'.'</font><font color="#000080">,</font>Lo<font color="#000080">(</font>VOCDriverVersion<font color="#000080">));
  </font>WriteLn<font color="#000080">(</font><font color="#800000">'(S)ingle play or (M)ultiple play?'</font><font color="#000080">);
  </font>Write<font color="#000080">(</font><font color="#800000">'Press a key : '</font><font color="#000080">); </font>Ch <font color="#000080">:= </font>ReadKey<font color="#000080">;</font>WriteLn<font color="#000080">;</font>WriteLn<font color="#000080">;
  </font><font color="#FF0000"><b>CASE </b></font>UpCase<font color="#000080">(</font>Ch<font color="#000080">) </font><font color="#FF0000"><b>OF
   </b></font><font color="#800000">'S' </font><font color="#000080">: </font><font color="#FF0000"><b>BEGIN
            </b></font>Write<font color="#000080">(</font><font color="#800000">'Press a key to stop the sound...'</font><font color="#000080">);
            </font>VOCOutput<font color="#000080">(</font>Sound<font color="#000080">);
            </font><font color="#FF0000"><b>REPEAT UNTIL </b></font>KeyPressed <font color="#FF0000"><b>OR </b></font><font color="#000080">(</font>VOCStatusWord <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">);
            </font><font color="#FF0000"><b>IF </b></font>KeyPressed <font color="#FF0000"><b>THEN </b></font>VOCStop<font color="#000080">;
            </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
   </font><font color="#800000">'M' </font><font color="#000080">: </font><font color="#FF0000"><b>BEGIN
            </b></font>Ch <font color="#000080">:= </font><font color="#800000">#0</font><font color="#000080">;
            </font>Write<font color="#000080">(</font><font color="#800000">'Press &lt;ESC&gt; to cancel...'</font><font color="#000080">);
            </font><font color="#FF0000"><b>REPEAT
               </b></font>VOCOutputLoop<font color="#000080">(</font>Sound<font color="#000080">);
               </font><font color="#FF0000"><b>REPEAT UNTIL </b></font>KeyPressed <font color="#FF0000"><b>OR </b></font><font color="#000080">(</font>VOCStatusWord <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">);
               </font><font color="#FF0000"><b>IF </b></font>KeyPressed <font color="#FF0000"><b>THEN </b></font>Ch <font color="#000080">:= </font>ReadKey<font color="#000080">;
               </font><font color="#FF0000"><b>UNTIL </b></font>Ch <font color="#000080">= </font><font color="#800000">#27</font><font color="#000080">;
            </font>VOCStop<font color="#000080">;
            </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
   </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
</font><font color="#008000"><i>{ Free VOC file memory }
  </i></font>Check <font color="#000080">:= </font>VOCFreeBuffer<font color="#000080">(</font>Sound<font color="#000080">);
  </font><font color="#FF0000"><b>IF Not</b></font><font color="#000080">(</font>Check<font color="#000080">) </font><font color="#FF0000"><b>THEN </b></font>TextNumError<font color="#000080">;
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to SOUND SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0022.PAS">Original</a><b>]</b></p></body>
</html>
