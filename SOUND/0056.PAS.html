<html>
<head><title> "Programming the PC-Speaker" by LOU DUCHEZ</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to SOUND SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0056.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
&gt;I want to build on Infared Controller (thru RC5 coding) to controll my
&gt;tv, stereo, ect thru my PC. I know how to programm the computer to do so,
&gt;but I need to access my PC-Speaker directly !!!
&gt;Does anyone know the Port Adress or Mem Adress for accessing the PC-Speaker

Here's some BASM code of mine; check the comments:
From: ljduchez@en.com (Lou DuChez)
}

</i></font><font color="#FF0000"><b>asm
  </b></font><font color="#FF00FF">mov al, 182       </font><font color="#008000"><i>{ prepare timer to start generating sound }
  </i></font><font color="#FF00FF">out 43h, al
  mov ax, toneout   </font><font color="#008000"><i>{ TONEOUT = word: 1193180 / frequency }
  </i></font><font color="#FF00FF">out 42h, al       </font><font color="#008000"><i>{ send low byte to port 42h }
  </i></font><font color="#FF00FF">mov al, ah
  out 42h, al       </font><font color="#008000"><i>{ send high byte to port 42h }
  </i></font><font color="#FF00FF">in al, 61h        </font><font color="#008000"><i>{ get current value of port 61h }
  </i></font><font color="#FF00FF">or al, 3          </font><font color="#008000"><i>{ set lowest two bits of 61h &quot;on&quot; -- activate speaker }
  </i></font><font color="#FF00FF">out 61h, al       </font><font color="#008000"><i>{ rewrite to port 61h }
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{ This code turns off the speaker: }

</i></font><font color="#FF0000"><b>asm
  </b></font><font color="#FF00FF">in al, 61h        </font><font color="#008000"><i>{ set lowest two bits of 61h &quot;off&quot; -- deactive speaker }
  </i></font><font color="#FF00FF">and al, 252       </font><font color="#008000"><i>{ this line turns the lowest two bits &quot;off&quot; }
  </i></font><font color="#FF00FF">out 61h, al
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{
&gt; If I know this adress, all you have to do is buy a IR-Led ($1,00) and your
&gt; computer is the biggest enhanced remote controller.
}

{
From: -deneb- &lt;NWIEFFER@norton.ctech.ac.za&gt;

&gt; I want to build on Infared Controller (thru RC5 coding) to controll my
&gt; tv, stereo, ect thru my PC. I know how to programm the computer to do so,
&gt; but I need to access my PC-Speaker directly !!!
&gt; Does anyone know the Port Adress or Mem Adress for accessing the PC-Speaker

Well .... it's not half as easy as it could be ...

There are a few way to fiddle with the speaker ...

 1.  Via the 8254 Programmable Interval Timer (PIT). (Port $40-$47)
 2.  Via the 8255 Programmable Peripheral Interface. (Port $60-$67)

 ( on the original PC, XT and earlier 286's these were seperate IC's,
   but now all of that stuff is combined into 1 along with the DMA
   controler, etc.)

With option 1 you can tell the timer to drive the speaker at a
certain frequency ... and that's about it,
or with option 2 you can waggle the speaker bit up and down as you
like ...

For your application, I think option 2 would be the 1 to choose.
So here goes ...
}

{ This should push the output high }
</i></font>x<font color="#000080">:=</font>Port<font color="#000080">[</font><font color="#800000">$61</font><font color="#000080">];
</font>x<font color="#000080">:=(</font>x <font color="#FF0000"><b>and </b></font><font color="#800000">$FC</font><font color="#000080">) </font><font color="#FF0000"><b>or </b></font><font color="#800000">2</font><font color="#000080">;
</font>Port<font color="#000080">[</font><font color="#800000">$61</font><font color="#000080">]:=</font>x<font color="#000080">;

</font><font color="#008000"><i>{ And this should push it low }
</i></font>x<font color="#000080">:=</font>Port<font color="#000080">[</font><font color="#800000">$61</font><font color="#000080">];
</font>x<font color="#000080">:=</font>x <font color="#FF0000"><b>and </b></font><font color="#800000">$FC
</font>Port<font color="#000080">[</font><font color="#800000">$61</font><font color="#000080">]:=</font>x<font color="#000080">;

</font><font color="#008000"><i>{
And hear's what is actually does ...

Port $61 is the 8255 port B.
If bit 0 of port B is 0, then the speaker does exactly what bit 1
does ... that's what I'm doing above.

In this mode the port can go like this ...

Port B bit 1 : 1    0    1    0
Speaker port : High Low  High Low


If bit 0 of port B is 1, then the speaker is conected to the PIT,
in which case Bit 1 acts as the switch ... it either connects it to
the PIT, or it switches it off.

And in this mode the port goes somthing like this ...

Port B bit 1 : 1    0    1    0
Speaker Port : Beep Off  Beep Off
}
</i></font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to SOUND SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0056.PAS">Original</a><b>]</b></p></body>
</html>
