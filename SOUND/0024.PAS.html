<html>
<head><title> "8bit raw sounds" by STEVEN TALLEN</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to SOUND SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0024.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{

 SoundS.INC  5-27-93  by Steven Tallent

This is a Unit to play 8-bit raw Sound Files on any PC, up to 64k
large.  It supports the PC speaker or a DAC (LPT1 or LPT2), although
I do plan to upgrade it to support the SoundBlaster and Adlib Sound
cards.  It is Object-oriented in nature, With one instance of a
speaker defined automatically.  This Unit is public domain, With
code and ideas captured from this echo and Dr. Dobbs Journal.

Using the code is simple.  Just setup the the Speaker.Kind,
Speaker.Silent, and Speaker.DisINT to the appropriate values, then
just use the methods included.  The SoundBoard Object is very
flexible For your own code.

SoundBoard.Play  - Plays 8-bit music in What^ For Size length, With
                   Speed milliseconds between each Byte, and SampleRate
                   as the sample rate (in Hz).  Speed will need to be
                   changed on different computers (of course).

SoundBoard.Sound - Plays a Sound at HZ Hertz, Duration in ms, on
                   VOICE voice.  The code included is useable on
                   the PC speaker (1 voice) or the Tandy speaker
                   (3 voices!).

SoundBoard.Reset - Resets the Sound board.

SoundBoard.Silent- Convenient Variable that disables all PLAY and Sound
                   if set to True.

SoundBoard.DisINT- Disables all interrupts (except during Delays)
                   While using PLAY.

This code may be freely distributed, changed, or included in your
own commercial or shareware code, as long as this isn't all your code
does.  This code may be included in commercial or shareware code
libraries only With my permission (I'd like to see someone get some
use out of it).
}

</i></font><font color="#FF0000"><b>Unit </b></font>Sounds<font color="#000080">;

</font><font color="#FF0000"><b>Interface

Type
  </b></font>BigArray    <font color="#000080">= </font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">0</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Byte<font color="#000080">;
  </font>PBigArray   <font color="#000080">= ^</font>BigArray<font color="#000080">;
  </font>KSoundBoard <font color="#000080">= (</font>PCspeaker<font color="#000080">, </font>Tandy<font color="#000080">, </font>DAC1<font color="#000080">, </font>DAC2<font color="#000080">, </font>AdLib<font color="#000080">, </font>SB<font color="#000080">, </font>SBpro<font color="#000080">, </font>SB16<font color="#000080">);

  </font>SoundBoard  <font color="#000080">= </font><font color="#FF0000"><b>Object
    </b></font>Kind   <font color="#000080">: </font>KSoundBoard<font color="#000080">;
    </font>Silent <font color="#000080">: </font>Boolean<font color="#000080">;
    </font>DisINT <font color="#000080">: </font>Boolean<font color="#000080">;
    </font><font color="#FF0000"><b>Procedure </b></font>Play<font color="#000080">(</font>What <font color="#000080">: </font>PBigArray<font color="#000080">; </font>Size <font color="#000080">: </font>Word<font color="#000080">; </font>Speed <font color="#000080">: </font>Byte<font color="#000080">;
                    </font>SampleRate <font color="#000080">: </font>Word<font color="#000080">);
    </font><font color="#FF0000"><b>Procedure </b></font>Sound<font color="#000080">(</font>Hz<font color="#000080">, </font>Duration <font color="#000080">: </font>Word<font color="#000080">; </font>Voice<font color="#000080">, </font>Volume <font color="#000080">: </font>Byte<font color="#000080">);
    </font><font color="#FF0000"><b>Procedure </b></font>Reset<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Var
  </b></font>Speaker <font color="#000080">: </font>SoundBoard<font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>Delay<font color="#000080">(</font>ms <font color="#000080">: </font>Word<font color="#000080">);

</font><font color="#FF0000"><b>Implementation

Procedure </b></font>SoundBoard<font color="#000080">.</font>Reset<font color="#000080">;
</font><font color="#FF0000"><b>begin
  Case </b></font>Kind <font color="#FF0000"><b>of
    </b></font>PCspeaker<font color="#000080">, </font>Tandy <font color="#000080">: </font>Port<font color="#000080">[</font><font color="#800000">97</font><font color="#000080">] := </font>Port<font color="#000080">[</font><font color="#800000">97</font><font color="#000080">] </font><font color="#FF0000"><b>and </b></font><font color="#800000">$FC</font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>SoundBoard<font color="#000080">.</font>Sound<font color="#000080">(</font>Hz<font color="#000080">, </font>Duration <font color="#000080">: </font>Word<font color="#000080">; </font>Voice<font color="#000080">, </font>Volume <font color="#000080">: </font>Byte<font color="#000080">);
</font><font color="#FF0000"><b>Var
  </b></font>Count   <font color="#000080">: </font>Word<font color="#000080">;
  </font>SendByte<font color="#000080">,
  </font>VoiceID <font color="#000080">: </font>Byte<font color="#000080">;
</font><font color="#FF0000"><b>begin
  Case </b></font>Kind <font color="#FF0000"><b>of
    </b></font>PCspeaker <font color="#000080">:
      </font><font color="#FF0000"><b>begin
        </b></font>Count <font color="#000080">:= </font><font color="#800000">1193180 </font><font color="#FF0000"><b>div </b></font>Hz<font color="#000080">;
        </font>Port<font color="#000080">[</font><font color="#800000">97</font><font color="#000080">] := </font>Port<font color="#000080">[</font><font color="#800000">97</font><font color="#000080">] </font><font color="#FF0000"><b>or </b></font><font color="#800000">3</font><font color="#000080">;
        </font>Port<font color="#000080">[</font><font color="#800000">67</font><font color="#000080">] := </font><font color="#800000">182</font><font color="#000080">;
        </font>Port<font color="#000080">[</font><font color="#800000">66</font><font color="#000080">] := </font>Lo<font color="#000080">(</font>Count<font color="#000080">);
        </font>Port<font color="#000080">[</font><font color="#800000">66</font><font color="#000080">] := </font>Hi<font color="#000080">(</font>Count<font color="#000080">);
        </font>Delay<font color="#000080">(</font>Duration<font color="#000080">);
        </font>Port<font color="#000080">[</font><font color="#800000">97</font><font color="#000080">] := </font>Port<font color="#000080">[</font><font color="#800000">97</font><font color="#000080">] </font><font color="#FF0000"><b>and </b></font><font color="#800000">$FC</font><font color="#000080">;
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font>Tandy <font color="#000080">:
      </font><font color="#FF0000"><b>begin
        if </b></font>Voice <font color="#000080">= </font><font color="#800000">1 </font><font color="#FF0000"><b>then
          </b></font>VoiceId <font color="#000080">:= </font><font color="#800000">0
        </font><font color="#FF0000"><b>else
        if </b></font>Voice <font color="#000080">= </font><font color="#800000">2 </font><font color="#FF0000"><b>then
          </b></font>VoiceId <font color="#000080">:= </font><font color="#800000">32
        </font><font color="#FF0000"><b>else
          </b></font>VoiceId <font color="#000080">:= </font><font color="#800000">64</font><font color="#000080">;
        </font>Count <font color="#000080">:= </font><font color="#800000">111861 </font><font color="#FF0000"><b>div </b></font>Hz<font color="#000080">;
        </font>SendByte <font color="#000080">:= </font><font color="#800000">128 </font><font color="#000080">+ </font>VoiceId <font color="#000080">+ (</font>Count <font color="#FF0000"><b>mod </b></font><font color="#800000">16</font><font color="#000080">);
        </font>Port <font color="#000080">[</font><font color="#800000">$61</font><font color="#000080">] := </font><font color="#800000">$68</font><font color="#000080">;
        </font>Port <font color="#000080">[</font><font color="#800000">$C0</font><font color="#000080">] := </font>SendByte<font color="#000080">;
        </font>Port <font color="#000080">[</font><font color="#800000">$C0</font><font color="#000080">] := </font>Count <font color="#FF0000"><b>div </b></font><font color="#800000">16</font><font color="#000080">;
        </font><font color="#FF0000"><b>if </b></font>Voice <font color="#000080">= </font><font color="#800000">1 </font><font color="#FF0000"><b>then
          </b></font>VoiceId <font color="#000080">:= </font><font color="#800000">16
        </font><font color="#FF0000"><b>else
        if </b></font>Voice <font color="#000080">= </font><font color="#800000">2 </font><font color="#FF0000"><b>then
          </b></font>VoiceId <font color="#000080">:= </font><font color="#800000">48
        </font><font color="#FF0000"><b>else
          </b></font>VoiceId <font color="#000080">:= </font><font color="#800000">96</font><font color="#000080">;
        </font>SendByte <font color="#000080">:= </font><font color="#800000">128 </font><font color="#000080">+ </font>VoiceId <font color="#000080">+ (</font><font color="#800000">15 </font><font color="#000080">- </font>Volume<font color="#000080">);
        </font>Port <font color="#000080">[</font><font color="#800000">$61</font><font color="#000080">] := </font><font color="#800000">$68</font><font color="#000080">;
        </font>Port <font color="#000080">[</font><font color="#800000">$C0</font><font color="#000080">] := </font>SendByte<font color="#000080">;
        </font>Delay<font color="#000080">(</font>Duration<font color="#000080">);
        </font>SendByte <font color="#000080">:= </font><font color="#800000">128 </font><font color="#000080">+ </font>VoiceId <font color="#000080">+ </font><font color="#800000">15</font><font color="#000080">;
        </font>Port <font color="#000080">[</font><font color="#800000">$61</font><font color="#000080">] := </font><font color="#800000">$68</font><font color="#000080">;
        </font>Port <font color="#000080">[</font><font color="#800000">$C0</font><font color="#000080">] := </font>SendByte<font color="#000080">;
    </font>DAC1<font color="#000080">:;
    </font>DAC2<font color="#000080">:;
    </font>AdLib<font color="#000080">:;
    </font>SB<font color="#000080">:;
    </font>SBPro<font color="#000080">:;
    </font>SB16<font color="#000080">:;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>SoundBoard<font color="#000080">.</font>Play<font color="#000080">(</font>What <font color="#000080">: </font>PBigArray<font color="#000080">; </font>Size <font color="#000080">: </font>Word<font color="#000080">;
                          </font>Speed <font color="#000080">: </font>Byte<font color="#000080">; </font>SampleRate <font color="#000080">: </font>Word<font color="#000080">);
</font><font color="#FF0000"><b>Var
  </b></font>Loop<font color="#000080">,
  </font>Count<font color="#000080">,
  </font>Data  <font color="#000080">: </font>Word<font color="#000080">;
</font><font color="#FF0000"><b>begin
  if not </b></font>Silent <font color="#FF0000"><b>then
  begin
    Case </b></font>Kind <font color="#FF0000"><b>of
      </b></font>PCspeaker<font color="#000080">, </font>Tandy <font color="#000080">:
        </font><font color="#FF0000"><b>begin
          </b></font>Port<font color="#000080">[</font><font color="#800000">97</font><font color="#000080">] := </font>Port<font color="#000080">[</font><font color="#800000">97</font><font color="#000080">] </font><font color="#FF0000"><b>or </b></font><font color="#800000">3</font><font color="#000080">;
          </font>Count <font color="#000080">:= </font><font color="#800000">1193180 </font><font color="#FF0000"><b>div </b></font><font color="#000080">(</font>SampleRate <font color="#FF0000"><b>div </b></font><font color="#800000">256</font><font color="#000080">);
          </font><font color="#FF0000"><b>For </b></font>Loop <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>Size <font color="#FF0000"><b>do
          begin
            </b></font>Data <font color="#000080">:= </font>Count <font color="#FF0000"><b>div </b></font><font color="#000080">(</font>What<font color="#000080">^[</font>Loop<font color="#000080">] + </font><font color="#800000">1</font><font color="#000080">);
            </font>Port<font color="#000080">[</font><font color="#800000">67</font><font color="#000080">] := </font><font color="#800000">182</font><font color="#000080">;
            </font>Port<font color="#000080">[</font><font color="#800000">66</font><font color="#000080">] := </font>Lo<font color="#000080">(</font>Data<font color="#000080">);
            </font>Port<font color="#000080">[</font><font color="#800000">66</font><font color="#000080">] := </font>Hi<font color="#000080">(</font>Data<font color="#000080">);
            </font>Delay<font color="#000080">(</font>Speed<font color="#000080">);
            </font><font color="#FF0000"><b>if </b></font>DisINT <font color="#FF0000"><b>then
            Asm
              </b></font><font color="#FF00FF">CLI
            </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
          </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
          </font>Port<font color="#000080">[</font><font color="#800000">97</font><font color="#000080">] := </font>Port<font color="#000080">[</font><font color="#800000">97</font><font color="#000080">] </font><font color="#FF0000"><b>and </b></font><font color="#800000">$FC</font><font color="#000080">;
        </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

        </font>DAC1<font color="#000080">:
          </font><font color="#FF0000"><b>For </b></font>Loop <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>Size <font color="#FF0000"><b>do
          begin
            </b></font>Port <font color="#000080">[</font><font color="#800000">$0378</font><font color="#000080">] := </font>What<font color="#000080">^[</font>Loop<font color="#000080">];
            </font>Delay <font color="#000080">(</font>Speed<font color="#000080">);
            </font><font color="#FF0000"><b>if </b></font>DisINT <font color="#FF0000"><b>then
            Asm
              </b></font><font color="#FF00FF">CLI
            </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
          </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

        </font>DAC2<font color="#000080">:
          </font><font color="#FF0000"><b>For </b></font>Loop <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>Size <font color="#FF0000"><b>do
          begin
            </b></font>Port <font color="#000080">[</font><font color="#800000">$0278</font><font color="#000080">] := </font>What<font color="#000080">^[</font>Loop<font color="#000080">];
            </font>Delay <font color="#000080">(</font>Speed<font color="#000080">);
            </font><font color="#FF0000"><b>if </b></font>DisINT <font color="#FF0000"><b>then
            Asm
              </b></font><font color="#FF00FF">CLI
            </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
          </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

        </font>AdLib<font color="#000080">:;
        </font>SB<font color="#000080">:;
        </font>SBPro<font color="#000080">:;
        </font>SB16<font color="#000080">:;
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>Asm
        </b></font><font color="#FF00FF">STI
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>Delay<font color="#000080">(</font>ms <font color="#000080">: </font>Word<font color="#000080">); </font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Asm
  </b></font><font color="#FF00FF">STI
  MOV AH, $86
  MOV CX, 0
  MOV DX, [ms]
  INT $15
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>end</b></font><font color="#000080">.

</font><font color="#008000"><i>{-----------------------------------------------------------------
Here's a Program that will accept three values from the command
line, the File, its speed, and the sample rate, and plays it
through the PC speaker.  I've tried in on WAV, VOC, SAM, and even
Amiga sampled Files, With no problems (limited to 64k). I've even
played MOD Files to hear all the sampled instruments!  This Program
does not strip header information, but plays it too, but I can't
hear the difference on WAV and VOC Files.
}
</i></font><font color="#FF0000"><b>Program </b></font>TestSnd<font color="#000080">;
</font><font color="#FF0000"><b>Uses
  </b></font>Sounds<font color="#000080">;
</font><font color="#FF0000"><b>Var
  </b></font>I2   <font color="#000080">: </font>PBigArray<font color="#000080">;
  </font>spd  <font color="#000080">: </font>Integer<font color="#000080">;
  </font>samp <font color="#000080">: </font>Word<font color="#000080">;
  </font>res  <font color="#000080">: </font>Word<font color="#000080">;
  </font>siz  <font color="#000080">: </font>Word<font color="#000080">;
  </font>s    <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
  </font>f1   <font color="#000080">: </font><font color="#FF0000"><b>File of </b></font>Byte<font color="#000080">;
  </font>F    <font color="#000080">: </font><font color="#FF0000"><b>File</b></font><font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>Speaker<font color="#000080">.</font>Kind   <font color="#000080">:= </font>PCspeaker<font color="#000080">;
  </font>Speaker<font color="#000080">.</font>DisINT <font color="#000080">:= </font>True<font color="#000080">;
  </font>Speaker<font color="#000080">.</font>Silent <font color="#000080">:= </font>False<font color="#000080">;
  </font>s <font color="#000080">:= </font>ParamStr<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">);
  </font>Assign<font color="#000080">(</font>f1<font color="#000080">,</font>s<font color="#000080">);  </font><font color="#008000"><i>{Get size of File}
  </i></font>Reset<font color="#000080">(</font>f1<font color="#000080">);
  </font>Val <font color="#000080">(</font>ParamStr<font color="#000080">(</font><font color="#800000">2</font><font color="#000080">), </font>Spd<font color="#000080">, </font>Res<font color="#000080">);
  </font>Val <font color="#000080">(</font>ParamStr<font color="#000080">(</font><font color="#800000">3</font><font color="#000080">), </font>samp<font color="#000080">, </font>Res<font color="#000080">);
  </font>siz <font color="#000080">:= </font>FileSize<font color="#000080">(</font>f1<font color="#000080">);
  </font>close<font color="#000080">(</font>f1<font color="#000080">);
  </font>Assign<font color="#000080">(</font>f<font color="#000080">,</font>s<font color="#000080">);
  </font>Reset<font color="#000080">(</font>f<font color="#000080">);
  </font>getmem <font color="#000080">(</font>I2<font color="#000080">,</font>siz<font color="#000080">);  </font><font color="#008000"><i>{Allocate Memory For Sound File}
  </i></font>BlockRead<font color="#000080">(</font>f<font color="#000080">,</font>I2<font color="#000080">^,</font>siz<font color="#000080">,</font>res<font color="#000080">);  </font><font color="#008000"><i>{Load Sound into Memory}
  </i></font>Speaker<font color="#000080">.</font>Play <font color="#000080">(</font>i2<font color="#000080">, </font>siz<font color="#000080">, </font>spd<font color="#000080">, </font>samp<font color="#000080">);
  </font>FreeMem <font color="#000080">(</font>I2<font color="#000080">, </font>siz<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to SOUND SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0024.PAS">Original</a><b>]</b></p></body>
</html>
