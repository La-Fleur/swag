<html>
<head><title> "CD-Rom player routines" by GREG ESTABROOKS</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to SOUND SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0083.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
 TK&gt; Monday March 13 1995 21:16, Ville Lumme wrote to All:
 SC&gt;
 &gt; Has anyone got some kind of specs how to interrupt MSCDEX to play audio
 &gt; CDs? I have spent much time for searching them, and I'm getting hopeless...

 TK&gt; Read my answer from Netmail.

 SC&gt; Can you do a post in echomail. Others might want to read it
 SC&gt; too.

Okey sounds like you want a unit (or a routine) for playing audio cds. Well, I
have one, here the source:
}

{$X+,O+,F+}
</i></font><font color="#FF0000"><b>UNIT </b></font>CDRom<font color="#000080">;              </font><font color="#008000"><i>{ CD Rom Interfacing routines.                 }
                         { Last Updated July 16/94, Greg Estabrooks.    }
</i></font><font color="#FF0000"><b>INTERFACE
</b></font><font color="#008000"><i>{***********************************************************************}
</i></font><font color="#FF0000"><b>USES </b></font>DOS<font color="#000080">;
</font><font color="#FF0000"><b>CONST
   </b></font>CDRead  <font color="#000080">= </font><font color="#800000">$4402</font><font color="#000080">;
   </font>CDWrite <font color="#000080">= </font><font color="#800000">$4403</font><font color="#000080">;

             </font><font color="#008000"><i>{ Define some CD IOCTL OutPut function codes.              }
   </i></font>EjectDisk   <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">;
   </font>LockUnlock  <font color="#000080">= </font><font color="#800000">1</font><font color="#000080">;
   </font>ResetCD     <font color="#000080">= </font><font color="#800000">2</font><font color="#000080">;
   </font>AudioCtrl   <font color="#000080">= </font><font color="#800000">3</font><font color="#000080">;
   </font>WriteCtrlStr<font color="#000080">= </font><font color="#800000">4</font><font color="#000080">;
   </font>CloseTray   <font color="#000080">= </font><font color="#800000">5</font><font color="#000080">;

</font><font color="#FF0000"><b>TYPE
</b></font>CDPosType <font color="#000080">= </font><font color="#FF0000"><b>RECORD
   </b></font>CtlAdr <font color="#000080">: </font>BYTE<font color="#000080">;  </font><font color="#008000"><i>{ Control and ADR byte.                 }
   </i></font>Track  <font color="#000080">: </font>BYTE<font color="#000080">;  </font><font color="#008000"><i>{ Current Track #.                      }
   </i></font>Indx   <font color="#000080">: </font>BYTE<font color="#000080">;  </font><font color="#008000"><i>{ Point or Index Byte.                  }
   </i></font>Min    <font color="#000080">: </font>BYTE<font color="#000080">;  </font><font color="#008000"><i>{ Minute. \                             }
   </i></font>Sec    <font color="#000080">: </font>BYTE<font color="#000080">;  </font><font color="#008000"><i>{ Second.  &gt; Running time within track. }
   </i></font>Frame  <font color="#000080">: </font>BYTE<font color="#000080">;  </font><font color="#008000"><i>{ Frame.  /                             }
   </i></font>Zero   <font color="#000080">: </font>BYTE<font color="#000080">;  </font><font color="#008000"><i>{ Should be a 0.                        }
   </i></font>DMin   <font color="#000080">: </font>BYTE<font color="#000080">;  </font><font color="#008000"><i>{ Minute. \                             }
   </i></font>DSec   <font color="#000080">: </font>BYTE<font color="#000080">;  </font><font color="#008000"><i>{ Second.  &gt; Running time on disk.      }
   </i></font>DFrame <font color="#000080">: </font>BYTE<font color="#000080">;  </font><font color="#008000"><i>{ Frame.  /                             }
</i></font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font>CDInfoRecord <font color="#000080">= </font><font color="#FF0000"><b>RECORD
   </b></font>Status <font color="#000080">: </font>WORD<font color="#000080">; </font><font color="#008000"><i>{ Holds the status of last operation. }
   </i></font>NumCD  <font color="#000080">: </font>WORD<font color="#000080">; </font><font color="#008000"><i>{ Number of CD Drives available.      }
   </i></font>DrvChar<font color="#000080">: </font>CHAR<font color="#000080">; </font><font color="#008000"><i>{ First CD drive in CHAR format.      }
   </i></font>DrvNo  <font color="#000080">: </font>BYTE<font color="#000080">; </font><font color="#008000"><i>{ BYTE value of first drive. 0 = A,ETC}
   </i></font>DVParam<font color="#000080">: </font>LONGINT<font color="#000080">;</font><font color="#008000"><i>{ Device parameters.                }
   </i></font>VolInf <font color="#000080">: </font><font color="#FF0000"><b>ARRAY</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">8</font><font color="#000080">] </font><font color="#FF0000"><b>OF </b></font>BYTE<font color="#000080">; </font><font color="#008000"><i>{ Holds Audio Channel inf.}
   </i></font>LoTrack<font color="#000080">: </font>BYTE<font color="#000080">; </font><font color="#008000"><i>{ Lowest Audio track #.               }
   </i></font>HiTrack<font color="#000080">: </font>BYTE<font color="#000080">; </font><font color="#008000"><i>{ Highest Audio Track #.              }
   </i></font>LdAdr  <font color="#000080">: </font>LONGINT<font color="#000080">;</font><font color="#008000"><i>{ Address of Lead track in HSG.     }
</i></font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font>DriveList <font color="#000080">= </font><font color="#FF0000"><b>RECORD
   </b></font>UnitCode <font color="#000080">: </font>BYTE<font color="#000080">;
   </font>DOffset<font color="#000080">,</font>DSegment <font color="#000080">: </font>WORD<font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>VAR
   </b></font>CDDevice <font color="#000080">:</font>TEXT<font color="#000080">;              </font><font color="#008000"><i>{ File Handle for the CD Driver.        }
   </i></font>CDStatus <font color="#000080">:</font>WORD<font color="#000080">;              </font><font color="#008000"><i>{ Status for last CD operation.         }
   </i></font>CDControl<font color="#000080">:</font><font color="#FF0000"><b>ARRAY</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">200</font><font color="#000080">] </font><font color="#FF0000"><b>OF </b></font>BYTE<font color="#000080">;
   </font>CDHandle <font color="#000080">:</font>WORD<font color="#000080">;
   </font>CDInf    <font color="#000080">:</font>CDInfoRecord<font color="#000080">;
   </font>PosInf   <font color="#000080">:</font>CDPosType<font color="#000080">;

</font><font color="#FF0000"><b>FUNCTION </b></font>CDGetHandle <font color="#000080">: </font>WORD<font color="#000080">;
                         </font><font color="#008000"><i>{ Routine to get handle for referencing the CD }
                         { Device driver.                               }
</i></font><font color="#FF0000"><b>PROCEDURE </b></font>CDCloseHandle<font color="#000080">;
                         </font><font color="#008000"><i>{ Routine to close Handle referencing the CD   }
                         { Driver.                                      }
</i></font><font color="#FF0000"><b>FUNCTION </b></font>CDIoctl<font color="#000080">(</font>IntFunc<font color="#000080">, </font>Len <font color="#000080">: </font>WORD<font color="#000080">; </font><font color="#FF0000"><b>VAR </b></font>CtlBlk<font color="#000080">) : </font>BOOLEAN<font color="#000080">;
                         </font><font color="#008000"><i>{ Routine to call the CD IOCTL.                }
</i></font><font color="#FF0000"><b>PROCEDURE </b></font>DriverRequest<font color="#000080">(</font>Drive <font color="#000080">: </font>BYTE<font color="#000080">; </font><font color="#FF0000"><b>VAR </b></font>CtlBlk<font color="#000080">);
                         </font><font color="#008000"><i>{ Routine to make request of MSCDEX.           }
</i></font><font color="#FF0000"><b>FUNCTION </b></font>CDEject <font color="#000080">: </font>BOOLEAN<font color="#000080">;
                         </font><font color="#008000"><i>{ Routine to Eject the CD tray.                }
</i></font><font color="#FF0000"><b>FUNCTION </b></font>CDCloseTray <font color="#000080">: </font>BOOLEAN<font color="#000080">;
                         </font><font color="#008000"><i>{ Routine to close the CD tray.                }
</i></font><font color="#FF0000"><b>FUNCTION </b></font>CDReset <font color="#000080">: </font>BOOLEAN<font color="#000080">;
                         </font><font color="#008000"><i>{ Routine to reset the CD Drive.               }
</i></font><font color="#FF0000"><b>FUNCTION </b></font>CDGetVol<font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>InfRec <font color="#000080">: </font>CDInfoRecord<font color="#000080">) : </font>BOOLEAN<font color="#000080">;
                         </font><font color="#008000"><i>{ Routine to get current audio volume output.  }
</i></font><font color="#FF0000"><b>FUNCTION </b></font>CDStop <font color="#000080">: </font>BOOLEAN<font color="#000080">;
                         </font><font color="#008000"><i>{ Routine to stop the playing and Audio CD.    }
</i></font><font color="#FF0000"><b>PROCEDURE </b></font>CDInitInfo<font color="#000080">;
                         </font><font color="#008000"><i>{ Routine to Intilialize CD Info.              }
</i></font><font color="#FF0000"><b>FUNCTION </b></font>CDResumePlay <font color="#000080">: </font>BOOLEAN<font color="#000080">;
                         </font><font color="#008000"><i>{ Routine to Resume playing a previously stopped}
                         { audio track.                                  }
</i></font><font color="#FF0000"><b>FUNCTION </b></font>CDGetPos<font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>PosInf <font color="#000080">: </font>CDPosType <font color="#000080">) : </font>BOOLEAN<font color="#000080">;
                         </font><font color="#008000"><i>{ Routine to retrieve current position being   }
                         { played.                                      }
</i></font><font color="#FF0000"><b>FUNCTION </b></font>Red2HSG<font color="#000080">(</font>Inf <font color="#000080">: </font>LONGINT <font color="#000080">) : </font>LONGINT<font color="#000080">;

</font><font color="#FF0000"><b>FUNCTION </b></font>CDGetTrackStart<font color="#000080">(</font>Track <font color="#000080">: </font>BYTE <font color="#000080">) : </font>LONGINT<font color="#000080">;

</font><font color="#FF0000"><b>FUNCTION </b></font>CDVolSize <font color="#000080">: </font>LONGINT<font color="#000080">;
                         </font><font color="#008000"><i>{ Routine to determine the volume size in      }
                         { sectors.                                     }
</i></font><font color="#FF0000"><b>FUNCTION </b></font>CDSectSize <font color="#000080">: </font>WORD<font color="#000080">;
                         </font><font color="#008000"><i>{ Routine to determine the Sector size in      }
                         { bytes.                                       }
</i></font><font color="#FF0000"><b>FUNCTION </b></font>CDPlayAudio<font color="#000080">(</font>Track <font color="#000080">: </font>BYTE<font color="#000080">; </font>Len <font color="#000080">: </font>LONGINT <font color="#000080">) : </font>BOOLEAN<font color="#000080">;

</font><font color="#FF0000"><b>IMPLEMENTATION
</b></font><font color="#008000"><i>{***********************************************************************}
</i></font><font color="#FF0000"><b>VAR
   </b></font>OldExit <font color="#000080">: </font>POINTER<font color="#000080">;
   </font>CDDL     <font color="#000080">: </font>DriveList<font color="#000080">;
   </font>CDDriver <font color="#000080">: </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">[</font><font color="#800000">8</font><font color="#000080">];  </font><font color="#008000"><i>{ CD Driver name.                }

</i></font><font color="#FF0000"><b>FUNCTION </b></font>GetDriverName <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
</font><font color="#FF0000"><b>VAR
   </b></font>CDNTemp <font color="#000080">: </font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">18</font><font color="#000080">] </font><font color="#FF0000"><b>OF </b></font>BYTE<font color="#000080">;
   </font>Where <font color="#000080">: </font>POINTER<font color="#000080">;
   </font>Count <font color="#000080">: </font>BYTE<font color="#000080">;
   </font>CDSTemp <font color="#000080">: </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">[</font><font color="#800000">8</font><font color="#000080">];
</font><font color="#FF0000"><b>BEGIN
   ASM
      </b></font><font color="#FF00FF">MOV AX, 1501h
      MOV BX, OFFSET CDDL
      MOV DX, SEG CDDL
      MOV ES, DX
      INT $2F
   </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
   </font>Where <font color="#000080">:= </font>Ptr<font color="#000080">(</font>CDDL<font color="#000080">.</font>DSegment<font color="#000080">,</font>CDDL<font color="#000080">.</font>DOffset<font color="#000080">);
   </font>Move<font color="#000080">(</font>Where<font color="#000080">^,</font>CDNTEMP<font color="#000080">,</font><font color="#800000">18</font><font color="#000080">);
   </font>Count <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;
   </font><font color="#FF0000"><b>REPEAT
      </b></font>CDStemp<font color="#000080">[</font>Count<font color="#000080">] := </font>CHR<font color="#000080">(</font>CDNTemp<font color="#000080">[</font><font color="#800000">10</font><font color="#000080">+</font>Count<font color="#000080">]);
      </font>INC<font color="#000080">(</font>Count<font color="#000080">);
   </font><font color="#FF0000"><b>UNTIL </b></font><font color="#000080">(</font>Count <font color="#000080">&gt; </font><font color="#800000">8</font><font color="#000080">) </font><font color="#FF0000"><b>OR </b></font><font color="#000080">(</font>CDNTemp<font color="#000080">[</font><font color="#800000">10</font><font color="#000080">+</font>Count<font color="#000080">]=</font><font color="#800000">32</font><font color="#000080">);
   </font>CDSTemp<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">] := </font>CHR<font color="#000080">(</font>Count<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">);
   </font>GetDriverName <font color="#000080">:= </font>CDSTemp<font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;


</font><font color="#FF0000"><b>FUNCTION </b></font>CDGetHandle <font color="#000080">: </font>WORD<font color="#000080">;
</font><font color="#008000"><i>{ Routine to get handle for referencing the CD }
{ Device driver.                               }
</i></font><font color="#FF0000"><b>VAR
   </b></font>Handle <font color="#000080">: </font>WORD<font color="#000080">;
</font><font color="#FF0000"><b>BEGIN
   </b></font>Assign<font color="#000080">(</font>CDDevice<font color="#000080">,</font>CDDriver<font color="#000080">);     </font><font color="#008000"><i>{ Assign Handle to driver.              }
   {$I-}                          { Turn I/O checking off.                }
   </i></font>Reset<font color="#000080">(</font>CDDevice<font color="#000080">);               </font><font color="#008000"><i>{ Attempt to open driver.               }
   {$I+}                          { Turn I/O checking on.                 }
   </i></font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>IOResult <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>THEN
      </b></font>Handle <font color="#000080">:= </font>TextRec<font color="#000080">(</font>CDDevice<font color="#000080">).</font>Handle<font color="#008000"><i>{ Save DOS Handle.                }
    </i></font><font color="#FF0000"><b>ELSE
      </b></font>Handle <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
   </font>CDGetHandle <font color="#000080">:= </font>Handle<font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;</font><font color="#008000"><i>{CDGetHandle}

</i></font><font color="#FF0000"><b>PROCEDURE </b></font>CDCloseHandle<font color="#000080">;
</font><font color="#008000"><i>{ Routine to close Handle referencing the CD   }
{ Driver.                                      }
</i></font><font color="#FF0000"><b>BEGIN
   </b></font><font color="#008000"><i>{$I-}                          { Turn I/O checking off.                }
   </i></font>Close<font color="#000080">(</font>CDDevice<font color="#000080">);               </font><font color="#008000"><i>{ Attempt to Close driver.              }
   {$I+}                          { Turn I/O checking on.                 }
   </i></font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>IOResult <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>THEN           </b></font><font color="#008000"><i>{ Dummy IF to clear IOResult.           }
   </i></font><font color="#FF0000"><b>BEGIN
   END</b></font><font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;</font><font color="#008000"><i>{CDCloseHandle}

</i></font><font color="#FF0000"><b>FUNCTION </b></font>CDIoctl<font color="#000080">(</font>IntFunc<font color="#000080">, </font>Len <font color="#000080">: </font>WORD<font color="#000080">;</font><font color="#FF0000"><b>VAR </b></font>CtlBlk <font color="#000080">) : </font>BOOLEAN<font color="#000080">; </font><font color="#FF0000"><b>ASSEMBLER</b></font><font color="#000080">;
</font><font color="#008000"><i>{ Routine to call the CD IOCTL.                }
</i></font><font color="#FF0000"><b>ASM
  </b></font><font color="#FF00FF">PUSH   DS
  MOV    AX,IntFunc                </font><font color="#008000"><i>{ 4402 = Read, 4403 = Write.            }
  </i></font><font color="#FF00FF">MOV    BX,CDHandle               </font><font color="#008000"><i>{ Load Handle for Driver into BX.       }
  </i></font><font color="#FF00FF">MOV    CX,Len
  LDS    DX,CtlBlk                 </font><font color="#008000"><i>{ Point DS:DX to the control block.     }

  </i></font><font color="#FF00FF">INT    $21                       </font><font color="#008000"><i>{ Call DOS Interrupt.                   }
  </i></font><font color="#FF00FF">MOV    CDStatus,AX               </font><font color="#008000"><i>{ Save status of function.              }
  </i></font><font color="#FF00FF">JNC    @NoError                  </font><font color="#008000"><i>{ If there was no error jump to noerror.}
  </i></font><font color="#FF00FF">MOV    AX,0                      </font><font color="#008000"><i>{ Return FALSE.                         }
</i></font><font color="#FF00FF">@NoError:
  MOV    AX,1                      </font><font color="#008000"><i>{ Return TRUE.                          }
</i></font><font color="#FF00FF">@Exit:
  POP    DS
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;</font><font color="#008000"><i>{CDIoctl}

</i></font><font color="#FF0000"><b>PROCEDURE </b></font>DriverRequest<font color="#000080">(</font>Drive <font color="#000080">: </font>BYTE<font color="#000080">;</font><font color="#FF0000"><b>VAR </b></font>CtlBlk <font color="#000080">); </font><font color="#FF0000"><b>ASSEMBLER</b></font><font color="#000080">;
</font><font color="#008000"><i>{ Routine to make request of MSCDEX.           }
</i></font><font color="#FF0000"><b>ASM
   </b></font><font color="#FF00FF">PUSH  ES                       </font><font color="#008000"><i>{ Save ES.                              }
   </i></font><font color="#FF00FF">MOV   AX,$1510                  </font><font color="#008000"><i>{ Subfunction to make request of CD driver.}
   </i></font><font color="#FF00FF">XOR   CH,CH                     </font><font color="#008000"><i>{ Clear High byte of CX.                }
   </i></font><font color="#FF00FF">MOV   CL,Drive                  </font><font color="#008000"><i>{ Load drive to make request of. 0 = A,etc}
   </i></font><font color="#FF00FF">LES   BX,CtlBlk                 </font><font color="#008000"><i>{ Point ES:BX to the control block.     }
   </i></font><font color="#FF00FF">INT $2F                       </font><font color="#008000"><i>{ Call Multiplex interrupt.             }
   </i></font><font color="#FF00FF">POP ES                        </font><font color="#008000"><i>{ Restore ES.                           }
</i></font><font color="#FF0000"><b>END</b></font><font color="#000080">;</font><font color="#008000"><i>{DriverRequest}

</i></font><font color="#FF0000"><b>FUNCTION </b></font>CDEject <font color="#000080">: </font>BOOLEAN<font color="#000080">;
</font><font color="#008000"><i>{ Routine to Eject the CD tray.                }
</i></font><font color="#FF0000"><b>BEGIN
   </b></font>CDControl<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">] := </font>EjectDisk<font color="#000080">;     </font><font color="#008000"><i>{ Function code to eject CD.            }
   </i></font>CDEject <font color="#000080">:= </font>CDIoctl<font color="#000080">(</font>CDWrite<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font>CDControl<font color="#000080">); </font><font color="#008000"><i>{ Now try function and return }
                                            { result to program/user.     }
</i></font><font color="#FF0000"><b>END</b></font><font color="#000080">;</font><font color="#008000"><i>{CDEject}

</i></font><font color="#FF0000"><b>FUNCTION </b></font>CDCloseTray <font color="#000080">: </font>BOOLEAN<font color="#000080">;
</font><font color="#008000"><i>{ Routine to close the CD tray.                }
</i></font><font color="#FF0000"><b>BEGIN
   </b></font>CDControl<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">] := </font>CloseTray<font color="#000080">;     </font><font color="#008000"><i>{ Function code to close CD.            }
   </i></font>CDCloseTray <font color="#000080">:= </font>CDIoctl<font color="#000080">(</font>CDWrite<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font>CDControl<font color="#000080">);</font><font color="#008000"><i>{ Now try function and return}
                                          { result to program/user.     }
</i></font><font color="#FF0000"><b>END</b></font><font color="#000080">;</font><font color="#008000"><i>{CDCloseTray}

</i></font><font color="#FF0000"><b>FUNCTION </b></font>CDReset <font color="#000080">: </font>BOOLEAN<font color="#000080">;
</font><font color="#008000"><i>{ Routine to reset the CD Drive.               }
</i></font><font color="#FF0000"><b>BEGIN
   </b></font>CDControl<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">] := </font>ResetCD<font color="#000080">;       </font><font color="#008000"><i>{ Function code to Reset drive.         }
   </i></font>CDReset <font color="#000080">:= </font>CDIoctl<font color="#000080">(</font>CDWrite<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font>CDControl<font color="#000080">);</font><font color="#008000"><i>{ Now try function and return  }
                                          { result to program/user.     }
</i></font><font color="#FF0000"><b>END</b></font><font color="#000080">;</font><font color="#008000"><i>{CDReset}

</i></font><font color="#FF0000"><b>FUNCTION </b></font>CDGetVol<font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>InfRec <font color="#000080">: </font>CDInfoRecord<font color="#000080">) : </font>BOOLEAN<font color="#000080">;
</font><font color="#008000"><i>{ Routine to get current audio volume output.  }
</i></font><font color="#FF0000"><b>VAR
   </b></font>Temp <font color="#000080">: </font>BOOLEAN<font color="#000080">;               </font><font color="#008000"><i>{ Holds IOCTL Read Result.              }
</i></font><font color="#FF0000"><b>BEGIN
   </b></font>CDControl<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">] := </font><font color="#800000">4</font><font color="#000080">;             </font><font color="#008000"><i>{ Function to read current volumes.     }
   </i></font>Temp <font color="#000080">:= </font>CDIoctl<font color="#000080">(</font>CDRead<font color="#000080">,</font><font color="#800000">8</font><font color="#000080">,</font>CDControl<font color="#000080">);
   </font><font color="#FF0000"><b>IF </b></font>Temp <font color="#FF0000"><b>THEN                    </b></font><font color="#008000"><i>{ IF all was fine then save volumes to }
      </i></font>Move<font color="#000080">(</font>CDControl<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">],</font>InfRec<font color="#000080">.</font>VolInf<font color="#000080">,</font><font color="#800000">8</font><font color="#000080">)</font><font color="#008000"><i>{ array.                            }
    </i></font><font color="#FF0000"><b>ELSE
      </b></font>FillChar<font color="#000080">(</font>InfRec<font color="#000080">.</font>VolInf<font color="#000080">,</font><font color="#800000">8</font><font color="#000080">,</font><font color="#800000">#0</font><font color="#000080">);  </font><font color="#008000"><i>{ Otherwise zero the array.            }
   </i></font>CDGetVol <font color="#000080">:= </font>Temp<font color="#000080">;               </font><font color="#008000"><i>{ Return proper result.                }
</i></font><font color="#FF0000"><b>END</b></font><font color="#000080">;</font><font color="#008000"><i>{CDGetVol}

</i></font><font color="#FF0000"><b>FUNCTION </b></font>CDStop <font color="#000080">: </font>BOOLEAN<font color="#000080">;
</font><font color="#008000"><i>{ Routine to stop the playing and Audio CD.    }
</i></font><font color="#FF0000"><b>BEGIN
   </b></font>FillChar<font color="#000080">(</font>CDControl<font color="#000080">,</font>Sizeof<font color="#000080">(</font>CDControl<font color="#000080">),</font><font color="#800000">#0</font><font color="#000080">);
   </font>CDControl<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">] := </font><font color="#800000">5</font><font color="#000080">;             </font><font color="#008000"><i>{ Byte length of request header.        }
   </i></font>CDControl<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">] := </font><font color="#800000">0</font><font color="#000080">;             </font><font color="#008000"><i>{ Sub unit #.                           }
   </i></font>CDControl<font color="#000080">[</font><font color="#800000">2</font><font color="#000080">] := </font><font color="#800000">$85</font><font color="#000080">;           </font><font color="#008000"><i>{ Function to stop CD.                  }
   </i></font>DriverRequest<font color="#000080">(</font>CDInf<font color="#000080">.</font>DrvNo<font color="#000080">,</font>CDControl<font color="#000080">);
   </font>CDStatus <font color="#000080">:= </font>CDControl<font color="#000080">[</font><font color="#800000">3</font><font color="#000080">] </font><font color="#FF0000"><b>OR </b></font>CDControl<font color="#000080">[</font><font color="#800000">4</font><font color="#000080">] </font><font color="#FF0000"><b>SHL </b></font><font color="#800000">8</font><font color="#000080">;
   </font>CDStop   <font color="#000080">:= (</font>CDStatus <font color="#FF0000"><b>AND </b></font><font color="#800000">$8000</font><font color="#000080">) = </font><font color="#800000">0</font><font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;</font><font color="#008000"><i>{CDStop}

</i></font><font color="#FF0000"><b>PROCEDURE </b></font>CDInitInfo<font color="#000080">;
</font><font color="#008000"><i>{ Routine to Intilialize CD Info.              }
</i></font><font color="#FF0000"><b>BEGIN
   ASM
     </b></font><font color="#FF00FF">MOV  AX,$1500                  </font><font color="#008000"><i>{ Function to get installation info.    }
     </i></font><font color="#FF00FF">MOV  BX,0                      </font><font color="#008000"><i>{ Clear BX.                             }
     </i></font><font color="#FF00FF">INT  $2F                       </font><font color="#008000"><i>{ Call CD Multiplex.                    }
     </i></font><font color="#FF00FF">MOV  CDInf.NumCD,BX            </font><font color="#008000"><i>{ Save number of CD drives available.   }
     </i></font><font color="#FF00FF">MOV  CDInf.DrvNo,CL            </font><font color="#008000"><i>{ Save first drive number.              }
     </i></font><font color="#FF00FF">MOV  CDInf.DrvChar,CL          </font><font color="#008000"><i>{ Save Drive number and convert it to   }
     </i></font><font color="#FF00FF">ADD  CDInf.DrvChar,'A'         </font><font color="#008000"><i>{ a CHAR. I.E A,B,C,ETC                 }
   </i></font><font color="#FF0000"><b>END</b></font><font color="#000080">;

  </font>FillChar<font color="#000080">(</font>CDControl<font color="#000080">,</font>SizeOf<font color="#000080">(</font>CDControl<font color="#000080">),</font><font color="#800000">#0</font><font color="#000080">);
  </font>CDControl<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">] := </font><font color="#800000">$0A</font><font color="#000080">;           </font><font color="#008000"><i>{ Function to get Audio Disk info.      }
  </i></font>CDIoctl<font color="#000080">(</font>CDRead<font color="#000080">,</font><font color="#800000">6</font><font color="#000080">,</font>CDControl<font color="#000080">);
  </font>Move<font color="#000080">(</font>CDControl<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">],</font>CDInf<font color="#000080">.</font>LoTrack<font color="#000080">,</font><font color="#800000">6</font><font color="#000080">);
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;</font><font color="#008000"><i>{CDInitInfo}

</i></font><font color="#FF0000"><b>FUNCTION </b></font>CDResumePlay <font color="#000080">: </font>BOOLEAN<font color="#000080">;
</font><font color="#008000"><i>{ Routine to Resume playing a previously stopped}
{ audio track.                                  }
</i></font><font color="#FF0000"><b>BEGIN
   </b></font>FillChar<font color="#000080">(</font>CDControl<font color="#000080">,</font>Sizeof<font color="#000080">(</font>CDControl<font color="#000080">),</font><font color="#800000">#0</font><font color="#000080">);
   </font>CDControl<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">] := </font><font color="#800000">5</font><font color="#000080">;             </font><font color="#008000"><i>{ Byte length of request header.        }
   </i></font>CDControl<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">] := </font><font color="#800000">0</font><font color="#000080">;             </font><font color="#008000"><i>{ Sub unit #.                           }
   </i></font>CDControl<font color="#000080">[</font><font color="#800000">2</font><font color="#000080">] := </font><font color="#800000">$88</font><font color="#000080">;           </font><font color="#008000"><i>{ Function to Resume play a CD.         }
   </i></font>DriverRequest<font color="#000080">(</font>CDInf<font color="#000080">.</font>DrvNo<font color="#000080">,</font>CDControl<font color="#000080">);
   </font>CDStatus <font color="#000080">:= </font>CDControl<font color="#000080">[</font><font color="#800000">3</font><font color="#000080">] </font><font color="#FF0000"><b>OR </b></font>CDControl<font color="#000080">[</font><font color="#800000">4</font><font color="#000080">] </font><font color="#FF0000"><b>SHL </b></font><font color="#800000">8</font><font color="#000080">;
   </font>CDResumePlay <font color="#000080">:= (</font>CDStatus <font color="#FF0000"><b>AND </b></font><font color="#800000">$8000</font><font color="#000080">) = </font><font color="#800000">0</font><font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;</font><font color="#008000"><i>{CDResumePlay}

</i></font><font color="#FF0000"><b>FUNCTION </b></font>CDGetPos<font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>PosInf <font color="#000080">: </font>CDPosType <font color="#000080">) : </font>BOOLEAN<font color="#000080">;
</font><font color="#008000"><i>{ Routine to retrieve current position being   }
{ played.                                      }
</i></font><font color="#FF0000"><b>BEGIN
   </b></font>CDControl<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">] := </font><font color="#800000">$0C</font><font color="#000080">;           </font><font color="#008000"><i>{ Function to get Audio Postion info.   }
   </i></font>CDGetPos <font color="#000080">:= </font>CDIoctl<font color="#000080">(</font>CDRead<font color="#000080">,</font><font color="#800000">10</font><font color="#000080">,</font>CDControl<font color="#000080">);
   </font>Move<font color="#000080">(</font>CDControl<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">],</font>PosInf<font color="#000080">,</font><font color="#800000">10</font><font color="#000080">);
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;</font><font color="#008000"><i>{CDGetPos}

</i></font><font color="#FF0000"><b>FUNCTION </b></font>Red2HSG<font color="#000080">(</font>Inf <font color="#000080">: </font>LONGINT <font color="#000080">) : </font>LONGINT<font color="#000080">;
</font><font color="#FF0000"><b>VAR
   </b></font>Temp <font color="#000080">:</font>LONGINT<font color="#000080">;
</font><font color="#FF0000"><b>BEGIN
   </b></font>Temp <font color="#000080">:=        </font>LONGINT<font color="#000080">(( </font>Inf <font color="#FF0000"><b>SHR </b></font><font color="#800000">16 </font><font color="#000080">) </font><font color="#FF0000"><b>AND </b></font><font color="#800000">$FF </font><font color="#000080">)  * </font><font color="#800000">4500</font><font color="#000080">;
   </font>Temp <font color="#000080">:= </font>Temp <font color="#000080">+ </font>LONGINT<font color="#000080">(( </font>Inf <font color="#FF0000"><b>SHR  </b></font><font color="#800000">8 </font><font color="#000080">) </font><font color="#FF0000"><b>AND </b></font><font color="#800000">$FF </font><font color="#000080">)  * </font><font color="#800000">75</font><font color="#000080">;
   </font>Temp <font color="#000080">:= </font>Temp <font color="#000080">+ </font>LONGINT<font color="#000080">(( </font>Inf <font color="#000080">) </font><font color="#FF0000"><b>AND </b></font><font color="#800000">$FF </font><font color="#000080">) ;
   </font>Red2HSG <font color="#000080">:= </font>Temp <font color="#000080">- </font><font color="#800000">2</font><font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;</font><font color="#008000"><i>{Red2HSG}

</i></font><font color="#FF0000"><b>FUNCTION </b></font>CDGetTrackStart<font color="#000080">(</font>Track <font color="#000080">: </font>BYTE <font color="#000080">) : </font>LONGINT<font color="#000080">;
</font><font color="#FF0000"><b>VAR
   </b></font>TrackInf <font color="#000080">:</font><font color="#FF0000"><b>ARRAY</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">6</font><font color="#000080">] </font><font color="#FF0000"><b>OF </b></font>BYTE<font color="#000080">;
   </font>Start    <font color="#000080">:</font>LONGINT<font color="#000080">;
</font><font color="#FF0000"><b>BEGIN
   </b></font>TrackInf<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">] := </font><font color="#800000">$0B</font><font color="#000080">;            </font><font color="#008000"><i>{ Function to get track info.           }
   </i></font>TrackInf<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">] := </font>Track<font color="#000080">;          </font><font color="#008000"><i>{ Track to get information of.          }

   </i></font>CDIoctl<font color="#000080">(</font>CDRead<font color="#000080">,</font><font color="#800000">6</font><font color="#000080">,</font>TrackInf<font color="#000080">);
   </font>Move<font color="#000080">(</font>TrackInf<font color="#000080">[</font><font color="#800000">2</font><font color="#000080">],</font>Start<font color="#000080">,</font><font color="#800000">4</font><font color="#000080">);
   </font>CDGetTrackStart <font color="#000080">:= </font>Red2HSG<font color="#000080">(</font>Start<font color="#000080">);
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;</font><font color="#008000"><i>{CDGetTrackStart}

</i></font><font color="#FF0000"><b>FUNCTION </b></font>CDVolSize <font color="#000080">: </font>LONGINT<font color="#000080">;
</font><font color="#008000"><i>{ Routine to determine the volume size in      }
{ sectors.                                     }
</i></font><font color="#FF0000"><b>VAR
   </b></font>TempLong <font color="#000080">: </font>LONGINT<font color="#000080">;           </font><font color="#008000"><i>{ Holds temporary size info.            }
</i></font><font color="#FF0000"><b>BEGIN
   </b></font>CDControl<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">] := </font><font color="#800000">8</font><font color="#000080">;            </font><font color="#008000"><i>{ Function code to determine volume size.}
   </i></font>CDIoctl<font color="#000080">(</font>CDRead<font color="#000080">,</font><font color="#800000">4</font><font color="#000080">,</font>CDControl<font color="#000080">);  </font><font color="#008000"><i>{ Now get information.                   }
   </i></font>Move<font color="#000080">(</font>CDControl<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">],</font>TempLong<font color="#000080">,</font><font color="#800000">4</font><font color="#000080">);
   </font>CDVolSize <font color="#000080">:= </font>TempLong<font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;</font><font color="#008000"><i>{CDVolSize}

</i></font><font color="#FF0000"><b>FUNCTION </b></font>CDSectSize <font color="#000080">: </font>WORD<font color="#000080">;
</font><font color="#008000"><i>{ Routine to determine the Sector size in      }
{ bytes.                                       }
</i></font><font color="#FF0000"><b>VAR
   </b></font>TempWord <font color="#000080">:</font>WORD<font color="#000080">;              </font><font color="#008000"><i>{ Holds temporary size info.            }
</i></font><font color="#FF0000"><b>BEGIN
   </b></font>CDControl<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">] := </font><font color="#800000">7</font><font color="#000080">;            </font><font color="#008000"><i>{ Function code to determine Sector size.}
   </i></font>CDIoctl<font color="#000080">(</font>CDRead<font color="#000080">,</font><font color="#800000">4</font><font color="#000080">,</font>CDControl<font color="#000080">);  </font><font color="#008000"><i>{ Now get information.                   }
   </i></font>Move<font color="#000080">(</font>CDControl<font color="#000080">[</font><font color="#800000">2</font><font color="#000080">],</font>TempWord<font color="#000080">,</font><font color="#800000">2</font><font color="#000080">);
   </font>CDSectSize <font color="#000080">:= </font>TempWord<font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;</font><font color="#008000"><i>{CDSectSize}

</i></font><font color="#FF0000"><b>FUNCTION </b></font>CDPlayAudio<font color="#000080">(</font>Track <font color="#000080">: </font>BYTE<font color="#000080">;</font>Len <font color="#000080">: </font>LONGINT <font color="#000080">) : </font>BOOLEAN<font color="#000080">;
</font><font color="#FF0000"><b>VAR
   </b></font>TrackStart <font color="#000080">: </font>LONGINT<font color="#000080">;
</font><font color="#FF0000"><b>BEGIN
   </b></font>FillChar<font color="#000080">(</font>CDControl<font color="#000080">,</font>SizeOf<font color="#000080">(</font>CDControl<font color="#000080">),</font><font color="#800000">#0</font><font color="#000080">); </font><font color="#008000"><i>{ Clear Control block.       }
   </i></font>CDControl<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">] := </font><font color="#800000">22</font><font color="#000080">;            </font><font color="#008000"><i>{ Length of request header.             }
   </i></font>CDControl<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">] := </font><font color="#800000">0</font><font color="#000080">;             </font><font color="#008000"><i>{ Zero the sub unit.                    }
   </i></font>CDControl<font color="#000080">[</font><font color="#800000">2</font><font color="#000080">] := </font><font color="#800000">$84</font><font color="#000080">;           </font><font color="#008000"><i>{ Function to play audio.               }
   </i></font>TrackStart <font color="#000080">:= </font>CDGetTrackStart<font color="#000080">(</font>Track<font color="#000080">);
   </font>Move<font color="#000080">(</font>TrackStart<font color="#000080">,</font>CDControl<font color="#000080">[</font><font color="#800000">14</font><font color="#000080">],</font><font color="#800000">4</font><font color="#000080">);
   </font>Move<font color="#000080">(</font>Len<font color="#000080">,</font>CDControl<font color="#000080">[</font><font color="#800000">18</font><font color="#000080">],</font><font color="#800000">4</font><font color="#000080">);     </font><font color="#008000"><i>{ # of sectors to play.                 }
   </i></font>DriverRequest<font color="#000080">(</font>CDInf<font color="#000080">.</font>DrvNo<font color="#000080">,</font>CDControl<font color="#000080">);
   </font>CDStatus <font color="#000080">:= </font>CDControl<font color="#000080">[</font><font color="#800000">3</font><font color="#000080">] </font><font color="#FF0000"><b>OR </b></font>CDControl<font color="#000080">[</font><font color="#800000">4</font><font color="#000080">] </font><font color="#FF0000"><b>SHL </b></font><font color="#800000">8</font><font color="#000080">;
   </font>CDPlayAudio <font color="#000080">:= (</font>CDStatus <font color="#FF0000"><b>AND </b></font><font color="#800000">$8000</font><font color="#000080">) = </font><font color="#800000">0</font><font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;</font><font color="#008000"><i>{CDPlayAudio}

{$F+}
</i></font><font color="#FF0000"><b>PROCEDURE </b></font>CDExit<font color="#000080">;
</font><font color="#008000"><i>{ Our Exiting routine to clean up after our    }
{ selves.                                      }
</i></font><font color="#FF0000"><b>BEGIN
   </b></font>ExitProc <font color="#000080">:= </font>OldExit<font color="#000080">;           </font><font color="#008000"><i>{ Restore original exit procedure.      }
   </i></font>CDCloseHandle<font color="#000080">;                 </font><font color="#008000"><i>{ Close the handle for the CD Driver.   }
</i></font><font color="#FF0000"><b>END</b></font><font color="#000080">;
</font><font color="#008000"><i>{$F-}

</i></font><font color="#FF0000"><b>BEGIN

   </b></font>CDDriver <font color="#000080">:= </font>GetDriverName<font color="#000080">;
   </font>CDHandle <font color="#000080">:= </font>CDGetHandle<font color="#000080">;
   </font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>CDHandle <font color="#000080">&lt;&gt; </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>THEN
   BEGIN
      </b></font>CDInitInfo<font color="#000080">;
      </font>OldExit <font color="#000080">:= </font>ExitProc<font color="#000080">;
      </font>ExitProc <font color="#000080">:= @</font>CDExit<font color="#000080">;
   </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">.</font><font color="#008000"><i>{CDRom}
</i></font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to SOUND SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0083.PAS">Original</a><b>]</b></p></body>
</html>
