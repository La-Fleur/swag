<html>
<head><title> "Writing to the MPU" by GERHARD DALENOORT</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to SOUND SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0068.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
At least after a months search, I found a source to acces a MPU-401 type
interface on a SoundBlaster (compatible) card... The source was kind a
spaghetti but I managed to destill the main components...

The original procs lost some bytes on the way from the MPU thru the procs
and bufs to your var. The original though included command modes for the
MPU's UART. For the complete source of the MFC/MPU unit please mail me..

here're the basic procs to get and write a byte to MIDI...
the original was about 1300 lines so....
}

</i></font><font color="#FF0000"><b>Program </b></font>Just_A_Small_One_To_ShowOff_MPU_use<font color="#000080">;

</font><font color="#FF0000"><b>Const
  </b></font>DataPort   <font color="#000080">= </font><font color="#800000">$330</font><font color="#000080">;
  </font>StatusPort <font color="#000080">= </font>DataPort <font color="#000080">+ </font><font color="#800000">1</font><font color="#000080">;
  </font>cmd_uart   <font color="#000080">= </font><font color="#800000">$3f</font><font color="#000080">;                      </font><font color="#008000"><i>{Basic serial i/o mode}
  </i></font>cmd_reset  <font color="#000080">= </font><font color="#800000">$ff</font><font color="#000080">;                      </font><font color="#008000"><i>{Reset MPU}

</i></font><font color="#FF0000"><b>Function </b></font>MPUread <font color="#000080">: </font>Boolean<font color="#000080">;  </font><font color="#008000"><i>{ MPU is ready to let READ a byte FROM MIDI }
 </i></font><font color="#FF0000"><b>begin </b></font>MPUread<font color="#000080">:= (</font>Port<font color="#000080">[</font>StatusPort<font color="#000080">] </font><font color="#FF0000"><b>and </b></font><font color="#800000">$80</font><font color="#000080">) = </font><font color="#800000">0</font><font color="#000080">; </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#008000"><i>{ Q: Should I make this: Repeat until Port.. and $80=0, or is this fine ??}

</i></font><font color="#FF0000"><b>Function </b></font>MPUwrite <font color="#000080">: </font>Boolean<font color="#000080">;  </font><font color="#008000"><i>{ MPU is ready to let WRITE a byte TO MIDI }
 </i></font><font color="#FF0000"><b>begin </b></font>MPUwrite<font color="#000080">:= (</font>port<font color="#000080">[</font>StatusPort<font color="#000080">] </font><font color="#FF0000"><b>and </b></font><font color="#800000">$40</font><font color="#000080">) = </font><font color="#800000">0</font><font color="#000080">; </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>SendNoteOn<font color="#000080">( </font>MidiChannel<font color="#000080">, </font>Note<font color="#000080">, </font>Velocity <font color="#000080">: </font>Integer<font color="#000080">);
</font><font color="#008000"><i>{ Sends NoteOn on MidiChannel 0..15, Velocity 0 is noteOff  }
</i></font><font color="#FF0000"><b>begin
 if </b></font>MPUwrite <font color="#FF0000"><b>then </b></font>Port<font color="#000080">[</font>DataPort<font color="#000080">]:=</font><font color="#800000">$90</font><font color="#000080">+ </font>MidiChannel<font color="#000080">;
 </font><font color="#FF0000"><b>if </b></font>MPUwrite <font color="#FF0000"><b>then </b></font>Port<font color="#000080">[</font>DataPort<font color="#000080">]:=</font>Note<font color="#000080">;
 </font><font color="#FF0000"><b>if </b></font>MPUwrite <font color="#FF0000"><b>then </b></font>Port<font color="#000080">[</font>DataPort<font color="#000080">]:=</font>velocity<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>KeyPressed <font color="#000080">: </font>Boolean<font color="#000080">; </font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Asm  </b></font><font color="#FF00FF">mov ah, 01h;int 16h;mov ax, 00h;jz @1;inc ax;@1:;</font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{Tnx to the SWAG}

</i></font><font color="#FF0000"><b>Var
  </b></font>X <font color="#000080">: </font>Integer<font color="#000080">;

</font><font color="#FF0000"><b>begin
 </b></font>Port<font color="#000080">[</font>StatusPort<font color="#000080">]:=</font>Cmd_reset<font color="#000080">;  </font><font color="#008000"><i>{ Initialization }
 </i></font>Port<font color="#000080">[</font>StatusPort<font color="#000080">]:=</font>Cmd_uart<font color="#000080">;   </font><font color="#008000"><i>{ of the MPU-type Interface }

 </i></font><font color="#FF0000"><b>repeat
  </b></font><font color="#008000"><i>{A SoftWare MIDI-THRU function }
    </i></font><font color="#FF0000"><b>If </b></font>MPUread <font color="#FF0000"><b>then            </b></font><font color="#008000"><i>{Ready to Read}
    </i></font><font color="#FF0000"><b>begin
       </b></font>X<font color="#000080">:=</font>Port<font color="#000080">[</font>DataPort<font color="#000080">];      </font><font color="#008000"><i>{Read Byte}
       </i></font><font color="#FF0000"><b>if </b></font>MPUwrite <font color="#FF0000"><b>then        </b></font><font color="#008000"><i>{Ready To Write}
            </i></font>Port<font color="#000080">[</font>DataPort<font color="#000080">]:=</font>X<font color="#000080">; </font><font color="#008000"><i>{Write the byte}
       </i></font>WriteLn<font color="#000080">(</font>X<font color="#000080">);             </font><font color="#008000"><i>{see what past the MPU-401 Type o' interface}
    </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;
 </font><font color="#FF0000"><b>until </b></font>KeyPressed<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to SOUND SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0068.PAS">Original</a><b>]</b></p></body>
</html>
