<html>
<head><title> "Playing Digital sounds" by TAPIO AIJALA</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to SOUND SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0061.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
Hi!

MA&gt; 4.  I have all my GUS routines working, but can anyone point me to
MA&gt;     a place where I can get ANY *PUBLIC DOMAIN* SB/SBPro code which
MA&gt;     would help me play/mix digital samples?  (I'm not talking
MA&gt;     CT-VOICE VOC code here...).
MA&gt;
MA&gt; As I said, ANY help would be appreciated.

Here you are! This piece of code try to show how to play digitized voices
through Sound Blaster. It's from our little SB's Programming Tutorial which
is PD, so be free to distribute it freely!
}
</i></font><font color="#FF0000"><b>Program </b></font>SBPlay<font color="#000080">;

</font><font color="#008000"><i>{------------------------------------
 SB compatible digital sound routines

      Copyright Tapio Žij„l„ 1994.

     Use and distribute freely, but
    please notice me in somewhere on
     your product if you use these
               routines!

                Thanks.
 ------------------------------------}

</i></font><font color="#FF0000"><b>Uses </b></font>crt<font color="#000080">;

</font><font color="#FF0000"><b>Const </b></font>DmaChannel                                <font color="#000080">: </font><font color="#FF0000"><b>Array </b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">3</font><font color="#000080">,</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">3</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Byte <font color="#000080">=

((</font><font color="#800000">$87</font><font color="#000080">,</font><font color="#800000">$0</font><font color="#000080">,</font><font color="#800000">$1</font><font color="#000080">),(</font><font color="#800000">$83</font><font color="#000080">,</font><font color="#800000">$2</font><font color="#000080">,</font><font color="#800000">$3</font><font color="#000080">),(</font><font color="#800000">$81</font><font color="#000080">,</font><font color="#800000">$2</font><font color="#000080">,</font><font color="#800000">$3</font><font color="#000080">),(</font><font color="#800000">$82</font><font color="#000080">,</font><font color="#800000">$6</font><font color="#000080">,</font><font color="#800000">$7</font><font color="#000080">));
</font><font color="#FF0000"><b>Var   </b></font>Reset<font color="#000080">, </font>ReadData<font color="#000080">, </font>WriteData<font color="#000080">, </font>DataAvailable <font color="#000080">: </font>Word<font color="#000080">;
      </font>Offset<font color="#000080">, </font>Page                              <font color="#000080">: </font>Word<font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>InitSoundSystem<font color="#000080">(</font>Base <font color="#000080">: </font>Word<font color="#000080">) : </font>Byte<font color="#000080">;

</font><font color="#008000"><i>{Check out Sound Blaster from given base address}

</i></font><font color="#FF0000"><b>Begin
 </b></font>InitSoundSystem <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;
 </font>Base <font color="#000080">:= </font>Base <font color="#000080">* </font><font color="#800000">$10</font><font color="#000080">;
 </font>Reset <font color="#000080">:= </font>Base <font color="#000080">+ </font><font color="#800000">$206</font><font color="#000080">;
 </font>ReadData <font color="#000080">:= </font>Base <font color="#000080">+ </font><font color="#800000">$20A</font><font color="#000080">;
 </font>WriteData <font color="#000080">:= </font>Base <font color="#000080">+ </font><font color="#800000">$20C</font><font color="#000080">;
 </font>DataAvailable <font color="#000080">:= </font>Base <font color="#000080">+ </font><font color="#800000">$20E</font><font color="#000080">;
 </font>Port<font color="#000080">[</font>Reset<font color="#000080">] := </font><font color="#800000">1</font><font color="#000080">;
 </font>Delay<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">);
 </font>Port<font color="#000080">[</font>Reset<font color="#000080">] := </font><font color="#800000">0</font><font color="#000080">;
 </font>Delay<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">);
 </font><font color="#FF0000"><b>If </b></font><font color="#000080">(</font>Port<font color="#000080">[</font>DataAvailable<font color="#000080">] </font><font color="#FF0000"><b>And </b></font><font color="#800000">$80 </font><font color="#000080">= </font><font color="#800000">$80</font><font color="#000080">) </font><font color="#FF0000"><b>And </b></font><font color="#000080">(</font>Port<font color="#000080">[</font>ReadData<font color="#000080">] = </font><font color="#800000">$AA</font><font color="#000080">) </font><font color="#FF0000"><b>then Begin
  </b></font>InitSoundSystem <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
 </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>WriteDSP<font color="#000080">(</font>Data <font color="#000080">: </font>Byte<font color="#000080">);

</font><font color="#008000"><i>{Write a one byte to DSP.}

</i></font><font color="#FF0000"><b>Begin
 While </b></font>Port<font color="#000080">[</font>WriteData<font color="#000080">] </font><font color="#FF0000"><b>And </b></font><font color="#800000">$80 </font><font color="#000080">&lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>Do</b></font><font color="#000080">;
 </font>Port<font color="#000080">[</font>WriteData<font color="#000080">] := </font>Data<font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>ReadDSP <font color="#000080">: </font>Byte<font color="#000080">;

</font><font color="#008000"><i>{Read a one byte from DSP.}

</i></font><font color="#FF0000"><b>Begin
 While </b></font>Port<font color="#000080">[</font>DataAvailable<font color="#000080">] </font><font color="#FF0000"><b>And </b></font><font color="#800000">$80 </font><font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>Do</b></font><font color="#000080">;
 </font>ReadDSP <font color="#000080">:= </font>Port<font color="#000080">[</font>ReadData<font color="#000080">];
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>SpeakerOn<font color="#000080">;

</font><font color="#008000"><i>{Send sound to line output.}

</i></font><font color="#FF0000"><b>Begin
 </b></font>WriteDSP<font color="#000080">(</font><font color="#800000">$D1</font><font color="#000080">);
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>SpeakerOff<font color="#000080">;

</font><font color="#008000"><i>{Don't send anything to line output. Playing will continue, but you don't
 hear anything!}

</i></font><font color="#FF0000"><b>Begin
 </b></font>WriteDSP<font color="#000080">(</font><font color="#800000">$D3</font><font color="#000080">);
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>DMAStop<font color="#000080">;

</font><font color="#008000"><i>{Stop DMA-transfer}

</i></font><font color="#FF0000"><b>Begin
 </b></font>WriteDSP<font color="#000080">(</font><font color="#800000">$D0</font><font color="#000080">);
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>DMAContinue<font color="#000080">;

</font><font color="#008000"><i>{Continue DMA-transfer}

</i></font><font color="#FF0000"><b>Begin
 </b></font>WriteDSP<font color="#000080">(</font><font color="#800000">$D4</font><font color="#000080">);
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>PlaySample<font color="#000080">(</font>Sample <font color="#000080">: </font>Pointer<font color="#000080">; </font>Size <font color="#000080">: </font>Word<font color="#000080">; </font>Freq <font color="#000080">: </font>Word<font color="#000080">; </font>DMACh <font color="#000080">: </font>Byte<font color="#000080">);

</font><font color="#008000"><i>{Play data from pointer sample through SB:

 Size           Size of data block (Max. 64 Kb in one time!)
 Freq           Sampling rate in herts
 DMACh          Number of DMA-channel (0-3)}

</i></font><font color="#FF0000"><b>Begin
 </b></font>SpeakerOn<font color="#000080">;
 </font>Dec<font color="#000080">(</font>Size<font color="#000080">);
 </font>Offset <font color="#000080">:= </font>Seg<font color="#000080">(</font>Sample<font color="#000080">^) </font><font color="#FF0000"><b>Shl </b></font><font color="#800000">4 </font><font color="#000080">+ </font>Ofs<font color="#000080">(</font>Sample<font color="#000080">^);
 </font>Page <font color="#000080">:= (</font>Seg<font color="#000080">(</font>Sample<font color="#000080">^) + </font>Ofs<font color="#000080">(</font>Sample<font color="#000080">^) </font><font color="#FF0000"><b>Shr </b></font><font color="#800000">4</font><font color="#000080">) </font><font color="#FF0000"><b>Shr </b></font><font color="#800000">12</font><font color="#000080">;
 </font>Port<font color="#000080">[</font><font color="#800000">$0A</font><font color="#000080">] := </font><font color="#800000">$4 </font><font color="#000080">+ </font>DMACh<font color="#000080">;
 </font>Port<font color="#000080">[</font><font color="#800000">$0C</font><font color="#000080">] := </font><font color="#800000">0</font><font color="#000080">; </font><font color="#008000"><i>{Clear the internal DMA flip-flop}
 </i></font>Port<font color="#000080">[</font><font color="#800000">$0B</font><font color="#000080">] := </font><font color="#800000">$48 </font><font color="#000080">+ </font>DMACh<font color="#000080">;
 </font>Port<font color="#000080">[</font>DMAChannel<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">2</font><font color="#000080">]] := </font>Lo<font color="#000080">(</font>Offset<font color="#000080">);
 </font>Port<font color="#000080">[</font>DMAChannel<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">2</font><font color="#000080">]] := </font>Hi<font color="#000080">(</font>Offset<font color="#000080">);
 </font>Port<font color="#000080">[</font>DMAChannel<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">1</font><font color="#000080">]] := </font>Page<font color="#000080">;
 </font>Port<font color="#000080">[</font>DMAChannel<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">3</font><font color="#000080">]] := </font>Lo<font color="#000080">(</font>Size<font color="#000080">);
 </font>Port<font color="#000080">[</font>DMAChannel<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">3</font><font color="#000080">]] := </font>Hi<font color="#000080">(</font>Size<font color="#000080">);
 </font>Port<font color="#000080">[</font><font color="#800000">$0A</font><font color="#000080">] := </font>DMACh<font color="#000080">;
 </font>WriteDSP<font color="#000080">(</font><font color="#800000">$40</font><font color="#000080">);
 </font>WriteDSP<font color="#000080">(</font><font color="#800000">256 </font><font color="#000080">- </font><font color="#800000">1000000 </font><font color="#FF0000"><b>Div </b></font>Freq<font color="#000080">);
 </font>WriteDSP<font color="#000080">(</font><font color="#800000">$14</font><font color="#000080">);
 </font>WriteDSP<font color="#000080">(</font>Lo<font color="#000080">(</font>Size<font color="#000080">));
 </font>WriteDSP<font color="#000080">(</font>Hi<font color="#000080">(</font>Size<font color="#000080">));
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Begin
 If </b></font>InitSoundSystem<font color="#000080">(</font><font color="#800000">$2</font><font color="#000080">) &lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>Writeln<font color="#000080">(</font><font color="#800000">'Error in initializing soundcard!'</font><font color="#000080">);
</font><font color="#008000"><i>{Check out for SB in give base address!}
</i></font>PlaySample<font color="#000080">(</font>Ptr<font color="#000080">(</font><font color="#800000">$B800</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">),</font><font color="#800000">65535</font><font color="#000080">,</font><font color="#800000">14000</font><font color="#000080">,</font><font color="#800000">1</font><font color="#000080">); </font><font color="#008000"><i>{Plays data from video memory through
SB!}</i></font><font color="#FF0000"><b>End</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to SOUND SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0061.PAS">Original</a><b>]</b></p></body>
</html>
