<html>
<head><title> "Re: WAV play" by HANS OBERMUELLER</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to SOUND SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0081.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
NB&gt; DOes anyone have Source code to play WAV files in Turbo Pascal 7.0?
Try this. It won't work on a SB16, but on nearly all cheap 16-bit-cards.
I took it from the german PASCAL echo (PASCAL.GER).
{from: BOMMER@MULTICOM.mc.org (Andree Borrmann)}

</i></font><font color="#FF0000"><b>Program </b></font>ABo_WAV<font color="#000080">;
</font><font color="#008000"><i>{$M 4096,0,65500}
</i></font><font color="#FF0000"><b>Uses </b></font>DOS<font color="#000080">,</font>Crt<font color="#000080">;

</font><font color="#FF0000"><b>Const </b></font>dma    <font color="#000080">= </font><font color="#800000">4096</font><font color="#000080">;
</font><font color="#FF0000"><b>Type  </b></font>id_t   <font color="#000080">= </font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">4</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Char<font color="#000080">;
      </font>riff_t <font color="#000080">= </font><font color="#FF0000"><b>Record
                </b></font>R_Ident <font color="#000080">: </font>id_t<font color="#000080">;
                </font>length  <font color="#000080">: </font>Longint<font color="#000080">;
                </font>C_Ident <font color="#000080">: </font>id_t<font color="#000080">;
                </font>S_Ident <font color="#000080">: </font>id_t<font color="#000080">;
                </font>s_length<font color="#000080">: </font>Longint<font color="#000080">;
                </font>Format  <font color="#000080">,
                </font>Modus   <font color="#000080">: </font>Word<font color="#000080">;
                </font>freq    <font color="#000080">,
                </font>byte_p_s<font color="#000080">: </font>LongInt<font color="#000080">;
                </font>byte_sam<font color="#000080">,
                </font>bit_sam <font color="#000080">: </font>Word<font color="#000080">;
                </font>D_Ident <font color="#000080">: </font>id_t<font color="#000080">;
                </font>d_length<font color="#000080">: </font>LongInt<font color="#000080">;
              </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
      </font>blaster_T <font color="#000080">= </font><font color="#FF0000"><b>Record
                    </b></font>port <font color="#000080">: </font>Word<font color="#000080">;
                    </font>dmac <font color="#000080">,
                    </font>hdmac<font color="#000080">,
                    </font>irq  <font color="#000080">: </font>Byte<font color="#000080">;
                  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
      </font>buffer_T <font color="#000080">= </font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font>dma<font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Byte<font color="#000080">;

</font><font color="#FF0000"><b>Var </b></font>id       <font color="#000080">: </font>riff_T<font color="#000080">;
    </font>fn       <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
    </font>wav      <font color="#000080">: </font><font color="#FF0000"><b>File</b></font><font color="#000080">;
    </font>sbb      <font color="#000080">: </font>Word<font color="#000080">;
    </font>Ende     <font color="#000080">: </font>Boolean<font color="#000080">;
    </font>blaster  <font color="#000080">: </font>Blaster_T<font color="#000080">;
    </font>alt_irq  <font color="#000080">: </font>Pointer<font color="#000080">;
    </font>dma_buf_1<font color="#000080">,
    </font>dma_buf_2<font color="#000080">,
    </font>zwi      <font color="#000080">: ^</font>Buffer_T<font color="#000080">;
    </font>Channel  <font color="#000080">: </font>Byte<font color="#000080">;

</font><font color="#FF0000"><b>Const </b></font>RIFF <font color="#000080">: </font>id_t <font color="#000080">= (</font><font color="#800000">'R'</font><font color="#000080">,</font><font color="#800000">'I'</font><font color="#000080">,</font><font color="#800000">'F'</font><font color="#000080">,</font><font color="#800000">'F'</font><font color="#000080">);
      </font>WAVE <font color="#000080">: </font>id_t <font color="#000080">= (</font><font color="#800000">'W'</font><font color="#000080">,</font><font color="#800000">'A'</font><font color="#000080">,</font><font color="#800000">'V'</font><font color="#000080">,</font><font color="#800000">'E'</font><font color="#000080">);
      </font>FMT_ <font color="#000080">: </font>id_t <font color="#000080">= (</font><font color="#800000">'f'</font><font color="#000080">,</font><font color="#800000">'m'</font><font color="#000080">,</font><font color="#800000">'t'</font><font color="#000080">,</font><font color="#800000">' '</font><font color="#000080">);
      </font>DATA <font color="#000080">: </font>id_t <font color="#000080">= (</font><font color="#800000">'d'</font><font color="#000080">,</font><font color="#800000">'a'</font><font color="#000080">,</font><font color="#800000">'t'</font><font color="#000080">,</font><font color="#800000">'a'</font><font color="#000080">);

      </font>DMA_Dat <font color="#000080">: </font><font color="#FF0000"><b>Array </b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">7</font><font color="#000080">,</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">6</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Byte<font color="#000080">=
                  ((</font><font color="#800000">$A</font><font color="#000080">,</font><font color="#800000">$C</font><font color="#000080">,</font><font color="#800000">$B</font><font color="#000080">,</font><font color="#800000">$0</font><font color="#000080">,</font><font color="#800000">$87</font><font color="#000080">,</font><font color="#800000">$1</font><font color="#000080">),
                   (</font><font color="#800000">$A</font><font color="#000080">,</font><font color="#800000">$C</font><font color="#000080">,</font><font color="#800000">$B</font><font color="#000080">,</font><font color="#800000">$2</font><font color="#000080">,</font><font color="#800000">$83</font><font color="#000080">,</font><font color="#800000">$3</font><font color="#000080">),
                   (</font><font color="#800000">$A</font><font color="#000080">,</font><font color="#800000">$C</font><font color="#000080">,</font><font color="#800000">$B</font><font color="#000080">,</font><font color="#800000">$4</font><font color="#000080">,</font><font color="#800000">$81</font><font color="#000080">,</font><font color="#800000">$5</font><font color="#000080">),
                   (</font><font color="#800000">$A</font><font color="#000080">,</font><font color="#800000">$C</font><font color="#000080">,</font><font color="#800000">$B</font><font color="#000080">,</font><font color="#800000">$6</font><font color="#000080">,</font><font color="#800000">$82</font><font color="#000080">,</font><font color="#800000">$7</font><font color="#000080">),
                   (</font><font color="#800000">$D4</font><font color="#000080">,</font><font color="#800000">$D8</font><font color="#000080">,</font><font color="#800000">$D6</font><font color="#000080">,</font><font color="#800000">$C0</font><font color="#000080">,</font><font color="#800000">$8F</font><font color="#000080">,</font><font color="#800000">$C2</font><font color="#000080">),
                   (</font><font color="#800000">$D4</font><font color="#000080">,</font><font color="#800000">$D8</font><font color="#000080">,</font><font color="#800000">$D6</font><font color="#000080">,</font><font color="#800000">$C4</font><font color="#000080">,</font><font color="#800000">$8B</font><font color="#000080">,</font><font color="#800000">$C6</font><font color="#000080">),
                   (</font><font color="#800000">$D4</font><font color="#000080">,</font><font color="#800000">$D8</font><font color="#000080">,</font><font color="#800000">$D6</font><font color="#000080">,</font><font color="#800000">$C8</font><font color="#000080">,</font><font color="#800000">$89</font><font color="#000080">,</font><font color="#800000">$CA</font><font color="#000080">),
                   (</font><font color="#800000">$D4</font><font color="#000080">,</font><font color="#800000">$D8</font><font color="#000080">,</font><font color="#800000">$D6</font><font color="#000080">,</font><font color="#800000">$CC</font><font color="#000080">,</font><font color="#800000">$8A</font><font color="#000080">,</font><font color="#800000">$CE</font><font color="#000080">));

</font><font color="#FF0000"><b>Procedure </b></font>Blaster_Command<font color="#000080">(</font>c <font color="#000080">:</font>Byte<font color="#000080">); </font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Asm
    </b></font><font color="#FF00FF">Mov dx,Word Ptr sbb
    Add dx,$c
 @t:In al,dx
    And al,128
    Jnz @t
    Mov al,c
    Out dx,al
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>Init_SB<font color="#000080">(</font>base <font color="#000080">: </font>Word<font color="#000080">);
</font><font color="#FF0000"><b>Var </b></font>w<font color="#000080">,</font>w2<font color="#000080">:</font>Word<font color="#000080">;
</font><font color="#FF0000"><b>Begin
  </b></font>sbb<font color="#000080">:=</font>base<font color="#000080">;
  </font>Port<font color="#000080">[</font>base<font color="#000080">+</font><font color="#800000">6</font><font color="#000080">]:=</font><font color="#800000">1</font><font color="#000080">; </font>Delay<font color="#000080">(</font><font color="#800000">4</font><font color="#000080">); </font>Port<font color="#000080">[</font>base<font color="#000080">+</font><font color="#800000">6</font><font color="#000080">]:=</font><font color="#800000">0</font><font color="#000080">; </font>w<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">; </font>w2<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
  </font><font color="#FF0000"><b>Repeat
    Repeat </b></font>Inc<font color="#000080">(</font>w<font color="#000080">); </font><font color="#FF0000"><b>Until </b></font><font color="#000080">((</font>Port<font color="#000080">[</font>base<font color="#000080">+</font><font color="#800000">$e</font><font color="#000080">] </font><font color="#FF0000"><b>and </b></font><font color="#800000">128</font><font color="#000080">)=</font><font color="#800000">128</font><font color="#000080">) </font><font color="#FF0000"><b>or </b></font><font color="#000080">(</font>w<font color="#000080">&gt;</font><font color="#800000">29</font><font color="#000080">);
    </font>Inc<font color="#000080">(</font>w2<font color="#000080">);
  </font><font color="#FF0000"><b>Until </b></font><font color="#000080">(</font>Port<font color="#000080">[</font>base<font color="#000080">+</font><font color="#800000">$a</font><font color="#000080">]=</font><font color="#800000">$AA</font><font color="#000080">) </font><font color="#FF0000"><b>or </b></font><font color="#000080">(</font>W2<font color="#000080">&gt;</font><font color="#800000">30</font><font color="#000080">);
  </font><font color="#FF0000"><b>If </b></font>w2<font color="#000080">&gt;</font><font color="#800000">30 </font><font color="#FF0000"><b>then
    Begin
      </b></font>WriteLn<font color="#000080">(</font><font color="#800000">'Failed to ReSet Blaster'</font><font color="#000080">);
      </font>Halt<font color="#000080">(</font><font color="#800000">128</font><font color="#000080">);
    </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
  </font>Blaster_Command<font color="#000080">(</font><font color="#800000">$d1</font><font color="#000080">);
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>Set_Stereo<font color="#000080">; </font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Asm
  </b></font><font color="#FF00FF">Mov dx,Word Ptr sbb
  Add dx,$4
  Mov al,$e
  Out dx,al
  Inc dx
  In al,dx
  And al,253
  Or al,2
  Out dx,al
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>Clear_Stereo<font color="#000080">; </font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Asm
  </b></font><font color="#FF00FF">Mov dx,Word Ptr sbb
  Add dx,$4
  Mov al,$e
  Out dx,al
  Inc dx
  In al,dx
  And al,253
  Out dx,al
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>No_Wave<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>id<font color="#000080">:</font>riff_T<font color="#000080">):</font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>Begin
  With </b></font>id <font color="#FF0000"><b>do
    </b></font>No_Wave<font color="#000080">:=(</font>R_Ident<font color="#000080">&lt;&gt;</font>RIFF<font color="#000080">) </font><font color="#FF0000"><b>or
             </b></font><font color="#000080">(</font>C_Ident<font color="#000080">&lt;&gt;</font>WAVE<font color="#000080">) </font><font color="#FF0000"><b>or
             </b></font><font color="#000080">(</font>S_Ident<font color="#000080">&lt;&gt;</font>FMT_<font color="#000080">) </font><font color="#FF0000"><b>or
             </b></font><font color="#000080">(</font>D_Ident<font color="#000080">&lt;&gt;</font>DATA<font color="#000080">);
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>Init<font color="#000080">;
</font><font color="#FF0000"><b>Var </b></font>b <font color="#000080">: </font>Byte<font color="#000080">;
</font><font color="#FF0000"><b>Begin
  </b></font>WriteLn<font color="#000080">;
  </font>WriteLn<font color="#000080">(</font><font color="#800000">'ABo WAV-Player (16bit Test)      (p) 27.11.94 ABo'</font><font color="#000080">);
  </font>Blaster<font color="#000080">.</font>Port<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
  </font>Blaster<font color="#000080">.</font>dmac<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
  </font>Blaster<font color="#000080">.</font>hdmac<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
  </font>Blaster<font color="#000080">.</font>irq<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
  </font>fn<font color="#000080">:=</font>GetEnv<font color="#000080">(</font><font color="#800000">'BLASTER'</font><font color="#000080">);
  </font><font color="#FF0000"><b>If </b></font>fn<font color="#000080">=</font><font color="#800000">'' </font><font color="#FF0000"><b>then
    Begin
      </b></font>WriteLn<font color="#000080">(</font><font color="#800000">'BLASTER must be set...'</font><font color="#000080">);
      </font>Halt<font color="#000080">(</font><font color="#800000">100</font><font color="#000080">);
    </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
  </font>b<font color="#000080">:=</font><font color="#800000">1</font><font color="#000080">;
  </font><font color="#FF0000"><b>Repeat
    Case </b></font>fn<font color="#000080">[</font>b<font color="#000080">] </font><font color="#FF0000"><b>of
      </b></font><font color="#800000">'A' </font><font color="#000080">: </font><font color="#FF0000"><b>Repeat
              </b></font>Inc<font color="#000080">(</font>b<font color="#000080">);
              </font>Blaster<font color="#000080">.</font>Port<font color="#000080">:=</font>Blaster<font color="#000080">.</font>Port<font color="#000080">*</font><font color="#800000">16</font><font color="#000080">+</font>Ord<font color="#000080">(</font>fn<font color="#000080">[</font>b<font color="#000080">])-</font><font color="#800000">48</font><font color="#000080">;
            </font><font color="#FF0000"><b>Until </b></font>Fn<font color="#000080">[</font>b<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">]=</font><font color="#800000">' '</font><font color="#000080">;
      </font><font color="#800000">'D' </font><font color="#000080">: </font><font color="#FF0000"><b>Begin
              </b></font>Blaster<font color="#000080">.</font>DMAc<font color="#000080">:=</font>Ord<font color="#000080">(</font>fn<font color="#000080">[</font>b<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">])-</font><font color="#800000">48</font><font color="#000080">;
              </font>Inc<font color="#000080">(</font>b<font color="#000080">,</font><font color="#800000">2</font><font color="#000080">);
            </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
      </font><font color="#800000">'I' </font><font color="#000080">: </font><font color="#FF0000"><b>Repeat
              </b></font>Inc<font color="#000080">(</font>b<font color="#000080">);
              </font>Blaster<font color="#000080">.</font>IRQ<font color="#000080">:=</font>Blaster<font color="#000080">.</font>IRQ<font color="#000080">*</font><font color="#800000">16</font><font color="#000080">+</font>Ord<font color="#000080">(</font>fn<font color="#000080">[</font>b<font color="#000080">])-</font><font color="#800000">48</font><font color="#000080">;
            </font><font color="#FF0000"><b>Until </b></font>Fn<font color="#000080">[</font>b<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">]=</font><font color="#800000">' '</font><font color="#000080">;
      </font><font color="#800000">'H' </font><font color="#000080">: </font><font color="#FF0000"><b>Begin
              </b></font>Blaster<font color="#000080">.</font>hDMAc<font color="#000080">:=</font>Ord<font color="#000080">(</font>fn<font color="#000080">[</font>b<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">])-</font><font color="#800000">48</font><font color="#000080">;
              </font>Inc<font color="#000080">(</font>b<font color="#000080">,</font><font color="#800000">2</font><font color="#000080">);
            </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
        </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
    </font>Inc<font color="#000080">(</font>b<font color="#000080">);
  </font><font color="#FF0000"><b>Until </b></font>b<font color="#000080">&gt;</font>Length<font color="#000080">(</font>fn<font color="#000080">);
  </font><font color="#FF0000"><b>With </b></font>Blaster <font color="#FF0000"><b>do
    </b></font>WriteLn<font color="#000080">(</font><font color="#800000">'Blaster : P'</font><font color="#000080">,</font>Port<font color="#000080">,</font><font color="#800000">'  I'</font><font color="#000080">,</font>irq<font color="#000080">,</font><font color="#800000">'  D'</font><font color="#000080">,</font>dmac<font color="#000080">,</font><font color="#800000">'  H'</font><font color="#000080">,</font>hdmac<font color="#000080">);
  </font>Init_SB<font color="#000080">(</font>Blaster<font color="#000080">.</font>Port<font color="#000080">);
  </font><font color="#FF0000"><b>If </b></font>ParamCount<font color="#000080">&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>then
    </b></font>fn<font color="#000080">:=</font>ParamStr<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">)
  </font><font color="#FF0000"><b>Else
    Begin
      </b></font>Write<font color="#000080">(</font><font color="#800000">'WAV-File: '</font><font color="#000080">);
      </font>ReadLn<font color="#000080">(</font>fn<font color="#000080">);
    </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
  </font>Assign<font color="#000080">(</font>wav<font color="#000080">,</font>fN<font color="#000080">);
  </font><font color="#008000"><i>{$I-} </i></font>ReSet<font color="#000080">(</font>wav<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">); </font><font color="#008000"><i>{$I+}
  </i></font><font color="#FF0000"><b>If </b></font>IOResult<font color="#000080">&lt;&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>then
    Begin
      </b></font>WriteLn<font color="#000080">(</font><font color="#800000">'File &quot;'</font><font color="#000080">,</font>fn<font color="#000080">,</font><font color="#800000">'&quot; not found!'</font><font color="#000080">);
      </font>Halt<font color="#000080">(</font><font color="#800000">2</font><font color="#000080">);
    </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
  </font>BlockRead<font color="#000080">(</font>wav<font color="#000080">,</font>id<font color="#000080">,</font>Sizeof<font color="#000080">(</font>id<font color="#000080">));
  </font><font color="#FF0000"><b>If </b></font>no_Wave<font color="#000080">(</font>id<font color="#000080">) </font><font color="#FF0000"><b>then
    Begin
      </b></font>WriteLn<font color="#000080">(</font><font color="#800000">'&quot;'</font><font color="#000080">,</font>fn<font color="#000080">,</font><font color="#800000">'&quot; seems to be no WAVE-File...'</font><font color="#000080">);
      </font>Halt<font color="#000080">(</font><font color="#800000">128</font><font color="#000080">);
    </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
  </font>Write<font color="#000080">(</font><font color="#800000">'Wave    : '</font><font color="#000080">,</font>id<font color="#000080">.</font>bit_sam<font color="#000080">,</font><font color="#800000">'bit '</font><font color="#000080">);
  </font><font color="#FF0000"><b>If </b></font>id<font color="#000080">.</font>Modus<font color="#000080">=</font><font color="#800000">2 </font><font color="#FF0000"><b>then
    Begin
      </b></font>Set_Stereo<font color="#000080">;
      </font>Write<font color="#000080">(</font><font color="#800000">'stereo '</font><font color="#000080">);
    </font><font color="#FF0000"><b>End
  Else
    Begin
      </b></font>Clear_Stereo<font color="#000080">;
      </font>Write<font color="#000080">(</font><font color="#800000">'mono    '</font><font color="#000080">);
    </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>If </b></font><font color="#000080">(</font>id<font color="#000080">.</font>bit_sam<font color="#000080">&gt;</font><font color="#800000">8</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>Blaster<font color="#000080">.</font>hdmac<font color="#000080">&gt;</font><font color="#800000">3</font><font color="#000080">) </font><font color="#FF0000"><b>then
    </b></font>Channel<font color="#000080">:=</font>Blaster<font color="#000080">.</font>hdmac
  <font color="#FF0000"><b>Else </b></font>Channel<font color="#000080">:=</font>Blaster<font color="#000080">.</font>dmac<font color="#000080">;
  </font>WriteLn<font color="#000080">(</font>id<font color="#000080">.</font>freq<font color="#000080">,</font><font color="#800000">' Hz  '</font><font color="#000080">,</font>id<font color="#000080">.</font>byte_p_s<font color="#000080">,</font><font color="#800000">' Bytes/Sec'</font><font color="#000080">);
  </font>WriteLn<font color="#000080">(</font><font color="#800000">'Length  : '</font><font color="#000080">,</font>id<font color="#000080">.</font>d_length<font color="#000080">,</font><font color="#800000">' Bytes    '</font><font color="#000080">,</font>id<font color="#000080">.</font>d_length <font color="#FF0000"><b>div </b></font>id<font color="#000080">.</font>byte_p_s<font color="#000080">, </font><font color="#800000">' Sec'</font><font color="#000080">);
  </font>WriteLn<font color="#000080">(</font><font color="#800000">'Playing : '</font><font color="#000080">,</font>fn<font color="#000080">);
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#008000"><i>{$F+}
</i></font><font color="#FF0000"><b>Procedure </b></font>Stelle_DMA<font color="#000080">(</font>Freq<font color="#000080">: </font>Word<font color="#000080">;</font><font color="#FF0000"><b>Var </b></font>size <font color="#000080">: </font>Word<font color="#000080">);
</font><font color="#FF0000"><b>Var </b></font>PageNr<font color="#000080">,</font>PageAdress<font color="#000080">,</font>DMALength<font color="#000080">: </font>Word<font color="#000080">;
</font><font color="#FF0000"><b>Begin
  Inline</b></font><font color="#000080">(</font><font color="#800000">$FA</font><font color="#000080">);
  </font><font color="#FF0000"><b>Asm
    </b></font><font color="#FF00FF">Mov ax,Word Ptr DMA_Buf_1[2]
    Shr ax,12
    Mov Word Ptr PageNr,ax
    Mov ax,Word Ptr DMA_Buf_1[2]
    Shl ax,4
    Mov Word Ptr PageAdress,ax
    Mov ax,Word Ptr DMA_Buf_1
    Add Word Ptr PageAdress,ax
    Adc Word Ptr PageNr,0
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
  </font>DMALength<font color="#000080">:=</font>Size<font color="#000080">;
  </font>Freq<font color="#000080">:=</font><font color="#800000">256</font><font color="#000080">-</font>Trunc<font color="#000080">(</font><font color="#800000">1000000</font><font color="#000080">/</font>Freq<font color="#000080">);
  </font><font color="#FF0000"><b>If </b></font>Channel<font color="#000080">&gt;</font><font color="#800000">3 </font><font color="#FF0000"><b>then
    Begin
      </b></font>DMALength<font color="#000080">:=</font>DMALength <font color="#FF0000"><b>div </b></font><font color="#800000">2</font><font color="#000080">;
      </font>PageAdress<font color="#000080">:=</font>PageAdress <font color="#FF0000"><b>div </b></font><font color="#800000">2</font><font color="#000080">;
      </font><font color="#FF0000"><b>If </b></font>Odd<font color="#000080">(</font>PageNr<font color="#000080">) </font><font color="#FF0000"><b>then
        Begin
          </b></font>Dec<font color="#000080">(</font>PageNr<font color="#000080">);
          </font>PageAdress<font color="#000080">:=</font>PageAdress<font color="#000080">+</font><font color="#800000">$8000
        </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>If </b></font>id<font color="#000080">.</font>Modus<font color="#000080">=</font><font color="#800000">2 </font><font color="#FF0000"><b>then
    Begin
      If </b></font>id<font color="#000080">.</font>bit_sam<font color="#000080">=</font><font color="#800000">16
        </font><font color="#FF0000"><b>then </b></font>Blaster_Command<font color="#000080">(</font><font color="#800000">$A4</font><font color="#000080">)
        </font><font color="#FF0000"><b>Else </b></font>Blaster_Command<font color="#000080">(</font><font color="#800000">$A8</font><font color="#000080">);
    </font><font color="#FF0000"><b>End
  Else
    If </b></font>id<font color="#000080">.</font>bit_sam<font color="#000080">=</font><font color="#800000">16
      </font><font color="#FF0000"><b>then </b></font>Blaster_Command<font color="#000080">(</font><font color="#800000">$A4</font><font color="#000080">);

  </font>Dec<font color="#000080">(</font>DMALength<font color="#000080">);

  </font>Port<font color="#000080">[</font>DMA_dat<font color="#000080">[</font>Channel<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">]]:=</font><font color="#800000">$4 </font><font color="#FF0000"><b>or </b></font><font color="#000080">(</font>Channel <font color="#FF0000"><b>and </b></font><font color="#800000">$3</font><font color="#000080">);
  </font>Port<font color="#000080">[</font>DMA_dat<font color="#000080">[</font>Channel<font color="#000080">,</font><font color="#800000">2</font><font color="#000080">]]:=</font><font color="#800000">$0</font><font color="#000080">;
  </font>Port<font color="#000080">[</font>DMA_dat<font color="#000080">[</font>Channel<font color="#000080">,</font><font color="#800000">3</font><font color="#000080">]]:=</font><font color="#800000">$49</font><font color="#000080">;
  </font>Port<font color="#000080">[</font>DMA_dat<font color="#000080">[</font>Channel<font color="#000080">,</font><font color="#800000">4</font><font color="#000080">]]:=</font>lo<font color="#000080">(</font>PageAdress<font color="#000080">);
  </font>Port<font color="#000080">[</font>DMA_dat<font color="#000080">[</font>Channel<font color="#000080">,</font><font color="#800000">4</font><font color="#000080">]]:=</font>hi<font color="#000080">(</font>PageAdress<font color="#000080">);
  </font>Port<font color="#000080">[</font>DMA_dat<font color="#000080">[</font>Channel<font color="#000080">,</font><font color="#800000">5</font><font color="#000080">]]:=</font>lo<font color="#000080">(</font>PageNr<font color="#000080">);
  </font>Port<font color="#000080">[</font>DMA_dat<font color="#000080">[</font>Channel<font color="#000080">,</font><font color="#800000">6</font><font color="#000080">]]:=</font>lo<font color="#000080">(</font>DMALength<font color="#000080">);
  </font>Port<font color="#000080">[</font>DMA_dat<font color="#000080">[</font>Channel<font color="#000080">,</font><font color="#800000">6</font><font color="#000080">]]:=</font>hi<font color="#000080">(</font>DMALength<font color="#000080">);
  </font>Port<font color="#000080">[</font>DMA_dat<font color="#000080">[</font>Channel<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">]]:=(</font>Channel <font color="#FF0000"><b>and </b></font><font color="#800000">$3</font><font color="#000080">);

  </font>Blaster_Command<font color="#000080">(</font><font color="#800000">$40</font><font color="#000080">);
  </font>Blaster_Command<font color="#000080">(</font>Lo<font color="#000080">(</font>Freq<font color="#000080">));
  </font>Blaster_Command<font color="#000080">(</font><font color="#800000">$48</font><font color="#000080">);
  </font>Blaster_Command<font color="#000080">(</font>lo<font color="#000080">(</font>DMALength<font color="#000080">));
  </font>Blaster_Command<font color="#000080">(</font>hi<font color="#000080">(</font>DMALength<font color="#000080">));
  </font>Blaster_Command<font color="#000080">(</font><font color="#800000">$91</font><font color="#000080">);
  </font><font color="#FF0000"><b>Inline</b></font><font color="#000080">(</font><font color="#800000">$FB</font><font color="#000080">);
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>Ausgabe_IRQ<font color="#000080">; </font>Interrupt<font color="#000080">;
</font><font color="#FF0000"><b>Var </b></font>test <font color="#000080">: </font>Byte<font color="#000080">;
</font><font color="#FF0000"><b>Begin
  Inline</b></font><font color="#000080">(</font><font color="#800000">$FA</font><font color="#000080">);
  </font>Port<font color="#000080">[</font><font color="#800000">$20</font><font color="#000080">]:=</font><font color="#800000">$20</font><font color="#000080">;
  </font>test<font color="#000080">:=</font>Port<font color="#000080">[</font>sbb<font color="#000080">+</font><font color="#800000">$e</font><font color="#000080">];
  </font>Ende<font color="#000080">:=</font>True<font color="#000080">;
  </font><font color="#FF0000"><b>Inline</b></font><font color="#000080">(</font><font color="#800000">$fB</font><font color="#000080">);
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;
</font><font color="#008000"><i>{$F-}

</i></font><font color="#FF0000"><b>Procedure </b></font>Play<font color="#000080">;
</font><font color="#FF0000"><b>Var  </b></font>p<font color="#000080">,</font>s<font color="#000080">,</font>s2 <font color="#000080">: </font>Word<font color="#000080">;
    </font>w      <font color="#000080">: </font>LongInt<font color="#000080">;
</font><font color="#FF0000"><b>Begin
  </b></font>GetMem<font color="#000080">(</font>zwi<font color="#000080">,</font><font color="#800000">16</font><font color="#000080">);
  </font>GetMem<font color="#000080">(</font>dma_buf_1<font color="#000080">,</font>dma<font color="#000080">);
  </font>p<font color="#000080">:=</font><font color="#800000">16</font><font color="#000080">;
  </font><font color="#FF0000"><b>While </b></font><font color="#000080">(</font>Seg<font color="#000080">(</font>dma_buf_1<font color="#000080">^[</font><font color="#800000">1</font><font color="#000080">]) </font><font color="#FF0000"><b>mod </b></font><font color="#800000">4096</font><font color="#000080">)&gt;(</font><font color="#800000">4096</font><font color="#000080">-(</font>dma<font color="#000080">*</font><font color="#800000">2 </font><font color="#FF0000"><b>div </b></font><font color="#800000">16</font><font color="#000080">)) </font><font color="#FF0000"><b>do
    Begin
      </b></font>FreeMem<font color="#000080">(</font>dma_buf_1<font color="#000080">,</font>dma<font color="#000080">);
      </font>FreeMem<font color="#000080">(</font>zwi<font color="#000080">,</font>p<font color="#000080">);
      </font>p<font color="#000080">:=</font>p<font color="#000080">+</font><font color="#800000">16</font><font color="#000080">;
      </font><font color="#FF0000"><b>If </b></font>p<font color="#000080">&gt;</font><font color="#800000">65525 </font><font color="#FF0000"><b>then </b></font>halt<font color="#000080">(</font><font color="#800000">111</font><font color="#000080">);
      </font>GetMem<font color="#000080">(</font>zwi<font color="#000080">,</font>p<font color="#000080">);
      </font>GetMem<font color="#000080">(</font>dma_buf_1<font color="#000080">,</font>dma<font color="#000080">);
    </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
  </font>GetMem<font color="#000080">(</font>dma_buf_2<font color="#000080">,</font>dma<font color="#000080">);
  </font>FreeMem<font color="#000080">(</font>zwi<font color="#000080">,</font>p<font color="#000080">);
  </font>port<font color="#000080">[</font><font color="#800000">$21</font><font color="#000080">]:=</font>Port<font color="#000080">[</font><font color="#800000">$21</font><font color="#000080">] </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font><font color="#800000">255 </font><font color="#FF0000"><b>xor </b></font><font color="#000080">(</font><font color="#800000">1 </font><font color="#FF0000"><b>shl </b></font>Blaster<font color="#000080">.</font>IRQ<font color="#000080">));
  </font>GetIntVec<font color="#000080">(</font>Blaster<font color="#000080">.</font>IRQ<font color="#000080">+</font><font color="#800000">8</font><font color="#000080">,</font>Alt_irq<font color="#000080">);
  </font>SetIntVec<font color="#000080">(</font>Blaster<font color="#000080">.</font>IRQ<font color="#000080">+</font><font color="#800000">8</font><font color="#000080">,@</font>Ausgabe_IRQ<font color="#000080">);
  </font>w<font color="#000080">:=</font>id<font color="#000080">.</font>freq<font color="#000080">*</font>id<font color="#000080">.</font>modus<font color="#000080">;
  </font>BlockRead<font color="#000080">(</font>wav<font color="#000080">,</font>dma_buf_1<font color="#000080">^[</font><font color="#800000">1</font><font color="#000080">],</font>dma<font color="#000080">,</font>s<font color="#000080">);
  </font><font color="#FF0000"><b>Repeat
    </b></font>Ende<font color="#000080">:=</font>False<font color="#000080">;
    </font>Stelle_DMA<font color="#000080">(</font>w<font color="#000080">,</font>s<font color="#000080">);
    </font>BlockRead<font color="#000080">(</font>wav<font color="#000080">,</font>dma_buf_2<font color="#000080">^[</font><font color="#800000">1</font><font color="#000080">],</font>dma<font color="#000080">,</font>s2<font color="#000080">);
    </font><font color="#FF0000"><b>Repeat Until </b></font>Ende<font color="#000080">;
    </font>s<font color="#000080">:=</font>s2<font color="#000080">;
    </font>zwi<font color="#000080">:=</font>dma_buf_1<font color="#000080">;
    </font>dma_buf_1<font color="#000080">:=</font>dma_buf_2<font color="#000080">;
    </font>dma_buf_2<font color="#000080">:=</font>zwi<font color="#000080">;
  </font><font color="#FF0000"><b>Until </b></font>EoF<font color="#000080">(</font>wav<font color="#000080">) </font><font color="#FF0000"><b>or </b></font>Keypressed<font color="#000080">;
  </font><font color="#FF0000"><b>While </b></font>KeyPressed <font color="#FF0000"><b>do </b></font>w<font color="#000080">:=</font>Ord<font color="#000080">(</font>ReadKey<font color="#000080">);
  </font><font color="#FF0000"><b>If </b></font>EoF<font color="#000080">(</font>wav<font color="#000080">) </font><font color="#FF0000"><b>then
    Begin
      </b></font>Ende<font color="#000080">:=</font>False<font color="#000080">;
      </font>Stelle_DMA<font color="#000080">(</font>w<font color="#000080">,</font>s<font color="#000080">);
      </font><font color="#FF0000"><b>Repeat Until </b></font>Ende<font color="#000080">;
    </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
  </font>SetintVec<font color="#000080">(</font>Blaster<font color="#000080">.</font>IRQ<font color="#000080">+</font><font color="#800000">8</font><font color="#000080">,</font>Alt_IRQ<font color="#000080">);
  </font>FreeMem<font color="#000080">(</font>dma_buf_1<font color="#000080">,</font>dma<font color="#000080">);
  </font>FreeMem<font color="#000080">(</font>dma_buf_2<font color="#000080">,</font>dma<font color="#000080">);
  </font>Port<font color="#000080">[</font><font color="#800000">$21</font><font color="#000080">]:=</font>Port<font color="#000080">[</font><font color="#800000">$21</font><font color="#000080">] </font><font color="#FF0000"><b>or </b></font><font color="#000080">(</font><font color="#800000">1 </font><font color="#FF0000"><b>shl </b></font>Blaster<font color="#000080">.</font>IRQ<font color="#000080">);
  </font>Blaster_Command<font color="#000080">(</font><font color="#800000">$d3</font><font color="#000080">);
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Begin
  </b></font>Init<font color="#000080">;
  </font>Play<font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to SOUND SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0081.PAS">Original</a><b>]</b></p></body>
</html>
