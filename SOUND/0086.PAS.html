<html>
<head><title> "Sound Blaster Stuff" by DANNY SWETT</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to SOUND SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0086.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code>
<font color="#008000"><i>{Danny Swett
 This will play upto 44khz on a Sound Blaster
}

{ NOTE : Other units needed are at the end !! }


</i></font><font color="#FF0000"><b>unit </b></font>sb_voice<font color="#000080">;

</font><font color="#FF0000"><b>interface
var
    </b></font>SBstatus<font color="#000080">:</font>word<font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>setsb_port<font color="#000080">(</font>address<font color="#000080">,</font>int<font color="#000080">:</font>word<font color="#000080">);
</font><font color="#FF0000"><b>procedure </b></font>setsb_speed<font color="#000080">(</font>hertz<font color="#000080">:</font>word<font color="#000080">);
</font><font color="#FF0000"><b>procedure </b></font>outputsb<font color="#000080">(</font>buffer<font color="#000080">:</font>pointer<font color="#000080">;</font>len<font color="#000080">:</font>longint<font color="#000080">);
</font><font color="#FF0000"><b>procedure </b></font>stopsb<font color="#000080">;
</font><font color="#FF0000"><b>procedure </b></font>continuesb<font color="#000080">;
</font><font color="#FF0000"><b>procedure </b></font>resetsb<font color="#000080">;
</font><font color="#FF0000"><b>procedure </b></font>setsb_speaker<font color="#000080">(</font><font color="#FF0000"><b>on</b></font><font color="#000080">:</font>boolean<font color="#000080">);

</font><font color="#FF0000"><b>implementation

uses </b></font>crt<font color="#000080">,</font>dos<font color="#000080">;

</font><font color="#FF0000"><b>var
    </b></font>SBint<font color="#000080">,</font>SBio<font color="#000080">:</font>word<font color="#000080">;
    </font>SBhighspeed<font color="#000080">,</font>SBintset<font color="#000080">:</font>boolean<font color="#000080">;
    </font>oldint<font color="#000080">:</font>pointer<font color="#000080">;
    </font>s_low16<font color="#000080">:</font>word<font color="#000080">;
    </font>s_high4<font color="#000080">:</font>byte<font color="#000080">;
    </font>s_len<font color="#000080">:</font>longint<font color="#000080">;
    </font>oldexitproc<font color="#000080">:</font>pointer<font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>writesb<font color="#000080">(</font>a<font color="#000080">:</font>byte<font color="#000080">);
</font><font color="#FF0000"><b>begin
    while</b></font><font color="#000080">((</font>port<font color="#000080">[</font>SBio<font color="#000080">+</font><font color="#800000">12</font><font color="#000080">] </font><font color="#FF0000"><b>and </b></font><font color="#800000">$80</font><font color="#000080">)&lt;&gt;</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>do </b></font><font color="#000080">;
    </font>port<font color="#000080">[</font>SBio<font color="#000080">+</font><font color="#800000">12</font><font color="#000080">]:=</font>a<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>resetsb<font color="#000080">;
</font><font color="#FF0000"><b>var
    </b></font>a<font color="#000080">:</font>byte<font color="#000080">;

</font><font color="#FF0000"><b>begin
    </b></font>SBstatus<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
    </font><font color="#FF0000"><b>if</b></font><font color="#000080">(</font>SBio<font color="#000080">&lt;&gt;</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>then
    begin
        </b></font>port<font color="#000080">[</font>SBio<font color="#000080">+</font><font color="#800000">6</font><font color="#000080">]:=</font><font color="#800000">1</font><font color="#000080">;
        </font>delay<font color="#000080">(</font><font color="#800000">10</font><font color="#000080">);
        </font>port<font color="#000080">[</font>SBio<font color="#000080">+</font><font color="#800000">6</font><font color="#000080">]:=</font><font color="#800000">0</font><font color="#000080">;
        </font>delay<font color="#000080">(</font><font color="#800000">10</font><font color="#000080">);
        </font><font color="#FF0000"><b>if</b></font><font color="#000080">(((</font>port<font color="#000080">[</font>SBio<font color="#000080">+</font><font color="#800000">14</font><font color="#000080">] </font><font color="#FF0000"><b>and </b></font><font color="#800000">$80</font><font color="#000080">)&lt;&gt;</font><font color="#800000">$80</font><font color="#000080">) </font><font color="#FF0000"><b>or </b></font><font color="#000080">(</font>port<font color="#000080">[</font>SBio<font color="#000080">+</font><font color="#800000">10</font><font color="#000080">]&lt;&gt;</font><font color="#800000">$aa</font><font color="#000080">)) </font><font color="#FF0000"><b>then
            </b></font>SBio<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>setsb_speed<font color="#000080">;
</font><font color="#FF0000"><b>var
    </b></font>a<font color="#000080">:</font>byte<font color="#000080">;

</font><font color="#FF0000"><b>begin
    if</b></font><font color="#000080">(</font>SBio<font color="#000080">&lt;&gt;</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>then
    begin
        </b></font>a<font color="#000080">:=</font><font color="#800000">256</font><font color="#000080">-(</font><font color="#800000">1000000 </font><font color="#FF0000"><b>div </b></font>hertz<font color="#000080">);
        </font>writesb<font color="#000080">(</font><font color="#800000">$40</font><font color="#000080">);
        </font>writesb<font color="#000080">(</font>a<font color="#000080">);
        </font><font color="#FF0000"><b>if</b></font><font color="#000080">(</font>hertz<font color="#000080">&gt;</font><font color="#800000">22050</font><font color="#000080">) </font><font color="#FF0000"><b>then
            </b></font>SBhighspeed<font color="#000080">:=</font>true
        <font color="#FF0000"><b>else
            </b></font>SBhighspeed<font color="#000080">:=</font>false<font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>stopsb<font color="#000080">;
</font><font color="#FF0000"><b>begin
    if</b></font><font color="#000080">(</font>SBio<font color="#000080">&lt;&gt;</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>then
    begin
        </b></font>SBstatus<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
        </font><font color="#FF0000"><b>if</b></font><font color="#000080">(</font>SBhighspeed<font color="#000080">=</font>false<font color="#000080">) </font><font color="#FF0000"><b>then
            </b></font>writesb<font color="#000080">(</font><font color="#800000">$d0</font><font color="#000080">)
        </font><font color="#FF0000"><b>else
            </b></font>port<font color="#000080">[</font><font color="#800000">$0a</font><font color="#000080">]:=</font><font color="#800000">5</font><font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>continuesb<font color="#000080">;
</font><font color="#FF0000"><b>begin
    if</b></font><font color="#000080">(</font>SBio<font color="#000080">&lt;&gt;</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>then
    begin
        </b></font>SBstatus<font color="#000080">:=</font><font color="#800000">1</font><font color="#000080">;
        </font><font color="#FF0000"><b>if</b></font><font color="#000080">(</font>SBhighspeed<font color="#000080">=</font>false<font color="#000080">) </font><font color="#FF0000"><b>then
            </b></font>writesb<font color="#000080">(</font><font color="#800000">$d4</font><font color="#000080">)
        </font><font color="#FF0000"><b>else
            </b></font>port<font color="#000080">[</font><font color="#800000">$0a</font><font color="#000080">]:=</font><font color="#800000">1</font><font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>setsb_speaker<font color="#000080">;
</font><font color="#FF0000"><b>begin
    if</b></font><font color="#000080">(</font>SBio<font color="#000080">&lt;&gt;</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>then
    begin
        if</b></font><font color="#000080">(</font><font color="#FF0000"><b>on</b></font><font color="#000080">=</font>true<font color="#000080">) </font><font color="#FF0000"><b>then
            </b></font>writesb<font color="#000080">(</font><font color="#800000">$d1</font><font color="#000080">)
        </font><font color="#FF0000"><b>else
            </b></font>writesb<font color="#000080">(</font><font color="#800000">$d3</font><font color="#000080">);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>outputcontinue<font color="#000080">;
</font><font color="#FF0000"><b>var
    </b></font>l<font color="#000080">:</font>word<font color="#000080">;

</font><font color="#FF0000"><b>begin
    </b></font>l<font color="#000080">:=</font><font color="#800000">$ffff</font><font color="#000080">-</font>s_low16<font color="#000080">;
    </font><font color="#FF0000"><b>if</b></font><font color="#000080">(</font>l<font color="#000080">&gt;</font>s_len<font color="#000080">) </font><font color="#FF0000"><b>then
        </b></font>l<font color="#000080">:=</font>s_len<font color="#000080">;
    </font>port<font color="#000080">[</font><font color="#800000">$0a</font><font color="#000080">]:=</font><font color="#800000">5</font><font color="#000080">;
    </font>port<font color="#000080">[</font><font color="#800000">$0c</font><font color="#000080">]:=</font><font color="#800000">0</font><font color="#000080">;
    </font>port<font color="#000080">[</font><font color="#800000">$0b</font><font color="#000080">]:=</font><font color="#800000">$49</font><font color="#000080">;
    </font>port<font color="#000080">[</font><font color="#800000">$02</font><font color="#000080">]:=</font>lo<font color="#000080">(</font>s_low16<font color="#000080">);
    </font>port<font color="#000080">[</font><font color="#800000">$02</font><font color="#000080">]:=</font>hi<font color="#000080">(</font>s_low16<font color="#000080">);
    </font>port<font color="#000080">[</font><font color="#800000">$83</font><font color="#000080">]:=</font>s_high4<font color="#000080">;
    </font>port<font color="#000080">[</font><font color="#800000">$03</font><font color="#000080">]:=</font>lo<font color="#000080">(</font>l<font color="#000080">);
    </font>port<font color="#000080">[</font><font color="#800000">$03</font><font color="#000080">]:=</font>hi<font color="#000080">(</font>l<font color="#000080">);
    </font>port<font color="#000080">[</font><font color="#800000">$0a</font><font color="#000080">]:=</font><font color="#800000">1</font><font color="#000080">;
    </font><font color="#FF0000"><b>if</b></font><font color="#000080">(</font>SBhighspeed<font color="#000080">=</font>false<font color="#000080">) </font><font color="#FF0000"><b>then
    begin
        </b></font>writesb<font color="#000080">(</font><font color="#800000">$14</font><font color="#000080">);
        </font>writesb<font color="#000080">(</font>lo<font color="#000080">(</font>l<font color="#000080">));
        </font>writesb<font color="#000080">(</font>hi<font color="#000080">(</font>l<font color="#000080">));
    </font><font color="#FF0000"><b>end
    else
    begin
        </b></font>writesb<font color="#000080">(</font><font color="#800000">$48</font><font color="#000080">);
        </font>writesb<font color="#000080">(</font>lo<font color="#000080">(</font>l<font color="#000080">));
        </font>writesb<font color="#000080">(</font>hi<font color="#000080">(</font>l<font color="#000080">));
        </font>writesb<font color="#000080">(</font><font color="#800000">$91</font><font color="#000080">);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font>s_len<font color="#000080">:=</font>s_len<font color="#000080">-</font>l<font color="#000080">;
    </font>s_low16<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
    </font>s_high4<font color="#000080">:=</font>s_high4<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>sbinter<font color="#000080">; </font>interrupt<font color="#000080">;
</font><font color="#FF0000"><b>var
    </b></font>a<font color="#000080">:</font>byte<font color="#000080">;

</font><font color="#FF0000"><b>begin
    </b></font>a<font color="#000080">:=</font>port<font color="#000080">[</font>SBio<font color="#000080">+</font><font color="#800000">14</font><font color="#000080">];
    </font><font color="#FF0000"><b>if</b></font><font color="#000080">(</font>s_len<font color="#000080">&gt;</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>then
        </b></font>outputcontinue
    <font color="#FF0000"><b>else
    begin
        </b></font>port<font color="#000080">[</font><font color="#800000">$0a</font><font color="#000080">]:=</font><font color="#800000">5</font><font color="#000080">;
        </font>SBstatus<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
        </font>a<font color="#000080">:=</font>port<font color="#000080">[</font>SBio<font color="#000080">+</font><font color="#800000">14</font><font color="#000080">];
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font>port<font color="#000080">[</font><font color="#800000">$20</font><font color="#000080">]:=</font><font color="#800000">$20</font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>setsb_int<font color="#000080">;
</font><font color="#FF0000"><b>begin
    if</b></font><font color="#000080">((</font>SBintset<font color="#000080">=</font>false<font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>SBio<font color="#000080">&lt;&gt;</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>SBint<font color="#000080">&lt;&gt;</font><font color="#800000">0</font><font color="#000080">)) </font><font color="#FF0000"><b>then
    begin
        </b></font>SBintset<font color="#000080">:=</font>true<font color="#000080">;
        </font>getintvec<font color="#000080">(</font><font color="#800000">8</font><font color="#000080">+</font>SBint<font color="#000080">,</font>oldint<font color="#000080">);
        </font>setintvec<font color="#000080">(</font><font color="#800000">8</font><font color="#000080">+</font>SBint<font color="#000080">,</font>addr<font color="#000080">(</font>sbinter<font color="#000080">));
        </font>port<font color="#000080">[</font><font color="#800000">$21</font><font color="#000080">]:=(</font>port<font color="#000080">[</font><font color="#800000">$21</font><font color="#000080">] </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font><font color="#800000">$ff</font><font color="#000080">-(</font><font color="#800000">1 </font><font color="#FF0000"><b>shl </b></font>SBint<font color="#000080">)));
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>outputsb<font color="#000080">;
</font><font color="#FF0000"><b>var
    </b></font>l<font color="#000080">:</font>word<font color="#000080">;

</font><font color="#FF0000"><b>begin
    if</b></font><font color="#000080">((</font>SBstatus<font color="#000080">=</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>SBio<font color="#000080">&lt;&gt;</font><font color="#800000">0</font><font color="#000080">)) </font><font color="#FF0000"><b>then
    begin
        </b></font>s_len<font color="#000080">:=</font>len<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">;
        </font>setsb_int<font color="#000080">;
        </font>setsb_speaker<font color="#000080">(</font>true<font color="#000080">);
        </font>SBstatus<font color="#000080">:=</font><font color="#800000">1</font><font color="#000080">;
        </font>s_low16<font color="#000080">:=</font>word<font color="#000080">(</font>ofs<font color="#000080">(</font>buffer<font color="#000080">^)+(</font>seg<font color="#000080">(</font>buffer<font color="#000080">^) </font><font color="#FF0000"><b>shl </b></font><font color="#800000">4</font><font color="#000080">));
        </font>s_high4<font color="#000080">:=</font>byte<font color="#000080">(((</font>ofs<font color="#000080">(</font>buffer<font color="#000080">^) </font><font color="#FF0000"><b>shr </b></font><font color="#800000">4</font><font color="#000080">)+</font>seg<font color="#000080">(</font>buffer<font color="#000080">^)) </font><font color="#FF0000"><b>shr </b></font><font color="#800000">12</font><font color="#000080">);
        </font>l<font color="#000080">:=</font><font color="#800000">$ffff</font><font color="#000080">-</font>s_low16<font color="#000080">;
        </font><font color="#FF0000"><b>if</b></font><font color="#000080">(</font>l<font color="#000080">&gt;</font>s_len<font color="#000080">) </font><font color="#FF0000"><b>then
            </b></font>l<font color="#000080">:=</font>s_len<font color="#000080">;
        </font>port<font color="#000080">[</font><font color="#800000">$0a</font><font color="#000080">]:=</font><font color="#800000">5</font><font color="#000080">;
        </font>port<font color="#000080">[</font><font color="#800000">$0c</font><font color="#000080">]:=</font><font color="#800000">0</font><font color="#000080">;
        </font>port<font color="#000080">[</font><font color="#800000">$0b</font><font color="#000080">]:=</font><font color="#800000">$49</font><font color="#000080">;
        </font>port<font color="#000080">[</font><font color="#800000">$02</font><font color="#000080">]:=</font>lo<font color="#000080">(</font>s_low16<font color="#000080">);
        </font>port<font color="#000080">[</font><font color="#800000">$02</font><font color="#000080">]:=</font>hi<font color="#000080">(</font>s_low16<font color="#000080">);
        </font>port<font color="#000080">[</font><font color="#800000">$83</font><font color="#000080">]:=</font>s_high4<font color="#000080">;
        </font>port<font color="#000080">[</font><font color="#800000">$03</font><font color="#000080">]:=</font>lo<font color="#000080">(</font>l<font color="#000080">);
        </font>port<font color="#000080">[</font><font color="#800000">$03</font><font color="#000080">]:=</font>hi<font color="#000080">(</font>l<font color="#000080">);
        </font>port<font color="#000080">[</font><font color="#800000">$0a</font><font color="#000080">]:=</font><font color="#800000">1</font><font color="#000080">;
        </font><font color="#FF0000"><b>if</b></font><font color="#000080">(</font>SBhighspeed<font color="#000080">=</font>false<font color="#000080">) </font><font color="#FF0000"><b>then
        begin
            </b></font>writesb<font color="#000080">(</font><font color="#800000">$14</font><font color="#000080">);
            </font>writesb<font color="#000080">(</font>lo<font color="#000080">(</font>l<font color="#000080">));
            </font>writesb<font color="#000080">(</font>hi<font color="#000080">(</font>l<font color="#000080">));
        </font><font color="#FF0000"><b>end
        else
        begin
            </b></font>writesb<font color="#000080">(</font><font color="#800000">$48</font><font color="#000080">);
            </font>writesb<font color="#000080">(</font>lo<font color="#000080">(</font>l<font color="#000080">));
            </font>writesb<font color="#000080">(</font>hi<font color="#000080">(</font>l<font color="#000080">));
            </font>writesb<font color="#000080">(</font><font color="#800000">$91</font><font color="#000080">);
        </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
        </font>s_len<font color="#000080">:=</font>s_len<font color="#000080">-</font>l<font color="#000080">;
        </font>s_low16<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
        </font>s_high4<font color="#000080">:=</font>s_high4<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>deinitsb<font color="#000080">; </font><font color="#FF0000"><b>far</b></font><font color="#000080">;
</font><font color="#FF0000"><b>begin
    </b></font>exitproc<font color="#000080">:=</font>oldexitproc<font color="#000080">;
    </font><font color="#FF0000"><b>if</b></font><font color="#000080">(</font>SBio<font color="#000080">&lt;&gt;</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>then
    begin
        </b></font>setsb_speaker<font color="#000080">(</font>false<font color="#000080">);
        </font><font color="#FF0000"><b>if</b></font><font color="#000080">(</font>SBstatus<font color="#000080">&lt;&gt;</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>then
            </b></font>stopsb<font color="#000080">;
        </font>resetsb<font color="#000080">;
        </font><font color="#FF0000"><b>if</b></font><font color="#000080">(</font>SBintset<font color="#000080">=</font>true<font color="#000080">) </font><font color="#FF0000"><b>then
            </b></font>setintvec<font color="#000080">(</font><font color="#800000">8</font><font color="#000080">+</font>SBint<font color="#000080">,</font>oldint<font color="#000080">);
        </font>SBstatus<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>setsb_port<font color="#000080">;
</font><font color="#FF0000"><b>begin
    </b></font>SBstatus<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
    </font>SBint<font color="#000080">:=</font>int<font color="#000080">;
    </font>SBio<font color="#000080">:=</font>address<font color="#000080">;
    </font>resetsb<font color="#000080">;
    </font><font color="#FF0000"><b>if</b></font><font color="#000080">(</font>SBio<font color="#000080">&lt;&gt;</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>then
    begin
        </b></font>setsb_speaker<font color="#000080">(</font>false<font color="#000080">);
        </font>setsb_int<font color="#000080">;
        </font>SBstatus<font color="#000080">:=</font><font color="#800000">1</font><font color="#000080">;
        </font>writesb<font color="#000080">(</font><font color="#800000">$f2</font><font color="#000080">);
        </font>delay<font color="#000080">(</font><font color="#800000">100</font><font color="#000080">);
        </font><font color="#FF0000"><b>if</b></font><font color="#000080">(</font>SBstatus<font color="#000080">&lt;&gt;</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>then
        begin
            </b></font>deinitsb<font color="#000080">;
            </font>SBio<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
            </font>writeln<font color="#000080">(</font><font color="#800000">'IRQ failed'</font><font color="#000080">);
        </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>begin
    </b></font>oldexitproc<font color="#000080">:=</font>exitproc<font color="#000080">;
    </font>exitproc<font color="#000080">:=</font>addr<font color="#000080">(</font>deinitsb<font color="#000080">);
    </font>SBintset<font color="#000080">:=</font>false<font color="#000080">;
    </font>SBio<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
    </font>SBint<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">.

</font>__________
sb_xms<font color="#000080">.</font>pas
<font color="#000080">~~~~~~~~~~
</font><font color="#008000"><i>{Danny Swett
 This will play upto 44khz on a Sound Blaster
 Can also play sound that are loaded into XMS memory
}


</i></font><font color="#FF0000"><b>unit </b></font>sb_xms<font color="#000080">;

</font><font color="#FF0000"><b>interface
var
    </b></font>SBstatus<font color="#000080">:</font>word<font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>setsb_port<font color="#000080">(</font>address<font color="#000080">,</font>int<font color="#000080">:</font>word<font color="#000080">);
</font><font color="#FF0000"><b>procedure </b></font>setsb_speed<font color="#000080">(</font>hertz<font color="#000080">:</font>word<font color="#000080">);
</font><font color="#FF0000"><b>procedure </b></font>outputsb<font color="#000080">(</font>buffer<font color="#000080">:</font>pointer<font color="#000080">;</font>len<font color="#000080">:</font>longint<font color="#000080">);
</font><font color="#FF0000"><b>procedure </b></font>outputxmssb<font color="#000080">(</font>buf<font color="#000080">:</font>word<font color="#000080">);
</font><font color="#FF0000"><b>procedure </b></font>stopsb<font color="#000080">;
</font><font color="#FF0000"><b>procedure </b></font>continuesb<font color="#000080">;
</font><font color="#FF0000"><b>procedure </b></font>resetsb<font color="#000080">;
</font><font color="#FF0000"><b>procedure </b></font>setsb_speaker<font color="#000080">(</font><font color="#FF0000"><b>on</b></font><font color="#000080">:</font>boolean<font color="#000080">);

</font><font color="#FF0000"><b>implementation

uses </b></font>crt<font color="#000080">,</font>dos<font color="#000080">,</font>xms<font color="#000080">;

</font><font color="#FF0000"><b>var
    </b></font>SBint<font color="#000080">,</font>SBio<font color="#000080">:</font>word<font color="#000080">;
    </font>SBhighspeed<font color="#000080">,</font>SBintset<font color="#000080">:</font>boolean<font color="#000080">;
    </font>oldint<font color="#000080">:</font>pointer<font color="#000080">;
    </font>s_low16<font color="#000080">:</font>word<font color="#000080">;
    </font>s_high4<font color="#000080">:</font>byte<font color="#000080">;
    </font>s_len<font color="#000080">:</font>longint<font color="#000080">;
    </font>oldexitproc<font color="#000080">:</font>pointer<font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>writesb<font color="#000080">(</font>a<font color="#000080">:</font>byte<font color="#000080">);
</font><font color="#FF0000"><b>begin
    while</b></font><font color="#000080">((</font>port<font color="#000080">[</font>SBio<font color="#000080">+</font><font color="#800000">12</font><font color="#000080">] </font><font color="#FF0000"><b>and </b></font><font color="#800000">$80</font><font color="#000080">)&lt;&gt;</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>do </b></font><font color="#000080">;
    </font>port<font color="#000080">[</font>SBio<font color="#000080">+</font><font color="#800000">12</font><font color="#000080">]:=</font>a<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>resetsb<font color="#000080">;
</font><font color="#FF0000"><b>var
    </b></font>a<font color="#000080">:</font>byte<font color="#000080">;

</font><font color="#FF0000"><b>begin
    </b></font>SBstatus<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
    </font><font color="#FF0000"><b>if</b></font><font color="#000080">(</font>SBio<font color="#000080">&lt;&gt;</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>then
    begin
        </b></font>port<font color="#000080">[</font>SBio<font color="#000080">+</font><font color="#800000">6</font><font color="#000080">]:=</font><font color="#800000">1</font><font color="#000080">;
        </font>delay<font color="#000080">(</font><font color="#800000">10</font><font color="#000080">);
        </font>port<font color="#000080">[</font>SBio<font color="#000080">+</font><font color="#800000">6</font><font color="#000080">]:=</font><font color="#800000">0</font><font color="#000080">;
        </font>delay<font color="#000080">(</font><font color="#800000">10</font><font color="#000080">);
        </font><font color="#FF0000"><b>if</b></font><font color="#000080">(((</font>port<font color="#000080">[</font>SBio<font color="#000080">+</font><font color="#800000">14</font><font color="#000080">] </font><font color="#FF0000"><b>and </b></font><font color="#800000">$80</font><font color="#000080">)&lt;&gt;</font><font color="#800000">$80</font><font color="#000080">) </font><font color="#FF0000"><b>or </b></font><font color="#000080">(</font>port<font color="#000080">[</font>SBio<font color="#000080">+</font><font color="#800000">10</font><font color="#000080">]&lt;&gt;</font><font color="#800000">$aa</font><font color="#000080">)) </font><font color="#FF0000"><b>then
            </b></font>SBio<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>setsb_speed<font color="#000080">;
</font><font color="#FF0000"><b>var
    </b></font>a<font color="#000080">:</font>byte<font color="#000080">;

</font><font color="#FF0000"><b>begin
    if</b></font><font color="#000080">(</font>SBio<font color="#000080">&lt;&gt;</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>then
    begin
        </b></font>a<font color="#000080">:=</font><font color="#800000">256</font><font color="#000080">-(</font><font color="#800000">1000000 </font><font color="#FF0000"><b>div </b></font>hertz<font color="#000080">);
        </font>writesb<font color="#000080">(</font><font color="#800000">$40</font><font color="#000080">);
        </font>writesb<font color="#000080">(</font>a<font color="#000080">);
        </font><font color="#FF0000"><b>if</b></font><font color="#000080">(</font>hertz<font color="#000080">&gt;</font><font color="#800000">22050</font><font color="#000080">) </font><font color="#FF0000"><b>then
            </b></font>SBhighspeed<font color="#000080">:=</font>true
        <font color="#FF0000"><b>else
            </b></font>SBhighspeed<font color="#000080">:=</font>false<font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>stopsb<font color="#000080">;
</font><font color="#FF0000"><b>begin
    if</b></font><font color="#000080">(</font>SBio<font color="#000080">&lt;&gt;</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>then
    begin
        </b></font>SBstatus<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
        </font><font color="#FF0000"><b>if</b></font><font color="#000080">(</font>SBhighspeed<font color="#000080">=</font>false<font color="#000080">) </font><font color="#FF0000"><b>then
            </b></font>writesb<font color="#000080">(</font><font color="#800000">$d0</font><font color="#000080">)
        </font><font color="#FF0000"><b>else
            </b></font>port<font color="#000080">[</font><font color="#800000">$0a</font><font color="#000080">]:=</font><font color="#800000">5</font><font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>continuesb<font color="#000080">;
</font><font color="#FF0000"><b>begin
    if</b></font><font color="#000080">(</font>SBio<font color="#000080">&lt;&gt;</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>then
    begin
        </b></font>SBstatus<font color="#000080">:=</font><font color="#800000">1</font><font color="#000080">;
        </font><font color="#FF0000"><b>if</b></font><font color="#000080">(</font>SBhighspeed<font color="#000080">=</font>false<font color="#000080">) </font><font color="#FF0000"><b>then
            </b></font>writesb<font color="#000080">(</font><font color="#800000">$d4</font><font color="#000080">)
        </font><font color="#FF0000"><b>else
            </b></font>port<font color="#000080">[</font><font color="#800000">$0a</font><font color="#000080">]:=</font><font color="#800000">1</font><font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>setsb_speaker<font color="#000080">;
</font><font color="#FF0000"><b>begin
    if</b></font><font color="#000080">(</font>SBio<font color="#000080">&lt;&gt;</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>then
    begin
        if</b></font><font color="#000080">(</font><font color="#FF0000"><b>on</b></font><font color="#000080">=</font>true<font color="#000080">) </font><font color="#FF0000"><b>then
            </b></font>writesb<font color="#000080">(</font><font color="#800000">$d1</font><font color="#000080">)
        </font><font color="#FF0000"><b>else
            </b></font>writesb<font color="#000080">(</font><font color="#800000">$d3</font><font color="#000080">);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>outputcontinue<font color="#000080">;
</font><font color="#FF0000"><b>var
    </b></font>l<font color="#000080">:</font>word<font color="#000080">;

</font><font color="#FF0000"><b>begin
    </b></font>l<font color="#000080">:=</font><font color="#800000">$ffff</font><font color="#000080">-</font>s_low16<font color="#000080">;
    </font><font color="#FF0000"><b>if</b></font><font color="#000080">(</font>l<font color="#000080">&gt;</font>s_len<font color="#000080">) </font><font color="#FF0000"><b>then
        </b></font>l<font color="#000080">:=</font>s_len<font color="#000080">;
    </font>port<font color="#000080">[</font><font color="#800000">$0a</font><font color="#000080">]:=</font><font color="#800000">5</font><font color="#000080">;
    </font>port<font color="#000080">[</font><font color="#800000">$0c</font><font color="#000080">]:=</font><font color="#800000">0</font><font color="#000080">;
    </font>port<font color="#000080">[</font><font color="#800000">$0b</font><font color="#000080">]:=</font><font color="#800000">$49</font><font color="#000080">;
    </font>port<font color="#000080">[</font><font color="#800000">$02</font><font color="#000080">]:=</font>lo<font color="#000080">(</font>s_low16<font color="#000080">);
    </font>port<font color="#000080">[</font><font color="#800000">$02</font><font color="#000080">]:=</font>hi<font color="#000080">(</font>s_low16<font color="#000080">);
    </font>port<font color="#000080">[</font><font color="#800000">$83</font><font color="#000080">]:=</font>s_high4<font color="#000080">;
    </font>port<font color="#000080">[</font><font color="#800000">$03</font><font color="#000080">]:=</font>lo<font color="#000080">(</font>l<font color="#000080">);
    </font>port<font color="#000080">[</font><font color="#800000">$03</font><font color="#000080">]:=</font>hi<font color="#000080">(</font>l<font color="#000080">);
    </font>port<font color="#000080">[</font><font color="#800000">$0a</font><font color="#000080">]:=</font><font color="#800000">1</font><font color="#000080">;
    </font><font color="#FF0000"><b>if</b></font><font color="#000080">(</font>SBhighspeed<font color="#000080">=</font>false<font color="#000080">) </font><font color="#FF0000"><b>then
    begin
        </b></font>writesb<font color="#000080">(</font><font color="#800000">$14</font><font color="#000080">);
        </font>writesb<font color="#000080">(</font>lo<font color="#000080">(</font>l<font color="#000080">));
        </font>writesb<font color="#000080">(</font>hi<font color="#000080">(</font>l<font color="#000080">));
    </font><font color="#FF0000"><b>end
    else
    begin
        </b></font>writesb<font color="#000080">(</font><font color="#800000">$48</font><font color="#000080">);
        </font>writesb<font color="#000080">(</font>lo<font color="#000080">(</font>l<font color="#000080">));
        </font>writesb<font color="#000080">(</font>hi<font color="#000080">(</font>l<font color="#000080">));
        </font>writesb<font color="#000080">(</font><font color="#800000">$91</font><font color="#000080">);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font>s_len<font color="#000080">:=</font>s_len<font color="#000080">-</font>l<font color="#000080">;
    </font>s_low16<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
    </font>s_high4<font color="#000080">:=</font>s_high4<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>sbinter<font color="#000080">; </font>interrupt<font color="#000080">;
</font><font color="#FF0000"><b>var
    </b></font>a<font color="#000080">:</font>byte<font color="#000080">;

</font><font color="#FF0000"><b>begin
    </b></font>a<font color="#000080">:=</font>port<font color="#000080">[</font>SBio<font color="#000080">+</font><font color="#800000">14</font><font color="#000080">];
    </font><font color="#FF0000"><b>if</b></font><font color="#000080">(</font>s_len<font color="#000080">&gt;</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>then
        </b></font>outputcontinue
    <font color="#FF0000"><b>else
    begin
        </b></font>port<font color="#000080">[</font><font color="#800000">$0a</font><font color="#000080">]:=</font><font color="#800000">5</font><font color="#000080">;
        </font>SBstatus<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
        </font>a<font color="#000080">:=</font>port<font color="#000080">[</font>SBio<font color="#000080">+</font><font color="#800000">14</font><font color="#000080">];
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font>port<font color="#000080">[</font><font color="#800000">$20</font><font color="#000080">]:=</font><font color="#800000">$20</font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>setsb_int<font color="#000080">;
</font><font color="#FF0000"><b>begin
    if</b></font><font color="#000080">((</font>SBintset<font color="#000080">=</font>false<font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>SBio<font color="#000080">&lt;&gt;</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>SBint<font color="#000080">&lt;&gt;</font><font color="#800000">0</font><font color="#000080">)) </font><font color="#FF0000"><b>then
    begin
        </b></font>SBintset<font color="#000080">:=</font>true<font color="#000080">;
        </font>getintvec<font color="#000080">(</font><font color="#800000">8</font><font color="#000080">+</font>SBint<font color="#000080">,</font>oldint<font color="#000080">);
        </font>setintvec<font color="#000080">(</font><font color="#800000">8</font><font color="#000080">+</font>SBint<font color="#000080">,</font>addr<font color="#000080">(</font>sbinter<font color="#000080">));
        </font>port<font color="#000080">[</font><font color="#800000">$21</font><font color="#000080">]:=(</font>port<font color="#000080">[</font><font color="#800000">$21</font><font color="#000080">] </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font><font color="#800000">$ff</font><font color="#000080">-(</font><font color="#800000">1 </font><font color="#FF0000"><b>shl </b></font>SBint<font color="#000080">)));
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>outputsb<font color="#000080">;
</font><font color="#FF0000"><b>var
    </b></font>l<font color="#000080">:</font>word<font color="#000080">;

</font><font color="#FF0000"><b>begin
    if</b></font><font color="#000080">((</font>SBstatus<font color="#000080">=</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>SBio<font color="#000080">&lt;&gt;</font><font color="#800000">0</font><font color="#000080">)) </font><font color="#FF0000"><b>then
    begin
        </b></font>s_len<font color="#000080">:=</font>len<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">;
        </font>setsb_int<font color="#000080">;
        </font>setsb_speaker<font color="#000080">(</font>true<font color="#000080">);
        </font>SBstatus<font color="#000080">:=</font><font color="#800000">1</font><font color="#000080">;
        </font>s_low16<font color="#000080">:=</font>word<font color="#000080">(</font>ofs<font color="#000080">(</font>buffer<font color="#000080">^)+(</font>seg<font color="#000080">(</font>buffer<font color="#000080">^) </font><font color="#FF0000"><b>shl </b></font><font color="#800000">4</font><font color="#000080">));
        </font>s_high4<font color="#000080">:=</font>byte<font color="#000080">(((</font>ofs<font color="#000080">(</font>buffer<font color="#000080">^) </font><font color="#FF0000"><b>shr </b></font><font color="#800000">4</font><font color="#000080">)+</font>seg<font color="#000080">(</font>buffer<font color="#000080">^)) </font><font color="#FF0000"><b>shr </b></font><font color="#800000">12</font><font color="#000080">);
        </font>l<font color="#000080">:=</font><font color="#800000">$ffff</font><font color="#000080">-</font>s_low16<font color="#000080">;
        </font><font color="#FF0000"><b>if</b></font><font color="#000080">(</font>l<font color="#000080">&gt;</font>s_len<font color="#000080">) </font><font color="#FF0000"><b>then
            </b></font>l<font color="#000080">:=</font>s_len<font color="#000080">;
        </font>port<font color="#000080">[</font><font color="#800000">$0a</font><font color="#000080">]:=</font><font color="#800000">5</font><font color="#000080">;
        </font>port<font color="#000080">[</font><font color="#800000">$0c</font><font color="#000080">]:=</font><font color="#800000">0</font><font color="#000080">;
        </font>port<font color="#000080">[</font><font color="#800000">$0b</font><font color="#000080">]:=</font><font color="#800000">$49</font><font color="#000080">;
        </font>port<font color="#000080">[</font><font color="#800000">$02</font><font color="#000080">]:=</font>lo<font color="#000080">(</font>s_low16<font color="#000080">);
        </font>port<font color="#000080">[</font><font color="#800000">$02</font><font color="#000080">]:=</font>hi<font color="#000080">(</font>s_low16<font color="#000080">);
        </font>port<font color="#000080">[</font><font color="#800000">$83</font><font color="#000080">]:=</font>s_high4<font color="#000080">;
        </font>port<font color="#000080">[</font><font color="#800000">$03</font><font color="#000080">]:=</font>lo<font color="#000080">(</font>l<font color="#000080">);
        </font>port<font color="#000080">[</font><font color="#800000">$03</font><font color="#000080">]:=</font>hi<font color="#000080">(</font>l<font color="#000080">);
        </font>port<font color="#000080">[</font><font color="#800000">$0a</font><font color="#000080">]:=</font><font color="#800000">1</font><font color="#000080">;
        </font><font color="#FF0000"><b>if</b></font><font color="#000080">(</font>SBhighspeed<font color="#000080">=</font>false<font color="#000080">) </font><font color="#FF0000"><b>then
        begin
            </b></font>writesb<font color="#000080">(</font><font color="#800000">$14</font><font color="#000080">);
            </font>writesb<font color="#000080">(</font>lo<font color="#000080">(</font>l<font color="#000080">));
            </font>writesb<font color="#000080">(</font>hi<font color="#000080">(</font>l<font color="#000080">));
        </font><font color="#FF0000"><b>end
        else
        begin
            </b></font>writesb<font color="#000080">(</font><font color="#800000">$48</font><font color="#000080">);
            </font>writesb<font color="#000080">(</font>lo<font color="#000080">(</font>l<font color="#000080">));
            </font>writesb<font color="#000080">(</font>hi<font color="#000080">(</font>l<font color="#000080">));
            </font>writesb<font color="#000080">(</font><font color="#800000">$91</font><font color="#000080">);
        </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
        </font>s_len<font color="#000080">:=</font>s_len<font color="#000080">-</font>l<font color="#000080">;
        </font>s_low16<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
        </font>s_high4<font color="#000080">:=</font>s_high4<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>outputxmssb<font color="#000080">;
</font><font color="#FF0000"><b>var
    </b></font>l<font color="#000080">:</font>word<font color="#000080">;
    </font>info<font color="#000080">:</font>longint<font color="#000080">;

</font><font color="#FF0000"><b>begin
    if</b></font><font color="#000080">((</font>SBstatus<font color="#000080">=</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>SBio<font color="#000080">&lt;&gt;</font><font color="#800000">0</font><font color="#000080">)) </font><font color="#FF0000"><b>then
    begin
        </b></font>info<font color="#000080">:=</font>xms_getinfo<font color="#000080">(</font>buf<font color="#000080">);
        </font>s_len<font color="#000080">:=</font>longint<font color="#000080">(</font>longint<font color="#000080">(</font>word<font color="#000080">(</font>info<font color="#000080">)) </font><font color="#FF0000"><b>shl </b></font><font color="#800000">10</font><font color="#000080">)-</font><font color="#800000">1</font><font color="#000080">;
        </font>setsb_int<font color="#000080">;
        </font>setsb_speaker<font color="#000080">(</font>true<font color="#000080">);
        </font>SBstatus<font color="#000080">:=</font><font color="#800000">1</font><font color="#000080">;
        </font>info<font color="#000080">:=</font>xms_lock<font color="#000080">(</font>buf<font color="#000080">);
        </font>xms_unlock<font color="#000080">(</font>buf<font color="#000080">);
        </font>s_low16<font color="#000080">:=</font>word<font color="#000080">(</font>info<font color="#000080">);
        </font>s_high4<font color="#000080">:=</font>byte<font color="#000080">(</font>info <font color="#FF0000"><b>shr </b></font><font color="#800000">16</font><font color="#000080">);
        </font>l<font color="#000080">:=</font><font color="#800000">$ffff</font><font color="#000080">-</font>s_low16<font color="#000080">;
        </font><font color="#FF0000"><b>if</b></font><font color="#000080">(</font>l<font color="#000080">&gt;</font>s_len<font color="#000080">) </font><font color="#FF0000"><b>then
            </b></font>l<font color="#000080">:=</font>s_len<font color="#000080">;
        </font>port<font color="#000080">[</font><font color="#800000">$0a</font><font color="#000080">]:=</font><font color="#800000">5</font><font color="#000080">;
        </font>port<font color="#000080">[</font><font color="#800000">$0c</font><font color="#000080">]:=</font><font color="#800000">0</font><font color="#000080">;
        </font>port<font color="#000080">[</font><font color="#800000">$0b</font><font color="#000080">]:=</font><font color="#800000">$49</font><font color="#000080">;
        </font>port<font color="#000080">[</font><font color="#800000">$02</font><font color="#000080">]:=</font>lo<font color="#000080">(</font>s_low16<font color="#000080">);
        </font>port<font color="#000080">[</font><font color="#800000">$02</font><font color="#000080">]:=</font>hi<font color="#000080">(</font>s_low16<font color="#000080">);
        </font>port<font color="#000080">[</font><font color="#800000">$83</font><font color="#000080">]:=</font>s_high4<font color="#000080">;
        </font>port<font color="#000080">[</font><font color="#800000">$03</font><font color="#000080">]:=</font>lo<font color="#000080">(</font>l<font color="#000080">);
        </font>port<font color="#000080">[</font><font color="#800000">$03</font><font color="#000080">]:=</font>hi<font color="#000080">(</font>l<font color="#000080">);
        </font>port<font color="#000080">[</font><font color="#800000">$0a</font><font color="#000080">]:=</font><font color="#800000">1</font><font color="#000080">;
        </font><font color="#FF0000"><b>if</b></font><font color="#000080">(</font>SBhighspeed<font color="#000080">=</font>false<font color="#000080">) </font><font color="#FF0000"><b>then
        begin
            </b></font>writesb<font color="#000080">(</font><font color="#800000">$14</font><font color="#000080">);
            </font>writesb<font color="#000080">(</font>lo<font color="#000080">(</font>l<font color="#000080">));
            </font>writesb<font color="#000080">(</font>hi<font color="#000080">(</font>l<font color="#000080">));
        </font><font color="#FF0000"><b>end
        else
        begin
            </b></font>writesb<font color="#000080">(</font><font color="#800000">$48</font><font color="#000080">);
            </font>writesb<font color="#000080">(</font>lo<font color="#000080">(</font>l<font color="#000080">));
            </font>writesb<font color="#000080">(</font>hi<font color="#000080">(</font>l<font color="#000080">));
            </font>writesb<font color="#000080">(</font><font color="#800000">$91</font><font color="#000080">);
        </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
        </font>s_len<font color="#000080">:=</font>s_len<font color="#000080">-</font>l<font color="#000080">;
        </font>s_low16<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
        </font>s_high4<font color="#000080">:=</font>s_high4<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>deinitsb<font color="#000080">; </font><font color="#FF0000"><b>far</b></font><font color="#000080">;
</font><font color="#FF0000"><b>begin
    </b></font>exitproc<font color="#000080">:=</font>oldexitproc<font color="#000080">;
    </font><font color="#FF0000"><b>if</b></font><font color="#000080">(</font>SBio<font color="#000080">&lt;&gt;</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>then
    begin
        </b></font>setsb_speaker<font color="#000080">(</font>false<font color="#000080">);
        </font><font color="#FF0000"><b>if</b></font><font color="#000080">(</font>SBstatus<font color="#000080">&lt;&gt;</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>then
            </b></font>stopsb<font color="#000080">;
        </font>resetsb<font color="#000080">;
        </font><font color="#FF0000"><b>if</b></font><font color="#000080">(</font>SBintset<font color="#000080">=</font>true<font color="#000080">) </font><font color="#FF0000"><b>then
            </b></font>setintvec<font color="#000080">(</font><font color="#800000">8</font><font color="#000080">+</font>SBint<font color="#000080">,</font>oldint<font color="#000080">);
        </font>SBstatus<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>setsb_port<font color="#000080">;
</font><font color="#FF0000"><b>begin
    </b></font>SBstatus<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
    </font>SBint<font color="#000080">:=</font>int<font color="#000080">;
    </font>SBio<font color="#000080">:=</font>address<font color="#000080">;
    </font>resetsb<font color="#000080">;
    </font><font color="#FF0000"><b>if</b></font><font color="#000080">(</font>SBio<font color="#000080">&lt;&gt;</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>then
    begin
        </b></font>setsb_speaker<font color="#000080">(</font>false<font color="#000080">);
        </font>setsb_int<font color="#000080">;
        </font>SBstatus<font color="#000080">:=</font><font color="#800000">1</font><font color="#000080">;
        </font>writesb<font color="#000080">(</font><font color="#800000">$f2</font><font color="#000080">);
        </font>delay<font color="#000080">(</font><font color="#800000">100</font><font color="#000080">);
        </font><font color="#FF0000"><b>if</b></font><font color="#000080">(</font>SBstatus<font color="#000080">&lt;&gt;</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>then
        begin
            </b></font>deinitsb<font color="#000080">;
            </font>SBio<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
            </font>writeln<font color="#000080">(</font><font color="#800000">'IRQ failed'</font><font color="#000080">);
        </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>begin
    </b></font>oldexitproc<font color="#000080">:=</font>exitproc<font color="#000080">;
    </font>exitproc<font color="#000080">:=</font>addr<font color="#000080">(</font>deinitsb<font color="#000080">);
    </font>SBintset<font color="#000080">:=</font>false<font color="#000080">;
    </font>SBio<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
    </font>SBint<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">.


</font>_______
xms<font color="#000080">.</font>pas
<font color="#000080">~~~~~~~
</font><font color="#FF0000"><b>unit </b></font>xms<font color="#000080">;

</font><font color="#FF0000"><b>interface
type
    </b></font>xmsmove_type<font color="#000080">=</font><font color="#FF0000"><b>record
        </b></font>len<font color="#000080">:</font>longint<font color="#000080">;
        </font>s_handle<font color="#000080">:</font>word<font color="#000080">;
        </font>s_offset<font color="#000080">:</font>longint<font color="#000080">;
        </font>d_handle<font color="#000080">:</font>word<font color="#000080">;
        </font>d_offset<font color="#000080">:</font>longint<font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font>xmsmove_ptr<font color="#000080">=^</font>xmsmove_type<font color="#000080">;
    </font><font color="#008000"><i>{ For some unknown purpose, varables of xmsmove_type must be global
    and not local varables }

</i></font><font color="#FF0000"><b>function </b></font>xms_version<font color="#000080">:</font>word<font color="#000080">;              </font><font color="#008000"><i>{returns version number in BCD style}
</i></font><font color="#FF0000"><b>function </b></font>xms_enablea20<font color="#000080">:</font>word<font color="#000080">;            </font><font color="#008000"><i>{Allows direct access to blocks}
</i></font><font color="#FF0000"><b>function </b></font>xms_disablea20<font color="#000080">:</font>word<font color="#000080">;
</font><font color="#FF0000"><b>function </b></font>xms_statusa20<font color="#000080">:</font>word<font color="#000080">;
</font><font color="#FF0000"><b>function </b></font>xms_largestfree<font color="#000080">:</font>longint<font color="#000080">;       </font><font color="#008000"><i>{Max amount that can be allocated}
</i></font><font color="#FF0000"><b>function </b></font>xms_totalfree<font color="#000080">:</font>longint<font color="#000080">;         </font><font color="#008000"><i>{Total free xms memory}
</i></font><font color="#FF0000"><b>function </b></font>xms_getmem<font color="#000080">(</font>len<font color="#000080">:</font>longint<font color="#000080">):</font>word<font color="#000080">;  </font><font color="#008000"><i>{returns handle to block allocated}
</i></font><font color="#FF0000"><b>function </b></font>xms_freemem<font color="#000080">(</font>buf<font color="#000080">:</font>word<font color="#000080">):</font>word<font color="#000080">;    </font><font color="#008000"><i>{frees allocated block}
</i></font><font color="#FF0000"><b>function </b></font>xms_movemem<font color="#000080">(</font>m<font color="#000080">:</font>xmsmove_ptr<font color="#000080">):</font>word<font color="#000080">;</font><font color="#008000"><i>{moves data around for you, only even
                                          lengths are allowed}
</i></font><font color="#FF0000"><b>function </b></font>xms_lock<font color="#000080">(</font>buf<font color="#000080">:</font>word<font color="#000080">):</font>longint<font color="#000080">;    </font><font color="#008000"><i>{returns 32bit address}
</i></font><font color="#FF0000"><b>function </b></font>xms_unlock<font color="#000080">(</font>buf<font color="#000080">:</font>word<font color="#000080">):</font>word<font color="#000080">;
</font><font color="#FF0000"><b>function </b></font>xms_getinfo<font color="#000080">(</font>buf<font color="#000080">:</font>word<font color="#000080">):</font>longint<font color="#000080">; </font><font color="#008000"><i>{low word is size in kb}

</i></font><font color="#FF0000"><b>implementation
</b></font><font color="#008000"><i>{$S-}
{$I-}

</i></font><font color="#FF0000"><b>var
    </b></font>xmm<font color="#000080">:</font>pointer<font color="#000080">;
    </font>xms_installed<font color="#000080">:</font>boolean<font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>xms_version<font color="#000080">;
</font><font color="#FF0000"><b>var
    </b></font>c<font color="#000080">:</font>word<font color="#000080">;

</font><font color="#FF0000"><b>begin
    </b></font>c<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
    </font><font color="#FF0000"><b>asm
        </b></font><font color="#FF00FF">mov ax,$4300
        int $2f
        cmp al,80h
        jne @nodriver
        mov [c],1
@nodriver:
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>if</b></font><font color="#000080">(</font>c<font color="#000080">=</font><font color="#800000">1</font><font color="#000080">) </font><font color="#FF0000"><b>then
    begin
        asm
            </b></font><font color="#FF00FF">mov ax,$4310
            int $2f
            mov word ptr [xmm],bx
            mov bx,es
            mov word ptr [xmm+2],bx
            xor ah,ah
            call dword ptr [xmm]
            mov [c],ax
        </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
        </font>xms_version<font color="#000080">:=</font>c<font color="#000080">;
        </font>xms_installed<font color="#000080">:=</font>true<font color="#000080">;
    </font><font color="#FF0000"><b>end
    else
        </b></font>xms_version<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>xms_enablea20<font color="#000080">;
</font><font color="#FF0000"><b>var
    </b></font>c<font color="#000080">:</font>word<font color="#000080">;

</font><font color="#FF0000"><b>begin
    </b></font>xms_enablea20<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
    </font><font color="#FF0000"><b>if</b></font><font color="#000080">(</font>xms_installed<font color="#000080">) </font><font color="#FF0000"><b>then
    begin
        asm
            </b></font><font color="#FF00FF">mov ah,5
            call dword ptr [xmm]
            mov [c],ax
        </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
        </font>xms_enablea20<font color="#000080">:=</font>c<font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>xms_disablea20<font color="#000080">;
</font><font color="#FF0000"><b>var
    </b></font>c<font color="#000080">:</font>word<font color="#000080">;

</font><font color="#FF0000"><b>begin
    </b></font>xms_disablea20<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
    </font><font color="#FF0000"><b>if</b></font><font color="#000080">(</font>xms_installed<font color="#000080">) </font><font color="#FF0000"><b>then
    begin
        asm
            </b></font><font color="#FF00FF">mov ah,6
            call dword ptr [xmm]
            mov [c],ax
        </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
        </font>xms_disablea20<font color="#000080">:=</font>c<font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>xms_statusa20<font color="#000080">;
</font><font color="#FF0000"><b>var
    </b></font>c<font color="#000080">:</font>word<font color="#000080">;

</font><font color="#FF0000"><b>begin
    </b></font>xms_statusa20<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
    </font><font color="#FF0000"><b>if</b></font><font color="#000080">(</font>xms_installed<font color="#000080">) </font><font color="#FF0000"><b>then
    begin
        asm
            </b></font><font color="#FF00FF">mov ah,7
            call dword ptr [xmm]
            mov [c],ax
        </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
        </font>xms_statusa20<font color="#000080">:=</font>c<font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>xms_largestfree<font color="#000080">;
</font><font color="#FF0000"><b>var
    </b></font>c<font color="#000080">:</font>word<font color="#000080">;

</font><font color="#FF0000"><b>begin
    </b></font>xms_largestfree<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
    </font><font color="#FF0000"><b>if</b></font><font color="#000080">(</font>xms_installed<font color="#000080">) </font><font color="#FF0000"><b>then
    begin
        asm
            </b></font><font color="#FF00FF">mov ah,8
            call dword ptr [xmm]
            mov [c],ax
        </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
        </font>xms_largestfree<font color="#000080">:=</font>longint<font color="#000080">(</font>c<font color="#000080">) </font><font color="#FF0000"><b>shl </b></font><font color="#800000">10</font><font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>xms_totalfree<font color="#000080">;
</font><font color="#FF0000"><b>var
    </b></font>c<font color="#000080">:</font>word<font color="#000080">;

</font><font color="#FF0000"><b>begin
    </b></font>xms_totalfree<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
    </font><font color="#FF0000"><b>if</b></font><font color="#000080">(</font>xms_installed<font color="#000080">) </font><font color="#FF0000"><b>then
    begin
        asm
            </b></font><font color="#FF00FF">mov ah,8
            call dword ptr [xmm]
            mov [c],dx
        </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
        </font>xms_totalfree<font color="#000080">:=</font>longint<font color="#000080">(</font>c<font color="#000080">) </font><font color="#FF0000"><b>shl </b></font><font color="#800000">10</font><font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>xms_getmem<font color="#000080">;
</font><font color="#FF0000"><b>var
    </b></font>c<font color="#000080">:</font>word<font color="#000080">;

</font><font color="#FF0000"><b>begin
    </b></font>xms_getmem<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
    </font><font color="#FF0000"><b>if</b></font><font color="#000080">(</font>xms_installed<font color="#000080">) </font><font color="#FF0000"><b>then
    begin
        </b></font>c<font color="#000080">:=</font>word<font color="#000080">((</font>len <font color="#FF0000"><b>shr </b></font><font color="#800000">10</font><font color="#000080">)+</font><font color="#800000">1</font><font color="#000080">);
        </font><font color="#FF0000"><b>asm
            </b></font><font color="#FF00FF">mov dx,[c]
            mov ah,9
            call dword ptr [xmm]
            mov [c],dx
        </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
        </font>xms_getmem<font color="#000080">:=</font>c<font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>xms_freemem<font color="#000080">;
</font><font color="#FF0000"><b>var
    </b></font>c<font color="#000080">:</font>word<font color="#000080">;

</font><font color="#FF0000"><b>begin
    </b></font>xms_freemem<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
    </font><font color="#FF0000"><b>if</b></font><font color="#000080">(</font>xms_installed<font color="#000080">) </font><font color="#FF0000"><b>then
    begin
        asm
            </b></font><font color="#FF00FF">mov dx,[buf]
            mov ah,10
            call dword ptr [xmm]
            mov [c],ax
        </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
        </font>xms_freemem<font color="#000080">:=</font>c<font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>xms_movemem<font color="#000080">;
</font><font color="#FF0000"><b>var
    </b></font>c<font color="#000080">:</font>word<font color="#000080">;

</font><font color="#FF0000"><b>begin
    </b></font>xms_movemem<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
    </font><font color="#FF0000"><b>if</b></font><font color="#000080">(</font>xms_installed<font color="#000080">) </font><font color="#FF0000"><b>then
    begin
        asm
            </b></font><font color="#FF00FF">push ds
            push si
            mov  bx,word ptr [m+2]
            mov  si,word ptr [m]
            mov  ds,bx
            mov  ah,11
            call dword ptr [xmm]
            mov  [c],ax
            pop  si
            pop  ds
        </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
        </font>xms_movemem<font color="#000080">:=</font>c<font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>xms_lock<font color="#000080">;
</font><font color="#FF0000"><b>var
    </b></font>c<font color="#000080">:</font>longint<font color="#000080">;

</font><font color="#FF0000"><b>begin
    </b></font>xms_lock<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
    </font><font color="#FF0000"><b>if</b></font><font color="#000080">(</font>xms_installed<font color="#000080">) </font><font color="#FF0000"><b>then
    begin
        asm
            </b></font><font color="#FF00FF">mov dx,[buf]
            mov ah,12
            call dword ptr [xmm]
            mov word ptr [c],bx
            mov word ptr [c+2],dx
        </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
        </font>xms_lock<font color="#000080">:=</font>c<font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>xms_unlock<font color="#000080">;
</font><font color="#FF0000"><b>var
    </b></font>c<font color="#000080">:</font>word<font color="#000080">;

</font><font color="#FF0000"><b>begin
    </b></font>xms_unlock<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
    </font><font color="#FF0000"><b>if</b></font><font color="#000080">(</font>xms_installed<font color="#000080">) </font><font color="#FF0000"><b>then
    begin
        asm
            </b></font><font color="#FF00FF">mov dx,[buf]
            mov ah,13
            call dword ptr [xmm]
            mov [c],ax
        </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
        </font>xms_unlock<font color="#000080">:=</font>c<font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>xms_getinfo<font color="#000080">;
</font><font color="#FF0000"><b>var
    </b></font>c<font color="#000080">:</font>longint<font color="#000080">;

</font><font color="#FF0000"><b>begin
    </b></font>xms_getinfo<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
    </font><font color="#FF0000"><b>if</b></font><font color="#000080">(</font>xms_installed<font color="#000080">) </font><font color="#FF0000"><b>then
    begin
        asm
            </b></font><font color="#FF00FF">mov dx,[buf]
            mov ah,14
            call dword ptr [xmm]
            mov word ptr [c],dx
            mov word ptr [c+2],bx
        </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
        </font>xms_getinfo<font color="#000080">:=</font>c<font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>begin
    </b></font>xms_installed<font color="#000080">:=</font>false<font color="#000080">;
    </font>xms_version<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to SOUND SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0086.PAS">Original</a><b>]</b></p></body>
</html>
