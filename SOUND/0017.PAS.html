<html>
<head><title> "Play SOUNDS in Background" by LARRY HADLEY</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to SOUND SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0017.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{  SEE XX34 modules at end of document !!!}

{$R-,F+}

{
  ******************************************************************
  BGSND.PAS

  Background Sound for Turbo Pascal

  Adapted from BGSND.INC for Turbo Pascal 3.0
  by Michael Quinlan
  9/17/85

  This version for Turbo Pascal 6.0
  by Larry Hadley
  3/20/93

  The routines are rather primitive, but could easily be extended.

  The sample routines included implement something similar to the
  BASIC PLAY statement.
  ******************************************************************
}
</i></font><font color="#FF0000"><b>Unit </b></font>BGSND<font color="#000080">;

</font><font color="#FF0000"><b>INTERFACE

Uses
   </b></font>DOS<font color="#000080">;

</font><font color="#FF0000"><b>CONST
   </b></font>BGSVer <font color="#000080">= </font><font color="#800000">'2.0'</font><font color="#000080">;               </font><font color="#008000"><i>{ Unit version number }

   </i></font>BGSPlaying <font color="#000080">:</font>boolean <font color="#000080">= </font>FALSE<font color="#000080">;  </font><font color="#008000"><i>{ TRUE while music is playing }

</i></font><font color="#FF0000"><b>VAR
   </b></font>_BGSNumItems <font color="#000080">:</font>integer<font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>BGSPlay<font color="#000080">(</font>n <font color="#000080">:</font>integer<font color="#000080">; </font><font color="#FF0000"><b>VAR </b></font>items<font color="#000080">);

</font><font color="#FF0000"><b>procedure </b></font>_BGSStopPlay<font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>PlayMusic<font color="#000080">(</font>s <font color="#000080">:</font><font color="#FF0000"><b>string</b></font><font color="#000080">);

</font><font color="#FF0000"><b>IMPLEMENTATION

TYPE
   </b></font>BGSItem <font color="#000080">= </font><font color="#FF0000"><b>RECORD
                </b></font>cnt <font color="#000080">:</font>word<font color="#000080">;     </font><font color="#008000"><i>{ count to load into the 8253-5 timer;
                                 count = 1,193,180 / frequency }
                </i></font>tics<font color="#000080">:</font>integer<font color="#000080">;  </font><font color="#008000"><i>{ timer tics to maintain the sound;
                                 18.2 tics per second }
             </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

   </font>_BGSItemP <font color="#000080">= ^</font>BGSItem<font color="#000080">;

</font><font color="#FF0000"><b>VAR
   </b></font>_BGSNextItem <font color="#000080">:</font>_BGSItemP<font color="#000080">;
   </font>_BGSOldInt1C <font color="#000080">:</font>pointer<font color="#000080">;
   </font>_BGSDuration <font color="#000080">:</font>integer<font color="#000080">;
   </font>ExitSave     <font color="#000080">:</font>pointer<font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>_BGSsaveDS<font color="#000080">; </font><font color="#FF0000"><b>external</b></font><font color="#000080">;      </font><font color="#008000"><i>{ saves ds as a CS:CONSTANT for use
                                        within the int 1C vector }
</i></font><font color="#FF0000"><b>procedure </b></font>_BGSPlayNextItem<font color="#000080">; </font><font color="#FF0000"><b>external</b></font><font color="#000080">; </font><font color="#008000"><i>{ used by int 1C vector - selects next
                                        note to play }
</i></font><font color="#FF0000"><b>procedure </b></font>_BGSStopPlay<font color="#000080">; </font><font color="#FF0000"><b>external</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>_BGSInt1C<font color="#000080">; </font><font color="#FF0000"><b>external</b></font><font color="#000080">;        </font><font color="#008000"><i>{ int1C vector - hooks timer }
{$L BGS.OBJ}

</i></font><font color="#FF0000"><b>procedure </b></font>BGSPlay<font color="#000080">(</font>n <font color="#000080">:</font>integer<font color="#000080">; </font><font color="#FF0000"><b>VAR </b></font>items<font color="#000080">);
</font><font color="#008000"><i>{
  ***************************************************************************
  You call this procedure to play music in the background. You pass the
  number of sound segments, and an array with an element for each sound
  segment. The array elements are two words each; the first word has the
  count to be loaded into the timer (1,193,180 / frequency). The second word
  has the duration of the sound segment, in timer tics (18.2 tics per second).
  ***************************************************************************
}
  </i></font><font color="#FF0000"><b>VAR
     </b></font>item_list <font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">1000</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>BGSItem <font color="#FF0000"><b>ABSOLUTE </b></font>items<font color="#000080">;
  </font><font color="#FF0000"><b>BEGIN
     while </b></font>BGSPlaying <font color="#FF0000"><b>do </b></font><font color="#008000"><i>{ wait for previous sounds to finish } </i></font><font color="#000080">;

     </font><font color="#FF0000"><b>if </b></font>n <font color="#000080">&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then
     BEGIN
        </b></font>_BGSNumItems <font color="#000080">:= </font>n<font color="#000080">;
        </font>_BGSNextItem <font color="#000080">:= </font>Addr<font color="#000080">(</font>item_list<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">]);
        </font>BGSPlaying   <font color="#000080">:= </font>TRUE<font color="#000080">;
        </font>_BGSPlayNextItem<font color="#000080">;
        </font>_BGSsaveDS<font color="#000080">;
        </font>SetIntVec<font color="#000080">(</font><font color="#800000">$1C</font><font color="#000080">, @</font>_BGSInt1C<font color="#000080">);
     </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>BGSErrorExit<font color="#000080">;
</font><font color="#008000"><i>{
 **************************************************************************
 In case there's an &quot;oopsie&quot; ... make sure that Int $1C is clean, and
 music isn't playing.
 **************************************************************************
}
  </i></font><font color="#FF0000"><b>BEGIN
     </b></font>ExitProc <font color="#000080">:= </font>ExitSave<font color="#000080">;
     </font><font color="#FF0000"><b>if </b></font>BGSPLaying <font color="#FF0000"><b>then
     BEGIN
        </b></font>_BGSStopPlay<font color="#000080">;
        </font>SetIntVec<font color="#000080">(</font><font color="#800000">$1C</font><font color="#000080">, </font>_BGSOldInt1C<font color="#000080">);
     </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#008000"><i>{
 **************************************************************************

    BASIC PLAY Routines

 **************************************************************************
}

{$R+}

</i></font><font color="#FF0000"><b>VAR
   </b></font>MusicArea <font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">255</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>BGSItem<font color="#000080">; </font><font color="#008000"><i>{ contains sound segments }

{
  frequency table from:
  Peter Norton's Programmer's Guide to the IBM PC, p. 147
}
</i></font><font color="#FF0000"><b>CONST
   </b></font>Frequency <font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">83</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>real <font color="#000080">=
</font><font color="#008000"><i>{    C        C#       D        D#       E        F        F#       G        G#       A        A#       B }
  </i></font><font color="#000080">(</font><font color="#800000">32.70</font><font color="#000080">,   </font><font color="#800000">34.65</font><font color="#000080">,   </font><font color="#800000">36.71</font><font color="#000080">,   </font><font color="#800000">38.89</font><font color="#000080">,   </font><font color="#800000">41.20</font><font color="#000080">,   </font><font color="#800000">43.65</font><font color="#000080">,   </font><font color="#800000">46.25</font><font color="#000080">,   </font><font color="#800000">49.00</font><font color="#000080">,   </font><font color="#800000">51.91</font><font color="#000080">,   </font><font color="#800000">55.00</font><font color="#000080">,   </font><font color="#800000">58.27</font><font color="#000080">,   </font><font color="#800000">61.74</font><font color="#000080">,
   </font><font color="#800000">65.41</font><font color="#000080">,   </font><font color="#800000">69.30</font><font color="#000080">,   </font><font color="#800000">73.42</font><font color="#000080">,   </font><font color="#800000">77.78</font><font color="#000080">,   </font><font color="#800000">82.41</font><font color="#000080">,   </font><font color="#800000">87.31</font><font color="#000080">,   </font><font color="#800000">92.50</font><font color="#000080">,   </font><font color="#800000">98.00</font><font color="#000080">,  </font><font color="#800000">103.83</font><font color="#000080">,  </font><font color="#800000">110.00</font><font color="#000080">,  </font><font color="#800000">116.54</font><font color="#000080">,  </font><font color="#800000">123.47</font><font color="#000080">,
  </font><font color="#800000">130.81</font><font color="#000080">,  </font><font color="#800000">138.59</font><font color="#000080">,  </font><font color="#800000">146.83</font><font color="#000080">,  </font><font color="#800000">155.56</font><font color="#000080">,  </font><font color="#800000">164.81</font><font color="#000080">,  </font><font color="#800000">174.61</font><font color="#000080">,  </font><font color="#800000">185.00</font><font color="#000080">,  </font><font color="#800000">196.00</font><font color="#000080">,  </font><font color="#800000">207.65</font><font color="#000080">,  </font><font color="#800000">220.00</font><font color="#000080">,  </font><font color="#800000">233.08</font><font color="#000080">,  </font><font color="#800000">246.94</font><font color="#000080">,
  </font><font color="#800000">261.63</font><font color="#000080">,  </font><font color="#800000">277.18</font><font color="#000080">,  </font><font color="#800000">293.66</font><font color="#000080">,  </font><font color="#800000">311.13</font><font color="#000080">,  </font><font color="#800000">329.63</font><font color="#000080">,  </font><font color="#800000">349.23</font><font color="#000080">,  </font><font color="#800000">369.99</font><font color="#000080">,  </font><font color="#800000">392.00</font><font color="#000080">,  </font><font color="#800000">415.30</font><font color="#000080">,  </font><font color="#800000">440.00</font><font color="#000080">,  </font><font color="#800000">466.16</font><font color="#000080">,  </font><font color="#800000">493.88</font><font color="#000080">,
  </font><font color="#800000">523.25</font><font color="#000080">,  </font><font color="#800000">554.37</font><font color="#000080">,  </font><font color="#800000">587.33</font><font color="#000080">,  </font><font color="#800000">622.25</font><font color="#000080">,  </font><font color="#800000">659.26</font><font color="#000080">,  </font><font color="#800000">698.46</font><font color="#000080">,  </font><font color="#800000">739.99</font><font color="#000080">,  </font><font color="#800000">783.99</font><font color="#000080">,  </font><font color="#800000">830.61</font><font color="#000080">,  </font><font color="#800000">880.00</font><font color="#000080">,  </font><font color="#800000">932.33</font><font color="#000080">,  </font><font color="#800000">987.77</font><font color="#000080">,
 </font><font color="#800000">1046.50</font><font color="#000080">, </font><font color="#800000">1108.73</font><font color="#000080">, </font><font color="#800000">1174.66</font><font color="#000080">, </font><font color="#800000">1244.51</font><font color="#000080">, </font><font color="#800000">1378.51</font><font color="#000080">, </font><font color="#800000">1396.91</font><font color="#000080">, </font><font color="#800000">1479.98</font><font color="#000080">, </font><font color="#800000">1567.98</font><font color="#000080">, </font><font color="#800000">1661.22</font><font color="#000080">, </font><font color="#800000">1760.00</font><font color="#000080">, </font><font color="#800000">1864.66</font><font color="#000080">, </font><font color="#800000">1975.53</font><font color="#000080">,
 </font><font color="#800000">2093.00</font><font color="#000080">, </font><font color="#800000">2217.46</font><font color="#000080">, </font><font color="#800000">2349.32</font><font color="#000080">, </font><font color="#800000">2489.02</font><font color="#000080">, </font><font color="#800000">2637.02</font><font color="#000080">, </font><font color="#800000">2793.83</font><font color="#000080">, </font><font color="#800000">2959.96</font><font color="#000080">, </font><font color="#800000">3135.96</font><font color="#000080">, </font><font color="#800000">3322.44</font><font color="#000080">, </font><font color="#800000">3520.00</font><font color="#000080">, </font><font color="#800000">3729.31</font><font color="#000080">, </font><font color="#800000">3951.07
  </font><font color="#000080">);

</font><font color="#FF0000"><b>procedure </b></font>PlayMusic<font color="#000080">(</font>s <font color="#000080">:</font><font color="#FF0000"><b>string</b></font><font color="#000080">);
</font><font color="#008000"><i>{
  ***************************************************************************
  Accept a string similar to the BASIC PLAY statement. The following are

  allowed:
    A to G with optional #

    Plays the indicated note in the current octave.
    A # following the letter indicates sharp.
    A number following the letter indicates the length of the note
    (4 = quarter note, 16 = sixteenth note, 1 = whole note, etc.).

    On

    Sets the octave to &quot;n&quot;. There are 7 octaves, numbered 0 to 6. Each
    octave goes from C to B. Octave 3 starts with middle C.

    Ln

    Sets the default length of following notes. L1 = whole notes, L2 = half
    notes, etc. The length can be overridden for a specific note by follow-
    ing the note letter with a number.

    Pn

    Pause. n specifies the length of the pause, just like a note.

    Tn

    Tempo. Number of quarter notes per minute. Default is 120.

    Period (.) terminates processing.

    Spaces are allowed between items, but not within items.
  ***************************************************************************
}

   </i></font><font color="#FF0000"><b>VAR
      </b></font>i<font color="#000080">, </font>n<font color="#000080">,            </font><font color="#008000"><i>{ i is the offset in the parameter string;
                         n is the element number in MusicArea }
      </i></font>NoteLength<font color="#000080">,
      </font>Tempo<font color="#000080">,
      </font>CurrentOctave <font color="#000080">:</font>integer<font color="#000080">;
      </font>cchar         <font color="#000080">:</font>char<font color="#000080">;

   </font><font color="#FF0000"><b>function </b></font>GetNumber<font color="#000080">:</font>integer<font color="#000080">;
   </font><font color="#008000"><i>{
    **************************************************************************
    get a number from the parameter string
    increments i past the end of the number
    **************************************************************************
   }
      </i></font><font color="#FF0000"><b>VAR
         </b></font>n <font color="#000080">:</font>integer<font color="#000080">;
      </font><font color="#FF0000"><b>BEGIN
         </b></font>n <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
         </font><font color="#FF0000"><b>WHILE </b></font><font color="#000080">(</font>i <font color="#000080">&lt;= </font>length<font color="#000080">(</font>s<font color="#000080">)) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>s<font color="#000080">[</font>i<font color="#000080">] </font><font color="#FF0000"><b>in </b></font><font color="#000080">[</font><font color="#800000">'0'</font><font color="#000080">..</font><font color="#800000">'9'</font><font color="#000080">]) </font><font color="#FF0000"><b>do
         BEGIN
            </b></font>n <font color="#000080">:= </font>n<font color="#000080">*</font><font color="#800000">10</font><font color="#000080">+(</font>Ord<font color="#000080">(</font>s<font color="#000080">[</font>i<font color="#000080">])-</font>Ord<font color="#000080">(</font><font color="#800000">'0'</font><font color="#000080">));
            </font>i <font color="#000080">:= </font>i<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">;
         </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
         </font>GetNumber <font color="#000080">:= </font>n<font color="#000080">;
      </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

   </font><font color="#FF0000"><b>procedure </b></font>GetNote<font color="#000080">;
   </font><font color="#008000"><i>{
    **************************************************************************
    Input is a note letter. convert it to two sound segments -- one for the
    sound then a pause following the sound.
    increments i past the current item
    **************************************************************************
   }
      </i></font><font color="#FF0000"><b>VAR
         </b></font>note<font color="#000080">,
         </font>len  <font color="#000080">:</font>integer<font color="#000080">;
         </font>l    <font color="#000080">:</font>real<font color="#000080">;

      </font><font color="#FF0000"><b>function </b></font>CheckSharp<font color="#000080">(</font>n <font color="#000080">:</font>integer<font color="#000080">):</font>integer<font color="#000080">;
      </font><font color="#008000"><i>{
       ************************************************************************
       check for a sharp following the letter. increments i if one found
       ************************************************************************
      }
         </i></font><font color="#FF0000"><b>BEGIN
            if </b></font><font color="#000080">(</font>i <font color="#000080">&lt; </font>length<font color="#000080">(</font>s<font color="#000080">)) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>s<font color="#000080">[</font>i<font color="#000080">] = </font><font color="#800000">'#'</font><font color="#000080">) </font><font color="#FF0000"><b>then
            BEGIN
               </b></font>i <font color="#000080">:= </font>i <font color="#000080">+ </font><font color="#800000">1</font><font color="#000080">;
               </font>CheckSharp <font color="#000080">:= </font>n <font color="#000080">+ </font><font color="#800000">1
            </font><font color="#FF0000"><b>END
            ELSE
               </b></font>CheckSharp <font color="#000080">:= </font>n<font color="#000080">;
         </font><font color="#FF0000"><b>END</b></font><font color="#000080">;  </font><font color="#008000"><i>{ CheckSharp }

      </i></font><font color="#FF0000"><b>function </b></font>FreqToCount<font color="#000080">(</font>f <font color="#000080">: </font>real<font color="#000080">) : </font>integer<font color="#000080">;
      </font><font color="#008000"><i>{
        ***********************************************************************
        convert a frequency to a timer count
        ***********************************************************************
      }
         </i></font><font color="#FF0000"><b>BEGIN
            </b></font>FreqToCount <font color="#000080">:= </font>Round<font color="#000080">(</font><font color="#800000">1193180.0</font><font color="#000080">/</font>f<font color="#000080">);
         </font><font color="#FF0000"><b>END</b></font><font color="#000080">;  </font><font color="#008000"><i>{ FreqToCount }

      </i></font><font color="#FF0000"><b>BEGIN  </b></font><font color="#008000"><i>{ GetNote }
         </i></font><font color="#FF0000"><b>case </b></font>cchar <font color="#FF0000"><b>of
          </b></font><font color="#800000">'A' </font><font color="#000080">: </font>note <font color="#000080">:= </font>CheckSharp<font color="#000080">(</font><font color="#800000">9</font><font color="#000080">);
          </font><font color="#800000">'B' </font><font color="#000080">: </font>note <font color="#000080">:= </font><font color="#800000">11</font><font color="#000080">;
          </font><font color="#800000">'C' </font><font color="#000080">: </font>note <font color="#000080">:= </font>CheckSharp<font color="#000080">(</font><font color="#800000">0</font><font color="#000080">);
          </font><font color="#800000">'D' </font><font color="#000080">: </font>note <font color="#000080">:= </font>CheckSharp<font color="#000080">(</font><font color="#800000">2</font><font color="#000080">);
          </font><font color="#800000">'E' </font><font color="#000080">: </font>note <font color="#000080">:= </font><font color="#800000">4</font><font color="#000080">;
          </font><font color="#800000">'F' </font><font color="#000080">: </font>note <font color="#000080">:= </font>CheckSharp<font color="#000080">(</font><font color="#800000">5</font><font color="#000080">);
          </font><font color="#800000">'G' </font><font color="#000080">: </font>note <font color="#000080">:= </font>CheckSharp<font color="#000080">(</font><font color="#800000">7</font><font color="#000080">)
         </font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{ case }

         </i></font>MusicArea<font color="#000080">[</font>n<font color="#000080">].</font>cnt <font color="#000080">:= </font>FreqToCount<font color="#000080">(</font>Frequency<font color="#000080">[(</font>CurrentOctave<font color="#000080">*</font><font color="#800000">12</font><font color="#000080">)+</font>note<font color="#000080">]);
         </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>s<font color="#000080">[</font>i<font color="#000080">] </font><font color="#FF0000"><b>in </b></font><font color="#000080">[</font><font color="#800000">'0'</font><font color="#000080">..</font><font color="#800000">'9'</font><font color="#000080">]) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>i <font color="#000080">&lt;= </font>length<font color="#000080">(</font>s<font color="#000080">)) </font><font color="#FF0000"><b>then
            </b></font>len <font color="#000080">:= </font>GetNumber
         <font color="#FF0000"><b>else
            </b></font>len <font color="#000080">:= </font>NoteLength<font color="#000080">;
         </font>l <font color="#000080">:= </font><font color="#800000">18.2</font><font color="#000080">*</font><font color="#800000">60.0</font><font color="#000080">*</font><font color="#800000">4.0</font><font color="#000080">/(</font>Tempo<font color="#000080">*</font>len<font color="#000080">);
         </font>MusicArea<font color="#000080">[</font>n<font color="#000080">].</font>tics <font color="#000080">:= </font>Round<font color="#000080">(</font><font color="#800000">7.0</font><font color="#000080">*</font>l<font color="#000080">/</font><font color="#800000">8.0</font><font color="#000080">);

         </font><font color="#FF0000"><b>if </b></font>MusicArea<font color="#000080">[</font>n<font color="#000080">].</font>tics <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>then
            </b></font>MusicArea<font color="#000080">[</font>n<font color="#000080">].</font>tics <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;
         </font>n <font color="#000080">:= </font>n <font color="#000080">+ </font><font color="#800000">1</font><font color="#000080">;
         </font>MusicArea<font color="#000080">[</font>n<font color="#000080">].</font>cnt <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
         </font>MusicArea<font color="#000080">[</font>n<font color="#000080">].</font>tics <font color="#000080">:= </font>Round<font color="#000080">(</font>l<font color="#000080">/</font><font color="#800000">8.0</font><font color="#000080">);

         </font><font color="#FF0000"><b>if </b></font>MusicArea<font color="#000080">[</font>n<font color="#000080">].</font>tics <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>then
            </b></font>MusicArea<font color="#000080">[</font>n<font color="#000080">].</font>tics <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;
         </font>n <font color="#000080">:= </font>n <font color="#000080">+ </font><font color="#800000">1</font><font color="#000080">;
      </font><font color="#FF0000"><b>END</b></font><font color="#000080">;  </font><font color="#008000"><i>{ GetNote }

      </i></font><font color="#FF0000"><b>procedure </b></font>GetPause<font color="#000080">;
      </font><font color="#008000"><i>{
       ************************************************************************
       input is a pause. convert it to a silent sound segment.
       increments i past the current item
       ************************************************************************
      }
         </i></font><font color="#FF0000"><b>VAR
            </b></font>len  <font color="#000080">:</font>integer<font color="#000080">;
            </font>l    <font color="#000080">:</font>real<font color="#000080">;

         </font><font color="#FF0000"><b>BEGIN  </b></font><font color="#008000"><i>{ GetPause }
            </i></font>MusicArea<font color="#000080">[</font>n<font color="#000080">].</font>cnt <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
            </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>s<font color="#000080">[</font>i<font color="#000080">] </font><font color="#FF0000"><b>in </b></font><font color="#000080">[</font><font color="#800000">'0'</font><font color="#000080">..</font><font color="#800000">'9'</font><font color="#000080">]) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>i <font color="#000080">&lt;= </font>length<font color="#000080">(</font>s<font color="#000080">)) </font><font color="#FF0000"><b>then
               </b></font>len <font color="#000080">:= </font>GetNumber
            <font color="#FF0000"><b>else
               </b></font>len <font color="#000080">:= </font>NoteLength<font color="#000080">;
            </font>l <font color="#000080">:= </font><font color="#800000">18.2</font><font color="#000080">*</font><font color="#800000">60.0</font><font color="#000080">*</font><font color="#800000">4.0</font><font color="#000080">/(</font>Tempo<font color="#000080">*</font>len<font color="#000080">);
            </font>MusicArea<font color="#000080">[</font>n<font color="#000080">].</font>tics <font color="#000080">:= </font>Round<font color="#000080">(</font>l<font color="#000080">);
            </font><font color="#FF0000"><b>if </b></font>MusicArea<font color="#000080">[</font>n<font color="#000080">].</font>tics <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>then
               </b></font>MusicArea<font color="#000080">[</font>n<font color="#000080">].</font>tics <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;
            </font>n <font color="#000080">:= </font>n <font color="#000080">+ </font><font color="#800000">1</font><font color="#000080">;
         </font><font color="#FF0000"><b>END</b></font><font color="#000080">;  </font><font color="#008000"><i>{ GetPause }

   </i></font><font color="#FF0000"><b>BEGIN </b></font><font color="#008000"><i>{ PlayMusic }
      </i></font>NoteLength <font color="#000080">:= </font><font color="#800000">4</font><font color="#000080">;
      </font>Tempo <font color="#000080">:= </font><font color="#800000">120</font><font color="#000080">;
      </font>CurrentOctave <font color="#000080">:= </font><font color="#800000">3</font><font color="#000080">;

      </font>n <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;
      </font>i <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;
      </font><font color="#FF0000"><b>while </b></font><font color="#000080">(</font>i <font color="#000080">&lt;= </font>length<font color="#000080">(</font>s<font color="#000080">)) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>s<font color="#000080">[</font>i<font color="#000080">]&lt;&gt;</font><font color="#800000">'.'</font><font color="#000080">) </font><font color="#FF0000"><b>do
      BEGIN
         </b></font>cchar <font color="#000080">:= </font>s<font color="#000080">[</font>i<font color="#000080">];
         </font>i <font color="#000080">:= </font>i <font color="#000080">+ </font><font color="#800000">1</font><font color="#000080">;
         </font><font color="#FF0000"><b>case </b></font>cchar <font color="#FF0000"><b>of
          </b></font><font color="#800000">'A'</font><font color="#000080">..</font><font color="#800000">'G' </font><font color="#000080">: </font>GetNote<font color="#000080">;
          </font><font color="#800000">'O'      </font><font color="#000080">: </font>CurrentOctave <font color="#000080">:= </font>GetNumber<font color="#000080">;
          </font><font color="#800000">'L'      </font><font color="#000080">: </font>NoteLength    <font color="#000080">:= </font>GetNumber<font color="#000080">;
          </font><font color="#800000">'P'      </font><font color="#000080">: </font>GetPause<font color="#000080">;
          </font><font color="#800000">'T'      </font><font color="#000080">: </font>Tempo         <font color="#000080">:= </font>Getnumber
         <font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{ case }
      </i></font><font color="#FF0000"><b>END</b></font><font color="#000080">;
      </font>BGSPlay<font color="#000080">(</font>n<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">, </font>MusicArea<font color="#000080">)
   </font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>{ PlayMusic }

</i></font><font color="#FF0000"><b>BEGIN </b></font><font color="#008000"><i>{ Unit init code }
  </i></font>ExitSave <font color="#000080">:= </font>ExitProc<font color="#000080">;
  </font>ExitProc <font color="#000080">:= @</font>BGSErrorExit<font color="#000080">;

  </font>GetIntVec<font color="#000080">(</font><font color="#800000">$1C</font><font color="#000080">, </font>_BGSOldInt1C<font color="#000080">);

  </font>Writeln<font color="#000080">(</font><font color="#800000">'BGS v'</font><font color="#000080">+</font>BGSVer<font color="#000080">);
</font><font color="#FF0000"><b>END</b></font><font color="#000080">.

</font><font color="#008000"><i>(*   DEMO PROGRAM FOR BACKGROUND SOUND *)

{$M 1024, 0, 0}
</i></font><font color="#FF0000"><b>Program </b></font>PlayBG<font color="#000080">;

</font><font color="#FF0000"><b>Uses
   </b></font>DOS<font color="#000080">,
   </font>CRT<font color="#000080">,
   </font>BGSND<font color="#000080">;

</font><font color="#FF0000"><b>VAR
   </b></font>F1              <font color="#000080">:</font>text<font color="#000080">;
   </font>play_str<font color="#000080">, </font>buf<font color="#000080">,
   </font>fname<font color="#000080">, </font>progname <font color="#000080">:</font><font color="#FF0000"><b>string</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>Usage<font color="#000080">;
   </font><font color="#FF0000"><b>BEGIN
      </b></font>Writeln<font color="#000080">(</font><font color="#800000">'PLAYBG &lt;playfile&gt;'</font><font color="#000080">);
      </font>Writeln<font color="#000080">(</font><font color="#800000">#10</font><font color="#000080">+</font><font color="#800000">#13</font><font color="#000080">+</font><font color="#800000">'Where:'</font><font color="#000080">);
      </font>Writeln<font color="#000080">(</font><font color="#800000">' &lt;playfile&gt; is the file containing the music you want played in'</font><font color="#000080">);
      </font>Writeln<font color="#000080">(</font><font color="#800000">'            the background'</font><font color="#000080">);
      </font>Writeln<font color="#000080">(</font><font color="#800000">#10</font><font color="#000080">+</font><font color="#800000">#13</font><font color="#000080">+</font><font color="#800000">'The playfile contains a series of notes in ascii format'</font><font color="#000080">);
      </font>Writeln<font color="#000080">;
      </font>Halt<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">);
   </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#008000"><i>{$I-}
</i></font><font color="#FF0000"><b>Function </b></font>Exists<font color="#000080">(</font>name<font color="#000080">:</font><font color="#FF0000"><b>string</b></font><font color="#000080">):</font>boolean<font color="#000080">;
   </font><font color="#FF0000"><b>VAR
      </b></font>F <font color="#000080">:</font><font color="#FF0000"><b>file</b></font><font color="#000080">;
   </font><font color="#FF0000"><b>BEGIN
      </b></font>Assign<font color="#000080">(</font>f<font color="#000080">, </font>name<font color="#000080">);
      </font>Reset<font color="#000080">(</font>f<font color="#000080">);
      </font><font color="#FF0000"><b>if </b></font>IOresult<font color="#000080">&lt;&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>then
         </b></font>Exists <font color="#000080">:= </font>FALSE
      <font color="#FF0000"><b>ELSE
      BEGIN
         </b></font>Exists <font color="#000080">:= </font>TRUE<font color="#000080">;
         </font>Close<font color="#000080">(</font>f<font color="#000080">);
      </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
   </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
</font><font color="#008000"><i>{$I+}

</i></font><font color="#FF0000"><b>Function </b></font>AskYN<font color="#000080">:</font>boolean<font color="#000080">;
   </font><font color="#FF0000"><b>VAR
      </b></font>ch <font color="#000080">:</font>char<font color="#000080">;
   </font><font color="#FF0000"><b>BEGIN
      repeat
         </b></font>ch <font color="#000080">:= </font>ReadKey<font color="#000080">;
         </font><font color="#FF0000"><b>if </b></font>ch <font color="#000080">= </font><font color="#800000">#0 </font><font color="#FF0000"><b>then
         BEGIN
            </b></font>ch <font color="#000080">:= </font>ReadKey<font color="#000080">;
            </font>ch <font color="#000080">:= </font><font color="#800000">#0</font><font color="#000080">;
         </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>until </b></font>ch <font color="#FF0000"><b>in </b></font><font color="#000080">[</font><font color="#800000">'y'</font><font color="#000080">,</font><font color="#800000">'Y'</font><font color="#000080">,</font><font color="#800000">'n'</font><font color="#000080">,</font><font color="#800000">'N'</font><font color="#000080">];
      </font>Write<font color="#000080">(</font>ch<font color="#000080">);
      </font><font color="#FF0000"><b>case </b></font>ch <font color="#FF0000"><b>of
        </b></font><font color="#800000">'Y'</font><font color="#000080">,</font><font color="#800000">'y' </font><font color="#000080">: </font>AskYN <font color="#000080">:= </font>TRUE<font color="#000080">;
        </font><font color="#800000">'N'</font><font color="#000080">,</font><font color="#800000">'n' </font><font color="#000080">: </font>AskYN <font color="#000080">:= </font>FALSE<font color="#000080">;
      </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
   </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>BEGIN
   </b></font>Writeln<font color="#000080">(</font><font color="#800000">'Background Play 1.0'</font><font color="#000080">);

   </font><font color="#FF0000"><b>if </b></font>ParamCount<font color="#000080">&lt;</font><font color="#800000">1 </font><font color="#FF0000"><b>then
      </b></font>Usage<font color="#000080">;

   </font>fname <font color="#000080">:= </font>ParamStr<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">);
   </font>Assign<font color="#000080">(</font>F1<font color="#000080">, </font>fname<font color="#000080">);

   </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>fname<font color="#000080">=</font><font color="#800000">''</font><font color="#000080">) </font><font color="#FF0000"><b>or not</b></font><font color="#000080">(</font>Exists<font color="#000080">(</font>fname<font color="#000080">)) </font><font color="#FF0000"><b>then
   BEGIN
      </b></font>Writeln<font color="#000080">(</font><font color="#800000">'Invalid playfile.'</font><font color="#000080">);
      </font>Halt<font color="#000080">(</font><font color="#800000">2</font><font color="#000080">);
   </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

   </font>play_str <font color="#000080">:= </font><font color="#800000">''</font><font color="#000080">;
   </font>Reset<font color="#000080">(</font>F1<font color="#000080">);

   </font><font color="#FF0000"><b>repeat
      </b></font>ReadLn<font color="#000080">(</font>F1<font color="#000080">, </font>buf<font color="#000080">);
      </font>play_str <font color="#000080">:= </font>play_str<font color="#000080">+</font>buf<font color="#000080">;
   </font><font color="#FF0000"><b>until </b></font>Eof<font color="#000080">(</font>F1<font color="#000080">) </font><font color="#FF0000"><b>or </b></font><font color="#000080">(</font>Length<font color="#000080">(</font>play_str<font color="#000080">)&gt;=</font><font color="#800000">200</font><font color="#000080">);

   </font>Close<font color="#000080">(</font>F1<font color="#000080">);

   </font>Writeln<font color="#000080">(</font>play_str<font color="#000080">);  </font><font color="#008000"><i>{debug}
   </i></font>PlayMusic<font color="#000080">(</font>play_str<font color="#000080">);

   </font>Exec<font color="#000080">(</font>GetEnv<font color="#000080">(</font><font color="#800000">'COMSPEC'</font><font color="#000080">), </font><font color="#800000">''</font><font color="#000080">);

   </font><font color="#FF0000"><b>if </b></font>BGSPlaying <font color="#FF0000"><b>then
   BEGIN
       </b></font>Writeln<font color="#000080">(</font><font color="#800000">'Music still playing - wait for it to finish?'</font><font color="#000080">);
       </font><font color="#FF0000"><b>if Not</b></font><font color="#000080">(</font>AskYN<font color="#000080">) </font><font color="#FF0000"><b>then
          </b></font>_BGSStopPlay<font color="#000080">;
       </font><font color="#FF0000"><b>while </b></font>BGSPLaying <font color="#FF0000"><b>do</b></font><font color="#000080">;
   </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">.

</font><font color="#008000"><i>(*

XX34 Of OBJ CODE FILES.  Extract to separte files and use XX3401 to
create BGS.OBJ and PLAYFIL.ASC.  Here is how to use :

1. Copy first block to BGS.XX.
2. run XX3401 : XX3401 D BGS.XX.  This will create BGS.OBJ.
3. Copy second block to PLAYFIL.XX.
4. run XX3401 : XX3401 D PLAYFIL.XX
5. Write unit code to BGSND.PAS.  Compile.
6. Write demo code to PLAYSND.PAS Compile and run.



*XX3401-000674-210393--68--85-48874---------BGS.OBJ--1-OF--1
U-U+3aIuL4ZWPJlWNrBjRKtYL47bQmt-IooeW0++++-IRL7WPm--QrBZPK7gNL6U63NZ
QbBdPqsUAWskAMS65U-+uF6-RFcKNHdQOK7hL47bQqxpPaFQMaRn9Y3HHJ46+k-+uImK
+U++O6U1+20VZ7M9++F2EJF--2F-J22Xa+Q+G++++UA-2tM9++F1HoF3-2BDF2IVa+Q+
8Bo+-+I-Icl3++lTEYRHHZJBGJF3HJA+13x0FpBCFJVIGJF3HE+ALo75IoxAF2ZCJ131
++lTEYRHF3JGEJF7Hos+0Y75Ip-AEJZ7HYQ+ZN+L+++023x0FpBEH23NHYJMJ2ZIFIp3
+++XY-++++67Lo75IoZCJ131WE++Ad+F+++00Zx0FpBHFJF7HZE6+++tY-A+++6ALo75
IpBIHp-EH23N8E++Pt+F+++00Zx0FpBHEJN3F3A0++-EW+E+E86-YO1T++60+0uA5U++
mpK9v9U++6v+WoM8gEHqsMjsWoM4yei9FUWfysjZLQc4+9UQ+30V+U-EcE++I+vcnzzY
MGHsta54-U+++AhJWymV++-6ck++g9PaEwEy+++aWULaEWO8FE5aEWO9FE8X+++aUno+
R+PYMEk1ta52DU++XII2XA8X++073U6+WyJRmpK9v3-HIJ7KJls4ymuC5U++cE++G8A+
+6Ay++++RGbYMGHsta41DU+++5IMi-k+I820+30V++-E1iV1zwM4++++ukKE1iVozkQT
LptOKJhMWyJRnsmQLU12+pE0l0k4+ED2A+M-+wEz-U23l2Q4+E52GkM-+QFH-U20l4I4
+EH2REM-+gFx-U20l624+E92ZZE0l7Y4+EH2bEM--AGV-U22l8s4+E52i+M-+wGw-U21
lAI4+EJrWU6++5E+
***** END OF XX-BLOCK *****

{-------------------------  CUT HERE -------------------------------}

*XX3401-000047-210393--68--85-51905-----PLAYFIL.ASC--1-OF--1
J1Uk62wo62ks62R4FIN5FoQUI1UUFYN4B0-5EY6o62R4FIN5FoQUFoN4FoN31Ec+
***** END OF XX-BLOCK *****

*)


</i></font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to SOUND SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0017.PAS">Original</a><b>]</b></p></body>
</html>
