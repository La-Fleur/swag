<html>
<head><title> "VOCPLAY.PAS" by SWAG SUPPORT TEAM</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to SOUND SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0014.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
&gt; Does anybody know where to get some good source that plays Vocs?
}

{$A+,B-,D+,E-,F+,G-,I-,L-,N-,O+,R-,S-,V-,X-}
{$M   1024,0,0 }
</i></font><font color="#FF0000"><b>Unit  </b></font>VOCPlay<font color="#000080">;

</font><font color="#FF0000"><b>Interface

Uses
  </b></font>Dos<font color="#000080">;

</font><font color="#FF0000"><b>Var
  </b></font>VoiceStatusWord           <font color="#000080">: </font>Word<font color="#000080">;
  </font>VocPaused<font color="#000080">,</font>VOCDrvInstalled <font color="#000080">: </font>Boolean<font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>AllocateMem<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>P <font color="#000080">: </font>Pointer<font color="#000080">;</font>Size <font color="#000080">: </font>LongInt<font color="#000080">);
</font><font color="#FF0000"><b>Function  </b></font>AllocateMemFunc<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>P <font color="#000080">: </font>Pointer<font color="#000080">;</font>Size <font color="#000080">: </font>LongInt<font color="#000080">) : </font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>Function  </b></font>ReAllocateMem<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>P <font color="#000080">: </font>Pointer<font color="#000080">;</font>NewSize <font color="#000080">: </font>LongInt<font color="#000080">) : </font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>Procedure </b></font>DisAllocateMem<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>P <font color="#000080">: </font>Pointer<font color="#000080">);

</font><font color="#FF0000"><b>Procedure </b></font>VocOutPut<font color="#000080">(</font>AdrtoPlay <font color="#000080">: </font>Pointer<font color="#000080">);
</font><font color="#FF0000"><b>Procedure </b></font>VocStop<font color="#000080">;
</font><font color="#FF0000"><b>Procedure </b></font>VocPause<font color="#000080">;
</font><font color="#FF0000"><b>Procedure </b></font>VocContinue<font color="#000080">;
</font><font color="#FF0000"><b>Procedure </b></font>VocSetSpeaker<font color="#000080">(</font>Onoff <font color="#000080">: </font>Boolean<font color="#000080">);
</font><font color="#FF0000"><b>Function  </b></font>VocInitDriver <font color="#000080">: </font>Byte<font color="#000080">;
</font><font color="#FF0000"><b>Function  </b></font>LoadVoctoMem<font color="#000080">(</font>DateiName <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;</font><font color="#FF0000"><b>Var </b></font>VocMem <font color="#000080">: </font>Pointer<font color="#000080">) : </font>Boolean<font color="#000080">;

</font><font color="#FF0000"><b>Implementation
Const
  </b></font>VocDriverHeader         <font color="#000080">= </font><font color="#800000">12</font><font color="#000080">;
  </font>VocFileHeaderLen        <font color="#000080">= </font><font color="#800000">$1A</font><font color="#000080">;
</font><font color="#FF0000"><b>Var
  </b></font>PtrtoDriver<font color="#000080">,</font>OldExitProc <font color="#000080">: </font>Pointer<font color="#000080">;
  </font>Regs                    <font color="#000080">: </font>Registers<font color="#000080">;
  </font>SizeIntern              <font color="#000080">: </font>Word<font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>AllocateMem<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>Inc<font color="#000080">(</font>Size<font color="#000080">,</font><font color="#800000">15</font><font color="#000080">);
  </font>SizeIntern <font color="#000080">:= (</font>Size <font color="#FF0000"><b>SHR </b></font><font color="#800000">4</font><font color="#000080">);
  </font>Regs<font color="#000080">.</font>AH    <font color="#000080">:= </font><font color="#800000">$48</font><font color="#000080">;
  </font>Regs<font color="#000080">.</font>BX    <font color="#000080">:= </font>SizeIntern<font color="#000080">;
  </font>MsDos<font color="#000080">(</font>Regs<font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font>Regs<font color="#000080">.</font>Flags <font color="#FF0000"><b>and </b></font>FCarry <font color="#000080">&lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then
    </b></font>P <font color="#000080">:= </font><font color="#FF0000"><b>NIL
  else
    </b></font>P <font color="#000080">:= </font>Ptr<font color="#000080">(</font>Regs<font color="#000080">.</font>AX<font color="#000080">,</font><font color="#800000">0</font><font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>AllocateMemFunc<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>AllocateMem<font color="#000080">(</font>P<font color="#000080">,</font>Size<font color="#000080">);
  </font>AllocateMemFunc <font color="#000080">:= </font>P <font color="#000080">&lt;&gt; </font><font color="#FF0000"><b>NIL</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>ReAllocateMem<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>Inc<font color="#000080">(</font>NewSize<font color="#000080">,</font><font color="#800000">15</font><font color="#000080">);
  </font>SizeIntern    <font color="#000080">:= (</font>NewSize <font color="#FF0000"><b>SHR </b></font><font color="#800000">4</font><font color="#000080">);
  </font>Regs<font color="#000080">.</font>AH       <font color="#000080">:= </font><font color="#800000">$4A</font><font color="#000080">;
  </font>Regs<font color="#000080">.</font>BX       <font color="#000080">:= </font>SizeIntern<font color="#000080">;
  </font>Regs<font color="#000080">.</font>ES       <font color="#000080">:= </font>Seg<font color="#000080">(</font>P<font color="#000080">^);
  </font>MsDos<font color="#000080">(</font>Regs<font color="#000080">);
  </font>ReAllocateMem <font color="#000080">:= (</font>Regs<font color="#000080">.</font>BX<font color="#000080">=</font>SizeIntern<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>DisAllocateMem<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>Regs<font color="#000080">.</font>AH <font color="#000080">:= </font><font color="#800000">$49</font><font color="#000080">;
  </font>Regs<font color="#000080">.</font>ES <font color="#000080">:= </font>Seg<font color="#000080">(</font>P<font color="#000080">^);
  </font>MsDos<font color="#000080">(</font>Regs<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>Exists<font color="#000080">(</font>FileName <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">) : </font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>Var
  </b></font>S <font color="#000080">: </font>SearchRec<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>FindFirst<font color="#000080">(</font>FileName<font color="#000080">,</font>AnyFile<font color="#000080">,</font>S<font color="#000080">);
  </font>Exists <font color="#000080">:= (</font>DosError<font color="#000080">=</font><font color="#800000">0</font><font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>VocInitDriver<font color="#000080">;
</font><font color="#FF0000"><b>Const
  </b></font>DriverName <font color="#000080">= </font><font color="#800000">'CT-VOICE.DRV'</font><font color="#000080">;
</font><font color="#FF0000"><b>Type
  </b></font>DriverType <font color="#000080">= </font><font color="#FF0000"><b>Array </b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font>VocDriverHeader<font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Char<font color="#000080">;
</font><font color="#FF0000"><b>Var
  Out</b></font><font color="#000080">,</font>S<font color="#000080">,</font>O    <font color="#000080">: </font>Word<font color="#000080">;
  </font>F          <font color="#000080">: </font><font color="#FF0000"><b>File</b></font><font color="#000080">;
</font><font color="#FF0000"><b>begin
  Out </b></font><font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font><font color="#FF0000"><b>if not </b></font>Exists<font color="#000080">(</font>DriverName<font color="#000080">) </font><font color="#FF0000"><b>then
 begin
   </b></font>VocInitDriver <font color="#000080">:= </font><font color="#800000">4</font><font color="#000080">;
   </font>Exit<font color="#000080">;
 </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>Assign<font color="#000080">(</font>F<font color="#000080">,</font>DriverName<font color="#000080">);
  </font>Reset<font color="#000080">(</font>F<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">);
  </font><font color="#FF0000"><b>if not </b></font>AllocateMemFunc<font color="#000080">(</font>PtrtoDriver<font color="#000080">,</font>FileSize<font color="#000080">(</font>F<font color="#000080">)) </font><font color="#FF0000"><b>then Out </b></font><font color="#000080">:= </font><font color="#800000">5</font><font color="#000080">;
  </font><font color="#FF0000"><b>if Out</b></font><font color="#000080">=</font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>BlockRead<font color="#000080">(</font>F<font color="#000080">,</font>PtrtoDriver<font color="#000080">^,</font>FileSize<font color="#000080">(</font>F<font color="#000080">));
  </font>Close<font color="#000080">(</font>F<font color="#000080">);
  </font><font color="#FF0000"><b>if Out</b></font><font color="#000080">&lt;&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>then
 begin
   </b></font>VocInitDriver <font color="#000080">:= </font><font color="#FF0000"><b>Out</b></font><font color="#000080">;
   </font>Exit<font color="#000080">;
 </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>DriverType<font color="#000080">(</font>PtrtoDriver<font color="#000080">^)[</font><font color="#800000">3</font><font color="#000080">]&lt;&gt;</font><font color="#800000">'C'</font><font color="#000080">) </font><font color="#FF0000"><b>or
     </b></font><font color="#000080">(</font>DriverType<font color="#000080">(</font>PtrtoDriver<font color="#000080">^)[</font><font color="#800000">4</font><font color="#000080">]&lt;&gt;</font><font color="#800000">'T'</font><font color="#000080">) </font><font color="#FF0000"><b>then
 begin
   </b></font>VocInitDriver <font color="#000080">:= </font><font color="#800000">4</font><font color="#000080">;
   </font>Exit<font color="#000080">;
 </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>S <font color="#000080">:= </font>Seg<font color="#000080">(</font>VoiceStatusWord<font color="#000080">);
  </font>O <font color="#000080">:= </font>ofs<font color="#000080">(</font>VoiceStatusWord<font color="#000080">);
  </font><font color="#FF0000"><b>Asm
    </b></font><font color="#FF00FF">mov   bx,3
    call  PtrtoDriver
    mov   Out,ax
    mov   bx,5
    mov   es,S
    mov   di,O
    call  PtrtoDriver
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>VocInitDriver <font color="#000080">:= </font><font color="#FF0000"><b>Out</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>VocUninstallDriver<font color="#000080">;
</font><font color="#FF0000"><b>begin
  if </b></font>VocDrvInstalled <font color="#FF0000"><b>then
  Asm
    </b></font><font color="#FF00FF">mov   bx,9
    call  PtrtoDriver
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>VocOutPut<font color="#000080">;
</font><font color="#FF0000"><b>Var
  </b></font>S<font color="#000080">,</font>O <font color="#000080">: </font>Word<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>VocSetSpeaker<font color="#000080">(</font>True<font color="#000080">);
  </font>S <font color="#000080">:= </font>Seg<font color="#000080">(</font>AdrtoPlay<font color="#000080">^);
  </font>O <font color="#000080">:= </font>ofs<font color="#000080">(</font>AdrtoPlay<font color="#000080">^)+</font>VocFileHeaderLen<font color="#000080">;
  </font><font color="#FF0000"><b>Asm
    </b></font><font color="#FF00FF">mov   bx,6
    mov   es,S
    mov   di,O
    call  PtrtoDriver
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>VocStop<font color="#000080">;
</font><font color="#FF0000"><b>begin
  Asm
    </b></font><font color="#FF00FF">mov   bx,8
    call  PtrtoDriver
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>VocPause<font color="#000080">;
</font><font color="#FF0000"><b>begin
  Asm
    </b></font><font color="#FF00FF">mov   bx,10
    call  PtrtoDriver
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>VocContinue<font color="#000080">;
</font><font color="#FF0000"><b>begin
  Asm
    </b></font><font color="#FF00FF">mov   bx,11
    call  PtrtoDriver
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>VocSetSpeaker<font color="#000080">;
</font><font color="#FF0000"><b>Var </b></font>B <font color="#000080">: </font>Byte<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>B <font color="#000080">:= </font>ord<font color="#000080">(</font>Onoff<font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#800000">$01</font><font color="#000080">;
  </font><font color="#FF0000"><b>Asm
    </b></font><font color="#FF00FF">mov   bx,4
    mov   al,B
    call  PtrtoDriver
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>LoadVoctoMem<font color="#000080">;
</font><font color="#FF0000"><b>Var </b></font>F            <font color="#000080">: </font><font color="#FF0000"><b>File</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>Out          </b></font><font color="#000080">: </font>Boolean<font color="#000080">;
    </font>Gelesen<font color="#000080">,</font>Segs <font color="#000080">: </font>Word<font color="#000080">;
</font><font color="#FF0000"><b>begin
  Out </b></font><font color="#000080">:= </font>Exists<font color="#000080">(</font>DateiName<font color="#000080">);
  </font><font color="#FF0000"><b>if Out then
 begin
   </b></font>Assign<font color="#000080">(</font>F<font color="#000080">,</font>DateiName<font color="#000080">);</font>Reset<font color="#000080">(</font>F<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">);
   </font><font color="#FF0000"><b>if not </b></font>AllocateMemFunc<font color="#000080">(</font>VocMem<font color="#000080">,</font>FileSize<font color="#000080">(</font>F<font color="#000080">)) </font><font color="#FF0000"><b>then
  begin
    </b></font>Close<font color="#000080">(</font>F<font color="#000080">);
    </font>LoadVoctoMem <font color="#000080">:= </font>False<font color="#000080">;
    </font>Exit<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
   </font>Segs <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
   </font><font color="#FF0000"><b>Repeat
     </b></font>BlockRead<font color="#000080">(</font>F<font color="#000080">,</font>Ptr<font color="#000080">(</font>Seg<font color="#000080">(</font>VocMem<font color="#000080">^)+</font><font color="#800000">4096</font><font color="#000080">*</font>Segs<font color="#000080">,</font>ofs<font color="#000080">(</font>VocMem<font color="#000080">^))^,</font><font color="#800000">$FFFF</font><font color="#000080">,</font>Gelesen<font color="#000080">);
     </font>Inc<font color="#000080">(</font>Segs<font color="#000080">);
   </font><font color="#FF0000"><b>Until </b></font>Gelesen<font color="#000080">=</font><font color="#800000">0</font><font color="#000080">;
   </font>Close<font color="#000080">(</font>F<font color="#000080">);
 </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>LoadVoctoMem <font color="#000080">:= </font><font color="#FF0000"><b>Out</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{$F+}
</i></font><font color="#FF0000"><b>Procedure </b></font>VocPlayExitProc<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>VocUninstallDriver<font color="#000080">;
  </font>ExitProc <font color="#000080">:= </font>OldExitProc<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#008000"><i>{$F-}

</i></font><font color="#FF0000"><b>begin
  </b></font>OldExitProc     <font color="#000080">:= </font>ExitProc<font color="#000080">;
  </font>ExitProc        <font color="#000080">:= @</font>VocPlayExitProc<font color="#000080">;
  </font>VoiceStatusWord <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font>VocPaused       <font color="#000080">:= </font>False<font color="#000080">;
  </font>VocDrvInstalled <font color="#000080">:= (</font>VocInitDriver<font color="#000080">=</font><font color="#800000">0</font><font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">.


</font><font color="#008000"><i>{$A+,B-,D+,E-,F-,G-,I-,L-,N-,O-,R-,S-,V-,X-}
{$M   1024,0,0 }
</i></font><font color="#FF0000"><b>Uses  </b></font>Crt<font color="#000080">,</font>VOCPlay<font color="#000080">;
</font><font color="#FF0000"><b>Var   </b></font>VocMem   <font color="#000080">: </font>Pointer<font color="#000080">;
      </font>FileName <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
      </font>Ok       <font color="#000080">: </font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>FileName <font color="#000080">:= </font>ParamStr<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">);
  </font>Ok       <font color="#000080">:= </font>False<font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font>VocDrvInstalled <font color="#FF0000"><b>then </b></font>Ok <font color="#000080">:= </font>LoadVoctoMem<font color="#000080">(</font>DateiName<font color="#000080">,</font>VocMem<font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font>Ok <font color="#FF0000"><b>then
 begin
   </b></font>Write<font color="#000080">(</font><font color="#800000">'Playing VOC-File ...'</font><font color="#000080">);
   </font>VocOutPut<font color="#000080">(</font>VocMem<font color="#000080">);
   </font><font color="#FF0000"><b>Repeat
   Until </b></font><font color="#000080">(</font>VoiceStatusWord<font color="#000080">=</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>or </b></font>KeyPressed<font color="#000080">;
   </font>Writeln<font color="#000080">;
   </font>DisAllocateMem<font color="#000080">(</font>VocMem<font color="#000080">);
 </font><font color="#FF0000"><b>end
 else </b></font>Writeln<font color="#000080">(</font><font color="#800000">'Hey, there was something wrong.'</font><font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to SOUND SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0014.PAS">Original</a><b>]</b></p></body>
</html>
