<html>
<head><title> "TP AND SOUND BLASTER" by BRIAN GRAINGER</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to SOUND SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0040.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
CL&plusmn;    Come to speak of this...  do you (or anyone) know which ports to zap the
CL&plusmn;    data to for the SB to get it to play?  Or better yet, even how to get it
CL&plusmn;    to play in DMA transfer mode?

Try this code.
}
(* A unit to provide basic control over a Sound Blaster or compatible card.*)
(* It works by reading and writing to the standard Sound Blaster ports.    *)
(* Released to the public domain by Brian Grainger, Sparwood, BC.          *)

</i></font><font color="#FF0000"><b>UNIT </b></font>SoundBlaster<font color="#000080">;

</font><font color="#008000"><i>(*********************************)</i></font><font color="#FF0000"><b>INTERFACE</b></font><font color="#008000"><i>(********************************)

</i></font><font color="#FF0000"><b>PROCEDURE </b></font>sbSetAddressDelay<font color="#000080">(</font>StereoMode <font color="#000080">: </font>BYTE<font color="#000080">);
</font><font color="#FF0000"><b>PROCEDURE </b></font>sbSetDataDelay<font color="#000080">(</font>StereoMode <font color="#000080">: </font>BYTE<font color="#000080">);
</font><font color="#FF0000"><b>PROCEDURE </b></font>sbSetDataReg<font color="#000080">(</font>RegNum<font color="#000080">, </font>Value<font color="#000080">, </font>StereoMode <font color="#000080">: </font>BYTE<font color="#000080">);
</font><font color="#FF0000"><b>FUNCTION  </b></font>sbGetStatus<font color="#000080">(</font>StereoMode <font color="#000080">: </font>BYTE<font color="#000080">) : </font>BYTE<font color="#000080">;
</font><font color="#FF0000"><b>PROCEDURE </b></font>sbResetTimers<font color="#000080">;
</font><font color="#FF0000"><b>PROCEDURE </b></font>sbEnableInterrupts<font color="#000080">;
</font><font color="#FF0000"><b>PROCEDURE </b></font>sbTurnOff<font color="#000080">;
</font><font color="#FF0000"><b>FUNCTION  </b></font>sbIsInstalled <font color="#000080">: </font>BOOLEAN<font color="#000080">;

</font><font color="#008000"><i>(*******************************)</i></font><font color="#FF0000"><b>IMPLEMENTATION</b></font><font color="#008000"><i>(*****************************)

</i></font><font color="#FF0000"><b>CONST
  </b></font>cMono  <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">;
  </font>cLeft  <font color="#000080">= </font><font color="#800000">1</font><font color="#000080">;
  </font>cRight <font color="#000080">= </font><font color="#800000">2</font><font color="#000080">;

</font><font color="#FF0000"><b>VAR
  </b></font>vStatus1 <font color="#000080">: </font>BYTE<font color="#000080">;
  </font>vStatus2 <font color="#000080">: </font>BYTE<font color="#000080">;
  </font>vDelay   <font color="#000080">: </font>BYTE<font color="#000080">;
  </font>vI       <font color="#000080">: </font>BYTE<font color="#000080">;

</font><font color="#FF0000"><b>PROCEDURE </b></font>sbSetAddressDelay<font color="#000080">(</font>StereoMode <font color="#000080">: </font>BYTE<font color="#000080">);
  </font><font color="#FF0000"><b>BEGIN
    FOR </b></font>vI <font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>TO </b></font><font color="#800000">5 </font><font color="#FF0000"><b>DO
      CASE </b></font>StereoMode <font color="#FF0000"><b>OF
        </b></font>cMono  <font color="#000080">: </font>vDelay <font color="#000080">:= </font>Port<font color="#000080">[</font><font color="#800000">$388</font><font color="#000080">];
        </font>cLeft  <font color="#000080">: </font>vDelay <font color="#000080">:= </font>Port<font color="#000080">[</font><font color="#800000">$220</font><font color="#000080">];
        </font>cRight <font color="#000080">: </font>vDelay <font color="#000080">:= </font>Port<font color="#000080">[</font><font color="#800000">$222</font><font color="#000080">];
      </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>PROCEDURE </b></font>sbSetDataDelay<font color="#000080">(</font>StereoMode <font color="#000080">: </font>BYTE<font color="#000080">);
  </font><font color="#FF0000"><b>BEGIN
    FOR </b></font>vI <font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>TO </b></font><font color="#800000">34 </font><font color="#FF0000"><b>DO
      CASE </b></font>StereoMode <font color="#FF0000"><b>OF
        </b></font>cMono  <font color="#000080">: </font>vDelay <font color="#000080">:= </font>Port<font color="#000080">[</font><font color="#800000">$388</font><font color="#000080">];
        </font>cLeft  <font color="#000080">: </font>vDelay <font color="#000080">:= </font>Port<font color="#000080">[</font><font color="#800000">$220</font><font color="#000080">];
        </font>cRight <font color="#000080">: </font>vDelay <font color="#000080">:= </font>Port<font color="#000080">[</font><font color="#800000">$222</font><font color="#000080">];
      </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>PROCEDURE </b></font>sbSetDataReg<font color="#000080">(</font>RegNum<font color="#000080">, </font>Value<font color="#000080">, </font>StereoMode <font color="#000080">: </font>BYTE<font color="#000080">);
  </font><font color="#FF0000"><b>BEGIN
    CASE </b></font>StereoMode <font color="#FF0000"><b>OF
      </b></font>cMono  <font color="#000080">: </font>Port<font color="#000080">[</font><font color="#800000">$388</font><font color="#000080">] := </font>RegNum<font color="#000080">;
      </font>cLeft  <font color="#000080">: </font>Port<font color="#000080">[</font><font color="#800000">$220</font><font color="#000080">] := </font>RegNum<font color="#000080">;
      </font>cRight <font color="#000080">: </font>Port<font color="#000080">[</font><font color="#800000">$222</font><font color="#000080">] := </font>RegNum<font color="#000080">;
    </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
    </font>sbSetAddressDelay<font color="#000080">(</font>StereoMode<font color="#000080">);
    </font><font color="#FF0000"><b>CASE </b></font>StereoMode <font color="#FF0000"><b>OF
      </b></font>cMono  <font color="#000080">: </font>Port<font color="#000080">[</font><font color="#800000">$389</font><font color="#000080">] := </font>Value<font color="#000080">;
      </font>cLeft  <font color="#000080">: </font>Port<font color="#000080">[</font><font color="#800000">$221</font><font color="#000080">] := </font>Value<font color="#000080">;
      </font>cRight <font color="#000080">: </font>Port<font color="#000080">[</font><font color="#800000">$222</font><font color="#000080">] := </font>Value<font color="#000080">;
    </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
    </font>sbSetDataDelay<font color="#000080">(</font>StereoMode<font color="#000080">);
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>FUNCTION </b></font>sbGetStatus<font color="#000080">(</font>StereoMode <font color="#000080">: </font>BYTE<font color="#000080">) : </font>BYTE<font color="#000080">;
  </font><font color="#FF0000"><b>BEGIN
    </b></font>sbGetStatus <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
    </font><font color="#FF0000"><b>CASE </b></font>StereoMode <font color="#FF0000"><b>OF
      </b></font>cMono  <font color="#000080">: </font>sbGetStatus <font color="#000080">:= </font>Port<font color="#000080">[</font><font color="#800000">$388</font><font color="#000080">];
      </font>cLeft  <font color="#000080">: </font>sbGetStatus <font color="#000080">:= </font>Port<font color="#000080">[</font><font color="#800000">$220</font><font color="#000080">];
      </font>cRight <font color="#000080">: </font>sbGetStatus <font color="#000080">:= </font>Port<font color="#000080">[</font><font color="#800000">$222</font><font color="#000080">];
    </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>PROCEDURE </b></font>sbResetTimers<font color="#000080">;
  </font><font color="#FF0000"><b>BEGIN
    </b></font>sbSetDataReg<font color="#000080">(</font><font color="#800000">$04</font><font color="#000080">, </font><font color="#800000">$60</font><font color="#000080">, </font>cMono<font color="#000080">);
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>PROCEDURE </b></font>sbEnableInterrupts<font color="#000080">;
  </font><font color="#FF0000"><b>BEGIN
    </b></font>sbSetDataReg<font color="#000080">(</font><font color="#800000">$04</font><font color="#000080">, </font><font color="#800000">$80</font><font color="#000080">, </font>cMono<font color="#000080">);
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>PROCEDURE </b></font>sbTurnOff<font color="#000080">;
  </font><font color="#FF0000"><b>BEGIN
    FOR </b></font>vI <font color="#000080">:= </font><font color="#800000">$01 </font><font color="#FF0000"><b>TO </b></font><font color="#800000">$F5 </font><font color="#FF0000"><b>DO
      </b></font>sbSetDataReg<font color="#000080">(</font>vI<font color="#000080">, </font><font color="#800000">$00</font><font color="#000080">, </font>cMono<font color="#000080">);
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>FUNCTION </b></font>sbIsInstalled <font color="#000080">: </font>BOOLEAN<font color="#000080">;
  </font><font color="#FF0000"><b>BEGIN
    </b></font>sbIsInstalled <font color="#000080">:= </font>FALSE<font color="#000080">;
    </font>sbResetTimers<font color="#000080">;
    </font>sbEnableInterrupts<font color="#000080">;
    </font>vStatus1 <font color="#000080">:= </font>sbGetStatus<font color="#000080">(</font>cMono<font color="#000080">);
    </font>sbSetDataReg<font color="#000080">(</font><font color="#800000">$02</font><font color="#000080">, </font><font color="#800000">$FF</font><font color="#000080">, </font>cMono<font color="#000080">);  </font><font color="#008000"><i>(* Set timer 1 data register *)
    </i></font>sbSetDataReg<font color="#000080">(</font><font color="#800000">$04</font><font color="#000080">, </font><font color="#800000">$21</font><font color="#000080">, </font>cMono<font color="#000080">);  </font><font color="#008000"><i>(* Start timer 1             *)
    </i></font><font color="#FF0000"><b>FOR </b></font>vI <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>TO </b></font><font color="#800000">4 </font><font color="#FF0000"><b>DO
      </b></font>sbSetDataDelay<font color="#000080">(</font>cMono<font color="#000080">);        </font><font color="#008000"><i>(* Wait at least 80 uSeconds *)
    </i></font>vStatus2 <font color="#000080">:= </font>sbGetStatus<font color="#000080">(</font>cMono<font color="#000080">);
    </font>sbResetTimers<font color="#000080">;
    </font>sbEnableInterrupts<font color="#000080">;
    </font><font color="#FF0000"><b>IF </b></font><font color="#000080">(((</font>vStatus1 <font color="#FF0000"><b>AND </b></font><font color="#800000">$E0</font><font color="#000080">) = </font><font color="#800000">$00</font><font color="#000080">) </font><font color="#FF0000"><b>AND </b></font><font color="#000080">((</font>vStatus2 <font color="#FF0000"><b>AND </b></font><font color="#800000">$E0</font><font color="#000080">) = </font><font color="#800000">$C0</font><font color="#000080">)) </font><font color="#FF0000"><b>THEN
      </b></font>sbIsInstalled <font color="#000080">:= </font>TRUE<font color="#000080">;
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to SOUND SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0040.PAS">Original</a><b>]</b></p></body>
</html>
