<html>
<head><title> "DETECTS SoundBlaster" by LENNERT BAKKER</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to SOUND SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0034.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
From: LENNERT BAKKER
Subj: SB AutoDetect
    Here's how to autodetect a soundblaster and it's baseaddress
    and some other support-stuff for your convenience: }


{ Hey let's check this SB out 8-)}

</i></font><font color="#FF0000"><b>Const </b></font>SBReset     <font color="#000080">= </font><font color="#800000">$6</font><font color="#000080">;
      </font>SBRead      <font color="#000080">= </font><font color="#800000">$A</font><font color="#000080">;
      </font>SBWrite     <font color="#000080">= </font><font color="#800000">$C</font><font color="#000080">;
      </font>SBStatus    <font color="#000080">= </font><font color="#800000">$E</font><font color="#000080">;

</font><font color="#FF0000"><b>Var   </b></font>SBPort      <font color="#000080">: </font>Word<font color="#000080">;
      </font>SBInstalled <font color="#000080">: </font>Boolean<font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>DetectSoundBlaster<font color="#000080">;
</font><font color="#FF0000"><b>Const </b></font>NrTimes           <font color="#000080">= </font><font color="#800000">10</font><font color="#000080">;
      </font>NrTimes2          <font color="#000080">= </font><font color="#800000">50</font><font color="#000080">;
</font><font color="#FF0000"><b>Var   </b></font>Found             <font color="#000080">: </font>Boolean<font color="#000080">;
      </font>Counter1<font color="#000080">,</font>Counter2 <font color="#000080">: </font>Word<font color="#000080">;
</font><font color="#FF0000"><b>Begin
 </b></font>SBPort<font color="#000080">:=</font><font color="#800000">$210</font><font color="#000080">;
 </font>Found<font color="#000080">:=</font>False<font color="#000080">;
 </font>Counter1<font color="#000080">:=</font>NrTimes<font color="#000080">;
  </font><font color="#FF0000"><b>While </b></font><font color="#000080">(</font>SBPort<font color="#000080">&lt;=</font><font color="#800000">$260</font><font color="#000080">) </font><font color="#FF0000"><b>And Not </b></font>Found <font color="#FF0000"><b>Do
   Begin
    </b></font>Port<font color="#000080">[</font>SBPort<font color="#000080">+</font><font color="#800000">$6</font><font color="#000080">]:=</font><font color="#800000">1</font><font color="#000080">;
    </font>Port<font color="#000080">[</font>SBPort<font color="#000080">+</font><font color="#800000">$6</font><font color="#000080">]:=</font><font color="#800000">0</font><font color="#000080">;
    </font>Counter2<font color="#000080">:=</font>NrTimes2<font color="#000080">;
     </font><font color="#FF0000"><b>While </b></font><font color="#000080">(</font>Counter2<font color="#000080">&gt;</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>And </b></font><font color="#000080">(</font>Port<font color="#000080">[</font>SBPort<font color="#000080">+</font><font color="#800000">$E</font><font color="#000080">]&lt;</font><font color="#800000">128</font><font color="#000080">) </font><font color="#FF0000"><b>Do
      </b></font>Dec<font color="#000080">(</font>Counter2<font color="#000080">);
     </font><font color="#FF0000"><b>If </b></font><font color="#000080">(</font>Counter2<font color="#000080">=</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>Or </b></font><font color="#000080">(</font>Port<font color="#000080">[</font>SBPort<font color="#000080">+</font><font color="#800000">$A</font><font color="#000080">]&lt;&gt;</font><font color="#800000">$AA</font><font color="#000080">) </font><font color="#FF0000"><b>Then
      Begin
       </b></font>Dec<font color="#000080">(</font>Counter1<font color="#000080">);
        </font><font color="#FF0000"><b>If </b></font><font color="#000080">(</font>Counter1<font color="#000080">=</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>Then
         Begin
          </b></font>Counter1<font color="#000080">:=</font>NrTimes<font color="#000080">;
          </font>SBPort<font color="#000080">:=</font>SBPort<font color="#000080">+</font><font color="#800000">$10</font><font color="#000080">;
         </font><font color="#FF0000"><b>End
      End Else </b></font>Found<font color="#000080">:=</font>True<font color="#000080">;
   </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>If </b></font>Found <font color="#FF0000"><b>then </b></font>SBInstalled<font color="#000080">:=</font>True
   <font color="#FF0000"><b>Else </b></font>SBInstalled<font color="#000080">:=</font>False<font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Begin
 </b></font>DetectSoundBlaster<font color="#000080">;
  </font><font color="#FF0000"><b>If </b></font>SBInstalled <font color="#FF0000"><b>then
   </b></font>Writeln<font color="#000080">(</font><font color="#800000">'SoundBlaster found at port :'</font><font color="#000080">, </font>SBPort<font color="#000080">)
  </font><font color="#FF0000"><b>else
   </b></font>Writeln<font color="#000080">(</font><font color="#800000">'No soundcard, no boogie!'</font><font color="#000080">);
</font><font color="#FF0000"><b>End</b></font><font color="#000080">.


</font><font color="#008000"><i>{Here's how to initialize the DSP:}

</i></font><font color="#FF0000"><b>Procedure </b></font>SetupSoundBlaster<font color="#000080">;
</font><font color="#FF0000"><b>Var </b></font>I<font color="#000080">,</font>BDum <font color="#000080">: </font>Byte<font color="#000080">;
</font><font color="#FF0000"><b>Begin
  If </b></font>SBInstalled <font color="#FF0000"><b>then
   Begin
    </b></font>Port<font color="#000080">[</font>SBPort<font color="#000080">+</font>SBReset<font color="#000080">]:=</font><font color="#800000">1</font><font color="#000080">; </font><font color="#008000"><i>{Reset DSP}
     </i></font><font color="#FF0000"><b>For </b></font>I<font color="#000080">:=</font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font><font color="#800000">6 </font><font color="#FF0000"><b>do
      </b></font>BDum<font color="#000080">:=</font>Port<font color="#000080">[</font>SBPort<font color="#000080">+</font>SBStatus<font color="#000080">];
    </font>Port<font color="#000080">[</font>SBPort<font color="#000080">+</font>SBReset<font color="#000080">]:=</font><font color="#800000">0</font><font color="#000080">;
     </font><font color="#FF0000"><b>For </b></font>I<font color="#000080">:=</font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font><font color="#800000">6 </font><font color="#FF0000"><b>do
      </b></font>BDum<font color="#000080">:=</font>Port<font color="#000080">[</font>SBPort<font color="#000080">+</font>SBStatus<font color="#000080">];
     </font><font color="#FF0000"><b>Repeat Until </b></font>Port<font color="#000080">[</font>SBPort<font color="#000080">+</font>SBStatus<font color="#000080">]&gt;</font><font color="#800000">$80</font><font color="#000080">;
   </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#008000"><i>{Respectively turn the speaker on/off}

</i></font><font color="#FF0000"><b>Procedure </b></font>TurnOnSBSpeaker<font color="#000080">;
</font><font color="#FF0000"><b>Begin
 Repeat Until </b></font>Port<font color="#000080">[</font>SBPort<font color="#000080">+</font>SBWrite<font color="#000080">]&lt;</font><font color="#800000">$80</font><font color="#000080">;
 </font>Port<font color="#000080">[</font>SBPort<font color="#000080">+</font>SBWrite<font color="#000080">]:=</font><font color="#800000">$D1</font><font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>TurnOffSBSpeaker<font color="#000080">;
</font><font color="#FF0000"><b>Begin
 Repeat Until </b></font>Port<font color="#000080">[</font>SBPort<font color="#000080">+</font>SBWrite<font color="#000080">]&lt;</font><font color="#800000">$80</font><font color="#000080">;
 </font>Port<font color="#000080">[</font>SBPort<font color="#000080">+</font>SBWrite<font color="#000080">]:=</font><font color="#800000">$D3</font><font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#008000"><i>{
  Here's basically how you play a sample, you should reprogram
  the timer though and have your interrupt routine output bytes
  to the DSP at regular intervals, say 10000 times/sec or so.
  Rather use machine-language instead, but that shouldn't be too
  hard now, should it? 8)
}

</i></font><font color="#FF0000"><b>Procedure </b></font>PlaySample<font color="#000080">(</font>Sample<font color="#000080">:</font>Pointer<font color="#000080">;</font>Length<font color="#000080">:</font>Word<font color="#000080">);
</font><font color="#FF0000"><b>Var </b></font>A <font color="#000080">: </font>Word<font color="#000080">;
</font><font color="#FF0000"><b>Begin
 For </b></font>A<font color="#000080">:=</font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>Length <font color="#FF0000"><b>Do
  Begin
   </b></font>Port<font color="#000080">[</font>SBPort<font color="#000080">+</font>SBWrite<font color="#000080">]:=</font><font color="#800000">$10</font><font color="#000080">;
   </font>Port<font color="#000080">[</font>SBPort<font color="#000080">+</font>SBWrite<font color="#000080">]:=</font>Mem<font color="#000080">[</font>Seg<font color="#000080">(</font>Sample<font color="#000080">^):</font>Ofs<font color="#000080">(</font>Sample<font color="#000080">^)+</font>A<font color="#000080">];
   </font><font color="#008000"><i>{Delay some time}
  </i></font><font color="#FF0000"><b>End</b></font><font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#008000"><i>{Or sumtin like this (untested) }

</i></font><font color="#FF0000"><b>Procedure </b></font>PlaySampleASM<font color="#000080">(</font>Sample<font color="#000080">:</font>Pointer<font color="#000080">;</font>Length<font color="#000080">:</font>Word<font color="#000080">); </font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Asm
 </b></font><font color="#FF00FF">Les Di,[Sample]
 Mov Dx,SBPort+SBWrite
 Mov Cx,Length
@LoopIt:
 LodsB
 Out Dx,$10
 Out Dx,Al

 </font><font color="#008000"><i>{ Delay Some Time -- What about 1000 NOPs or so ;-) }

 </i></font><font color="#FF00FF">Loop @LoopIt
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to SOUND SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0034.PAS">Original</a><b>]</b></p></body>
</html>
