<html>
<head><title> "Midi" by STEVEN TALLENT</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to SOUND SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0035.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
&gt; Is there anyone here who has a source on how to play MID-files in
&gt; PAS-programs, they could post here or NetMail to me???

I can tell you how to access the MIDI port for MPU-401 compatible
controllers.  The MFF (.MID) format is WAY too complex to describe here,
but I *highly* recommend studying the excellent set of articles by Charles
Petzold on MIDI and MIDI files in PC Magazine Vol 11, No 7 (April
14, 1992) to Vol 11, No 19 (November 10, 1992).  The article was mainly for
Windows programmers, but he spent a good portion of the articles
explaining MIDI itself in detail (including the MFF (.MID) format).  All
his source code and sample programs are availible on ZiffNet.  You can
also get the MFF format detailed in the 14-page document &quot;Standard MIDI Files
1.0&quot; from the International MIDI Association for $7 + $1.50p&amp;h US funds (call
310-649-6434).

I wrote a small (buggy, not working yet) unit for MPU-401 access from
information I got here a few months back.  Your MIDI device must be
fully MPU-401 compatible to use this.

{ MPU-401 MIDI playback/record routines }
{ Public domain 1993 Steven Tallent     }
{ Plays the proper notes on an MPU-401  }
{ compatible synthesizer. }
{ Reading the Status port (331h) and masking 80h will tell you if}
{ something is waiting to be received from the mpu-401. }

</i></font><font color="#FF0000"><b>Unit </b></font>Midi<font color="#000080">;

</font><font color="#008000"><i>{**********************} </i></font><font color="#FF0000"><b>Interface </b></font><font color="#008000"><i>{**********************}

</i></font><font color="#FF0000"><b>Type </b></font>MPU401 <font color="#000080">= </font><font color="#FF0000"><b>object
     </b></font>Address <font color="#000080">: </font>Word<font color="#000080">; </font><font color="#008000"><i>{Data port. Status/Comport 1 higher, standard 330h-331h}
     </i></font>Silent  <font color="#000080">: </font>Boolean<font color="#000080">;              </font><font color="#008000"><i>{Silence : Software mute }
     </i></font><font color="#FF0000"><b>Function  </b></font>Exists <font color="#000080">: </font>Boolean<font color="#000080">;     </font><font color="#008000"><i>{Does an MPU-401 device exist here?}
     </i></font><font color="#FF0000"><b>Function  </b></font>ByteHere<font color="#000080">: </font>Boolean<font color="#000080">;    </font><font color="#008000"><i>{Is a byte ready to be received?}
     </i></font><font color="#FF0000"><b>Function  </b></font>RecByte <font color="#000080">: </font>Byte<font color="#000080">;       </font><font color="#008000"><i>{Get byte from MIDI device}
     </i></font><font color="#FF0000"><b>Procedure </b></font>SendByte <font color="#000080">(</font>x<font color="#000080">:</font>Byte<font color="#000080">);    </font><font color="#008000"><i>{Send byte to MIDI device}
     </i></font><font color="#FF0000"><b>Procedure </b></font>SendStr <font color="#000080">(</font>x <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">); </font><font color="#008000"><i>{Send string of bytes to MIDI device}
     </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>VAR </b></font>Synth <font color="#000080">: </font>MPU401<font color="#000080">;

</font><font color="#008000"><i>{********************} </i></font><font color="#FF0000"><b>Implementation </b></font><font color="#008000"><i>{*******************}

</i></font><font color="#FF0000"><b>Function </b></font>MPU401<font color="#000080">.</font>Exists <font color="#000080">: </font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>Begin
  </b></font>Exists <font color="#000080">:= </font>True<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>MPU401<font color="#000080">.</font>ByteHere <font color="#000080">: </font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>Begin
  If </b></font><font color="#000080">(</font>port<font color="#000080">[</font>Address<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">] </font><font color="#FF0000"><b>and </b></font><font color="#800000">$80</font><font color="#000080">) = </font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>ByteHere <font color="#000080">:= </font>True <font color="#008000"><i>{wrong?}
                                  </i></font><font color="#FF0000"><b>else </b></font>ByteHere <font color="#000080">:= </font>False<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>MPU401<font color="#000080">.</font>RecByte <font color="#000080">: </font>Byte<font color="#000080">;
</font><font color="#FF0000"><b>Begin
  </b></font>RecByte <font color="#000080">:= </font>Port<font color="#000080">[</font>Address<font color="#000080">];
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>MPU401<font color="#000080">.</font>SendByte <font color="#000080">(</font>x<font color="#000080">:</font>Byte<font color="#000080">);
</font><font color="#008000"><i>{Must wait for no data in the buffer}
</i></font><font color="#FF0000"><b>Begin
  Repeat until </b></font><font color="#000080">(</font>Port<font color="#000080">[</font>Address<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">] </font><font color="#FF0000"><b>and </b></font><font color="#800000">$80</font><font color="#000080">) = </font><font color="#800000">$80</font><font color="#000080">; </font><font color="#008000"><i>{wrong?}
  </i></font>Port<font color="#000080">[</font>Address<font color="#000080">] := </font>x<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>MPU401<font color="#000080">.</font>SendStr <font color="#000080">(</font>x <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">);
</font><font color="#FF0000"><b>Var </b></font>t <font color="#000080">: </font>Byte<font color="#000080">;
</font><font color="#FF0000"><b>Begin
  For </b></font>t <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>ord<font color="#000080">(</font>x<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">]) </font><font color="#FF0000"><b>do </b></font>SendByte <font color="#000080">(</font>ord<font color="#000080">(</font>x<font color="#000080">[</font>t<font color="#000080">]));
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{Initialize}
</i></font><font color="#FF0000"><b>Begin
  </b></font>Synth<font color="#000080">.</font>Address <font color="#000080">:= </font><font color="#800000">$300</font><font color="#000080">;
  </font>Synth<font color="#000080">.</font>Silent <font color="#000080">:= </font>False<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">.

</font><font color="#008000"><i>{
This is semi-OOP, so its pretty simple to use.  MIDI uses 1, 2, or 3 byte
commands to send messages.  For any commands you send to the MIDI device,
use SendByte for each byte or send them all in SendStr for convenience.
If you get it working, please respond with the fixed version either
here or Netmail.
}</i></font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to SOUND SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0035.PAS">Original</a><b>]</b></p></body>
</html>
