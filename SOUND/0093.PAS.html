<html>
<head><title> "CD Audio Player" by ERIC MILLER</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to SOUND SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0093.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#FF0000"><b>UNIT </b></font>CDAUDIO<font color="#000080">;
</font><font color="#008000"><i>{ by Eric Miller, Jan. 15, 1996 }
{ public domain }
</i></font><font color="#FF0000"><b>INTERFACE

Uses </b></font>Objects<font color="#000080">;

</font><font color="#FF0000"><b>CONST
        </b></font>cdPlaying <font color="#000080">= </font><font color="#800000">1</font><font color="#000080">;     </font><font color="#008000"><i>{ drive is playing audio }
        </i></font>cdDisc <font color="#000080">= </font><font color="#800000">2</font><font color="#000080">;        </font><font color="#008000"><i>{ disc is in drive }
        </i></font>cdDoor <font color="#000080">= </font><font color="#800000">4</font><font color="#000080">;        </font><font color="#008000"><i>{ drive door is closed }
</i></font><font color="#FF0000"><b>TYPE
        </b></font>TRedBook <font color="#000080">= </font><font color="#FF0000"><b>RECORD
                </b></font>Frame<font color="#000080">, </font>Second<font color="#000080">, </font>Minute<font color="#000080">, </font>Unused<font color="#000080">: </font>Byte<font color="#000080">;
        </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
        </font>TTrack <font color="#000080">= </font><font color="#FF0000"><b>RECORD
                </b></font>Start<font color="#000080">, </font>Finish<font color="#000080">: </font>TRedBook<font color="#000080">;
        </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
        </font>TDeviceHeader <font color="#000080">= </font><font color="#FF0000"><b>RECORD
                </b></font>NextDriver<font color="#000080">: </font>Pointer<font color="#000080">;
                </font>Attribute<font color="#000080">, </font>StratEntry<font color="#000080">, </font>IntEntry<font color="#000080">: </font>Word<font color="#000080">;
                </font>Name<font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">7</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Char<font color="#000080">;
                </font>Res<font color="#000080">: </font>Word<font color="#000080">;
                </font>Letter<font color="#000080">, </font>Units<font color="#000080">: </font>Byte<font color="#000080">;
        </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
        </font>TDevice <font color="#000080">= </font><font color="#FF0000"><b>RECORD
                </b></font>Subunit<font color="#000080">: </font>Byte<font color="#000080">;
                </font>Header<font color="#000080">: </font>Pointer<font color="#000080">;
        </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
        </font>TRequestHeader <font color="#000080">= </font><font color="#FF0000"><b>RECORD
                </b></font>Length<font color="#000080">,        </font>Subunit<font color="#000080">, </font>Command<font color="#000080">: </font>Byte<font color="#000080">;
                </font>Status<font color="#000080">: </font>Word<font color="#000080">;
                </font>Res<font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">7</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Byte<font color="#000080">;
        </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
        </font>TPlayRequest <font color="#000080">= </font><font color="#FF0000"><b>RECORD
                </b></font>Header<font color="#000080">: </font>TRequestHeader<font color="#000080">;
                </font>Addressing<font color="#000080">: </font>Byte<font color="#000080">;
                </font>Start<font color="#000080">, </font>Length<font color="#000080">: </font>LongInt<font color="#000080">;
        </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
        </font>TIOCTLRequest <font color="#000080">= </font><font color="#FF0000"><b>RECORD
                </b></font>Header<font color="#000080">: </font>TRequestHeader<font color="#000080">;
                </font>Media<font color="#000080">: </font>Byte<font color="#000080">;
                </font>Address<font color="#000080">: </font>Pointer<font color="#000080">;
                </font>Length<font color="#000080">,        </font>Start<font color="#000080">: </font>Word<font color="#000080">;
                </font>Res<font color="#000080">: </font>Pointer<font color="#000080">;
        </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
        </font>TQChannel <font color="#000080">= </font><font color="#FF0000"><b>RECORD
                </b></font>Command<font color="#000080">, </font>CTRL_ADR<font color="#000080">, </font>Track<font color="#000080">,        </font>Point<font color="#000080">: </font>Byte<font color="#000080">;
                </font>Min<font color="#000080">, </font>Sec<font color="#000080">, </font>Frame<font color="#000080">, </font>Zero<font color="#000080">, </font>AMin<font color="#000080">, </font>ASec<font color="#000080">, </font>AFrame<font color="#000080">: </font>Byte<font color="#000080">;
        </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
        </font>TDeviceStatus <font color="#000080">= </font><font color="#FF0000"><b>RECORD
                </b></font>Command<font color="#000080">: </font>Byte<font color="#000080">;
                </font>Status<font color="#000080">: </font>LongInt<font color="#000080">;
        </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
        </font>TCommand <font color="#000080">= </font><font color="#FF0000"><b>RECORD
                </b></font>Command<font color="#000080">: </font>Byte<font color="#000080">;
        </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
        </font>TDiskInfo <font color="#000080">= </font><font color="#FF0000"><b>RECORD
                </b></font>Command<font color="#000080">: </font>Byte<font color="#000080">;
                </font>LowTrack<font color="#000080">, </font>HighTrack<font color="#000080">: </font>Byte<font color="#000080">;
                </font>LeadOut<font color="#000080">: </font>TRedBook<font color="#000080">;
        </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
        </font>TTrackInfo <font color="#000080">= </font><font color="#FF0000"><b>RECORD
                </b></font>Command<font color="#000080">, </font>Track<font color="#000080">: </font>Byte<font color="#000080">;
                </font>Start<font color="#000080">: </font>TRedBook<font color="#000080">;
                </font>Control<font color="#000080">: </font>Byte<font color="#000080">;
        </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
</font><font color="#FF0000"><b>TYPE
        </b></font>TCD <font color="#000080">= </font><font color="#FF0000"><b>OBJECT
                </b></font>Drive<font color="#000080">,                 </font><font color="#008000"><i>{ CD-ROM drive }
                </i></font>Letter<font color="#000080">: </font>Byte<font color="#000080">;          </font><font color="#008000"><i>{ drive letter }
                </i></font>Header<font color="#000080">: ^</font>TDeviceHeader<font color="#000080">;
                </font>Subunit<font color="#000080">: </font>Byte<font color="#000080">;
                </font>Name<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">[</font><font color="#800000">8</font><font color="#000080">]; </font><font color="#008000"><i>{ name of driver }
                </i></font>Handle<font color="#000080">: </font>Word<font color="#000080">;
                </font>LowTrack<font color="#000080">, </font>HighTrack<font color="#000080">, </font>CurTrack<font color="#000080">: </font>Byte<font color="#000080">;
                </font>cMin<font color="#000080">, </font>cSec<font color="#000080">, </font>cFrame<font color="#000080">,                                                </font><font color="#008000"><i>{ track time }
                </i></font>tMin<font color="#000080">, </font>tSec<font color="#000080">, </font>tFrame<font color="#000080">,                                                </font><font color="#008000"><i>{ track length }
                </i></font>dMin<font color="#000080">, </font>dSec<font color="#000080">, </font>dFrame<font color="#000080">: </font>Byte<font color="#000080">;           </font><font color="#008000"><i>{ disc time }
                </i></font>Tracks<font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">64</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>TTrack<font color="#000080">;        </font><font color="#008000"><i>{ track info }
                </i></font>Status<font color="#000080">: </font>Word<font color="#000080">;                                                                        </font><font color="#008000"><i>{ drive status }
                </i></font><font color="#FF0000"><b>PROCEDURE </b></font>Eject<font color="#000080">;
                </font><font color="#FF0000"><b>PROCEDURE </b></font>Retract<font color="#000080">;
                </font><font color="#FF0000"><b>FUNCTION </b></font>State<font color="#000080">(</font>AState<font color="#000080">: </font>Word<font color="#000080">): </font>Boolean<font color="#000080">; </font><font color="#008000"><i>{ test Status field }
                </i></font><font color="#FF0000"><b>PROCEDURE </b></font>GetStatus<font color="#000080">;                                        </font><font color="#008000"><i>{ set Status field }
                </i></font><font color="#FF0000"><b>PROCEDURE </b></font>Error<font color="#000080">(</font>Code<font color="#000080">: </font>Word<font color="#000080">);
                </font><font color="#FF0000"><b>PROCEDURE </b></font>Stop<font color="#000080">;
                </font><font color="#FF0000"><b>FUNCTION </b></font>RedToHSG<font color="#000080">(</font>Redbook<font color="#000080">: </font>TRedbook<font color="#000080">): </font>LongInt<font color="#000080">;
                </font><font color="#FF0000"><b>PROCEDURE </b></font>HSGToRed<font color="#000080">(</font>HSG<font color="#000080">: </font>Longint<font color="#000080">; </font><font color="#FF0000"><b>VAR </b></font>Redbook<font color="#000080">: </font>TRedbook<font color="#000080">);
                </font><font color="#FF0000"><b>FUNCTION </b></font>Time<font color="#000080">(</font>M<font color="#000080">, </font>S<font color="#000080">, </font>F<font color="#000080">: </font>Byte<font color="#000080">): </font><font color="#FF0000"><b>String</b></font><font color="#000080">;        </font><font color="#008000"><i>{ Redbook &gt; 'mm:ss:ff' }
                </i></font><font color="#FF0000"><b>FUNCTION </b></font>Drives<font color="#000080">: </font>Byte<font color="#000080">;                                        </font><font color="#008000"><i>{ # of CD-ROM drives }
                </i></font><font color="#FF0000"><b>FUNCTION </b></font>Version<font color="#000080">: </font>Word<font color="#000080">;                                        </font><font color="#008000"><i>{ MSCDEX version }
                </i></font><font color="#FF0000"><b>FUNCTION </b></font>MediaChanged<font color="#000080">: </font>Byte<font color="#000080">;                </font><font color="#008000"><i>{ disc ready/different/etc }
                </i></font><font color="#FF0000"><b>PROCEDURE </b></font>PlayTrack<font color="#000080">(</font>Track<font color="#000080">: </font>Byte<font color="#000080">);
                </font><font color="#FF0000"><b>PROCEDURE </b></font>GetPosition<font color="#000080">;                                        </font><font color="#008000"><i>{ get play position }
                </i></font><font color="#FF0000"><b>PROCEDURE </b></font>GetTracks<font color="#000080">;                                                </font><font color="#008000"><i>{ get track info }
                </i></font><font color="#FF0000"><b>PROCEDURE </b></font>GetHandle<font color="#000080">;
                </font><font color="#FF0000"><b>PROCEDURE </b></font>GetSubUnit<font color="#000080">;
                </font><font color="#FF0000"><b>PROCEDURE </b></font>GetDriveLetter<font color="#000080">;
                </font><font color="#FF0000"><b>PROCEDURE </b></font>GetDriverName<font color="#000080">;
                </font><font color="#FF0000"><b>FUNCTION </b></font>Init<font color="#000080">: </font>Boolean<font color="#000080">;
                </font><font color="#FF0000"><b>PROCEDURE </b></font>Done<font color="#000080">;
        </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>IMPLEMENTATION

PROCEDURE </b></font>TCD<font color="#000080">.</font>Done<font color="#000080">;
</font><font color="#FF0000"><b>BEGIN
        </b></font>Drive <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;        </font>Header <font color="#000080">:= </font><font color="#FF0000"><b>NIL</b></font><font color="#000080">;
        </font>Name <font color="#000080">:= </font><font color="#800000">''</font><font color="#000080">;        </font>LowTrack <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
        </font>HighTrack <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;        </font>Status <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>FUNCTION </b></font>TCD<font color="#000080">.</font>State<font color="#000080">(</font>AState<font color="#000080">: </font>Word<font color="#000080">): </font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>BEGIN
        </b></font>State <font color="#000080">:= </font>Status <font color="#FF0000"><b>AND </b></font>AState <font color="#000080">= </font>AState<font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>PROCEDURE </b></font>TCD<font color="#000080">.</font>Error<font color="#000080">(</font>Code<font color="#000080">: </font>Word<font color="#000080">);
</font><font color="#FF0000"><b>BEGIN
        IF </b></font>Status <font color="#FF0000"><b>AND </b></font><font color="#800000">$8000 </font><font color="#000080">&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>THEN
                BEGIN
                        </b></font>Write<font color="#000080">(</font><font color="#800000">'ERROR - ('</font><font color="#000080">, </font>Status <font color="#FF0000"><b>AND </b></font><font color="#800000">$F</font><font color="#000080">, </font><font color="#800000">') '</font><font color="#000080">);
                        </font><font color="#FF0000"><b>CASE </b></font><font color="#000080">(</font>Status <font color="#FF0000"><b>AND </b></font><font color="#800000">$F</font><font color="#000080">) </font><font color="#FF0000"><b>of
                                </b></font><font color="#800000">0</font><font color="#000080">: </font>Writeln<font color="#000080">(</font><font color="#800000">'Write-protect violation'</font><font color="#000080">);
                                </font><font color="#800000">1</font><font color="#000080">: </font>Writeln<font color="#000080">(</font><font color="#800000">'Unknown unit'</font><font color="#000080">);
                                </font><font color="#800000">2</font><font color="#000080">: </font>Writeln<font color="#000080">(</font><font color="#800000">'Drive not ready'</font><font color="#000080">);
                                </font><font color="#800000">3</font><font color="#000080">: </font>Writeln<font color="#000080">(</font><font color="#800000">'Unknown command'</font><font color="#000080">);
                                </font><font color="#800000">4</font><font color="#000080">: </font>Writeln<font color="#000080">(</font><font color="#800000">'CRC error'</font><font color="#000080">);
                                </font><font color="#800000">5</font><font color="#000080">: </font>Writeln<font color="#000080">(</font><font color="#800000">'Bad drive request structure length'</font><font color="#000080">);
                                </font><font color="#800000">6</font><font color="#000080">: </font>Writeln<font color="#000080">(</font><font color="#800000">'Seek error'</font><font color="#000080">);
                                </font><font color="#800000">7</font><font color="#000080">: </font>Writeln<font color="#000080">(</font><font color="#800000">'Unknown media'</font><font color="#000080">);
                                </font><font color="#800000">8</font><font color="#000080">: </font>Writeln<font color="#000080">(</font><font color="#800000">'Sector not found'</font><font color="#000080">);
                                </font><font color="#800000">9</font><font color="#000080">: </font>Writeln<font color="#000080">(</font><font color="#800000">'Printer out of paper'</font><font color="#000080">);
                         </font><font color="#800000">10</font><font color="#000080">: </font>Writeln<font color="#000080">(</font><font color="#800000">'Write fault'</font><font color="#000080">);
                         </font><font color="#800000">11</font><font color="#000080">: </font>Writeln<font color="#000080">(</font><font color="#800000">'Read fault'</font><font color="#000080">);
                         </font><font color="#800000">12</font><font color="#000080">: </font>Writeln<font color="#000080">(</font><font color="#800000">'General failure'</font><font color="#000080">);
                         </font><font color="#800000">13</font><font color="#000080">..</font><font color="#800000">14</font><font color="#000080">: </font>Writeln<font color="#000080">(</font><font color="#800000">'Reserved error'</font><font color="#000080">);
                         </font><font color="#800000">15</font><font color="#000080">: </font>Writeln<font color="#000080">(</font><font color="#800000">'Invalid disk change'</font><font color="#000080">);
                        </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
                </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>FUNCTION </b></font>TCD<font color="#000080">.</font>Init<font color="#000080">: </font>Boolean<font color="#000080">;
</font><font color="#FF0000"><b>BEGIN
        IF </b></font>Drives <font color="#000080">&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>THEN
                BEGIN
                        </b></font>Init <font color="#000080">:= </font>True<font color="#000080">;
                        </font>Drive <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;
                        </font>GetDriveLetter<font color="#000080">;
                        </font>GetSubunit<font color="#000080">;
                        </font>GetDriverName<font color="#000080">;
                        </font>GetHandle<font color="#000080">;
                        </font>MediaChanged<font color="#000080">;
                        </font>GetPosition<font color="#000080">;
                        </font>GetStatus<font color="#000080">;
                </font><font color="#FF0000"><b>END
        ELSE
                </b></font>Init <font color="#000080">:= </font>False<font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>PROCEDURE </b></font>TCD<font color="#000080">.</font>Eject<font color="#000080">;
</font><font color="#FF0000"><b>VAR
        </b></font>E<font color="#000080">: </font>TCommand<font color="#000080">;
        </font>IOCTLO<font color="#000080">: </font>TIOCTLRequest<font color="#000080">;
        </font>Offs<font color="#000080">, </font>Segm<font color="#000080">: </font>Word<font color="#000080">;
        </font>ALetter<font color="#000080">: </font>Byte<font color="#000080">;
</font><font color="#FF0000"><b>BEGIN
        </b></font>ALetter <font color="#000080">:= </font>Letter<font color="#000080">;
        </font>Segm <font color="#000080">:= </font>Seg<font color="#000080">(</font>IOCTLO<font color="#000080">);
        </font>Offs <font color="#000080">:= </font>Ofs<font color="#000080">(</font>IOCTLO<font color="#000080">);
        </font><font color="#FF0000"><b>WITH </b></font>IOCTLO <font color="#FF0000"><b>DO
                BEGIN
                        </b></font>Media <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
                        </font>Address <font color="#000080">:= @</font>E<font color="#000080">;
                        </font>Length <font color="#000080">:= </font>SizeOf<font color="#000080">(</font>E<font color="#000080">);
                        </font>Start <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
                        </font>Res <font color="#000080">:= </font><font color="#FF0000"><b>NIL</b></font><font color="#000080">;
                        </font><font color="#FF0000"><b>WITH </b></font>Header <font color="#FF0000"><b>DO
                                BEGIN
                                        </b></font>Length <font color="#000080">:= </font><font color="#800000">26</font><font color="#000080">;        </font>Command <font color="#000080">:= </font><font color="#800000">12</font><font color="#000080">;
                                </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
                        </font>Header<font color="#000080">.</font>Subunit <font color="#000080">:= </font>Subunit<font color="#000080">;
                </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
        </font>E<font color="#000080">.</font>Command <font color="#000080">:= </font><font color="#800000">$0</font><font color="#000080">;
        </font><font color="#FF0000"><b>ASM
                </b></font><font color="#FF00FF">mov ax,Segm
                mov es,ax
                mov bx,Offs
                mov cl,ALetter
                mov ax,1510h
                int 2fh
        </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>PROCEDURE </b></font>TCD<font color="#000080">.</font>Retract<font color="#000080">;
</font><font color="#FF0000"><b>VAR
        </b></font>R<font color="#000080">: </font>TCommand<font color="#000080">;
        </font>IOCTLO<font color="#000080">: </font>TIOCTLRequest<font color="#000080">;
        </font>Offs<font color="#000080">, </font>Segm<font color="#000080">: </font>Word<font color="#000080">;
        </font>ALetter<font color="#000080">: </font>Byte<font color="#000080">;
</font><font color="#FF0000"><b>BEGIN
        </b></font>ALetter <font color="#000080">:= </font>Letter<font color="#000080">;
        </font>Segm <font color="#000080">:= </font>Seg<font color="#000080">(</font>IOCTLO<font color="#000080">);
        </font>Offs <font color="#000080">:= </font>Ofs<font color="#000080">(</font>IOCTLO<font color="#000080">);
        </font><font color="#FF0000"><b>WITH </b></font>IOCTLO <font color="#FF0000"><b>DO
                BEGIN
                        </b></font>Media <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
                        </font>Address <font color="#000080">:= @</font>R<font color="#000080">;
                        </font>Length <font color="#000080">:= </font>SizeOf<font color="#000080">(</font>R<font color="#000080">);
                        </font>Start <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
                        </font>Res <font color="#000080">:= </font><font color="#FF0000"><b>NIL</b></font><font color="#000080">;
                        </font><font color="#FF0000"><b>WITH </b></font>Header <font color="#FF0000"><b>DO
                                BEGIN
                                        </b></font>Length <font color="#000080">:= </font><font color="#800000">26</font><font color="#000080">;        </font>Command <font color="#000080">:= </font><font color="#800000">12</font><font color="#000080">;
                                </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
                        </font>Header<font color="#000080">.</font>Subunit <font color="#000080">:= </font>Subunit<font color="#000080">;
                </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
        </font>R<font color="#000080">.</font>Command <font color="#000080">:= </font><font color="#800000">$5</font><font color="#000080">;
        </font><font color="#FF0000"><b>ASM
                </b></font><font color="#FF00FF">mov ax,Segm
                mov es,ax
                mov bx,Offs
                mov cl,ALetter
                mov ax,1510h
                int 2fh
        </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;


</font><font color="#FF0000"><b>PROCEDURE </b></font>TCD<font color="#000080">.</font>Stop<font color="#000080">;
</font><font color="#FF0000"><b>VAR
 </b></font>Request<font color="#000080">: </font>TRequestHeader<font color="#000080">;
 </font>Segm<font color="#000080">, </font>Offs<font color="#000080">: </font>Word<font color="#000080">;
 </font>ALetter<font color="#000080">: </font>Byte<font color="#000080">;
</font><font color="#FF0000"><b>BEGIN
        </b></font>ALetter <font color="#000080">:= </font>Letter<font color="#000080">;
        </font>Segm <font color="#000080">:= </font>Seg<font color="#000080">(</font>Request<font color="#000080">);
        </font>Offs <font color="#000080">:= </font>Ofs<font color="#000080">(</font>Request<font color="#000080">);
        </font><font color="#FF0000"><b>WITH </b></font>Request <font color="#FF0000"><b>DO
                BEGIN
                        </b></font>Length <font color="#000080">:= </font><font color="#800000">5</font><font color="#000080">;
                        </font>Command <font color="#000080">:= </font><font color="#800000">$85</font><font color="#000080">;
                </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
        </font>Request<font color="#000080">.</font>Subunit <font color="#000080">:= </font>Subunit<font color="#000080">;
        </font><font color="#FF0000"><b>ASM
                </b></font><font color="#FF00FF">push ds
                mov  ax,Segm
                mov  es,ax
                mov  bx,Offs
                xor  cx,cx
                mov  cl,ALetter
                mov  ax,1510h
                int  2fh
                pop  ds
        </font><font color="#FF0000"><b>END
END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>PROCEDURE </b></font>TCD<font color="#000080">.</font>GetStatus<font color="#000080">;
</font><font color="#FF0000"><b>VAR
        </b></font>ALetter<font color="#000080">: </font>Byte<font color="#000080">;
        </font>DeviceStatus<font color="#000080">: </font>TDeviceStatus<font color="#000080">;
        </font>IOCTLI<font color="#000080">: </font>TIOCTLRequest<font color="#000080">;
        </font>Segm<font color="#000080">, </font>Offs<font color="#000080">: </font>Word<font color="#000080">;
</font><font color="#FF0000"><b>BEGIN
        </b></font>ALetter <font color="#000080">:= </font>Letter<font color="#000080">;
        </font>Segm <font color="#000080">:= </font>Seg<font color="#000080">(</font>IOCTLI<font color="#000080">);
        </font>Offs <font color="#000080">:= </font>Ofs<font color="#000080">(</font>IOCTLI<font color="#000080">);
        </font><font color="#FF0000"><b>WITH </b></font>IOCTLI <font color="#FF0000"><b>DO
                BEGIN
                        </b></font>Media <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
                        </font>Address <font color="#000080">:= @</font>DeviceStatus<font color="#000080">;
                        </font>Length <font color="#000080">:= </font>SizeOf<font color="#000080">(</font>DeviceStatus<font color="#000080">);
                        </font>Start <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
                        </font>Res <font color="#000080">:= </font><font color="#FF0000"><b>NIL</b></font><font color="#000080">;
                        </font><font color="#FF0000"><b>WITH </b></font>Header <font color="#FF0000"><b>DO
                                BEGIN
                                        </b></font>Length <font color="#000080">:= </font><font color="#800000">26</font><font color="#000080">;        </font>Command <font color="#000080">:= </font><font color="#800000">3</font><font color="#000080">;
                                </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
                        </font>Header<font color="#000080">.</font>Subunit <font color="#000080">:= </font>Subunit<font color="#000080">;
                </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
        </font>DeviceStatus<font color="#000080">.</font>Command <font color="#000080">:= </font><font color="#800000">$6</font><font color="#000080">;

  </font><font color="#FF0000"><b>ASM
                </b></font><font color="#FF00FF">mov ax,Segm
                mov es,ax
                mov bx,Offs
                mov cl,ALetter
                mov ax,1510h
                int 2fh
        </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
        </font>Status <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
        </font><font color="#FF0000"><b>IF </b></font>IOCTLI<font color="#000080">.</font>Header<font color="#000080">.</font>Status <font color="#FF0000"><b>AND </b></font><font color="#800000">$200 </font><font color="#000080">&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>THEN
                </b></font>Inc<font color="#000080">(</font>Status<font color="#000080">, </font>cdPlaying<font color="#000080">);
        </font><font color="#FF0000"><b>IF NOT </b></font><font color="#000080">(</font>DeviceStatus<font color="#000080">.</font>Status <font color="#FF0000"><b>AND </b></font><font color="#800000">$800 </font><font color="#000080">&gt; </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>THEN
                </b></font>Inc<font color="#000080">(</font>Status<font color="#000080">, </font>cdDisc<font color="#000080">);
        </font><font color="#FF0000"><b>IF </b></font>DeviceStatus<font color="#000080">.</font>Status <font color="#FF0000"><b>AND </b></font><font color="#800000">1 </font><font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>THEN
                </b></font>Inc<font color="#000080">(</font>Status<font color="#000080">, </font>cdDoor<font color="#000080">);
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>FUNCTION </b></font>TCD<font color="#000080">.</font>Time<font color="#000080">(</font>M<font color="#000080">, </font>S<font color="#000080">, </font>F<font color="#000080">: </font>Byte<font color="#000080">): </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
</font><font color="#FF0000"><b>VAR
        </b></font>St<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
        </font>T<font color="#000080">: </font>LongInt<font color="#000080">;
</font><font color="#FF0000"><b>BEGIN
        </b></font>T <font color="#000080">:= (</font>longint<font color="#000080">(</font>M <font color="#FF0000"><b>MOD </b></font><font color="#800000">100</font><font color="#000080">) * </font><font color="#800000">10000</font><font color="#000080">) + ((</font>S <font color="#FF0000"><b>MOD </b></font><font color="#800000">60</font><font color="#000080">) * </font><font color="#800000">100</font><font color="#000080">) + (</font>F <font color="#FF0000"><b>MOD </b></font><font color="#800000">75</font><font color="#000080">);
        </font>Str<font color="#000080">(</font>T<font color="#000080">:</font><font color="#800000">6</font><font color="#000080">, </font>St<font color="#000080">);
        </font><font color="#FF0000"><b>IF </b></font>T <font color="#000080">&gt; </font><font color="#800000">99 </font><font color="#FF0000"><b>THEN
                BEGIN
                        </b></font>Insert<font color="#000080">(</font><font color="#800000">':'</font><font color="#000080">, </font>St<font color="#000080">, </font><font color="#800000">5</font><font color="#000080">);
                        </font><font color="#FF0000"><b>IF </b></font>T <font color="#000080">&gt; </font><font color="#800000">9999 </font><font color="#FF0000"><b>THEN
                                </b></font>Insert<font color="#000080">(</font><font color="#800000">':'</font><font color="#000080">, </font>St<font color="#000080">, </font><font color="#800000">3</font><font color="#000080">)
                        </font><font color="#FF0000"><b>ELSE
                                </b></font>St <font color="#000080">:= </font>Concat<font color="#000080">(</font><font color="#800000">' '</font><font color="#000080">, </font>St<font color="#000080">);
                </font><font color="#FF0000"><b>END
        ELSE
                </b></font>St <font color="#000080">:= </font>Concat<font color="#000080">(</font><font color="#800000">'  '</font><font color="#000080">, </font>St<font color="#000080">);
        </font>Time <font color="#000080">:= </font>St<font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>PROCEDURE </b></font>TCD<font color="#000080">.</font>GetPosition<font color="#000080">;
</font><font color="#FF0000"><b>VAR
        </b></font>Segm<font color="#000080">, </font>Offs<font color="#000080">: </font>Word<font color="#000080">;
        </font>QChannel<font color="#000080">: </font>TQChannel<font color="#000080">;
        </font>IOCTLI<font color="#000080">: </font>TIOCTLRequest<font color="#000080">;
        </font>T<font color="#000080">: </font>Longint<font color="#000080">;
        </font>S<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
        </font>ALetter<font color="#000080">: </font>Byte<font color="#000080">;
</font><font color="#FF0000"><b>BEGIN
        </b></font>ALetter <font color="#000080">:= </font>Letter<font color="#000080">;
        </font>Segm <font color="#000080">:= </font>Seg<font color="#000080">(</font>IOCTLI<font color="#000080">);
        </font>Offs <font color="#000080">:= </font>Ofs<font color="#000080">(</font>IOCTLI<font color="#000080">);
        </font><font color="#FF0000"><b>WITH </b></font>IOCTLI <font color="#FF0000"><b>DO
                BEGIN
                        </b></font>Media <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
                        </font>Address <font color="#000080">:= @</font>QChannel<font color="#000080">;
                        </font>Length <font color="#000080">:= </font>SizeOf<font color="#000080">(</font>QChannel<font color="#000080">);
                        </font>Start <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
                        </font>Res <font color="#000080">:= </font><font color="#FF0000"><b>NIL</b></font><font color="#000080">;
                        </font><font color="#FF0000"><b>WITH </b></font>Header <font color="#FF0000"><b>DO
                                BEGIN
                                        </b></font>Length <font color="#000080">:= </font><font color="#800000">26</font><font color="#000080">;        </font>Command <font color="#000080">:= </font><font color="#800000">3</font><font color="#000080">;
                                </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
                        </font>Header<font color="#000080">.</font>Subunit <font color="#000080">:= </font>Subunit<font color="#000080">;
                </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
        </font>QChannel<font color="#000080">.</font>Command <font color="#000080">:= </font><font color="#800000">12</font><font color="#000080">;
        </font><font color="#FF0000"><b>ASM
                </b></font><font color="#FF00FF">mov ax,Segm
                mov es,ax
                mov bx,Offs
                xor cx,cx
                mov cl,ALetter
                mov ax,1510h
                int 2fh
        </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
        </font><font color="#FF0000"><b>WITH </b></font>QChannel <font color="#FF0000"><b>DO
                BEGIN
                        </b></font>cMin <font color="#000080">:= </font>Min<font color="#000080">; </font>cSec <font color="#000080">:= </font>Sec<font color="#000080">;        </font>cFrame <font color="#000080">:= </font>Frame<font color="#000080">;
                        </font>dMin <font color="#000080">:= </font>AMin<font color="#000080">;        </font>dSec <font color="#000080">:= </font>ASec<font color="#000080">;        </font>dFrame <font color="#000080">:= </font>AFrame<font color="#000080">;
                </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>FUNCTION </b></font>TCD<font color="#000080">.</font>RedToHSG<font color="#000080">(</font>Redbook<font color="#000080">: </font>TRedBook<font color="#000080">): </font>LongInt<font color="#000080">;
</font><font color="#FF0000"><b>BEGIN
        WITH </b></font>Redbook <font color="#FF0000"><b>DO
                </b></font>RedToHSG <font color="#000080">:= (</font>longint<font color="#000080">(</font>Minute<font color="#000080">) * </font><font color="#800000">4500</font><font color="#000080">) + (</font>Second <font color="#000080">* </font><font color="#800000">75</font><font color="#000080">) + </font>Frame <font color="#000080">- </font><font color="#800000">150</font><font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>PROCEDURE </b></font>TCD<font color="#000080">.</font>HSGToRed<font color="#000080">(</font>HSG<font color="#000080">: </font>Longint<font color="#000080">; </font><font color="#FF0000"><b>VAR </b></font>Redbook<font color="#000080">: </font>TRedbook<font color="#000080">);
</font><font color="#FF0000"><b>BEGIN
        </b></font>Inc<font color="#000080">(</font>HSG<font color="#000080">, </font><font color="#800000">150</font><font color="#000080">);
        </font><font color="#FF0000"><b>WITH </b></font>RedBook <font color="#FF0000"><b>DO
                BEGIN
                        </b></font>Minute <font color="#000080">:= </font>HSG <font color="#FF0000"><b>DIV </b></font><font color="#800000">4500</font><font color="#000080">;
                        </font>Second <font color="#000080">:= </font>HSG <font color="#FF0000"><b>DIV </b></font><font color="#800000">75 </font><font color="#FF0000"><b>MOD </b></font><font color="#800000">60</font><font color="#000080">;
                        </font>Frame <font color="#000080">:= </font>HSG <font color="#FF0000"><b>MOD </b></font><font color="#800000">75</font><font color="#000080">;
                </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>PROCEDURE </b></font>TCD<font color="#000080">.</font>PlayTrack<font color="#000080">(</font>Track<font color="#000080">: </font>Byte<font color="#000080">);
</font><font color="#FF0000"><b>VAR
 </b></font>Segm<font color="#000080">, </font>Offs<font color="#000080">: </font>Word<font color="#000080">;
 </font>ADrive<font color="#000080">: </font>Byte<font color="#000080">;
 </font>PlayRequest<font color="#000080">: </font>TPlayRequest<font color="#000080">;
 </font>Red_Length<font color="#000080">: </font>TRedbook<font color="#000080">;
        </font>StartHSG<font color="#000080">, </font>EndHSG<font color="#000080">, </font>HSG_Length<font color="#000080">: </font>Longint<font color="#000080">;
</font><font color="#FF0000"><b>BEGIN
        </b></font>CurTrack <font color="#000080">:= </font>Track<font color="#000080">;
        </font>StartHSG <font color="#000080">:= </font>RedToHSG<font color="#000080">(</font>Tracks<font color="#000080">[</font>Track<font color="#000080">].</font>Start<font color="#000080">);
        </font>EndHSG <font color="#000080">:= </font>RedToHSG<font color="#000080">(</font>Tracks<font color="#000080">[</font>Track<font color="#000080">].</font>Finish<font color="#000080">);
        </font>HSG_Length <font color="#000080">:= </font>EndHSG <font color="#000080">- </font>StartHSG<font color="#000080">;
        </font>HSGToRed<font color="#000080">(</font>HSG_Length<font color="#000080">, </font>Red_Length<font color="#000080">);
        </font><font color="#FF0000"><b>WITH </b></font>Red_Length <font color="#FF0000"><b>DO
                BEGIN
                        </b></font>tMin <font color="#000080">:= </font>Minute<font color="#000080">; </font>tSec <font color="#000080">:= </font>Second<font color="#000080">; </font>tFrame <font color="#000080">:= </font>Frame<font color="#000080">;
                </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
        </font>Segm <font color="#000080">:= </font>Seg<font color="#000080">(</font>PlayRequest<font color="#000080">);
        </font>Offs <font color="#000080">:= </font>Ofs<font color="#000080">(</font>PlayRequest<font color="#000080">);
        </font>ADrive <font color="#000080">:= </font>Letter<font color="#000080">;
        </font><font color="#FF0000"><b>WITH </b></font>PlayRequest <font color="#FF0000"><b>DO
                BEGIN
                        </b></font>Header<font color="#000080">.</font>Length <font color="#000080">:= </font>SizeOf<font color="#000080">(</font>PlayRequest<font color="#000080">);
                        </font>Header<font color="#000080">.</font>Subunit <font color="#000080">:= </font>SubUnit<font color="#000080">;
                        </font>Header<font color="#000080">.</font>Command <font color="#000080">:= </font><font color="#800000">$84</font><font color="#000080">;
                        </font>Addressing <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
                        </font>Start <font color="#000080">:= </font>RedToHSG<font color="#000080">(</font>Tracks<font color="#000080">[</font>Track<font color="#000080">].</font>Start<font color="#000080">);
                        </font>Length <font color="#000080">:= </font>RedToHSG<font color="#000080">(</font>Tracks<font color="#000080">[</font>Track<font color="#000080">].</font>Finish<font color="#000080">) - </font>RedToHSG<font color="#000080">(</font>Tracks<font color="#000080">[</font>Track<font color="#000080">].</font>Start<font color="#000080">);
                </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
        </font><font color="#FF0000"><b>ASM
                </b></font><font color="#FF00FF">push ds
                mov  ax,Segm
                mov  es,ax
                mov  bx,Offs
                xor  cx,cx
                mov  cl,ADrive
                mov  ax,1510h
                int  2fh
                pop  ds
        </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>PROCEDURE </b></font>TCD<font color="#000080">.</font>GetTracks<font color="#000080">;
</font><font color="#FF0000"><b>VAR
        </b></font>DiskInfo<font color="#000080">: </font>TDiskInfo<font color="#000080">;
        </font>TrackInfo<font color="#000080">: </font>TTrackInfo<font color="#000080">;
        </font>Segm<font color="#000080">, </font>Offs<font color="#000080">: </font>Word<font color="#000080">;
        </font>Z<font color="#000080">: </font>Byte<font color="#000080">;
        </font>AHandle<font color="#000080">: </font>Word<font color="#000080">;
</font><font color="#FF0000"><b>BEGIN
        </b></font>AHandle <font color="#000080">:= </font>Handle<font color="#000080">;
        </font>Segm <font color="#000080">:= </font>Seg<font color="#000080">(</font>DiskInfo<font color="#000080">);
        </font>Offs <font color="#000080">:= </font>Ofs<font color="#000080">(</font>DiskInfo<font color="#000080">);
        </font>DiskInfo<font color="#000080">.</font>Command <font color="#000080">:= </font><font color="#800000">$A</font><font color="#000080">;
        </font><font color="#FF0000"><b>ASM
                </b></font><font color="#FF00FF">push ds
                mov  ax,Segm
                mov  ds,ax
                mov  dx,Offs
                mov  bx,AHandle
                mov  cx,7
                mov  ax,4402h
                int  21h
                pop  ds
        </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

        </font>HighTrack <font color="#000080">:= </font>DiskInfo<font color="#000080">.</font>HighTrack<font color="#000080">;
        </font>LowTrack <font color="#000080">:= </font>DiskInfo<font color="#000080">.</font>LowTrack<font color="#000080">;

        </font>Segm <font color="#000080">:= </font>Seg<font color="#000080">(</font>TrackInfo<font color="#000080">);
        </font>Offs <font color="#000080">:= </font>Ofs<font color="#000080">(</font>TrackInfo<font color="#000080">);
        </font>TrackInfo<font color="#000080">.</font>Command <font color="#000080">:= </font><font color="#800000">$B</font><font color="#000080">;

        </font><font color="#FF0000"><b>FOR </b></font>Z <font color="#000080">:= </font>LowTrack <font color="#FF0000"><b>TO </b></font>HighTrack <font color="#FF0000"><b>DO
                BEGIN
                        </b></font>TrackInfo<font color="#000080">.</font>Track <font color="#000080">:= </font>Z<font color="#000080">;
                        </font><font color="#FF0000"><b>ASM
                                </b></font><font color="#FF00FF">push ds
                                mov  ax,Segm
                                mov  ds,ax
                                mov  dx,Offs
                                mov  bx,AHandle
                                mov  cx,7
                                mov  ax,4402h
                                int  21h
                                pop  ds
                        </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
                        </font>Tracks<font color="#000080">[</font>Z<font color="#000080">].</font>Start <font color="#000080">:= </font>TrackInfo<font color="#000080">.</font>Start<font color="#000080">;
                </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

        </font><font color="#FF0000"><b>FOR </b></font>Z <font color="#000080">:= </font>LowTrack <font color="#000080">+ </font><font color="#800000">1 </font><font color="#FF0000"><b>TO </b></font>HighTrack <font color="#FF0000"><b>DO
                BEGIN
                        </b></font>TrackInfo<font color="#000080">.</font>Track <font color="#000080">:= </font>Z<font color="#000080">;
                        </font>Tracks<font color="#000080">[</font>Z <font color="#000080">- </font><font color="#800000">1</font><font color="#000080">].</font>Finish <font color="#000080">:= </font>Tracks<font color="#000080">[</font>Z<font color="#000080">].</font>Start<font color="#000080">;
                </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
        </font>Tracks<font color="#000080">[</font>HighTrack<font color="#000080">].</font>Finish <font color="#000080">:= </font>DiskInfo<font color="#000080">.</font>LeadOut<font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>FUNCTION </b></font>TCD<font color="#000080">.</font>MediaChanged<font color="#000080">: </font>Byte<font color="#000080">;
</font><font color="#FF0000"><b>VAR
        </b></font>AHandle<font color="#000080">, </font>Segm<font color="#000080">, </font>Offs<font color="#000080">: </font>Word<font color="#000080">;
        </font>Buffer<font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">127</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Byte<font color="#000080">;
</font><font color="#FF0000"><b>BEGIN
        </b></font>Segm <font color="#000080">:= </font>Seg<font color="#000080">(</font>Buffer<font color="#000080">);
        </font>Offs <font color="#000080">:= </font>Ofs<font color="#000080">(</font>Buffer<font color="#000080">);
        </font>AHandle <font color="#000080">:= </font>Handle<font color="#000080">;
        </font><font color="#FF0000"><b>ASM
                </b></font><font color="#FF00FF">push ds
                mov  ax,Segm
                mov  ds,ax
                mov  dx,Offs
                mov  bx,dx
                mov  al,9h
                mov  ds:[bx],al
                mov  bx,AHandle
                mov  cx,2
                mov  ax,4402h
                int  21h
                pop  ds
        </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
        </font>MediaChanged <font color="#000080">:= </font>Buffer<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">];
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>PROCEDURE </b></font>TCD<font color="#000080">.</font>GetHandle<font color="#000080">;
</font><font color="#FF0000"><b>VAR
        </b></font>Result<font color="#000080">, </font>Segm<font color="#000080">, </font>Offs<font color="#000080">: </font>Word<font color="#000080">;
</font><font color="#FF0000"><b>BEGIN
        </b></font>Segm <font color="#000080">:= </font>Seg<font color="#000080">(</font>Name<font color="#000080">);
        </font>Offs <font color="#000080">:= </font>Succ<font color="#000080">(</font>Ofs<font color="#000080">(</font>Name<font color="#000080">));
        </font><font color="#FF0000"><b>ASM
                </b></font><font color="#FF00FF">push ds
                mov  ax,Segm
                mov  ds,ax
                mov  dx,Offs
                mov  ah,3dh
                mov  al,2h
                int  21h
                jc   @1
                mov         Result,ax
                jmp @2
                @1:
                mov Result,0h
                @2:
                pop ds
        </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
        </font>Handle <font color="#000080">:= </font>Result<font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>PROCEDURE </b></font>TCD<font color="#000080">.</font>GetDriverName<font color="#000080">;
</font><font color="#FF0000"><b>BEGIN
        </b></font>Name <font color="#000080">:= </font><font color="#800000">''</font><font color="#000080">;
        </font>Move<font color="#000080">(</font>Header<font color="#000080">^.</font>Name<font color="#000080">, </font>Name<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">], </font><font color="#800000">8</font><font color="#000080">);
        </font><font color="#FF0000"><b>REPEAT
                </b></font>Inc<font color="#000080">(</font>Name<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">]);
        </font><font color="#FF0000"><b>UNTIL </b></font><font color="#000080">(</font>Length<font color="#000080">(</font>Name<font color="#000080">) = </font><font color="#800000">8</font><font color="#000080">) </font><font color="#FF0000"><b>OR </b></font><font color="#000080">(</font>Name<font color="#000080">[</font>Length<font color="#000080">(</font>Name<font color="#000080">)] = </font><font color="#800000">#32</font><font color="#000080">);
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>PROCEDURE </b></font>TCD<font color="#000080">.</font>GetDriveLetter<font color="#000080">;
</font><font color="#FF0000"><b>VAR
        </b></font>DriveLetterList<font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">26</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Byte<font color="#000080">;
        </font>Segm<font color="#000080">, </font>Offs<font color="#000080">: </font>Word<font color="#000080">;
</font><font color="#FF0000"><b>BEGIN
        </b></font>Segm <font color="#000080">:= </font>Seg<font color="#000080">(</font>DriveLetterList<font color="#000080">);
        </font>Offs <font color="#000080">:= </font>Ofs<font color="#000080">(</font>DriveLetterList<font color="#000080">);

  </font><font color="#FF0000"><b>ASM
                </b></font><font color="#FF00FF">mov ax,Segm
                mov es,ax
                mov bx,Offs
                mov ax,150Dh
                int 2fh
        </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
        </font>Letter <font color="#000080">:= </font>DriveLetterList<font color="#000080">[</font>Drive<font color="#000080">];
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;


</font><font color="#FF0000"><b>FUNCTION </b></font>TCD<font color="#000080">.</font>Version<font color="#000080">: </font>Word<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>ASM
        </b></font><font color="#FF00FF">mov  ax,150ch
        int  2fh
        mov  ax,bx
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;


</font><font color="#FF0000"><b>PROCEDURE </b></font>TCD<font color="#000080">.</font>GetSubunit<font color="#000080">;
</font><font color="#FF0000"><b>VAR
        </b></font>DeviceList<font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">26</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>TDevice<font color="#000080">;
        </font>Segm<font color="#000080">, </font>Offs<font color="#000080">: </font>Word<font color="#000080">;
</font><font color="#FF0000"><b>BEGIN
        </b></font>Segm <font color="#000080">:= </font>Seg<font color="#000080">(</font>DeviceList<font color="#000080">);
        </font>Offs <font color="#000080">:= </font>Ofs<font color="#000080">(</font>DeviceList<font color="#000080">);
        </font><font color="#FF0000"><b>ASM
                </b></font><font color="#FF00FF">mov ax,Segm
                mov es,ax
                mov bx,Offs
                mov ax,1501h
                int 2fh
        </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
        </font>Subunit <font color="#000080">:= </font>DeviceList<font color="#000080">[</font>Drive<font color="#000080">].</font>Subunit<font color="#000080">;
        </font>Header <font color="#000080">:= </font>DeviceList<font color="#000080">[</font>Drive<font color="#000080">].</font>Header<font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>FUNCTION </b></font>TCD<font color="#000080">.</font>Drives<font color="#000080">: </font>Byte<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>ASM
        </b></font><font color="#FF00FF">mov ax,1500h
        mov bx,0
        int 2fh
        mov al,bl
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>END</b></font><font color="#000080">.

</font><font color="#008000"><i>{ ----------------------   DEMO PROGRAM ------------------ }

</i></font><font color="#FF0000"><b>PROGRAM </b></font>CDPLAY<font color="#000080">;
</font><font color="#008000"><i>{ Test program for CDAUDIO unit.        
        Plays audio tracks sequentially until keypressed.
}
</i></font><font color="#FF0000"><b>Uses </b></font>CRT<font color="#000080">, </font>CDAUDIO<font color="#000080">;

</font><font color="#FF0000"><b>VAR
        </b></font>CD<font color="#000080">: </font>TCD<font color="#000080">;
        </font>Track<font color="#000080">: </font>Byte<font color="#000080">;
        </font>Ticker<font color="#000080">: </font>Longint <font color="#FF0000"><b>ABSOLUTE </b></font><font color="#800000">$40</font><font color="#000080">:</font><font color="#800000">$6c</font><font color="#000080">;
        </font>Tick<font color="#000080">: </font>Longint<font color="#000080">;
</font><font color="#FF0000"><b>BEGIN
        IF </b></font>CD<font color="#000080">.</font>Init <font color="#FF0000"><b>THEN
                WITH </b></font>CD <font color="#FF0000"><b>DO
                        BEGIN
                                </b></font>GetTracks<font color="#000080">;
                                </font>Writeln<font color="#000080">(</font>CD<font color="#000080">.</font>HighTrack<font color="#000080">, </font><font color="#800000">' tracks'</font><font color="#000080">);
                                </font>Track <font color="#000080">:= </font>LowTrack<font color="#000080">;
                                </font><font color="#FF0000"><b>WHILE </b></font><font color="#000080">(</font>Track <font color="#000080">&lt;= </font>HighTrack<font color="#000080">) </font><font color="#FF0000"><b>AND NOT </b></font>Keypressed <font color="#FF0000"><b>DO
                                        BEGIN
                                                </b></font>PlayTrack<font color="#000080">(</font>Track<font color="#000080">);
                                                </font>Write<font color="#000080">(</font><font color="#800000">'TRACK '</font><font color="#000080">, </font>Track<font color="#000080">, </font><font color="#800000">' LENGTH '</font><font color="#000080">, </font>Time<font color="#000080">(</font>tMin<font color="#000080">, </font>tSec<font color="#000080">, </font>tFrame<font color="#000080">), </font><font color="#800000">' TIME '</font><font color="#000080">);
                                                </font><font color="#FF0000"><b>REPEAT
                                                        </b></font>Tick <font color="#000080">:= </font>Ticker<font color="#000080">;
                                                        </font><font color="#FF0000"><b>REPEAT UNTIL </b></font>Ticker <font color="#000080">&lt;&gt; </font>Tick<font color="#000080">;
                                                        </font>GetPosition<font color="#000080">;
                                                        </font>Write<font color="#000080">(</font>Time<font color="#000080">(</font>cMin<font color="#000080">, </font>cSec<font color="#000080">, </font>cFrame<font color="#000080">));
                                                        </font>GetStatus<font color="#000080">;
                                                        </font>Write<font color="#000080">(</font><font color="#800000">#8#8#8#8#8#8#8#8</font><font color="#000080">);
                                                </font><font color="#FF0000"><b>UNTIL </b></font>Keypressed <font color="#FF0000"><b>OR NOT </b></font>State<font color="#000080">(</font>cdPlaying<font color="#000080">);
                                                </font>Writeln<font color="#000080">;
                                                </font>Inc<font color="#000080">(</font>Track<font color="#000080">);
                                        </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
                        </font><font color="#FF0000"><b>IF </b></font>State<font color="#000080">(</font>cdPlaying<font color="#000080">) </font><font color="#FF0000"><b>THEN
                                </b></font>Stop<font color="#000080">;
                        </font>Done<font color="#000080">;
                </font><font color="#FF0000"><b>END
        ELSE
                </b></font>Writeln<font color="#000080">(</font><font color="#800000">'No CD-ROM drive?!'</font><font color="#000080">);
</font><font color="#FF0000"><b>END</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to SOUND SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0093.PAS">Original</a><b>]</b></p></body>
</html>
