<html>
<head><title> "Speaker Module in ASM" by RICHARD SANDS</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to SOUND SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0038.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#FF0000"><b>UNIT </b></font>Tone<font color="#000080">;  </font><font color="#008000"><i>{$S-,R-,D-,L-}

    (* TONE.PAS - Sound Module for Turbo Pascal 6.0 - Turbo Vision
     * Written by Richard R. Sands
     * Compuserve ID 70274,103
     * January 1991
     *
     * NOTE: Do Not Overlay
     *)

</i></font><font color="#FF0000"><b>INTERFACE

   Procedure </b></font>Sound<font color="#000080">(</font>Hz<font color="#000080">:</font>Word<font color="#000080">);
   </font><font color="#FF0000"><b>Procedure </b></font>NoSound<font color="#000080">;
   </font><font color="#FF0000"><b>Procedure </b></font>Delay<font color="#000080">(</font>MS <font color="#000080">: </font>Word<font color="#000080">);

   </font><font color="#FF0000"><b>Procedure </b></font>Beep<font color="#000080">(</font>Hz<font color="#000080">, </font>MS<font color="#000080">:</font>Word<font color="#000080">);
     </font><font color="#008000"><i>{ Same as
               Sound(Hz);
               Delay(MS);
               NoSound;       ...but with more efficient code. }

   </i></font><font color="#FF0000"><b>Procedure </b></font>BoundsBeep<font color="#000080">;
     </font><font color="#008000"><i>{ Used for signalling a boundry or invalid command }

   </i></font><font color="#FF0000"><b>Procedure </b></font>ErrorBeep<font color="#000080">;
     </font><font color="#008000"><i>{ Used for signalling an error condition }

   </i></font><font color="#FF0000"><b>Procedure </b></font>AttentionBeep<font color="#000080">;
     </font><font color="#008000"><i>{ Used for signalling the user }

</i></font><font color="#FF0000"><b>IMPLEMENTATION

  VAR
    </b></font>OneMS <font color="#000080">: </font>Word<font color="#000080">;

</font><font color="#008000"><i>{ ------------------------------------------------------------------------- }
</i></font><font color="#FF0000"><b>Procedure </b></font>Beep<font color="#000080">(</font>Hz<font color="#000080">, </font>MS<font color="#000080">:</font>Word<font color="#000080">); </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
     </font><font color="#008000"><i>{ Make the Sound at Frequency Hz for MS milliseconds }
  </i></font><font color="#FF0000"><b>ASM
    </b></font><font color="#FF00FF">MOV  BX,Hz
    MOV  AX,34DDH
    MOV  DX,0012H
    CMP  DX,BX
    JNC  @Stop
    DIV  BX
    MOV  BX,AX
    IN          AL,61H
    TEST AL,3
    JNZ  @99
    OR          AL,3
    OUT  61H,AL
    MOV  AL,0B6H
    OUT  43H,AL
 @99:
    MOV  AL,BL
    OUT  42H,AL
    MOV  AL,BH
    OUT  42H,AL
 @Stop:
 </font><font color="#008000"><i>{$IFOPT G+}
    </i></font><font color="#FF00FF">PUSH MS
 </font><font color="#008000"><i>{$ELSE }
    </i></font><font color="#FF00FF">MOV  AX, MS   </font><font color="#008000"><i>{ push delay time }
    </i></font><font color="#FF00FF">PUSH AX
  </font><font color="#008000"><i>{$ENDIF }
    </i></font><font color="#FF00FF">CALL Delay    </font><font color="#008000"><i>{ and wait... }

    </i></font><font color="#FF00FF">IN   AL, $61  </font><font color="#008000"><i>{ Now turn off the speaker }
    </i></font><font color="#FF00FF">AND  AL, $FC
    OUT  $61, AL
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{ ------------------------------------------------------------------------- }
</i></font><font color="#FF0000"><b>Procedure </b></font>BoundsBeep<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>asm
  </b></font><font color="#008000"><i>{$IFOPT G+ }
     </i></font><font color="#FF00FF">PUSH 1234      </font><font color="#008000"><i>{ Pass the Frequency }
     </i></font><font color="#FF00FF">PUSH 10        </font><font color="#008000"><i>{ Pass the delay time }
  {$ELSE}
     </i></font><font color="#FF00FF">MOV  AX, 1234  </font><font color="#008000"><i>{ Pass the Frequency }
     </i></font><font color="#FF00FF">PUSH AX
     MOV  AX, 10    </font><font color="#008000"><i>{ Pass the delay time }
     </i></font><font color="#FF00FF">PUSH AX
   </font><font color="#008000"><i>{$ENDIF }
     </i></font><font color="#FF00FF">CALL Beep
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{ ------------------------------------------------------------------------- }
</i></font><font color="#FF0000"><b>Procedure </b></font>ErrorBeep<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>asm
  </b></font><font color="#008000"><i>{$IFOPT G+ }
     </i></font><font color="#FF00FF">PUSH 800   </font><font color="#008000"><i>{ Pass the Frequency }
     </i></font><font color="#FF00FF">PUSH 75    </font><font color="#008000"><i>{ Pass the delay time }
  {$ELSE}
     </i></font><font color="#FF00FF">MOV  AX, 800  </font><font color="#008000"><i>{ Pass the Frequency }
     </i></font><font color="#FF00FF">PUSH AX
     MOV  AX, 75   </font><font color="#008000"><i>{ Pass the delay time }
     </i></font><font color="#FF00FF">PUSH AX
  </font><font color="#008000"><i>{$ENDIF }
     </i></font><font color="#FF00FF">CALL Beep
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{ ------------------------------------------------------------------------- }
</i></font><font color="#FF0000"><b>Procedure </b></font>AttentionBeep<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>asm
  </b></font><font color="#008000"><i>{$IFOPT G+ }
     </i></font><font color="#FF00FF">PUSH 660   </font><font color="#008000"><i>{ Pass the Frequency }
     </i></font><font color="#FF00FF">PUSH 50    </font><font color="#008000"><i>{ Pass the delay time }
  {$ELSE}
     </i></font><font color="#FF00FF">MOV  AX, 660  </font><font color="#008000"><i>{ Pass the Frequency }
     </i></font><font color="#FF00FF">PUSH AX
     MOV  AX, 50   </font><font color="#008000"><i>{ Pass the delay time }
     </i></font><font color="#FF00FF">PUSH AX
  </font><font color="#008000"><i>{$ENDIF }
     </i></font><font color="#FF00FF">CALL Beep
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{ ------------------------------------------------------------------------- }
</i></font><font color="#FF0000"><b>Procedure </b></font>Sound<font color="#000080">(</font>Hz<font color="#000080">:</font>Word<font color="#000080">); </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
   </font><font color="#FF0000"><b>ASM
      </b></font><font color="#FF00FF">MOV  BX,Hz
      MOV  AX,34DDH
      MOV  DX,0012H
      CMP  DX,BX
      JNC  @DONE
      DIV  BX
      MOV  BX,AX
      IN   AL,61H
      TEST AL,3
      JNZ  @99
      OR   AL,3
      OUT  61H,AL
      MOV  AL,0B6H
      OUT  43H,AL
@99:  MOV  AL,BL
      OUT  42H,AL
      MOV  AL,BH
      OUT  42H,AL
@DONE:
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{ ------------------------------------------------------------------------- }
</i></font><font color="#FF0000"><b>Procedure </b></font>NoSound<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>asm
     </b></font><font color="#FF00FF">IN   AL, $61
     AND  AL, $FC
     OUT  $61, AL
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{ ------------------------------------------------------------------------- }
</i></font><font color="#FF0000"><b>procedure </b></font>DelayOneMS<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>asm
     </b></font><font color="#FF00FF">PUSH CX         </font><font color="#008000"><i>{ Save CX }
     </i></font><font color="#FF00FF">MOV  CX, OneMS  </font><font color="#008000"><i>{ Loop count into CX }
  </i></font><font color="#FF00FF">@1:
     LOOP @1         </font><font color="#008000"><i>{ Wait one millisecond }
     </i></font><font color="#FF00FF">POP  CX         </font><font color="#008000"><i>{ Restore CX }
  </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{ ------------------------------------------------------------------------- }
</i></font><font color="#FF0000"><b>Procedure </b></font>Delay<font color="#000080">(</font>ms<font color="#000080">:</font>Word<font color="#000080">); </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>asm
     </b></font><font color="#FF00FF">MOV  CX, ms    
     JCXZ @2           
  @1:
     CALL DelayOneMS
     LOOP @1
  @2:
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{ ------------------------------------------------------------------------- }
</i></font><font color="#FF0000"><b>Procedure </b></font>Calibrate_Delay<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>asm   
     </b></font><font color="#FF00FF">MOV  AX,40h         
     MOV  ES,AX          
     MOV  DI,6Ch          </font><font color="#008000"><i>{ ES:DI is the low word of BIOS timer count }
     </i></font><font color="#FF00FF">MOV  OneMS,55        </font><font color="#008000"><i>{ Initial value for One MS's time }
     </i></font><font color="#FF00FF">XOR  DX,DX           </font><font color="#008000"><i>{ DX = 0 }
     </i></font><font color="#FF00FF">MOV  AX,ES:[DI]      </font><font color="#008000"><i>{ AX = low word of timer }
  </i></font><font color="#FF00FF">@1:
     CMP  AX,ES:[DI]      </font><font color="#008000"><i>{ Keep looking at low word of timer }
     </i></font><font color="#FF00FF">JE   @1              </font><font color="#008000"><i>{ until its value changes... }
     </i></font><font color="#FF00FF">MOV  AX,ES:[DI]      </font><font color="#008000"><i>{ ...then save it }
  </i></font><font color="#FF00FF">@2:
     CAll DelayOneMs      </font><font color="#008000"><i>{ Delay for a count of OneMS (55) }
     </i></font><font color="#FF00FF">INC  DX              </font><font color="#008000"><i>{ Increment loop counter }
     </i></font><font color="#FF00FF">CMP  AX,ES:[DI]      </font><font color="#008000"><i>{ Keep looping until the low word }
     </i></font><font color="#FF00FF">JE   @2              </font><font color="#008000"><i>{ of the timer count changes again }
     </i></font><font color="#FF00FF">MOV  OneMS, DX       </font><font color="#008000"><i>{ DX has new OneMS }
  </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>BEGIN
  </b></font>Calibrate_Delay
<font color="#FF0000"><b>END</b></font><font color="#000080">.

</font><font color="#008000"><i>{ ==============================  DEMO ==================================}

</i></font><font color="#FF0000"><b>Program </b></font>ToneTest<font color="#000080">;

</font><font color="#FF0000"><b>USES </b></font>Tone<font color="#000080">;

</font><font color="#FF0000"><b>begin
   </b></font>ErrorBeep<font color="#000080">;
   </font>Delay<font color="#000080">(</font><font color="#800000">500</font><font color="#000080">);
   </font>AttentionBeep<font color="#000080">;
   </font>Delay<font color="#000080">(</font><font color="#800000">500</font><font color="#000080">);
   </font>BoundsBeep<font color="#000080">;
   </font>Delay<font color="#000080">(</font><font color="#800000">500</font><font color="#000080">);
   </font>Beep<font color="#000080">(</font><font color="#800000">440</font><font color="#000080">, </font><font color="#800000">250</font><font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to SOUND SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0038.PAS">Original</a><b>]</b></p></body>
</html>
