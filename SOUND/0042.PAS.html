<html>
<head><title> "SBTALKER" by WILBERT VAN LEIJEN</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to SOUND SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0042.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
Sasha Case,

12-Apr-94 20:07, Sasha Case wrote to All
               Subject: SBTALKER
              Terminate 1.40 REGISTERED


 SC&gt; @MSGID: 3:711/929@fidonet 72328398
 SC&gt; @REGEED: 1.02u2 00910093
 SC&gt; Hi Everyone,
 SC&gt; 
 SC&gt; I've tried once, a coupla months ago, but I'll try again:
 SC&gt; 
 SC&gt; I'm look for anyone with a Sound Blaster SDK or anyone who knows/has 
 SC&gt; source for 
 SC&gt; how to access SBTALKER that comes with soundblaster.  Programs like 
 SC&gt; SBTALKER 
 SC&gt; and READ do it, and I have seen source for something that did what I
 SC&gt; needed,
 SC&gt; except it used a library I haven't got.  Any help on Units that do this
 SC&gt; or

Here you go!
}

</i></font><font color="#FF0000"><b>Unit </b></font>SBTS<font color="#000080">;

</font><font color="#FF0000"><b>Interface

</b></font><font color="#008000"><i>{     This unit provides an interface to the SBTALKER (TM) Text-to-Speech
      driver.

      USAGE NOTES:
       1.  Make sure you have made SBTALKER resident, prior to running your
           application.  Call from the DOS command line:
              SBTALKER /DBLASTER

           SBTALKER.EXE and BLASTER.DRV are found on the diskettes that
           came with the Sound Blaster.
       2.  Due to the fact that this unit relies on the built-in assembler,
           you'll need Turbo Pascal, version 6.0 or later to recompile.
       3.  IMPORTANT:  Don't attempt to run an application within the
           Turbo Pascal Integrated Development Environment.  Do not launch
           it inside a software-debugger either!  It'll HANG your system.
           RUN it from the DOS command line.

       Written by Wilbert van Leijen, Amsterdam 1991.
       Released with source code and all to the Public Domain on an
       AS-IS basis.  The author assumes NO liability; you use this at your
       risk.

       SBTALKER is a registred trade mark of First Byte, Inc. }

</i></font><font color="#FF0000"><b>Type
  </b></font>SpeechType   <font color="#000080">= </font><font color="#FF0000"><b>Record                </b></font><font color="#008000"><i>{ SBTALKER configuration record }
                   </i></font>talk<font color="#000080">,
                   </font>phoneme     <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
                   </font>gender<font color="#000080">,
                   </font>tone<font color="#000080">,
                   </font>volume<font color="#000080">,
                   </font>pitch<font color="#000080">,
                   </font>speed       <font color="#000080">: </font>Integer<font color="#000080">;
                 </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Const
  </b></font>TalkerReady  <font color="#000080">: </font>Boolean <font color="#000080">= </font>False<font color="#000080">;      </font><font color="#008000"><i>{ Flag indicating SBTALKER status }

</i></font><font color="#FF0000"><b>Var
  </b></font>TalkPtr      <font color="#000080">: </font>Pointer<font color="#000080">;              </font><font color="#008000"><i>{ Pointer to the resident driver }
  </i></font>SpeechRec    <font color="#000080">: ^</font>SpeechType<font color="#000080">;          </font><font color="#008000"><i>{ Pointer to the configuration record }

</i></font><font color="#FF0000"><b>Procedure </b></font>Say<font color="#000080">(</font>talk <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">);
</font><font color="#FF0000"><b>Procedure </b></font>Settings<font color="#000080">(</font>gender<font color="#000080">, </font>tone<font color="#000080">, </font>volume<font color="#000080">, </font>pitch<font color="#000080">, </font>speed <font color="#000080">: </font>Integer<font color="#000080">);
</font><font color="#FF0000"><b>Function </b></font>UnloadDriver <font color="#000080">: </font>Boolean<font color="#000080">;

</font><font color="#FF0000"><b>Implementation

</b></font><font color="#008000"><i>{$R-,S- }

{ Talk to me }

</i></font><font color="#FF0000"><b>Procedure </b></font>Say<font color="#000080">(</font>talk <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">); </font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;

</font><font color="#FF0000"><b>ASM
        </b></font><font color="#FF00FF">CMP    [TalkerReady], False
        JE     @1
        LES    DI, [SpeechRec]
        PUSH   DS
        LDS    SI, talk
        CLD
        LODSB
        STOSB
        XOR    CH, CH
        MOV    CL, AL
        REP    MOVSB
        POP    DS
        MOV    AL, 7
        CALL   [TalkPtr]
@1:
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;  </font><font color="#008000"><i>{ Say }

{ Alter the settings of the SBTALKER driver.
  Gender: 0 is male, 1 is female;
  Tone:   0 is bass, 1 is treble;
  Volume, pitch and speed must be within the range 0..9.   }

</i></font><font color="#FF0000"><b>Procedure </b></font>Settings<font color="#000080">(</font>gender<font color="#000080">, </font>tone<font color="#000080">, </font>volume<font color="#000080">, </font>pitch<font color="#000080">, </font>speed <font color="#000080">: </font>Integer<font color="#000080">); </font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;

</font><font color="#FF0000"><b>ASM
        </b></font><font color="#FF00FF">CMP    [TalkerReady], False
        JE     @1
        LES    DI, [SpeechRec]
        CLD
        ADD    DI, SpeechType.gender
        MOV    AX, gender
        STOSW
        MOV    AX, tone
        STOSW
        MOV    AX, volume
        STOSW
        MOV    AX, pitch
        STOSW
        MOV    AX, speed
        STOSW
        MOV    AL, 2
        CALL   [TalkPtr]
@1:
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;  </font><font color="#008000"><i>{ Settings }

{ Unload the SBTALKER driver.  Returns True is successful }

</i></font><font color="#FF0000"><b>Function </b></font>UnloadDriver <font color="#000080">: </font>Boolean<font color="#000080">; </font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;

</font><font color="#FF0000"><b>ASM
        </b></font><font color="#FF00FF">MOV    AX, False
        CMP    [TalkerReady], False
        JE     @1
        MOV    AX, 0FBFFh
        INT    2Fh
@1:
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;  </font><font color="#008000"><i>{ UnloadDriver }

</i></font><font color="#FF0000"><b>Begin  </b></font><font color="#008000"><i>{ SBTS }
</i></font><font color="#FF0000"><b>ASM

  </b></font><font color="#008000"><i>{ Get the vector to multiplex interrupt 2Fh.  Assume it belongs to SBTALKER }

        </i></font><font color="#FF00FF">MOV    AX, 352Fh
        INT    21h
        MOV    AX, ES
        OR     AX, AX
        JZ     @1

  </font><font color="#008000"><i>{ Pass the magic number to the handler }

        </i></font><font color="#FF00FF">MOV    AX, 0FBFBh
        INT    2Fh

  </font><font color="#008000"><i>{ Driver responds if the return code is non zero }

        </i></font><font color="#FF00FF">OR     AX, AX
        JNE    @1

  </font><font color="#008000"><i>{ Retrieve the pointers to the SBTALKER driver and its configuration record }

        </i></font><font color="#FF00FF">MOV    AX, ES:[BX+4]
        MOV    DX, ES:[BX+6]
        MOV    Word Ptr [TalkPtr], AX
        MOV    Word Ptr [TalkPtr+2], DX
        ADD    BX, 20h
        MOV    Word Ptr [SpeechRec], BX
        MOV    Word Ptr [SpeechRec+2], DX

  </font><font color="#008000"><i>{ Put the default values for gender, tone etc. into this record }

        </i></font><font color="#FF00FF">LES    DI, [SpeechRec]
        ADD    DI, SpeechType.gender
        CLD
        SUB    AX, AX
        STOSW                          </font><font color="#008000"><i>{ gender = male }
        </i></font><font color="#FF00FF">STOSW                          </font><font color="#008000"><i>{ tone   = bass }
        </i></font><font color="#FF00FF">MOV    AX, 5
        STOSW                          </font><font color="#008000"><i>{ volume = 5 }
        </i></font><font color="#FF00FF">STOSW                          </font><font color="#008000"><i>{ pitch  = 5 }
        </i></font><font color="#FF00FF">STOSW                          </font><font color="#008000"><i>{ speed  = 5 }
        </i></font><font color="#FF00FF">MOV    AL, 2
        CALL   [TalkPtr]
        MOV    [TalkerReady], True
@1:
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">.  </font><font color="#008000"><i>{ SBTS }

</i></font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to SOUND SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0042.PAS">Original</a><b>]</b></p></body>
</html>
