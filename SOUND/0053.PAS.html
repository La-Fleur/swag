<html>
<head><title> "Call AD-LIB sound driver" by SWAG SUPPORT TEAM</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to SOUND SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0053.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#FF0000"><b>unit </b></font>MusicIO<font color="#000080">;
</font><font color="#008000"><i>{Contains procedures and function to call to Ad-Lib sound Driver.
 if Sound Driver is not Loaded the system WILL Crash.
 Parameters must be passed backwards since the sound driver is made
 for a C parameter passing sequence.}

</i></font><font color="#FF0000"><b>interface

  uses
    </b></font>DOS<font color="#000080">;

  </font><font color="#FF0000"><b>type
    </b></font>Instrument <font color="#000080">= </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">26</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>integer<font color="#000080">;

  </font><font color="#FF0000"><b>var
    </b></font>GActVoice <font color="#000080">:</font>word<font color="#000080">; </font><font color="#008000"><i>{Active Voice}
    </i></font>GT        <font color="#000080">:</font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">10</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Instrument<font color="#000080">; </font><font color="#008000"><i>{use global variable to keep array valid}

  </i></font><font color="#FF0000"><b>procedure </b></font>InitDriver<font color="#000080">;
  </font><font color="#FF0000"><b>procedure </b></font>RelTimeStart<font color="#000080">(</font>TimeNum<font color="#000080">,</font>TimeDen <font color="#000080">:</font>integer<font color="#000080">);
  </font><font color="#FF0000"><b>procedure </b></font>SetState<font color="#000080">(</font>State <font color="#000080">:</font>integer<font color="#000080">);
  </font><font color="#FF0000"><b>function </b></font>GetState <font color="#000080">:</font>boolean<font color="#000080">;
  </font><font color="#FF0000"><b>procedure </b></font>SetMode<font color="#000080">(</font>PercussionMode <font color="#000080">:</font>integer<font color="#000080">);
  </font><font color="#FF0000"><b>function </b></font>SetVolume<font color="#000080">(</font>VolNum<font color="#000080">,</font>VolDen<font color="#000080">,</font>TimeNum<font color="#000080">,</font>TimeDen <font color="#000080">:</font>integer<font color="#000080">) :</font>boolean<font color="#000080">;
  </font><font color="#FF0000"><b>function </b></font>SetTempo<font color="#000080">(</font>Tempo<font color="#000080">,</font>TimeNum<font color="#000080">,</font>TimeDen <font color="#000080">:</font>integer<font color="#000080">) :</font>boolean<font color="#000080">;
  </font><font color="#FF0000"><b>procedure </b></font>SetActVoice<font color="#000080">(</font>Voice <font color="#000080">:</font>word<font color="#000080">);
  </font><font color="#FF0000"><b>function </b></font>PlayNote<font color="#000080">(</font>Pitch <font color="#000080">:</font>integer<font color="#000080">; </font>LengthNum<font color="#000080">,</font>LengthDen <font color="#000080">:</font>word<font color="#000080">) :</font>boolean<font color="#000080">;
  </font><font color="#FF0000"><b>function </b></font>SetTimbre<font color="#000080">(</font>TimeNum<font color="#000080">,</font>TimeDen <font color="#000080">:</font>word<font color="#000080">) :</font>boolean<font color="#000080">;
  </font><font color="#FF0000"><b>procedure </b></font>SetTickBeat<font color="#000080">(</font>TickBeat <font color="#000080">:</font>integer<font color="#000080">);
  </font><font color="#FF0000"><b>procedure </b></font>DirectNoteOn<font color="#000080">(</font>Voice <font color="#000080">:</font>word<font color="#000080">; </font>Pitch <font color="#000080">:</font>integer<font color="#000080">);
  </font><font color="#FF0000"><b>procedure </b></font>DirectNoteOff<font color="#000080">(</font>Voice <font color="#000080">:</font>word<font color="#000080">);
  </font><font color="#FF0000"><b>procedure </b></font>DirectTimbre<font color="#000080">;
  </font><font color="#FF0000"><b>procedure </b></font>LoadInstrument<font color="#000080">(</font>FileSpec <font color="#000080">:</font><font color="#FF0000"><b>string</b></font><font color="#000080">);
  </font><font color="#FF0000"><b>function </b></font>LoadSong<font color="#000080">(</font>FileSpec <font color="#000080">:</font><font color="#FF0000"><b>string</b></font><font color="#000080">) :</font>boolean<font color="#000080">;


</font><font color="#FF0000"><b>implementation

  </b></font><font color="#008000"><i>{Returns True if file exists; otherwise, it returns False. Closes the file if it exists.}
  </i></font><font color="#FF0000"><b>function </b></font>Exist<font color="#000080">(</font>fs <font color="#000080">:</font><font color="#FF0000"><b>string</b></font><font color="#000080">) :</font>boolean<font color="#000080">;
    </font><font color="#FF0000"><b>var
      </b></font>f<font color="#000080">: </font><font color="#FF0000"><b>file</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>begin
      </b></font><font color="#008000"><i>{$I-}
      </i></font>Assign<font color="#000080">(</font>f<font color="#000080">,</font>fs<font color="#000080">);
      </font>Reset<font color="#000080">(</font>f<font color="#000080">);
      </font>Close<font color="#000080">(</font>f<font color="#000080">);
      </font><font color="#008000"><i>{$I+}
      </i></font>Exist<font color="#000080">:=(</font>IOResult<font color="#000080">=</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>fs<font color="#000080">&lt;&gt;</font><font color="#800000">''</font><font color="#000080">);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;


  </font><font color="#FF0000"><b>procedure </b></font>InitDriver<font color="#000080">;
    </font><font color="#008000"><i>{Initialize Sound Driver}
    </i></font><font color="#FF0000"><b>Var
      </b></font>r <font color="#000080">:</font>registers<font color="#000080">; </font>TmpP<font color="#000080">:</font>Pointer<font color="#000080">;
    </font><font color="#FF0000"><b>Begin
      </b></font>GetIntVec<font color="#000080">(</font><font color="#800000">101</font><font color="#000080">,</font>TmpP<font color="#000080">);
      </font><font color="#FF0000"><b>If </b></font>TmpP <font color="#000080">= </font><font color="#FF0000"><b>Nil Then
      Begin
         </b></font>WriteLn<font color="#000080">(</font><font color="#800000">'Sound Driver Not Installed!'</font><font color="#000080">);
         </font>Halt<font color="#000080">(</font><font color="#800000">0</font><font color="#000080">);
      </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

      </font>R<font color="#000080">.</font>SI<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
      </font>Intr<font color="#000080">(</font><font color="#800000">101</font><font color="#000080">,</font>r<font color="#000080">);
    </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>procedure </b></font>RelTimeStart<font color="#000080">(</font>TimeNum<font color="#000080">,</font>TimeDen <font color="#000080">:</font>integer<font color="#000080">);
    </font><font color="#008000"><i>{Set Relative Time to Start}
    </i></font><font color="#FF0000"><b>var
      </b></font>TD<font color="#000080">,</font>TN <font color="#000080">:</font>integer<font color="#000080">;
      </font>r <font color="#000080">:</font>registers<font color="#000080">;
    </font><font color="#FF0000"><b>begin
      </b></font>TD<font color="#000080">:=</font>TimeDen<font color="#000080">;
      </font>TN<font color="#000080">:=</font>TimeNum<font color="#000080">;

      </font>r<font color="#000080">.</font>SI<font color="#000080">:=</font><font color="#800000">2</font><font color="#000080">;
      </font>r<font color="#000080">.</font>ES<font color="#000080">:=</font>Seg<font color="#000080">(</font>TN<font color="#000080">);
      </font>r<font color="#000080">.</font>BX<font color="#000080">:=</font>Ofs<font color="#000080">(</font>TN<font color="#000080">);

      </font>Intr<font color="#000080">(</font><font color="#800000">101</font><font color="#000080">,</font>r<font color="#000080">);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>procedure </b></font>SetState<font color="#000080">(</font>State <font color="#000080">:</font>integer<font color="#000080">);
    </font><font color="#008000"><i>{Start or Stop a Song}
    </i></font><font color="#FF0000"><b>var
      </b></font>r <font color="#000080">:</font>registers<font color="#000080">;
    </font><font color="#FF0000"><b>begin
      </b></font>r<font color="#000080">.</font>SI<font color="#000080">:=</font><font color="#800000">3</font><font color="#000080">;
      </font>r<font color="#000080">.</font>ES<font color="#000080">:=</font>Seg<font color="#000080">(</font>State<font color="#000080">);
      </font>r<font color="#000080">.</font>BX<font color="#000080">:=</font>Ofs<font color="#000080">(</font>State<font color="#000080">);

      </font>Intr<font color="#000080">(</font><font color="#800000">101</font><font color="#000080">,</font>r<font color="#000080">);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>function </b></font>GetState <font color="#000080">:</font>boolean<font color="#000080">;
    </font><font color="#FF0000"><b>var
      </b></font>r <font color="#000080">:</font>registers<font color="#000080">;
    </font><font color="#FF0000"><b>begin
      </b></font>r<font color="#000080">.</font>SI<font color="#000080">:=</font><font color="#800000">4</font><font color="#000080">;
      </font>r<font color="#000080">.</font>ES<font color="#000080">:=</font>Seg<font color="#000080">(</font>GetState<font color="#000080">);
      </font>r<font color="#000080">.</font>BX<font color="#000080">:=</font>Ofs<font color="#000080">(</font>GetState<font color="#000080">);

      </font>Intr<font color="#000080">(</font><font color="#800000">101</font><font color="#000080">,</font>r<font color="#000080">);

      </font>GetState<font color="#000080">:=(</font>r<font color="#000080">.</font>BP<font color="#000080">=</font><font color="#800000">1</font><font color="#000080">);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>procedure </b></font>SetMode<font color="#000080">(</font>PercussionMode <font color="#000080">:</font>integer<font color="#000080">);
    </font><font color="#008000"><i>{Percussion or Melodic Mode}
    </i></font><font color="#FF0000"><b>var
      </b></font>r <font color="#000080">:</font>registers<font color="#000080">;
    </font><font color="#FF0000"><b>begin
      </b></font>r<font color="#000080">.</font>SI<font color="#000080">:=</font><font color="#800000">6</font><font color="#000080">;
      </font>r<font color="#000080">.</font>ES<font color="#000080">:=</font>Seg<font color="#000080">(</font>PercussionMode<font color="#000080">);
      </font>r<font color="#000080">.</font>BX<font color="#000080">:=</font>Ofs<font color="#000080">(</font>PercussionMode<font color="#000080">);

      </font>Intr<font color="#000080">(</font><font color="#800000">101</font><font color="#000080">,</font>r<font color="#000080">);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>function </b></font>SetVolume<font color="#000080">(</font>VolNum<font color="#000080">,</font>VolDen<font color="#000080">,</font>TimeNum<font color="#000080">,</font>TimeDen <font color="#000080">:</font>integer<font color="#000080">) :</font>boolean<font color="#000080">;
    </font><font color="#FF0000"><b>var
      </b></font>TD<font color="#000080">,</font>TN<font color="#000080">,</font>VD<font color="#000080">,</font>VN <font color="#000080">:</font>word<font color="#000080">; </font><font color="#008000"><i>{To put variables values in proper order in memory}
      </i></font>r           <font color="#000080">:</font>registers<font color="#000080">;
    </font><font color="#FF0000"><b>begin
      </b></font>TD<font color="#000080">:=</font>TimeDen<font color="#000080">;
      </font>TN<font color="#000080">:=</font>TimeNum<font color="#000080">;
      </font>VD<font color="#000080">:=</font>VolDen<font color="#000080">;
      </font>VN<font color="#000080">:=</font>VolNum<font color="#000080">;

      </font>r<font color="#000080">.</font>SI<font color="#000080">:=</font><font color="#800000">8</font><font color="#000080">;
      </font>r<font color="#000080">.</font>ES<font color="#000080">:=</font>Seg<font color="#000080">(</font>VN<font color="#000080">);
      </font>r<font color="#000080">.</font>BX<font color="#000080">:=</font>Ofs<font color="#000080">(</font>VN<font color="#000080">);

      </font>Intr<font color="#000080">(</font><font color="#800000">101</font><font color="#000080">,</font>r<font color="#000080">);

      </font>SetVolume<font color="#000080">:=(</font>r<font color="#000080">.</font>BP<font color="#000080">=</font><font color="#800000">1</font><font color="#000080">);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>function </b></font>SetTempo<font color="#000080">(</font>Tempo<font color="#000080">,</font>TimeNum<font color="#000080">,</font>TimeDen <font color="#000080">:</font>integer<font color="#000080">) :</font>boolean<font color="#000080">;
    </font><font color="#FF0000"><b>var
      </b></font>TD<font color="#000080">,</font>TN<font color="#000080">,</font>TP <font color="#000080">:</font>integer<font color="#000080">; </font><font color="#008000"><i>{To put variables values in proper order in memory}
      </i></font>r        <font color="#000080">:</font>registers<font color="#000080">;
    </font><font color="#FF0000"><b>begin
      </b></font>TD<font color="#000080">:=</font>TimeDen<font color="#000080">;
      </font>TN<font color="#000080">:=</font>TimeNum<font color="#000080">;
      </font>TP<font color="#000080">:=</font>Tempo<font color="#000080">;

      </font>r<font color="#000080">.</font>SI<font color="#000080">:=</font><font color="#800000">9</font><font color="#000080">;
      </font>r<font color="#000080">.</font>ES<font color="#000080">:=</font>Seg<font color="#000080">(</font>TP<font color="#000080">);
      </font>r<font color="#000080">.</font>BX<font color="#000080">:=</font>Ofs<font color="#000080">(</font>TP<font color="#000080">);

      </font>Intr<font color="#000080">(</font><font color="#800000">101</font><font color="#000080">,</font>r<font color="#000080">);

      </font>SetTempo<font color="#000080">:=(</font>r<font color="#000080">.</font>BP<font color="#000080">=</font><font color="#800000">1</font><font color="#000080">);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>procedure </b></font>SetActVoice<font color="#000080">(</font>Voice <font color="#000080">:</font>word<font color="#000080">);
    </font><font color="#FF0000"><b>var
      </b></font>r <font color="#000080">:</font>registers<font color="#000080">;
    </font><font color="#FF0000"><b>begin
      </b></font>GActVoice<font color="#000080">:=</font>Voice<font color="#000080">;

      </font>r<font color="#000080">.</font>SI<font color="#000080">:=</font><font color="#800000">12</font><font color="#000080">;
      </font>r<font color="#000080">.</font>ES<font color="#000080">:=</font>Seg<font color="#000080">(</font>Voice<font color="#000080">);
      </font>r<font color="#000080">.</font>BX<font color="#000080">:=</font>Ofs<font color="#000080">(</font>Voice<font color="#000080">);

      </font>Intr<font color="#000080">(</font><font color="#800000">101</font><font color="#000080">,</font>r<font color="#000080">);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>function </b></font>PlayNoteDel<font color="#000080">(</font>Pitch <font color="#000080">:</font>integer<font color="#000080">; </font>LengthNum<font color="#000080">,</font>LengthDen<font color="#000080">,</font>DelayNum<font color="#000080">,</font>DelayDen <font color="#000080">:</font>word<font color="#000080">) :</font>boolean<font color="#000080">;
    </font><font color="#FF0000"><b>var
      </b></font>DD<font color="#000080">,</font>DN<font color="#000080">,</font>LD<font color="#000080">,</font>LN <font color="#000080">:</font>word<font color="#000080">;
      </font>P           <font color="#000080">:</font>integer<font color="#000080">;
      </font>r           <font color="#000080">:</font>registers<font color="#000080">;
    </font><font color="#FF0000"><b>begin
      </b></font>P<font color="#000080">:=</font>Pitch<font color="#000080">;
      </font>LD<font color="#000080">:=</font>LengthDen<font color="#000080">;
      </font>LN<font color="#000080">:=</font>LengthNum<font color="#000080">;
      </font>DN<font color="#000080">:=</font>DelayNum<font color="#000080">;
      </font>DD<font color="#000080">:=</font>DelayDen<font color="#000080">;

      </font>r<font color="#000080">.</font>SI<font color="#000080">:=</font><font color="#800000">14</font><font color="#000080">;
      </font>r<font color="#000080">.</font>ES<font color="#000080">:=</font>Seg<font color="#000080">(</font>P<font color="#000080">);
      </font>r<font color="#000080">.</font>BX<font color="#000080">:=</font>Ofs<font color="#000080">(</font>P<font color="#000080">);

      </font>Intr<font color="#000080">(</font><font color="#800000">101</font><font color="#000080">,</font>r<font color="#000080">);

      </font>PlayNoteDel<font color="#000080">:=(</font>r<font color="#000080">.</font>BP<font color="#000080">=</font><font color="#800000">1</font><font color="#000080">);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>function </b></font>PlayNote<font color="#000080">(</font>Pitch <font color="#000080">:</font>integer<font color="#000080">; </font>LengthNum<font color="#000080">,</font>LengthDen <font color="#000080">:</font>word<font color="#000080">) :</font>boolean<font color="#000080">;
    </font><font color="#FF0000"><b>var
      </b></font>LD<font color="#000080">,</font>LN <font color="#000080">:</font>word<font color="#000080">;
      </font>P     <font color="#000080">:</font>integer<font color="#000080">;
      </font>r     <font color="#000080">:</font>registers<font color="#000080">;
    </font><font color="#FF0000"><b>begin
      </b></font>P<font color="#000080">:=</font>Pitch<font color="#000080">;
      </font>LD<font color="#000080">:=</font>LengthDen<font color="#000080">;
      </font>LN<font color="#000080">:=</font>LengthNum<font color="#000080">;

      </font>r<font color="#000080">.</font>SI<font color="#000080">:=</font><font color="#800000">15</font><font color="#000080">;
      </font>r<font color="#000080">.</font>ES<font color="#000080">:=</font>Seg<font color="#000080">(</font>P<font color="#000080">);
      </font>r<font color="#000080">.</font>BX<font color="#000080">:=</font>Ofs<font color="#000080">(</font>P<font color="#000080">);

      </font>Intr<font color="#000080">(</font><font color="#800000">101</font><font color="#000080">,</font>r<font color="#000080">);

      </font>PlayNote<font color="#000080">:=(</font>r<font color="#000080">.</font>BP<font color="#000080">=</font><font color="#800000">1</font><font color="#000080">);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>function </b></font>SetTimbre<font color="#000080">(</font>TimeNum<font color="#000080">,</font>TimeDen <font color="#000080">:</font>word<font color="#000080">) :</font>boolean<font color="#000080">;
    </font><font color="#FF0000"><b>var
      </b></font>TD<font color="#000080">,</font>TN <font color="#000080">:</font>word<font color="#000080">;
      </font>T     <font color="#000080">:^</font>integer<font color="#000080">;
      </font>c1<font color="#000080">,</font>c2 <font color="#000080">:</font>byte<font color="#000080">;
      </font>r     <font color="#000080">:</font>registers<font color="#000080">;
    </font><font color="#FF0000"><b>begin
      </b></font>T<font color="#000080">:=</font>Addr<font color="#000080">(</font>GT<font color="#000080">[</font>GActVoice<font color="#000080">]);
      </font>TN<font color="#000080">:=</font>TimeNum<font color="#000080">;
      </font>TD<font color="#000080">:=</font>TimeDen<font color="#000080">;

      </font>r<font color="#000080">.</font>SI<font color="#000080">:=</font><font color="#800000">16</font><font color="#000080">;
      </font>r<font color="#000080">.</font>ES<font color="#000080">:=</font>Seg<font color="#000080">(</font>T<font color="#000080">);
      </font>r<font color="#000080">.</font>BX<font color="#000080">:=</font>Ofs<font color="#000080">(</font>T<font color="#000080">);

      </font>Intr<font color="#000080">(</font><font color="#800000">101</font><font color="#000080">,</font>r<font color="#000080">);

      </font>SetTimbre<font color="#000080">:=(</font>r<font color="#000080">.</font>BP<font color="#000080">=</font><font color="#800000">1</font><font color="#000080">);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>function </b></font>SetPitch<font color="#000080">(</font>DeltaOctave<font color="#000080">,</font>DeltaNum<font color="#000080">,</font>DeltaDen <font color="#000080">:</font>integer<font color="#000080">; </font>TimeNum<font color="#000080">,</font>TimeDen <font color="#000080">:</font>word<font color="#000080">) :</font>boolean<font color="#000080">;
    </font><font color="#FF0000"><b>var
      </b></font>TD<font color="#000080">,</font>TN   <font color="#000080">:</font>word<font color="#000080">;
      </font>DD<font color="#000080">,</font>DN<font color="#000080">,</font>D <font color="#000080">:</font>integer<font color="#000080">;
      </font>c1<font color="#000080">,</font>c2   <font color="#000080">:</font>byte<font color="#000080">;
      </font>r       <font color="#000080">:</font>registers<font color="#000080">;
    </font><font color="#FF0000"><b>begin
      </b></font>D<font color="#000080">:=</font>DeltaOctave<font color="#000080">;
      </font>DN<font color="#000080">:=</font>DeltaNum<font color="#000080">;
      </font>DD<font color="#000080">:=</font>DeltaDen<font color="#000080">;
      </font>TN<font color="#000080">:=</font>TimeNum<font color="#000080">;
      </font>TD<font color="#000080">:=</font>TimeDen<font color="#000080">;

      </font>r<font color="#000080">.</font>SI<font color="#000080">:=</font><font color="#800000">16</font><font color="#000080">;
      </font>r<font color="#000080">.</font>ES<font color="#000080">:=</font>Seg<font color="#000080">(</font>D<font color="#000080">);
      </font>r<font color="#000080">.</font>BX<font color="#000080">:=</font>Ofs<font color="#000080">(</font>D<font color="#000080">);

      </font>Intr<font color="#000080">(</font><font color="#800000">101</font><font color="#000080">,</font>r<font color="#000080">);

      </font>SetPitch<font color="#000080">:=(</font>r<font color="#000080">.</font>BP<font color="#000080">=</font><font color="#800000">1</font><font color="#000080">);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>procedure </b></font>SetTickBeat<font color="#000080">(</font>TickBeat <font color="#000080">:</font>integer<font color="#000080">);
    </font><font color="#FF0000"><b>var
      </b></font>r <font color="#000080">:</font>registers<font color="#000080">;
    </font><font color="#FF0000"><b>begin
      </b></font>r<font color="#000080">.</font>SI<font color="#000080">:=</font><font color="#800000">18</font><font color="#000080">;
      </font>r<font color="#000080">.</font>ES<font color="#000080">:=</font>Seg<font color="#000080">(</font>TickBeat<font color="#000080">);
      </font>r<font color="#000080">.</font>BX<font color="#000080">:=</font>Ofs<font color="#000080">(</font>TickBeat<font color="#000080">);

      </font>Intr<font color="#000080">(</font><font color="#800000">101</font><font color="#000080">,</font>r<font color="#000080">);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>procedure </b></font>DirectNoteOn<font color="#000080">(</font>Voice <font color="#000080">:</font>word<font color="#000080">; </font>Pitch <font color="#000080">:</font>integer<font color="#000080">);
    </font><font color="#FF0000"><b>var
      </b></font>P <font color="#000080">:</font>integer<font color="#000080">;
      </font>V <font color="#000080">:</font>word<font color="#000080">;
      </font>r <font color="#000080">:</font>registers<font color="#000080">;
    </font><font color="#FF0000"><b>begin
      </b></font>P<font color="#000080">:=</font>Pitch<font color="#000080">;
      </font>V<font color="#000080">:=</font>Voice<font color="#000080">;

      </font>r<font color="#000080">.</font>SI<font color="#000080">:=</font><font color="#800000">19</font><font color="#000080">;
      </font>r<font color="#000080">.</font>ES<font color="#000080">:=</font>Seg<font color="#000080">(</font>V<font color="#000080">);
      </font>r<font color="#000080">.</font>BX<font color="#000080">:=</font>Ofs<font color="#000080">(</font>V<font color="#000080">);

      </font>Intr<font color="#000080">(</font><font color="#800000">101</font><font color="#000080">,</font>r<font color="#000080">);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>procedure </b></font>DirectNoteOff<font color="#000080">(</font>Voice <font color="#000080">:</font>word<font color="#000080">);
    </font><font color="#FF0000"><b>var
      </b></font>r <font color="#000080">:</font>registers<font color="#000080">;
    </font><font color="#FF0000"><b>begin
      </b></font>r<font color="#000080">.</font>SI<font color="#000080">:=</font><font color="#800000">20</font><font color="#000080">;
      </font>r<font color="#000080">.</font>ES<font color="#000080">:=</font>Seg<font color="#000080">(</font>Voice<font color="#000080">);
      </font>r<font color="#000080">.</font>BX<font color="#000080">:=</font>Ofs<font color="#000080">(</font>Voice<font color="#000080">);

      </font>Intr<font color="#000080">(</font><font color="#800000">101</font><font color="#000080">,</font>r<font color="#000080">);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>procedure </b></font>DirectTimbre<font color="#000080">;
    </font><font color="#FF0000"><b>var
      </b></font>T     <font color="#000080">:^</font>integer<font color="#000080">;
      </font>V     <font color="#000080">:</font>word<font color="#000080">;
      </font>r     <font color="#000080">:</font>registers<font color="#000080">;
    </font><font color="#FF0000"><b>begin
      </b></font>V<font color="#000080">:=</font>GActVoice<font color="#000080">;
      </font>T<font color="#000080">:=</font>Addr<font color="#000080">(</font>GT<font color="#000080">[</font>V<font color="#000080">]);

      </font>r<font color="#000080">.</font>SI<font color="#000080">:=</font><font color="#800000">21</font><font color="#000080">;
      </font>r<font color="#000080">.</font>ES<font color="#000080">:=</font>Seg<font color="#000080">(</font>V<font color="#000080">);
      </font>r<font color="#000080">.</font>BX<font color="#000080">:=</font>Ofs<font color="#000080">(</font>V<font color="#000080">);

      </font>Intr<font color="#000080">(</font><font color="#800000">101</font><font color="#000080">,</font>r<font color="#000080">);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>procedure </b></font>LoadInstrument<font color="#000080">(</font>FileSpec <font color="#000080">:</font><font color="#FF0000"><b>string</b></font><font color="#000080">);
    </font><font color="#008000"><i>{Load an Instument from Disk and Place in Array}
    </i></font><font color="#FF0000"><b>var
      </b></font>c1 <font color="#000080">:</font>byte<font color="#000080">;
      </font>n  <font color="#000080">:</font>integer<font color="#000080">;
      </font>f  <font color="#000080">:</font><font color="#FF0000"><b>file of </b></font>integer<font color="#000080">;
    </font><font color="#FF0000"><b>begin
      if not</b></font><font color="#000080">(</font>Exist<font color="#000080">(</font>FileSpec<font color="#000080">)) </font><font color="#FF0000"><b>then </b></font>FileSpec<font color="#000080">:=</font><font color="#800000">'C:\MUSIC\PIANO1.INS'</font><font color="#000080">;
      </font>Assign<font color="#000080">(</font>f<font color="#000080">,</font>FileSpec<font color="#000080">);
      </font>Reset<font color="#000080">(</font>f<font color="#000080">);
      </font>Read<font color="#000080">(</font>f<font color="#000080">,</font>n<font color="#000080">);
      </font><font color="#FF0000"><b>for </b></font>c1<font color="#000080">:=</font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font><font color="#800000">26 </font><font color="#FF0000"><b>do
        </b></font>Read<font color="#000080">(</font>f<font color="#000080">,</font>GT<font color="#000080">[</font>GActVoice<font color="#000080">,</font>c1<font color="#000080">]);
      </font>Close<font color="#000080">(</font>f<font color="#000080">);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>function </b></font>LoadSong<font color="#000080">;
    </font><font color="#008000"><i>{Read a .ROL file and place song in Buffer}
    </i></font><font color="#FF0000"><b>var
      </b></font>nb <font color="#000080">:</font>byte<font color="#000080">;
      </font>ns <font color="#000080">:</font><font color="#FF0000"><b>string</b></font><font color="#000080">[</font><font color="#800000">255</font><font color="#000080">];
      </font>ni<font color="#000080">,</font>ni2<font color="#000080">,</font>ni3<font color="#000080">,</font>ni4<font color="#000080">,</font>BPM <font color="#000080">:</font>integer<font color="#000080">;
      </font>c1<font color="#000080">,</font>c2  <font color="#000080">:</font>word<font color="#000080">;
      </font>nr<font color="#000080">,</font>nr2 <font color="#000080">:</font>real<font color="#000080">;
      </font>fl <font color="#000080">:</font>boolean<font color="#000080">;
      </font>f  <font color="#000080">:</font><font color="#FF0000"><b>file</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>procedure </b></font>StringRead<font color="#000080">(</font>len <font color="#000080">:</font>word<font color="#000080">); </font><font color="#008000"><i>{uses f,ns}
      </i></font><font color="#FF0000"><b>var
        </b></font>nc <font color="#000080">:</font>char<font color="#000080">;
        </font>c1 <font color="#000080">:</font>word<font color="#000080">;
      </font><font color="#FF0000"><b>begin
        </b></font>ns<font color="#000080">:=</font><font color="#800000">''</font><font color="#000080">;
        </font><font color="#FF0000"><b>for </b></font>c1<font color="#000080">:=</font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>len <font color="#FF0000"><b>do
          begin
            </b></font>BlockRead<font color="#000080">(</font>f<font color="#000080">,</font>nc<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">);
            </font>ns<font color="#000080">:=</font>ConCat<font color="#000080">(</font>ns<font color="#000080">,</font>nc<font color="#000080">);
          </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>procedure </b></font>TempoRead<font color="#000080">; </font><font color="#008000"><i>{uses f,nb}
      </i></font><font color="#FF0000"><b>var
        </b></font>b1<font color="#000080">,</font>b2<font color="#000080">,</font>b3<font color="#000080">,</font>b4 <font color="#000080">:</font>byte<font color="#000080">;
      </font><font color="#FF0000"><b>begin
        </b></font>BlockRead<font color="#000080">(</font>f<font color="#000080">,</font>b1<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">);
        </font>BlockRead<font color="#000080">(</font>f<font color="#000080">,</font>b2<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">);
        </font>BlockRead<font color="#000080">(</font>f<font color="#000080">,</font>b3<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">);
        </font>BlockRead<font color="#000080">(</font>f<font color="#000080">,</font>b4<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">);
        </font>nb<font color="#000080">:=(</font>b3<font color="#008000"><i>{ div 2}</i></font><font color="#000080">);
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>procedure </b></font>VolumeRead<font color="#000080">;
      </font><font color="#FF0000"><b>var
        </b></font>b1<font color="#000080">,</font>b2<font color="#000080">,</font>b3<font color="#000080">,</font>b4 <font color="#000080">:</font>byte<font color="#000080">;
      </font><font color="#FF0000"><b>begin
        </b></font>BlockRead<font color="#000080">(</font>f<font color="#000080">,</font>b1<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">);
        </font>BlockRead<font color="#000080">(</font>f<font color="#000080">,</font>b2<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">);
        </font>BlockRead<font color="#000080">(</font>f<font color="#000080">,</font>b3<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">);
        </font>BlockRead<font color="#000080">(</font>f<font color="#000080">,</font>b4<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">);
        </font>nb<font color="#000080">:=</font><font color="#800000">51</font><font color="#000080">+</font>Round<font color="#000080">(</font>b3<font color="#000080">/</font><font color="#800000">2.5</font><font color="#000080">);
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>begin
      </b></font>LoadSong<font color="#000080">:=</font>true<font color="#000080">;
      </font><font color="#FF0000"><b>if not</b></font><font color="#000080">(</font>Exist<font color="#000080">(</font>FileSpec<font color="#000080">))
        </font><font color="#FF0000"><b>then begin
               </b></font>LoadSong<font color="#000080">:=</font>false<font color="#000080">;
               </font>Exit<font color="#000080">;
             </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

      </font>InitDriver<font color="#000080">;
      </font>RelTimeStart<font color="#000080">(</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">1</font><font color="#000080">);
      </font>Assign<font color="#000080">(</font>f<font color="#000080">,</font>FileSpec<font color="#000080">);
      </font>Reset<font color="#000080">(</font>f<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">);
      </font>StringRead<font color="#000080">(</font><font color="#800000">44</font><font color="#000080">);
      </font>BlockRead<font color="#000080">(</font>f<font color="#000080">,</font>ni<font color="#000080">,</font><font color="#800000">2</font><font color="#000080">); </font>SetTickBeat<font color="#000080">(</font>ni<font color="#000080">); </font><font color="#008000"><i>{Ticks per Beat}
      </i></font>BlockRead<font color="#000080">(</font>f<font color="#000080">,</font>ni<font color="#000080">,</font><font color="#800000">2</font><font color="#000080">); </font>BPM<font color="#000080">:=</font>ni<font color="#000080">; </font><font color="#008000"><i>{Beats per Measure}
      </i></font>StringRead<font color="#000080">(</font><font color="#800000">5</font><font color="#000080">);
      </font>BlockRead<font color="#000080">(</font>f<font color="#000080">,</font>nb<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">); </font>SetMode<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">); </font><font color="#008000"><i>{Mode}
      </i></font>StringRead<font color="#000080">(</font><font color="#800000">143</font><font color="#000080">);
      </font>TempoRead<font color="#000080">; </font>fl<font color="#000080">:=</font>SetTempo<font color="#000080">(</font>nb<font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">1</font><font color="#000080">); </font><font color="#008000"><i>{Tempo}
      </i></font>BlockRead<font color="#000080">(</font>f<font color="#000080">,</font>ni<font color="#000080">,</font><font color="#800000">2</font><font color="#000080">);
      </font><font color="#FF0000"><b>for </b></font>c1<font color="#000080">:=</font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>ni <font color="#FF0000"><b>do
        begin
          </b></font>BlockRead<font color="#000080">(</font>f<font color="#000080">,</font>ni2<font color="#000080">,</font><font color="#800000">2</font><font color="#000080">);
          </font>TempoRead<font color="#000080">; </font>fl<font color="#000080">:=</font>SetTempo<font color="#000080">(</font>nb<font color="#000080">,</font>ni2<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">); </font><font color="#008000"><i>{Tempo}
        </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>for </b></font>c1<font color="#000080">:=</font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font><font color="#800000">10 </font><font color="#FF0000"><b>do </b></font><font color="#008000"><i>{11 Voices}
        </i></font><font color="#FF0000"><b>begin
          </b></font>SetActVoice<font color="#000080">(</font>c1<font color="#000080">);
          </font>StringRead<font color="#000080">(</font><font color="#800000">15</font><font color="#000080">);
          </font>BlockRead<font color="#000080">(</font>f<font color="#000080">,</font>ni2<font color="#000080">,</font><font color="#800000">2</font><font color="#000080">); </font><font color="#008000"><i>{Time in ticks of last Note}
          </i></font>c2<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
          </font><font color="#FF0000"><b>while </b></font><font color="#000080">(</font>c2<font color="#000080">&lt;</font>ni2<font color="#000080">) </font><font color="#FF0000"><b>do
            begin
              </b></font>BlockRead<font color="#000080">(</font>f<font color="#000080">,</font>ni3<font color="#000080">,</font><font color="#800000">2</font><font color="#000080">); </font><font color="#008000"><i>{Note Pitch}
              </i></font>BlockRead<font color="#000080">(</font>f<font color="#000080">,</font>ni4<font color="#000080">,</font><font color="#800000">2</font><font color="#000080">); </font><font color="#008000"><i>{Note Duration}
              </i></font>fl<font color="#000080">:=</font>PlayNote<font color="#000080">(</font>ni3<font color="#000080">-</font><font color="#800000">60</font><font color="#000080">,</font>ni4<font color="#000080">,</font>BPM<font color="#000080">); </font><font color="#008000"><i>{Note}
              </i></font>c2<font color="#000080">:=</font>c2<font color="#000080">+</font>ni4<font color="#000080">; </font><font color="#008000"><i>{Summation of Durations}
            </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;
          </font>StringRead<font color="#000080">(</font><font color="#800000">15</font><font color="#000080">);
          </font>BlockRead<font color="#000080">(</font>f<font color="#000080">,</font>ni2<font color="#000080">,</font><font color="#800000">2</font><font color="#000080">);
          </font><font color="#FF0000"><b>for </b></font>c2<font color="#000080">:=</font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>ni2 <font color="#FF0000"><b>do </b></font><font color="#008000"><i>{Instuments}
            </i></font><font color="#FF0000"><b>begin
              </b></font>BlockRead<font color="#000080">(</font>f<font color="#000080">,</font>ni3<font color="#000080">,</font><font color="#800000">2</font><font color="#000080">);
              </font>StringRead<font color="#000080">(</font><font color="#800000">9</font><font color="#000080">);
              </font>nb<font color="#000080">:=</font>Pos<font color="#000080">(</font><font color="#800000">#0</font><font color="#000080">,</font>ns<font color="#000080">);
              </font>Delete<font color="#000080">(</font>ns<font color="#000080">,</font>nb<font color="#000080">,</font>Length<font color="#000080">(</font>ns<font color="#000080">));
              </font>LoadInstrument<font color="#000080">(</font>ConCat<font color="#000080">(</font><font color="#800000">'C:\MUSIC\'</font><font color="#000080">,</font>ns<font color="#000080">,</font><font color="#800000">'.INS'</font><font color="#000080">));
              </font>fl<font color="#000080">:=</font>SetTimbre<font color="#000080">(</font>ni3<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">);
              </font>StringRead<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">);
              </font>BlockRead<font color="#000080">(</font>f<font color="#000080">,</font>ni4<font color="#000080">,</font><font color="#800000">2</font><font color="#000080">);
            </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
          </font>StringRead<font color="#000080">(</font><font color="#800000">15</font><font color="#000080">);
          </font>BlockRead<font color="#000080">(</font>f<font color="#000080">,</font>ni2<font color="#000080">,</font><font color="#800000">2</font><font color="#000080">);
          </font>nb<font color="#000080">:=</font><font color="#800000">1</font><font color="#000080">;
          </font><font color="#FF0000"><b>for </b></font>c2<font color="#000080">:=</font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>ni2 <font color="#FF0000"><b>do </b></font><font color="#008000"><i>{Volume}
            </i></font><font color="#FF0000"><b>begin
              </b></font>BlockRead<font color="#000080">(</font>f<font color="#000080">,</font>ni3<font color="#000080">,</font><font color="#800000">2</font><font color="#000080">);
              </font>fl<font color="#000080">:=</font>SetVolume<font color="#000080">(</font><font color="#800000">100</font><font color="#000080">,</font>nb<font color="#000080">,</font>ni3<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">); </font><font color="#008000"><i>{Use inverse to disable Relative}
              </i></font>VolumeRead<font color="#000080">;
              </font>fl<font color="#000080">:=</font>SetVolume<font color="#000080">(</font>nb<font color="#000080">,</font><font color="#800000">100</font><font color="#000080">,</font>ni3<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">);
            </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
          </font>StringRead<font color="#000080">(</font><font color="#800000">15</font><font color="#000080">);
          </font>BlockRead<font color="#000080">(</font>f<font color="#000080">,</font>ni2<font color="#000080">,</font><font color="#800000">2</font><font color="#000080">);
          </font><font color="#FF0000"><b>for </b></font>c2<font color="#000080">:=</font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>ni2 <font color="#FF0000"><b>do </b></font><font color="#008000"><i>{Pitch -disabled}
            </i></font><font color="#FF0000"><b>begin
              </b></font>BlockRead<font color="#000080">(</font>f<font color="#000080">,</font>ni3<font color="#000080">,</font><font color="#800000">2</font><font color="#000080">);
              </font>BlockRead<font color="#000080">(</font>f<font color="#000080">,</font>nr<font color="#000080">,</font><font color="#800000">4</font><font color="#000080">);
              </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>nr<font color="#000080">=</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>then </b></font>nr2<font color="#000080">:=</font><font color="#800000">1 </font><font color="#FF0000"><b>else </b></font>nr2<font color="#000080">:=</font>nr<font color="#000080">;
</font><font color="#008000"><i>{             fl:=SetPitch(0,Abs(Trunc(nr*100)),Trunc((nr/nr2)*100),ni3,1);}
            </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;
        </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font>Close<font color="#000080">(</font>f<font color="#000080">);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>end</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to SOUND SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0053.PAS">Original</a><b>]</b></p></body>
</html>
