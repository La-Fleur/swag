<html>
<head><title> "Digitized Sound Bytes to the PC Speaker" by DON URQUHART</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to SOUND SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0074.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
Hello.  I am developing a text-to-speech synthesizer for IBM-
compatible computers.  The system will support sound output
through the SoundBlaster-DAC, an LPT-port DAC, or the PC speaker
if no other device is available.  One of its goals is to provide
an _INEXPENSIVE_ speech option for visually-impaired computer
users.

Could someone please examine the following code and make
comments/suggestions on it?  It takes an eight-bit sample byte
and outputs it on the speaker.  The speaker I/O port address is
configurable, for the internal squeaker or an external speaker
device on a serial or parallel port.
}
</i></font><font color="#FF0000"><b>Procedure </b></font>Play_Eight_Bits <font color="#000080">(</font>SoundByte<font color="#000080">, </font>BitShift  <font color="#000080">: </font>Byte<font color="#000080">;
</font>Spkr  <font color="#000080">: </font>Word<font color="#000080">);  </font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>CONST
   </b></font>OffMask <font color="#000080">= </font><font color="#800000">253</font><font color="#000080">;
   </font>DataMask <font color="#000080">= </font><font color="#800000">128</font><font color="#000080">;
 
</font><font color="#FF0000"><b>ASM
   </b></font><font color="#FF00FF">Push     AX
   Push     BX
   Push     CX
   Push     DX
   MOV     AH, SoundByte
   MOV     BL, BitCount
   MOV     CL, BitShift
   MOV     DX, Spkr     </font><font color="#008000"><i>(* Speaker I/O port address *)
   </i></font><font color="#FF00FF">And     AH, DataMask
 
   @SpeakerPoll:  In     AL, DX     </font><font color="#008000"><i>(* Input from speaker port *)
   </i></font><font color="#FF00FF">And     AL, OffMask
   Or     AL, AH     </font><font color="#008000"><i>(* Set up byte to output *)
   </i></font><font color="#FF00FF">Out     DX, AL     </font><font color="#008000"><i>(* Send to speaker *)
   </i></font><font color="#FF00FF">SHR     AH, CL     </font><font color="#008000"><i>(* Position next bit *)
   </i></font><font color="#FF00FF">SUB     BL, CL     </font><font color="#008000"><i>(* Are we done with this byte? *)
   </i></font><font color="#FF00FF">JNz     @SpeakerPoll     </font><font color="#008000"><i>(* No, poll speaker again *)
   </i></font><font color="#FF00FF">Pop     DX
   Pop     CX
   Pop     BX
   Pop     AX
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;     </font><font color="#008000"><i>(* Play_Eight_Bits *)
{--------
Here's a straight Pascal way of polling the speaker and sending a
byte:
}
</i></font><font color="#FF0000"><b>Procedure </b></font>Play_Eight_Bits <font color="#000080">(</font>SoundByte  <font color="#000080">: </font>Byte<font color="#000080">;  </font>Spkr  <font color="#000080">: </font>Word<font color="#000080">);
</font><font color="#FF0000"><b>CONST
   </b></font>OffMask <font color="#000080">= </font><font color="#800000">253</font><font color="#000080">;
   </font>DataMask <font color="#000080">= </font><font color="#800000">128</font><font color="#000080">;

</font><font color="#FF0000"><b>Begin
   </b></font>Port<font color="#000080">[</font>Spkr<font color="#000080">] := (</font>Port<font color="#000080">[</font>Spkr<font color="#000080">] </font><font color="#FF0000"><b>and </b></font>OffMask<font color="#000080">)
   </font><font color="#FF0000"><b>Or </b></font><font color="#000080">((</font>SoundByte <font color="#FF0000"><b>and </b></font>DataMask<font color="#000080">) </font><font color="#FF0000"><b>shr </b></font><font color="#800000">6</font><font color="#000080">);
   </font><font color="#008000"><i>(* I am not sure why 6 is the magic number to shift by. *)
</i></font><font color="#FF0000"><b>End</b></font><font color="#000080">;     </font><font color="#008000"><i>(* Play_Eight_Bits *)
{
Using the assembler procedure, I have achieved _TWO_ volume
levels through the speaker: the first barely audible, the second
quite adequate (at least on my speaker).  A BitShift value of 1
results in the very low volume, and a shift value of 2 produces
the higher volume; anything higher produces either silence or
unintelligible squeaks.

Are there more effective [i.e] higher sound quality, methods of
playing eight-bit samples on the speaker, short of using the
driver built into Windows?  I've developed my playback routines
on my 286 under DOS 5.  Being blind, I cannot use the GUI
environment of windows with my text-based screen reader software,
so I plan to keep working on my synthesizer project under DOS,
until I can invest in a 486 machine.

I would greatly appreciate any hints/suggestions concerning the
above-listed playback procedure.  Thanks in advance.
}
</i></font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to SOUND SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0074.PAS">Original</a><b>]</b></p></body>
</html>
