<html>
<head><title> "Mini FM Organ Using Yamaha OPL-3 Chip" by ROBY JOHANES</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to SOUND SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0110.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
  Mini FM Organ Using Yamaha OPL-3 Chip
  Autodetect Sound Blaster using BLASTER Environment variable
  By : Roby Johanes
  http://www.geocities.com/SiliconValley/Park/3230
  Finished in 1996

  Latest update: December 1997 for submission to SWAG
}
</i></font><font color="#FF0000"><b>Program </b></font>Sound_Blaster_Mini_FM_Organ<font color="#000080">;
</font><font color="#FF0000"><b>uses </b></font>crt<font color="#000080">,</font>dos<font color="#000080">;
</font><font color="#FF0000"><b>type
  </b></font>CardType <font color="#000080">= (</font>SB_1<font color="#000080">, </font>SB_2<font color="#000080">, </font>SBPro<font color="#000080">, </font>SB_16<font color="#000080">, </font>SBAWE32<font color="#000080">);
  </font>Str4     <font color="#000080">= </font><font color="#FF0000"><b>string</b></font><font color="#000080">[</font><font color="#800000">4</font><font color="#000080">];
  </font>TSBdata  <font color="#000080">= </font><font color="#FF0000"><b>record
               </b></font>Portno <font color="#000080">: </font>word<font color="#000080">;
               </font>ctype  <font color="#000080">: </font>CardType<font color="#000080">;
               </font>irq    <font color="#000080">: </font>byte<font color="#000080">;
               </font>dma    <font color="#000080">: </font>byte<font color="#000080">;
             </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>TFMInst  <font color="#000080">= </font><font color="#FF0000"><b>record
               </b></font>modchr<font color="#000080">, </font>carchr<font color="#000080">, </font>modlev<font color="#000080">, </font>carlev<font color="#000080">,
               </font>modatk<font color="#000080">, </font>caratk<font color="#000080">, </font>modsus<font color="#000080">, </font>carsus<font color="#000080">,
               </font>modwav<font color="#000080">, </font>carwav<font color="#000080">, </font>feedback <font color="#000080">: </font>byte<font color="#000080">;
               </font>reserved <font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">5</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">;
             </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>const
  </b></font>CardName <font color="#000080">: </font><font color="#FF0000"><b>array </b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">5</font><font color="#000080">] </font><font color="#FF0000"><b>of string</b></font><font color="#000080">[</font><font color="#800000">8</font><font color="#000080">] = (
             </font><font color="#800000">'SB v1.0'</font><font color="#000080">, </font><font color="#800000">'SB v2.0'</font><font color="#000080">, </font><font color="#800000">'SB Pro'</font><font color="#000080">, </font><font color="#800000">'SB 16'</font><font color="#000080">, </font><font color="#800000">'SB AWE32'</font><font color="#000080">);
  </font>Notefreq <font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">12</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>word <font color="#000080">= (</font><font color="#800000">$16B</font><font color="#000080">,</font><font color="#800000">$181</font><font color="#000080">,</font><font color="#800000">$198</font><font color="#000080">,</font><font color="#800000">$1B0</font><font color="#000080">,</font><font color="#800000">$1CA</font><font color="#000080">,</font><font color="#800000">$1E5</font><font color="#000080">,
                                     </font><font color="#800000">$202</font><font color="#000080">,</font><font color="#800000">$220</font><font color="#000080">,</font><font color="#800000">$241</font><font color="#000080">,</font><font color="#800000">$263</font><font color="#000080">,</font><font color="#800000">$287</font><font color="#000080">,</font><font color="#800000">$2AE</font><font color="#000080">);
</font><font color="#FF0000"><b>const
  </b></font>waitctr   <font color="#000080">= </font><font color="#800000">$400</font><font color="#000080">;
  </font>FMaddr    <font color="#000080">= </font><font color="#800000">$388</font><font color="#000080">;
  </font>EOI       <font color="#000080">= </font><font color="#800000">$20</font><font color="#000080">;
  </font>PIC       <font color="#000080">= </font><font color="#800000">$20</font><font color="#000080">;
  </font>PICStatus <font color="#000080">= </font><font color="#800000">$21</font><font color="#000080">;
  </font>Modofs    <font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">9</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte <font color="#000080">= (</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">2</font><font color="#000080">,</font><font color="#800000">8</font><font color="#000080">,</font><font color="#800000">9</font><font color="#000080">,</font><font color="#800000">10</font><font color="#000080">,</font><font color="#800000">16</font><font color="#000080">,</font><font color="#800000">17</font><font color="#000080">,</font><font color="#800000">18</font><font color="#000080">);
  </font>Carofs    <font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">9</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte <font color="#000080">= (</font><font color="#800000">3</font><font color="#000080">,</font><font color="#800000">4</font><font color="#000080">,</font><font color="#800000">5</font><font color="#000080">,</font><font color="#800000">11</font><font color="#000080">,</font><font color="#800000">12</font><font color="#000080">,</font><font color="#800000">13</font><font color="#000080">,</font><font color="#800000">19</font><font color="#000080">,</font><font color="#800000">20</font><font color="#000080">,</font><font color="#800000">21</font><font color="#000080">);
</font><font color="#FF0000"><b>var
  </b></font>SBdata <font color="#000080">: </font>TSBdata<font color="#000080">;
  </font>c      <font color="#000080">: </font>TSBData<font color="#000080">;
  </font>v      <font color="#000080">: </font>word<font color="#000080">;
  </font>f      <font color="#000080">: </font>tfminst<font color="#000080">;
  </font>s      <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
  </font>t      <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">[</font><font color="#800000">3</font><font color="#000080">];

</font><font color="#FF0000"><b>Function  </b></font>WordToHex<font color="#000080">(</font>no <font color="#000080">: </font>word<font color="#000080">): </font>Str4<font color="#000080">;
</font><font color="#FF0000"><b>const
  </b></font>h <font color="#000080">: </font><font color="#FF0000"><b>array </b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">15</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>char <font color="#000080">= </font><font color="#800000">'0123456789ABCDEF'</font><font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>WordToHex<font color="#000080">:=</font>h<font color="#000080">[</font>hi<font color="#000080">(</font>no<font color="#000080">) </font><font color="#FF0000"><b>shr </b></font><font color="#800000">4</font><font color="#000080">]+</font>h<font color="#000080">[</font>hi<font color="#000080">(</font>no<font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#800000">15</font><font color="#000080">]+</font>h<font color="#000080">[</font>lo<font color="#000080">(</font>no<font color="#000080">) </font><font color="#FF0000"><b>shr </b></font><font color="#800000">4</font><font color="#000080">]+
             </font>h<font color="#000080">[</font>lo<font color="#000080">(</font>no<font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#800000">15</font><font color="#000080">];
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>ResetChip<font color="#000080">(</font>Portno <font color="#000080">: </font>Word<font color="#000080">) : </font>Boolean<font color="#000080">; </font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>asm
  </b></font><font color="#FF00FF">mov    bx,-1
  mov    dx,[Portno]
  add    dl,6
  mov    al,1
  out    dx,al
  mov    cx,waitctr

@@1:
  loop   @@1
  dec    al
  out    dx,al
  mov    cx,waitctr

@@2:
  loop   @@2
  add    dl,8
  mov    cx,waitctr

@@testreadybit:
  in     al,dx
  test   al,80h
  loopz  @@testreadybit
  jz     @@SBnotpresent
  sub    dl,4
  mov    cx,waitctr

@@pollfor0AAh:
  in     al,dx
  cmp    al,0AAh
  je     @@done
  loop   @@pollfor0AAh

@@SBnotpresent:
  xor    bx,bx

@@done:
  mov    ax,bx
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function  </b></font>SBRead<font color="#000080">: </font>byte<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>asm
  </b></font><font color="#FF00FF">mov     dx,[SBData.Portno]
  add     dl,0eH
  mov     cx,waitctr
@@loopit:
  in      al,dx
  test    al,80H
  loopz   @@loopit
  sub     dx,4
  in      al,dx
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>SBWrite<font color="#000080">(</font>Data <font color="#000080">: </font>byte<font color="#000080">); </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>asm
  </b></font><font color="#FF00FF">mov    dx,[SBData.Portno]
  add    dl,0cH
  mov    cx,waitctr
@@loopit:
  in     al,dx
  test   al,80H
  loopnz @@loopit
  mov    al,[Data]
  out    dx,al
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function  </b></font>GetDSPVersion <font color="#000080">: </font>Word<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>asm
  </b></font><font color="#FF00FF">push   00e1H
  call   SBwrite
  call   SBread
  mov    ah,al
  call   SBread
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>FMwrite<font color="#000080">(</font>reg<font color="#000080">, </font>data <font color="#000080">: </font>byte<font color="#000080">); </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>asm
  </b></font><font color="#FF00FF">mov    dx,FMaddr
  mov    al,[reg]
  out    dx,al
  mov    cx,6
@@1:
  in     al,dx
  loop   @@1
  inc    dl
  mov    al,[data]
  out    dx,al
  dec    dl
  mov    cx,35
@@2:
  in     al,dx
  loop   @@2
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>FMreset<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>FMwrite<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>FMKeyon<font color="#000080">(</font>channel<font color="#000080">: </font>byte<font color="#000080">; </font>freq<font color="#000080">: </font>word<font color="#000080">; </font>octave<font color="#000080">: </font>byte<font color="#000080">);
</font><font color="#FF0000"><b>begin
  </b></font>FMWrite<font color="#000080">(</font><font color="#800000">$A0</font><font color="#000080">+</font>channel<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">,</font>freq <font color="#FF0000"><b>and </b></font><font color="#800000">$FF</font><font color="#000080">);
  </font>FMWrite<font color="#000080">(</font><font color="#800000">$B0</font><font color="#000080">+</font>channel<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">,(</font>freq <font color="#FF0000"><b>shr </b></font><font color="#800000">8</font><font color="#000080">) </font><font color="#FF0000"><b>or </b></font><font color="#000080">(</font>octave <font color="#FF0000"><b>shl </b></font><font color="#800000">2</font><font color="#000080">) </font><font color="#FF0000"><b>or </b></font><font color="#800000">$20</font><font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>FMKeyoff<font color="#000080">(</font>channel<font color="#000080">: </font>byte<font color="#000080">);
</font><font color="#FF0000"><b>begin
  </b></font>FMWrite<font color="#000080">(</font><font color="#800000">$B0</font><font color="#000080">+</font>channel<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>FMSetVolume<font color="#000080">(</font>channel<font color="#000080">, </font>vol<font color="#000080">: </font>byte<font color="#000080">);
</font><font color="#FF0000"><b>begin
  </b></font>FMWrite<font color="#000080">(</font><font color="#800000">$40</font><font color="#000080">+</font>Modofs<font color="#000080">[</font>channel<font color="#000080">],</font>vol <font color="#FF0000"><b>and </b></font><font color="#800000">$3F</font><font color="#000080">);
  </font>FMWrite<font color="#000080">(</font><font color="#800000">$40</font><font color="#000080">+</font>Carofs<font color="#000080">[</font>channel<font color="#000080">],</font>vol <font color="#FF0000"><b>and </b></font><font color="#800000">$3F</font><font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>FMSetup<font color="#000080">(</font>channel<font color="#000080">: </font>byte<font color="#000080">; </font>FMInst <font color="#000080">: </font>TFMInst<font color="#000080">);
</font><font color="#FF0000"><b>var
  </b></font>i<font color="#000080">, </font>j <font color="#000080">: </font>byte<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>i<font color="#000080">:=</font>modofs<font color="#000080">[</font>channel<font color="#000080">]; </font>j<font color="#000080">:=</font>carofs<font color="#000080">[</font>channel<font color="#000080">];
  </font>FMWrite<font color="#000080">(</font><font color="#800000">$20</font><font color="#000080">+</font>i<font color="#000080">,</font>FMInst<font color="#000080">.</font>modchr<font color="#000080">); </font>FMWrite<font color="#000080">(</font><font color="#800000">$20</font><font color="#000080">+</font>j<font color="#000080">,</font>FMInst<font color="#000080">.</font>carchr<font color="#000080">);
  </font>FMWrite<font color="#000080">(</font><font color="#800000">$40</font><font color="#000080">+</font>i<font color="#000080">,</font>FMInst<font color="#000080">.</font>modlev<font color="#000080">); </font>FMWrite<font color="#000080">(</font><font color="#800000">$40</font><font color="#000080">+</font>j<font color="#000080">,</font>FMInst<font color="#000080">.</font>carlev<font color="#000080">);
  </font>FMWrite<font color="#000080">(</font><font color="#800000">$60</font><font color="#000080">+</font>i<font color="#000080">,</font>FMInst<font color="#000080">.</font>modatk<font color="#000080">); </font>FMWrite<font color="#000080">(</font><font color="#800000">$60</font><font color="#000080">+</font>j<font color="#000080">,</font>FMInst<font color="#000080">.</font>caratk<font color="#000080">);
  </font>FMWrite<font color="#000080">(</font><font color="#800000">$80</font><font color="#000080">+</font>i<font color="#000080">,</font>FMInst<font color="#000080">.</font>modsus<font color="#000080">); </font>FMWrite<font color="#000080">(</font><font color="#800000">$80</font><font color="#000080">+</font>j<font color="#000080">,</font>FMInst<font color="#000080">.</font>carsus<font color="#000080">);
  </font>FMWrite<font color="#000080">(</font><font color="#800000">$E0</font><font color="#000080">+</font>i<font color="#000080">,</font>FMInst<font color="#000080">.</font>modwav<font color="#000080">); </font>FMWrite<font color="#000080">(</font><font color="#800000">$E0</font><font color="#000080">+</font>j<font color="#000080">,</font>FMInst<font color="#000080">.</font>carwav<font color="#000080">);
  </font>FMWrite<font color="#000080">(</font><font color="#800000">$C0</font><font color="#000080">+</font>channel<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">,</font>FMInst<font color="#000080">.</font>feedback<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>SBSetcard<font color="#000080">(</font>CardData <font color="#000080">: </font>TSBdata<font color="#000080">);
</font><font color="#FF0000"><b>begin
  with </b></font>SBData <font color="#FF0000"><b>do
  begin
    </b></font>portno<font color="#000080">:=</font>CardData<font color="#000080">.</font>portno<font color="#000080">;
    </font>ctype <font color="#000080">:=</font>CardData<font color="#000080">.</font>ctype<font color="#000080">;
    </font>irq   <font color="#000080">:=</font>CardData<font color="#000080">.</font>irq<font color="#000080">;
    </font>dma   <font color="#000080">:=</font>CardData<font color="#000080">.</font>dma<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>AutoDetectIRQ <font color="#000080">: </font>Byte<font color="#000080">;
</font><font color="#FF0000"><b>var
  </b></font>i       <font color="#000080">: </font>Integer<font color="#000080">;
  </font>s       <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
  </font>j       <font color="#000080">: </font>byte<font color="#000080">;
</font><font color="#FF0000"><b>begin
  for </b></font>I<font color="#000080">:=</font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>EnvCount <font color="#FF0000"><b>do
  begin
    </b></font>s<font color="#000080">:=</font>EnvStr<font color="#000080">(</font>i<font color="#000080">);
    </font><font color="#FF0000"><b>if </b></font>copy<font color="#000080">(</font>s<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">7</font><font color="#000080">)=</font><font color="#800000">'BLASTER' </font><font color="#FF0000"><b>then </b></font>break<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font>copy<font color="#000080">(</font>s<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">7</font><font color="#000080">)&lt;&gt;</font><font color="#800000">'BLASTER' </font><font color="#FF0000"><b>then
  begin
    </b></font>AutoDetectIRQ<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
    </font>exit<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>j<font color="#000080">:=</font>pos<font color="#000080">(</font><font color="#800000">'I'</font><font color="#000080">,</font>s<font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font>j<font color="#000080">=</font><font color="#800000">0 </font><font color="#FF0000"><b>then
  begin
    </b></font>j<font color="#000080">:=</font>pos<font color="#000080">(</font><font color="#800000">'i'</font><font color="#000080">,</font>s<font color="#000080">);
    </font><font color="#FF0000"><b>if </b></font>j<font color="#000080">=</font><font color="#800000">0 </font><font color="#FF0000"><b>then
    begin
      </b></font>AutoDetectIRQ<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
      </font>exit<font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>s<font color="#000080">:=</font>copy<font color="#000080">(</font>s<font color="#000080">,</font>j<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">1</font><font color="#000080">);
  </font>j<font color="#000080">:=</font>ord<font color="#000080">(</font>s<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">])-</font><font color="#800000">48</font><font color="#000080">;
  </font>AutoDetectIRQ<font color="#000080">:=</font>j<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>AutoDetectDMA <font color="#000080">: </font>Byte<font color="#000080">;
</font><font color="#FF0000"><b>var
  </b></font>i       <font color="#000080">: </font>Integer<font color="#000080">;
  </font>s       <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
  </font>j       <font color="#000080">: </font>byte<font color="#000080">;
</font><font color="#FF0000"><b>begin
  for </b></font>I<font color="#000080">:=</font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>EnvCount <font color="#FF0000"><b>do
  begin
    </b></font>s<font color="#000080">:=</font>EnvStr<font color="#000080">(</font>i<font color="#000080">);
    </font><font color="#FF0000"><b>if </b></font>copy<font color="#000080">(</font>s<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">7</font><font color="#000080">)=</font><font color="#800000">'BLASTER' </font><font color="#FF0000"><b>then </b></font>break<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font>copy<font color="#000080">(</font>s<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">7</font><font color="#000080">)&lt;&gt;</font><font color="#800000">'BLASTER' </font><font color="#FF0000"><b>then
  begin
    </b></font>AutoDetectDMA<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
    </font>exit<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>j<font color="#000080">:=</font>pos<font color="#000080">(</font><font color="#800000">'D'</font><font color="#000080">,</font>s<font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font>j<font color="#000080">=</font><font color="#800000">0 </font><font color="#FF0000"><b>then
  begin
    </b></font>j<font color="#000080">:=</font>pos<font color="#000080">(</font><font color="#800000">'d'</font><font color="#000080">,</font>s<font color="#000080">);
    </font><font color="#FF0000"><b>if </b></font>j<font color="#000080">=</font><font color="#800000">0 </font><font color="#FF0000"><b>then
    begin
      </b></font>AutoDetectDMA<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
      </font>exit<font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>s<font color="#000080">:=</font>copy<font color="#000080">(</font>s<font color="#000080">,</font>j<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">1</font><font color="#000080">);
  </font>j<font color="#000080">:=</font>ord<font color="#000080">(</font>s<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">])-</font><font color="#800000">48</font><font color="#000080">;
  </font>AutoDetectDMA<font color="#000080">:=</font>j<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>DetectSB <font color="#000080">(</font><font color="#FF0000"><b>var </b></font>CardData <font color="#000080">: </font>TSBdata<font color="#000080">); </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>asm
  </b></font><font color="#008000"><i>{ Port AutoDetect }
  </i></font><font color="#FF00FF">mov    ax,ds
  mov    es,ax
  mov    di,[offset SBData]
  mov    si,di
  mov    ax,220h
@@detectionloop:
  mov    bx,ax
  push   bx
  push   ax
  call   ResetChip
  pop    bx
  cmp    ax,-1
  je     @@success
  mov    ax,bx
  add    ax,20h
  cmp    ax,300h
  jb     @@detectionloop
  xor    bx,bx
@@success:
  mov    ax,bx
  cld
  stosw

  </font><font color="#008000"><i>{ Card Type AutoDetect }
  </i></font><font color="#FF00FF">call   GetDSPVersion
  cmp    ah,4
  jne    @@nexts
  cmp    al,10
  jl     @@nexts
  inc    ah
@@nexts:
  mov    al,ah
  cld
  stosb

  </font><font color="#008000"><i>{ IRQ autodetect }
  </i></font><font color="#FF00FF">push   es
  push   di
  push   si
  call   AutoDetectIRQ
  pop    si
  pop    di
  pop    es
  cld
  stosb

  </font><font color="#008000"><i>{ DMA autodetect }
  </i></font><font color="#FF00FF">push   es
  push   di
  push   si
  call   AutoDetectDMA
  pop    si
  pop    di
  pop    es
  cld
  stosb
  les    di,[CardData]
  mov    cx,5
  cld
  rep    movsb
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>createbkgr<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>asm
  </b></font><font color="#FF00FF">mov  ax,0b800h
  mov  es,ax
  xor  di,di
  mov  cx,2000
  mov  ax,39b1h
  cld
  rep  stosw
  mov  ah,2
  xor  bh,bh
  xor  dx,dx
  int  10h
  mov  ah,1
  mov  cx,-1
  int  10h
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>writexy<font color="#000080">(</font>x<font color="#000080">,</font>y<font color="#000080">,</font>c <font color="#000080">: </font>byte<font color="#000080">; </font>s <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">); </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>asm
  </b></font><font color="#FF00FF">mov  ax,0b800h
  mov  es,ax
  mov  al,[y]
  dec  al
  xor  ah,ah
  shl  ax,5
  mov  di,ax
  shl  ax,1
  shl  ax,1
  add  di,ax
  mov  al,[x]
  dec  al
  xor  ah,ah
  shl  ax,1
  add  di,ax
  xor  ch,ch
  push ds
  lds  si,[s]
  mov  cl,[si]
  jcxz @@done
  mov  ah,[c]
  inc  si
  cld
@@loops:
  lodsb
  stosw
  loop @@loops
@@done:
  pop  ds
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>organ<font color="#000080">;
</font><font color="#FF0000"><b>var
  </b></font>ch  <font color="#000080">: </font>char<font color="#000080">;
  </font>n<font color="#000080">,</font>o <font color="#000080">: </font>byte<font color="#000080">;
</font><font color="#FF0000"><b>begin
  repeat
    </b></font>n<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
    </font>ch<font color="#000080">:=</font>Upcase<font color="#000080">(</font>readkey<font color="#000080">);
    </font>FMKeyoff<font color="#000080">(</font><font color="#800000">2</font><font color="#000080">);
    </font><font color="#FF0000"><b>case </b></font>ch <font color="#FF0000"><b>of
  </b></font><font color="#800000">','</font><font color="#000080">,</font><font color="#800000">'A'</font><font color="#000080">: </font><font color="#FF0000"><b>begin </b></font>n<font color="#000080">:=</font><font color="#800000">1</font><font color="#000080">; </font>o<font color="#000080">:=</font><font color="#800000">2</font><font color="#000080">; </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font><font color="#800000">'W'</font><font color="#000080">: </font><font color="#FF0000"><b>begin </b></font>n<font color="#000080">:=</font><font color="#800000">2</font><font color="#000080">; </font>o<font color="#000080">:=</font><font color="#800000">2</font><font color="#000080">; </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#800000">'.'</font><font color="#000080">,</font><font color="#800000">'S'</font><font color="#000080">: </font><font color="#FF0000"><b>begin </b></font>n<font color="#000080">:=</font><font color="#800000">3</font><font color="#000080">; </font>o<font color="#000080">:=</font><font color="#800000">2</font><font color="#000080">; </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font><font color="#800000">'E'</font><font color="#000080">: </font><font color="#FF0000"><b>begin </b></font>n<font color="#000080">:=</font><font color="#800000">4</font><font color="#000080">; </font>o<font color="#000080">:=</font><font color="#800000">2</font><font color="#000080">; </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#800000">'/'</font><font color="#000080">,</font><font color="#800000">'D'</font><font color="#000080">: </font><font color="#FF0000"><b>begin </b></font>n<font color="#000080">:=</font><font color="#800000">5</font><font color="#000080">; </font>o<font color="#000080">:=</font><font color="#800000">2</font><font color="#000080">; </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font><font color="#800000">'F'</font><font color="#000080">: </font><font color="#FF0000"><b>begin </b></font>n<font color="#000080">:=</font><font color="#800000">6</font><font color="#000080">; </font>o<font color="#000080">:=</font><font color="#800000">2</font><font color="#000080">; </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font><font color="#800000">'T'</font><font color="#000080">: </font><font color="#FF0000"><b>begin </b></font>n<font color="#000080">:=</font><font color="#800000">7</font><font color="#000080">; </font>o<font color="#000080">:=</font><font color="#800000">2</font><font color="#000080">; </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font><font color="#800000">'G'</font><font color="#000080">: </font><font color="#FF0000"><b>begin </b></font>n<font color="#000080">:=</font><font color="#800000">8</font><font color="#000080">; </font>o<font color="#000080">:=</font><font color="#800000">2</font><font color="#000080">; </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font><font color="#800000">'Y'</font><font color="#000080">: </font><font color="#FF0000"><b>begin </b></font>n<font color="#000080">:=</font><font color="#800000">9</font><font color="#000080">; </font>o<font color="#000080">:=</font><font color="#800000">2</font><font color="#000080">; </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font><font color="#800000">'H'</font><font color="#000080">: </font><font color="#FF0000"><b>begin </b></font>n<font color="#000080">:=</font><font color="#800000">10</font><font color="#000080">;</font>o<font color="#000080">:=</font><font color="#800000">2</font><font color="#000080">; </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font><font color="#800000">'U'</font><font color="#000080">: </font><font color="#FF0000"><b>begin </b></font>n<font color="#000080">:=</font><font color="#800000">11</font><font color="#000080">;</font>o<font color="#000080">:=</font><font color="#800000">2</font><font color="#000080">; </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font><font color="#800000">'J'</font><font color="#000080">: </font><font color="#FF0000"><b>begin </b></font>n<font color="#000080">:=</font><font color="#800000">12</font><font color="#000080">;</font>o<font color="#000080">:=</font><font color="#800000">2</font><font color="#000080">; </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font><font color="#800000">'K'</font><font color="#000080">: </font><font color="#FF0000"><b>begin </b></font>n<font color="#000080">:=</font><font color="#800000">1</font><font color="#000080">; </font>o<font color="#000080">:=</font><font color="#800000">3</font><font color="#000080">; </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font><font color="#800000">'O'</font><font color="#000080">: </font><font color="#FF0000"><b>begin </b></font>n<font color="#000080">:=</font><font color="#800000">2</font><font color="#000080">; </font>o<font color="#000080">:=</font><font color="#800000">3</font><font color="#000080">; </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font><font color="#800000">'L'</font><font color="#000080">: </font><font color="#FF0000"><b>begin </b></font>n<font color="#000080">:=</font><font color="#800000">3</font><font color="#000080">; </font>o<font color="#000080">:=</font><font color="#800000">3</font><font color="#000080">; </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font><font color="#800000">'P'</font><font color="#000080">: </font><font color="#FF0000"><b>begin </b></font>n<font color="#000080">:=</font><font color="#800000">4</font><font color="#000080">; </font>o<font color="#000080">:=</font><font color="#800000">3</font><font color="#000080">; </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font><font color="#800000">';'</font><font color="#000080">: </font><font color="#FF0000"><b>begin </b></font>n<font color="#000080">:=</font><font color="#800000">5</font><font color="#000080">; </font>o<font color="#000080">:=</font><font color="#800000">3</font><font color="#000080">; </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font><font color="#800000">#39</font><font color="#000080">: </font><font color="#FF0000"><b>begin </b></font>n<font color="#000080">:=</font><font color="#800000">6</font><font color="#000080">; </font>o<font color="#000080">:=</font><font color="#800000">3</font><font color="#000080">; </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font><font color="#800000">#13</font><font color="#000080">: </font><font color="#FF0000"><b>begin </b></font>n<font color="#000080">:=</font><font color="#800000">8</font><font color="#000080">; </font>o<font color="#000080">:=</font><font color="#800000">3</font><font color="#000080">; </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font><font color="#800000">'M'</font><font color="#000080">: </font><font color="#FF0000"><b>begin </b></font>n<font color="#000080">:=</font><font color="#800000">12</font><font color="#000080">;</font>o<font color="#000080">:=</font><font color="#800000">1</font><font color="#000080">; </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font><font color="#800000">'N'</font><font color="#000080">: </font><font color="#FF0000"><b>begin </b></font>n<font color="#000080">:=</font><font color="#800000">10</font><font color="#000080">;</font>o<font color="#000080">:=</font><font color="#800000">1</font><font color="#000080">; </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font><font color="#800000">'B'</font><font color="#000080">: </font><font color="#FF0000"><b>begin </b></font>n<font color="#000080">:=</font><font color="#800000">8</font><font color="#000080">; </font>o<font color="#000080">:=</font><font color="#800000">1</font><font color="#000080">; </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font><font color="#800000">'V'</font><font color="#000080">: </font><font color="#FF0000"><b>begin </b></font>n<font color="#000080">:=</font><font color="#800000">6</font><font color="#000080">; </font>o<font color="#000080">:=</font><font color="#800000">1</font><font color="#000080">; </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font><font color="#800000">'C'</font><font color="#000080">: </font><font color="#FF0000"><b>begin </b></font>n<font color="#000080">:=</font><font color="#800000">5</font><font color="#000080">; </font>o<font color="#000080">:=</font><font color="#800000">1</font><font color="#000080">; </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font><font color="#800000">'X'</font><font color="#000080">: </font><font color="#FF0000"><b>begin </b></font>n<font color="#000080">:=</font><font color="#800000">3</font><font color="#000080">; </font>o<font color="#000080">:=</font><font color="#800000">1</font><font color="#000080">; </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font><font color="#800000">'Z'</font><font color="#000080">: </font><font color="#FF0000"><b>begin </b></font>n<font color="#000080">:=</font><font color="#800000">1</font><font color="#000080">; </font>o<font color="#000080">:=</font><font color="#800000">1</font><font color="#000080">; </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>if </b></font>n<font color="#000080">&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>FMKeyon<font color="#000080">(</font><font color="#800000">2</font><font color="#000080">,</font>NoteFreq<font color="#000080">[</font>n<font color="#000080">],</font>o<font color="#000080">);
  </font><font color="#FF0000"><b>until </b></font>ch<font color="#000080">=</font><font color="#800000">#27</font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>DrawOrgan<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>textattr<font color="#000080">:=</font><font color="#800000">$0F</font><font color="#000080">;
  </font>gotoxy<font color="#000080">(</font><font color="#800000">21</font><font color="#000080">, </font><font color="#800000">9</font><font color="#000080">); </font>write<font color="#000080">(</font><font color="#800000">'&Eacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&raquo;'</font><font color="#000080">);
  </font>gotoxy<font color="#000080">(</font><font color="#800000">21</font><font color="#000080">,</font><font color="#800000">10</font><font color="#000080">); </font>write<font color="#000080">(</font><font color="#800000">'&ordm;&THORN;&Ucirc;&Yacute;  &THORN;&Yacute;  &THORN;&Ucirc;&Ucirc;&THORN;&Ucirc;&Yacute;  &THORN;&Yacute;  &THORN;&Yacute;  &THORN;&Ucirc;&Ucirc;&THORN;&Ucirc;&Yacute;  &THORN;&Yacute;  &THORN;&Ucirc;&Ucirc; &ordm;'</font><font color="#000080">);
  </font>gotoxy<font color="#000080">(</font><font color="#800000">21</font><font color="#000080">,</font><font color="#800000">11</font><font color="#000080">); </font>write<font color="#000080">(</font><font color="#800000">'&ordm;&THORN;&Ucirc;&Yacute;  &THORN;&Yacute;  &THORN;&Ucirc;&Ucirc;&THORN;&Ucirc;&Yacute;  &THORN;&Yacute;  &THORN;&Yacute;  &THORN;&Ucirc;&Ucirc;&THORN;&Ucirc;&Yacute;  &THORN;&Yacute;  &THORN;&Ucirc;&Ucirc; &ordm;'</font><font color="#000080">);
  </font>gotoxy<font color="#000080">(</font><font color="#800000">21</font><font color="#000080">,</font><font color="#800000">12</font><font color="#000080">); </font>write<font color="#000080">(</font><font color="#800000">'&ordm;&THORN;&Ucirc;&Yacute;  &THORN;&Yacute;  &THORN;&Ucirc;&Ucirc;&THORN;&Ucirc;&Yacute;  &THORN;&Yacute;  &THORN;&Yacute;  &THORN;&Ucirc;&Ucirc;&THORN;&Ucirc;&Yacute;  &THORN;&Yacute;  &THORN;&Ucirc;&Ucirc; &ordm;'</font><font color="#000080">);
  </font>gotoxy<font color="#000080">(</font><font color="#800000">21</font><font color="#000080">,</font><font color="#800000">13</font><font color="#000080">); </font>write<font color="#000080">(</font><font color="#800000">'&ordm;&THORN;&Ucirc;&Ucirc;&Ucirc;&THORN;&Ucirc;&Ucirc;&Ucirc;&THORN;&Ucirc;&Ucirc;&Ucirc;&THORN;&Ucirc;&Ucirc;&Ucirc;&THORN;&Ucirc;&Ucirc;&Ucirc;&THORN;&Ucirc;&Ucirc;&Ucirc;&THORN;&Ucirc;&Ucirc;&Ucirc;&THORN;&Ucirc;&Ucirc;&Ucirc;&THORN;&Ucirc;&Ucirc;&Ucirc;&THORN;&Ucirc;&Ucirc;&Ucirc; &ordm;'</font><font color="#000080">);
  </font>gotoxy<font color="#000080">(</font><font color="#800000">21</font><font color="#000080">,</font><font color="#800000">14</font><font color="#000080">); </font>write<font color="#000080">(</font><font color="#800000">'&ordm;&THORN;&Ucirc;&Ucirc;&Ucirc;&THORN;&Ucirc;&Ucirc;&Ucirc;&THORN;&Ucirc;&Ucirc;&Ucirc;&THORN;&Ucirc;&Ucirc;&Ucirc;&THORN;&Ucirc;&Ucirc;&Ucirc;&THORN;&Ucirc;&Ucirc;&Ucirc;&THORN;&Ucirc;&Ucirc;&Ucirc;&THORN;&Ucirc;&Ucirc;&Ucirc;&THORN;&Ucirc;&Ucirc;&Ucirc;&THORN;&Ucirc;&Ucirc;&Ucirc; &ordm;'</font><font color="#000080">);
  </font>gotoxy<font color="#000080">(</font><font color="#800000">21</font><font color="#000080">,</font><font color="#800000">15</font><font color="#000080">); </font>write<font color="#000080">(</font><font color="#800000">'&ordm;&THORN;&Ucirc;&Ucirc;&Ucirc;&THORN;&Ucirc;&Ucirc;&Ucirc;&THORN;&Ucirc;&Ucirc;&Ucirc;&THORN;&Ucirc;&Ucirc;&Ucirc;&THORN;&Ucirc;&Ucirc;&Ucirc;&THORN;&Ucirc;&Ucirc;&Ucirc;&THORN;&Ucirc;&Ucirc;&Ucirc;&THORN;&Ucirc;&Ucirc;&Ucirc;&THORN;&Ucirc;&Ucirc;&Ucirc;&THORN;&Ucirc;&Ucirc;&Ucirc; &ordm;'</font><font color="#000080">);
  </font>gotoxy<font color="#000080">(</font><font color="#800000">21</font><font color="#000080">,</font><font color="#800000">16</font><font color="#000080">); </font>write<font color="#000080">(</font><font color="#800000">'&Egrave;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&frac14;'</font><font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>ShowCursor<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>asm
  </b></font><font color="#FF00FF">mov  ah,1
  mov  cx,0708h
  int  10h
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>begin
  with </b></font>SBdata <font color="#FF0000"><b>do
  begin
    </b></font>portno<font color="#000080">:=</font><font color="#800000">$220</font><font color="#000080">;
    </font>ctype <font color="#000080">:=</font>sb_16<font color="#000080">;
    </font>irq   <font color="#000080">:=</font><font color="#800000">7</font><font color="#000080">;
    </font>dma   <font color="#000080">:=</font><font color="#800000">1</font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>DetectSB<font color="#000080">(</font>c<font color="#000080">);
  </font><font color="#FF0000"><b>If </b></font>c<font color="#000080">.</font>portno<font color="#000080">=</font><font color="#800000">0 </font><font color="#FF0000"><b>then
  begin
    </b></font>writeln<font color="#000080">(</font><font color="#800000">'Sound Blaster not present !'</font><font color="#000080">,</font><font color="#800000">#10</font><font color="#000080">,</font><font color="#800000">#13</font><font color="#000080">); </font>halt<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>createbkgr<font color="#000080">;
  </font>textattr<font color="#000080">:=</font><font color="#800000">$1E</font><font color="#000080">;
  </font>fillchar<font color="#000080">(</font>s<font color="#000080">,</font><font color="#800000">81</font><font color="#000080">,</font><font color="#800000">' '</font><font color="#000080">); </font>s<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">]:=</font><font color="#800000">#80</font><font color="#000080">;
  </font>writexy<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">$1E</font><font color="#000080">,</font>s<font color="#000080">);
  </font>writeln<font color="#000080">(</font><font color="#800000">'Sound Blaster present in '</font><font color="#000080">+</font>WordToHex<font color="#000080">(</font>c<font color="#000080">.</font>portno<font color="#000080">)+</font><font color="#800000">'h'</font><font color="#000080">+
  </font><font color="#800000">' of type '</font><font color="#000080">+</font>cardname<font color="#000080">[</font>ord<font color="#000080">(</font>c<font color="#000080">.</font>ctype<font color="#000080">)]+</font><font color="#800000">' with IRQ '</font><font color="#000080">,</font>c<font color="#000080">.</font>irq<font color="#000080">,</font><font color="#800000">' and DMA '</font><font color="#000080">,</font>c<font color="#000080">.</font>dma<font color="#000080">);
  </font>v<font color="#000080">:=</font>GetDSPversion<font color="#000080">; </font>textattr<font color="#000080">:=</font><font color="#800000">$1F</font><font color="#000080">;
  </font>s<font color="#000080">:=</font>s<font color="#000080">+</font>t<font color="#000080">; </font>writexy<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">25</font><font color="#000080">, </font><font color="#800000">$1E</font><font color="#000080">,</font>s<font color="#000080">);
  </font>fillchar<font color="#000080">(</font>s<font color="#000080">,</font><font color="#800000">81</font><font color="#000080">,</font><font color="#800000">' '</font><font color="#000080">); </font>s<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">]:=</font><font color="#800000">#80</font><font color="#000080">;
  </font>str<font color="#000080">(</font>v <font color="#FF0000"><b>shr </b></font><font color="#800000">8</font><font color="#000080">,</font>t<font color="#000080">);
  </font>s<font color="#000080">:=</font><font color="#800000">'DSP version '</font><font color="#000080">+</font>t<font color="#000080">+</font><font color="#800000">'.'</font><font color="#000080">;
  </font>str<font color="#000080">(</font>v <font color="#FF0000"><b>and </b></font><font color="#800000">$FF</font><font color="#000080">,</font>t<font color="#000080">); </font>s<font color="#000080">:=</font>s<font color="#000080">+</font>t<font color="#000080">;
  </font>writexy<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">25</font><font color="#000080">, </font><font color="#800000">$1E</font><font color="#000080">,</font>s<font color="#000080">);
  </font>writexy<font color="#000080">(</font><font color="#800000">64</font><font color="#000080">,</font><font color="#800000">25</font><font color="#000080">,</font><font color="#800000">$1E</font><font color="#000080">,</font><font color="#800000">'By : Roby Johanes'</font><font color="#000080">);
  </font>gotoxy<font color="#000080">(</font><font color="#800000">36</font><font color="#000080">,</font><font color="#800000">7</font><font color="#000080">); </font>writeln<font color="#000080">(</font><font color="#800000">'FM Mini Organ'</font><font color="#000080">); </font>textattr<font color="#000080">:=</font><font color="#800000">$4E</font><font color="#000080">;
  </font>gotoxy<font color="#000080">(</font><font color="#800000">36</font><font color="#000080">,</font><font color="#800000">8</font><font color="#000080">); </font>writeln<font color="#000080">(</font><font color="#800000">'version 0.007'</font><font color="#000080">); </font>textattr<font color="#000080">:=</font><font color="#800000">$2F</font><font color="#000080">;
  </font>gotoxy<font color="#000080">(</font><font color="#800000">19</font><font color="#000080">,</font><font color="#800000">17</font><font color="#000080">); </font>writeln<font color="#000080">(</font><font color="#800000">'Press a key to produce a sound, or Esc to quit'</font><font color="#000080">);
  </font><font color="#FF0000"><b>with </b></font>f <font color="#FF0000"><b>do
  begin
    </b></font>modchr<font color="#000080">:=</font><font color="#800000">$41</font><font color="#000080">; </font>carchr<font color="#000080">:=</font><font color="#800000">$41</font><font color="#000080">; </font>modlev<font color="#000080">:=</font><font color="#800000">$8a</font><font color="#000080">; </font>carlev<font color="#000080">:=</font><font color="#800000">$40</font><font color="#000080">;
    </font>modatk<font color="#000080">:=</font><font color="#800000">$F1</font><font color="#000080">; </font>caratk<font color="#000080">:=</font><font color="#800000">$F1</font><font color="#000080">; </font>modsus<font color="#000080">:=</font><font color="#800000">$31</font><font color="#000080">; </font>carsus<font color="#000080">:=</font><font color="#800000">$33</font><font color="#000080">;
    </font>modwav<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;   </font>carwav<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;   </font>feedback<font color="#000080">:=</font><font color="#800000">6</font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>DrawOrgan<font color="#000080">; </font>FMReset<font color="#000080">;
  </font>FMSetup<font color="#000080">(</font><font color="#800000">2</font><font color="#000080">,</font>f<font color="#000080">); </font>organ<font color="#000080">;
  </font>FMKeyoff<font color="#000080">(</font><font color="#800000">2</font><font color="#000080">); </font>FMReset<font color="#000080">;
  </font>textattr<font color="#000080">:=</font><font color="#800000">7</font><font color="#000080">; </font>clrscr<font color="#000080">; </font>ShowCursor<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to SOUND SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0110.PAS">Original</a><b>]</b></p></body>
</html>
