<html>
<head><title> "Play WAV Files over the PC-Speaker" by HILKO BENGEN</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to SOUND SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0075.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
This is for all the people who wanted a program to play wavs or so over
the internal beeper. (This was taken from a German computer magazine; it
has not been tested by me)
}
</i></font><font color="#FF0000"><b>Program </b></font>Speaker<font color="#000080">;
</font><font color="#008000"><i>{
 Frei nach DOS-International 11/94 (SPEAKER.PAS)
}
</i></font><font color="#FF0000"><b>uses </b></font>dos<font color="#000080">,</font>crt<font color="#000080">;

</font><font color="#FF0000"><b>const </b></font>OldInt <font color="#000080">: </font>Word <font color="#000080">= </font><font color="#800000">103</font><font color="#000080">;
      </font>max <font color="#000080">= </font><font color="#800000">50000</font><font color="#000080">;

</font><font color="#FF0000"><b>var </b></font>oldV <font color="#000080">: </font>Pointer<font color="#000080">;
    </font>buf <font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font>max<font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">;
    </font>f   <font color="#000080">: </font><font color="#FF0000"><b>file</b></font><font color="#000080">;
    </font>Rate<font color="#000080">,</font>I<font color="#000080">,</font>res<font color="#000080">,</font>Leng <font color="#000080">: </font>Word<font color="#000080">;
    </font>dir <font color="#000080">: </font>searchrec<font color="#000080">;
    </font>indos <font color="#000080">: ^</font>byte<font color="#000080">;

  </font><font color="#FF0000"><b>procedure </b></font>New<font color="#000080">; </font>Interrupt<font color="#000080">;
    </font><font color="#FF0000"><b>begin
      if </b></font>I <font color="#000080">&lt;= </font>Leng <font color="#FF0000"><b>then
        if </b></font>buf<font color="#000080">[</font>I<font color="#000080">] &gt; </font><font color="#800000">$80 </font><font color="#FF0000"><b>then
          </b></font>Sound<font color="#000080">(</font>rate<font color="#000080">) </font><font color="#FF0000"><b>else </b></font>NoSound<font color="#000080">;
      </font>port<font color="#000080">[</font><font color="#800000">$20</font><font color="#000080">] := </font><font color="#800000">$20</font><font color="#000080">;
      </font>Inc<font color="#000080">(</font>I<font color="#000080">);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;


  </font><font color="#FF0000"><b>procedure </b></font>getindos<font color="#000080">;
    </font><font color="#FF0000"><b>var </b></font>r <font color="#000080">: </font>registers<font color="#000080">;
    </font><font color="#FF0000"><b>begin
      </b></font>r<font color="#000080">.</font>AH <font color="#000080">:= </font><font color="#800000">$34</font><font color="#000080">;
      </font>MsDos<font color="#000080">(</font>r<font color="#000080">);
      </font>indos <font color="#000080">:= </font>ptr<font color="#000080">(</font>r<font color="#000080">.</font>es<font color="#000080">,</font>r<font color="#000080">.</font>bx<font color="#000080">);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>procedure </b></font>NewTimer<font color="#000080">(</font>Freq<font color="#000080">:</font>Word<font color="#000080">);
    </font><font color="#FF0000"><b>var </b></font>w <font color="#000080">: </font>word<font color="#000080">;
    </font><font color="#FF0000"><b>begin
      inline</b></font><font color="#000080">(</font><font color="#800000">$FA</font><font color="#000080">); </font><font color="#008000"><i>{CLI}
      </i></font>w <font color="#000080">:= </font><font color="#800000">1193180 </font><font color="#FF0000"><b>DIV </b></font>Freq<font color="#000080">;
      </font>Port<font color="#000080">[</font><font color="#800000">$43</font><font color="#000080">] := </font><font color="#800000">$36</font><font color="#000080">;
      </font>Port<font color="#000080">[</font><font color="#800000">$40</font><font color="#000080">] := </font>Lo<font color="#000080">(</font>w<font color="#000080">);
      </font>Port<font color="#000080">[</font><font color="#800000">$40</font><font color="#000080">] := </font>Hi<font color="#000080">(</font>w<font color="#000080">);

      </font>GetIntVec<font color="#000080">(</font><font color="#800000">8</font><font color="#000080">,</font>OldV<font color="#000080">);
      </font>SetIntVec<font color="#000080">(</font><font color="#800000">8</font><font color="#000080">,@</font>New<font color="#000080">);

      </font><font color="#FF0000"><b>inline</b></font><font color="#000080">(</font><font color="#800000">$FB</font><font color="#000080">); </font><font color="#008000"><i>{STI}
    </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>procedure </b></font>OldTimer<font color="#000080">;
    </font><font color="#FF0000"><b>begin
      inline</b></font><font color="#000080">(</font><font color="#800000">$FA</font><font color="#000080">); </font><font color="#008000"><i>{CLI}
      </i></font>Port<font color="#000080">[</font><font color="#800000">$43</font><font color="#000080">] := </font><font color="#800000">$36</font><font color="#000080">;
      </font>Port<font color="#000080">[</font><font color="#800000">$40</font><font color="#000080">] := </font><font color="#800000">0</font><font color="#000080">;
      </font>Port<font color="#000080">[</font><font color="#800000">$40</font><font color="#000080">] := </font><font color="#800000">0</font><font color="#000080">;
      </font>SetIntVec<font color="#000080">(</font><font color="#800000">8</font><font color="#000080">,</font>OldV<font color="#000080">);
      </font><font color="#FF0000"><b>inline</b></font><font color="#000080">(</font><font color="#800000">$FB</font><font color="#000080">); </font><font color="#008000"><i>{STI}
    </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>var </b></font>b <font color="#000080">: </font>byte<font color="#000080">;

</font><font color="#FF0000"><b>begin
  </b></font>getindos<font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font>Paramcount <font color="#000080">= </font><font color="#800000">2 </font><font color="#FF0000"><b>then begin
    </b></font>Assign<font color="#000080">(</font>f<font color="#000080">,</font>Paramstr<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">)); </font>reset<font color="#000080">(</font>f<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">);
    </font>leng <font color="#000080">:= </font>filesize<font color="#000080">(</font>f<font color="#000080">);
    </font><font color="#FF0000"><b>if </b></font>leng <font color="#000080">&gt; </font>max <font color="#FF0000"><b>then </b></font>leng <font color="#000080">:= </font>max<font color="#000080">;
    </font>Blockread<font color="#000080">(</font>f<font color="#000080">,</font>buf<font color="#000080">,</font>leng<font color="#000080">,</font>res<font color="#000080">);
    </font>I <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
    </font>Val<font color="#000080">(</font>ParamStr<font color="#000080">(</font><font color="#800000">2</font><font color="#000080">),</font>Rate<font color="#000080">,</font>res<font color="#000080">);
    </font>NewTimer<font color="#000080">(</font>Rate<font color="#000080">);
    </font>Writeln<font color="#000080">(</font><font color="#800000">'Playing '</font><font color="#000080">,</font>paramstr<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">));
    </font><font color="#FF0000"><b>repeat
      </b></font>b <font color="#000080">:= </font>buf<font color="#000080">[</font>i<font color="#000080">];
      </font>TextColor<font color="#000080">(</font><font color="#800000">10</font><font color="#000080">);
      </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>b <font color="#FF0000"><b>and </b></font><font color="#800000">1 </font><font color="#000080">&lt;&gt; </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>then </b></font>Write<font color="#000080">(</font><font color="#800000">'&thorn;'</font><font color="#000080">);
      </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>b <font color="#FF0000"><b>and </b></font><font color="#800000">2 </font><font color="#000080">&lt;&gt; </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>then </b></font>Write<font color="#000080">(</font><font color="#800000">'&thorn;'</font><font color="#000080">);
      </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>b <font color="#FF0000"><b>and </b></font><font color="#800000">4 </font><font color="#000080">&lt;&gt; </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>then </b></font>Write<font color="#000080">(</font><font color="#800000">'&thorn;'</font><font color="#000080">);
      </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>b <font color="#FF0000"><b>and </b></font><font color="#800000">8 </font><font color="#000080">&lt;&gt; </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>then </b></font>Write<font color="#000080">(</font><font color="#800000">'&thorn;'</font><font color="#000080">);
      </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>b <font color="#FF0000"><b>and </b></font><font color="#800000">16 </font><font color="#000080">&lt;&gt; </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>then </b></font>Write<font color="#000080">(</font><font color="#800000">'&thorn;'</font><font color="#000080">);
      </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>b <font color="#FF0000"><b>and </b></font><font color="#800000">32 </font><font color="#000080">&lt;&gt; </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>then </b></font>Write<font color="#000080">(</font><font color="#800000">'&thorn;'</font><font color="#000080">);
      </font>TextColor<font color="#000080">(</font><font color="#800000">12</font><font color="#000080">);
      </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>b <font color="#FF0000"><b>and </b></font><font color="#800000">64 </font><font color="#000080">&lt;&gt; </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>then </b></font>Write<font color="#000080">(</font><font color="#800000">'&thorn;'</font><font color="#000080">);
      </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>b <font color="#FF0000"><b>and </b></font><font color="#800000">128 </font><font color="#000080">&lt;&gt; </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>then </b></font>Write<font color="#000080">(</font><font color="#800000">'&thorn;'</font><font color="#000080">);
      </font>Write<font color="#000080">(</font><font color="#800000">'        '#13</font><font color="#000080">);
      </font>delay<font color="#000080">(</font><font color="#800000">40</font><font color="#000080">);
      </font><font color="#FF0000"><b>if not </b></font><font color="#000080">(</font>I <font color="#000080">&lt;= </font>Leng<font color="#000080">) </font><font color="#FF0000"><b>then
        if </b></font><font color="#000080">(</font>indos<font color="#000080">^ &lt;= </font><font color="#800000">1</font><font color="#000080">) </font><font color="#FF0000"><b>then begin
          inline</b></font><font color="#000080">(</font><font color="#800000">$FA</font><font color="#000080">); </font><font color="#008000"><i>{CLI}
          </i></font>i <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
          </font>Blockread<font color="#000080">(</font>f<font color="#000080">,</font>buf<font color="#000080">,</font>max<font color="#000080">,</font>res<font color="#000080">);
          </font>leng <font color="#000080">:= </font>res<font color="#000080">;
          </font><font color="#FF0000"><b>inline</b></font><font color="#000080">(</font><font color="#800000">$FB</font><font color="#000080">); </font><font color="#008000"><i>{STI}
          </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>until </b></font><font color="#000080">(</font>I <font color="#000080">&gt; </font>Leng<font color="#000080">) </font><font color="#FF0000"><b>or </b></font><font color="#000080">(</font>port<font color="#000080">[</font><font color="#800000">$60</font><font color="#000080">] &lt; </font><font color="#800000">$80</font><font color="#000080">);
    </font>OldTimer<font color="#000080">; </font>nosound<font color="#000080">;
    </font>Close<font color="#000080">(</font>f<font color="#000080">);
    </font><font color="#FF0000"><b>end else begin
      </b></font>Writeln<font color="#000080">(</font><font color="#800000">'SPEAKER.PAS (c) by ?'</font><font color="#000080">);
      </font>Writeln<font color="#000080">;
      </font>Writeln<font color="#000080">(</font><font color="#800000">'Usage: SPEAKER &lt;samplename&gt; &lt;samplingrate&gt;'</font><font color="#000080">);
      </font>Writeln<font color="#000080">(</font><font color="#800000">'Samplingrate sollte zwischen 8000 und 22000 liegen.'</font><font color="#000080">);
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to SOUND SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0075.PAS">Original</a><b>]</b></p></body>
</html>
