<html>
<head><title> "Play with Soundblaster" by BRIAN PAPE</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to SOUND SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0028.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
BRIAN PAPE

Ok, here's about 45 minutes of sweating, trying to read some pitifull SB
reference.  This is about as far as I've gotten trying to make the SB
make some noise that is actually a note, not just a buzz...  If anyone
can do ANYTHING at ALL with this, please tell me.

This program is not Copyright (c)1993 by Brian Pape.
written 4/13/93
It is 100% my code with nothing taken from anyone else.  If you can use it in
anyway, great.  I should have the actual real version done later this summer
that is more readable.  The .MOD player is about half done, pending the
finishing of the code to actually play the notes (decoder is done).
My fido address is 1:2250/26
}
</i></font><font color="#FF0000"><b>program </b></font>sb<font color="#000080">;
</font><font color="#FF0000"><b>uses
  </b></font>crt<font color="#000080">;
</font><font color="#FF0000"><b>const
  on     </b></font><font color="#000080">= </font>true<font color="#000080">;
  </font>off    <font color="#000080">= </font>false<font color="#000080">;
  </font>maxreg <font color="#000080">= </font><font color="#800000">$F5</font><font color="#000080">;
  </font>maxch  <font color="#000080">= </font><font color="#800000">10</font><font color="#000080">;

  </font>note_table <font color="#000080">: </font><font color="#FF0000"><b>array </b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">12</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>word <font color="#000080">=
    (</font><font color="#800000">$000</font><font color="#000080">,</font><font color="#800000">$16b</font><font color="#000080">,</font><font color="#800000">$181</font><font color="#000080">,</font><font color="#800000">$198</font><font color="#000080">,</font><font color="#800000">$1b0</font><font color="#000080">,</font><font color="#800000">$1ca</font><font color="#000080">,</font><font color="#800000">$1e5</font><font color="#000080">,</font><font color="#800000">$202</font><font color="#000080">,</font><font color="#800000">$220</font><font color="#000080">,</font><font color="#800000">$241</font><font color="#000080">,</font><font color="#800000">$263</font><font color="#000080">,</font><font color="#800000">$287</font><font color="#000080">,</font><font color="#800000">$2ae</font><font color="#000080">);
  </font>key_table  <font color="#000080">: </font><font color="#FF0000"><b>array </b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">12</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>char <font color="#000080">=
    </font><font color="#800000">'QWERTYUIOP[]'</font><font color="#000080">;
  </font>voicekey_table <font color="#000080">: </font><font color="#FF0000"><b>array </b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">11</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>char <font color="#000080">=
    </font><font color="#800000">'0123456789'</font><font color="#000080">;
</font><font color="#FF0000"><b>type
  </b></font>byteset <font color="#000080">= </font><font color="#FF0000"><b>set of </b></font>byte<font color="#000080">;

</font><font color="#FF0000"><b>var
  </b></font>ch        <font color="#000080">: </font>char<font color="#000080">;
  </font>channel   <font color="#000080">: </font>byte<font color="#000080">;
  </font>ch_active <font color="#000080">: </font>byteset<font color="#000080">;
  </font>lastnote  <font color="#000080">: </font><font color="#FF0000"><b>array </b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font>maxch<font color="#000080">] </font><font color="#FF0000"><b>of </b></font>word<font color="#000080">;


</font><font color="#FF0000"><b>procedure </b></font>writeaddr<font color="#000080">(</font>b <font color="#000080">: </font>byte<font color="#000080">); </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>asm
  </b></font><font color="#FF00FF">mov  al, b
  mov  dx, 388h
  out  dx, al
  mov  cx, 6

 @wait:
  in   al, dx
  loop @wait
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>writedata<font color="#000080">(</font>b <font color="#000080">: </font>byte<font color="#000080">); </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>asm
  </b></font><font color="#FF00FF">mov  al, b
  mov  dx, 389h
  out  dx, al
  mov  cx, 35h
  dec  dx

 @wait:
  in   al, dx
  loop @wait
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>sb_reset<font color="#000080">;
</font><font color="#FF0000"><b>var
  </b></font>i <font color="#000080">: </font>byte<font color="#000080">;
</font><font color="#FF0000"><b>begin
  for </b></font>i <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>maxreg <font color="#FF0000"><b>do
  begin
    </b></font>writeaddr<font color="#000080">(</font>i<font color="#000080">);
    </font>writedata<font color="#000080">(</font><font color="#800000">0</font><font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>sb_off<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>writeaddr<font color="#000080">(</font><font color="#800000">$b0</font><font color="#000080">);
  </font>writedata<font color="#000080">(</font><font color="#800000">$11</font><font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{ r=register,d=data }
</i></font><font color="#FF0000"><b>procedure </b></font>sb_out<font color="#000080">(</font>r<font color="#000080">, </font>d <font color="#000080">: </font>byte<font color="#000080">);
</font><font color="#FF0000"><b>begin
  </b></font>writeaddr<font color="#000080">(</font>r<font color="#000080">);
  </font>writedata<font color="#000080">(</font>d<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>sb_setup<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>sb_out<font color="#000080">(</font><font color="#800000">$20</font><font color="#000080">, </font><font color="#800000">$01</font><font color="#000080">);
  </font>sb_out<font color="#000080">(</font><font color="#800000">$40</font><font color="#000080">, </font><font color="#800000">$10</font><font color="#000080">);
  </font>sb_out<font color="#000080">(</font><font color="#800000">$60</font><font color="#000080">, </font><font color="#800000">$F0</font><font color="#000080">);
  </font>sb_out<font color="#000080">(</font><font color="#800000">$80</font><font color="#000080">, </font><font color="#800000">$77</font><font color="#000080">);
  </font>sb_out<font color="#000080">(</font><font color="#800000">$A0</font><font color="#000080">, </font><font color="#800000">$98</font><font color="#000080">);
  </font>sb_out<font color="#000080">(</font><font color="#800000">$23</font><font color="#000080">, </font><font color="#800000">$01</font><font color="#000080">);
  </font>sb_out<font color="#000080">(</font><font color="#800000">$43</font><font color="#000080">, </font><font color="#800000">$00</font><font color="#000080">);
  </font>sb_out<font color="#000080">(</font><font color="#800000">$63</font><font color="#000080">, </font><font color="#800000">$F0</font><font color="#000080">);
  </font>sb_out<font color="#000080">(</font><font color="#800000">$83</font><font color="#000080">, </font><font color="#800000">$77</font><font color="#000080">);
  </font>sb_out<font color="#000080">(</font><font color="#800000">$B0</font><font color="#000080">, </font><font color="#800000">$31</font><font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>disphelp<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>clrscr<font color="#000080">;
  </font>writeln<font color="#000080">;
  </font>writeln<font color="#000080">(</font><font color="#800000">'Q:C#'</font><font color="#000080">);
  </font>writeln<font color="#000080">(</font><font color="#800000">'W:D'</font><font color="#000080">);
  </font>writeln<font color="#000080">(</font><font color="#800000">'E:D#'</font><font color="#000080">);
  </font>writeln<font color="#000080">(</font><font color="#800000">'R:E'</font><font color="#000080">);
  </font>writeln<font color="#000080">(</font><font color="#800000">'T:F'</font><font color="#000080">);
  </font>writeln<font color="#000080">(</font><font color="#800000">'Y:F#'</font><font color="#000080">);
  </font>writeln<font color="#000080">(</font><font color="#800000">'U:G'</font><font color="#000080">);
  </font>writeln<font color="#000080">(</font><font color="#800000">'I:G#'</font><font color="#000080">);
  </font>writeln<font color="#000080">(</font><font color="#800000">'O:A'</font><font color="#000080">);
  </font>writeln<font color="#000080">(</font><font color="#800000">'P:A#'</font><font color="#000080">);
  </font>writeln<font color="#000080">(</font><font color="#800000">'[:B'</font><font color="#000080">);
  </font>writeln<font color="#000080">(</font><font color="#800000">']:C'</font><font color="#000080">);
  </font>writeln<font color="#000080">(</font><font color="#800000">'X:Quit'</font><font color="#000080">);
  </font>writeln<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>sb_note<font color="#000080">(</font>channel <font color="#000080">: </font>byte<font color="#000080">; </font>note <font color="#000080">: </font>word<font color="#000080">; </font><font color="#FF0000"><b>on </b></font><font color="#000080">: </font>boolean<font color="#000080">);
</font><font color="#FF0000"><b>begin
  </b></font>sb_out<font color="#000080">(</font><font color="#800000">$a0 </font><font color="#000080">+ </font>channel<font color="#000080">, </font>lo<font color="#000080">(</font>note<font color="#000080">));
  </font>sb_out<font color="#000080">(</font><font color="#800000">$b0 </font><font color="#000080">+ </font>channel<font color="#000080">, (</font><font color="#800000">$20 </font><font color="#000080">* </font>byte<font color="#000080">(</font><font color="#FF0000"><b>on</b></font><font color="#000080">)) </font><font color="#FF0000"><b>or </b></font><font color="#800000">$10 </font><font color="#FF0000"><b>or </b></font>hi<font color="#000080">(</font>note<font color="#000080">));
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>updatestatus<font color="#000080">;
</font><font color="#FF0000"><b>var
  </b></font>i <font color="#000080">: </font>byte<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>gotoxy<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">16</font><font color="#000080">);
  </font><font color="#FF0000"><b>for </b></font>i <font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font>maxch <font color="#FF0000"><b>do
  begin
    if </b></font>i <font color="#FF0000"><b>in </b></font>ch_active <font color="#FF0000"><b>then
      </b></font>textcolor<font color="#000080">(</font><font color="#800000">14</font><font color="#000080">)
    </font><font color="#FF0000"><b>else
      </b></font>textcolor<font color="#000080">(</font><font color="#800000">7</font><font color="#000080">);
    </font>write<font color="#000080">(</font>i <font color="#000080">: </font><font color="#800000">3</font><font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>begin
  </b></font>sb_reset<font color="#000080">;
  </font>sb_out<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">, </font><font color="#800000">$10</font><font color="#000080">);
  </font>sb_setup<font color="#000080">;
  </font>disphelp<font color="#000080">;
  </font>channel   <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font>ch_active <font color="#000080">:= [</font><font color="#800000">0</font><font color="#000080">];
  </font><font color="#FF0000"><b>repeat
    </b></font>updatestatus<font color="#000080">;
    </font>ch <font color="#000080">:= </font>upcase<font color="#000080">(</font>readkey<font color="#000080">);
    </font><font color="#FF0000"><b>if </b></font>pos<font color="#000080">(</font>ch<font color="#000080">, </font>key_table<font color="#000080">) &lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then
    begin
      </b></font>lastnote<font color="#000080">[</font>channel<font color="#000080">] := </font>note_table<font color="#000080">[</font>pos<font color="#000080">(</font>ch<font color="#000080">, </font>key_table<font color="#000080">)];
      </font>sb_note<font color="#000080">(</font>channel<font color="#000080">, </font>lastnote<font color="#000080">[</font>channel<font color="#000080">], </font><font color="#FF0000"><b>on</b></font><font color="#000080">);
    </font><font color="#FF0000"><b>end
    else
    if </b></font>pos<font color="#000080">(</font>ch<font color="#000080">, </font>voicekey_table<font color="#000080">) &lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then
    begin
      </b></font>channel <font color="#000080">:= </font>pred<font color="#000080">(</font>pos<font color="#000080">(</font>ch<font color="#000080">,</font>voicekey_table<font color="#000080">));
      </font><font color="#FF0000"><b>if </b></font>channel <font color="#FF0000"><b>in </b></font>ch_active <font color="#FF0000"><b>then
        </b></font>ch_active <font color="#000080">:= </font>ch_active <font color="#000080">- [</font>channel<font color="#000080">]
      </font><font color="#FF0000"><b>else
        </b></font>ch_active <font color="#000080">:= </font>ch_active <font color="#000080">+ [</font>channel<font color="#000080">];
      </font><font color="#FF0000"><b>if not </b></font><font color="#000080">(</font>channel <font color="#FF0000"><b>in </b></font>ch_active<font color="#000080">) </font><font color="#FF0000"><b>then
        </b></font>sb_note<font color="#000080">(</font>channel<font color="#000080">,</font>lastnote<font color="#000080">[</font>channel<font color="#000080">],</font>off<font color="#000080">)
      </font><font color="#FF0000"><b>else
        </b></font>sb_note<font color="#000080">(</font>channel<font color="#000080">,</font>lastnote<font color="#000080">[</font>channel<font color="#000080">],</font><font color="#FF0000"><b>on</b></font><font color="#000080">);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>until </b></font>ch <font color="#000080">= </font><font color="#800000">'X'</font><font color="#000080">;
  </font>sb_off<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">.

</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to SOUND SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0028.PAS">Original</a><b>]</b></p></body>
</html>
