<html>
<head><title> "DigiTalk" by GERHARD DALENOORT</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to SOUND SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0064.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
  From: Gerhard Dalenoort                            Read: Yes    Replied: No
}
</i></font><font color="#FF0000"><b>Program </b></font>DigiTal<font color="#000080">; </font><font color="#008000"><i>{ Real-Mode Only }

{ Timer routines tnx to Unit digital

  InterruptVector   : Array [0..255] of Pointer Absolute $0000 : $0000;

  My Question is this: In DPMI mode were do I have to look
                       for the Interrupt Table ???
                       and How to program DMA ???

   GreetZ,
     Gerhard.
}

</i></font><font color="#FF0000"><b>Uses </b></font>Crt<font color="#000080">;
</font><font color="#FF0000"><b>Const
  </b></font>fname <font color="#000080">= </font><font color="#800000">'c:\modplay\sounds\hcaprince.911'</font><font color="#000080">;  </font><font color="#008000"><i>{ Can be any raw data File }
  </i></font>SAMPLERATE <font color="#000080">= </font><font color="#800000">16000</font><font color="#000080">; </font><font color="#008000"><i>{ about: 3Khz - 44Khz }

  </i></font>HexTable <font color="#000080">: </font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">15</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Char <font color="#000080">=
        (</font><font color="#800000">'0'</font><font color="#000080">,</font><font color="#800000">'1'</font><font color="#000080">,</font><font color="#800000">'2'</font><font color="#000080">,</font><font color="#800000">'3'</font><font color="#000080">,</font><font color="#800000">'4'</font><font color="#000080">,</font><font color="#800000">'5'</font><font color="#000080">,</font><font color="#800000">'6'</font><font color="#000080">,</font><font color="#800000">'7'</font><font color="#000080">,</font><font color="#800000">'8'</font><font color="#000080">,</font><font color="#800000">'9'</font><font color="#000080">,</font><font color="#800000">'A'</font><font color="#000080">,</font><font color="#800000">'B'</font><font color="#000080">,</font><font color="#800000">'C'</font><font color="#000080">,</font><font color="#800000">'D'</font><font color="#000080">,</font><font color="#800000">'E'</font><font color="#000080">,</font><font color="#800000">'F'</font><font color="#000080">);

  </font>Counter <font color="#000080">: </font>Word <font color="#000080">= </font><font color="#800000">1</font><font color="#000080">;
</font><font color="#008000"><i>{ SB-DSP Constants }
   </i></font>BASE       <font color="#000080">= </font><font color="#800000">$220</font><font color="#000080">;  </font><font color="#008000"><i>{ Change this to your card base adres }
   </i></font>resetport  <font color="#000080">= </font>Base <font color="#000080">+ </font><font color="#800000">$6</font><font color="#000080">;
   </font>readport   <font color="#000080">= </font>Base <font color="#000080">+ </font><font color="#800000">$A</font><font color="#000080">;
   </font>Writeport  <font color="#000080">= </font>Base <font color="#000080">+ </font><font color="#800000">$C</font><font color="#000080">;
   </font>statusport <font color="#000080">= </font>Base <font color="#000080">+ </font><font color="#800000">$E</font><font color="#000080">;
   </font>dac_Write  <font color="#000080">= </font><font color="#800000">$10</font><font color="#000080">;
   </font>adc_read   <font color="#000080">= </font><font color="#800000">$20</font><font color="#000080">;
   </font>speakeron  <font color="#000080">= </font><font color="#800000">$D1</font><font color="#000080">;
   </font>speakeroff <font color="#000080">= </font><font color="#800000">$D3</font><font color="#000080">;

</font><font color="#008000"><i>{ Timer Constants}
  </i></font>C8253ModeControl   <font color="#000080">= </font><font color="#800000">$43</font><font color="#000080">;
  </font>C8253Channel       <font color="#000080">: </font><font color="#FF0000"><b>Array </b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">2</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Byte <font color="#000080">= (</font><font color="#800000">$40</font><font color="#000080">, </font><font color="#800000">$41</font><font color="#000080">, </font><font color="#800000">$42</font><font color="#000080">);
  </font>C8253OperatingFreq <font color="#000080">= </font><font color="#800000">1193180</font><font color="#000080">;
  </font>C8259Command       <font color="#000080">= </font><font color="#800000">$20</font><font color="#000080">;
  </font>TimerInterrupt     <font color="#000080">= </font><font color="#800000">$08</font><font color="#000080">;


</font><font color="#FF0000"><b>Var
  </b></font>OldTimerInterrupt <font color="#000080">: </font>Pointer<font color="#000080">;
  </font>InterruptVector   <font color="#000080">: </font><font color="#FF0000"><b>Array </b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">255</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Pointer <font color="#FF0000"><b>Absolute </b></font><font color="#800000">$0000 </font><font color="#000080">: </font><font color="#800000">$0000</font><font color="#000080">;
  </font>OK<font color="#000080">,</font>DonePlaying    <font color="#000080">: </font>Boolean<font color="#000080">;
  </font>Sound             <font color="#000080">: </font>Pointer<font color="#000080">;
  </font>Size<font color="#000080">,
  </font>SegSound<font color="#000080">, </font>OfsSound<font color="#000080">: </font>Word<font color="#000080">;
  </font>Mbyte             <font color="#000080">: </font>byte<font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>spk_on<font color="#000080">;
</font><font color="#FF0000"><b>begin
   Repeat Until </b></font>port<font color="#000080">[</font>Writeport<font color="#000080">] &lt; </font><font color="#800000">$80</font><font color="#000080">;
   </font>port<font color="#000080">[</font>Writeport<font color="#000080">] := </font><font color="#800000">$D1</font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>spk_off<font color="#000080">;
</font><font color="#FF0000"><b>begin
   Repeat Until </b></font>port<font color="#000080">[</font>Writeport<font color="#000080">] &lt; </font><font color="#800000">$80</font><font color="#000080">;
   </font>port<font color="#000080">[</font>Writeport<font color="#000080">] := </font><font color="#800000">$D3</font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>resetDSP <font color="#000080">: </font>Boolean<font color="#000080">;
</font><font color="#008000"><i>(*----------------------------------------------------------
 Not Mine...
 The Book says:
 - Write a 1 to ResetPort $2x6,
 - Wait 3 MicroSec. (&aelig;s)
 - Write a 0 to ResetPort $2x6
 - Wait until ready byte $0AA at DataPort $2xA
   (it is advisable to check first for a data avaible: Port $22E bit 7 set)
   Typically the DSP takes about 100 microsecs. to reset.

   Mine looks like this in pseudo code:
     Port[$226]:=1;
     Asm nop; nop; nop; End; { Consume time }
     Port[$226]:=0;
     I:=0; { Longint }
     Repeat Inc(I) until (I&gt;123000) or (Port[$22A]=$0AA);
     ResetDSP:=(I&lt;32000);
-------------------------------------------------------------- *)

</i></font><font color="#FF0000"><b>Var
   </b></font>count<font color="#000080">, </font>bdum <font color="#000080">: </font>Byte<font color="#000080">;
</font><font color="#FF0000"><b>begin
   </b></font>resetDSP <font color="#000080">:= </font>False<font color="#000080">;
   </font>port<font color="#000080">[</font>resetport<font color="#000080">] := </font><font color="#800000">1</font><font color="#000080">;
   </font><font color="#FF0000"><b>For </b></font>count <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font><font color="#800000">6 </font><font color="#FF0000"><b>do </b></font>bdum <font color="#000080">:= </font>port<font color="#000080">[</font>statusport<font color="#000080">];
   </font>port<font color="#000080">[</font>resetport<font color="#000080">] := </font><font color="#800000">0</font><font color="#000080">;
   </font><font color="#FF0000"><b>For </b></font>count <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font><font color="#800000">6 </font><font color="#FF0000"><b>do </b></font>bdum <font color="#000080">:= </font>port<font color="#000080">[</font>statusport<font color="#000080">];
   </font><font color="#FF0000"><b>Repeat Until </b></font>port<font color="#000080">[</font>statusport<font color="#000080">] &gt; </font><font color="#800000">$80</font><font color="#000080">;
   </font><font color="#FF0000"><b>if </b></font>port<font color="#000080">[</font>readport<font color="#000080">] = </font><font color="#800000">$AA </font><font color="#FF0000"><b>then </b></font>resetDSP <font color="#000080">:= </font>True<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>Procedure </b></font>generic<font color="#000080">(</font>reg<font color="#000080">,</font>cmd<font color="#000080">:</font>Integer<font color="#000080">; </font>data<font color="#000080">:</font>Byte<font color="#000080">);
      </font><font color="#008000"><i>{ ?? not used here, what does it do ?? }
</i></font><font color="#FF0000"><b>begin
   Repeat Until </b></font>port<font color="#000080">[</font>Writeport<font color="#000080">] &lt; </font><font color="#800000">$80</font><font color="#000080">;
   </font>port<font color="#000080">[</font>reg<font color="#000080">] := </font>cmd<font color="#000080">;
   </font><font color="#FF0000"><b>Repeat Until </b></font>port<font color="#000080">[</font>Writeport<font color="#000080">] &lt; </font><font color="#800000">$80</font><font color="#000080">;
   </font>port<font color="#000080">[</font>reg<font color="#000080">] := </font>data<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>fUNCtION </b></font>hEX<font color="#000080">( </font>tHEvAR<font color="#000080">:</font>wORD<font color="#000080">):</font><font color="#FF0000"><b>sTRING</b></font><font color="#000080">; </font><font color="#008000"><i>{ See what the it looks like in HEX }
</i></font><font color="#FF0000"><b>vAR
 </b></font>bUF    <font color="#000080">: </font><font color="#FF0000"><b>sTRING</b></font><font color="#000080">;
 </font>w      <font color="#000080">: </font>wORD<font color="#000080">;
</font><font color="#FF0000"><b>bEGIN
 </b></font>w <font color="#000080">:= </font>tHEvAR<font color="#000080">;
 </font>bUF<font color="#000080">:=      </font>hEXtABLE<font color="#000080">[ </font>hI<font color="#000080">(</font>w<font color="#000080">) </font><font color="#FF0000"><b>sHR  </b></font><font color="#800000">4</font><font color="#000080">];
 </font>bUF<font color="#000080">:=</font>bUF <font color="#000080">+ </font>hEXtABLE<font color="#000080">[ </font>hI<font color="#000080">(</font>w<font color="#000080">) </font><font color="#FF0000"><b>mOD </b></font><font color="#800000">16</font><font color="#000080">];
 </font>bUF<font color="#000080">:=</font>bUF <font color="#000080">+ </font>hEXtABLE<font color="#000080">[ </font>lO<font color="#000080">(</font>w<font color="#000080">) </font><font color="#FF0000"><b>sHR  </b></font><font color="#800000">4</font><font color="#000080">];
 </font>bUF<font color="#000080">:=</font>bUF <font color="#000080">+ </font>hEXtABLE<font color="#000080">[ </font>lO<font color="#000080">(</font>w<font color="#000080">) </font><font color="#FF0000"><b>mOD </b></font><font color="#800000">16</font><font color="#000080">];;
 </font>hEX<font color="#000080">:=</font>bUF<font color="#000080">;
</font><font color="#FF0000"><b>eND</b></font><font color="#000080">;



</font><font color="#008000"><i>{=[ 8253 Timer Programming Routines ]=====================================}
</i></font><font color="#FF0000"><b>Procedure </b></font>Set8253Channel<font color="#000080">(</font>ChannelNumber <font color="#000080">: </font>Byte<font color="#000080">; </font>ProgramValue <font color="#000080">: </font>Word<font color="#000080">);
</font><font color="#FF0000"><b>begin
  </b></font>Port<font color="#000080">[</font>C8253ModeControl<font color="#000080">] := </font><font color="#800000">54 </font><font color="#FF0000"><b>or </b></font><font color="#000080">(</font>ChannelNumber <font color="#FF0000"><b>SHL </b></font><font color="#800000">6</font><font color="#000080">); </font><font color="#008000"><i>{ XX110110 }
  </i></font>Port<font color="#000080">[</font>C8253Channel<font color="#000080">[</font>ChannelNumber<font color="#000080">]] := </font>Lo<font color="#000080">(</font>ProgramValue<font color="#000080">);
  </font>Port<font color="#000080">[</font>C8253Channel<font color="#000080">[</font>ChannelNumber<font color="#000080">]] := </font>Hi<font color="#000080">(</font>ProgramValue<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;



</font><font color="#008000"><i>{-[ Set Timer Interupt Vector To Default Handler ]------------------------}
</i></font><font color="#FF0000"><b>Procedure </b></font>SetTimerInterruptVectorDefault<font color="#000080">;
</font><font color="#FF0000"><b>begin
  aSM </b></font><font color="#FF00FF">cli </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
  </font>InterruptVector<font color="#000080">[</font>TimerInterrupt<font color="#000080">] := </font>OldTimerInterrupt<font color="#000080">;
  </font><font color="#FF0000"><b>aSM </b></font><font color="#FF00FF">sti </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#008000"><i>{-[ Set Clock Channel 0 Back To 18.2 Default Value ]----------------------}
</i></font><font color="#FF0000"><b>Procedure </b></font>SetDefaultTimerSpeed<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>Set8253Channel <font color="#000080">(</font><font color="#800000">0</font><font color="#000080">, </font><font color="#800000">0</font><font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;




</font><font color="#008000"><i>{=[ MUST CALL BEFORE ExitING Program!!! ]=================================}
</i></font><font color="#FF0000"><b>Procedure </b></font>CleanUp<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>SetDefaultTimerSpeed<font color="#000080">;
  </font>SetTimerInterruptVectorDefault<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;




</font><font color="#008000"><i>{-[ Set Clock Channel 0 (INT 8, IRQ 0) To Input Speed ]-------------------}
</i></font><font color="#FF0000"><b>Procedure </b></font>SetPlaySpeed<font color="#000080">(</font>Speed <font color="#000080">: </font>LongInt<font color="#000080">);
</font><font color="#FF0000"><b>Var </b></font>ProgramValue <font color="#000080">: </font>Word<font color="#000080">;
</font><font color="#FF0000"><b>begin
  if </b></font>Speed <font color="#000080">&gt; </font><font color="#800000">33000 </font><font color="#FF0000"><b>then </b></font>Speed<font color="#000080">:=</font><font color="#800000">33000</font><font color="#000080">;
  </font>ProgramValue <font color="#000080">:= </font>C8253OperatingFreq <font color="#FF0000"><b>div </b></font>Speed<font color="#000080">;
  </font>Set8253Channel<font color="#000080">(</font><font color="#800000">0</font><font color="#000080">, </font>ProgramValue<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>Procedure </b></font>PlayData<font color="#000080">; </font>Interrupt<font color="#000080">;
</font><font color="#FF0000"><b>var </b></font>DATA <font color="#000080">: </font>Byte<font color="#000080">;
</font><font color="#FF0000"><b>begin
  if Not</b></font><font color="#000080">(</font>DonePlaying<font color="#000080">) </font><font color="#FF0000"><b>Then
  begin
    if </b></font>Counter <font color="#000080">&lt;= </font>Size <font color="#FF0000"><b>Then
    begin
      </b></font>Data<font color="#000080">:=(</font>Mem<font color="#000080">[</font>SegSound<font color="#000080">:</font>OfsSound<font color="#000080">+</font>Counter<font color="#000080">] </font><font color="#008000"><i>{SHR 2} </i></font><font color="#000080">); </font><font color="#008000"><i>{ SHR = Volume down }
      </i></font>Inc<font color="#000080">(</font>Counter<font color="#000080">);

</font><font color="#008000"><i>{     Port[$22C]:=$10;      NextByte is realtime sample Data
      Port[$22C]:=Data;     Sample Data
                 The next ASM is the same as these
                 two port Writes to the DSP, Maybe just faster.
}       </i></font><font color="#FF0000"><b>Asm
          </b></font><font color="#FF00FF">mov  dx,$22C
          in   al,dx
          mov  al,10h
          out  dx,al
          in   al,dx
          mov  al,data
          out  dx,al
        </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>end else </b></font><font color="#008000"><i>{ Counter &gt; Size }
    </i></font><font color="#FF0000"><b>begin
      </b></font>DonePlaying <font color="#000080">:= </font>True<font color="#000080">;
      </font>Counter     <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font>Port<font color="#000080">[</font>C8259Command<font color="#000080">] := </font><font color="#800000">$20</font><font color="#000080">; </font><font color="#008000"><i>{ Enable Interupts }
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;




</font><font color="#008000"><i>{---------------------- LoadRawSampleData --------------------}
</i></font><font color="#FF0000"><b>Function </b></font>loadFile<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>buffer<font color="#000080">:</font>Pointer<font color="#000080">; </font>Filename<font color="#000080">:</font><font color="#FF0000"><b>String</b></font><font color="#000080">) : </font>Word<font color="#000080">;
</font><font color="#FF0000"><b>Var
   </b></font>fromf <font color="#000080">: </font><font color="#FF0000"><b>File</b></font><font color="#000080">;
   </font>size <font color="#000080">: </font>LongInt<font color="#000080">;
   </font>errcode <font color="#000080">: </font>Integer<font color="#000080">;
</font><font color="#FF0000"><b>begin
   </b></font>assign<font color="#000080">(</font>fromf<font color="#000080">,</font>Filename<font color="#000080">);
   </font>reset<font color="#000080">(</font>fromf<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">);
   </font>errcode <font color="#000080">:= </font>ioresult<font color="#000080">;
   </font><font color="#FF0000"><b>if </b></font>errcode <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>then
   begin
      </b></font>size <font color="#000080">:= </font>Filesize<font color="#000080">(</font>fromf<font color="#000080">);
      </font><font color="#008000"><i>{Writeln(size);}
      </i></font>getmem<font color="#000080">(</font>buffer<font color="#000080">,</font>size<font color="#000080">);
      </font>blockread<font color="#000080">(</font>fromf<font color="#000080">,</font>buffer<font color="#000080">^,</font>size<font color="#000080">);
   </font><font color="#FF0000"><b>end
   else </b></font>size <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
   </font>loadFile <font color="#000080">:= </font>size<font color="#000080">;
   </font>close<font color="#000080">(</font>fromf<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;



</font><font color="#FF0000"><b>Procedure </b></font>unload<font color="#000080">(</font>buffer<font color="#000080">:</font>Pointer<font color="#000080">; </font>size<font color="#000080">:</font>Word<font color="#000080">);
</font><font color="#FF0000"><b>begin </b></font>freemem<font color="#000080">(</font>buffer<font color="#000080">,</font>size<font color="#000080">); </font><font color="#FF0000"><b>end</b></font><font color="#000080">;



</font><font color="#FF0000"><b>Var </b></font>I    <font color="#000080">: </font>Integer<font color="#000080">;
    </font>Ch   <font color="#000080">: </font>Char<font color="#000080">;
</font><font color="#FF0000"><b>Begin
 </b></font>Clrscr<font color="#000080">;
 </font>DonePlaying<font color="#000080">:=</font>True<font color="#000080">;
 </font>Size <font color="#000080">:= </font>LoadFile<font color="#000080">(</font>Sound<font color="#000080">,</font>Fname<font color="#000080">);
 </font>SegSound<font color="#000080">:=</font>Seg<font color="#000080">(</font>Sound<font color="#000080">^);          </font><font color="#008000"><i>{ Get SegMent and Ofset of sample }
 </i></font>OfsSound<font color="#000080">:=</font>Ofs<font color="#000080">(</font>Sound<font color="#000080">^);

 </font>OK<font color="#000080">:=</font>ResetDSP<font color="#000080">;                   </font><font color="#008000"><i>{ Reset DSP (soundCard) }
 </i></font><font color="#FF0000"><b>if Not </b></font>OK <font color="#FF0000"><b>then begin </b></font>Write<font color="#000080">(</font><font color="#800000">#7</font><font color="#000080">,</font><font color="#800000">'No card ?'</font><font color="#000080">);</font>Halt<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">);</font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{ NO CARD DETECTED }
 </i></font>Spk_on<font color="#000080">;

 </font>SetPlaySpeed<font color="#000080">(</font>SAMPLERATE<font color="#000080">);       </font><font color="#008000"><i>{ Set Herz Timer for Interrupt $8 }
 </i></font><font color="#FF0000"><b>ASM </b></font><font color="#FF00FF">cli </font><font color="#FF0000"><b>END</b></font><font color="#000080">;                    </font><font color="#008000"><i>{ Point Interrupt $8 to My procedure }
  </i></font>OldTimerInterrupt <font color="#000080">:= </font>InterruptVector<font color="#000080">[</font>TimerInterrupt<font color="#000080">];
  </font>InterruptVector<font color="#000080">[</font>TimerInterrupt<font color="#000080">] := @</font>PlayData<font color="#000080">;
 </font><font color="#FF0000"><b>ASM </b></font><font color="#FF00FF">sti </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

 </font>GotoXY<font color="#000080">(</font><font color="#800000">10</font><font color="#000080">,</font><font color="#800000">10</font><font color="#000080">);
 </font>Writeln<font color="#000080">(</font><font color="#800000">'Testin: '</font><font color="#000080">,</font>Counter<font color="#000080">:</font><font color="#800000">5</font><font color="#000080">);
 </font>WriteLn<font color="#000080">(</font><font color="#800000">#13#10</font><font color="#000080">,</font><font color="#800000">' We Still got: '</font><font color="#000080">,</font>MaxAvail<font color="#000080">,</font><font color="#800000">' Memory, load more samples,'</font><font color="#000080">);
 </font>WriteLn<font color="#000080">(</font><font color="#800000">' That would be '</font><font color="#000080">,</font>MaxAvail <font color="#FF0000"><b>div </b></font><font color="#800000">64000</font><font color="#000080">,</font><font color="#800000">' samples of 64000 bytes
</font><font color="#000080">(</font>MaxSampleSize<font color="#000080">) </font><font color="#800000">'); WriteLn(' </font><font color="#FF0000"><b>and </b></font><font color="#800000">',MaxAvail mod 64000,' </font>bytes <font color="#FF0000"><b>of </b></font>memory<font color="#000080">,
</font>enough <font color="#000080">? ...</font>nah<font color="#000080">.</font><font color="#800000">'); WriteLn(' </font>Sample loaded <font color="#FF0000"><b>is </b></font><font color="#800000">',Size,' </font>Bytes already<font color="#800000">');
 </font>WriteLn<font color="#000080">(</font><font color="#800000">#13#10' O jeah, press space to play the sample, &lt;Esc&gt; to Quit '</font><font color="#000080">);

 </font><font color="#FF0000"><b>repeat
   IF </b></font>Port<font color="#000080">[</font><font color="#800000">$60</font><font color="#000080">]=</font><font color="#800000">57 </font><font color="#FF0000"><b>then </b></font><font color="#008000"><i>{ SpaceBar is pressed ? }
     </i></font><font color="#FF0000"><b>begin
       </b></font>Delay<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">);                    </font><font color="#008000"><i>{ Won't slow the playing }
       </i></font>GotoXY<font color="#000080">(</font><font color="#800000">10</font><font color="#000080">,</font><font color="#800000">10</font><font color="#000080">);               </font><font color="#008000"><i>{ Won't slow the playing }
       </i></font>Write<font color="#000080">(</font><font color="#800000">'Testin: '</font><font color="#000080">,</font>Counter<font color="#000080">:</font><font color="#800000">5</font><font color="#000080">); </font><font color="#008000"><i>{ Won't slow the playing }
       </i></font><font color="#FF0000"><b>if </b></font>DonEplaying <font color="#FF0000"><b>then  </b></font><font color="#008000"><i>{ it means the sample is played }
            </i></font><font color="#FF0000"><b>Begin              </b></font><font color="#008000"><i>{ Loop Mode }
              </i></font>Counter<font color="#000080">:=</font><font color="#800000">1</font><font color="#000080">;      </font><font color="#008000"><i>{ First set the counter to 1, the interrupt }
              </i></font>DonePlaying<font color="#000080">:=</font>False<font color="#000080">; </font><font color="#008000"><i>{ plays as soon as DonePlaying = false }
            </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;
     </font><font color="#FF0000"><b>end else                  </b></font><font color="#008000"><i>{ if not spacebar is down }
     </i></font><font color="#FF0000"><b>begin                     </b></font><font color="#008000"><i>{ Stop playing and reset the counter }
       </i></font>DonePlaying<font color="#000080">:=</font>True<font color="#000080">;
       </font>counter<font color="#000080">:=</font><font color="#800000">1</font><font color="#000080">;
     </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
     </font><font color="#FF0000"><b>if </b></font>Keypressed <font color="#FF0000"><b>Then </b></font>Ch<font color="#000080">:=</font>ReaDkEY<font color="#000080">; </font><font color="#008000"><i>{ The port doesn't read the key }
 </i></font><font color="#FF0000"><b>Until </b></font>Ch<font color="#000080">=</font><font color="#800000">#27</font><font color="#000080">;

 </font>CleanUp<font color="#000080">; </font><font color="#008000"><i>{ Set the interrupt to original etc. }
 </i></font>Unload<font color="#000080">(</font>Sound<font color="#000080">,</font>Size<font color="#000080">);  </font><font color="#008000"><i>{ Free Sample Memory }
 </i></font>Spk_off<font color="#000080">; </font><font color="#008000"><i>{ DAC to output off }
 </i></font>ClrScr<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to SOUND SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0064.PAS">Original</a><b>]</b></p></body>
</html>
