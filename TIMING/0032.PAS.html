<html>
<head><title> "More Timing Functions" by MIKE WAROT</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to TIMING SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0032.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
From: ka9dgx@interaccess.com (Mike Warot)

Here is the companion code for TIMER2.PAS which is required as well.
(My news grazed choked on the file size... go figure)
}

</i></font><font color="#FF0000"><b>Unit </b></font>Timer2<font color="#000080">;
</font><font color="#008000"><i>{
  Author  : Michael Warot
  Date    : December, 1987
  Purpose : Provide timing functions.
  Notes   : Does not provide midnight protection.

  05/29/92 MAW - Add protection against midnight in DT()
  06/18/93 MAW - Remove ExactRealTime - Too much fuss
}
</i></font><font color="#FF0000"><b>Interface
Uses
  </b></font>DOS<font color="#000080">;

</font><font color="#FF0000"><b>Const
  </b></font>OneDay   <font color="#000080">= </font><font color="#800000">$1800AF</font><font color="#000080">;        </font><font color="#008000"><i>{ Number of Seconds in one Day }

</i></font><font color="#FF0000"><b>Procedure </b></font>StartTime<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>X <font color="#000080">: </font>LongInt<font color="#000080">);
</font><font color="#008000"><i>{ Resets the tick counter }

</i></font><font color="#FF0000"><b>Function </b></font>DT<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>X <font color="#000080">: </font>LongInt<font color="#000080">) : </font>LongInt<font color="#000080">;
</font><font color="#008000"><i>{ Returns the time since the last Starttime, IN TICKS }

</i></font><font color="#FF0000"><b>Function </b></font>TimeStamp <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
</font><font color="#008000"><i>{ Returns YYMMDD:HHMMSS }

</i></font><font color="#FF0000"><b>Function </b></font>REALtime<font color="#000080">:</font>LongInt<font color="#000080">;
</font><font color="#008000"><i>{ Returns time from BIOS in SECONDS }

</i></font><font color="#FF0000"><b>Function </b></font>Ticks<font color="#000080">:</font>Longint<font color="#000080">; </font><font color="#008000"><i>{ Current time of day, in TICKS }

</i></font><font color="#FF0000"><b>Implementation

Var
  </b></font>BiosTick <font color="#000080">: </font>LongInt <font color="#FF0000"><b>ABSOLUTE </b></font><font color="#800000">$40</font><font color="#000080">:</font><font color="#800000">$6c</font><font color="#000080">;
  </font>LastTime <font color="#000080">: </font>LongInt<font color="#000080">;

</font><font color="#008000"><i>(*
Function Ticks : Longint; Assembler;
Asm
  Cli
  Mov ax,0040h
  mov es,ax
  mov ax,es:[6ch]
  mov dx,es:[6eh]
  Sti
End;
*)
</i></font><font color="#FF0000"><b>Function </b></font>Ticks <font color="#000080">: </font>Longint<font color="#000080">;
</font><font color="#FF0000"><b>Var
  </b></font>X <font color="#000080">: </font>Longint<font color="#000080">;
</font><font color="#FF0000"><b>Begin
  Repeat
    </b></font>X <font color="#000080">:= </font>BiosTick<font color="#000080">;
  </font><font color="#FF0000"><b>Until </b></font>X <font color="#000080">= </font>BiosTick<font color="#000080">;
  </font>Ticks <font color="#000080">:= </font>X<font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>StartTime<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>X <font color="#000080">: </font>LongInt<font color="#000080">);
</font><font color="#FF0000"><b>Begin
  </b></font>X <font color="#000080">:= </font>Ticks<font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#008000"><i>(*
Function DT(Var X : LongInt) : LongInt; Assembler;
Asm
  les  bx,X
  mov  cx,es:[bx]
  mov  bx,es:[bx+2]     { X is now in BX:CX   }
  CLI
  mov  ax,0040h
  mov  es,ax
  mov  ax,es:[6ch]
  mov  dx,es:[6eh]      { Current is in DX:AX }
  STI
  sub  ax,cx
  sbb  dx,bx
  jnc  @ok              { delta t is DX:AX, without midnight }
  add  ax,00afh         { handle midnight! }
  adc  dx,0018h
@ok:
End;
*)

</i></font><font color="#FF0000"><b>Function </b></font>DT<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>X <font color="#000080">: </font>Longint<font color="#000080">):</font>Longint<font color="#000080">;
</font><font color="#FF0000"><b>Var
  </b></font>Y <font color="#000080">: </font>Longint<font color="#000080">;
</font><font color="#FF0000"><b>Begin
  </b></font>Y <font color="#000080">:= </font>Ticks<font color="#000080">;
  </font>Y <font color="#000080">:= </font>Y <font color="#000080">- </font>X<font color="#000080">;
  </font><font color="#FF0000"><b>If </b></font>Y <font color="#000080">&lt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>Inc<font color="#000080">(</font>Y<font color="#000080">,</font>OneDay<font color="#000080">);
  </font>DT <font color="#000080">:= </font>Y<font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>TimeStamp<font color="#000080">:</font><font color="#FF0000"><b>String</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Var
  </b></font>Year<font color="#000080">,</font>Month<font color="#000080">,</font>Date<font color="#000080">,</font>Day<font color="#000080">,
  </font>Hour<font color="#000080">,</font>Min<font color="#000080">,</font>Sec<font color="#000080">,</font>Sec100   <font color="#000080">: </font>Word<font color="#000080">;
  </font>Tmp<font color="#000080">,</font>Tmp2 <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
  </font>I        <font color="#000080">: </font>Byte<font color="#000080">;
</font><font color="#FF0000"><b>Begin
  </b></font>GetDate<font color="#000080">(</font>Year<font color="#000080">,</font>Month<font color="#000080">,</font>Date<font color="#000080">,</font>Day<font color="#000080">);
  </font>GetTime<font color="#000080">(</font>Hour<font color="#000080">,</font>Min<font color="#000080">,</font>Sec<font color="#000080">,</font>Sec100<font color="#000080">);
  </font>Year <font color="#000080">:= </font>Year <font color="#FF0000"><b>MOD </b></font><font color="#800000">100</font><font color="#000080">;

  </font>Str<font color="#000080">(</font>Year<font color="#000080">:</font><font color="#800000">2  </font><font color="#000080">,</font>Tmp2<font color="#000080">); </font>Tmp <font color="#000080">:= </font>Tmp2<font color="#000080">;
  </font>Str<font color="#000080">(</font>Month<font color="#000080">:</font><font color="#800000">2 </font><font color="#000080">,</font>Tmp2<font color="#000080">); </font>Tmp <font color="#000080">:= </font>Tmp <font color="#000080">+ </font>Tmp2<font color="#000080">;
  </font>Str<font color="#000080">(</font>Date<font color="#000080">:</font><font color="#800000">2  </font><font color="#000080">,</font>Tmp2<font color="#000080">); </font>Tmp <font color="#000080">:= </font>Tmp <font color="#000080">+ </font>Tmp2 <font color="#000080">+ </font><font color="#800000">':'</font><font color="#000080">;
  </font>Str<font color="#000080">(</font>Hour<font color="#000080">:</font><font color="#800000">2  </font><font color="#000080">,</font>Tmp2<font color="#000080">); </font>Tmp <font color="#000080">:= </font>Tmp <font color="#000080">+ </font>Tmp2<font color="#000080">;
  </font>Str<font color="#000080">(</font>Min<font color="#000080">:</font><font color="#800000">2   </font><font color="#000080">,</font>Tmp2<font color="#000080">); </font>Tmp <font color="#000080">:= </font>Tmp <font color="#000080">+ </font>Tmp2<font color="#000080">;
  </font>Str<font color="#000080">(</font>Sec<font color="#000080">:</font><font color="#800000">2   </font><font color="#000080">,</font>Tmp2<font color="#000080">); </font>Tmp <font color="#000080">:= </font>Tmp <font color="#000080">+ </font>Tmp2<font color="#000080">;
  </font><font color="#FF0000"><b>For </b></font>i <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>Length<font color="#000080">(</font>Tmp<font color="#000080">) </font><font color="#FF0000"><b>DO
    If </b></font>Tmp<font color="#000080">[</font>i<font color="#000080">] = </font><font color="#800000">' ' </font><font color="#FF0000"><b>Then
      </b></font>Tmp<font color="#000080">[</font>i<font color="#000080">] := </font><font color="#800000">'0'</font><font color="#000080">;
  </font>TimeStamp <font color="#000080">:= </font>Tmp<font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">; </font><font color="#008000"><i>{ TimeStamp }

</i></font><font color="#FF0000"><b>Function </b></font>REALtime<font color="#000080">:</font>Longint<font color="#000080">;
</font><font color="#FF0000"><b>Var
  </b></font>Hour<font color="#000080">,</font>Min<font color="#000080">,</font>Sec<font color="#000080">,</font>Sec100 <font color="#000080">: </font>Word<font color="#000080">;
  </font>h<font color="#000080">,</font>m<font color="#000080">,</font>s <font color="#000080">: </font>longint<font color="#000080">;
</font><font color="#FF0000"><b>Begin
  </b></font>GetTime<font color="#000080">(</font>Hour<font color="#000080">,</font>Min<font color="#000080">,</font>Sec<font color="#000080">,</font>Sec100<font color="#000080">);
  </font>H <font color="#000080">:= </font>Hour<font color="#000080">;
  </font>M <font color="#000080">:= </font>Min<font color="#000080">;
  </font>S <font color="#000080">:= </font>Sec<font color="#000080">;
  </font>REALtime <font color="#000080">:= </font>H<font color="#000080">*</font><font color="#800000">3600 </font><font color="#000080">+ </font>M<font color="#000080">*</font><font color="#800000">60 </font><font color="#000080">+ </font>S<font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>End</b></font><font color="#000080">.

</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to TIMING SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0032.PAS">Original</a><b>]</b></p></body>
</html>
