<html>
<head><title> "Repeat until timeout" by UDO JUERSS</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to TIMING SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0037.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{The problem:  repeat
                 ...
               until SomeEvent;
 If SomeEvent (external hardware signals etc.) never comes, the program
 hangs. So I did this code to avoid hangup's. Look below for example.

 GetTimeWord returns the actual timer value.
 SetTimeOutTicks sets a timeout-value to a word variable TimeVar.
 IsTimeOut returns true when TimeVar &gt;= actual time or false if lower.

 All 3 functions/procedures are very fast. The function IsTimeOut runs
 about 2.000.000!/second on a P90-machine.

 Dec. 12, 1995, Udo Juerss, 57078 Siegen, Germany, CompuServe [101364,526]}

</i></font><font color="#FF0000"><b>uses
  </b></font>Crt<font color="#000080">;
</font><font color="#008000"><i>{---------------------------------------------------------------------------}

</i></font><font color="#FF0000"><b>var
  </b></font>Time  <font color="#000080">: </font>Word<font color="#000080">;
  </font>Count <font color="#000080">: </font>LongInt<font color="#000080">;
</font><font color="#008000"><i>{---------------------------------------------------------------------------}

</i></font><font color="#FF0000"><b>function </b></font>GetTimeWord<font color="#000080">:</font>Word<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>asm
           </b></font><font color="#FF00FF">mov   es,Seg0040
           mov   di,6Ch
           mov   ax,word ptr es:[di]
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#008000"><i>{---------------------------------------------------------------------------}

</i></font><font color="#FF0000"><b>procedure </b></font>SetTimeOutTicks<font color="#000080">(</font>Ticks<font color="#000080">:</font>Word<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>TimeVar<font color="#000080">:</font>Word<font color="#000080">); </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>asm
           </b></font><font color="#FF00FF">call  GetTimeWord
           add   ax,Ticks
           les   di,TimeVar
           stosw
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#008000"><i>{---------------------------------------------------------------------------}


</i></font><font color="#FF0000"><b>function </b></font>IsTimeOut<font color="#000080">(</font>TimeVar<font color="#000080">:</font>Word<font color="#000080">):</font>Boolean<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>asm
           </b></font><font color="#FF00FF">mov   bx,TimeVar
           call  GetTimeWord
           cmp   ax,bx
           mov   al,0
           jl    @</font><font color="#FF0000"><b>End
           </b></font>mov   al<font color="#000080">,</font><font color="#800000">1
</font><font color="#000080">@</font><font color="#FF0000"><b>End</b></font><font color="#000080">:
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#008000"><i>{---------------------------------------------------------------------------}

</i></font><font color="#FF0000"><b>begin
  </b></font>ClrScr<font color="#000080">;
  </font>Count<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
  </font>SetTimeOutTicks<font color="#000080">(</font><font color="#800000">18</font><font color="#000080">,</font>Time<font color="#000080">);               </font><font color="#008000"><i>{1 second equals ~18.2 timer ticks}
  </i></font>Writeln<font color="#000080">(</font><font color="#800000">'Waiting for 1 second and counting IsTimeOut query...'</font><font color="#000080">);
  </font><font color="#FF0000"><b>repeat
    </b></font>Inc<font color="#000080">(</font>Count<font color="#000080">);
  </font><font color="#FF0000"><b>until </b></font>IsTimeOut<font color="#000080">(</font>Time<font color="#000080">);
  </font>Writeln<font color="#000080">(</font><font color="#800000">'IsTimeOut query = '</font><font color="#000080">,</font>Count<font color="#000080">:</font><font color="#800000">8</font><font color="#000080">,</font><font color="#800000">' times/sec.'</font><font color="#000080">);
  </font>ReadKey<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">.</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to TIMING SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0037.PAS">Original</a><b>]</b></p></body>
</html>
