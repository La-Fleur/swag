<html>
<head><title> "A good Timer unit" by GAYLE DAVIS</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to TIMING SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0021.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code>
<font color="#FF0000"><b>UNIT </b></font>Timer<font color="#000080">;
</font><font color="#FF0000"><b>INTERFACE

TYPE
  </b></font>tTimerObject <font color="#000080">= </font><font color="#FF0000"><b>object
    </b></font>TimerTicks <font color="#000080">: </font>LONGINT<font color="#000080">;
    </font>MaxSeconds <font color="#000080">: </font>LONGINT<font color="#000080">;
    </font><font color="#FF0000"><b>PROCEDURE </b></font>Start<font color="#000080">(</font>Amount <font color="#000080">: </font>LONGINT<font color="#000080">);
    </font><font color="#FF0000"><b>FUNCTION  </b></font>ElapsedSeconds <font color="#000080">: </font>LONGINT<font color="#000080">;
    </font><font color="#FF0000"><b>FUNCTION  </b></font>Remaining <font color="#000080">: </font>LONGINT<font color="#000080">;
    </font><font color="#FF0000"><b>FUNCTION  </b></font>Expired <font color="#000080">: </font>BOOLEAN<font color="#000080">;
    </font><font color="#FF0000"><b>FUNCTION  </b></font>PrintableTimer<font color="#000080">(</font>Tics <font color="#000080">: </font>LONGINT<font color="#000080">) : </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>IMPLEMENTATION
VAR
  </b></font>TicksSinceMidnight <font color="#000080">: </font>LONGINT <font color="#FF0000"><b>ABSOLUTE </b></font><font color="#800000">$0040 </font><font color="#000080">: </font><font color="#800000">$006c</font><font color="#000080">;

  </font><font color="#FF0000"><b>PROCEDURE </b></font>tTimerObject<font color="#000080">.</font>Start<font color="#000080">(</font>Amount <font color="#000080">: </font>LONGINT<font color="#000080">);
  </font><font color="#FF0000"><b>BEGIN
    </b></font>TimerTicks <font color="#000080">:= </font>TicksSinceMidnight<font color="#000080">;
    </font>MaxSeconds <font color="#000080">:= </font>Amount<font color="#000080">;
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>FUNCTION </b></font>tTimerObject<font color="#000080">.</font>ElapsedSeconds <font color="#000080">: </font>LONGINT<font color="#000080">;  </font><font color="#008000"><i>{ elapsed time in seconds }
  </i></font><font color="#FF0000"><b>CONST
    </b></font>TicksPerDay <font color="#000080">= </font><font color="#800000">1573040</font><font color="#000080">;
    </font>TicksPerSecond <font color="#000080">= </font><font color="#800000">18.20648</font><font color="#000080">;
  </font><font color="#FF0000"><b>VAR
    </b></font>ElapsedTicks <font color="#000080">: </font>LONGINT<font color="#000080">;

  </font><font color="#FF0000"><b>BEGIN
    </b></font>ElapsedTicks <font color="#000080">:= </font>TicksSinceMidnight<font color="#000080">;
    </font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>ElapsedTicks <font color="#000080">&gt;= </font>TimerTicks<font color="#000080">) </font><font color="#FF0000"><b>THEN
      </b></font>ElapsedTicks <font color="#000080">:= </font>ElapsedTicks <font color="#000080">- </font>TimerTicks
    <font color="#FF0000"><b>ELSE      </b></font><font color="#008000"><i>{ Midnight rollover occurred }
      </i></font>ElapsedTicks <font color="#000080">:= </font>TicksPerDay <font color="#000080">- </font>TimerTicks <font color="#000080">+ </font>ElapsedTicks<font color="#000080">;
    </font>ElapsedSeconds <font color="#000080">:= </font>ROUND <font color="#000080">(</font>ElapsedTicks <font color="#000080">/ </font>TicksPerSecond<font color="#000080">);
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>FUNCTION </b></font>tTimerObject<font color="#000080">.</font>Expired <font color="#000080">: </font>BOOLEAN<font color="#000080">;  </font><font color="#008000"><i>{ Has this timer expired ?? }
  </i></font><font color="#FF0000"><b>BEGIN
  </b></font>Expired <font color="#000080">:= (</font>ElapsedSeconds <font color="#000080">&gt; </font>MaxSeconds<font color="#000080">);
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>FUNCTION </b></font>tTimerObject<font color="#000080">.</font>Remaining <font color="#000080">: </font>LONGINT<font color="#000080">;  </font><font color="#008000"><i>{ How many seconds remain? }
  </i></font><font color="#FF0000"><b>BEGIN
  IF </b></font>Expired <font color="#FF0000"><b>THEN </b></font>Remaining <font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>ELSE
     </b></font>Remaining <font color="#000080">:= </font>MaxSeconds <font color="#000080">- </font>ElapsedSeconds<font color="#000080">;
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>FUNCTION </b></font>tTimerObject<font color="#000080">.</font>PrintableTimer<font color="#000080">(</font>Tics <font color="#000080">: </font>LONGINT<font color="#000080">) : </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">;
  </font><font color="#008000"><i>{ return a printable time string }

    </i></font><font color="#FF0000"><b>VAR
      </b></font>S<font color="#000080">, </font>T <font color="#000080">: </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">;
      </font>Hour<font color="#000080">, </font>Min<font color="#000080">, </font>Sec<font color="#000080">, </font>Time <font color="#000080">: </font>LONGINT<font color="#000080">;
      </font>i <font color="#000080">: </font>INTEGER<font color="#000080">;

    </font><font color="#FF0000"><b>BEGIN
    </b></font>Hour <font color="#000080">:= (</font>Tics <font color="#FF0000"><b>div </b></font><font color="#800000">3600</font><font color="#000080">);
    </font>Min  <font color="#000080">:= (</font>Tics <font color="#FF0000"><b>div </b></font><font color="#800000">60</font><font color="#000080">);
    </font>Sec  <font color="#000080">:= </font>Tics <font color="#000080">- (</font>Min <font color="#000080">* </font><font color="#800000">60</font><font color="#000080">);
    </font>STR<font color="#000080">(</font>Min <font color="#000080">: </font><font color="#800000">2</font><font color="#000080">, </font>T<font color="#000080">);
    </font><font color="#FF0000"><b>IF </b></font>T<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">] = </font><font color="#800000">#32 </font><font color="#FF0000"><b>THEN </b></font>T<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">] := </font><font color="#800000">'0'</font><font color="#000080">;
    </font>S <font color="#000080">:= </font>T <font color="#000080">+ </font><font color="#800000">':'</font><font color="#000080">;
    </font>STR<font color="#000080">(</font>Sec <font color="#000080">: </font><font color="#800000">2</font><font color="#000080">, </font>T<font color="#000080">);
    </font><font color="#FF0000"><b>IF </b></font>T<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">] = </font><font color="#800000">#32 </font><font color="#FF0000"><b>THEN </b></font>T<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">] := </font><font color="#800000">'0'</font><font color="#000080">;
    </font>S <font color="#000080">:= </font>S <font color="#000080">+ </font>T<font color="#000080">;
    </font>PrintableTimer <font color="#000080">:= </font>S<font color="#000080">;
    </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">.

</font><font color="#008000"><i>{ ----------------------------   DEMO   ----------------------- }

</i></font><font color="#FF0000"><b>uses
  </b></font>CRT<font color="#000080">, </font>Timer<font color="#000080">;
</font><font color="#FF0000"><b>var
  </b></font>t <font color="#000080">: </font>tTimerObject<font color="#000080">;

</font><font color="#FF0000"><b>begin
  </b></font>ClrScr<font color="#000080">;
  </font>t<font color="#000080">.</font>Start<font color="#000080">(</font><font color="#800000">10</font><font color="#000080">);  </font><font color="#008000"><i>{ set a 10 second timer }
  </i></font>GoToXY<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">1</font><font color="#000080">); </font>Write<font color="#000080">(</font>t<font color="#000080">.</font>TimerTicks<font color="#000080">);
  </font><font color="#FF0000"><b>repeat
  </b></font>GoToXY<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">2</font><font color="#000080">); </font>Write<font color="#000080">(</font>t<font color="#000080">.</font>PrintableTimer<font color="#000080">(</font>t<font color="#000080">.</font>Remaining<font color="#000080">));
  </font>GoToXY<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">3</font><font color="#000080">); </font>Write<font color="#000080">(</font>t<font color="#000080">.</font>PrintableTimer<font color="#000080">(</font>t<font color="#000080">.</font>ElapsedSeconds<font color="#000080">));
  </font><font color="#FF0000"><b>until </b></font><font color="#000080">(</font>t<font color="#000080">.</font>Expired<font color="#000080">);  </font><font color="#008000"><i>{ wait until it expires }
  </i></font>Readkey<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to TIMING SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0021.PAS">Original</a><b>]</b></p></body>
</html>
