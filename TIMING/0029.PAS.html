<html>
<head><title> "Hardware Delay" by MAYNARD PHILBROOK</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to TIMING SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0029.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
&gt; Sometimes delay doesn't work in TP 7.0, I'm unsure what it's doing,
&gt; but if I have like: delay(10) it will not delay for ten milliseconds..
&gt; I don't have a sure fire way to reproduce this error, it just
&gt; happens  whenever it wants to.

sounds like you mite be running under windoz ?
Delay will malfunction at times if a multitasker or you have
redirected some interrupts for background events.. like the iNT $08
for example..
I not sure how TP 7.0 does it but TP 6.0 uses a software loop..
you could use the timer 2 for a delay if you not use sound at the time.
if you use the PC speaker then poll timer 0..  it you leave timer 0 set
to its standard then its simple.
}

</i></font><font color="#FF0000"><b>procedure </b></font>HardWareDelay<font color="#000080">( </font>Time <font color="#000080">:</font>word<font color="#000080">); </font><font color="#008000"><i>{ time in Millisecs }
</i></font><font color="#FF0000"><b>Var
 </b></font>CompVar<font color="#000080">, </font>LastReading<font color="#000080">:</font>Word<font color="#000080">;
 </font><font color="#FF0000"><b>Begin
   </b></font>CompVar <font color="#000080">:= (</font>Time <font color="#000080">/ </font><font color="#800000">0.00000083</font><font color="#000080">);
 </font><font color="#FF0000"><b>asm
  </b></font><font color="#FF00FF">CLI;
  Mov AL, $36;
  out $43, AL;
  in AL , $40;
  Mov Byte Ptr LastReading, AL;
  In AL, $40;
  Mov Byte Ptr lastReading+1, AL;
 @L:
  CLI;
  Mov AL, $36;
  out $43, AL;
  in AL, $40;
  Mov BL, AL;
  in Al, $40;
  STI;
  Mov BH, Al;
  Mov AX, lastReading;
  Sub BX, AX;
  Cmp BX, CompVar
  Jb @l;
  Sti;
 </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to TIMING SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0029.PAS">Original</a><b>]</b></p></body>
</html>
