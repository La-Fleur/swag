<html>
<head><title> "Hi resolution Delay number of seconds" by SWAG SUPPORT TEAM</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to TIMING SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0028.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#000000"> <font color="#008000"><i>(*****************    W A I T   *************************
 * Delays NumberOfSecs seconds.  This is done by         *
 * accessing the PC clock via function $2C of DOS int    *
 * 21h.  Its accuracy is limited by the fact that the    *
 * time is calculated from the ROM BIOS tick count,      *
 * which is updated only about 18.2 times per second.    *
 * This means that Wait will be accurate to about        *
 * 1/18 second.                                          *
 *                                                       *
 * Requires &quot;Uses DOS&quot; if in TP4 or TP5                  *
 ******************    W A I T   ************************)

  </i></font><font color="#FF0000"><b>uses </b></font>dos<font color="#000080">, </font>TpCrt<font color="#000080">, </font>TpString<font color="#000080">;

  </font><font color="#FF0000"><b>var
    </b></font>p_cnt <font color="#000080">: </font>integer<font color="#000080">;
    </font>s     <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">[</font><font color="#800000">5</font><font color="#000080">];
    </font>sr    <font color="#000080">: </font>real<font color="#000080">;
    </font>okay  <font color="#000080">: </font>boolean<font color="#000080">;
    </font>ch    <font color="#000080">: </font>char<font color="#000080">;


  </font><font color="#FF0000"><b>PROCEDURE </b></font>Wait<font color="#000080">(</font>NumberOfSecs <font color="#000080">: </font>Real<font color="#000080">);
  </font><font color="#FF0000"><b>CONST
    </b></font>Secs_PER_DAY <font color="#000080">= </font><font color="#800000">86400.0</font><font color="#000080">; </font><font color="#008000"><i>{60 * 60 * 24}
  </i></font><font color="#FF0000"><b>VAR
    </b></font>TimeIsUp <font color="#000080">: </font>Boolean<font color="#000080">;
    </font>StartingSecs<font color="#000080">,
    </font>Secs <font color="#000080">: </font>Real<font color="#000080">;

    </font><font color="#008000"><i>(******************   READ CLOCK  ************************
    *                                                        *
    *  Reads the PC clock, by using service $2C of int 21h.  *
    *  This service returns information in the 8088          *
    *  registers as follows:                                 *
    *                                                        *
    *    CH      Hour                  (0 through 23)        *
    *    CL      Minute                (0 through 59)        *
    *    DH      Seconds               (0 through 59)        *
    *    DL      Hundredths of seconds (0 through 99)        *
    *******************   READ CLOCK  ***********************)

    </i></font><font color="#FF0000"><b>PROCEDURE </b></font>ReadClock<font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>Secs <font color="#000080">: </font>Real<font color="#000080">);

    </font><font color="#FF0000"><b>CONST
      </b></font>Secs_PER_HOUR <font color="#000080">= </font><font color="#800000">3600.0</font><font color="#000080">; </font><font color="#008000"><i>{This must be a real constant!}
      </i></font>Secs_PER_MINUTE <font color="#000080">= </font><font color="#800000">60.0</font><font color="#000080">;
</font><font color="#008000"><i>(*  TYPE {Delete this type for TP4 and TP5}
      Registers = RECORD
        CASE Boolean OF
          True : (AL,AH,BL,BH,CL,CH,DL,DH:Byte);
          False : (AX,BX,CX,DX,BP,SI,DI,DS,ES,Flags:Integer)
        END;  *)
    </i></font><font color="#FF0000"><b>VAR </b></font>Regs <font color="#000080">: </font>Registers<font color="#000080">;
    </font><font color="#FF0000"><b>BEGIN
      </b></font>Regs<font color="#000080">.</font>AH <font color="#000080">:= </font><font color="#800000">$2C</font><font color="#000080">;
      </font>msDos<font color="#000080">(</font>Regs<font color="#000080">);
      </font>Secs <font color="#000080">:= </font>Secs_PER_HOUR<font color="#000080">*(</font>Regs<font color="#000080">.</font>CH<font color="#000080">)
                +</font>Secs_PER_MINUTE<font color="#000080">*(</font>Regs<font color="#000080">.</font>CL<font color="#000080">)
                +</font>Regs<font color="#000080">.</font>DH
                <font color="#000080">+</font><font color="#800000">0.01</font><font color="#000080">*</font>Regs<font color="#000080">.</font>DL<font color="#000080">;
    </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#008000"><i>{ BODY OF WAIT procedure}

  </i></font><font color="#FF0000"><b>BEGIN
    </b></font>ReadClock<font color="#000080">(</font>StartingSecs<font color="#000080">);
    </font><font color="#FF0000"><b>REPEAT                                  </b></font><font color="#008000"><i>{ allow break out }
      </i></font><font color="#FF0000"><b>if </b></font>KeyPressed <font color="#FF0000"><b>then begin
                           </b></font>ch <font color="#000080">:= </font>ReadKey<font color="#000080">;   </font><font color="#008000"><i>{ eat the key }
                           </i></font>Halt<font color="#000080">;
                         </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font>ReadClock<font color="#000080">(</font>Secs<font color="#000080">);
      </font><font color="#FF0000"><b>IF </b></font>Secs<font color="#000080">-</font>StartingSecs <font color="#000080">&gt;= </font><font color="#800000">0.0 </font><font color="#FF0000"><b>THEN </b></font><font color="#008000"><i>{Normal situation.}
        </i></font>TimeIsUp <font color="#000080">:= </font>Secs<font color="#000080">-</font>StartingSecs <font color="#000080">&gt;= </font>NumberOfSecs
      <font color="#FF0000"><b>ELSE </b></font><font color="#008000"><i>{During call, clock has ticked past midnight.}
        </i></font>TimeIsUp <font color="#000080">:= </font>Secs_PER_DAY<font color="#000080">-</font>StartingSecs<font color="#000080">+</font>Secs <font color="#000080">&gt;= </font>NumberOfSecs
    <font color="#FF0000"><b>UNTIL </b></font>TimeIsUp
  <font color="#FF0000"><b>END</b></font><font color="#000080">;


</font><font color="#008000"><i>{  M _ A _ I _ N  }

  </i></font><font color="#FF0000"><b>begin

    </b></font>p_cnt <font color="#000080">:= </font>paramcount<font color="#000080">;
    </font><font color="#FF0000"><b>if </b></font>p_cnt <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>then begin
      </b></font>writeln<font color="#000080">(</font><font color="#800000">'WAIT - a utility to wait a set number of seconds.'</font><font color="#000080">);
      </font>writeln<font color="#000080">(</font><font color="#800000">'     - Is machine speed independent because it uses dos int 21h, function $2C.'</font><font color="#000080">);
      </font>writeln<font color="#000080">(</font><font color="#800000">'     - can wait up to a whole day with a count of 86400.'</font><font color="#000080">);
      </font>writeln<font color="#000080">(</font><font color="#800000">'     - can be interupted at any time by pressing a keyboard key.'</font><font color="#000080">);
      </font>writeln<font color="#000080">(</font><font color="#800000">'     - needs a command line argument of number of seconds to wait.'</font><font color="#000080">);
      </font>writeln<font color="#000080">(</font><font color="#800000">'     - IE. &quot;wait 300&quot; would wait for 5 minutes and then continue.'</font><font color="#000080">);
      </font>halt<font color="#000080">;
    </font><font color="#FF0000"><b>end else begin
      </b></font>s <font color="#000080">:= </font>paramstr<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">);
      </font>okay <font color="#000080">:= </font>false<font color="#000080">;
      </font>okay <font color="#000080">:= </font>Str2Real<font color="#000080">(</font>s<font color="#000080">, </font>sr<font color="#000080">);
      </font><font color="#FF0000"><b>if </b></font>okay <font color="#FF0000"><b>then begin
        </b></font>writeln<font color="#000080">(</font><font color="#800000">'WAIT - is now running for '</font><font color="#000080">, </font>s <font color="#000080">,</font><font color="#800000">' seconds.'</font><font color="#000080">);
        </font>wait<font color="#000080">(</font>sr<font color="#000080">);
      </font><font color="#FF0000"><b>end else
        </b></font>writeln<font color="#000080">(</font><font color="#800000">'WAIT - could not run because the parameter was invalid.'</font><font color="#000080">);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>end</b></font><font color="#000080">.


</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to TIMING SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0028.PAS">Original</a><b>]</b></p></body>
</html>
