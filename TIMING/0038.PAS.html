<html>
<head><title> "Re: seconds since midnight" by BRIAN PETERSEN</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to TIMING SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0038.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
I tried this but the two (my original procedure and your code) produce
slightly different values.  Compile this and run in DOS:
}
</i></font><font color="#FF0000"><b>uses </b></font>dos<font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>timer<font color="#000080">:</font>real<font color="#000080">;
</font><font color="#FF0000"><b>var </b></font>r<font color="#000080">:</font>registers<font color="#000080">; </font>h<font color="#000080">,</font>m<font color="#000080">,</font>s<font color="#000080">,</font>t<font color="#000080">:</font>real<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>r<font color="#000080">.</font>ax<font color="#000080">:=</font><font color="#800000">44</font><font color="#000080">*</font><font color="#800000">256</font><font color="#000080">;
  </font>msdos<font color="#000080">(</font>dos<font color="#000080">.</font>registers<font color="#000080">(</font>r<font color="#000080">));
  </font>h<font color="#000080">:=(</font>r<font color="#000080">.</font>cx <font color="#FF0000"><b>div </b></font><font color="#800000">256</font><font color="#000080">);
  </font>m<font color="#000080">:=(</font>r<font color="#000080">.</font>cx <font color="#FF0000"><b>mod </b></font><font color="#800000">256</font><font color="#000080">);
  </font>s<font color="#000080">:=(</font>r<font color="#000080">.</font>dx <font color="#FF0000"><b>div </b></font><font color="#800000">256</font><font color="#000080">);
  </font>t<font color="#000080">:=(</font>r<font color="#000080">.</font>dx <font color="#FF0000"><b>mod </b></font><font color="#800000">256</font><font color="#000080">);
  </font>timer<font color="#000080">:=</font>h<font color="#000080">*</font><font color="#800000">3600</font><font color="#000080">+</font>m<font color="#000080">*</font><font color="#800000">60</font><font color="#000080">+</font>s<font color="#000080">+</font>t<font color="#000080">/</font><font color="#800000">100</font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>timer2<font color="#000080">:</font>real<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>timer2<font color="#000080">:=</font>meml<font color="#000080">[</font><font color="#800000">$0040</font><font color="#000080">:</font><font color="#800000">$006c</font><font color="#000080">]/</font><font color="#800000">18.2</font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>begin
  </b></font>write<font color="#000080">(^</font>M<font color="#000080">^</font>J<font color="#800000">'Ctrl-Break to Quit'</font><font color="#000080">^</font>M<font color="#000080">^</font>J<font color="#000080">^</font>M<font color="#000080">^</font>J<font color="#000080">+
        </font><font color="#800000">'Int 21h Version  $0040:$006C Version'</font><font color="#000080">^</font>M<font color="#000080">^</font>J<font color="#000080">+
        </font><font color="#800000">'---------------  -------------------'</font><font color="#000080">^</font>M<font color="#000080">^</font>J<font color="#000080">);
  </font><font color="#FF0000"><b>repeat
    </b></font>write<font color="#000080">(</font>timer2<font color="#000080">:</font><font color="#800000">3</font><font color="#000080">:</font><font color="#800000">5</font><font color="#000080">,</font><font color="#800000">'      '</font><font color="#000080">,</font>timer<font color="#000080">:</font><font color="#800000">3</font><font color="#000080">:</font><font color="#800000">5</font><font color="#000080">,^</font>M<font color="#000080">);
  </font><font color="#FF0000"><b>until </b></font>false<font color="#000080">=</font>true<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">.

... </font><font color="#FF0000"><b>and </b></font>tell me <font color="#FF0000"><b>if </b></font>you notice the difference <font color="#FF0000"><b>as </b></font>well<font color="#000080">.  </font>I tried swapping
the timer <font color="#FF0000"><b>and </b></font>timer2 positions <font color="#FF0000"><b>in </b></font>the write<font color="#000080">() </font><font color="#FF0000"><b>function to </b></font>see <font color="#FF0000"><b>if </b></font>it was
just the difference between the time the two functions are executed <font color="#FF0000"><b>and
</b></font>it was <font color="#FF0000"><b>not </b></font>caused by that<font color="#000080">.

</font>brian<font color="#000080">.</font>petersen<font color="#000080">@</font><font color="#800000">604.</font>sasbbs<font color="#000080">.</font>com

<font color="#008000"><i>{
 BP&gt; Could someone please convert this to BASM?  It returns the number of
 BP&gt; seconds since midnight in the form of a real variable.

 BP&gt; function timer:real;
 BP&gt; var r:registers; h,m,s,t:real;
 BP&gt; begin
 BP&gt;   r.ax:=$2c00;
 BP&gt;   msdos(r);
 BP&gt;   h:=(r.cx div 256);
 BP&gt;   m:=(r.cx mod 256);
 BP&gt;   s:=(r.dx div 256);
 BP&gt;   t:=(r.dx mod 256);
 BP&gt;   timer:=h*3600+m*60+s+t/100;
 BP&gt; end;
}
</i></font>I think<font color="#000080">, </font>that<font color="#800000">'s the way it should be optimized (and corrected). Everything
</font><font color="#FF0000"><b>else </b></font>would be overkill<font color="#000080">:
    </font><font color="#FF0000"><b>function </b></font>timer<font color="#000080">:</font>longint<font color="#000080">;
    </font><font color="#008000"><i>{ returns number of 1/100 s since midnight }
    </i></font><font color="#FF0000"><b>var </b></font>dostime<font color="#000080">:</font><font color="#FF0000"><b>record </b></font>t<font color="#000080">,</font>s<font color="#000080">,</font>m<font color="#000080">,</font>h<font color="#000080">:</font>byte <font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>begin
      asm
        </b></font><font color="#FF00FF">mov ax, 2c00h
        int 21h
        mov word ptr dostime.m, cx
        mov word ptr dostime.t, dx
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>with </b></font>dostime <font color="#FF0000"><b>do
        </b></font>timer<font color="#000080">:=(</font>longint<font color="#000080">(</font>h<font color="#000080">*</font><font color="#800000">60</font><font color="#000080">+</font>m<font color="#000080">)*</font><font color="#800000">60</font><font color="#000080">+</font>s<font color="#000080">)*</font><font color="#800000">100</font><font color="#000080">+</font>t
    <font color="#FF0000"><b>end</b></font><font color="#000080">;

</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to TIMING SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0038.PAS">Original</a><b>]</b></p></body>
</html>
