<html>
<head><title> "Calculate Program Time" by SWAG SUPPORT TEAM</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to TIMING SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0005.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{ SB&gt; Has anyone by any chance written a Procedure For calculating the amount
 SB&gt; of time a Program runs.  I understand how to use getTime, etc, but I am
 SB&gt; trying to figure out a way around all the possibilities...i.e. someone
 SB&gt; starts a Program at 23:59:03.44, and it's finished at 00:02:05.33.
 SB&gt;
 SB&gt; Anyway, if someone already has this figured out, I'd sure appreciate it
 SB&gt; or even some ideas...

Scott,
    try:

    Var
        Timer : LongInt Absolute $0040:$006c;

    That's the Tic counter, stored at Segment 0040h, offset 006Ch. It
stores the number of ticks since you turned the Computer on and so will
only wrap after MorE THAN 3 YEARS, if you never close the machine ;-)

    it is incremented 18.2 times/sec, so divide it by 18.2 to get the
number of seconds. You can figure out the rest ;-)

    Store its content to another LongInt at the start of the Program,
again at the end. Substract the first value from the second and you have
the number of ticks elapsed during the Program's execution.

Oh what the heck, here is a Complete Unit, all you have to do is include
it in your Uses clause nothing more unless you want to save the time in
a log File or something.
}

{$A+,B-,D+,E-,F+,G+,I-,L+,N-,O+,P+,Q-,R-,S-,T-,V-,X+,Y+}
{$M 8192,0,0}
</i></font><font color="#FF0000"><b>Unit </b></font>TimePrg<font color="#000080">;
</font><font color="#008000"><i>(**) </i></font><font color="#FF0000"><b>Interface </b></font><font color="#008000"><i>(**)
(**) </i></font><font color="#FF0000"><b>Implementation </b></font><font color="#008000"><i>(**)
</i></font><font color="#FF0000"><b>Uses
  </b></font>Dos<font color="#000080">;
</font><font color="#FF0000"><b>Type
  </b></font>CmdLine <font color="#000080">= </font><font color="#FF0000"><b>String</b></font><font color="#000080">[</font><font color="#800000">127</font><font color="#000080">];
</font><font color="#FF0000"><b>Var
  </b></font>TimerTicks <font color="#000080">: </font>LongInt <font color="#FF0000"><b>Absolute </b></font><font color="#800000">$0040</font><font color="#000080">:</font><font color="#800000">$006C</font><font color="#000080">;
  </font>OldCommandLine<font color="#000080">, </font>NewCommandline <font color="#000080">: </font>CmdLine<font color="#000080">;
  </font>CommandLine <font color="#000080">: ^</font>CmdLine<font color="#000080">;
  </font>TimeIn<font color="#000080">, </font>TimeOut<font color="#000080">, </font>Spent <font color="#000080">: </font>LongInt<font color="#000080">;
  </font>Years<font color="#000080">, </font>Days<font color="#000080">, </font>Hours<font color="#000080">, </font>Minutes<font color="#000080">, </font>Seconds<font color="#000080">, </font>ms <font color="#000080">: </font>Byte<font color="#000080">;
  </font>ExitBeForeTimePrg <font color="#000080">: </font>Pointer<font color="#000080">;
  </font>D <font color="#000080">: </font>DirStr<font color="#000080">;
  </font>N <font color="#000080">: </font>NameStr<font color="#000080">;
  </font>E <font color="#000080">: </font>ExtStr<font color="#000080">;
  </font>Index <font color="#000080">: </font>Integer<font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>Strfunc<font color="#000080">(</font>Value<font color="#000080">:</font>Byte<font color="#000080">):</font><font color="#FF0000"><b>String</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Var
  </b></font>temp <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>Str<font color="#000080">(</font>Value<font color="#000080">:</font><font color="#800000">0</font><font color="#000080">, </font>Temp<font color="#000080">);
  </font>StrFunc <font color="#000080">:= </font><font color="#800000">#32</font><font color="#000080">+</font>temp<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>TimePrgExit<font color="#000080">; </font><font color="#FF0000"><b>Far</b></font><font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>TimeOut <font color="#000080">:= </font>TimerTicks<font color="#000080">;
  </font>ExitProc <font color="#000080">:= </font>ExitBeForeTimePrg<font color="#000080">;
  </font>Spent <font color="#000080">:= </font>TimeOut <font color="#000080">- </font>TimeIn<font color="#000080">;
  </font>ms <font color="#000080">:= (</font>Spent <font color="#000080">- </font>trunc<font color="#000080">(</font>Spent <font color="#000080">/ </font><font color="#800000">18.2</font><font color="#000080">))*</font><font color="#800000">55</font><font color="#000080">;
  </font>Spent <font color="#000080">:= </font>Trunc<font color="#000080">(</font>Spent <font color="#000080">/ </font><font color="#800000">18.2</font><font color="#000080">);
  </font>Years <font color="#000080">:= </font>Spent <font color="#FF0000"><b>div </b></font><font color="#000080">(</font><font color="#800000">3600</font><font color="#000080">*</font><font color="#800000">24</font><font color="#000080">*</font><font color="#800000">365</font><font color="#000080">);
  </font>Spent <font color="#000080">:= </font>Spent <font color="#FF0000"><b>mod </b></font><font color="#000080">(</font><font color="#800000">3600</font><font color="#000080">*</font><font color="#800000">24</font><font color="#000080">*</font><font color="#800000">365</font><font color="#000080">);
  </font>Days <font color="#000080">:= </font>Spent <font color="#FF0000"><b>div </b></font><font color="#000080">(</font><font color="#800000">3600</font><font color="#000080">*</font><font color="#800000">24</font><font color="#000080">);
  </font>Spent <font color="#000080">:= </font>Spent <font color="#FF0000"><b>mod </b></font><font color="#000080">(</font><font color="#800000">3600</font><font color="#000080">*</font><font color="#800000">24</font><font color="#000080">);
  </font>Hours <font color="#000080">:= </font>Spent <font color="#FF0000"><b>div </b></font><font color="#800000">3600</font><font color="#000080">;
  </font>Spent <font color="#000080">:= </font>Spent <font color="#FF0000"><b>mod </b></font><font color="#800000">3600</font><font color="#000080">;
  </font>Minutes <font color="#000080">:= </font>Spent <font color="#FF0000"><b>div </b></font><font color="#800000">60</font><font color="#000080">;
  </font>Spent <font color="#000080">:= </font>Spent <font color="#FF0000"><b>mod </b></font><font color="#800000">60</font><font color="#000080">;
  </font>Seconds <font color="#000080">:= </font>Spent<font color="#000080">;
  </font>CommandLine <font color="#000080">:= </font>Ptr<font color="#000080">(</font>PrefixSeg<font color="#000080">, </font><font color="#800000">$80</font><font color="#000080">);
  </font>OldCommandLine <font color="#000080">:= </font>CommandLine<font color="#000080">^;
  </font>NewCommandLine <font color="#000080">:= </font><font color="#800000">''</font><font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font>Years<font color="#000080">&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>then
    </b></font>NewCommandLine <font color="#000080">:= </font>NewCommandLine <font color="#000080">+ </font>Strfunc<font color="#000080">(</font>Years<font color="#000080">) + </font><font color="#800000">' Years'</font><font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font>Days<font color="#000080">&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>then
    </b></font>NewCommandLine <font color="#000080">:= </font>NewCommandLine <font color="#000080">+ </font>Strfunc<font color="#000080">(</font>Days<font color="#000080">) + </font><font color="#800000">' Days'</font><font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font>Hours<font color="#000080">&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>then
    </b></font>NewCommandLine <font color="#000080">:= </font>NewCommandLine <font color="#000080">+ </font>Strfunc<font color="#000080">(</font>Hours<font color="#000080">) + </font><font color="#800000">' Hours'</font><font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font>Minutes<font color="#000080">&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>then
    </b></font>NewCommandLine <font color="#000080">:= </font>NewCommandLine <font color="#000080">+ </font>Strfunc<font color="#000080">(</font>Minutes<font color="#000080">) + </font><font color="#800000">' Minutes'</font><font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font>Seconds<font color="#000080">&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>then
    </b></font>NewCommandLine <font color="#000080">:= </font>NewCommandLine <font color="#000080">+ </font>Strfunc<font color="#000080">(</font>Seconds<font color="#000080">)        + </font><font color="#800000">' Seconds'</font><font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font>ms<font color="#000080">&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>then
    </b></font>NewCommandLine <font color="#000080">:= </font>NewCommandLine <font color="#000080">+ </font>Strfunc<font color="#000080">(</font>ms<font color="#000080">) + </font><font color="#800000">' milli-seconds'</font><font color="#000080">;
  </font>CommandLine<font color="#000080">^ := </font>NewCommandLine<font color="#000080">;
  </font>Write<font color="#000080">(</font><font color="#800000">'Thanks For spending '</font><font color="#000080">);
  </font><font color="#FF0000"><b>Case </b></font>Paramcount <font color="#FF0000"><b>of
    </b></font><font color="#800000">0</font><font color="#000080">: </font>Write<font color="#000080">(</font><font color="#800000">'so little time'</font><font color="#000080">);
    </font><font color="#800000">2</font><font color="#000080">: </font>Write<font color="#000080">(</font>ParamStr<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">),</font><font color="#800000">#32</font><font color="#000080">, </font>Paramstr<font color="#000080">(</font><font color="#800000">2</font><font color="#000080">));
  </font><font color="#FF0000"><b>else
    For </b></font>Index <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>ParamCount <font color="#000080">- </font><font color="#800000">3 </font><font color="#FF0000"><b>do begin
      </b></font>Write<font color="#000080">(</font>Paramstr<font color="#000080">(</font>Index<font color="#000080">));
      </font><font color="#FF0000"><b>if </b></font>odd<font color="#000080">(</font>Index<font color="#000080">) </font><font color="#FF0000"><b>then
        </b></font>Write<font color="#000080">(</font><font color="#800000">' '</font><font color="#000080">)
      </font><font color="#FF0000"><b>else
        </b></font>Write<font color="#000080">(</font><font color="#800000">', '</font><font color="#000080">);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font>Write<font color="#000080">(</font>Paramstr<font color="#000080">(</font>Index<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">), </font><font color="#800000">' and '</font><font color="#000080">,
    </font>Paramstr<font color="#000080">(</font>Index<font color="#000080">+</font><font color="#800000">2</font><font color="#000080">), </font><font color="#800000">' '</font><font color="#000080">, </font>Paramstr<font color="#000080">(</font>Index<font color="#000080">+</font><font color="#800000">3</font><font color="#000080">));
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>CommandLine<font color="#000080">^ := </font>OldCommandLine<font color="#000080">;
  </font>Fsplit<font color="#000080">(</font>Paramstr<font color="#000080">(</font><font color="#800000">0</font><font color="#000080">), </font>D<font color="#000080">, </font>N<font color="#000080">, </font>E<font color="#000080">);
  </font>Writeln<font color="#000080">(</font><font color="#800000">' In '</font><font color="#000080">, </font>N<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>begin
  </b></font>TimeIn <font color="#000080">:= </font>TimerTicks<font color="#000080">;
  </font>ExitBeForeTimePrg <font color="#000080">:= </font>ExitProc<font color="#000080">;
  </font>ExitProc <font color="#000080">:= @</font>TimePrgExit<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to TIMING SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0005.PAS">Original</a><b>]</b></p></body>
</html>
