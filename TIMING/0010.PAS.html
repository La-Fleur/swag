<html>
<head><title> "Controling DOS Timer" by DAVID DAHL</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to TIMING SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0010.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
DAVID DAHL

I never posted it as a Unit.  I just posted a couple routines to set the
timer.  They're actually a part of another, larger project I've been working
on to play digitized Sound out of several different output devices.  When I
was asked if it were possible to speed up the tick and still have Dos's timer
Function behave normally, I threw them into a Unit and wrote the Program you
quoted from to illustrate how it would be done.  Here are the timer routines
as a Unit:

The routines perform no error checking on input values, so be careful
with them.  The Procedure Set8253Channel should never have a
channel value of more than 2 since the 8253 only has 3 channels
(0 - 2).
}

</i></font><font color="#FF0000"><b>Unit </b></font>C8253<font color="#000080">;

</font><font color="#008000"><i>(* PUBLIC DOMAIN *)

</i></font><font color="#FF0000"><b>Interface

Procedure </b></font>SetPlaySpeed<font color="#000080">(</font>Speed <font color="#000080">: </font>LongInt<font color="#000080">);
</font><font color="#FF0000"><b>Procedure </b></font>SetDefaultTimerSpeed<font color="#000080">;
</font><font color="#FF0000"><b>Procedure </b></font>Set8253Channel<font color="#000080">(</font>ChannelNumber <font color="#000080">: </font>Byte<font color="#000080">; </font>ProgramValue  <font color="#000080">: </font>Word<font color="#000080">);

</font><font color="#FF0000"><b>Implementation

Const
  </b></font>C8253ModeControl   <font color="#000080">= </font><font color="#800000">$43</font><font color="#000080">;
  </font>C8253OperatingFreq <font color="#000080">= </font><font color="#800000">1193180</font><font color="#000080">;
  </font>C8253Channel <font color="#000080">: </font><font color="#FF0000"><b>Array </b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">2</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Byte <font color="#000080">= (</font><font color="#800000">$40</font><font color="#000080">, </font><font color="#800000">$41</font><font color="#000080">, </font><font color="#800000">$42</font><font color="#000080">);

</font><font color="#008000"><i>{=[ 8253 Timer Programming Routines ]=====================================}
</i></font><font color="#FF0000"><b>Procedure </b></font>Set8253Channel<font color="#000080">(</font>ChannelNumber <font color="#000080">: </font>Byte<font color="#000080">; </font>ProgramValue  <font color="#000080">: </font>Word<font color="#000080">);
</font><font color="#FF0000"><b>begin
  </b></font>Port<font color="#000080">[</font>C8253ModeControl<font color="#000080">] := </font><font color="#800000">54 </font><font color="#FF0000"><b>or </b></font><font color="#000080">(</font>ChannelNumber <font color="#FF0000"><b>SHL </b></font><font color="#800000">6</font><font color="#000080">); </font><font color="#008000"><i>{ XX110110 }
  </i></font>Port<font color="#000080">[</font>C8253Channel<font color="#000080">[</font>ChannelNumber<font color="#000080">]] := </font>Lo<font color="#000080">(</font>ProgramValue<font color="#000080">);
  </font>Port<font color="#000080">[</font>C8253Channel<font color="#000080">[</font>ChannelNumber<font color="#000080">]] := </font>Hi<font color="#000080">(</font>ProgramValue<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#008000"><i>{-[ Set Clock Channel 0 (INT 8, IRQ 0) To Input Speed ]-------------------}
</i></font><font color="#FF0000"><b>Procedure </b></font>SetPlaySpeed <font color="#000080">(</font>Speed <font color="#000080">: </font>LongInt<font color="#000080">);
</font><font color="#FF0000"><b>Var
  </b></font>ProgramValue <font color="#000080">: </font>Word<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>ProgramValue <font color="#000080">:= </font>C8253OperatingFreq <font color="#FF0000"><b>div </b></font>Speed<font color="#000080">;
  </font>Set8253Channel<font color="#000080">(</font><font color="#800000">0</font><font color="#000080">, </font>ProgramValue<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#008000"><i>{-[ Set Clock Channel 0 Back To 18.2 Default Value ]----------------------}
</i></font><font color="#FF0000"><b>Procedure </b></font>SetDefaultTimerSpeed<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>Set8253Channel <font color="#000080">(</font><font color="#800000">0</font><font color="#000080">, </font><font color="#800000">0</font><font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>end</b></font><font color="#000080">.


</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to TIMING SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0010.PAS">Original</a><b>]</b></p></body>
</html>
