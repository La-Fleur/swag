<html>
<head><title> "Timing Unit" by CHRIS BOYD</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to TIMING SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0014.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
&gt; Now what I want to do is calculate the total run-time of the overall
&gt; event, from start to finish, i.e., parse the log file taking the last and
&gt; first time entries and calculate the time. I'm sure there is an easier way
&gt; to do this but I'm new to Pascal, and, open to suggestions.  Below is what
&gt; appears in the event.log :
}

</i></font><font color="#FF0000"><b>Unit </b></font>Timer<font color="#000080">;

</font><font color="#008000"><i>{       SIMPLE TIMER 1.0
        =================

 This is a Timer unit, it calculates time by system clock.  A few limitations
 are:

   1) Must not modify clock.
   2) Must not time more than a day
   3) Must StopTimer before displaying Time

   Usage:

      StartTimer;   Starts Timer
      StopTimer;    Stops Timer
      CalcTimer;    Calculates time
      DispTime:     Displays time between StartTimer and StopTimer,
                    you don't need to call CalcTimer if you call DispTime.

 This unit may be used in freeware and shareware programs as long as:

   1) The program is a DECENT program, no &quot;Adult&quot; or &quot;XXX&quot; type programs
      shall lawfully contain any code found within this file (modified or
      in original form) or this file after it's been compiled.

   2) This copyrighting is not added to, or removed from the program by
      any other person other than I, the author.

 This is copyrighted but may be used or modified in programs as long as the
 above conditions are followed.

 I may be reached at:

   1:130/709                              - Fidonet
   Chris.Boyd@f709.n130.z1.fidonet.org    - Internet
   Alpha Zeta, Ft. Worth (817) 246-3058   - Bulletin Board

 If you have any comments or suggestions (not complaints).  I assume no
 responsibility for anything resulting from the usage of this code.

                                                   -Chris Boyd

}

</i></font><font color="#FF0000"><b>Interface

Uses
  </b></font>Dos<font color="#000080">;

</font><font color="#FF0000"><b>Type
  </b></font>TimeStruct <font color="#000080">= </font><font color="#FF0000"><b>record
    </b></font>Hour<font color="#000080">,
    </font>Minute<font color="#000080">,
    </font>Second<font color="#000080">,
    </font>S100   <font color="#000080">: </font>Word<font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Var
  </b></font>StartT<font color="#000080">,
  </font>StopT<font color="#000080">,
  </font>TimeT   <font color="#000080">: </font>TimeStruct<font color="#000080">;
  </font>Stopped <font color="#000080">: </font>Boolean<font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>StartTimer<font color="#000080">;
</font><font color="#FF0000"><b>procedure </b></font>StopTimer<font color="#000080">;
</font><font color="#FF0000"><b>procedure </b></font>DispTime<font color="#000080">;
</font><font color="#FF0000"><b>procedure </b></font>CalcTimer<font color="#000080">;

</font><font color="#FF0000"><b>Implementation

procedure </b></font>TimerError<font color="#000080">(</font>Err <font color="#000080">: </font>Byte<font color="#000080">);
</font><font color="#FF0000"><b>Begin
  Case </b></font>Err <font color="#FF0000"><b>of
    </b></font><font color="#800000">1 </font><font color="#000080">:
    </font><font color="#FF0000"><b>Begin
      </b></font>Writeln<font color="#000080">(</font><font color="#800000">' Error: Must Use StartTimer before StopTimer'</font><font color="#000080">);
      </font>Halt<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">);
    </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

    </font><font color="#800000">2 </font><font color="#000080">:
    </font><font color="#FF0000"><b>Begin
      </b></font>Writeln<font color="#000080">(</font><font color="#800000">' Error: Timer can not handle change of day'</font><font color="#000080">);
      </font>Halt<font color="#000080">(</font><font color="#800000">2</font><font color="#000080">);
    </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

    </font><font color="#800000">3 </font><font color="#000080">:
    </font><font color="#FF0000"><b>Begin
      </b></font>Writeln<font color="#000080">(</font><font color="#800000">' Error: Internal - Must StopTimer before DispTime'</font><font color="#000080">);
      </font>Halt<font color="#000080">(</font><font color="#800000">3</font><font color="#000080">);
    </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>CalcTimer<font color="#000080">;
</font><font color="#FF0000"><b>Begin
  If </b></font><font color="#000080">(</font>Stopped <font color="#000080">= </font>True<font color="#000080">) </font><font color="#FF0000"><b>Then
  Begin
    If </b></font><font color="#000080">(</font>StopT<font color="#000080">.</font>Hour <font color="#000080">&lt; </font>StartT<font color="#000080">.</font>Hour<font color="#000080">) </font><font color="#FF0000"><b>Then
      </b></font>TimerError<font color="#000080">(</font><font color="#800000">2</font><font color="#000080">);
    </font>TimeT<font color="#000080">.</font>Hour <font color="#000080">:= </font>StopT<font color="#000080">.</font>Hour <font color="#000080">- </font>StartT<font color="#000080">.</font>Hour<font color="#000080">;

    </font><font color="#FF0000"><b>If </b></font><font color="#000080">(</font>StopT<font color="#000080">.</font>Minute <font color="#000080">&lt; </font>StartT<font color="#000080">.</font>Minute<font color="#000080">) </font><font color="#FF0000"><b>Then
    Begin
      </b></font>TimeT<font color="#000080">.</font>Hour   <font color="#000080">:= </font>TimeT<font color="#000080">.</font>Hour <font color="#000080">- </font><font color="#800000">1</font><font color="#000080">;
      </font>StopT<font color="#000080">.</font>Minute <font color="#000080">:= </font>StopT<font color="#000080">.</font>Minute <font color="#000080">+ </font><font color="#800000">60</font><font color="#000080">;
    </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
    </font>TimeT<font color="#000080">.</font>Minute <font color="#000080">:= </font>StopT<font color="#000080">.</font>Minute <font color="#000080">- </font>StartT<font color="#000080">.</font>Minute<font color="#000080">;

    </font><font color="#FF0000"><b>If </b></font><font color="#000080">(</font>StopT<font color="#000080">.</font>Second <font color="#000080">&lt; </font>StartT<font color="#000080">.</font>Second<font color="#000080">) </font><font color="#FF0000"><b>Then
    Begin
      </b></font>TimeT<font color="#000080">.</font>Minute <font color="#000080">:= </font>TimeT<font color="#000080">.</font>Minute <font color="#000080">- </font><font color="#800000">1</font><font color="#000080">;
      </font>StopT<font color="#000080">.</font>Second <font color="#000080">:= </font>StopT<font color="#000080">.</font>Second <font color="#000080">+ </font><font color="#800000">60</font><font color="#000080">;
    </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
    </font>TimeT<font color="#000080">.</font>Second <font color="#000080">:= </font>StopT<font color="#000080">.</font>Second <font color="#000080">- </font>StartT<font color="#000080">.</font>Second<font color="#000080">;

    </font><font color="#FF0000"><b>If </b></font><font color="#000080">(</font>StopT<font color="#000080">.</font>S100 <font color="#000080">&lt; </font>StartT<font color="#000080">.</font>S100<font color="#000080">) </font><font color="#FF0000"><b>Then
    Begin
      </b></font>TimeT<font color="#000080">.</font>Second <font color="#000080">:= </font>TimeT<font color="#000080">.</font>Second <font color="#000080">- </font><font color="#800000">1</font><font color="#000080">;
      </font>StopT<font color="#000080">.</font>S100   <font color="#000080">:= </font>StopT<font color="#000080">.</font>S100 <font color="#000080">+ </font><font color="#800000">100</font><font color="#000080">;
    </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
    </font>TimeT<font color="#000080">.</font>S100 <font color="#000080">:= </font>StopT<font color="#000080">.</font>S100 <font color="#000080">- </font>StartT<font color="#000080">.</font>S100<font color="#000080">;
  </font><font color="#FF0000"><b>End
  Else
    </b></font>TimerError<font color="#000080">(</font><font color="#800000">3</font><font color="#000080">);
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>DispTime<font color="#000080">;
</font><font color="#FF0000"><b>Begin
  </b></font>CalcTimer<font color="#000080">;
  </font>Write<font color="#000080">(</font><font color="#800000">' Time : '</font><font color="#000080">);
  </font>Write<font color="#000080">(</font>TimeT<font color="#000080">.</font>Hour<font color="#000080">);
  </font>Write<font color="#000080">(</font><font color="#800000">':'</font><font color="#000080">);

  </font><font color="#FF0000"><b>If </b></font><font color="#000080">(</font>TimeT<font color="#000080">.</font>Minute <font color="#000080">&lt; </font><font color="#800000">10</font><font color="#000080">) </font><font color="#FF0000"><b>Then
    </b></font>Write<font color="#000080">(</font><font color="#800000">'0'</font><font color="#000080">);
  </font>Write<font color="#000080">(</font>TimeT<font color="#000080">.</font>Minute<font color="#000080">);
  </font>Write<font color="#000080">(</font><font color="#800000">':'</font><font color="#000080">);

  </font><font color="#FF0000"><b>If </b></font><font color="#000080">(</font>TimeT<font color="#000080">.</font>Second <font color="#000080">&lt; </font><font color="#800000">10</font><font color="#000080">) </font><font color="#FF0000"><b>Then
    </b></font>Write<font color="#000080">(</font><font color="#800000">'0'</font><font color="#000080">);
  </font>Write<font color="#000080">(</font>TimeT<font color="#000080">.</font>Second<font color="#000080">);
  </font>Write<font color="#000080">(</font><font color="#800000">'.'</font><font color="#000080">);

  </font><font color="#FF0000"><b>If </b></font><font color="#000080">(</font>TimeT<font color="#000080">.</font>S100 <font color="#000080">&lt; </font><font color="#800000">10</font><font color="#000080">) </font><font color="#FF0000"><b>Then
    </b></font>Write<font color="#000080">(</font><font color="#800000">'0'</font><font color="#000080">);
  </font>Writeln<font color="#000080">(</font>TimeT<font color="#000080">.</font>S100<font color="#000080">);
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>StartTimer<font color="#000080">;
</font><font color="#FF0000"><b>Begin
  </b></font>GetTime<font color="#000080">(</font>StartT<font color="#000080">.</font>Hour<font color="#000080">, </font>StartT<font color="#000080">.</font>Minute<font color="#000080">, </font>StartT<font color="#000080">.</font>Second<font color="#000080">, </font>StartT<font color="#000080">.</font>S100<font color="#000080">);
  </font>Stopped <font color="#000080">:= </font>False<font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>StopTimer<font color="#000080">;
</font><font color="#FF0000"><b>Begin
  If </b></font><font color="#000080">(</font>Stopped <font color="#000080">= </font>False<font color="#000080">) </font><font color="#FF0000"><b>Then
  Begin
    </b></font>GetTime<font color="#000080">(</font>StopT<font color="#000080">.</font>Hour<font color="#000080">, </font>StopT<font color="#000080">.</font>Minute<font color="#000080">, </font>StopT<font color="#000080">.</font>Second<font color="#000080">, </font>StopT<font color="#000080">.</font>S100<font color="#000080">);
    </font>Stopped <font color="#000080">:= </font>TRUE<font color="#000080">;
  </font><font color="#FF0000"><b>End
  Else
    </b></font>TimerError<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">);
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>End</b></font><font color="#000080">.

</font><font color="#008000"><i>{
This is a unit that I wrote.  It will not change day without calling an error
in itself.  This can be modified though, I just haven't went about doing it.
For example, if you started the timer at 11:29 pm and stopped it at 1:00 am, it
wouldn't work, but if you started the timer at 12:00 am and stopped it at 11:59
pm in that same day it would work.  The TimeStruct type doesn't store day, just
time and the only thing you have to do to use it is:

In your main program:
}
</i></font><font color="#FF0000"><b>Program </b></font>MyProg<font color="#000080">;

</font><font color="#FF0000"><b>Uses
  </b></font>Timer<font color="#000080">;

</font><font color="#FF0000"><b>Begin
</b></font><font color="#008000"><i>{ Program stuff.... }
</i></font>StartTimer<font color="#000080">;
</font><font color="#008000"><i>{ More Program Stuff... }
</i></font>StopTimer<font color="#000080">;
</font><font color="#008000"><i>{ If you don't want to display the time to the screen, then you need to
  call CalcTimer, so that it modifies TimeT}
</i></font>DispTime<font color="#000080">; </font><font color="#008000"><i>{Whenever you want to display the time..  The calculated time is
stored in the record variable Timer.TimeT, if you wanted to access    it.  All
the fields of the record a word in type.  To access the hours for example,
you'd go like:

                Timer.TimeT.Hour    or    TimeT.Hour

           You probably will have to try both.}
</i></font><font color="#FF0000"><b>End</b></font><font color="#000080">.

</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to TIMING SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0014.PAS">Original</a><b>]</b></p></body>
</html>
