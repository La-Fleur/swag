<html>
<head><title> "CLOCK.PAS" by SWAG SUPPORT TEAM</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to ISR SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0001.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{$M 2000, 0, 0}                         {  When writing TSR's you have to   }
</i></font><font color="#FF0000"><b>Program </b></font>Clock<font color="#000080">;                          </font><font color="#008000"><i>{  use the $M directive             }
</i></font><font color="#FF0000"><b>Uses </b></font>Dos<font color="#000080">;

 </font><font color="#FF0000"><b>Var
   </b></font>oldint<font color="#000080">: </font><font color="#FF0000"><b>Procedure</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>Write2scr <font color="#000080">(</font>s<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">; </font>color<font color="#000080">, </font>x<font color="#000080">, </font>y<font color="#000080">: </font>Byte<font color="#000080">);
 </font><font color="#FF0000"><b>Var
   </b></font>counter1<font color="#000080">,
   </font>counter2<font color="#000080">: </font>Byte<font color="#000080">;
 </font><font color="#FF0000"><b>begin                                             </b></font><font color="#008000"><i>{ In TSR's you always }
    </i></font>counter1 <font color="#000080">:= </font><font color="#800000">2 </font><font color="#000080">* (</font>x <font color="#000080">+ </font>y <font color="#000080">* </font><font color="#800000">80</font><font color="#000080">);                  </font><font color="#008000"><i>{ need to use direct  }
    </i></font><font color="#FF0000"><b>For </b></font>counter2 <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>ord<font color="#000080">(</font>s<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">]) </font><font color="#FF0000"><b>do              </b></font><font color="#008000"><i>{ screen Writes.      }
     </i></font><font color="#FF0000"><b>begin                                         </b></font><font color="#008000"><i>{                     }
      </i></font>mem <font color="#000080">[</font><font color="#800000">$b800</font><font color="#000080">: </font>counter1<font color="#000080">] := </font>ord<font color="#000080">(</font>s<font color="#000080">[</font>counter2<font color="#000080">]);
      </font>inc <font color="#000080">(</font>counter1<font color="#000080">);
      </font>mem <font color="#000080">[</font><font color="#800000">$b800</font><font color="#000080">: </font>counter1<font color="#000080">] := </font>color<font color="#000080">;
      </font>inc <font color="#000080">(</font>counter1<font color="#000080">);
     </font><font color="#FF0000"><b>end</b></font><font color="#000080">;  </font><font color="#008000"><i>{do}

 </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;      </font><font color="#008000"><i>{Write2SCR}

{$F+}                   { All Procedures will now be Far Procedures }

</i></font><font color="#FF0000"><b>Procedure </b></font>int_Hook<font color="#000080">; </font>interrupt<font color="#000080">;
</font><font color="#FF0000"><b>Var
   </b></font>hour<font color="#000080">,                </font><font color="#008000"><i>{ Where the Hour will be stored }
   </i></font>min<font color="#000080">: </font>Word<font color="#000080">;           </font><font color="#008000"><i>{ &quot;  &quot;  &quot; &quot; minute &quot;          &quot; }
   </i></font>hS<font color="#000080">,                  </font><font color="#008000"><i>{ Where STR Hour will be stored }
   </i></font>MS<font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">[</font><font color="#800000">2</font><font color="#000080">];       </font><font color="#008000"><i>{       STR Min                 }
</i></font><font color="#FF0000"><b>begin
     </b></font>hour <font color="#000080">:= </font>memW<font color="#000080">[</font><font color="#800000">$0000</font><font color="#000080">:</font><font color="#800000">$046e</font><font color="#000080">];
     </font>min <font color="#000080">:= (</font>memW<font color="#000080">[</font><font color="#800000">$0000</font><font color="#000080">:</font><font color="#800000">$046c</font><font color="#000080">] </font><font color="#FF0000"><b>div </b></font><font color="#800000">18</font><font color="#000080">) </font><font color="#FF0000"><b>div </b></font><font color="#800000">60</font><font color="#000080">;

</font><font color="#008000"><i>{ The above 2 lines of code give the hour &amp; minute.. How?? The first
  memory location gives the hour thats easy, but the minutes are a
  little more tricky... The interrupt i'm gonna hook into is int 8
  ... it is called approximately 18.2 times/second. When its called,
  it increments 0000:046c hex. When it overflows, it inc's 0000:046e
  (which is the hour in 24 hr Format) so, dividing by 18 would give
  us the approximate second in the hour, div'ding by 60 then gives
  the hour                                                              }

     </i></font><font color="#FF0000"><b>if </b></font>hour <font color="#000080">&gt; </font><font color="#800000">12 </font><font color="#FF0000"><b>then </b></font>dec<font color="#000080">(</font>hour<font color="#000080">, </font><font color="#800000">12</font><font color="#000080">);           </font><font color="#008000"><i>{ Converts from 24 hr Format }
     </i></font>str<font color="#000080">(</font>min<font color="#000080">, </font>MS<font color="#000080">);
     </font>str<font color="#000080">(</font>hour<font color="#000080">, </font>HS<font color="#000080">);
     </font>Write2scr <font color="#000080">(</font>HS<font color="#000080">, </font><font color="#800000">9</font><font color="#000080">, </font><font color="#800000">77 </font><font color="#000080">- </font>ord<font color="#000080">(</font>hs<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">]), </font><font color="#800000">0</font><font color="#000080">);     </font><font color="#008000"><i>{ Writes to screen }
     </i></font>Write2scr <font color="#000080">(</font>MS<font color="#000080">, </font><font color="#800000">12</font><font color="#000080">, </font><font color="#800000">78</font><font color="#000080">, </font><font color="#800000">0</font><font color="#000080">);
     </font>Write2scr <font color="#000080">(</font><font color="#800000">':'</font><font color="#000080">,</font><font color="#800000">10</font><font color="#000080">, </font><font color="#800000">77</font><font color="#000080">, </font><font color="#800000">0</font><font color="#000080">);
     </font><font color="#FF0000"><b>Inline </b></font><font color="#000080">(</font><font color="#800000">$9c</font><font color="#000080">);                              </font><font color="#008000"><i>{ Push the flags ( you have }
     </i></font>oldint<font color="#000080">;                                    </font><font color="#008000"><i>{ to do this beFore any int }
                                                { call like this            }
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;   </font><font color="#008000"><i>{inT_HOOK}

{$F-}                                           { No more Far Procedures }

</i></font><font color="#FF0000"><b>begin
  </b></font>getintvec <font color="#000080">(</font><font color="#800000">8</font><font color="#000080">, @</font>oldint<font color="#000080">);                       </font><font color="#008000"><i>{ Hooks the interrupt }
  </i></font>setintvec <font color="#000080">(</font><font color="#800000">8</font><font color="#000080">, </font>addr<font color="#000080">(</font>int_hook<font color="#000080">));
  </font>keep <font color="#000080">(</font><font color="#800000">0</font><font color="#000080">);                                     </font><font color="#008000"><i>{ Makes it stay resident }
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">.

</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to ISR SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0001.PAS">Original</a><b>]</b></p></body>
</html>
