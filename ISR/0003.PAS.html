<html>
<head><title> "ISRDEMO.PAS" by SWAG SUPPORT TEAM</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to ISR SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0003.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
It can make sense to Write Method-ISR's. Two examples:

1. Implementation of a timer-IRQ-triggered eventQueue (a body of such an
Object I append to this mail).

2. Objects For serial-IO. You can have up to 8 or 16 serial channels (with
special hardware). The priciples of encapsulation and instances suggests
an OOPS-solution! Why not including the ISR-Routine into the Object?
I'm not happy about the intentional misunderstandings to your request
in this area :-|

However, the next 2K are my act of revenge to your repliers: :-D
(Gentlemen: No flames please, I know that the demo itself makes no sense
and procedural Programming For such a simple output would be easier
and shorter!!! All I want to show, is a toRSO of an OOPS-solution For ISR's.)
}

</i></font><font color="#FF0000"><b>Program </b></font>isrDemo<font color="#000080">;
</font><font color="#008000"><i>{$F+,S-}
</i></font><font color="#FF0000"><b>Uses
    </b></font>Crt<font color="#000080">,</font>Dos<font color="#000080">;
</font><font color="#FF0000"><b>Type
    </b></font>timerObj  <font color="#000080">=    </font><font color="#FF0000"><b>Object
                        </b></font>saveInt<font color="#000080">,
                        </font>myjob     <font color="#000080">:    </font>Pointer<font color="#000080">;
                        </font>stopped   <font color="#000080">:    </font>Boolean<font color="#000080">;
                        </font><font color="#FF0000"><b>Constructor </b></font>Init<font color="#000080">(</font>job<font color="#000080">:</font>Pointer<font color="#000080">);
                        </font><font color="#FF0000"><b>Destructor  </b></font>DeInit<font color="#000080">;
                        </font><font color="#FF0000"><b>PRIVATE
                        Procedure   </b></font>timerInt<font color="#000080">;
                   </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Const
    </b></font>timerSelf <font color="#000080">:    </font>Pointer   <font color="#000080">=    </font><font color="#FF0000"><b>NIL</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Constructor </b></font>timerObj<font color="#000080">.</font>Init<font color="#000080">(</font>job<font color="#000080">:</font>Pointer<font color="#000080">);
</font><font color="#FF0000"><b>begin
    if </b></font>timerSelf<font color="#000080">&lt;&gt;</font><font color="#FF0000"><b>NIL then </b></font>FAIL<font color="#000080">;            </font><font color="#008000"><i>{ only one instance in this demo }
    </i></font>timerSelf<font color="#000080">:=@</font>self<font color="#000080">;
    </font>myjob<font color="#000080">:=</font>job<font color="#000080">;
    </font>stopped<font color="#000080">:=</font>False<font color="#000080">;
    </font>getintvec<font color="#000080">(</font><font color="#800000">$1C</font><font color="#000080">,</font>saveInt<font color="#000080">);
    </font>setintvec<font color="#000080">(</font><font color="#800000">$1C</font><font color="#000080">,@</font>timerObj<font color="#000080">.</font>timerInt<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Destructor </b></font>timerObj<font color="#000080">.</font>DeInit<font color="#000080">;
</font><font color="#FF0000"><b>begin
    </b></font>setintvec<font color="#000080">(</font><font color="#800000">$1C</font><font color="#000080">,</font>saveint<font color="#000080">); </font>timerSelf<font color="#000080">:=</font><font color="#FF0000"><b>NIL</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>timerObj<font color="#000080">.</font>timerInt<font color="#000080">; </font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Label
    </b></font>_10<font color="#000080">;
</font><font color="#FF0000"><b>Asm
    </b></font><font color="#FF00FF">pop  bp                           </font><font color="#008000"><i>{ Compiler inserts PUSH BP - restore it }
    </i></font><font color="#FF00FF">push ax
    push bx
    push cx
    push dx
    push si
    push di
    push ds
    push es
    push bp
    mov  al,20h                        </font><font color="#008000"><i>{ send EOI }
    </i></font><font color="#FF00FF">out  20h,al
    sti

    mov  bp,sp
    mov  ax,SEG @DATA
    mov  ds,ax
    les  di,[offset timerSelf]         </font><font color="#008000"><i>{ only one instance in this demo! }
    </i></font><font color="#FF00FF">cmp  es:[di+stopped],0             </font><font color="#008000"><i>{ prevents IRQ-overruns           }
    </i></font><font color="#FF00FF">jne  _10
    inc  es:[di+stopped]
    call dWord ptr es:[di+offset myjob]; </font><font color="#008000"><i>{ no test of NIL implemented    }
    </i></font><font color="#FF00FF">les  di,[offset timerSelf]
    dec  es:[di+stopped]

   _10:
    call dWord ptr es:[di+saveInt]     </font><font color="#008000"><i>{ call original inT-Proc }
    </i></font><font color="#FF00FF">mov  sp,bp
    pop  bp
    pop  es
    pop  ds
    pop  di
    pop  si
    pop  dx
    pop  cx
    pop  bx
    pop  ax
    iret
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#008000"><i>(*********************** DemoShell **************************)
</i></font><font color="#FF0000"><b>Var
    </b></font>timer     <font color="#000080">:    </font>timerObj<font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>helloHerb<font color="#000080">;
</font><font color="#FF0000"><b>begin
    </b></font>Write<font color="#000080">(</font><font color="#800000">'.'</font><font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>begin
    if </b></font>timer<font color="#000080">.</font>Init<font color="#000080">(@</font>helloHerb<font color="#000080">) </font><font color="#FF0000"><b>then
    begin
         </b></font>Delay<font color="#000080">(</font><font color="#800000">5000</font><font color="#000080">);
         </font>timer<font color="#000080">.</font>DeInit<font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">.

</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to ISR SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0003.PAS">Original</a><b>]</b></p></body>
</html>
