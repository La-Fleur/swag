<html>
<head><title> "copy 640x480 VGA color screen to file" by BREN SESSIONS</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to EGAVGA SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0271.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code>
<font color="#000000">                                                  Date<font color="#000080">: </font>June <font color="#800000">24</font><font color="#000080">, </font><font color="#800000">1995
</font><font color="#000080">&Eacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&raquo;
&ordm; </font>vga2pcx<font color="#000080">.</font>zip <font color="#FF0000"><b>package </b></font><font color="#000080">&ordm;
&Egrave;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&frac14;

                  *</font>FAST<font color="#000080">* </font>Turbo <font color="#FF0000"><b>Pascal unit </b></font><font color="#000080">(</font>part assembly langauge<font color="#000080">).

  </font>DESCRIPTION<font color="#000080">:

  </font>Saves a copy <font color="#FF0000"><b>of </b></font>the <font color="#800000">640</font>x480 VGA <font color="#800000">16 </font>color screen <font color="#FF0000"><b>to </b></font>a properly
  formatted PCX <font color="#FF0000"><b>file</b></font><font color="#000080">.  </font>This routine also takes care <font color="#FF0000"><b>to </b></font>save
  the current palette so your colors will be preserved correctly<font color="#000080">.


  </font>REQUIRED<font color="#000080">:

  *  </font>Turbo <font color="#FF0000"><b>Pascal </b></font><font color="#800000">6</font><font color="#000080">+ </font><font color="#FF0000"><b>to </b></font>run these routines<font color="#000080">, </font>however<font color="#000080">, </font><font color="#FF0000"><b>if </b></font>you just want
     <font color="#FF0000"><b>to </b></font>learn the PCX format you can read the source code <font color="#FF0000"><b>and </b></font>comments<font color="#000080">.
     </font>I think <font color="#FF0000"><b>Pascal </b></font>code <font color="#FF0000"><b>is </b></font>a relatively easy language <font color="#FF0000"><b>to </b></font>read <font color="#FF0000"><b>and
     </b></font>understand<font color="#000080">.

  *  </font>EGAVGA<font color="#000080">.</font>BGI supplied by Borland <font color="#FF0000"><b>with </b></font>the Turbo <font color="#FF0000"><b>Pascal </b></font>compiler


  <font color="#FF0000"><b>FILE </b></font>LIST<font color="#000080">:

  </font>vga2pcx<font color="#000080">.</font>pas    Source code <font color="#FF0000"><b>for </b></font>pcx routines
  vga2pcx<font color="#000080">.</font>tpu    Turbo <font color="#FF0000"><b>Pascal </b></font><font color="#800000">6.0 </font><font color="#FF0000"><b>object </b></font>code
  test<font color="#000080">.</font>pas       Example <font color="#FF0000"><b>program to </b></font>use the vga2pcx <font color="#FF0000"><b>unit
  </b></font>test<font color="#000080">.</font>exe       Compiled example <font color="#FF0000"><b>program
  </b></font>test<font color="#000080">.</font>pcx       PCX <font color="#FF0000"><b>file </b></font>created by test<font color="#000080">.</font>exe <font color="#FF0000"><b>program


  </b></font>COMMON <font color="#FF0000"><b>USES</b></font><font color="#000080">:

  *  </font>Programmer can give user ability <font color="#FF0000"><b>to </b></font>save a copy <font color="#FF0000"><b>of </b></font>his<font color="#000080">/</font>her
     exact graphics screen <font color="#FF0000"><b>for </b></font>presentation <font color="#FF0000"><b>or </b></font>documentation purposes<font color="#000080">.
     </font>The PCX format <font color="#FF0000"><b>is </b></font>common format that <font color="#FF0000"><b>is </b></font>easily imported into
     word processors<font color="#000080">, </font>etc<font color="#000080">.

  *  </font>Slide show programs often operate <font color="#FF0000"><b>on </b></font>PCX files<font color="#000080">.  </font>You can save
     a sequence <font color="#FF0000"><b>of </b></font>pictures <font color="#FF0000"><b>and then </b></font>run a <font color="#FF0000"><b>program to </b></font>cycle through
     them like a demonstration<font color="#000080">.

  *  </font>Frees the DOS programmer from having <font color="#FF0000"><b>to </b></font>support multiple
     printing devices<font color="#000080">.  </font><font color="#FF0000"><b>If </b></font>you can fit your graphics <font color="#FF0000"><b>on </b></font>the screen<font color="#000080">,
     </font>the screen can be saved into a standard PCX <font color="#FF0000"><b>file</b></font><font color="#000080">.  </font>This opens
     the door <font color="#FF0000"><b>to </b></font>printing via other<font color="#000080">, </font>more specialized<font color="#000080">, </font>programs<font color="#000080">.

  *  </font>Source code included<font color="#000080">, </font>so you can learn the PCX format <font color="#FF0000"><b>and
     </b></font>customize <font color="#FF0000"><b>for </b></font>your own use<font color="#000080">.


  </font>AUTHOR INFO<font color="#000080">:

  </font>Bren Sessions
  <font color="#800000">1590 </font>NW Maple
  Corvallis<font color="#000080">, </font><font color="#FF0000"><b>OR  </b></font><font color="#800000">97330

  </font>Tel<font color="#000080">: (</font><font color="#800000">503</font><font color="#000080">) </font><font color="#800000">758</font><font color="#000080">-</font><font color="#800000">2256
  </font>Email<font color="#000080">: </font>sessioj<font color="#000080">@</font>ece<font color="#000080">.</font>orst<font color="#000080">.</font>edu



  PARTICULARS<font color="#000080">:

  </font>No copyright<font color="#000080">!!!   </font>Feel free <font color="#FF0000"><b>to </b></font>incorporate this into your own code<font color="#000080">.

  </font><font color="#FF0000"><b>If </b></font>you find these functions useful<font color="#000080">, </font>I<font color="#800000">'d appreciate to hear from you.
  </font><font color="#FF0000"><b>If </b></font>you feel like supporting my efforts<font color="#000080">, </font>be great too<font color="#000080">.  </font>Some people
  have sent me mail telling me that we<font color="#800000">'ve been waiting for these routines
  </font><font color="#FF0000"><b>for </b></font>years<font color="#000080">.  </font>I suggest <font color="#800000">$5</font><font color="#000080">, </font>but you can send me whatever you think <font color="#FF0000"><b>is
  </b></font>reasonable<font color="#000080">.




</font><font color="#FF0000"><b>unit </b></font>vga2pcx<font color="#000080">;

</font><font color="#FF0000"><b>interface

uses </b></font>crt<font color="#000080">,          </font><font color="#008000"><i>{ gives sound ability }
     </i></font>graph<font color="#000080">;        </font><font color="#008000"><i>{ allows reading the current palette }

{
  Saves a copy of the 640x480 VGA 16 color screen to a properly
  formatted PCX file.  This routine also takes care to save
  the current palette so your colors will be preserved correctly.

  COMMON USES:

  *  Programmer can give user ability to save a copy of his/her
     exact graphics screen for presentation or documentation purposes.
     The PCX format is common format that is easily imported into
     word processors, etc.

  *  Slide show programs often operate on PCX files.  You can save
     a sequence of pictures and then run a program to cycle through
     them like a demonstration.

  *  Frees the DOS programmer from having to support multiple
     printing devices.  If you can fit your graphics on the screen,
     the screen can be saved into a standard PCX file.  This opens
     the door to printing via other, more specialized, programs.

  *  Source code included, so you can learn the PCX format and
     customize for your own use.

--------------------------------------------------------------------------

  No copyright!!!   Feel free to incorporate this into your own code.

  If you find these functions useful, I'd appreciate to hear from you.
  If you feel like supporting my efforts, be great too.  Some people
  have sent me mail telling me that we've been waiting for these routines
  for years.  I suggest $5, but you can send me whatever you'd like.

  Have fun!!

  Bren Sessions
  1590 N.W. Maple
  Corvallis, OR 97330
  (503) 758-2256

  sessioj@ece.orst.edu

-------------------------------------------------------------------------

}

</i></font><font color="#FF0000"><b>procedure </b></font>write_pcx<font color="#000080">(</font>fn <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">; </font><font color="#FF0000"><b>var </b></font>ok <font color="#000080">: </font>boolean<font color="#000080">);

</font><font color="#008000"><i>{
  Will save the current 640x480 VGA 16 color screen into file passed
  as parameter 'fn'.  If the save is successful (e.g. the filename
  was legal, 'ok' is given the value of true
}

</i></font><font color="#FF0000"><b>implementation

</b></font><font color="#008000"><i>{-----------------------------------------------------------------------}

</i></font><font color="#FF0000"><b>procedure </b></font>get_rgb<font color="#000080">(</font>color <font color="#000080">: </font>integer<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>r<font color="#000080">,</font>g<font color="#000080">,</font>b <font color="#000080">: </font>integer<font color="#000080">);

</font><font color="#008000"><i>{ converts a VGA16 color into its reg, green, blue components }

</i></font><font color="#FF0000"><b>begin

  </b></font>r<font color="#000080">:=(((</font>color <font color="#FF0000"><b>and </b></font><font color="#800000">$20</font><font color="#000080">) </font><font color="#FF0000"><b>shr </b></font><font color="#800000">5</font><font color="#000080">) </font><font color="#FF0000"><b>or </b></font><font color="#000080">((</font>color <font color="#FF0000"><b>and </b></font><font color="#800000">$04</font><font color="#000080">) </font><font color="#FF0000"><b>shr </b></font><font color="#800000">1</font><font color="#000080">))*</font><font color="#800000">84</font><font color="#000080">;
  </font>g<font color="#000080">:=(((</font>color <font color="#FF0000"><b>and </b></font><font color="#800000">$10</font><font color="#000080">) </font><font color="#FF0000"><b>shr </b></font><font color="#800000">4</font><font color="#000080">) </font><font color="#FF0000"><b>or </b></font><font color="#000080">((</font>color <font color="#FF0000"><b>and </b></font><font color="#800000">$02</font><font color="#000080">)      ))*</font><font color="#800000">84</font><font color="#000080">;
  </font>b<font color="#000080">:=(((</font>color <font color="#FF0000"><b>and </b></font><font color="#800000">$08</font><font color="#000080">) </font><font color="#FF0000"><b>shr </b></font><font color="#800000">3</font><font color="#000080">) </font><font color="#FF0000"><b>or </b></font><font color="#000080">((</font>color <font color="#FF0000"><b>and </b></font><font color="#800000">$01</font><font color="#000080">) </font><font color="#FF0000"><b>shl </b></font><font color="#800000">1</font><font color="#000080">))*</font><font color="#800000">84</font><font color="#000080">;

</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{-----------------------------------------------------------------------}

</i></font><font color="#FF0000"><b>procedure </b></font>write_pcx<font color="#000080">(</font>fn <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">; </font><font color="#FF0000"><b>var </b></font>ok <font color="#000080">: </font>boolean<font color="#000080">);

</font><font color="#008000"><i>{ saves windowed region into a RLE .PCX file }
{
   *** compression idea:

      Each scanline is decomposed into a continous stream of 4 bit planes
      = 80 bytes * 4 = 320 bytes.  This stream is checked for consecutive
      byte patterns.  Up to 63 ($3F) values can compressed into two bytes
      forming a RLE code of $C0 or'ed with the run length (up to $3F). This
      forms the first byte, usually ($FF = 1100 0000 | 0011 1111)  The
      next byte is the actual data byte.  If a single byte is encountered
      it is written to the file as simply itself UNLESS the top two
      bits are set (mask $C0) which would indicate a RLE.  If this is
      the case then a special RLE of length 1 must be written in the
      general RLE form.  Here this would be ($C0 | 01 =&gt; $C1 followed
      by the data byte.).  I compress each scan line separately thus ending
      possible RLE's at the end of each scan line.  This seems to be
      accepted practice.

      Bren Sessions, June 17, 1995
}


</i></font><font color="#FF0000"><b>type </b></font>header_rec <font color="#000080">=

         </font><font color="#FF0000"><b>record
           </b></font>pcx_id  <font color="#000080">: </font>byte<font color="#000080">;   </font><font color="#008000"><i>{ 0) 0x0a = ZSoft .PCX file          }
           </i></font>pcx_ver <font color="#000080">: </font>byte<font color="#000080">;   </font><font color="#008000"><i>{ 1) 0x05 = PC PaintBrush 3.0        }
           </i></font>encode  <font color="#000080">: </font>byte<font color="#000080">;   </font><font color="#008000"><i>{ 2) 0x01 = RLE                      }
           </i></font>bpp     <font color="#000080">: </font>byte<font color="#000080">;   </font><font color="#008000"><i>{ 3) 0x01 = bits/pixel why VGA16=1?  }
           </i></font>left    <font color="#000080">: </font>word<font color="#000080">;   </font><font color="#008000"><i>{ 4-5) Window Left                   }
           </i></font>top     <font color="#000080">: </font>word<font color="#000080">;   </font><font color="#008000"><i>{ 6-7) Window Top                    }
           </i></font>right   <font color="#000080">: </font>word<font color="#000080">;   </font><font color="#008000"><i>{ 8-9) Window Right                  }
           </i></font>bott    <font color="#000080">: </font>word<font color="#000080">;   </font><font color="#008000"><i>{ 10-11) Window Bottom               }
           </i></font>xres    <font color="#000080">: </font>word<font color="#000080">;   </font><font color="#008000"><i>{ 12-13) Horizontal resolution       }
           </i></font>yres    <font color="#000080">: </font>word<font color="#000080">;   </font><font color="#008000"><i>{ 14-15) Vertical resolution         }
           </i></font>rgb     <font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">15</font><font color="#000080">,</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">3</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">;  </font><font color="#008000"><i>{ (R-G-B) values }
           </i></font>resv    <font color="#000080">: </font>byte<font color="#000080">;   </font><font color="#008000"><i>{ 64) Reserved                       }
           </i></font>bplanes <font color="#000080">: </font>byte<font color="#000080">;   </font><font color="#008000"><i>{ 65) Number of bit planes, VGA16=4  }
           </i></font>bpl     <font color="#000080">: </font>word<font color="#000080">;   </font><font color="#008000"><i>{ 66-67) # of bytes/line, VGA16=80   }
           </i></font>ptype   <font color="#000080">: </font>word<font color="#000080">;   </font><font color="#008000"><i>{ 68-69) palette type, color=1       }
           </i></font>unused  <font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">70</font><font color="#000080">..</font><font color="#800000">127</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">;
         </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>const </b></font>BUFSIZE <font color="#000080">= </font><font color="#800000">256</font><font color="#000080">;   </font><font color="#008000"><i>{ will write to disk at this byte interval }

</i></font><font color="#FF0000"><b>var </b></font>header <font color="#000080">: </font>header_rec<font color="#000080">;
    </font>pal    <font color="#000080">: </font>palettetype<font color="#000080">;   </font><font color="#008000"><i>{ from graph unit }
    </i></font>r<font color="#000080">,</font>g<font color="#000080">,</font>b  <font color="#000080">: </font>integer<font color="#000080">;
    </font>i<font color="#000080">,</font>y<font color="#000080">,</font>j  <font color="#000080">: </font>integer<font color="#000080">;
    </font>fz     <font color="#000080">: </font><font color="#FF0000"><b>file</b></font><font color="#000080">;
    </font>data   <font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">319</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">; </font><font color="#008000"><i>{ (4 bitplanes) * (scan line=80 bytes) }
    </i></font>buf    <font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font>BUFSIZE<font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">;
    </font>bi     <font color="#000080">: </font>integer<font color="#000080">;   </font><font color="#008000"><i>{ buffer index }
    </i></font>dta    <font color="#000080">: </font>byte<font color="#000080">;
    </font>index  <font color="#000080">: </font>integer<font color="#000080">;
    </font>count  <font color="#000080">: </font>integer<font color="#000080">;

</font><font color="#FF0000"><b>label </b></font>done<font color="#000080">;

         </font><font color="#008000"><i>{ - - - - - - - - - - - - - - - - - - - - - - - - - }

</i></font><font color="#FF0000"><b>procedure </b></font>flushit<font color="#000080">;

</font><font color="#FF0000"><b>begin

  </b></font>blockwrite<font color="#000080">(</font>fz<font color="#000080">,</font>buf<font color="#000080">,</font>bi<font color="#000080">);
  </font>bi<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;

</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

         </font><font color="#008000"><i>{ - - - - - - - - - - - - - - - - - - - - - - - - - }

</i></font><font color="#FF0000"><b>procedure </b></font>get_bitplane_info_at_scan_line<font color="#000080">(</font>plane<font color="#000080">, </font>scanline <font color="#000080">: </font>word<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>address<font color="#000080">);

</font><font color="#008000"><i>{ Dumps the requested scanline (0-479) at a particular bitplane (0-3)
  into a memory address.  Space required = 80 bytes (640 pixel)
}

</i></font><font color="#FF0000"><b>begin

  asm

    </b></font><font color="#FF00FF">cld

    mov   bx,ds

    mov   ax,0a000h
    mov   ds,ax

    mov   ax,80
    mul   scanline
    mov   si,ax

    mov   dx,03ceh
    mov   ax,0005h
    out   dx,ax
    mov   ax,plane
    mov   ah,al
    mov   al,04h
    out   dx,ax
    mov   cx,40         </font><font color="#008000"><i>{ 40 words = 80 bytes = 1 scan line }
    </i></font><font color="#FF00FF">les   di,address
    rep   movsw
    mov   ax,1005h
    out   dx,ax
    mov   ax,0004h
    out   dx,ax
    mov   ds,bx

  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

         </font><font color="#008000"><i>{ - - - - - - - - - - - - - - - - - - - - - - - - - }

</i></font><font color="#FF0000"><b>begin

  </b></font>ok<font color="#000080">:=</font>false<font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font>fn<font color="#000080">=</font><font color="#800000">'' </font><font color="#FF0000"><b>then </b></font>exit<font color="#000080">;                   </font><font color="#008000"><i>{ exit if no filename given }
  </i></font>fillchar<font color="#000080">(</font>header<font color="#000080">,</font>sizeof<font color="#000080">(</font>header<font color="#000080">),</font><font color="#800000">#0</font><font color="#000080">);

  </font><font color="#FF0000"><b>with </b></font>header <font color="#FF0000"><b>do
  begin
    </b></font>pcx_id  <font color="#000080">:= </font><font color="#800000">$0A</font><font color="#000080">;
    </font>pcx_ver <font color="#000080">:= </font><font color="#800000">$05</font><font color="#000080">;
    </font>encode  <font color="#000080">:= </font><font color="#800000">$01</font><font color="#000080">;
    </font>bpp     <font color="#000080">:= </font><font color="#800000">$01</font><font color="#000080">;
    </font>left    <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
    </font>top     <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
    </font>right   <font color="#000080">:= </font><font color="#800000">639</font><font color="#000080">;
    </font>bott    <font color="#000080">:= </font><font color="#800000">479</font><font color="#000080">;
    </font>xres    <font color="#000080">:= </font><font color="#800000">640</font><font color="#000080">;
    </font>yres    <font color="#000080">:= </font><font color="#800000">480</font><font color="#000080">;

    </font>getpalette<font color="#000080">(</font>pal<font color="#000080">);
    </font><font color="#FF0000"><b>for </b></font>i<font color="#000080">:=</font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font><font color="#800000">15 </font><font color="#FF0000"><b>do
    begin
      </b></font>get_rgb<font color="#000080">(</font>pal<font color="#000080">.</font>colors<font color="#000080">[</font>i<font color="#000080">],</font>r<font color="#000080">,</font>g<font color="#000080">,</font>b<font color="#000080">);
      </font>rgb<font color="#000080">[</font>i<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">]:=</font>r<font color="#000080">;  </font>rgb<font color="#000080">[</font>i<font color="#000080">,</font><font color="#800000">2</font><font color="#000080">]:=</font>g<font color="#000080">;  </font>rgb<font color="#000080">[</font>i<font color="#000080">,</font><font color="#800000">3</font><font color="#000080">]:=</font>b<font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

    </font>bplanes <font color="#000080">:=  </font><font color="#800000">4</font><font color="#000080">;
    </font>bpl     <font color="#000080">:=  </font><font color="#800000">80</font><font color="#000080">;   </font><font color="#008000"><i>{ bytes per line }
    </i></font>ptype   <font color="#000080">:=  </font><font color="#800000">1</font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font>assign<font color="#000080">(</font>fz<font color="#000080">,</font>fn<font color="#000080">);
  </font><font color="#008000"><i>{$i-} </i></font>rewrite<font color="#000080">(</font>fz<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">); </font><font color="#008000"><i>{$i+}
  </i></font><font color="#FF0000"><b>if </b></font>ioresult<font color="#000080">&lt;&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>then
  begin
    </b></font>sound<font color="#000080">(</font><font color="#800000">200</font><font color="#000080">); </font>delay<font color="#000080">(</font><font color="#800000">2000</font><font color="#000080">); </font>nosound<font color="#000080">;
    </font>sound<font color="#000080">(</font><font color="#800000">50</font><font color="#000080">); </font>delay<font color="#000080">(</font><font color="#800000">2000</font><font color="#000080">); </font>nosound<font color="#000080">;
    </font>exit<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>blockwrite<font color="#000080">(</font>fz<font color="#000080">,</font>header<font color="#000080">,</font>sizeof<font color="#000080">(</font>header<font color="#000080">));

  </font>bi<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;      </font><font color="#008000"><i>{ buffer index }

  </i></font><font color="#FF0000"><b>for </b></font>y<font color="#000080">:=</font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font><font color="#800000">479 </font><font color="#FF0000"><b>do
  begin

    </b></font>get_bitplane_info_at_scan_line<font color="#000080">(</font><font color="#800000">0</font><font color="#000080">,</font>y<font color="#000080">,</font>data<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">]);
    </font>get_bitplane_info_at_scan_line<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">,</font>y<font color="#000080">,</font>data<font color="#000080">[</font><font color="#800000">80</font><font color="#000080">]);
    </font>get_bitplane_info_at_scan_line<font color="#000080">(</font><font color="#800000">2</font><font color="#000080">,</font>y<font color="#000080">,</font>data<font color="#000080">[</font><font color="#800000">160</font><font color="#000080">]);
    </font>get_bitplane_info_at_scan_line<font color="#000080">(</font><font color="#800000">3</font><font color="#000080">,</font>y<font color="#000080">,</font>data<font color="#000080">[</font><font color="#800000">240</font><font color="#000080">]);

    </font>index<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;

    </font><font color="#FF0000"><b>repeat
      </b></font>count<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
      </font>dta<font color="#000080">:=</font>data<font color="#000080">[</font>index<font color="#000080">];
      </font><font color="#FF0000"><b>repeat
        </b></font>inc<font color="#000080">(</font>index<font color="#000080">); </font>inc<font color="#000080">(</font>count<font color="#000080">);

        </font><font color="#FF0000"><b>if </b></font>count<font color="#000080">&gt;</font><font color="#800000">$3F </font><font color="#FF0000"><b>then
        begin
          if </b></font>bi<font color="#000080">=</font>BUFSIZE <font color="#FF0000"><b>then </b></font>flushit<font color="#000080">; </font>inc<font color="#000080">(</font>bi<font color="#000080">); </font>buf<font color="#000080">[</font>bi<font color="#000080">]:=</font><font color="#800000">$FF</font><font color="#000080">;
          </font><font color="#FF0000"><b>if </b></font>bi<font color="#000080">=</font>BUFSIZE <font color="#FF0000"><b>then </b></font>flushit<font color="#000080">; </font>inc<font color="#000080">(</font>bi<font color="#000080">); </font>buf<font color="#000080">[</font>bi<font color="#000080">]:=</font>dta<font color="#000080">;
          </font>count<font color="#000080">:=</font><font color="#800000">1</font><font color="#000080">;
        </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>until </b></font><font color="#000080">(</font>index<font color="#000080">&gt;</font><font color="#800000">319</font><font color="#000080">) </font><font color="#FF0000"><b>or </b></font><font color="#000080">(</font>data<font color="#000080">[</font>index<font color="#000080">]&lt;&gt;</font>dta<font color="#000080">);

      </font>done<font color="#000080">:
      </font><font color="#FF0000"><b>if </b></font>count<font color="#000080">&gt;</font><font color="#800000">1 </font><font color="#FF0000"><b>then
      begin
        if </b></font>bi<font color="#000080">=</font>BUFSIZE <font color="#FF0000"><b>then </b></font>flushit<font color="#000080">; </font>inc<font color="#000080">(</font>bi<font color="#000080">); </font>buf<font color="#000080">[</font>bi<font color="#000080">]:=</font><font color="#800000">$C0 </font><font color="#FF0000"><b>or </b></font>count<font color="#000080">;
        </font><font color="#FF0000"><b>if </b></font>bi<font color="#000080">=</font>BUFSIZE <font color="#FF0000"><b>then </b></font>flushit<font color="#000080">; </font>inc<font color="#000080">(</font>bi<font color="#000080">); </font>buf<font color="#000080">[</font>bi<font color="#000080">]:=</font>dta<font color="#000080">;
      </font><font color="#FF0000"><b>end
      else
      begin
        if </b></font><font color="#000080">(</font>dta <font color="#FF0000"><b>and </b></font><font color="#800000">$C0</font><font color="#000080">)=</font><font color="#800000">$C0 </font><font color="#FF0000"><b>then
        begin
          if </b></font>bi<font color="#000080">=</font>BUFSIZE <font color="#FF0000"><b>then </b></font>flushit<font color="#000080">; </font>inc<font color="#000080">(</font>bi<font color="#000080">); </font>buf<font color="#000080">[</font>bi<font color="#000080">]:=</font><font color="#800000">$C1</font><font color="#000080">;
          </font><font color="#FF0000"><b>if </b></font>bi<font color="#000080">=</font>BUFSIZE <font color="#FF0000"><b>then </b></font>flushit<font color="#000080">; </font>inc<font color="#000080">(</font>bi<font color="#000080">); </font>buf<font color="#000080">[</font>bi<font color="#000080">]:=</font>dta<font color="#000080">;
        </font><font color="#FF0000"><b>end
        else
        begin
          if </b></font>bi<font color="#000080">=</font>BUFSIZE <font color="#FF0000"><b>then </b></font>flushit<font color="#000080">; </font>inc<font color="#000080">(</font>bi<font color="#000080">); </font>buf<font color="#000080">[</font>bi<font color="#000080">]:=</font>dta<font color="#000080">;
        </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

    </font><font color="#FF0000"><b>until </b></font>index<font color="#000080">=</font><font color="#800000">320</font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>if </b></font>bi<font color="#000080">&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>flushit<font color="#000080">;

  </font>close<font color="#000080">(</font>fz<font color="#000080">);

  </font><font color="#008000"><i>{ Sounds the bell that everything is o.k. }
    </i></font>sound<font color="#000080">(</font><font color="#800000">800</font><font color="#000080">); </font>delay<font color="#000080">(</font><font color="#800000">200</font><font color="#000080">); </font>nosound<font color="#000080">;
    </font>sound<font color="#000080">(</font><font color="#800000">600</font><font color="#000080">); </font>delay<font color="#000080">(</font><font color="#800000">200</font><font color="#000080">); </font>nosound<font color="#000080">;


  </font>ok<font color="#000080">:=</font>true<font color="#000080">;

</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{ -------------------------------------------------------------------------}

</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to EGAVGA SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0271.PAS">Original</a><b>]</b></p></body>
</html>
