<html>
<head><title> "Some VESA BIOS Stuff" by DOYLE PATRICK</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to EGAVGA SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0238.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
From: doylep@ecf.toronto.edu (DOYLE  PATRICK)

  I'm having some trouble with a VESA SVGA interface I'm writing.
  As if you had nothing better to do :), I have included my source below.
It is supposed to make use if the VESA save/restore state function of
int $10, function $4F04.  The idea is that I have written one &quot;layer&quot; of
procedures which are simple BIOS interfaces, and they begin with &quot;B&quot;.
Then there is the more advanced layer, which doesn't.  Most of the functions
work OK, but this one I can't figure out.  If you can see the problem, great.
If you want more details, mail me at doylep@ecf.utoronto.ca.

  Thanks for any help.  Here's the source:
}

</i></font><font color="#FF0000"><b>type
    </b></font>SaveWhatEnumType <font color="#000080">= (</font>Hardware<font color="#000080">, </font>BIOS<font color="#000080">,  </font>DAC<font color="#000080">,   </font>SVGA<font color="#000080">,
                        </font>Res4<font color="#000080">,     </font>Res5<font color="#000080">,  </font>Res6<font color="#000080">,  </font>Res7<font color="#000080">,
                        </font>Res8<font color="#000080">,     </font>Res9<font color="#000080">,  </font>Res10<font color="#000080">, </font>Res11<font color="#000080">,
                        </font>Res12<font color="#000080">,    </font>Res13<font color="#000080">, </font>Res14<font color="#000080">, </font>Res15 <font color="#000080">);
    </font>SaveWhatType <font color="#000080">= </font><font color="#FF0000"><b>set of </b></font>SaveWhatEnumType<font color="#000080">;
    </font>StateType <font color="#000080">= </font><font color="#FF0000"><b>record
                      </b></font>SaveWhat <font color="#000080">: </font>SaveWhatType<font color="#000080">;
                      </font>MemSize  <font color="#000080">: </font>word<font color="#000080">;
                      </font>SavePtr  <font color="#000080">: </font>pointer<font color="#000080">;
                </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
 
</font><font color="#FF0000"><b>const
     </b></font>SaveAll <font color="#000080">= [</font>Hardware<font color="#000080">..</font>SVGA<font color="#000080">];
 

</font><font color="#FF0000"><b>var
   </b></font>VESAError       <font color="#000080">: </font>byte<font color="#000080">;
   </font>ModeSupportList <font color="#000080">: </font><font color="#FF0000"><b>array </b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">1</font><font color="#000080">] </font><font color="#FF0000"><b>of set of </b></font>byte<font color="#000080">;


</font><font color="#FF0000"><b>procedure </b></font>BState <font color="#000080">(</font>DoWhat  <font color="#000080">: </font>byte<font color="#000080">;
                </font>SaveWhat  <font color="#000080">: </font>word<font color="#000080">;
            </font><font color="#FF0000"><b>var    </b></font>State <font color="#008000"><i>{: word }  </i></font><font color="#000080">); </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">; 
 </font><font color="#FF0000"><b>asm
    </b></font><font color="#FF00FF">mov AX, $4F04
    mov DL, [DoWhat]
    mov CX, [SaveWhat]
    int $10
    cmp [DoWhat], $00
    jne @NeverMind
    mov word ptr State, BX
   @NeverMind:
 </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
 
</font><font color="#FF0000"><b>procedure </b></font>SaveState <font color="#000080">(</font>SaveWhat <font color="#000080">: </font>SaveWhatType<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>State <font color="#000080">: </font>StateType<font color="#000080">);
 </font><font color="#FF0000"><b>begin
      </b></font>BState <font color="#000080">(</font><font color="#800000">0</font><font color="#000080">, </font>word <font color="#000080">(</font>SaveWhat<font color="#000080">), </font>State<font color="#000080">.</font>MemSize<font color="#000080">);
      </font><font color="#FF0000"><b>if </b></font>VESAError <font color="#000080">&lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then
         </b></font>exit<font color="#000080">;
      </font>State<font color="#000080">.</font>SaveWhat <font color="#000080">:= </font>SaveWhat<font color="#000080">;
      </font><font color="#FF0000"><b>with </b></font>State <font color="#FF0000"><b>do
       begin
            if </b></font>MemSize <font color="#000080">&lt;= </font>MaxAvail <font color="#FF0000"><b>then
             begin
                  </b></font>getmem <font color="#000080">(</font>SavePtr<font color="#000080">, </font>MemSize<font color="#000080">);
                  </font>BState <font color="#000080">(</font><font color="#800000">1</font><font color="#000080">, </font>word <font color="#000080">(</font>SaveWhat<font color="#000080">), </font>SavePtr<font color="#000080">^);
             </font><font color="#FF0000"><b>end
            else
                </b></font>VESAError <font color="#000080">:= </font><font color="#800000">3</font><font color="#000080">;
       </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
 </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
 
</font><font color="#FF0000"><b>procedure </b></font>SetState  <font color="#000080">(</font>State <font color="#000080">: </font>StateType<font color="#000080">);
 </font><font color="#FF0000"><b>begin
      with </b></font>State <font color="#FF0000"><b>do
           </b></font>BState <font color="#000080">(</font><font color="#800000">2</font><font color="#000080">, </font>word <font color="#000080">(</font>SaveWhat<font color="#000080">), </font>SavePtr<font color="#000080">^);
 </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to EGAVGA SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0238.PAS">Original</a><b>]</b></p></body>
</html>
