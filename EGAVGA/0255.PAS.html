<html>
<head><title> "Watery Ripples" by MORTEN HANSEN</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to EGAVGA SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0255.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
 DD&gt; could anyone tell me how to simulate realtime moving watersurface ripples
 DD&gt; on a mode13h vga graphic picture ? something like getting the location of a
 DD&gt; pixel and then set that pixel at another location according to a sine orr
 DD&gt; a cos wave or something... i feel it has to be something lake that..

Is this what you had in mind?

{$G+}

</i></font><font color="#FF0000"><b>Uses
   </b></font>Crt<font color="#000080">;

</font><font color="#FF0000"><b>Const
   </b></font>SinTabSize                   <font color="#000080">= </font><font color="#800000">2048</font><font color="#000080">;
   </font>SinTabAmp                    <font color="#000080">= </font><font color="#800000">128</font><font color="#000080">;

</font><font color="#FF0000"><b>Type
   </b></font>ScrType                      <font color="#000080">= </font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">199</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">319</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Byte<font color="#000080">;
   </font>ScrPtr                       <font color="#000080">= ^</font>ScrType<font color="#000080">;
   </font>SinTabType                   <font color="#000080">= </font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font>SinTabSize<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Integer<font color="#000080">;
   </font>SinTabPtr                    <font color="#000080">= ^</font>SinTabType<font color="#000080">;

</font><font color="#FF0000"><b>Var
   </b></font>VisualScreen<font color="#000080">,</font>BufferScreen    <font color="#000080">: </font>ScrPtr<font color="#000080">;
   </font>SinTab                       <font color="#000080">: </font>SinTabPtr<font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>SetMode13<font color="#000080">;</font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Asm
   </b></font><font color="#FF00FF">mov   ax,0013h
   int   10h
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>PutPixel<font color="#000080">(</font>Scr<font color="#000080">:</font>ScrPtr<font color="#000080">;</font>x<font color="#000080">:</font>Integer<font color="#000080">;</font>y<font color="#000080">,</font>Col<font color="#000080">:</font>Byte<font color="#000080">);</font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Asm
   </b></font><font color="#FF00FF">les   di,Scr
   xor   bh,bh
   mov   bl,y
   shl   bx,6
   add   bh,y
   add   bx,x
   add   bx,di
   mov   al,Col
   mov   es:[bx],al
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>CopyScr<font color="#000080">(</font>Source<font color="#000080">,</font>Dest<font color="#000080">:</font>ScrPtr<font color="#000080">);</font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Asm
   </b></font><font color="#FF00FF">push  ds
   les   di,Dest
   lds   si,Source
   mov   cx,16000
   db    66h
   rep   movsw
   pop   ds
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>FillScr<font color="#000080">(</font>Scr<font color="#000080">:</font>ScrPtr<font color="#000080">;</font>Col<font color="#000080">:</font>Byte<font color="#000080">);</font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Asm
   </b></font><font color="#FF00FF">les   di,Scr
   mov   al,Col
   mov   ah,al
   db    66h
   shl   ax,16
   mov   al,col
   mov   ah,al
   mov   cx,16000
   db    66h
   rep   stosw
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>SetupSinTab<font color="#000080">;
</font><font color="#FF0000"><b>Var
   </b></font>n                            <font color="#000080">: </font>Integer<font color="#000080">;
   </font>a<font color="#000080">,</font>ast                        <font color="#000080">: </font>Real<font color="#000080">;
</font><font color="#FF0000"><b>Begin
   </b></font>a<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
   </font>ast<font color="#000080">:=</font><font color="#800000">2</font><font color="#000080">*</font>pi<font color="#000080">/</font>SinTabSize<font color="#000080">;
   </font><font color="#FF0000"><b>For </b></font>n<font color="#000080">:=</font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font>SinTabSize<font color="#000080">-</font><font color="#800000">1 </font><font color="#FF0000"><b>do
   Begin
      </b></font>SinTab<font color="#000080">^[</font>n<font color="#000080">]:=</font>Round<font color="#000080">(</font>SinTabAmp<font color="#000080">*</font>Sin<font color="#000080">(</font>a<font color="#000080">));
      </font>a<font color="#000080">:=</font>a<font color="#000080">+</font>ast
   <font color="#FF0000"><b>End
End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>DrawRipples<font color="#000080">;
</font><font color="#FF0000"><b>Var
   </b></font>Ang1<font color="#000080">,</font>Ang2                    <font color="#000080">: </font>Integer<font color="#000080">;
   </font>x<font color="#000080">,</font>z                          <font color="#000080">: </font>Integer<font color="#000080">;
   </font>Px<font color="#000080">,</font>Py<font color="#000080">,</font>Height                 <font color="#000080">: </font>Integer<font color="#000080">;
</font><font color="#FF0000"><b>Begin
   </b></font>Ang1<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
   </font>Ang2<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
   </font><font color="#FF0000"><b>Repeat
      </b></font>FillScr<font color="#000080">(</font>BufferScreen<font color="#000080">,</font><font color="#800000">200</font><font color="#000080">);
      </font><font color="#FF0000"><b>For </b></font>z<font color="#000080">:=-</font><font color="#800000">30 </font><font color="#FF0000"><b>to </b></font><font color="#000080">-</font><font color="#800000">10 </font><font color="#FF0000"><b>do
         For </b></font>x<font color="#000080">:=-</font><font color="#800000">20 </font><font color="#FF0000"><b>to </b></font><font color="#800000">20 </font><font color="#FF0000"><b>do
         Begin
            </b></font>Height<font color="#000080">:=
                    </font>SinTab<font color="#000080">^[(</font>Ang1<font color="#000080">+</font>x<font color="#000080">*</font><font color="#800000">32</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>SinTabSize<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">)]+
                    </font>SinTab<font color="#000080">^[(</font>Ang2<font color="#000080">+</font>z<font color="#000080">*</font><font color="#800000">32</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>SinTabSize<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">)];
            </font>Px<font color="#000080">:=</font><font color="#800000">64</font><font color="#000080">*</font>x <font color="#FF0000"><b>div </b></font>z<font color="#000080">;
            </font>Py<font color="#000080">:=(</font>Height<font color="#000080">+</font><font color="#800000">240</font><font color="#000080">) </font><font color="#FF0000"><b>div </b></font>z<font color="#000080">;
            </font>PutPixel<font color="#000080">(
                     </font>BufferScreen<font color="#000080">,
                     </font><font color="#800000">159</font><font color="#000080">+</font>Px<font color="#000080">,
                     </font><font color="#800000">99</font><font color="#000080">-</font>Py<font color="#000080">,
                     </font><font color="#800000">31</font><font color="#000080">-((</font>Height<font color="#000080">+</font><font color="#800000">256</font><font color="#000080">) </font><font color="#FF0000"><b>div </b></font><font color="#800000">64</font><font color="#000080">)
                    )
         </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
      </font>CopyScr<font color="#000080">(</font>BufferScreen<font color="#000080">,</font>VisualScreen<font color="#000080">);
      </font>Ang1<font color="#000080">:=</font>Ang1<font color="#000080">+</font><font color="#800000">17</font><font color="#000080">;
      </font>Ang1<font color="#000080">:=</font>Ang1 <font color="#FF0000"><b>and </b></font><font color="#000080">(</font>SinTabSize<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">);
      </font>Ang2<font color="#000080">:=</font>Ang2<font color="#000080">+</font><font color="#800000">12</font><font color="#000080">;
      </font>Ang2<font color="#000080">:=</font>Ang2 <font color="#FF0000"><b>and </b></font><font color="#000080">(</font>SinTabSize<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">)
   </font><font color="#FF0000"><b>Until </b></font>KeyPressed
<font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Begin
   </b></font>VisualScreen<font color="#000080">:=</font>Ptr<font color="#000080">(</font><font color="#800000">$A000</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">);
   </font>New<font color="#000080">(</font>BufferScreen<font color="#000080">);
   </font>New<font color="#000080">(</font>SinTab<font color="#000080">);
   </font>SetupSinTab<font color="#000080">;
   </font>SetMode13<font color="#000080">;
   </font>DrawRipples<font color="#000080">;
   </font>TextMode<font color="#000080">(</font>LastMode<font color="#000080">)
</font><font color="#FF0000"><b>End</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to EGAVGA SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0255.PAS">Original</a><b>]</b></p></body>
</html>
