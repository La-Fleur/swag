<html>
<head><title> "String Entry in Graphics Mode" by MICHAEL SLACK</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to EGAVGA SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0210.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
From: Michael Slack &lt;mgslack@rsoc.rockwell.com&gt;

&gt; I need a way to enter strings while in graphics mode.
&gt;
&gt; Right now, I am just using ReadLn...  for the first time I input a
&gt; string, it gets shown, just as it would in DOS, in the upper-left hand
&gt; corner of the screen.  This is just fine, as there are no important
&gt; screen elements there, and I can just erase it after the string is
&gt; entered.  But then, the next inputted string shows up on the next 'line'
&gt; of the screen, just like a normal text cursor would move down a line.  I
&gt; need a way to either select where (and preferably in which font) the text
&gt; would be entered, or a way to reposition the 'text' cursor back at its
&gt; original home position in the upper-left corner.  I really need this
&gt; SOON, so PLEASE, if ya know, mail or followup.  Thanks eversomuch...

Try using this.  I wrote it some time ago.

(* INCLUDE file for inputting text in graphics mode *)
}

(************************************************************************)
{ AUTHOR: Michael G. Slack                                               }
{ ENVIRONMENT: Turbo Pascal V6.0                                         }
{ PURPOSE: This include is used to implement a graphical input routine   }
{  for text strings.  It is general enough to be used by any graphics    }
{  mode.                                                                 }
(************************************************************************)

 </i></font><font color="#FF0000"><b>TYPE </b></font>CHARSET <font color="#000080">= </font><font color="#FF0000"><b>SET OF </b></font>CHAR<font color="#000080">;

 </font><font color="#FF0000"><b>CONST </b></font>Null    <font color="#000080">= </font><font color="#800000">#0</font><font color="#000080">;    </font><font color="#008000"><i>{constants brought from editln unit}
       </i></font>Bell    <font color="#000080">= ^</font>G<font color="#000080">;
       </font>BS      <font color="#000080">= </font><font color="#800000">#8</font><font color="#000080">;
       </font>LF      <font color="#000080">= </font><font color="#800000">#10</font><font color="#000080">;
       </font>CR      <font color="#000080">= </font><font color="#800000">#13</font><font color="#000080">;
       </font>ESC     <font color="#000080">= </font><font color="#800000">#27</font><font color="#000080">;
       </font>Space   <font color="#000080">= </font><font color="#800000">#32</font><font color="#000080">;
       </font>Tab     <font color="#000080">= ^</font>I<font color="#000080">;
       </font>BackTab <font color="#000080">= </font><font color="#800000">#143</font><font color="#000080">;

       </font>F1  <font color="#000080">= </font><font color="#800000">#187</font><font color="#000080">;
       </font>F2  <font color="#000080">= </font><font color="#800000">#188</font><font color="#000080">;
       </font>F3  <font color="#000080">= </font><font color="#800000">#189</font><font color="#000080">;
       </font>F4  <font color="#000080">= </font><font color="#800000">#190</font><font color="#000080">;
       </font>F5  <font color="#000080">= </font><font color="#800000">#191</font><font color="#000080">;
       </font>F6  <font color="#000080">= </font><font color="#800000">#192</font><font color="#000080">;
       </font>F7  <font color="#000080">= </font><font color="#800000">#193</font><font color="#000080">;
       </font>F8  <font color="#000080">= </font><font color="#800000">#194</font><font color="#000080">;
       </font>F9  <font color="#000080">= </font><font color="#800000">#195</font><font color="#000080">;
       </font>F10 <font color="#000080">= </font><font color="#800000">#196</font><font color="#000080">;

       </font>UpKey    <font color="#000080">= </font><font color="#800000">#200</font><font color="#000080">;
       </font>DownKey  <font color="#000080">= </font><font color="#800000">#208</font><font color="#000080">;
       </font>LeftKey  <font color="#000080">= </font><font color="#800000">#203</font><font color="#000080">;
       </font>RightKey <font color="#000080">= </font><font color="#800000">#205</font><font color="#000080">;
       </font>PgUpKey  <font color="#000080">= </font><font color="#800000">#201</font><font color="#000080">;
       </font>PgDnKey  <font color="#000080">= </font><font color="#800000">#209</font><font color="#000080">;
       </font>HomeKey  <font color="#000080">= </font><font color="#800000">#199</font><font color="#000080">;
       </font>EndKey   <font color="#000080">= </font><font color="#800000">#207</font><font color="#000080">;
       </font>InsKey   <font color="#000080">= </font><font color="#800000">#210</font><font color="#000080">;
       </font>DelKey   <font color="#000080">= </font><font color="#800000">#211</font><font color="#000080">;

       </font>MouseClick <font color="#000080">= </font><font color="#800000">#255</font><font color="#000080">;

</font><font color="#008000"><i>(************************************************************************)

 </i></font><font color="#FF0000"><b>FUNCTION </b></font>ScanKey <font color="#000080">: </font>CHAR<font color="#000080">;
     </font><font color="#008000"><i>(* Reads a key from the keyboard and converts 2 scan code escape *)
     (*  sequences into 1 character.                                  *)

    </i></font><font color="#FF0000"><b>VAR </b></font>Ch <font color="#000080">: </font>CHAR<font color="#000080">;

  </font><font color="#FF0000"><b>BEGIN </b></font><font color="#008000"><i>(*scankey*)
   </i></font><font color="#FF0000"><b>REPEAT UNTIL </b></font>KeyPressed <font color="#FF0000"><b>OR </b></font><font color="#000080">(</font>Mouse<font color="#000080">.</font>Event <font color="#000080">= </font><font color="#800000">$04</font><font color="#000080">)  </font><font color="#008000"><i>{left button released}
                           </i></font><font color="#FF0000"><b>OR </b></font><font color="#000080">(</font>Mouse<font color="#000080">.</font>Event <font color="#000080">= </font><font color="#800000">$10</font><font color="#000080">); </font><font color="#008000"><i>{right button released}
   </i></font><font color="#FF0000"><b>IF </b></font>Mouse<font color="#000080">.</font>Event <font color="#000080">&gt; </font><font color="#800000">0
    </font><font color="#FF0000"><b>THEN BEGIN
          </b></font>ScanKey <font color="#000080">:= </font>MouseClick<font color="#000080">; </font>Mouse<font color="#000080">.</font>Event <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
          </font>Exit<font color="#000080">;
         </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
   </font>Ch <font color="#000080">:= </font>ReadKey<font color="#000080">;
   </font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>Ch <font color="#000080">= </font><font color="#800000">#0</font><font color="#000080">) </font><font color="#FF0000"><b>AND </b></font>KeyPressed
    <font color="#FF0000"><b>THEN BEGIN
          </b></font>Ch <font color="#000080">:= </font>ReadKey<font color="#000080">;
          </font><font color="#FF0000"><b>IF </b></font>Ord<font color="#000080">(</font>Ch<font color="#000080">) &lt; </font><font color="#800000">128 </font><font color="#FF0000"><b>THEN </b></font>Ch <font color="#000080">:= </font>Chr<font color="#000080">(</font>Ord<font color="#000080">(</font>Ch<font color="#000080">) + </font><font color="#800000">128</font><font color="#000080">);
         </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
   </font>ScanKey <font color="#000080">:= </font>Ch<font color="#000080">;
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>(*scankey*)

(************************************************************************)

 </i></font><font color="#FF0000"><b>FUNCTION </b></font>CursorWait<font color="#000080">(</font>X<font color="#000080">,</font>Y<font color="#000080">,</font>FCol<font color="#000080">,</font>BCol <font color="#000080">: </font>INTEGER<font color="#000080">) : </font>CHAR<font color="#000080">;
     </font><font color="#008000"><i>(* function to wait for a keypress and return the key *)

    </i></font><font color="#FF0000"><b>VAR </b></font>XX <font color="#000080">: </font>INTEGER<font color="#000080">;

  </font><font color="#FF0000"><b>BEGIN </b></font><font color="#008000"><i>(*cursorwait*)
   </i></font>XX <font color="#000080">:= </font>X<font color="#000080">+</font>TextWidth<font color="#000080">(</font><font color="#800000">'M'</font><font color="#000080">);
   </font>Y <font color="#000080">:= </font>Y <font color="#000080">+ </font><font color="#800000">3 </font><font color="#000080">+ </font>TextHeight<font color="#000080">(</font><font color="#800000">'M'</font><font color="#000080">);
   </font><font color="#FF0000"><b>REPEAT
    </b></font>SetColor<font color="#000080">(</font>FCol<font color="#000080">); </font>Line<font color="#000080">(</font>X<font color="#000080">,</font>Y<font color="#000080">,</font>XX<font color="#000080">,</font>Y<font color="#000080">);
    </font>Delay<font color="#000080">(</font><font color="#800000">55</font><font color="#000080">);
    </font>SetColor<font color="#000080">(</font>BCol<font color="#000080">); </font>Line<font color="#000080">(</font>X<font color="#000080">,</font>Y<font color="#000080">,</font>XX<font color="#000080">,</font>Y<font color="#000080">);
    </font>Delay<font color="#000080">(</font><font color="#800000">55</font><font color="#000080">);
   </font><font color="#FF0000"><b>UNTIL </b></font>Keypressed <font color="#FF0000"><b>OR </b></font><font color="#000080">(</font>Mouse<font color="#000080">.</font>Event <font color="#000080">&gt; </font><font color="#800000">0</font><font color="#000080">);
   </font>CursorWait <font color="#000080">:= </font>ScanKey<font color="#000080">;
   </font>SetColor<font color="#000080">(</font>FCol<font color="#000080">);
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>(*cursorwait*)

(************************************************************************)

 </i></font><font color="#FF0000"><b>PROCEDURE </b></font>InputALineOfText<font color="#000080">(</font>L<font color="#000080">, </font>X<font color="#000080">, </font>Y <font color="#000080">: </font>INTEGER<font color="#000080">; </font>Legal<font color="#000080">, </font>Terms <font color="#000080">: </font>CHARSET<font color="#000080">;
                            </font><font color="#FF0000"><b>VAR </b></font>S <font color="#000080">: </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">; </font><font color="#FF0000"><b>VAR </b></font>TC <font color="#000080">: </font>CHAR<font color="#000080">);
     </font><font color="#008000"><i>(* procedure to allow an input of a line of text at an xy loc *)
     (* in graphics mode.  Will place cursor at end of string pas- *)
     (* sed. will need to use editln.tpu (from database toolbox).  *)

    </i></font><font color="#FF0000"><b>VAR </b></font>P<font color="#000080">, </font>PP <font color="#000080">: </font>INTEGER<font color="#000080">;
        </font>Ch    <font color="#000080">: </font>CHAR <font color="#FF0000"><b>ABSOLUTE </b></font>TC<font color="#000080">;
        </font>SStr  <font color="#000080">: </font><font color="#FF0000"><b>STRING</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">];
        </font>CSave <font color="#000080">: </font>BYTE<font color="#000080">;

  </font><font color="#FF0000"><b>BEGIN </b></font><font color="#008000"><i>(*inputalineoftext*)
   </i></font>P  <font color="#000080">:= </font>Length<font color="#000080">(</font>S<font color="#000080">);
   </font>PP <font color="#000080">:= </font>TextWidth<font color="#000080">(</font>S<font color="#000080">);
   </font>OutTextXY<font color="#000080">(</font>X<font color="#000080">,</font>Y<font color="#000080">,</font>S<font color="#000080">);
   </font><font color="#FF0000"><b>REPEAT
    </b></font>Ch <font color="#000080">:= </font>CursorWait<font color="#000080">(</font>X<font color="#000080">+</font>PP<font color="#000080">,</font>Y<font color="#000080">,</font>GetColor<font color="#000080">,</font>Black<font color="#000080">);
    </font><font color="#FF0000"><b>CASE </b></font>Ch <font color="#FF0000"><b>OF
     </b></font><font color="#800000">#32</font><font color="#000080">..</font><font color="#800000">#126 </font><font color="#000080">: </font><font color="#FF0000"><b>IF </b></font><font color="#000080">(</font>P <font color="#000080">&lt; </font>L<font color="#000080">) </font><font color="#FF0000"><b>AND </b></font><font color="#000080">(</font>Ch <font color="#FF0000"><b>IN </b></font>Legal<font color="#000080">)
                  </font><font color="#FF0000"><b>THEN BEGIN
                        IF </b></font>Length<font color="#000080">(</font>S<font color="#000080">) = </font>L <font color="#FF0000"><b>THEN </b></font>Delete<font color="#000080">(</font>S<font color="#000080">,</font>L<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">);
                        </font>Inc<font color="#000080">(</font>P<font color="#000080">);
                        </font>Insert<font color="#000080">(</font>Ch<font color="#000080">,</font>S<font color="#000080">,</font>P<font color="#000080">);
                        </font>SStr <font color="#000080">:= </font>Ch<font color="#000080">;
                        </font>OutTextXY<font color="#000080">(</font>X<font color="#000080">+</font>PP<font color="#000080">,</font>Y<font color="#000080">,</font>SStr<font color="#000080">);
                        </font>PP <font color="#000080">:= </font>PP <font color="#000080">+ </font>TextWidth<font color="#000080">(</font>SStr<font color="#000080">)
                       </font><font color="#FF0000"><b>END
                 ELSE </b></font>Write<font color="#000080">(</font>Bell<font color="#000080">);
     </font>BS<font color="#000080">, </font><font color="#800000">#127</font><font color="#000080">,
     </font>LeftKey   <font color="#000080">: </font><font color="#FF0000"><b>IF </b></font>P <font color="#000080">&gt; </font><font color="#800000">0
                  </font><font color="#FF0000"><b>THEN BEGIN
                        </b></font>SStr <font color="#000080">:= </font>S<font color="#000080">[</font>P<font color="#000080">];
                        </font>CSave <font color="#000080">:= </font>GetColor<font color="#000080">;
                        </font>SetColor<font color="#000080">(</font>GetBkColor<font color="#000080">);
                        </font>PP <font color="#000080">:= </font>PP <font color="#000080">- </font>TextWidth<font color="#000080">(</font>SStr<font color="#000080">);
                        </font>Delete<font color="#000080">(</font>S<font color="#000080">,</font>P<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">);
                        </font>Dec<font color="#000080">(</font>P<font color="#000080">);
                        </font>OutTextXY<font color="#000080">(</font>X<font color="#000080">+</font>PP<font color="#000080">,</font>Y<font color="#000080">,</font>SStr<font color="#000080">);
                        </font>SetColor<font color="#000080">(</font>CSave<font color="#000080">);
                       </font><font color="#FF0000"><b>END
                 ELSE </b></font>Write<font color="#000080">(</font>Bell<font color="#000080">);
     </font><font color="#FF0000"><b>ELSE IF NOT</b></font><font color="#000080">(</font>Ch <font color="#FF0000"><b>IN </b></font>Terms<font color="#000080">) </font><font color="#FF0000"><b>THEN </b></font>Write<font color="#000080">(</font>Bell<font color="#000080">);
    </font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>{case}
    </i></font>ClearKB<font color="#000080">;
   </font><font color="#FF0000"><b>UNTIL </b></font>Ch <font color="#FF0000"><b>IN  </b></font>Terms<font color="#000080">;
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">; </font><font color="#008000"><i>(*inputalineoftext*)

</i></font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to EGAVGA SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0210.PAS">Original</a><b>]</b></p></body>
</html>
