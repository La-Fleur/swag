<html>
<head><title> "Protected-Mode (DPMI) Vesa Info" by RYSZARD SZKLENNIK</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to EGAVGA SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0260.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{Tested under BP7.01 in Win'95, protected mode target: }

</i></font><font color="#FF0000"><b>program </b></font>VesaInfo<font color="#000080">;
</font><font color="#FF0000"><b>uses </b></font>DPMI<font color="#000080">,</font>WinAPI<font color="#000080">,</font>WinDOS<font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>GetVESAInfo<font color="#000080">;
</font><font color="#FF0000"><b>type
  </b></font>PVESAInfo <font color="#000080">= ^</font>TVESAInfo<font color="#000080">;
  </font>TVESAInfo <font color="#000080">= </font><font color="#FF0000"><b>array </b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">511</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">;
</font><font color="#FF0000"><b>var
  </b></font>i<font color="#000080">:         </font>byte<font color="#000080">;
  </font>SegAndSel<font color="#000080">: </font>longint<font color="#000080">;
  </font>VESAInfo<font color="#000080">:  </font>PVESAInfo<font color="#000080">;
  </font>Regs<font color="#000080">:      </font>TRealModeRegs<font color="#000080">;

</font><font color="#FF0000"><b>begin
  </b></font>SegAndSel<font color="#000080">:=</font>GlobalDOSAlloc<font color="#000080">(</font>SizeOf<font color="#000080">(</font>TVESAInfo<font color="#000080">));
  </font><font color="#FF0000"><b>if </b></font>SegAndSel<font color="#000080">=</font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>writeln<font color="#000080">(</font><font color="#800000">'Can''t allocate DOS memory for VESA Info.'</font><font color="#000080">)
  </font><font color="#FF0000"><b>else begin
    </b></font>VESAInfo<font color="#000080">:=</font>Ptr<font color="#000080">(</font>LoWord<font color="#000080">(</font>SegAndSel<font color="#000080">),</font><font color="#800000">0</font><font color="#000080">);
    </font>FillChar<font color="#000080">(</font>Regs<font color="#000080">,</font>SizeOf<font color="#000080">(</font>Regs<font color="#000080">),</font><font color="#800000">#0</font><font color="#000080">);
    </font>Regs<font color="#000080">.</font>AX<font color="#000080">:=</font><font color="#800000">$4F00</font><font color="#000080">;
    </font>Regs<font color="#000080">.</font>ES<font color="#000080">:=</font>HiWord<font color="#000080">(</font>SegAndSel<font color="#000080">);
    </font><font color="#008000"><i>{ Regs.DI:=0; - done already by FillChar }
    </i></font>RealModeInt<font color="#000080">(</font><font color="#800000">$10</font><font color="#000080">,</font>Regs<font color="#000080">);
    </font><font color="#FF0000"><b>if </b></font>Regs<font color="#000080">.</font>AX<font color="#000080">=</font><font color="#800000">$4F </font><font color="#FF0000"><b>then begin
      for </b></font>i<font color="#000080">:=</font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font><font color="#800000">3 </font><font color="#FF0000"><b>do </b></font>write<font color="#000080">(</font>Char<font color="#000080">(</font>VesaInfo<font color="#000080">^[</font>i<font color="#000080">]));
      </font>write<font color="#000080">(</font><font color="#800000">' v.'</font><font color="#000080">,</font>VesaInfo<font color="#000080">^[</font><font color="#800000">5</font><font color="#000080">]:</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">'.'</font><font color="#000080">);
      </font><font color="#FF0000"><b>if </b></font>VesaInfo<font color="#000080">^[</font><font color="#800000">4</font><font color="#000080">]&lt;</font><font color="#800000">10 </font><font color="#FF0000"><b>then </b></font>write<font color="#000080">(</font><font color="#800000">'0'</font><font color="#000080">);
      </font>writeln<font color="#000080">(</font>VesaInfo<font color="#000080">^[</font><font color="#800000">4</font><font color="#000080">]:</font><font color="#800000">1</font><font color="#000080">);
      </font><font color="#008000"><i>{ process VESAInfo here }
    </i></font><font color="#FF0000"><b>end else begin
      </b></font>write<font color="#000080">(</font><font color="#800000">'Can''t load VESA information: '</font><font color="#000080">);
      </font><font color="#FF0000"><b>if </b></font>Regs<font color="#000080">.</font>AL<font color="#000080">&lt;&gt;</font><font color="#800000">$4F </font><font color="#FF0000"><b>then </b></font>writeln<font color="#000080">(</font><font color="#800000">'VESA BIOS not loaded.'</font><font color="#000080">)
      </font><font color="#FF0000"><b>else case </b></font>Regs<font color="#000080">.</font>AH <font color="#FF0000"><b>of
        </b></font><font color="#800000">1</font><font color="#000080">: </font>writeln<font color="#000080">(</font><font color="#800000">'VESA BIOS call failed.'</font><font color="#000080">);
        </font><font color="#800000">2</font><font color="#000080">: </font>writeln<font color="#000080">(</font><font color="#800000">'function not supported by hardware configuration.'</font><font color="#000080">);
        </font><font color="#800000">3</font><font color="#000080">: </font>writeln<font color="#000080">(</font><font color="#800000">'function invalid in current video mode.'</font><font color="#000080">);
        </font><font color="#FF0000"><b>else </b></font>writeln<font color="#000080">(</font><font color="#800000">'unknown VESA BIOS error.'</font><font color="#000080">);
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font>GlobalDOSFree<font color="#000080">(</font>LoWord<font color="#000080">(</font>SegAndSel<font color="#000080">));
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>begin
  </b></font>GetVESAInfo<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to EGAVGA SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0260.PAS">Original</a><b>]</b></p></body>
</html>
