<html>
<head><title> "Mono PCX Viewer" by ANDREAS OESTLUND</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to EGAVGA SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0162.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
With this program you can view monocrome pcx files, smaller than 60KB. It
will only work on VGA cards.

A Program to view monocrome PCX files

A MacSoft production in 1994 by Andreas Oestlund
}
</i></font><font color="#FF0000"><b>Type
    </b></font>TPCX_Header <font color="#000080">= </font><font color="#FF0000"><b>Record
                        </b></font>Manufacturer   <font color="#000080">: </font>Byte<font color="#000080">;                </font><font color="#008000"><i>{always A0h }
                        </i></font>Version        <font color="#000080">: </font>Byte<font color="#000080">;                </font><font color="#008000"><i>{version }
                        </i></font>Encoding       <font color="#000080">: </font>Byte<font color="#000080">;                </font><font color="#008000"><i>{always 1}
                        </i></font>Bits_Per_Pixel <font color="#000080">: </font>Byte<font color="#000080">;                </font><font color="#008000"><i>{color bits}
                        </i></font>XMin<font color="#000080">,</font>YMin      <font color="#000080">: </font>Word<font color="#000080">;                </font><font color="#008000"><i>{image origin}
                        </i></font>XMax<font color="#000080">,</font>YMax      <font color="#000080">: </font>Word<font color="#000080">;                </font><font color="#008000"><i>{dimensions}
                        </i></font>HRes           <font color="#000080">: </font>Word<font color="#000080">;                </font><font color="#008000"><i>{resolution val}
                        </i></font>VRes           <font color="#000080">: </font>Word<font color="#000080">;                </font><font color="#008000"><i>{}
                        </i></font>Palette        <font color="#000080">: </font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">48</font><font color="#000080">] </font><font color="#FF0000"><b>Of </b></font>Byte<font color="#000080">;</font><font color="#008000"><i>{palette}
                        </i></font>Reserved       <font color="#000080">: </font>Byte<font color="#000080">;                </font><font color="#008000"><i>{}
                        </i></font>Color_Planes   <font color="#000080">: </font>Byte<font color="#000080">;                </font><font color="#008000"><i>{color planes}
                        </i></font>Bytes_Per_Line <font color="#000080">: </font>Word<font color="#000080">;                </font><font color="#008000"><i>{line buffer
size}                        </i></font>Palette_Type   <font color="#000080">: </font>Word<font color="#000080">;                </font><font color="#008000"><i>{gray or
color pal}                        </i></font>Filler         <font color="#000080">: </font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">58</font><font color="#000080">] </font><font color="#FF0000"><b>Of </b></font>Byte<font color="#000080">;</font><font color="#008000"><i>{}
                  </i></font><font color="#FF0000"><b>End</b></font><font color="#000080">;

    </font>TPCXData    <font color="#000080">= </font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">60000</font><font color="#000080">] </font><font color="#FF0000"><b>Of </b></font>Byte<font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>SetMode <font color="#000080">(</font>m <font color="#000080">: </font>Byte<font color="#000080">); </font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;
     </font><font color="#FF0000"><b>Asm
          </b></font><font color="#FF00FF">Mov  AH, 0
          Mov  AL, m
          Int  10h
     </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Var
   </b></font>Header     <font color="#000080">: </font>TPCX_Header<font color="#000080">;
   </font>F          <font color="#000080">: </font><font color="#FF0000"><b>File</b></font><font color="#000080">;
   </font>B<font color="#000080">,</font>C        <font color="#000080">: </font>Byte<font color="#000080">;
   </font>Line_Table <font color="#000080">: </font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">479</font><font color="#000080">] </font><font color="#FF0000"><b>Of </b></font>Word<font color="#000080">;
   </font>PcxData    <font color="#000080">: ^</font>TPcxData<font color="#000080">;

   </font>Width<font color="#000080">,
   </font>Height<font color="#000080">,
   </font>Bytes_Per_Line <font color="#000080">: </font>Word<font color="#000080">;

   </font>NuRead         <font color="#000080">: </font>Word<font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>Decode_PCX_Line <font color="#000080">(</font>l <font color="#000080">: </font>Word<font color="#000080">);
</font><font color="#FF0000"><b>Var
   </b></font>i<font color="#000080">,</font>j      <font color="#000080">: </font>Word<font color="#000080">;

</font><font color="#FF0000"><b>Const
     </b></font>Data_NDX <font color="#000080">: </font>Word <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">;

     </font><font color="#FF0000"><b>Begin
          </b></font>i <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
          </font><font color="#FF0000"><b>While </b></font>i <font color="#000080">&lt; </font>Bytes_Per_Line <font color="#FF0000"><b>Do
              Begin
                   </b></font>Inc <font color="#000080">(</font>Data_NDX<font color="#000080">);
                   </font>B <font color="#000080">:= </font>PcxData<font color="#000080">^[</font>Data_NDX<font color="#000080">];

                   </font><font color="#FF0000"><b>If </b></font><font color="#000080">(</font>B <font color="#FF0000"><b>And </b></font><font color="#800000">$C0</font><font color="#000080">) = </font><font color="#800000">$C0 </font><font color="#FF0000"><b>Then
                    Begin
                         </b></font>B <font color="#000080">:= </font>B <font color="#FF0000"><b>And </b></font><font color="#800000">$3F</font><font color="#000080">;

                         </font>Inc <font color="#000080">(</font>Data_NDX<font color="#000080">);
                         </font>C <font color="#000080">:= </font>PcxData<font color="#000080">^[</font>Data_NDX<font color="#000080">];
                         </font><font color="#FF0000"><b>For </b></font>j <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>To </b></font>B <font color="#FF0000"><b>Do
                           Begin
                                </b></font>Mem<font color="#000080">[</font><font color="#800000">$A000</font><font color="#000080">:</font>Line_Table<font color="#000080">[</font>l<font color="#000080">]+</font>i<font color="#000080">] := </font>C<font color="#000080">;
                                </font>Inc <font color="#000080">(</font>i<font color="#000080">);
                           </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
                    </font><font color="#FF0000"><b>End
                   Else
                       Begin
                            </b></font>Mem<font color="#000080">[</font><font color="#800000">$A000</font><font color="#000080">:</font>Line_Table<font color="#000080">[</font>l<font color="#000080">]+</font>i<font color="#000080">] := </font>B<font color="#000080">;
                            </font>Inc <font color="#000080">(</font>i<font color="#000080">);
                       </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
              </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
     </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Var
   </b></font>i <font color="#000080">: </font>Word<font color="#000080">;
   </font>Mem2Get <font color="#000080">: </font>Word<font color="#000080">;

</font><font color="#FF0000"><b>Begin
     If </b></font>Paramcount <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>HALT<font color="#000080">;
     </font>Assign <font color="#000080">(</font>F<font color="#000080">,</font>ParamStr<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">));
     </font>Reset <font color="#000080">(</font>F<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">);

     </font>BlockRead <font color="#000080">(</font>F<font color="#000080">,</font>Header<font color="#000080">,</font>SizeOf<font color="#000080">(</font>TPCX_Header<font color="#000080">));
     </font>Width  <font color="#000080">:= (</font>Header<font color="#000080">.</font>XMax <font color="#000080">- </font>Header<font color="#000080">.</font>XMax<font color="#000080">)+</font><font color="#800000">1</font><font color="#000080">;
     </font>Height <font color="#000080">:= (</font>Header<font color="#000080">.</font>YMax <font color="#000080">- </font>Header<font color="#000080">.</font>YMin<font color="#000080">)+</font><font color="#800000">1</font><font color="#000080">;
     </font>Bytes_Per_Line <font color="#000080">:= </font>Header<font color="#000080">.</font>Bytes_Per_Line<font color="#000080">;
     </font><font color="#FF0000"><b>For </b></font>i <font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>To </b></font><font color="#800000">479 </font><font color="#FF0000"><b>Do </b></font>Line_Table<font color="#000080">[</font>i<font color="#000080">] := </font>i<font color="#000080">*</font><font color="#800000">80</font><font color="#000080">;

     </font>Mem2Get <font color="#000080">:= </font>FileSize<font color="#000080">(</font>F<font color="#000080">) - </font>FilePos<font color="#000080">(</font>F<font color="#000080">);
     </font>GetMem <font color="#000080">(</font>PcxData<font color="#000080">,</font>Mem2Get<font color="#000080">);
     </font>BlockRead <font color="#000080">(</font>F<font color="#000080">,</font>PcxData<font color="#000080">^,</font><font color="#800000">60000</font><font color="#000080">,</font>NuRead<font color="#000080">);

     </font>SetMode <font color="#000080">(</font><font color="#800000">$12</font><font color="#000080">);

     </font><font color="#FF0000"><b>For </b></font>i <font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>To </b></font><font color="#000080">(</font>Height<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">) </font><font color="#FF0000"><b>Do </b></font>Decode_PCX_Line <font color="#000080">(</font>i<font color="#000080">);

     </font>Readln<font color="#000080">;

     </font>FreeMem <font color="#000080">(</font>PcxData<font color="#000080">,</font>Mem2Get<font color="#000080">);
     </font>SetMode <font color="#000080">(</font><font color="#800000">3</font><font color="#000080">);
     </font>Close <font color="#000080">(</font>F<font color="#000080">);
</font><font color="#FF0000"><b>End</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to EGAVGA SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0162.PAS">Original</a><b>]</b></p></body>
</html>
