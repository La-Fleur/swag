<html>
<head><title> "Multicolor Wormhole Dance!" by WIL BARATH</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to EGAVGA SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0240.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{$M 4096,0,0}
{$a+,b-,d+,e-,f-,g+,i+,l+,n-,o-,p-,q-,r-,s+,t-,v+,x+}

{ if you have a 386 or better 'uncomment' the next line }
{define cpu386}

{ if you want circles 'incomment' the next line }
{$define CIRCLES }

</i></font><font color="#FF0000"><b>Program </b></font>WrmhDance<font color="#000080">; </font><font color="#008000"><i>{ Demo by Wil Barath Oct 1994, Public Domain }
     { Based on Vortex demo by ??? } 
</i></font><font color="#FF0000"><b>Var
  </b></font>Map<font color="#000080">:</font>word<font color="#000080">; </font><font color="#008000"><i>{used as a pointer to the bitmap}
  </i></font>stab<font color="#000080">,</font>ctab<font color="#000080">:</font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">255</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>integer<font color="#000080">;
  </font>virseg<font color="#000080">:</font>word<font color="#000080">;
  </font>lstep<font color="#000080">:</font>byte<font color="#000080">;
</font><font color="#FF0000"><b>const
  </b></font>vidseg<font color="#000080">:</font>word<font color="#000080">=</font><font color="#800000">$a000</font><font color="#000080">;
  </font>pfx<font color="#000080">=</font><font color="#800000">1</font><font color="#000080">;    </font><font color="#008000"><i>{try '1' for weird palette fx}
  </i></font>SlowMode<font color="#000080">:</font>Boolean<font color="#000080">=</font>False<font color="#000080">;
  </font>Circles<font color="#000080">:</font>Boolean<font color="#000080">=</font>False<font color="#000080">;
</font><font color="#FF0000"><b>Procedure </b></font>AllocateMem<font color="#000080">;  </font><font color="#008000"><i>{returns a segment pointer for a 64K bitmap}
</i></font><font color="#FF0000"><b>label </b></font>noerror<font color="#000080">;
</font><font color="#FF0000"><b>begin
     asm
              </b></font><font color="#FF00FF">mov   ah,$48
              mov   bx,$1000     </font><font color="#008000"><i>{ request 64K }
              </i></font><font color="#FF00FF">int   $21
              jnc   noerror
              mov   ax,0000
     noerror: mov   Map,ax       </font><font color="#008000"><i>{ The segment pointer goes in Map }
              </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;
     </font><font color="#FF0000"><b>If </b></font>Map<font color="#000080">=</font><font color="#800000">0 </font><font color="#FF0000"><b>then begin
        </b></font>Writeln<font color="#000080">(</font><font color="#800000">'Could not allocate enough memory'</font><font color="#000080">);
        </font>Writeln<font color="#000080">(</font><font color="#800000">'Program ending...'</font><font color="#000080">);
        </font>Halt<font color="#000080">;</font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>GiveBackMem<font color="#000080">; </font><font color="#008000"><i>{returns the memory used for the map to the system}
</i></font><font color="#FF0000"><b>begin
     asm
        </b></font><font color="#FF00FF">mov  ah,$49
        mov  dx,Map
        mov  es,dx
        int  $21
     </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>procedure </b></font>setpal<font color="#000080">(</font>col<font color="#000080">,</font>r<font color="#000080">,</font>g<font color="#000080">,</font>b <font color="#000080">: </font>byte<font color="#000080">); </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>asm
  </b></font><font color="#FF00FF">mov dx,03c8h
  mov al,col
  out dx,al
  inc dx
  mov al,r
  out dx,al
  mov al,g
  out dx,al
  mov al,b
  out dx,al
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>cls<font color="#000080">(</font>lvseg<font color="#000080">:</font>word<font color="#000080">); </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>asm
  </b></font><font color="#FF00FF">mov es,[lvseg]
  xor di,di
  xor ax,ax
</font><font color="#008000"><i>{$ifdef cpu386}
  </i></font><font color="#FF00FF">mov cx,256*256/4
  rep
  db $66; stosw
</font><font color="#008000"><i>{$else}
  </i></font><font color="#FF00FF">mov cx,256*256/2
  rep stosw
</font><font color="#008000"><i>{$endif}
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>retrace<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>asm
  </b></font><font color="#FF00FF">mov dx,03dah
 @vert1:
  in al,dx
  test al,8
  jnz @vert1
 @vert2:
  in al,dx
  test al,8
  jz @vert2
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Var </b></font>cotable<font color="#000080">:</font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">256</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Integer<font color="#000080">;
</font><font color="#FF0000"><b>Const </b></font>costabptr<font color="#000080">:</font>Pointer<font color="#000080">=(@</font>CoTable<font color="#000080">);
</font><font color="#008000"><i>{----------------------------------------------------------------------}
</i></font><font color="#FF0000"><b>Procedure </b></font>VideoMode<font color="#000080">(</font>mode<font color="#000080">:</font>word<font color="#000080">);</font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Asm </b></font><font color="#FF00FF">Mov ax,mode;Int 10h;</font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Function </b></font>MouseExists<font color="#000080">:</font>Boolean<font color="#000080">;</font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>asm </b></font><font color="#FF00FF">Xor ax,ax;Int 33h;</font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Function </b></font>MouseAt<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>X<font color="#000080">:</font>Word<font color="#000080">;</font><font color="#FF0000"><b>Var </b></font>y<font color="#000080">:</font>Word<font color="#000080">):</font>Word<font color="#000080">;</font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>asm </b></font><font color="#FF00FF">Mov ax,03h;Int 33h;Les di,x;Mov ES:[DI],cx;Les di,y;Mov ES:[DI],dx
Mov ax,bx;</font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Function </b></font>Readkey<font color="#000080">:</font>Char<font color="#000080">;</font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>asm </b></font><font color="#FF00FF">Xor ax,ax;Int 16h;</font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Function </b></font>Keypressed<font color="#000080">:</font>Boolean<font color="#000080">;</font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>asm </b></font><font color="#FF00FF">Mov ax,0100h;int 16h;Jnz @1;Xor ax,ax;@1:
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Function </b></font>MouseStatus<font color="#000080">:</font>LongInt<font color="#000080">;</font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>asm </b></font><font color="#FF00FF">Xor ax,ax;Int 33h;</font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Procedure </b></font>Pset<font color="#000080">(</font>x<font color="#000080">,</font>y<font color="#000080">,</font>c<font color="#000080">:</font>byte<font color="#000080">);</font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>asm </b></font><font color="#FF00FF">mov es,virseg;mov bh,y;Mov bl,x;Mov al,c;Mov es:[bx],al;</font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Var </b></font>ra<font color="#000080">,</font>rb<font color="#000080">,</font>rc<font color="#000080">:</font>Word<font color="#000080">;
</font><font color="#FF0000"><b>Function </b></font>rand<font color="#000080">:</font>Word<font color="#000080">; </font><font color="#FF0000"><b>Near </b></font><font color="#000080">;</font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>asm </b></font><font color="#FF00FF">Mov ax,ra; Add ax,ax; Adc ax,904; Xor ax,$aaaa;Mov ra,ax;Xor ax,rb;Mov rb,ax;
Xor ax,rc; Mov rc,ax; </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Function </b></font>random<font color="#000080">(</font>n<font color="#000080">:</font>Word<font color="#000080">):</font>Word<font color="#000080">; </font><font color="#FF0000"><b>Near </b></font><font color="#000080">;</font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>asm </b></font><font color="#FF00FF">Call Rand; Mul n;Mov ax,dx;</font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Procedure </b></font>mktabl<font color="#000080">;</font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;             </font><font color="#008000"><i>{generates Sine approx. table}
</i></font><font color="#FF0000"><b>Const </b></font>x<font color="#000080">:</font>Integer<font color="#000080">=</font><font color="#800000">127</font><font color="#000080">*</font><font color="#800000">256</font><font color="#000080">+</font><font color="#800000">221</font><font color="#000080">;</font>y<font color="#000080">:</font>integer<font color="#000080">=</font><font color="#800000">0</font><font color="#000080">;</font><font color="#008000"><i>{much smaller than using BP's}
</i></font><font color="#FF0000"><b>label </b></font>cosloop<font color="#000080">;                          </font><font color="#008000"><i>{FP math to make it!         }
</i></font><font color="#FF0000"><b>asm                                     </b></font><font color="#008000"><i>{Oct 10/94 by Wil Barath     }
  </i></font><font color="#FF00FF">Mov si,804      </font><font color="#008000"><i>{sine portion of O }
  </i></font><font color="#FF00FF">Mov bx,32758    </font><font color="#008000"><i>{cosine portion of O }
  </i></font><font color="#FF00FF">Mov cx,256      </font><font color="#008000"><i>{number of degrees in our circle}
  </i></font><font color="#FF00FF">Les di,costabptr</font><font color="#008000"><i>{destination for our table}
  </i></font><font color="#FF00FF">Push bp
cosloop:
  Mov ax,x
  stosw
  Imul bx
  adc dx,dx
  Mov bp,dx       </font><font color="#008000"><i>{bp:= x*cos(O)}
  </i></font><font color="#FF00FF">Mov ax,si
  Imul y
  adc dx,dx
  Sub bp,dx       </font><font color="#008000"><i>{bp:= x*cos(O)-y*sin(O)}
  </i></font><font color="#FF00FF">Mov ax,bp
  Mov al,ah
  Mov ax,si
  Imul x
  adc dx,dx
  Mov x,bp        </font><font color="#008000"><i>{x:=bp}
  </i></font><font color="#FF00FF">Mov bp,dx       </font><font color="#008000"><i>{bp:= x*sin(O)}
  </i></font><font color="#FF00FF">Mov ax,bx
  Imul y
  adc dx,dx
  add bp,dx       </font><font color="#008000"><i>{bp:= x*sin(O)+y*cos(O)}
  </i></font><font color="#FF00FF">Mov y,bp        </font><font color="#008000"><i>{y:=bp}
  </i></font><font color="#FF00FF">Loop cosloop
  Pop bp
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#008000"><i>{----------------------------------------------------------------------}
</i></font><font color="#FF0000"><b>Procedure </b></font>DrawScreen<font color="#000080">(</font>x<font color="#000080">,</font>y<font color="#000080">,</font>scale<font color="#000080">:</font>Word<font color="#000080">;</font>rot<font color="#000080">:</font>word<font color="#000080">);</font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>label </b></font>start<font color="#000080">,</font>hloop<font color="#000080">,</font>vloop<font color="#000080">;
</font><font color="#FF0000"><b>Procedure </b></font>I<font color="#000080">;</font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;</font><font color="#FF0000"><b>asm </b></font><font color="#FF00FF">db 0;</font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{fool the compiler into giving us}
</i></font><font color="#FF0000"><b>Procedure </b></font>j<font color="#000080">;</font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;</font><font color="#FF0000"><b>asm </b></font><font color="#FF00FF">db 0;</font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{2 WORD variables in CODE segment}
</i></font><font color="#FF0000"><b>asm
  </b></font><font color="#FF00FF">push ds    </font><font color="#008000"><i>{ gotta save these or all hell breaks loose :-( }
  </i></font><font color="#FF00FF">Push bp
  Mov bx,rot </font><font color="#008000"><i>{compute scanning vectors}
  </i></font><font color="#FF00FF">Add bx,bx
  Mov ax,word(cotable[bx])
  Imul scale </font><font color="#008000"><i>{result in dx = scale*(ah/256)+scale*(al/65536)}
  </i></font><font color="#FF00FF">Mov si,dx  </font><font color="#008000"><i>{thusly si:=costable[rot]*scale/256}
  </i></font><font color="#FF00FF">Add bx,128
  AND bx,511
  Mov ax,word(cotable[bx])
  Imul scale
  Mov cx,dx  </font><font color="#008000"><i>{cx:=costable[(rot+64)Mod 256]*scale/256}
             {this gives us the same as sin(...)}
  </i></font><font color="#FF00FF">Mov bx,x   </font><font color="#008000"><i>{compute screen center for rotation}
  </i></font><font color="#FF00FF">Mov ax,160
  Mul si
  Sub bx,ax
  Mov ax,100
  Mul cx
  add bx,ax
  Mov Word(i),bx    </font><font color="#008000"><i>{i:=x-si*160+cx*100}
 </i></font><font color="#FF00FF">Mov bx,y
  Mov ax,160
  Mul cx
  Sub bx,ax
  Mov ax,100
  Mul si
  Sub bx,ax
  Mov Word(j),bx    </font><font color="#008000"><i>{j:=y-cx*160-si*100}
  </i></font><font color="#FF00FF">Mov  bp,cx        </font><font color="#008000"><i>{ put movement vector component here...}
                    { from here on we can't reference STACK variables...}
  </i></font><font color="#FF00FF">mov  ax,[Map]     </font><font color="#008000"><i>{ get segment of bitmap (in the DATA segment)}
  </i></font><font color="#FF00FF">mov  ds,ax
  mov  ax,$a000     </font><font color="#008000"><i>{ set es: to video memory}
  </i></font><font color="#FF00FF">mov  es,ax
  sub  di,di        </font><font color="#008000"><i>{ start at 0,0 on the screen}
  </i></font><font color="#FF00FF">mov  cx,200       </font><font color="#008000"><i>{ Number of rows on Screen}
{-----This section has been hyper-optimised for 286+-------------------}
</i></font><font color="#FF00FF">vloop:
  push cx
  mov  bx,Word(j)   </font><font color="#008000"><i>{ start scanning the source bitmap}
  </i></font><font color="#FF00FF">mov  dx,Word(i)   </font><font color="#008000"><i>{ at i,j which were calculated above.}
  </i></font><font color="#FF00FF">mov  cx,160       </font><font color="#008000"><i>{ Number of columns on screen/2}
</i></font><font color="#FF00FF">hloop:
  add  bx,bp        </font><font color="#008000"><i>{ add the 'right' vector }
  </i></font><font color="#FF00FF">add  dx,si    </font><font color="#008000"><i>{ add the 'down' vector }
  </i></font><font color="#FF00FF">xchg bl,dh        </font><font color="#008000"><i>{ set up 8.8 fixed w/ Right MOD 256 and Down MOD 256}
  </i></font><font color="#FF00FF">mov  al,[bx]      </font><font color="#008000"><i>{ load a pixel from source }
  </i></font><font color="#FF00FF">xchg bl,dh        </font><font color="#008000"><i>{ restore the counting registers}
  </i></font><font color="#FF00FF">add  bx,bp        </font><font color="#008000"><i>{ add the 'right' vector }
  </i></font><font color="#FF00FF">add  dx,si    </font><font color="#008000"><i>{ add the 'down' vector }
  </i></font><font color="#FF00FF">xchg bl,dh        </font><font color="#008000"><i>{ set up 8.8 fixed w/ Right MOD 256 and Down MOD 256}
  </i></font><font color="#FF00FF">mov  ah,[bx]      </font><font color="#008000"><i>{ load a pixel from source }
  </i></font><font color="#FF00FF">Stosw        </font><font color="#008000"><i>{ write and advance 2 
pixels (could do 4 w/386!)}
  </i></font><font color="#FF00FF">xchg bl,dh        </font><font color="#008000"><i>{ restore the counting registers}
  </i></font><font color="#FF00FF">Loop  hloop       </font><font color="#008000"><i>{ End of horizontal loop}
  </i></font><font color="#FF00FF">dec  si;dec bp  </font><font color="#008000"><i>{ Unquote one or both of these to cause mag. f/x}
  </i></font><font color="#FF00FF">sub  Word(i),bp   </font><font color="#008000"><i>{ i,j is the starting coords for a line }
  </i></font><font color="#FF00FF">add  Word(j),si   </font><font color="#008000"><i>{ so this moves down one line }
  </i></font><font color="#FF00FF">Pop  cx
  loop vloop        </font><font color="#008000"><i>{ End of verticle loop }
{-----That's all there is to the actual screen-writing section!--------}
  </i></font><font color="#FF00FF">Pop  bp
  pop  ds           </font><font color="#008000"><i>{ Restore the ds }
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#008000"><i>{----------------------------------------------------------------------}
</i></font><font color="#FF0000"><b>var </b></font>ax<font color="#000080">,</font>ay<font color="#000080">,</font>mx<font color="#000080">,</font>my<font color="#000080">,</font>x<font color="#000080">,</font>y<font color="#000080">,</font>h<font color="#000080">,</font>i<font color="#000080">,</font>j<font color="#000080">:</font>word<font color="#000080">; </font>c<font color="#000080">:</font>byte<font color="#000080">;
    </font>rot<font color="#000080">,</font>dist<font color="#000080">,</font>mouse<font color="#000080">:</font>Word<font color="#000080">;
    </font>dr<font color="#000080">,</font>dx<font color="#000080">,</font>dy<font color="#000080">,</font>dd<font color="#000080">:</font>Integer<font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>Circle<font color="#000080">(</font>cx<font color="#000080">,</font>cy<font color="#000080">,</font>r<font color="#000080">,</font>c<font color="#000080">:</font>Integer<font color="#000080">);
</font><font color="#FF0000"><b>var </b></font>rr<font color="#000080">,</font>xx<font color="#000080">,</font>yy<font color="#000080">:</font>longint<font color="#000080">;</font>x320<font color="#000080">,</font>y320<font color="#000080">,</font>p<font color="#000080">:</font>Word<font color="#000080">;</font>x<font color="#000080">,</font>y<font color="#000080">:</font>Integer<font color="#000080">;
</font><font color="#FF0000"><b>label </b></font>Draw<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>rr<font color="#000080">:=</font>r<font color="#000080">;</font>y<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;</font>x<font color="#000080">:=</font>r<font color="#000080">;</font>rr<font color="#000080">:=</font>r<font color="#000080">*</font>r<font color="#000080">;</font>xx<font color="#000080">:=</font>rr<font color="#000080">-</font>x<font color="#000080">;</font>yy<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
  </font>x320<font color="#000080">:=</font>x<font color="#000080">*</font><font color="#800000">256</font><font color="#000080">;</font>y320<font color="#000080">:=</font>y<font color="#000080">;</font>p<font color="#000080">:=</font>cx<font color="#000080">+</font>cy<font color="#000080">*</font><font color="#800000">256</font><font color="#000080">;
  </font><font color="#FF0000"><b>asm
    </b></font><font color="#FF00FF">Jmp @Skip
@Curse:
    Add di,dx    </font><font color="#008000"><i>{dx is the x offset from center}
    </i></font><font color="#FF00FF">Mov es:[di+bx],al  </font><font color="#008000"><i>{draw 4 cursor positions}
    </i></font><font color="#FF00FF">Neg bx
    Mov es:[di+bx],al
    Sub di,dx
    Sub di,dx
    Mov es:[di+bx],al
    Neg bx
    Mov es:[di+bx],al
    Add di,dx
    Ret
Draw:
    Mov es,VirSeg
    Mov di,p     </font><font color="#008000"><i>{di is the center of the circle}
    </i></font><font color="#FF00FF">Mov bx,y320   </font><font color="#008000"><i>{bx is the Y offset from center}
    </i></font><font color="#FF00FF">Mov dx,x
    Mov ax,c
    Call @Curse  </font><font color="#008000"><i>{draw the 4 cursors in their quadrants}
    </i></font><font color="#FF00FF">Mov bx,x320
    Mov dx,y
    Call @Curse  </font><font color="#008000"><i>{draw the 4 cursors at 90 degrees}
    </i></font><font color="#FF00FF">ret
@Skip:
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>Repeat
    if </b></font>xx<font color="#000080">&gt;(</font>rr<font color="#000080">-</font>yy<font color="#000080">) </font><font color="#FF0000"><b>then
    Begin
</b></font><font color="#008000"><i>{      asm call draw;end;{}
      </i></font>Inc<font color="#000080">(</font>xx<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">-</font>x<font color="#000080">-</font>x<font color="#000080">);</font>dec<font color="#000080">(</font>x<font color="#000080">);</font>dec<font color="#000080">(</font>x320<font color="#000080">,</font><font color="#800000">256</font><font color="#000080">);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>asm </b></font><font color="#FF00FF">call draw;</font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font>Inc<font color="#000080">(</font>yy<font color="#000080">,</font>y<font color="#000080">+</font>y<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">);</font>inc<font color="#000080">(</font>y<font color="#000080">);</font>inc<font color="#000080">(</font>y320<font color="#000080">,</font><font color="#800000">256</font><font color="#000080">);
  </font><font color="#FF0000"><b>Until </b></font>x<font color="#000080">&lt;</font>y<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;</font><font color="#008000"><i>{}


</i></font><font color="#FF0000"><b>Procedure </b></font>DoStars<font color="#000080">;
</font><font color="#FF0000"><b>var </b></font>dsa<font color="#000080">,</font>dsb<font color="#000080">,</font>dsc<font color="#000080">,</font>l<font color="#000080">:</font>word<font color="#000080">;
</font><font color="#FF0000"><b>const </b></font>x<font color="#000080">:</font>Word<font color="#000080">=</font><font color="#800000">0</font><font color="#000080">;
</font><font color="#FF0000"><b>Begin
  </b></font>inc<font color="#000080">(</font>x<font color="#000080">,</font><font color="#800000">2</font><font color="#000080">);
  </font>dsa<font color="#000080">:=</font>ra<font color="#000080">;</font>dsb<font color="#000080">:=</font>rb<font color="#000080">;</font>dsc<font color="#000080">:=</font>rc<font color="#000080">;
  </font>ra<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;</font>rb<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;</font>rc<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
  </font><font color="#FF0000"><b>For </b></font>l<font color="#000080">:=</font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font><font color="#800000">1024 </font><font color="#FF0000"><b>do </b></font>Mem<font color="#000080">[</font>VirSeg<font color="#000080">:</font>rand<font color="#000080">+</font>x<font color="#000080">]:=</font><font color="#800000">240</font><font color="#000080">+</font>rand <font color="#FF0000"><b>AND </b></font><font color="#800000">$15</font><font color="#000080">;
  </font>ra<font color="#000080">:=</font>dsa<font color="#000080">;</font>rb<font color="#000080">:=</font>dsb<font color="#000080">;</font>rc<font color="#000080">:=</font>dsc<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>begin
  </b></font>ra<font color="#000080">:=</font><font color="#800000">1</font><font color="#000080">;
  </font>MouseStatus<font color="#000080">;
  </font>AllocateMem<font color="#000080">;
  </font>mktabl<font color="#000080">;
  </font>mx<font color="#000080">:=</font><font color="#800000">128</font><font color="#000080">*</font><font color="#800000">256</font><font color="#000080">; </font>my<font color="#000080">:=</font><font color="#800000">32</font><font color="#000080">*</font><font color="#800000">256</font><font color="#000080">;         </font><font color="#008000"><i>{this corresponds to (128,32) in fixed 
point}
  </i></font>rot<font color="#000080">:=</font><font color="#800000">192</font><font color="#000080">; </font>dr<font color="#000080">:=</font><font color="#800000">1</font><font color="#000080">;          </font><font color="#008000"><i>{rotation angle and it's delta}
  </i></font>dist<font color="#000080">:=</font><font color="#800000">500</font><font color="#000080">; </font>dd<font color="#000080">:=</font>Word<font color="#000080">(</font><font color="#800000">0</font><font color="#000080">);  </font><font color="#008000"><i>{distance to bitmap (sort of) and its delta}
  </i></font>videomode<font color="#000080">(</font><font color="#800000">$13</font><font color="#000080">);
  </font><font color="#FF0000"><b>for </b></font>i<font color="#000080">:=</font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font><font color="#800000">255 </font><font color="#FF0000"><b>do begin
    </b></font>ctab<font color="#000080">[</font>i<font color="#000080">]:=</font>cotable<font color="#000080">[</font>i<font color="#000080">] </font><font color="#FF0000"><b>div </b></font><font color="#800000">400</font><font color="#000080">;
    </font>stab<font color="#000080">[</font>i<font color="#000080">]:=</font>cotable<font color="#000080">[</font>Byte<font color="#000080">(</font>i<font color="#000080">+</font><font color="#800000">64</font><font color="#000080">)]</font><font color="#FF0000"><b>div </b></font><font color="#800000">640</font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>virseg<font color="#000080">:=</font>Map<font color="#000080">;
  </font>x<font color="#000080">:=</font><font color="#800000">30</font><font color="#000080">; </font>y<font color="#000080">:=</font><font color="#800000">90</font><font color="#000080">;
  </font><font color="#FF0000"><b>repeat
  </b></font>cls<font color="#000080">(</font>virseg<font color="#000080">);
  </font><font color="#008000"><i>{  retrace;{}
    </i></font>dostars<font color="#000080">;
    </font>c<font color="#000080">:=</font><font color="#800000">3</font><font color="#000080">; </font>lstep<font color="#000080">:=</font><font color="#800000">33</font><font color="#000080">;
    </font><font color="#FF0000"><b>if </b></font>mx<font color="#000080">&lt;</font><font color="#800000">128 </font><font color="#FF0000"><b>then </b></font>ax<font color="#000080">:=</font>x <font color="#FF0000"><b>else </b></font>ax<font color="#000080">:=</font><font color="#800000">256</font><font color="#000080">-</font>x<font color="#000080">;
    </font><font color="#FF0000"><b>if </b></font>my<font color="#000080">&lt;</font><font color="#800000">128 </font><font color="#FF0000"><b>then </b></font>ay<font color="#000080">:=</font>y <font color="#FF0000"><b>else </b></font>ay<font color="#000080">:=</font><font color="#800000">256</font><font color="#000080">-</font>y<font color="#000080">;
   </font><font color="#FF0000"><b>for </b></font>i<font color="#000080">:=</font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font><font color="#800000">255 </font><font color="#FF0000"><b>do </b></font>Setpal<font color="#000080">(</font>i<font color="#000080">,</font>i<font color="#000080">+</font>i<font color="#000080">+</font>ax <font color="#FF0000"><b>shr </b></font>pfx<font color="#000080">,</font>i<font color="#000080">+</font>i<font color="#000080">+</font>ay <font color="#FF0000"><b>shr 
</b></font>pfx<font color="#000080">,</font>i<font color="#000080">+</font>i<font color="#000080">+(</font>ax<font color="#000080">+</font>ay<font color="#000080">)</font><font color="#FF0000"><b>shr </b></font><font color="#000080">(</font>pfx<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">));
    </font><font color="#FF0000"><b>While </b></font>c<font color="#000080">&lt;</font><font color="#800000">20 </font><font color="#FF0000"><b>do
    Begin
      </b></font>j<font color="#000080">:=(</font>c<font color="#000080">*(</font>c<font color="#000080">+</font><font color="#800000">3</font><font color="#000080">))</font><font color="#FF0000"><b>SHR</b></font><font color="#000080">(</font><font color="#800000">2</font><font color="#000080">)+</font><font color="#800000">5</font><font color="#000080">;
      </font>i<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
   </font>ax<font color="#000080">:=</font>ctab<font color="#000080">[</font>Byte<font color="#000080">(</font>x<font color="#000080">-</font>j<font color="#000080">+</font><font color="#800000">200</font><font color="#000080">)];
      </font>ay<font color="#000080">:=</font>stab<font color="#000080">[</font>Byte<font color="#000080">(</font>y<font color="#000080">-</font>j<font color="#000080">+</font><font color="#800000">200</font><font color="#000080">)];
</font><font color="#008000"><i>{$ifdef CIRCLES}
      </i></font><font color="#FF0000"><b>If </b></font>Circles <font color="#FF0000"><b>then </b></font>circle<font color="#000080">(</font>ax<font color="#000080">+</font><font color="#800000">160</font><font color="#000080">,</font>ay<font color="#000080">+</font><font color="#800000">100</font><font color="#000080">,</font>j<font color="#000080">,</font>c<font color="#000080">)
      </font><font color="#FF0000"><b>Else If </b></font>Random<font color="#000080">(</font><font color="#800000">1000</font><font color="#000080">)=</font><font color="#800000">3 </font><font color="#FF0000"><b>then Begin </b></font>Circles<font color="#000080">:=</font>True<font color="#000080">; </font>SlowMode<font color="#000080">:=</font>True<font color="#000080">; </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#008000"><i>{$endif}
      </i></font><font color="#FF0000"><b>If </b></font>SlowMode <font color="#FF0000"><b>then
    Begin
      </b></font>DrawScreen<font color="#000080">(</font>mx<font color="#000080">,</font>my<font color="#000080">,</font>dist<font color="#000080">,</font>lo<font color="#000080">(</font>rot<font color="#000080">));
        </font><font color="#FF0000"><b>If </b></font>Random<font color="#000080">(</font><font color="#800000">200</font><font color="#000080">)=</font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>SlowMode<font color="#000080">:=</font>False<font color="#000080">;
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font>Inc<font color="#000080">(</font>c<font color="#000080">);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font>DRAWScreen<font color="#000080">(</font>mx<font color="#000080">,</font>my<font color="#000080">,</font>dist<font color="#000080">,</font>lo<font color="#000080">(</font>rot<font color="#000080">));
    </font><font color="#FF0000"><b>If </b></font>random<font color="#000080">(</font><font color="#800000">10</font><font color="#000080">)=</font><font color="#800000">0 </font><font color="#FF0000"><b>then
  Begin
    </b></font>dx<font color="#000080">:=</font>dx<font color="#000080">+</font>random<font color="#000080">(</font><font color="#800000">51</font><font color="#000080">)-</font><font color="#800000">25</font><font color="#000080">;
      </font>dx<font color="#000080">:=</font>dx<font color="#000080">*</font><font color="#800000">6 </font><font color="#FF0000"><b>Div </b></font><font color="#800000">9</font><font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>If </b></font>random<font color="#000080">(</font><font color="#800000">20</font><font color="#000080">)=</font><font color="#800000">0 </font><font color="#FF0000"><b>then
  Begin
    </b></font>dy<font color="#000080">:=</font>dy<font color="#000080">+</font>random<font color="#000080">(</font><font color="#800000">51</font><font color="#000080">)-</font><font color="#800000">25</font><font color="#000080">;
      </font>dy<font color="#000080">:=</font>dy<font color="#000080">*</font><font color="#800000">6 </font><font color="#FF0000"><b>div </b></font><font color="#800000">9</font><font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font>x<font color="#000080">:=</font>Byte<font color="#000080">((</font>x<font color="#000080">+</font>dx<font color="#000080">+</font>x<font color="#000080">+</font>random<font color="#000080">(</font><font color="#800000">2</font><font color="#000080">)) </font><font color="#FF0000"><b>SHR </b></font><font color="#800000">1</font><font color="#000080">);
    </font>y<font color="#000080">:=</font>Byte<font color="#000080">((</font>y<font color="#000080">+</font>dy<font color="#000080">+</font>y<font color="#000080">+</font>random<font color="#000080">(</font><font color="#800000">2</font><font color="#000080">)) </font><font color="#FF0000"><b>SHR </b></font><font color="#800000">1</font><font color="#000080">);
    </font><font color="#FF0000"><b>If </b></font>Random<font color="#000080">(</font><font color="#800000">12</font><font color="#000080">)=</font><font color="#800000">0 </font><font color="#FF0000"><b>then
   Begin
     </b></font>dd<font color="#000080">:=</font>dd<font color="#000080">+</font><font color="#800000">10</font><font color="#000080">-</font>Random<font color="#000080">(</font><font color="#800000">21</font><font color="#000080">);
        </font>dd<font color="#000080">:=</font>dd<font color="#000080">*</font><font color="#800000">7 </font><font color="#FF0000"><b>DIV </b></font><font color="#800000">8</font><font color="#000080">;
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>If </b></font>Random<font color="#000080">(</font><font color="#800000">50</font><font color="#000080">)=</font><font color="#800000">1 </font><font color="#FF0000"><b>then
   Begin
     </b></font>dr<font color="#000080">:=</font>dr<font color="#000080">+</font><font color="#800000">3</font><font color="#000080">-</font>Random<font color="#000080">(</font><font color="#800000">7</font><font color="#000080">);
        </font>dr<font color="#000080">:=</font>dr<font color="#000080">*</font><font color="#800000">8 </font><font color="#FF0000"><b>DIV </b></font><font color="#800000">9</font><font color="#000080">;
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
        </font>rot<font color="#000080">:=</font>rot<font color="#000080">+</font>dr<font color="#000080">;
        </font>mouse<font color="#000080">:=</font>MouseAt<font color="#000080">(</font>mx<font color="#000080">,</font>my<font color="#000080">);
        </font><font color="#FF0000"><b>Case </b></font>Mouse <font color="#FF0000"><b>of
          </b></font><font color="#800000">1</font><font color="#000080">: </font>Inc<font color="#000080">(</font>dist<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">+(</font>dist <font color="#FF0000"><b>SHR </b></font><font color="#800000">4</font><font color="#000080">));
          </font><font color="#800000">2</font><font color="#000080">: </font>Dec<font color="#000080">(</font>dist<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">+(</font>dist <font color="#FF0000"><b>SHR </b></font><font color="#800000">4</font><font color="#000080">));
          </font><font color="#800000">3</font><font color="#000080">: </font>dist<font color="#000080">:=</font><font color="#800000">1000</font><font color="#000080">;
          </font><font color="#800000">4</font><font color="#000080">: </font>rot<font color="#000080">:=</font>mx<font color="#000080">;
        </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
        </font>mx<font color="#000080">:=</font>mx<font color="#000080">*</font><font color="#800000">100</font><font color="#000080">;</font>my<font color="#000080">:=</font>my<font color="#000080">*</font><font color="#800000">256</font><font color="#000080">;
        </font><font color="#FF0000"><b>if </b></font><font color="#000080">((</font>dist<font color="#000080">+</font>dd<font color="#000080">)&gt;</font><font color="#800000">500</font><font color="#000080">) </font><font color="#FF0000"><b>THEN </b></font>DD<font color="#000080">:=-</font><font color="#800000">5</font><font color="#000080">;
    </font><font color="#FF0000"><b>If </b></font><font color="#000080">((</font>dist<font color="#000080">+</font>dd<font color="#000080">)&lt;</font><font color="#800000">10</font><font color="#000080">) </font><font color="#FF0000"><b>then </b></font>dd<font color="#000080">:=</font><font color="#800000">10</font><font color="#000080">;
        </font>dist<font color="#000080">:=</font>dist<font color="#000080">+</font>dd<font color="#000080">;
  </font><font color="#FF0000"><b>until </b></font>keypressed<font color="#000080">;
  </font><font color="#FF0000"><b>while </b></font>keypressed <font color="#FF0000"><b>do </b></font>readkey<font color="#000080">;
     </font>GiveBackMem<font color="#000080">;
     </font>VideoMode<font color="#000080">(</font><font color="#800000">$03</font><font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to EGAVGA SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0240.PAS">Original</a><b>]</b></p></body>
</html>
