<html>
<head><title> "Map Drawing" by JAMIE MORTIMER</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to EGAVGA SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0130.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>(*
I have *really* simple code I wrote for loading a 320x200x256 pcx if
that'd do. I have other stuff that you could work with, but it's not
mine and not finished.

CL/  Display a background .PCX (a map in this case), and allow for the
CL/movement of foreground objects w/o affecting the background .PCX.

What you want to do is use virtual screens or page flipping, depending
on the graphic mode. If you're in low res (really easy!) 320x200x256,
you can easily use 64k virtual screens (just arrays of [0..199,0..319]
for simplicity) and treat *them* like a screen. Then dump them to the
real screen once all your updates are done.  For higher vid modes,
virtual screens can get a *bit* more complex, 'specially for 16 color
modes.

CL/Item_REc = rec
CL/             name : string [30];
CL/             amt : byte;
CL/          end;
CL/Item_Type = array[1..5] of Item_Rec;

CL/Map_Rec = Record
CL/            Occupant : Byte; { Player=1, Nobody=0, etc }
CL/            Items    : Item_type;
CL/            Case Terrain:Char of
CL/              'F' : etc,etc...
CL/         End; { Map_rec }
CL/map_type = array[1..100,1..100] of map_rec;

CL/var
CL/  Map : map_type;

Well, the list of items should be link listed. I mean, not *every* map
will always have 5 items, right? Save memory that way.  Also, use
item numbers instead of signifying an item by it's entire name.  Using
a record structure something like this might help a bit:
*)

</i></font><font color="#FF0000"><b>Type
  </b></font>PItemRec <font color="#000080">= ^</font>ItemRec<font color="#000080">;
  </font>ItemRec <font color="#000080">= </font><font color="#FF0000"><b>record
    </b></font>name  <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">[</font><font color="#800000">28</font><font color="#000080">];
    </font>idnum <font color="#000080">: </font>word<font color="#000080">;
    </font>next  <font color="#000080">: </font>PItemRec<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{ItemRec 35 bytes}

  </i></font>PItemIdx <font color="#000080">= ^</font>ItemIdx<font color="#000080">;
  </font>ItemIdx <font color="#000080">= </font><font color="#FF0000"><b>record
     </b></font>idnum <font color="#000080">: </font>word<font color="#000080">;      </font><font color="#008000"><i>{maximum of ~65535 items, depending on mem}
     </i></font>amt   <font color="#000080">: </font>Byte<font color="#000080">;
     </font>next  <font color="#000080">: </font>PItemIdx<font color="#000080">;
   </font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{ItemIdx 7 bytes }

  </i></font>PPlayerIdx <font color="#000080">= ^</font>PlayerIdx
  PlayerIdx <font color="#000080">= </font><font color="#FF0000"><b>record
    </b></font>idnum <font color="#000080">: </font>word<font color="#000080">;
    </font>next <font color="#000080">: </font>PPlayerIdx
  <font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{PlayerIdx 6 bytes} {This will allow for more than one player
                            on a map coord if you want. Just an idea}

  </i></font>Map_Rec <font color="#000080">= </font><font color="#FF0000"><b>Record
    </b></font>Occupants <font color="#000080">: </font>PPlayerIdx<font color="#000080">;  </font><font color="#008000"><i>{list of players}
    </i></font>Items     <font color="#000080">: </font>PItemIdx<font color="#000080">;    </font><font color="#008000"><i>{list of items}
    </i></font><font color="#FF0000"><b>Case </b></font>Terrain<font color="#000080">:</font>char etc
  <font color="#FF0000"><b>End</b></font><font color="#000080">; </font><font color="#008000"><i>{ Map_rec 9 bytes}

{If you only want one player per square at a time, you can change
occupants to type byte, makeing map_rec 6 bytes, increasing your maximum
map size by like 1/3

Again, you could do linked lists for the map, but I'm sure you won't
have *that* big a map...  85x85 should be ok, right?
}

  </i></font>pmap_type <font color="#000080">= ^</font>Map_Type<font color="#000080">;  </font><font color="#008000"><i>{This will save your data segment some room}
  </i></font>map_type <font color="#000080">= </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">85</font><font color="#000080">,</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">85</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>map_rec<font color="#000080">;   </font><font color="#008000"><i>{with 9 byte maprec}
  </i></font>map_type <font color="#000080">= </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">104</font><font color="#000080">,</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">104</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>map_rec<font color="#000080">; </font><font color="#008000"><i>{with 6 byte maprec}

{here's some examples of how to access these variables}

</i></font><font color="#FF0000"><b>Procedure </b></font>AddItem<font color="#000080">(</font>NewName<font color="#000080">:</font><font color="#FF0000"><b>string</b></font><font color="#000080">;</font>NewId<font color="#000080">:</font>Word<font color="#000080">;</font><font color="#FF0000"><b>Var </b></font>List<font color="#000080">:</font>PItemIdx<font color="#000080">);
</font><font color="#FF0000"><b>var
  </b></font>NewItem<font color="#000080">:</font>PItemRec<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>New<font color="#000080">(</font>Newitem<font color="#000080">);       </font><font color="#008000"><i>{alloc mem for new item}
  </i></font><font color="#FF0000"><b>with </b></font>newitem<font color="#000080">^ </font><font color="#FF0000"><b>do
    begin
      </b></font>name<font color="#000080">:=</font>newname<font color="#000080">;
      </font>Idnum<font color="#000080">:=</font>newid<font color="#000080">;
      </font>Next<font color="#000080">:=</font>List<font color="#000080">;     </font><font color="#008000"><i>{chain &quot;list&quot; after newitem}
    </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>List<font color="#000080">:=</font>NewItem<font color="#000080">;      </font><font color="#008000"><i>{Insert into front of list}
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Var
  </b></font>Map      <font color="#000080">: </font>PMap_Type<font color="#000080">;
  </font>ItemList <font color="#000080">: </font>PItemRec<font color="#000080">;
  </font>t<font color="#000080">,</font>i      <font color="#000080">: </font>integer<font color="#000080">;
  </font>pPlr     <font color="#000080">: </font>PPlayerIdx<font color="#000080">;
  </font>pItm     <font color="#000080">: </font>PItemIdx<font color="#000080">;

</font><font color="#FF0000"><b>begin
  </b></font>new<font color="#000080">(</font>map<font color="#000080">);      </font><font color="#008000"><i>{ get heap memory for the MAP pointer}
  </i></font>ItemList<font color="#000080">:=</font><font color="#FF0000"><b>nil</b></font><font color="#000080">;    </font><font color="#008000"><i>{ no items in master list yet}

  </i></font>fillchar<font color="#000080">(</font>map<font color="#000080">^,</font>sizeof<font color="#000080">(</font>map<font color="#000080">^),</font><font color="#800000">0</font><font color="#000080">);  </font><font color="#008000"><i>{ clear *ALL* map memory to zeros }

  {Make some arbitary items}
  </i></font>Additem<font color="#000080">(</font><font color="#800000">'Sword'</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font>ItemList<font color="#000080">);
  </font>Additem<font color="#000080">(</font><font color="#800000">'Shield'</font><font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font>ItemList<font color="#000080">);
  </font>Additem<font color="#000080">(</font><font color="#800000">'Dagger'</font><font color="#000080">,</font><font color="#800000">2</font><font color="#000080">,</font>ItemList<font color="#000080">);
  </font>Additem<font color="#000080">(</font><font color="#800000">'Helm'</font><font color="#000080">,</font><font color="#800000">3</font><font color="#000080">,</font>ItemList<font color="#000080">);

  </font><font color="#FF0000"><b>For </b></font>T<font color="#000080">:=</font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font><font color="#800000">85 </font><font color="#FF0000"><b>do
    for </b></font>I<font color="#000080">:=</font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font><font color="#800000">85 </font><font color="#FF0000"><b>do
      begin
        </b></font>terrain<font color="#000080">:=</font>terraintypes<font color="#000080">[</font>random<font color="#000080">(</font><font color="#800000">10</font><font color="#000080">)]; </font><font color="#008000"><i>{whatever}
        </i></font><font color="#FF0000"><b>if </b></font>random<font color="#000080">(</font><font color="#800000">100</font><font color="#000080">) </font><font color="#FF0000"><b>then
          begin
            </b></font>new<font color="#000080">(</font>pitm<font color="#000080">); </font><font color="#008000"><i>{make a new item idex}
            </i></font><font color="#FF0000"><b>with </b></font>pitm<font color="#000080">^ </font><font color="#FF0000"><b>do
              begin
                </b></font>idnum<font color="#000080">:=</font>random<font color="#000080">(</font><font color="#800000">4</font><font color="#000080">);
                </font>amt<font color="#000080">:=</font><font color="#800000">1</font><font color="#000080">;
                </font>next<font color="#000080">:=</font><font color="#FF0000"><b>nil</b></font><font color="#000080">;
              </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
            </font>Map<font color="#000080">^[</font>t<font color="#000080">,</font>i<font color="#000080">].</font>items<font color="#000080">^:=</font>pitm<font color="#000080">;
          </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{these next lines should clean up the entire map, no matter how many
items, players or whatever you have around.  As long as you don't have
any invalid pointers...&lt;G&gt;}

  </i></font><font color="#FF0000"><b>For </b></font>T<font color="#000080">:=</font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font><font color="#800000">85 </font><font color="#FF0000"><b>do
    for </b></font>I<font color="#000080">:=</font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font><font color="#800000">85 </font><font color="#FF0000"><b>do
      begin
        while </b></font>occupant<font color="#000080">&lt;&gt;</font><font color="#FF0000"><b>nil do
          begin
            </b></font>pplr<font color="#000080">:=</font>occupant<font color="#000080">;
            </font>occupant<font color="#000080">:=</font>occupant<font color="#000080">^.</font>next<font color="#000080">;
            </font>dispose<font color="#000080">(</font>pplr<font color="#000080">);
          </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
        </font><font color="#FF0000"><b>while </b></font>items<font color="#000080">&lt;&gt;</font><font color="#FF0000"><b>nil do
          begin
            </b></font>pitm<font color="#000080">:=</font>items<font color="#000080">;
            </font>items<font color="#000080">:=</font>items<font color="#000080">^.</font>next<font color="#000080">;
            </font>dispose<font color="#000080">(</font>pitm<font color="#000080">);
          </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>dispose<font color="#000080">(</font>map<font color="#000080">);  </font><font color="#008000"><i>{ free heap memory for the MAP pointer}
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">.

</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to EGAVGA SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0130.PAS">Original</a><b>]</b></p></body>
</html>
