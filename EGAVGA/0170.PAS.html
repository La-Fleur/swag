<html>
<head><title> "Fast Polygon Fill" by ALEX CHALFIN</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to EGAVGA SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0170.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
Here is a fast polygon fill I wrote in an hour. It requires that the polygon
is convex, and the verticies are in sequential order. Right now, the verticies
must be in counter clockwise rotation, but that can be changed by removing
the conditional statement in the HLine procedure. It handles an arbitrary
number of verticies.

achalfin@uceng.uc.edu
}

</i></font><font color="#FF0000"><b>Procedure </b></font>HLine<font color="#000080">(</font>X1<font color="#000080">, </font>X2<font color="#000080">, </font>Y <font color="#000080">: </font>Integer<font color="#000080">; </font>Color <font color="#000080">: </font>Byte<font color="#000080">);
</font><font color="#008000"><i>{ Fill using words to speed up alot! }

</i></font><font color="#FF0000"><b>Label </b></font>Offscreen<font color="#000080">;

</font><font color="#FF0000"><b>Begin
  If </b></font>Y <font color="#000080">&lt; </font><font color="#800000">0 </font><font color="#FF0000"><b>Then Goto </b></font>Offscreen<font color="#000080">;
  </font><font color="#FF0000"><b>If </b></font>Y <font color="#000080">&gt; </font><font color="#800000">199 </font><font color="#FF0000"><b>Then Goto </b></font>Offscreen<font color="#000080">;
  </font><font color="#FF0000"><b>If </b></font>X2 <font color="#000080">&gt; </font>X1
    <font color="#FF0000"><b>Then Begin
      If </b></font>X1 <font color="#000080">&lt; </font><font color="#800000">0 </font><font color="#FF0000"><b>Then </b></font>X1 <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
      </font><font color="#FF0000"><b>If </b></font>X2 <font color="#000080">&gt; </font><font color="#800000">319 </font><font color="#FF0000"><b>Then </b></font>X2 <font color="#000080">:= </font><font color="#800000">319</font><font color="#000080">;
      </font>FillChar<font color="#000080">(</font>Mem<font color="#000080">[</font><font color="#800000">$A000</font><font color="#000080">:</font>Y<font color="#000080">*</font><font color="#800000">320</font><font color="#000080">+</font>X1<font color="#000080">], </font>X2<font color="#000080">-</font>X1<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">, </font>Color<font color="#000080">);
    </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
 </font>OffScreen<font color="#000080">:
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>FillPoly<font color="#000080">(</font>P<font color="#000080">:</font>MappedCoords<font color="#000080">; </font>Num <font color="#000080">: </font>Word<font color="#000080">; </font>Color <font color="#000080">: </font>Byte<font color="#000080">);
</font><font color="#008000"><i>{ Mapped Coords is an array of (x, y) coords, each is an integer }

</i></font><font color="#FF0000"><b>Var
  </b></font>x1<font color="#000080">, </font>y1<font color="#000080">, </font>x2<font color="#000080">, </font>y2<font color="#000080">, </font>x11<font color="#000080">, </font>y11<font color="#000080">, </font>x22<font color="#000080">, </font>y22 <font color="#000080">: </font>Integer<font color="#000080">;
  </font>StartV1<font color="#000080">, </font>EndV1<font color="#000080">, </font>StartV2<font color="#000080">, </font>EndV2 <font color="#000080">: </font>Integer<font color="#000080">;
  </font>Dx1<font color="#000080">, </font>Dx2<font color="#000080">, </font>Count1<font color="#000080">, </font>Count2 <font color="#000080">: </font>Integer<font color="#000080">;
  </font>XVal1<font color="#000080">, </font>XVal2 <font color="#000080">: </font>Longint<font color="#000080">;
  </font>EdgeCount<font color="#000080">, </font>MinY <font color="#000080">: </font>Word<font color="#000080">;
  </font>C <font color="#000080">: </font>Integer<font color="#000080">;

</font><font color="#FF0000"><b>Begin
  </b></font>EdgeCount <font color="#000080">:= </font>Num<font color="#000080">;
  </font>MinY <font color="#000080">:= </font><font color="#800000">300</font><font color="#000080">;
  </font><font color="#FF0000"><b>For </b></font>C <font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font><font color="#000080">(</font>EdgeCount<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">) </font><font color="#FF0000"><b>do  </b></font><font color="#008000"><i>{ Find Top Vertex }
    </i></font><font color="#FF0000"><b>Begin
      If </b></font>P<font color="#000080">[</font>c<font color="#000080">].</font>Y <font color="#000080">&lt; </font>MinY
        <font color="#FF0000"><b>Then Begin </b></font>MinY <font color="#000080">:= </font>P<font color="#000080">[</font>c<font color="#000080">].</font>Y<font color="#000080">; </font>StartV1 <font color="#000080">:= </font>C<font color="#000080">; </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
  </font>StartV2 <font color="#000080">:= </font>StartV1<font color="#000080">;
  </font>EndV1 <font color="#000080">:= </font>StartV1 <font color="#000080">- </font><font color="#800000">1</font><font color="#000080">;
  </font>EndV2 <font color="#000080">:= </font>StartV2 <font color="#000080">+ </font><font color="#800000">1</font><font color="#000080">;
  </font><font color="#FF0000"><b>If </b></font>EndV1 <font color="#000080">&lt; </font><font color="#800000">0 </font><font color="#FF0000"><b>Then </b></font>EndV1 <font color="#000080">:= (</font>Num<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">);
  </font><font color="#FF0000"><b>If </b></font>EndV2 <font color="#000080">&gt;= </font>Num <font color="#FF0000"><b>Then </b></font>EndV2 <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font>MinY <font color="#000080">:= </font>P<font color="#000080">[</font>StartV1<font color="#000080">].</font>Y<font color="#000080">;
  </font>X1<font color="#000080">:=</font>P<font color="#000080">[</font>StartV1<font color="#000080">].</font>X<font color="#000080">; </font>Y1<font color="#000080">:=</font>P<font color="#000080">[</font>StartV1<font color="#000080">].</font>Y<font color="#000080">; </font>X2<font color="#000080">:=</font>P<font color="#000080">[</font>EndV1<font color="#000080">].</font>X<font color="#000080">; </font>Y2<font color="#000080">:=</font>P<font color="#000080">[</font>EndV1<font color="#000080">].</font>Y<font color="#000080">;
  </font>Dx1 <font color="#000080">:= ((</font>X2 <font color="#000080">- </font>X1<font color="#000080">) </font><font color="#FF0000"><b>Shl </b></font><font color="#800000">8</font><font color="#000080">) </font><font color="#FF0000"><b>Div </b></font><font color="#000080">(</font>Y2 <font color="#000080">- </font>Y1 <font color="#000080">+ </font><font color="#800000">1</font><font color="#000080">);
  </font>Count1 <font color="#000080">:= </font>Y2<font color="#000080">-</font>Y1<font color="#000080">; </font>XVal1 <font color="#000080">:= </font>Longint<font color="#000080">(</font>X1<font color="#000080">) </font><font color="#FF0000"><b>Shl </b></font><font color="#800000">8</font><font color="#000080">;
  </font>X11<font color="#000080">:=</font>P<font color="#000080">[</font>StartV2<font color="#000080">].</font>X<font color="#000080">; </font>Y11<font color="#000080">:=</font>P<font color="#000080">[</font>StartV2<font color="#000080">].</font>Y<font color="#000080">; </font>X22<font color="#000080">:=</font>P<font color="#000080">[</font>EndV2<font color="#000080">].</font>X<font color="#000080">; </font>Y22<font color="#000080">:=</font>P<font color="#000080">[</font>EndV2<font color="#000080">].</font>Y<font color="#000080">;
  </font>Dx2 <font color="#000080">:= ((</font>X22 <font color="#000080">- </font>X11<font color="#000080">) </font><font color="#FF0000"><b>Shl </b></font><font color="#800000">8</font><font color="#000080">) </font><font color="#FF0000"><b>Div </b></font><font color="#000080">(</font>Y22 <font color="#000080">- </font>Y11 <font color="#000080">+ </font><font color="#800000">1</font><font color="#000080">);
  </font>Count2 <font color="#000080">:= </font>Y22<font color="#000080">-</font>Y11<font color="#000080">;  </font>XVal2 <font color="#000080">:= </font>Longint<font color="#000080">(</font>X11<font color="#000080">) </font><font color="#FF0000"><b>Shl </b></font><font color="#800000">8</font><font color="#000080">;
  </font><font color="#FF0000"><b>While </b></font>EdgeCount <font color="#000080">&gt; </font><font color="#800000">1 </font><font color="#FF0000"><b>do
    Begin
      While </b></font><font color="#000080">(</font>Count1 <font color="#000080">&gt; </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>Count2 <font color="#000080">&gt; </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>do
        Begin
          </b></font>HLine<font color="#000080">(</font>XVal1 <font color="#FF0000"><b>Shr </b></font><font color="#800000">8</font><font color="#000080">, </font>XVal2 <font color="#FF0000"><b>Shr </b></font><font color="#800000">8</font><font color="#000080">, </font>MinY<font color="#000080">, </font>Color<font color="#000080">);
          </font>XVal1 <font color="#000080">:= </font>XVal1 <font color="#000080">+ </font>Dx1<font color="#000080">; </font>XVal2 <font color="#000080">:= </font>XVal2 <font color="#000080">+ </font>Dx2<font color="#000080">;
          </font>Count1 <font color="#000080">:= </font>Count1 <font color="#000080">- </font><font color="#800000">1</font><font color="#000080">; </font>Count2 <font color="#000080">:= </font>Count2 <font color="#000080">- </font><font color="#800000">1</font><font color="#000080">;
          </font>MinY <font color="#000080">:= </font>MinY <font color="#000080">+ </font><font color="#800000">1</font><font color="#000080">;
        </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>If </b></font>Count1 <font color="#000080">= </font><font color="#800000">0
        </font><font color="#FF0000"><b>Then Begin
          </b></font>StartV1 <font color="#000080">:= </font>EndV1<font color="#000080">;  </font>EndV1 <font color="#000080">:= </font>EndV1 <font color="#000080">- </font><font color="#800000">1</font><font color="#000080">;
          </font><font color="#FF0000"><b>If </b></font>EndV1 <font color="#000080">&lt; </font><font color="#800000">0 </font><font color="#FF0000"><b>Then </b></font>EndV1 <font color="#000080">:= (</font>Num<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">);
          </font>EdgeCount <font color="#000080">:= </font>EdgeCount <font color="#000080">- </font><font color="#800000">1</font><font color="#000080">; </font>MinY <font color="#000080">:= </font>P<font color="#000080">[</font>StartV1<font color="#000080">].</font>Y<font color="#000080">;
          </font>X1 <font color="#000080">:= </font>P<font color="#000080">[</font>StartV1<font color="#000080">].</font>X<font color="#000080">; </font>Y1 <font color="#000080">:= </font>P<font color="#000080">[</font>StartV1<font color="#000080">].</font>Y<font color="#000080">;
          </font>X2 <font color="#000080">:= </font>P<font color="#000080">[</font>EndV1<font color="#000080">].</font>X<font color="#000080">; </font>Y2 <font color="#000080">:= </font>P<font color="#000080">[</font>EndV1<font color="#000080">].</font>Y<font color="#000080">;
          </font>Dx1 <font color="#000080">:= ((</font>X2 <font color="#000080">- </font>X1<font color="#000080">) </font><font color="#FF0000"><b>Shl </b></font><font color="#800000">8</font><font color="#000080">) </font><font color="#FF0000"><b>Div </b></font><font color="#000080">(</font>Abs<font color="#000080">(</font>Y2 <font color="#000080">- </font>Y1<font color="#000080">) + </font><font color="#800000">1</font><font color="#000080">);
          </font>Count1 <font color="#000080">:= </font>Y2<font color="#000080">-</font>Y1<font color="#000080">; </font>XVal1 <font color="#000080">:= </font>Longint<font color="#000080">(</font>X1<font color="#000080">) </font><font color="#FF0000"><b>Shl </b></font><font color="#800000">8</font><font color="#000080">;
        </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>If </b></font>Count2 <font color="#000080">= </font><font color="#800000">0
        </font><font color="#FF0000"><b>Then Begin
          </b></font>StartV2 <font color="#000080">:= </font>EndV2<font color="#000080">; </font>EndV2 <font color="#000080">:= </font>EndV2 <font color="#000080">+ </font><font color="#800000">1</font><font color="#000080">;
          </font><font color="#FF0000"><b>If </b></font>EndV2 <font color="#000080">&gt;= </font>Num  <font color="#FF0000"><b>Then </b></font>EndV2 <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
          </font>EdgeCount <font color="#000080">:= </font>EdgeCount <font color="#000080">- </font><font color="#800000">1</font><font color="#000080">; </font>MinY <font color="#000080">:= </font>P<font color="#000080">[</font>StartV2<font color="#000080">].</font>Y<font color="#000080">;
          </font>X11 <font color="#000080">:= </font>P<font color="#000080">[</font>StartV2<font color="#000080">].</font>X<font color="#000080">; </font>Y11 <font color="#000080">:= </font>P<font color="#000080">[</font>StartV2<font color="#000080">].</font>Y<font color="#000080">;
          </font>X22 <font color="#000080">:= </font>P<font color="#000080">[</font>EndV2<font color="#000080">].</font>X<font color="#000080">; </font>Y22 <font color="#000080">:= </font>P<font color="#000080">[</font>EndV2<font color="#000080">].</font>Y<font color="#000080">;
          </font>Dx2 <font color="#000080">:= ((</font>X22 <font color="#000080">- </font>X11<font color="#000080">) </font><font color="#FF0000"><b>Shl </b></font><font color="#800000">8</font><font color="#000080">) </font><font color="#FF0000"><b>Div </b></font><font color="#000080">(</font>Abs<font color="#000080">(</font>Y22 <font color="#000080">- </font>Y11<font color="#000080">) + </font><font color="#800000">1</font><font color="#000080">);
          </font>Count2 <font color="#000080">:= </font>Y22<font color="#000080">-</font>Y11<font color="#000080">; </font>XVal2 <font color="#000080">:= </font>Longint<font color="#000080">(</font>X11<font color="#000080">) </font><font color="#FF0000"><b>Shl </b></font><font color="#800000">8</font><font color="#000080">;
        </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to EGAVGA SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0170.PAS">Original</a><b>]</b></p></body>
</html>
