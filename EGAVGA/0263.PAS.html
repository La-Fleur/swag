<html>
<head><title> "RE: Loading PCX Files" by ALLAN BANG ANDERSEN</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to EGAVGA SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0263.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
 KB&gt; Hello.  I was wondering if someone could tell me how to read in PCX
 KB&gt; files in Turbo Pascal using either resolution (320 X 200, 640 X 480
 KB&gt; etc.) with 256 colours. I was using a program called clip but it does
 KB&gt; not read PCX files that are in 256 colours.  Any help is appreciated.

I can help you with the 320x200x256 mode.

Here come a little program (mostly in asm) to display a PCX-image in that
resulution.

To load a PCX-image, use the procedure PCX_LOAD(PicName, Init), where 
PicName = Path+Filename of image to be displayed.
Init    = Should the procedure init mode 13h before displaying the pic?

Hope you can use this.
}

</i></font><font color="#FF0000"><b>program </b></font>PCX_LOAD<font color="#000080">;

</font><font color="#008000"><i>{$G+}

</i></font><font color="#FF0000"><b>Var
 </b></font>Pic<font color="#000080">:</font><font color="#FF0000"><b>Array </b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">63999</font><font color="#000080">] </font><font color="#FF0000"><b>Of </b></font>Byte<font color="#000080">;
 </font>Pcx<font color="#000080">:</font><font color="#FF0000"><b>File</b></font><font color="#000080">;
 </font>Read_Result<font color="#000080">:</font>Integer<font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>Load_Pcx<font color="#000080">(</font>Name<font color="#000080">:</font><font color="#FF0000"><b>String</b></font><font color="#000080">; </font>Init<font color="#000080">:</font>Boolean<font color="#000080">);
</font><font color="#FF0000"><b>begin
  If </b></font>Init <font color="#FF0000"><b>Then
   Asm
     </b></font><font color="#FF00FF">Mov  AX, 13h
     Int  10h
   </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
   </font><font color="#FF0000"><b>Asm
     </b></font><font color="#FF00FF">Mov  AL, 0
     Mov  DX, 03C8h
     Out  DX, AL
     Inc  DX
     Mov  CX, 1023
@l1: Out  DX, AL
     Loop @l1
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
  </font>Assign<font color="#000080">(</font>PCX<font color="#000080">, </font>name<font color="#000080">);
  </font>Reset<font color="#000080">(</font>PCX<font color="#000080">, </font><font color="#800000">1</font><font color="#000080">);
  </font>BlockRead<font color="#000080">(</font>PCX<font color="#000080">, </font>Pic<font color="#000080">, </font>SizeOf<font color="#000080">(</font>Pic<font color="#000080">), </font>Read_Result<font color="#000080">);
  </font>Close<font color="#000080">(</font>PCX<font color="#000080">);
  </font><font color="#FF0000"><b>Asm
     </b></font><font color="#FF00FF">Cld
     Mov  AX, 0A000h
     Mov  ES, AX
     Lea  BX, Pic
     Add  BX, 128
     Xor  DI, DI
     Xor  DX, DX
     Xor  AX, AX
     Xor  CX, CX
@l2: Mov  AL, [BX]
     Inc  BX
     Cmp  AL, 0C0h
     Ja   @r1
     Stosb
     Inc  DX
     Jmp  @r3
@r1: Sub  AL, 0C0h
     Mov  CL, AL
     Add  DX, AX
     Mov  AL, [BX]
     Inc  BX
 Rep Stosb
@r3: Cmp  DX, 64000
     Jnz  @l2
     Inc  BX
     Mov  DX, 03C8h
     Mov  AL, 00h
     Out  DX, AL
     Inc  DX
     Mov  CX, 255
@r4: Mov  AL, [BX]
     Shr  AL, 2
     Out  DX, AL
     Mov  AL, [BX+1]
     Shr  AL, 2
     Out  DX, AL
     Mov  AL, [BX+2]
     Shr  AL, 2
     Out  DX, AL
     Add  BX, 3
     Loop @r4
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>begin
  </b></font>load_pcx<font color="#000080">(</font><font color="#800000">'D:\artpack\esilogo.PCX'</font><font color="#000080">, </font>True<font color="#000080">);
  </font><font color="#FF0000"><b>Asm
   </b></font><font color="#FF00FF">Mov AH, 000h
   Int 16h
   Mov AX, 003h
   Int 10h
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">.

</font>Oh<font color="#000080">, </font>btw<font color="#000080">. </font>this <font color="#FF0000"><b>program </b></font>can<font color="#800000">'t handle a picture larger than 64000 bytes, but i
</font>hope you can find a way around that<font color="#000080">. </font><font color="#FF0000"><b>If not</b></font><font color="#000080">, </font>write a mail <font color="#FF0000"><b>to </b></font>me<font color="#000080">, </font><font color="#FF0000"><b>and </b></font>i will
see what i can <font color="#FF0000"><b>do</b></font><font color="#000080">...

</font>TTYL
   Allan Bang Andersen

</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to EGAVGA SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0263.PAS">Original</a><b>]</b></p></body>
</html>
