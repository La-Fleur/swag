<html>
<head><title> "256 Color 320x200 BMP Loader" by SIMON R BOWSER</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to EGAVGA SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0141.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
   320x200x256c BMP loader
   written by:
 .--------- Simon R Bowser ------- aka Pinrut -----------.
 |  Department of Computer Science, Aberdeen University  |
 |            E-Mail: u04srb@abdn.ac.uk                  |
 |     Simon.Bowser@launchpad.unc.edu  |
 `-------------------------------------------------------'
  This code if FREEWARE, do with it as you will.

  note: this ONLY works for 320x200 images
}

</i></font><font color="#FF0000"><b>Procedure </b></font>LoadBMP<font color="#000080">(</font>Name<font color="#000080">:</font><font color="#FF0000"><b>String</b></font><font color="#000080">;</font>where<font color="#000080">:</font>word<font color="#000080">);
</font><font color="#FF0000"><b>type
     Virtual </b></font><font color="#000080">= </font><font color="#FF0000"><b>Array </b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">64000</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">;
</font><font color="#FF0000"><b>VAR
   </b></font>PicBuf<font color="#000080">: ^</font><font color="#FF0000"><b>Virtual</b></font><font color="#000080">;

   </font>Data<font color="#000080">:</font><font color="#FF0000"><b>File</b></font><font color="#000080">;
   </font>RGB<font color="#000080">:</font><font color="#FF0000"><b>ARRAY</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">255</font><font color="#000080">,</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">4</font><font color="#000080">] </font><font color="#FF0000"><b>OF </b></font>Byte<font color="#000080">;
   </font>Header<font color="#000080">:</font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">54</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Byte<font color="#000080">;
   </font>aAddr <font color="#000080">:</font>word<font color="#000080">;

   </font>I<font color="#000080">:</font>Byte<font color="#000080">;
   </font><font color="#008000"><i>{x,y:integer;}

  </i></font><font color="#FF0000"><b>Procedure </b></font>SetPal<font color="#000080">(</font>Col<font color="#000080">,</font>R<font color="#000080">,</font>G<font color="#000080">,</font>B <font color="#000080">: </font>Byte<font color="#000080">); </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>asm
      </b></font><font color="#FF00FF">mov    dx,3c8h
      mov    al,[col]
      out    dx,al
      inc    dx
      mov    al,[r]
      out    dx,al
      mov    al,[g]
      out    dx,al
      mov    al,[b]
      out    dx,al
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>BEGIN
     </b></font>GetMem <font color="#000080">(</font>PicBuf<font color="#000080">,</font><font color="#800000">64000</font><font color="#000080">);
     </font>Assign<font color="#000080">(</font>Data<font color="#000080">,</font>Name<font color="#000080">); </font>Reset<font color="#000080">(</font>Data<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">);
     </font>BlockRead<font color="#000080">(</font>Data<font color="#000080">,</font>Header<font color="#000080">,</font><font color="#800000">54</font><font color="#000080">);                 </font><font color="#008000"><i>{ read and ignore :) }
     </i></font>BlockRead<font color="#000080">(</font>Data<font color="#000080">,</font>RGB<font color="#000080">,</font><font color="#800000">1024</font><font color="#000080">);                  </font><font color="#008000"><i>{ pal info }
     </i></font><font color="#FF0000"><b>FOR </b></font>I<font color="#000080">:=</font><font color="#800000">0 </font><font color="#FF0000"><b>TO </b></font><font color="#800000">255 </font><font color="#FF0000"><b>DO
  </b></font>SetPal<font color="#000080">(</font>I<font color="#000080">,</font>RGB<font color="#000080">[</font>I<font color="#000080">,</font><font color="#800000">3</font><font color="#000080">] </font><font color="#FF0000"><b>div </b></font><font color="#800000">4</font><font color="#000080">,</font>RGB<font color="#000080">[</font>I<font color="#000080">,</font><font color="#800000">2</font><font color="#000080">] </font><font color="#FF0000"><b>div </b></font><font color="#800000">4</font><font color="#000080">,</font>RGB<font color="#000080">[</font>I<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">] </font><font color="#FF0000"><b>div </b></font><font color="#800000">4</font><font color="#000080">);
     </font>BlockRead<font color="#000080">(</font>Data<font color="#000080">,</font>PicBuf<font color="#000080">^,</font><font color="#800000">64000</font><font color="#000080">);
     </font>Close<font color="#000080">(</font>Data<font color="#000080">);
     </font>aAddr <font color="#000080">:= </font>seg <font color="#000080">(</font>PicBuf<font color="#000080">^);

  </font><font color="#FF0000"><b>asm                    </b></font><font color="#008000"><i>{AMS routine 2.7 times faster than Pascal one!}
     </i></font><font color="#FF00FF">push si             </font><font color="#008000"><i>{wibble, wobble ;) }
     </i></font><font color="#FF00FF">push di             </font><font color="#008000"><i>{I'm no ASM, programmer so there MUST me room}
     </i></font><font color="#FF00FF">push es             </font><font color="#008000"><i>{for optimisation}
     </i></font><font color="#FF00FF">push ds
     mov es, [where]
     mov ds, [aAddr]
     mov di, 0
     mov dx, 63680
     mov cx, 200
  @page:
     push cx
     mov cx, 320
     mov si, dx
  @line:
     mov bh, byte ptr ds:[si]
     mov es:[di], bh
     inc di
     inc si
     loop @line
     sub dx, 320
     pop cx
     loop @page
     pop ds
     pop es
     pop di
     pop si
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{    for y:=0 to 199 do
      for x:=0 to 319 do
 Mem[where:y*320+x] := Mem[aAddr:(199-y)*320+x];}

  </i></font>FreeMem<font color="#000080">(</font>PicBuf<font color="#000080">,</font><font color="#800000">64000</font><font color="#000080">);
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>begin
  asm </b></font><font color="#FF00FF">mov        ax,0013h;int        10h; </font><font color="#FF0000"><b>end</b></font><font color="#000080">;      </font><font color="#008000"><i>{ set MCGA }
  </i></font>LoadBMP<font color="#000080">(</font><font color="#800000">'whatever.bmp'</font><font color="#000080">,</font><font color="#800000">$A000</font><font color="#000080">);

  </font><font color="#008000"><i>{ repeat until keypressed;  (use crt) }
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">.

</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to EGAVGA SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0141.PAS">Original</a><b>]</b></p></body>
</html>
