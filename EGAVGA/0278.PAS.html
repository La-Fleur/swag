<html>
<head><title> "Display Mono Bitmap in EGA/VGA text mode" by SWAG SUPPORT TEAM</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to EGAVGA SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0278.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#FF0000"><b>program </b></font>Bitmapld<font color="#000080">;
</font><font color="#FF0000"><b>Uses
  </b></font>DOS<font color="#000080">,
  </font>CRT<font color="#000080">;

</font><font color="#008000"><i>{FUNCTION:
  Loads and displays a mono .BMP bitmap file in
  Colour EGA/VGA text mode.
}

</i></font><font color="#FF0000"><b>const
  </b></font>CHAR_WIDTH <font color="#000080">= </font><font color="#800000">8</font><font color="#000080">; </font><font color="#008000"><i>{Width of chars in usable pixels}

{*********** `Spare' characters overwitten by bitmap}
{Edit this to suit your requirements}
  </i></font>GRABCHRS_STR <font color="#000080">: </font><font color="#FF0000"><b>String </b></font><font color="#000080">=
  </font><font color="#800000">#0#1#2#3#4#5#6#7#8#9#10#11#12#13#14#15 </font><font color="#000080">+
  </font><font color="#800000">#16#17#18#19#20#21#22#23#24#25#26#27#28#29#30#31 </font><font color="#000080">+
  </font><font color="#800000">'!&quot;#$%&amp;'#39'()*+,-./' </font><font color="#000080">+
  </font><font color="#800000">'0123456789:;&lt;=&gt;?@ABCDEFGHIJKLMNOPQRSTUVW' </font><font color="#000080">+
  </font><font color="#800000">'XYZ[\]^_`abcdefghijklmnopqrstuvwxyz{|}~' </font><font color="#000080">+
  </font><font color="#800000">'&euro;ÅÇÉÑÖÜáàâäãåçéèêëíìîïñóò&trade;öõúùûü†&iexcl;&cent;&pound;&curren;&yen;&brvbar;&sect;' </font><font color="#000080">+
  </font><font color="#800000">'&uml;&copy;&ordf;&laquo;&shy;≠&reg;&macr;&deg;&plusmn;&sup2;&sup3;&acute;&micro;∂&middot;&cedil;&sup1;&ordm;&raquo;&frac14;&frac12;&frac34;&iquest;' </font><font color="#000080">+
  </font><font color="#800000">'&agrave;&aacute;&acirc;&atilde;&auml;&aring;&aelig;&ccedil;&egrave;&eacute;&ecirc;&euml;&igrave;&iacute;&icirc;&iuml;&eth;&ntilde;&ograve;&oacute;&ocirc;&otilde;&ouml;&divide' </font><font color="#000080">+
  </font><font color="#800000">'&oslash;&ugrave;&uacute;&ucirc;&uuml;&yacute;&thorn;&yuml;'</font><font color="#000080">;

</font><font color="#FF0000"><b>type
</b></font><font color="#008000"><i>{*********** .BMP file data structures}
  </i></font>TBitMapFileHeader <font color="#000080">= </font><font color="#FF0000"><b>record
    </b></font>bfType           <font color="#000080">: </font>Word<font color="#000080">;
    </font>bfSize           <font color="#000080">: </font>LongInt<font color="#000080">;
    </font>bfReserved1      <font color="#000080">: </font>Word<font color="#000080">;
    </font>bfReserved2      <font color="#000080">: </font>Word<font color="#000080">;
    </font>bfOffbits        <font color="#000080">: </font>LongInt<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{TBitMapFileHeader}

  </i></font>TRgbQuad          <font color="#000080">= </font><font color="#FF0000"><b>record
    </b></font>rgbBlue	     <font color="#000080">: </font>Byte<font color="#000080">;
    </font>rgbGreen	     <font color="#000080">: </font>Byte<font color="#000080">;
    </font>rgbRed	     <font color="#000080">: </font>Byte<font color="#000080">;
    </font>rgbReserved	     <font color="#000080">: </font>Byte<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{TRgbQuad}

  </i></font>TBitMapInfoHeader <font color="#000080">= </font><font color="#FF0000"><b>record
    </b></font>biSize           <font color="#000080">: </font>LongInt<font color="#000080">;
    </font>biWidth	     <font color="#000080">: </font>LongInt<font color="#000080">;
    </font>biHeight	     <font color="#000080">: </font>LongInt<font color="#000080">;
    </font>biPlanes	     <font color="#000080">: </font>Word<font color="#000080">;
    </font>biBitCount	     <font color="#000080">: </font>Word<font color="#000080">;

    </font>biCompression    <font color="#000080">: </font>LongInt<font color="#000080">;
    </font>biSizeImage	     <font color="#000080">: </font>LongInt<font color="#000080">;
    </font>biXPelsPerMeter  <font color="#000080">: </font>LongInt<font color="#000080">;
    </font>biYPelsPerMeter  <font color="#000080">: </font>LongInt<font color="#000080">;
    </font>biClrUsed	     <font color="#000080">: </font>LongInt<font color="#000080">;
    </font>biClrImportant   <font color="#000080">: </font>LongInt<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{TBitMapInfoHeader}

  </i></font>TBitMapInfo       <font color="#000080">= </font><font color="#FF0000"><b>record
    </b></font>bmHeader         <font color="#000080">: </font>TBitMapInfoHeader<font color="#000080">;
    </font>bmiColors        <font color="#000080">: </font><font color="#FF0000"><b>array </b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">0</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>TRgbQuad<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{TBitMapInfo}

  </i></font>TBitMapContents  <font color="#000080">= </font><font color="#FF0000"><b>record
    case </b></font>Boolean <font color="#FF0000"><b>of
    </b></font>True<font color="#000080">:   (</font>bmcHeader  <font color="#000080">: </font>TBitMapFileHeader<font color="#000080">;
             </font>bmcInfo    <font color="#000080">: </font>TBitMapInfo<font color="#000080">);
    </font>False<font color="#000080">:  (</font>bmcByte    <font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">100</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Byte<font color="#000080">);
   </font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{TBitMapContents}

  </i></font>PBitMapContents <font color="#000080">= ^</font>TBitMapContents<font color="#000080">;

</font><font color="#008000"><i>{*********** Character Map Structures}
  </i></font>TCharMap <font color="#000080">= </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">31</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Byte<font color="#000080">;
  </font>TCharMapArray <font color="#000080">= </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">255</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>TCharMap<font color="#000080">;

</font><font color="#008000"><i>{*********** Global variables}
</i></font><font color="#FF0000"><b>var
  </b></font><font color="#008000"><i>{ Addresses assume colour EGA/VGA }
  </i></font>CRT_COLS        <font color="#000080">: </font>Word <font color="#FF0000"><b>absolute </b></font><font color="#800000">$0040</font><font color="#000080">:</font><font color="#800000">$004A</font><font color="#000080">;
  </font>CRT_ROWS_MINUS_1<font color="#000080">: </font>Byte <font color="#FF0000"><b>absolute </b></font><font color="#800000">$0040</font><font color="#000080">:</font><font color="#800000">$0084</font><font color="#000080">;
  </font>POINTS          <font color="#000080">: </font>Word <font color="#FF0000"><b>absolute </b></font><font color="#800000">$0040</font><font color="#000080">:</font><font color="#800000">$0085</font><font color="#000080">;

  </font>CharMapArray    <font color="#000080">: </font>TCharMapArray
                         <font color="#FF0000"><b>absolute </b></font><font color="#800000">$A000</font><font color="#000080">:</font><font color="#800000">$0000</font><font color="#000080">;
  </font>ScreenBuffer    <font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">$fff</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Byte
                         <font color="#FF0000"><b>absolute </b></font><font color="#800000">$B800</font><font color="#000080">:</font><font color="#800000">0000</font><font color="#000080">;
  </font>TempVideoBuffer <font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">$fff</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Byte<font color="#000080">;

  </font><font color="#008000"><i>{Shorthand for GRABCHRS' length byte}
  </i></font>NOGRABCHRS <font color="#000080">: </font>byte <font color="#FF0000"><b>absolute </b></font>GRABCHRS_STR<font color="#000080">;
  </font><font color="#008000"><i>{Easy access to GRABCHRS}
  </i></font>GRABCHRS <font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[-</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">255</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Byte
                            <font color="#FF0000"><b>absolute </b></font>GRABCHRS_STR<font color="#000080">;
  </font><font color="#008000"><i>{Stores default Exit procedure pointer}
  </i></font>ExitSave <font color="#000080">: </font>Pointer<font color="#000080">;

</font><font color="#008000"><i>{*********** Code begins}

</i></font><font color="#FF0000"><b>function </b></font>LoadBitMapFile<font color="#000080">(</font>fname <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
                        </font><font color="#FF0000"><b>var </b></font>FSize <font color="#000080">: </font>LongInt<font color="#000080">)
                                  : </font>Pointer<font color="#000080">;
</font><font color="#FF0000"><b>var
  </b></font>buffer <font color="#000080">: </font>Pointer<font color="#000080">;
  </font>Infile <font color="#000080">: </font><font color="#FF0000"><b>File</b></font><font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>Assign<font color="#000080">(</font>Infile<font color="#000080">, </font>fname<font color="#000080">);
</font><font color="#008000"><i>{$I-}
  </i></font>Reset<font color="#000080">(</font>Infile<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font>IOresult <font color="#000080">&lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then
  begin
    </b></font>Writeln<font color="#000080">(</font><font color="#800000">'Error opening file '</font><font color="#000080">,</font>fname<font color="#000080">);
    </font>Exit<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#008000"><i>{$I+}
  </i></font>FSize <font color="#000080">:= </font>FileSize<font color="#000080">(</font>Infile<font color="#000080">);
  </font>GetMem<font color="#000080">(</font>buffer<font color="#000080">,</font>Fsize<font color="#000080">);
  </font>Reset<font color="#000080">(</font>Infile<font color="#000080">,</font>Fsize<font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font>buffer <font color="#000080">&lt;&gt; </font><font color="#FF0000"><b>nil then
    </b></font>BlockRead<font color="#000080">(</font>Infile<font color="#000080">,</font>buffer<font color="#000080">^,</font><font color="#800000">1</font><font color="#000080">)
  </font><font color="#FF0000"><b>else
    </b></font>WriteLn<font color="#000080">(</font><font color="#800000">'Error: File too big to load'</font><font color="#000080">);
  </font>Close<font color="#000080">(</font>Infile<font color="#000080">);
  </font>LoadBitMapFile <font color="#000080">:= </font>Buffer<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{LoadBitMapFile}

</i></font><font color="#FF0000"><b>procedure </b></font>ProcessBitMap<font color="#000080">(</font>Buffer <font color="#000080">: </font>PBitMapContents<font color="#000080">;
                                 </font>row<font color="#000080">, </font>col <font color="#000080">: </font>Byte<font color="#000080">);
</font><font color="#008000"><i>{ Displays the bitmap Buffer, with top left
  corner at position (row, col)             }

</i></font><font color="#FF0000"><b>type
  </b></font>TByteBuffer <font color="#000080">= </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">32767</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Byte<font color="#000080">;
  </font>TSeqAndGCparms <font color="#000080">= </font><font color="#FF0000"><b>array </b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">3</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Word<font color="#000080">;

</font><font color="#FF0000"><b>const
  </b></font>SeqparmsSet <font color="#000080">: </font>TSeqAndGCparms <font color="#000080">=
    (</font><font color="#800000">$100</font><font color="#000080">, </font><font color="#800000">$402</font><font color="#000080">, </font><font color="#800000">$704</font><font color="#000080">, </font><font color="#800000">$300</font><font color="#000080">);
  </font>GCParmsSet  <font color="#000080">: </font>TSeqAndGCparms <font color="#000080">=
    (</font><font color="#800000">$204</font><font color="#000080">, </font><font color="#800000">$005</font><font color="#000080">, </font><font color="#800000">$006</font><font color="#000080">, </font><font color="#800000">0</font><font color="#000080">);
  </font>SeqparmsClr <font color="#000080">: </font>TSeqAndGCparms <font color="#000080">=
    (</font><font color="#800000">$100</font><font color="#000080">, </font><font color="#800000">$302</font><font color="#000080">, </font><font color="#800000">$304</font><font color="#000080">, </font><font color="#800000">$300</font><font color="#000080">);
  </font>GCParmsClr  <font color="#000080">: </font>TSeqAndGCparms <font color="#000080">=
    (</font><font color="#800000">$004</font><font color="#000080">, </font><font color="#800000">$1005</font><font color="#000080">, </font><font color="#800000">$0E06</font><font color="#000080">, </font><font color="#800000">0</font><font color="#000080">);


</font><font color="#FF0000"><b>var
  </b></font>BMData <font color="#000080">: ^</font>TByteBuffer<font color="#000080">;
  </font>BMBytesPerRow<font color="#000080">,
  </font>CurX<font color="#000080">, </font>CurY<font color="#000080">,
  </font>WidthInChars<font color="#000080">, </font>HeightInChars<font color="#000080">,
  </font>CharsUsedUp <font color="#000080">: </font>Integer<font color="#000080">;
  </font>CharMap <font color="#000080">: </font>TCharMap<font color="#000080">;
  </font>lastrow<font color="#000080">, </font>endrow<font color="#000080">, </font>endmask <font color="#000080">: </font>Byte<font color="#000080">;

  </font><font color="#FF0000"><b>procedure </b></font>SetUp<font color="#000080">;
  </font><font color="#FF0000"><b>var
    </b></font>PixelWidth <font color="#000080">: </font>Word<font color="#000080">;
    </font>CRT_ROWS   <font color="#000080">: </font>Byte<font color="#000080">;
  </font><font color="#FF0000"><b>begin
    </b></font><font color="#008000"><i>{Get start address of bitmap data}
    </i></font><font color="#FF0000"><b>with </b></font>Buffer<font color="#000080">^ </font><font color="#FF0000"><b>do
      </b></font>BMData <font color="#000080">:= @</font>bmcByte<font color="#000080">[</font>bmcHeader<font color="#000080">.</font>bfOffBits<font color="#000080">];

    </font><font color="#FF0000"><b>with </b></font>Buffer<font color="#000080">^.</font>bmcInfo<font color="#000080">.</font>bmHeader <font color="#FF0000"><b>do
    begin
      </b></font>BMBytesPerRow <font color="#000080">:= </font><font color="#800000">4 </font><font color="#000080">* ((</font>biWidth <font color="#000080">+ </font><font color="#800000">31</font><font color="#000080">) </font><font color="#FF0000"><b>div </b></font><font color="#800000">32</font><font color="#000080">);
      </font><font color="#008000"><i>{Get Clipped Width}
      </i></font><font color="#FF0000"><b>if </b></font>biWidth <font color="#000080">&gt; (</font>CHAR_WIDTH <font color="#000080">* </font>CRT_COLS<font color="#000080">) </font><font color="#FF0000"><b>then
        </b></font>biWidth <font color="#000080">:= (</font>CHAR_WIDTH <font color="#000080">* </font>CRT_COLS<font color="#000080">);
      </font>WidthInChars <font color="#000080">:= (</font>biWidth <font color="#000080">+ </font>CHAR_WIDTH <font color="#000080">- </font><font color="#800000">1</font><font color="#000080">)
                                  </font><font color="#FF0000"><b>div </b></font>CHAR_WIDTH<font color="#000080">;
      </font><font color="#FF0000"><b>if </b></font>biWidth <font color="#000080">= (</font>WidthInChars <font color="#000080">* </font>CHAR_WIDTH<font color="#000080">) </font><font color="#FF0000"><b>then
        </b></font>endmask <font color="#000080">:= </font><font color="#800000">$FF
      </font><font color="#FF0000"><b>else
        </b></font>endmask <font color="#000080">:= </font>Byte<font color="#000080">(</font><font color="#800000">$FF </font><font color="#FF0000"><b>shl </b></font><font color="#000080">(</font>CHAR_WIDTH <font color="#000080">-
                          </font>biWidth <font color="#FF0000"><b>mod </b></font>CHAR_WIDTH<font color="#000080">));
      </font>CRT_ROWS <font color="#000080">:= </font>Succ<font color="#000080">(</font>CRT_ROWS_MINUS_1<font color="#000080">);
      </font><font color="#008000"><i>{Get Clipped Height}
      </i></font><font color="#FF0000"><b>if </b></font>biHeight <font color="#000080">&gt; (</font>POINTS <font color="#000080">* </font>CRT_ROWS<font color="#000080">) </font><font color="#FF0000"><b>then
        </b></font>biHeight <font color="#000080">:= (</font>POINTS <font color="#000080">* </font>CRT_ROWS<font color="#000080">);
      </font>HeightInChars <font color="#000080">:= (</font>biHeight <font color="#000080">+ </font>Pred<font color="#000080">(</font>POINTS<font color="#000080">))
                                        </font><font color="#FF0000"><b>div </b></font>POINTS<font color="#000080">;
      </font>endrow <font color="#000080">:= </font>POINTS <font color="#000080">- </font>Pred<font color="#000080">(</font>biHeight<font color="#000080">) </font><font color="#FF0000"><b>mod </b></font>POINTS<font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{with}
  </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{SetUp}

</i></font><font color="#FF0000"><b>procedure </b></font>cGenMode<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>Seqparms<font color="#000080">, </font>GCparms<font color="#000080">:
                                   </font>TSeqAndGCparms<font color="#000080">);
</font><font color="#FF0000"><b>var </b></font>i <font color="#000080">: </font>Integer<font color="#000080">;
</font><font color="#FF0000"><b>begin
  asm </b></font><font color="#FF00FF">cli </font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{Disable interrupts}
  </i></font><font color="#FF0000"><b>for </b></font>i <font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font><font color="#800000">3 </font><font color="#FF0000"><b>do
    </b></font>PortW<font color="#000080">[</font><font color="#800000">$03c4</font><font color="#000080">] := </font>Seqparms<font color="#000080">[</font>i<font color="#000080">];
  </font><font color="#FF0000"><b>asm </b></font><font color="#FF00FF">sti </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>for </b></font>i <font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font><font color="#800000">2 </font><font color="#FF0000"><b>do
    </b></font>PortW<font color="#000080">[</font><font color="#800000">$03ce</font><font color="#000080">] := </font>GCparms<font color="#000080">[</font>i<font color="#000080">];
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>procedure </b></font>MapToChar<font color="#000080">;
  </font><font color="#FF0000"><b>var
    </b></font>i<font color="#000080">, </font>offset <font color="#000080">: </font>Integer<font color="#000080">;
    </font>mask <font color="#000080">: </font>Byte<font color="#000080">;
  </font><font color="#FF0000"><b>begin
    if </b></font>CurX <font color="#000080">= </font>WidthInChars <font color="#000080">- </font><font color="#800000">1 </font><font color="#FF0000"><b>then
      </b></font>mask <font color="#000080">:= </font>endmask
    <font color="#FF0000"><b>else
      </b></font>mask <font color="#000080">:= </font><font color="#800000">$FF</font><font color="#000080">;
    </font>offset <font color="#000080">:= </font>Succ<font color="#000080">(</font>CurY<font color="#000080">) * </font>POINTS <font color="#000080">* </font>BMBytesPerRow
                                             <font color="#000080">+ </font>CurX<font color="#000080">;
    </font>CharMap<font color="#000080">[</font>POINTS<font color="#000080">] := </font><font color="#800000">0</font><font color="#000080">; </font><font color="#008000"><i>{Zero checksum}
    </i></font><font color="#FF0000"><b>for </b></font>i <font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font>POINTS <font color="#000080">- </font><font color="#800000">1 </font><font color="#FF0000"><b>do
    begin
      if </b></font>i <font color="#000080">&gt;= </font>lastrow  <font color="#FF0000"><b>then
        </b></font>CharMap<font color="#000080">[</font>i<font color="#000080">] := </font>BMData<font color="#000080">^[</font>offset<font color="#000080">] </font><font color="#FF0000"><b>and </b></font>mask
      <font color="#FF0000"><b>else
        </b></font>CharMap<font color="#000080">[</font>i<font color="#000080">] := </font><font color="#800000">0</font><font color="#000080">;
      </font>Inc<font color="#000080">(</font>CharMap<font color="#000080">[</font>POINTS<font color="#000080">], </font>CharMap<font color="#000080">[</font>i<font color="#000080">]);
      </font>Dec<font color="#000080">(</font>offset<font color="#000080">,</font>BMBytesPerRow<font color="#000080">);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{MapToChar}

  </i></font><font color="#FF0000"><b>procedure </b></font>PlotChar<font color="#000080">(</font>character <font color="#000080">: </font>Byte<font color="#000080">);
  </font><font color="#FF0000"><b>begin
    </b></font>TempVideoBuffer<font color="#000080">[((</font>HeightInChars <font color="#000080">- </font>CurY <font color="#000080">+ </font>row <font color="#000080">- </font><font color="#800000">1</font><font color="#000080">)
                    * </font>CRT_COLS <font color="#000080">+ </font>CurX <font color="#000080">+ </font>col<font color="#000080">) * </font><font color="#800000">2</font><font color="#000080">]
                                        := </font>character<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{PlotChar}


  </i></font><font color="#FF0000"><b>function </b></font>FoundInStore <font color="#000080">: </font>Boolean<font color="#000080">;

    </font><font color="#FF0000"><b>function </b></font>Comp<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>Buf1<font color="#000080">, </font>Buf2 <font color="#000080">: </font>TCharMap<font color="#000080">;
                      </font>POINTS     <font color="#000080">: </font>Word<font color="#000080">)
                              : </font>Boolean<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>asm
      </b></font><font color="#FF00FF">push</font>	<font color="#FF00FF">ds
</font><font color="#008000"><i>{ Move default return to ax - 'True'}
      </i></font><font color="#FF00FF">mov       ax, 1
      lds</font>	<font color="#FF00FF">si, Buf1
      add       si, [POINTS]
      les</font>	<font color="#FF00FF">di, Buf2
      add       di, [POINTS]
      mov</font>	<font color="#FF00FF">cx, [POINTS]
      inc       cx
</font><font color="#008000"><i>{ Search backwards to find checksum 1st}
      </i></font><font color="#FF00FF">std
      rep</font>	<font color="#FF00FF">cmpsb
      je</font>	<font color="#FF00FF">@@Exit
</font><font color="#008000"><i>{ Flag failed match in return }
      </i></font><font color="#FF00FF">xor</font>	<font color="#FF00FF">ax, ax
@@Exit:
      pop</font>	<font color="#FF00FF">ds
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>var
    </b></font>i <font color="#000080">: </font>Integer<font color="#000080">;
  </font><font color="#FF0000"><b>begin
    </b></font>FoundInStore <font color="#000080">:= </font>True<font color="#000080">;
    </font><font color="#FF0000"><b>for </b></font>i <font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font>Pred<font color="#000080">(</font>CharsUsedUp<font color="#000080">) </font><font color="#FF0000"><b>do
      if </b></font>Comp<font color="#000080">(</font>CharMapArray<font color="#000080">[</font>GRABCHRS<font color="#000080">[</font>i<font color="#000080">]],
               </font>CharMap<font color="#000080">,</font>POINTS<font color="#000080">)            </font><font color="#FF0000"><b>then
      begin
        </b></font>PlotChar<font color="#000080">(</font>GRABCHRS<font color="#000080">[</font>i<font color="#000080">]);
        </font>Exit<font color="#000080">;
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font>FoundInStore <font color="#000080">:= </font>False<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>begin  </b></font><font color="#008000"><i>{ ProcessBitMap }
  </i></font>Setup<font color="#000080">;
  </font>Move<font color="#000080">(</font>ScreenBuffer<font color="#000080">, </font>TempVideoBuffer<font color="#000080">,
                     </font>Sizeof<font color="#000080">(</font>TempVideoBuffer<font color="#000080">));
  </font>cGenMode<font color="#000080">(</font>SeqparmsSet<font color="#000080">, </font>GCParmsSet<font color="#000080">);
  </font>CharsUsedUp <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">; </font>lastrow <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font>CurX <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">; </font>CurY <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font><font color="#FF0000"><b>repeat
    </b></font>MapToChar<font color="#000080">;
    </font><font color="#FF0000"><b>if not </b></font>FoundInStore <font color="#FF0000"><b>then
    begin
      </b></font>Move<font color="#000080">(</font>CharMap<font color="#000080">,
           </font>CharMapArray<font color="#000080">[</font>GRABCHRS<font color="#000080">[</font>CharsUsedUp<font color="#000080">]],
           </font>Succ<font color="#000080">(</font>Points<font color="#000080">));
      </font>PlotChar<font color="#000080">(</font>GRABCHRS<font color="#000080">[</font>CharsUsedUp<font color="#000080">]);
      </font>Inc<font color="#000080">(</font>CharsUsedUp<font color="#000080">);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font>CurX <font color="#000080">:= (</font>CurX <font color="#000080">+ </font><font color="#800000">1</font><font color="#000080">) </font><font color="#FF0000"><b>mod </b></font>WidthInChars<font color="#000080">;
    </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>CurX <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>then
    begin
      </b></font>Inc<font color="#000080">(</font>CurY<font color="#000080">);
      </font><font color="#FF0000"><b>if </b></font>CurY <font color="#000080">= </font>HeightInChars <font color="#000080">- </font><font color="#800000">1 </font><font color="#FF0000"><b>then
        </b></font>lastrow <font color="#000080">:= </font>endrow
    <font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>until </b></font><font color="#000080">(</font>CharsUsedUp <font color="#000080">= </font>NOGRABCHRS<font color="#000080">) </font><font color="#FF0000"><b>or
        </b></font><font color="#000080">(</font>CurY <font color="#000080">= </font>HeightInChars<font color="#000080">);
  </font>cGenMode<font color="#000080">(</font>SeqparmsClr<font color="#000080">, </font>GCParmsClr<font color="#000080">);
  </font>Move<font color="#000080">(</font>TempVideoBuffer<font color="#000080">, </font>ScreenBuffer<font color="#000080">,
       </font>Sizeof<font color="#000080">(</font>TempVideoBuffer<font color="#000080">));

</font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{ProcessBitMap}

</i></font><font color="#FF0000"><b>procedure </b></font>DisplayBitMap<font color="#000080">;
</font><font color="#FF0000"><b>var
  </b></font>BitMapBuffer <font color="#000080">: </font>PBitMapContents<font color="#000080">;
  </font>FileSize <font color="#000080">: </font>LongInt<font color="#000080">;
</font><font color="#FF0000"><b>begin
  if </b></font>ParamStr<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">) = </font><font color="#800000">'' </font><font color="#FF0000"><b>then
  begin
    </b></font>WriteLn<font color="#000080">(</font><font color="#800000">'USAGE: BITMAPLD &lt;file.bmp&gt;'</font><font color="#000080">);
    </font>Exit<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>BitMapBuffer <font color="#000080">:=
            </font>LoadBitMapFile<font color="#000080">(</font>ParamStr<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">),</font>FileSize<font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font>BitMapBuffer<font color="#000080">&lt;&gt; </font><font color="#FF0000"><b>nil then
  begin
    </b></font>ProcessBitMap<font color="#000080">(</font>BitMapBuffer<font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">);
    </font>FreeMem<font color="#000080">(</font>BitMapBuffer<font color="#000080">, </font>FileSize<font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{DisplayBitMap}

</i></font><font color="#FF0000"><b>procedure </b></font>ResetFont<font color="#000080">; </font><font color="#FF0000"><b>far</b></font><font color="#000080">;
</font><font color="#008000"><i>{This is called as an exit procedure, so the screen
 is always restored, even if something goes wrong...
 not that it will...   }
</i></font><font color="#FF0000"><b>var
  </b></font>regs <font color="#000080">: </font>Registers<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>ExitProc <font color="#000080">:= </font>ExitSave<font color="#000080">; </font><font color="#008000"><i>{Restore default exit proc}
  </i></font>regs<font color="#000080">.</font>ah <font color="#000080">:= </font><font color="#800000">$11</font><font color="#000080">;
  </font><font color="#FF0000"><b>case </b></font>POINTS <font color="#FF0000"><b>of </b></font><font color="#008000"><i>{Select correct ROM font}
    </i></font><font color="#800000">16</font><font color="#000080">: </font><font color="#008000"><i>{Load 8 x 16 font}
      </i></font>regs<font color="#000080">.</font>al <font color="#000080">:= </font><font color="#800000">4</font><font color="#000080">;
    </font><font color="#800000">8</font><font color="#000080">:  </font><font color="#008000"><i>{Load 8 x 8 font}
      </i></font>regs<font color="#000080">.</font>al <font color="#000080">:= </font><font color="#800000">2</font><font color="#000080">;
    </font><font color="#FF0000"><b>else </b></font><font color="#008000"><i>{Choose 8 x 14 - it's the safest}
      </i></font>regs<font color="#000080">.</font>al <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{case}
  </i></font>regs<font color="#000080">.</font>bl <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font>intr<font color="#000080">(</font><font color="#800000">$10</font><font color="#000080">,</font>regs<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{ResetFont}

{*********** Main program }

</i></font><font color="#FF0000"><b>begin
  </b></font>ExitSave <font color="#000080">:= </font>ExitProc<font color="#000080">; </font>ExitProc <font color="#000080">:= @</font>ResetFont<font color="#000080">;
  </font>ClrScr<font color="#000080">;
  </font>DisplayBitMap<font color="#000080">;
  </font>ReadKey<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">.

</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to EGAVGA SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0278.PAS">Original</a><b>]</b></p></body>
</html>
