<html>
<head><title> "Convert PCX file to PASCAL images" by BOJAN LANDEKIC</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to EGAVGA SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0246.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{$G+}
</i></font><font color="#FF0000"><b>UNIT </b></font>MODEX<font color="#000080">;

</font><font color="#FF0000"><b>INTERFACE

TYPE
     </b></font>Virtual_Scr <font color="#000080">= </font><font color="#FF0000"><b>Array </b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">64000</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">;  </font><font color="#008000"><i>{The size of our Virtual Screen}
     </i></font>Virtual_Pal <font color="#000080">= </font><font color="#FF0000"><b>Array </b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">255</font><font color="#000080">, </font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">3</font><font color="#000080">] </font><font color="#FF0000"><b>Of </b></font>Byte<font color="#000080">; </font><font color="#008000"><i>{Our virtual Palette}

     </i></font>Virt_ScrPtr <font color="#000080">= ^</font>Virtual_Scr<font color="#000080">;              </font><font color="#008000"><i>{Pointer to the virtual screen}
     </i></font>Virt_PalPtr <font color="#000080">= ^</font>Virtual_Pal<font color="#000080">;              </font><font color="#008000"><i>{Pointer to the virtual palette}

</i></font><font color="#FF0000"><b>CONST
     </b></font>View_Page <font color="#000080">: </font>Word <font color="#000080">= </font><font color="#800000">$A000</font><font color="#000080">;       </font><font color="#008000"><i>{the viewable page}


         </i></font><font color="#FF0000"><b>PROCEDURE </b></font>Init_VGA<font color="#000080">; </font><font color="#008000"><i>{Puts you in 320x200x256 VGA}
         </i></font><font color="#FF0000"><b>PROCEDURE </b></font>Init_VGA2<font color="#000080">; </font><font color="#008000"><i>{Puts you in 320x200x256 VGA}
         </i></font><font color="#FF0000"><b>PROCEDURE </b></font>Init_TEXT<font color="#000080">; </font><font color="#008000"><i>{Puts you back in 80x25 text mode}
         </i></font><font color="#FF0000"><b>PROCEDURE </b></font>Clear_VGA<font color="#000080">(</font>Page<font color="#000080">: </font>Word<font color="#000080">); </font><font color="#008000"><i>{Clears the 320x200x256 VGA}
         </i></font><font color="#FF0000"><b>PROCEDURE </b></font>Stretch<font color="#000080">(</font>Value <font color="#000080">: </font>byte<font color="#000080">);
         </font><font color="#FF0000"><b>PROCEDURE </b></font>WaitVR<font color="#000080">;
         </font><font color="#FF0000"><b>PROCEDURE </b></font>WaitDE<font color="#000080">;
         </font><font color="#FF0000"><b>PROCEDURE </b></font>MoveCursor <font color="#000080">(</font>X<font color="#000080">,</font>Y <font color="#000080">: </font>byte<font color="#000080">); </font><font color="#008000"><i>{Moves the cursor to (X,Y)}
         </i></font><font color="#FF0000"><b>FUNCTION </b></font>ReadCursorX<font color="#000080">: </font>byte<font color="#000080">; </font><font color="#008000"><i>{Get X position of cursor}
         </i></font><font color="#FF0000"><b>FUNCTION </b></font>ReadCursorY<font color="#000080">: </font>byte<font color="#000080">; </font><font color="#008000"><i>{Get Y position of cursor}
         </i></font><font color="#FF0000"><b>PROCEDURE </b></font>BIOSWrite<font color="#000080">(</font>Str <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">; </font>Color <font color="#000080">: </font>Byte<font color="#000080">);
         </font><font color="#FF0000"><b>PROCEDURE </b></font>SetPix<font color="#000080">(</font>x<font color="#000080">, </font>y<font color="#000080">: </font>integer<font color="#000080">; </font>c<font color="#000080">: </font>Byte<font color="#000080">; </font>Page<font color="#000080">: </font>Word<font color="#000080">);
         </font><font color="#FF0000"><b>PROCEDURE </b></font>Move_Up<font color="#000080">(</font>x1<font color="#000080">, </font>y1<font color="#000080">, </font>x2<font color="#000080">, </font>y2<font color="#000080">: </font>Word<font color="#000080">);
         </font><font color="#FF0000"><b>PROCEDURE </b></font>Move_Up2<font color="#000080">(</font>x1<font color="#000080">, </font>y1<font color="#000080">, </font>x2<font color="#000080">, </font>y2<font color="#000080">: </font>Word<font color="#000080">);
         </font><font color="#FF0000"><b>PROCEDURE </b></font>Move_Up3<font color="#000080">(</font>x1<font color="#000080">, </font>y1<font color="#000080">, </font>x2<font color="#000080">, </font>y2<font color="#000080">: </font>Word<font color="#000080">);
         </font><font color="#FF0000"><b>PROCEDURE </b></font>Move_Left<font color="#000080">(</font>x1<font color="#000080">, </font>y1<font color="#000080">, </font>x2<font color="#000080">, </font>y2<font color="#000080">: </font>Word<font color="#000080">);
         </font><font color="#FF0000"><b>PROCEDURE </b></font>Screen_Pan<font color="#000080">(</font>ScrOfs <font color="#000080">: </font>Word<font color="#000080">);
         </font><font color="#FF0000"><b>PROCEDURE </b></font>Synk<font color="#000080">;
         </font><font color="#FF0000"><b>PROCEDURE </b></font>Set_Color<font color="#000080">(</font>ColorNum<font color="#000080">, </font>R<font color="#000080">, </font>G<font color="#000080">, </font>B<font color="#000080">: </font>Byte<font color="#000080">);
         </font><font color="#FF0000"><b>PROCEDURE </b></font>Get_Color<font color="#000080">(</font>ColorNum<font color="#000080">: </font>Byte<font color="#000080">; </font><font color="#FF0000"><b>Var </b></font>R<font color="#000080">, </font>G<font color="#000080">, </font>B<font color="#000080">: </font>Byte<font color="#000080">);
         </font><font color="#FF0000"><b>FUNCTION </b></font>GetPix<font color="#000080">(</font>x<font color="#000080">, </font>y<font color="#000080">, </font>Page <font color="#000080">: </font>Word<font color="#000080">) : </font>Byte<font color="#000080">;
         </font><font color="#FF0000"><b>PROCEDURE </b></font>Flip<font color="#000080">(</font>Source<font color="#000080">, </font>Dest<font color="#000080">: </font>Word<font color="#000080">);
         </font><font color="#FF0000"><b>PROCEDURE </b></font>ScaleBitmap<font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>bmp2scale<font color="#000080">; </font>actualx<font color="#000080">, </font>actualy <font color="#000080">: </font>Byte<font color="#000080">;
                                   </font>bstrtx<font color="#000080">, </font>bstrty<font color="#000080">, </font>bendx<font color="#000080">, </font>bendy <font color="#000080">: </font>Word<font color="#000080">);
         </font><font color="#FF0000"><b>PROCEDURE </b></font>GetImage <font color="#000080">(</font>X1<font color="#000080">, </font>Y1<font color="#000080">, </font>X2<font color="#000080">, </font>Y2<font color="#000080">: </font>Integer<font color="#000080">; </font><font color="#FF0000"><b>Var </b></font>Dest<font color="#000080">);
         </font><font color="#FF0000"><b>PROCEDURE </b></font>PutImage<font color="#000080">(</font>X1<font color="#000080">, </font>Y1<font color="#000080">: </font>Integer<font color="#000080">; </font><font color="#FF0000"><b>Var </b></font>Source<font color="#000080">);
         </font><font color="#FF0000"><b>PROCEDURE </b></font>DrawBar<font color="#000080">(</font>X1<font color="#000080">, </font>Y1<font color="#000080">, </font>X2<font color="#000080">, </font>Y2<font color="#000080">: </font>Integer<font color="#000080">; </font>Color<font color="#000080">: </font>Byte<font color="#000080">);
         </font><font color="#FF0000"><b>PROCEDURE </b></font>Pan<font color="#000080">(</font>X<font color="#000080">,</font>Y<font color="#000080">: </font>Word<font color="#000080">);
         </font><font color="#FF0000"><b>PROCEDURE </b></font>VgaBase<font color="#000080">(</font>Xscroll<font color="#000080">,</font>Yscroll<font color="#000080">:</font>integer<font color="#000080">; </font><font color="#FF0000"><b>Var </b></font>Slide<font color="#000080">: </font>Word<font color="#000080">);
         </font><font color="#FF0000"><b>PROCEDURE </b></font>SetAddress<font color="#000080">(</font>ad<font color="#000080">:</font>word<font color="#000080">);
         </font><font color="#FF0000"><b>PROCEDURE </b></font>SetLinecomp<font color="#000080">(</font>ad<font color="#000080">:</font>word<font color="#000080">);
         </font><font color="#FF0000"><b>PROCEDURE </b></font>Draw_Line<font color="#000080">( </font>x<font color="#000080">, </font>y<font color="#000080">, </font>x2<font color="#000080">, </font>y2<font color="#000080">: </font>Word<font color="#000080">; </font>Color<font color="#000080">: </font>Byte<font color="#000080">; </font>Page<font color="#000080">: </font>word<font color="#000080">);
         </font><font color="#FF0000"><b>PROCEDURE </b></font>Fade_Area<font color="#000080">(</font>x<font color="#000080">, </font>y<font color="#000080">, </font>x2<font color="#000080">, </font>y2<font color="#000080">: </font>Word<font color="#000080">;  </font>Difference<font color="#000080">: </font>Integer<font color="#000080">; </font>Page<font color="#000080">: </font>Word<font color="#000080">);


</font><font color="#FF0000"><b>IMPLEMENTATION

CONST
     </b></font>Crtadress    <font color="#000080">: </font>Word <font color="#000080">= </font><font color="#800000">$3d4</font><font color="#000080">;
     </font>Inputstatus  <font color="#000080">: </font>Word <font color="#000080">= </font><font color="#800000">$3DA</font><font color="#000080">;

</font><font color="#FF0000"><b>TYPE
     </b></font>Fixed <font color="#000080">= </font><font color="#FF0000"><b>RECORD
           CASE </b></font>Boolean <font color="#FF0000"><b>OF
                </b></font>True  <font color="#000080">: (</font>w <font color="#000080">: </font>LongInt<font color="#000080">);
                </font>False <font color="#000080">: (</font>f<font color="#000080">, </font>i <font color="#000080">: </font>Word<font color="#000080">);
           </font><font color="#FF0000"><b>END</b></font><font color="#000080">;


</font><font color="#FF0000"><b>PROCEDURE </b></font>Init_VGA<font color="#000080">; </font><font color="#FF0000"><b>ASSEMBLER</b></font><font color="#000080">;  </font><font color="#008000"><i>{Puts you in 320x200x256 VGA}
          </i></font><font color="#FF0000"><b>ASM
             </b></font><font color="#FF00FF">XOR  AH, AH  </font><font color="#008000"><i>{save as MOV AH, 0 but faster}
             </i></font><font color="#FF00FF">MOV  AL, $13
             </font><font color="#008000"><i>{MOV  AX, $13}
             </i></font><font color="#FF00FF">INT  $10
          </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>PROCEDURE </b></font>Init_VGA2<font color="#000080">; </font><font color="#FF0000"><b>ASSEMBLER</b></font><font color="#000080">;
          </font><font color="#FF0000"><b>ASM
        </b></font><font color="#FF00FF">mov ax,13h
        int 10h
        mov dx,3c4h
        mov ax,0604h
        out dx,ax
        mov ax,0f02h
        out dx,ax
        mov cx,320*200
        mov es,view_page
        xor ax,ax
        mov di,ax
        rep stosw
        mov dx,3d4h
        mov ax,0014h
        out dx,ax
        mov ax,0e317h
        out dx,ax
          </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>PROCEDURE </b></font>Init_TEXT<font color="#000080">; </font><font color="#FF0000"><b>ASSEMBLER</b></font><font color="#000080">; </font><font color="#008000"><i>{Puts you back in 80x25 text mode}
          </i></font><font color="#FF0000"><b>ASM
             </b></font><font color="#FF00FF">XOR  AH, AH  </font><font color="#008000"><i>{save as MOV AH, 0 but faster}
             </i></font><font color="#FF00FF">MOV  AL, $3
             </font><font color="#008000"><i>{MOV  AX, $3}
             </i></font><font color="#FF00FF">INT  $10
          </font><font color="#FF0000"><b>End</b></font><font color="#000080">;


</font><font color="#FF0000"><b>PROCEDURE </b></font>Clear_VGA<font color="#000080">(</font>Page<font color="#000080">: </font>Word<font color="#000080">); </font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;
          </font><font color="#FF0000"><b>ASM
             </b></font><font color="#FF00FF">cld
             mov ax, [Page]
             mov es, ax
             xor di, di
             xor ah, ah
             mov cx, 32000
             rep stosw
          </font><font color="#FF0000"><b>End</b></font><font color="#000080">;


</font><font color="#008000"><i>{stretches the screen : EFFECT}
</i></font><font color="#FF0000"><b>PROCEDURE </b></font>Stretch<font color="#000080">(</font>Value <font color="#000080">: </font>byte<font color="#000080">); </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
          </font><font color="#FF0000"><b>ASM
             </b></font><font color="#FF00FF">push   ax         </font><font color="#008000"><i>{Save the necessary registers}
             </i></font><font color="#FF00FF">push   dx
             mov    al, $9      </font><font color="#008000"><i>{Index 09h }
             </i></font><font color="#FF00FF">mov    dx, $3D4    </font><font color="#008000"><i>{CRTC register }
             </i></font><font color="#FF00FF">out    dx, al      </font><font color="#008000"><i>{Output with a value of 0 }
             </i></font><font color="#FF00FF">mov    dx, $3D5    </font><font color="#008000"><i>{Get ready to read the port }
             </i></font><font color="#FF00FF">in     al, dx      </font><font color="#008000"><i>{read from it }
             </i></font><font color="#FF00FF">and    al, $0E0
             add    al, Value   </font><font color="#008000"><i>{Put the value in al }
             </i></font><font color="#FF00FF">out    dx, al      </font><font color="#008000"><i>{go ahead and do it }
             </i></font><font color="#FF00FF">pop    dx
             pop    ax         </font><font color="#008000"><i>{Restore the registers }
          </i></font><font color="#FF0000"><b>End</b></font><font color="#000080">;


</font><font color="#008000"><i>{Wait for a vertical retrace}
</i></font><font color="#FF0000"><b>PROCEDURE </b></font>WaitVR<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
          </font><font color="#FF0000"><b>asm
             </b></font><font color="#FF00FF">mov dx, $03DA
             @wvr:
                  in   al,dx
                  test al,8
             jz @wvr
          </font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#008000"><i>{wait for Display Enable}
</i></font><font color="#FF0000"><b>PROCEDURE </b></font>WaitDE<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
          </font><font color="#FF0000"><b>asm
             </b></font><font color="#FF00FF">mov dx, $03DA
             @wde:
                  in   al,dx
                  test al,1
             jnz @wde
          </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>PROCEDURE </b></font>MoveCursor <font color="#000080">(</font>X<font color="#000080">,</font>Y <font color="#000080">: </font>byte<font color="#000080">); </font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">; </font><font color="#008000"><i>{Moves the cursor to (X,Y)}
          </i></font><font color="#FF0000"><b>ASM
             </b></font><font color="#FF00FF">MOV ah, $02
             XOR bx, bx
             MOV dh, Y
             MOV dl, X
             INT $10
          </font><font color="#FF0000"><b>End</b></font><font color="#000080">;



</font><font color="#FF0000"><b>FUNCTION </b></font>ReadCursorX<font color="#000080">: </font>byte<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;  </font><font color="#008000"><i>{Get X position of cursor}
         </i></font><font color="#FF0000"><b>ASM
            </b></font><font color="#FF00FF">MOV ah, $03
            XOR bx, bx
            INT $10
            MOV al, dl
         </font><font color="#FF0000"><b>End</b></font><font color="#000080">;


</font><font color="#FF0000"><b>FUNCTION </b></font>ReadCursorY<font color="#000080">: </font>byte<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;  </font><font color="#008000"><i>{Get Y position of cursor}
         </i></font><font color="#FF0000"><b>ASM
            </b></font><font color="#FF00FF">MOV ah, $03
            XOR bx, bx
            INT $10
            MOV al, dh
         </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>PROCEDURE </b></font>BIOSWrite<font color="#000080">(</font>Str <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">; </font>Color <font color="#000080">: </font>Byte<font color="#000080">); </font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;
          </font><font color="#FF0000"><b>ASM
             </b></font><font color="#FF00FF">les  di, Str
             mov  cl, es:[di]     </font><font color="#008000"><i>{ cl = longueur chane }
             </i></font><font color="#FF00FF">inc  di              </font><font color="#008000"><i>{ es:di pointe sur 1er caractre }
             </i></font><font color="#FF00FF">xor  ch, ch          </font><font color="#008000"><i>{ cx = longueur chane }
             </i></font><font color="#FF00FF">mov  bl, Color       </font><font color="#008000"><i>{ bl:=coul }
             </i></font><font color="#FF00FF">jcxz @ExitBW         </font><font color="#008000"><i>{ sortie si Length(s)=0 }
             </i></font><font color="#FF00FF">@BoucleBW:
                       mov  ah, 0eh         </font><font color="#008000"><i>{ sortie TTY }
                       </i></font><font color="#FF00FF">mov  al, es:[di]     </font><font color="#008000"><i>{ al=caractre  afficher }
                       </i></font><font color="#FF00FF">int  10h             </font><font color="#008000"><i>{ et hop }
                       </i></font><font color="#FF00FF">inc  di              </font><font color="#008000"><i>{ caractre suivant }
             </i></font><font color="#FF00FF">loop @BoucleBW
             @ExitBW:
          </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>PROCEDURE </b></font>SetPix<font color="#000080">(</font>x<font color="#000080">, </font>y<font color="#000080">: </font>integer<font color="#000080">; </font>c<font color="#000080">: </font>Byte<font color="#000080">; </font>Page<font color="#000080">: </font>Word<font color="#000080">);
          </font><font color="#FF0000"><b>Begin
               </b></font>Mem<font color="#000080">[</font>View_Page<font color="#000080">: </font>y <font color="#000080">* </font><font color="#800000">320 </font><font color="#000080">+ </font>x<font color="#000080">] := </font>c<font color="#000080">;
          </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>PROCEDURE </b></font>SetPix2<font color="#000080">(</font>x<font color="#000080">, </font>y<font color="#000080">: </font>integer<font color="#000080">; </font>c<font color="#000080">: </font>Byte<font color="#000080">; </font>Page<font color="#000080">: </font>Word<font color="#000080">); </font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;
          </font><font color="#FF0000"><b>asm
             </b></font><font color="#FF00FF">mov ax, [Page]
             mov es, ax
             mov ax, y
             mov bx, 320
             mul bx
             mov di, x
             add di, ax
             mov al, c
             mov es:[di],al
          </font><font color="#FF0000"><b>End</b></font><font color="#000080">;


</font><font color="#FF0000"><b>PROCEDURE </b></font>Move_Up<font color="#000080">(</font>x1<font color="#000080">, </font>y1<font color="#000080">, </font>x2<font color="#000080">, </font>y2<font color="#000080">: </font>Word<font color="#000080">);
          </font><font color="#FF0000"><b>type </b></font>t_bmp_type <font color="#000080">= </font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">63999</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Byte<font color="#000080">;
               </font>pt_bmp_type <font color="#000080">= ^</font>t_bmp_type<font color="#000080">;

          </font><font color="#FF0000"><b>var
             </b></font>t_bmp <font color="#000080">: </font>pt_bmp_type<font color="#000080">;

          </font><font color="#FF0000"><b>Begin
               </b></font>New<font color="#000080">(</font>t_bmp<font color="#000080">);
               </font>GetImage<font color="#000080">(</font>x1<font color="#000080">, </font>y1<font color="#000080">, </font>x2<font color="#000080">, </font>y2<font color="#000080">, </font>t_bmp<font color="#000080">^);
               </font>PutImage<font color="#000080">(</font>x1<font color="#000080">, </font>y1 <font color="#000080">- </font><font color="#800000">1</font><font color="#000080">, </font>t_bmp<font color="#000080">^);
               </font>Dispose<font color="#000080">(</font>t_bmp<font color="#000080">);
          </font><font color="#FF0000"><b>End</b></font><font color="#000080">;


</font><font color="#FF0000"><b>PROCEDURE </b></font>Move_Up2<font color="#000080">(</font>x1<font color="#000080">, </font>y1<font color="#000080">, </font>x2<font color="#000080">, </font>y2<font color="#000080">: </font>Word<font color="#000080">);
          </font><font color="#FF0000"><b>Var
             </b></font>x<font color="#000080">,
             </font>y  <font color="#000080">: </font>Word<font color="#000080">;

          </font><font color="#FF0000"><b>Begin
               For </b></font>Y <font color="#000080">:= </font>y1 <font color="#FF0000"><b>to </b></font>y2 <font color="#FF0000"><b>Do
                   For </b></font>X <font color="#000080">:= </font>x1 <font color="#FF0000"><b>To </b></font>x2 <font color="#FF0000"><b>Do
                       </b></font>SetPix<font color="#000080">(</font>x<font color="#000080">, </font>y<font color="#000080">, </font>GetPix<font color="#000080">(</font>x<font color="#000080">, </font>y <font color="#000080">+ </font><font color="#800000">1</font><font color="#000080">, </font>View_Page<font color="#000080">), </font>View_Page<font color="#000080">);
          </font><font color="#FF0000"><b>End</b></font><font color="#000080">;


</font><font color="#FF0000"><b>PROCEDURE </b></font>Move_Up3<font color="#000080">(</font>x1<font color="#000080">, </font>y1<font color="#000080">, </font>x2<font color="#000080">, </font>y2<font color="#000080">: </font>Word<font color="#000080">);
          </font><font color="#FF0000"><b>Var
             </b></font>y  <font color="#000080">: </font>Word<font color="#000080">;

          </font><font color="#FF0000"><b>Begin
               for </b></font>y <font color="#000080">:= </font>y1 <font color="#FF0000"><b>to </b></font>y2 <font color="#FF0000"><b>do
                   </b></font>Move<font color="#000080">(</font>MEM<font color="#000080">[</font><font color="#800000">$A000</font><font color="#000080">:</font>y<font color="#000080">*</font><font color="#800000">320</font><font color="#000080">], </font>MEM<font color="#000080">[</font><font color="#800000">$A000</font><font color="#000080">:</font>pred<font color="#000080">(</font>y<font color="#000080">)*</font><font color="#800000">320</font><font color="#000080">], </font><font color="#800000">320</font><font color="#000080">);
          </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>PROCEDURE </b></font>Move_Left<font color="#000080">(</font>x1<font color="#000080">, </font>y1<font color="#000080">, </font>x2<font color="#000080">, </font>y2<font color="#000080">: </font>Word<font color="#000080">);
          </font><font color="#FF0000"><b>type </b></font>t_bmp_type <font color="#000080">= </font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">63999</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Byte<font color="#000080">;
               </font>pt_bmp_type <font color="#000080">= ^</font>t_bmp_type<font color="#000080">;

          </font><font color="#FF0000"><b>var
             </b></font>t_bmp <font color="#000080">: </font>pt_bmp_type<font color="#000080">;

          </font><font color="#FF0000"><b>Begin
               </b></font>New<font color="#000080">(</font>t_bmp<font color="#000080">);
               </font>GetImage<font color="#000080">(</font>x1 <font color="#000080">+ </font><font color="#800000">1</font><font color="#000080">, </font>y1<font color="#000080">, </font>x2<font color="#000080">, </font>y2<font color="#000080">, </font>t_bmp<font color="#000080">^);
               </font>PutImage<font color="#000080">(</font>x1<font color="#000080">, </font>y1<font color="#000080">, </font>t_bmp<font color="#000080">^);
               </font>Dispose<font color="#000080">(</font>t_bmp<font color="#000080">);
          </font><font color="#FF0000"><b>End</b></font><font color="#000080">;



</font><font color="#FF0000"><b>PROCEDURE </b></font>Screen_Pan<font color="#000080">(</font>ScrOfs <font color="#000080">: </font>Word<font color="#000080">); </font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;
          </font><font color="#FF0000"><b>Asm
             </b></font><font color="#FF00FF">mov bx, ScrOfs
             mov dx, $3d4
             mov ah, bh
             mov al, 0ch
             out dx, ax
             mov ah, bl
             inc al
             out dx, ax
          </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>PROCEDURE </b></font>Synk<font color="#000080">; </font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;
          </font><font color="#FF0000"><b>Asm
             </b></font><font color="#FF00FF">mov     dx, $3da
             @L1:
                 in      al, dx
                 test    al, $8
             jne     @L1
             @L2:
                 in      al, dx
                 test    al, $8
             je      @L2
          </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>PROCEDURE </b></font>Set_Color<font color="#000080">(</font>ColorNum<font color="#000080">, </font>R<font color="#000080">, </font>G<font color="#000080">, </font>B<font color="#000080">: </font>Byte<font color="#000080">);
          </font><font color="#FF0000"><b>Begin
               </b></font>Port<font color="#000080">[</font><font color="#800000">$3C8</font><font color="#000080">] := </font>ColorNum<font color="#000080">;
               </font>Port<font color="#000080">[</font><font color="#800000">$3C9</font><font color="#000080">] := </font>R<font color="#000080">;
               </font>Port<font color="#000080">[</font><font color="#800000">$3C9</font><font color="#000080">] := </font>G<font color="#000080">;
               </font>Port<font color="#000080">[</font><font color="#800000">$3C9</font><font color="#000080">] := </font>B<font color="#000080">;
          </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>PROCEDURE </b></font>Get_Color<font color="#000080">(</font>ColorNum<font color="#000080">: </font>Byte<font color="#000080">; </font><font color="#FF0000"><b>Var </b></font>R<font color="#000080">, </font>G<font color="#000080">, </font>B<font color="#000080">: </font>Byte<font color="#000080">);
          </font><font color="#FF0000"><b>Begin
               </b></font>Port<font color="#000080">[</font><font color="#800000">$3C8</font><font color="#000080">] := </font>ColorNum<font color="#000080">;
               </font>R <font color="#000080">:= </font>Port<font color="#000080">[</font><font color="#800000">$3C9</font><font color="#000080">];
               </font>G <font color="#000080">:= </font>Port<font color="#000080">[</font><font color="#800000">$3C9</font><font color="#000080">];
               </font>B <font color="#000080">:= </font>Port<font color="#000080">[</font><font color="#800000">$3C9</font><font color="#000080">];
               </font><font color="#FF0000"><b>If </b></font>ColorNum <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>Then
                  Begin
                       </b></font>R <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
                       </font>G <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
                       </font>B <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
                  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
          </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>FUNCTION </b></font>GetPix<font color="#000080">(</font>x<font color="#000080">, </font>y<font color="#000080">, </font>Page <font color="#000080">: </font>Word<font color="#000080">) : </font>Byte<font color="#000080">;
         </font><font color="#FF0000"><b>Begin
              </b></font>GetPix <font color="#000080">:= </font>Mem<font color="#000080">[</font>View_Page<font color="#000080">: </font>y <font color="#000080">* </font><font color="#800000">320 </font><font color="#000080">+ </font>x<font color="#000080">];
         </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>FUNCTION </b></font>GetPix2<font color="#000080">(</font>x<font color="#000080">, </font>y<font color="#000080">, </font>Page <font color="#000080">: </font>Word<font color="#000080">) : </font>Byte<font color="#000080">; </font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;
         </font><font color="#FF0000"><b>ASM
            </b></font><font color="#FF00FF">push  ds
            mov   ax, [Page]
            mov   ds, ax
            mov   ax, y
            shl   ax, 6
            mov   si, ax
            shl   ax, 2
            add   si, ax
            add   si, x
            lodsb
            pop   ds
         </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>PROCEDURE </b></font>Flip<font color="#000080">(</font>Source<font color="#000080">, </font>Dest<font color="#000080">: </font>Word<font color="#000080">); </font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;
</font><font color="#008000"><i>{This copies the entire screen at &quot;source&quot; to destination}
          </i></font><font color="#FF0000"><b>asm
             </b></font><font color="#FF00FF">push    ds
             mov     ax, [Dest]
             mov     es, ax
             mov     ax, [Source]
             mov     ds, ax
             xor     si, si
             xor     di, di
             mov     cx, 32000
             rep     movsw
             pop     ds
          </font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#008000"><i>{ originally by SEAN PALMER, I just mangled it  :^) }
</i></font><font color="#FF0000"><b>PROCEDURE </b></font>ScaleBitmap<font color="#000080">(</font><font color="#FF0000"><b>VAR </b></font>bmp2scale<font color="#000080">; </font>actualx<font color="#000080">, </font>actualy <font color="#000080">: </font>Byte<font color="#000080">;
                      </font>bstrtx<font color="#000080">, </font>bstrty<font color="#000080">, </font>bendx<font color="#000080">, </font>bendy<font color="#000080">: </font>Word<font color="#000080">);
</font><font color="#008000"><i>{ These are notes I added, so they might be wrong.  :^)     }
{ - bmp2scale is an array [0..actualx, 0..actualy] of byte  }
{   which contains the original bitmap                      }
{ - actualx and actualy are the actual width and height of  }
{   the normal bitmap                                       }
{ - bstrtx and bstrty are the x and y values for the upper- }
{   left-hand corner of the scaled bitmap                   }
{ - bendx and bendy are the lower-right-hand corner of the  }
{   scaled version of the original bitmap                   }
{ - eg. to paste an unscaled version of a bitmap that is    }
{   64x64 pixels in size in the top left-hand corner of the }
{   screen, fill the array with data and call:              }
{     ScaleBitmap(bitmap, 64, 64, 0, 0, 63, 63);            }
{ - apparently, the bitmap is read starting at (0,0) and    }
{   then going to (0,1), then (0,2), etc; meaning that it's }
{   not read horizontally, but vertically                   }
</i></font><font color="#FF0000"><b>VAR
   </b></font>bmp_sx<font color="#000080">, </font>bmp_sy<font color="#000080">, </font>bmp_cy <font color="#000080">: </font>Fixed<font color="#000080">;
   </font>bmp_s<font color="#000080">, </font>bmp_w<font color="#000080">, </font>bmp_h    <font color="#000080">: </font>Word<font color="#000080">;
</font><font color="#FF0000"><b>BEGIN
     </b></font>bmp_w <font color="#000080">:= </font>bendx <font color="#000080">- </font>bstrtx <font color="#000080">+ </font><font color="#800000">1</font><font color="#000080">;
     </font>bmp_h <font color="#000080">:= </font>bendy <font color="#000080">- </font>bstrty <font color="#000080">+ </font><font color="#800000">1</font><font color="#000080">;
     </font>bmp_sx<font color="#000080">.</font>w <font color="#000080">:= </font>actualx <font color="#000080">* </font><font color="#800000">$10000 </font><font color="#FF0000"><b>DIV </b></font>bmp_w<font color="#000080">;
     </font>bmp_sy<font color="#000080">.</font>w <font color="#000080">:= </font>actualy <font color="#000080">* </font><font color="#800000">$10000 </font><font color="#FF0000"><b>DIV </b></font>bmp_h<font color="#000080">;
     </font>bmp_s <font color="#000080">:= </font><font color="#800000">320 </font><font color="#000080">- </font>bmp_w<font color="#000080">;
     </font>bmp_cy<font color="#000080">.</font>w <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
     </font><font color="#FF0000"><b>ASM
        </b></font><font color="#FF00FF">PUSH DS
        MOV DS,WORD PTR bmp2scale + 2
        MOV AX,$A000;
        MOV ES,AX;
        CLD;
        MOV AX,320;
        MUL bstrty;
        ADD ax,bstrtx;
        MOV DI,AX;
        @L2:
            MOV AX,bmp_cy.i;
            MUL actualx;
            MOV BX,AX;
            ADD BX,WORD PTR bmp2scale;
            MOV CX,bmp_w;
            XOR SI,SI;  </font><font color="#008000"><i>{MOV SI,0}
            </i></font><font color="#FF00FF">MOV DX,bmp_sx.f;
        @L:
           MOV AL,[BX];
           STOSB;
           ADD SI,DX;
           ADC BX,bmp_sx.i;
        LOOP @L
             ADD DI,bmp_s;
             MOV AX,bmp_sy.f;
             MOV bx,bmp_sy.i;
             ADD bmp_cy.f,AX;
             ADC bmp_cy.i,BX;
             DEC WORD PTR bmp_h;
        JNZ @L2;

        POP DS;
     </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>PROCEDURE </b></font>GetImage <font color="#000080">(</font>X1<font color="#000080">, </font>Y1<font color="#000080">, </font>X2<font color="#000080">, </font>Y2<font color="#000080">: </font>Integer<font color="#000080">; </font><font color="#FF0000"><b>Var </b></font>Dest<font color="#000080">);
          </font><font color="#FF0000"><b>Var
             </b></font>Width<font color="#000080">,
             </font>S<font color="#000080">,
             </font>O <font color="#000080">: </font>Word<font color="#000080">;

          </font><font color="#FF0000"><b>Begin
               </b></font>S <font color="#000080">:= </font>SEG <font color="#000080">(</font>DEST<font color="#000080">);
               </font>O <font color="#000080">:= </font>OFS <font color="#000080">(</font>DEST<font color="#000080">);

               </font><font color="#FF0000"><b>ASM
                  </b></font><font color="#FF00FF">PUSH DS

                  MOV DX, $A000
                  MOV DS, DX
                  MOV BX, 320
                  MOV AX, Y1; MUL BX
                  ADD AX, X1; MOV SI, AX

                  MOV DX, S
                  MOV ES, DX
                  MOV DI, O

                  MOV DX, Y2; SUB DX, Y1; INC DX
                  MOV BX, X2; SUB BX, X1; INC BX
                  MOV WIDTH, BX

                  MOV AX, WIDTH
                  STOSW
                  MOV AX, DX
                  STOSW

                  @LOOP:
                        MOV CX, WIDTH
                        REP MOVSB
                        ADD SI, 320;
                        SUB SI, WIDTH
                        DEC DX
                  JNZ @LOOP

                  POP DS
               </font><font color="#FF0000"><b>End</b></font><font color="#000080">; </font><font color="#008000"><i>{end of assembler}
          </i></font><font color="#FF0000"><b>End</b></font><font color="#000080">; </font><font color="#008000"><i>{end of procedure}

</i></font><font color="#FF0000"><b>PROCEDURE </b></font>PutImage<font color="#000080">(</font>X1<font color="#000080">, </font>Y1<font color="#000080">: </font>Integer<font color="#000080">; </font><font color="#FF0000"><b>Var </b></font>Source<font color="#000080">);
          </font><font color="#FF0000"><b>Var
             </b></font>Width<font color="#000080">,
             </font>S<font color="#000080">,
             </font>O      <font color="#000080">: </font>Word<font color="#000080">;

          </font><font color="#FF0000"><b>Begin
               </b></font>S <font color="#000080">:= </font>SEG <font color="#000080">(</font>SOURCE<font color="#000080">);
               </font>O <font color="#000080">:= </font>OFS <font color="#000080">(</font>SOURCE<font color="#000080">);

               </font><font color="#FF0000"><b>ASM
                  </b></font><font color="#FF00FF">PUSH DS

                  MOV DX, $A000
                  MOV ES, DX
                  MOV BX, 320            </font><font color="#008000"><i>{ Setup Dest Addr }
                  </i></font><font color="#FF00FF">MOV AX, Y1; MUL BX
                  ADD AX, X1; MOV DI, AX

                  MOV DX, S </font><font color="#008000"><i>{ Setup Source Addr }
                  </i></font><font color="#FF00FF">MOV DS, DX
                  MOV SI, O

                  LODSW   </font><font color="#008000"><i>{ Get Width and Height }
                  </i></font><font color="#FF00FF">MOV WIDTH, AX
                  LODSW
                  MOV DX, AX

                  @LOOP:
                        MOV CX, WIDTH
                        REP MOVSB
                        ADD DI, 320
                        SUB DI, WIDTH
                        DEC DX
                  JNZ @LOOP

                  POP DS
               </font><font color="#FF0000"><b>End</b></font><font color="#000080">; </font><font color="#008000"><i>{end of the ASM}
          </i></font><font color="#FF0000"><b>End</b></font><font color="#000080">; </font><font color="#008000"><i>{end of the procedure}


</i></font><font color="#FF0000"><b>PROCEDURE </b></font>DrawBar<font color="#000080">(</font>X1<font color="#000080">, </font>Y1<font color="#000080">, </font>X2<font color="#000080">, </font>Y2<font color="#000080">: </font>Integer<font color="#000080">; </font>Color<font color="#000080">: </font>Byte<font color="#000080">);
          </font><font color="#FF0000"><b>Var
             </b></font>Row <font color="#000080">: </font>Word<font color="#000080">;

          </font><font color="#FF0000"><b>Begin
               IF </b></font>X1 <font color="#000080">&lt; </font><font color="#800000">1 </font><font color="#FF0000"><b>Then
                  </b></font>X1 <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;
               </font><font color="#FF0000"><b>If </b></font>Y1 <font color="#000080">&lt; </font><font color="#800000">1 </font><font color="#FF0000"><b>Then
                  </b></font>Y1 <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;
               </font><font color="#FF0000"><b>If </b></font>X2 <font color="#000080">&gt; </font><font color="#800000">320 </font><font color="#FF0000"><b>Then
                  </b></font>X2 <font color="#000080">:= </font><font color="#800000">320</font><font color="#000080">;
               </font><font color="#FF0000"><b>If </b></font>Y2 <font color="#000080">&gt; </font><font color="#800000">200 </font><font color="#FF0000"><b>Then
                  </b></font>Y2 <font color="#000080">:= </font><font color="#800000">200</font><font color="#000080">;
               </font><font color="#FF0000"><b>For </b></font>Row <font color="#000080">:= </font>Y1 <font color="#FF0000"><b>To </b></font>Y2 <font color="#FF0000"><b>Do
                   </b></font>FillChar<font color="#000080">(</font>MEM<font color="#000080">[</font><font color="#800000">$A000</font><font color="#000080">:(</font><font color="#800000">320 </font><font color="#000080">* </font>Row<font color="#000080">) + </font>X1<font color="#000080">], </font>X2 <font color="#000080">- </font>X1<font color="#000080">, </font>Color<font color="#000080">);
          </font><font color="#FF0000"><b>End</b></font><font color="#000080">;


</font><font color="#FF0000"><b>PROCEDURE </b></font>Pan<font color="#000080">(</font>X<font color="#000080">,</font>Y<font color="#000080">: </font>Word<font color="#000080">); </font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;
          </font><font color="#FF0000"><b>ASM
             </b></font><font color="#FF00FF">mov    bx, 320
             mov    ax, y
             mul    bx
             add    ax, x
             push   ax
             pop    bx
             mov    dx, InputStatus
             @WaitDE:
                     in     al,dx
                     test   al,01h
             jnz    @WaitDE       </font><font color="#008000"><i>{display enable is active?}
             </i></font><font color="#FF00FF">mov    dx, Crtadress
             mov    al, $0C
             mov    ah, bh

             out    dx, ax
             mov    al, $0D
             mov    ah, bl
             out    dx, ax
             MOV    dx, InputStatus
             @wait:
                   in      al,dx
                   test    al,8                    </font><font color="#008000"><i>{?End Vertical Retrace?}
             </i></font><font color="#FF00FF">jz    @wait
          </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>VgaBase<font color="#000080">(</font>Xscroll<font color="#000080">,</font>Yscroll<font color="#000080">:</font>integer<font color="#000080">; </font><font color="#FF0000"><b>Var </b></font>Slide<font color="#000080">: </font>Word<font color="#000080">);
  </font><font color="#FF0000"><b>var </b></font>dum<font color="#000080">:</font>byte<font color="#000080">;
 </font><font color="#FF0000"><b>Begin
  </b></font>Dec<font color="#000080">(</font>Slide<font color="#000080">, (</font>Xscroll<font color="#000080">+</font><font color="#800000">320</font><font color="#000080">*</font>Yscroll<font color="#000080">));   </font><font color="#008000"><i>{ slide scrolling state         }
  </i></font>Port<font color="#000080">[</font><font color="#800000">$03d4</font><font color="#000080">]:=</font><font color="#800000">13</font><font color="#000080">;                    </font><font color="#008000"><i>{ LO register of VGAMEM offset  }
  </i></font>Port<font color="#000080">[</font><font color="#800000">$03d5</font><font color="#000080">]:=(</font>SLIDE <font color="#FF0000"><b>shr </b></font><font color="#800000">2</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#800000">$FF</font><font color="#000080">; </font><font color="#008000"><i>{ use 8 bits:  [9..2]           }
  </i></font>Port<font color="#000080">[</font><font color="#800000">$03d4</font><font color="#000080">]:=</font><font color="#800000">12</font><font color="#000080">;                    </font><font color="#008000"><i>{ HI register of VGAMEM offset  }
  </i></font>Port<font color="#000080">[</font><font color="#800000">$03d5</font><font color="#000080">]:= </font>SLIDE <font color="#FF0000"><b>shr </b></font><font color="#800000">10</font><font color="#000080">;         </font><font color="#008000"><i>{ use 6 bits   [16..10]         }
  </i></font>Dum<font color="#000080">:=</font>Port<font color="#000080">[</font><font color="#800000">$03DA</font><font color="#000080">];                   </font><font color="#008000"><i>{ reset to input by dummy read  }
  </i></font>Port<font color="#000080">[</font><font color="#800000">$03C0</font><font color="#000080">]:=</font><font color="#800000">$20 </font><font color="#FF0000"><b>or </b></font><font color="#800000">$13</font><font color="#000080">;            </font><font color="#008000"><i>{ smooth pan = register $13     }
  </i></font>Port<font color="#000080">[</font><font color="#800000">$03C0</font><font color="#000080">]:=(</font>SLIDE <font color="#FF0000"><b>and </b></font><font color="#800000">3</font><font color="#000080">) </font><font color="#FF0000"><b>Shl </b></font><font color="#800000">1</font><font color="#000080">;   </font><font color="#008000"><i>{ use bits [1..0], make it 0-2-4-6
}
 </i></font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>PROCEDURE </b></font>SetAddress<font color="#000080">(</font>ad<font color="#000080">:</font>word<font color="#000080">); </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
          </font><font color="#FF0000"><b>ASM
             </b></font><font color="#FF00FF">mov dx,3d4h
             mov al,0ch
             mov ah,[byte(ad)+1]
             out dx,ax
             mov al,0dh
             mov ah,[byte(ad)]
             out dx,ax
          </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>PROCEDURE </b></font>SetLinecomp<font color="#000080">(</font>ad<font color="#000080">:</font>word<font color="#000080">); </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
          </font><font color="#FF0000"><b>ASM
             </b></font><font color="#FF00FF">mov dx,3d4h
             mov al,18h
             mov ah,[byte(ad)]
             out dx,ax
             mov al,7
             out dx,al
             inc dx
             in al,dx
             dec dx
             mov ah,[byte(ad)+1]
             and ah,00000001b
             shl ah,4
             and al,11101111b
             or al,ah
             mov ah,al
             mov al,7
             out dx,ax
             mov al,9
             out dx,al
             inc dx
             in al,dx
             dec dx
             mov ah,[byte(ad)+1]
             and ah,00000010b
             shl ah,5
             and al,10111111b
             or al,ah
             mov ah,al
             mov al,9
             out dx,ax
          </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>PROCEDURE </b></font>Draw_Line<font color="#000080">( </font>x<font color="#000080">, </font>y<font color="#000080">, </font>x2<font color="#000080">, </font>y2<font color="#000080">: </font>Word<font color="#000080">; </font>Color<font color="#000080">: </font>Byte<font color="#000080">; </font>Page<font color="#000080">: </font>word<font color="#000080">); </font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;
          </font><font color="#FF0000"><b>asm
             </b></font><font color="#FF00FF">mov ax,[Page];
 mov es,ax
 mov bx,x
 mov ax,y
 mov cx,x2
 mov si,y2
 cmp ax,si
 jbe @NO_SWAP   </font><font color="#008000"><i>{always draw downwards}
 </i></font><font color="#FF00FF">xchg bx,cx
 xchg ax,si
@NO_SWAP:
 sub si,ax         </font><font color="#008000"><i>{yd (pos)}
 </i></font><font color="#FF00FF">sub cx,bx         </font><font color="#008000"><i>{xd (+/-)}
 </i></font><font color="#FF00FF">cld               </font><font color="#008000"><i>{set up direction flag}
 </i></font><font color="#FF00FF">jns @H_ABS
 neg cx      </font><font color="#008000"><i>{make x positive}
 </i></font><font color="#FF00FF">std
@H_ABS:
 mov di,320
 mul di
 mov di,ax
 add di,bx   </font><font color="#008000"><i>{di:adr}
 </i></font><font color="#FF00FF">or si,si
 jnz @NOT_H
</font><font color="#008000"><i>{horizontal line}
 </i></font><font color="#FF00FF">cld
 mov al,color
 inc cx
 rep stosb
 jmp @EXIT
@NOT_H:
 or cx,cx
 jnz @NOT_V
</font><font color="#008000"><i>{vertical line}
 </i></font><font color="#FF00FF">cld
 mov al,color
 mov cx,si
 inc cx
 mov bx,320-1
@VLINE_LOOP:
 stosb
 add di,bx
 loop @VLINE_LOOP
 jmp @EXIT
@NOT_V:
 cmp cx,si    </font><font color="#008000"><i>{which is greater distance?}
 </i></font><font color="#FF00FF">lahf         </font><font color="#008000"><i>{then store flags}
 </i></font><font color="#FF00FF">ja @H_IND
 xchg cx,si   </font><font color="#008000"><i>{swap for redundant calcs}
</i></font><font color="#FF00FF">@H_IND:
 mov dx,si    </font><font color="#008000"><i>{inc2 (adjustment when decision var rolls over)}
 </i></font><font color="#FF00FF">sub dx,cx
 shl dx,1
 shl si,1     </font><font color="#008000"><i>{inc1 (step for decision var)}
 </i></font><font color="#FF00FF">mov bx,si    </font><font color="#008000"><i>{decision var, tells when we need to go secondary direction}
 </i></font><font color="#FF00FF">sub bx,cx
 inc cx
 push bp      </font><font color="#008000"><i>{need another register to hold often-used constant}
 </i></font><font color="#FF00FF">mov bp,320
 mov al,color
 sahf         </font><font color="#008000"><i>{restore flags}
 </i></font><font color="#FF00FF">jb @DIAG_V
</font><font color="#008000"><i>{mostly-horizontal diagonal line}
 </i></font><font color="#FF00FF">or bx,bx     </font><font color="#008000"><i>{set flags initially, set at end of loop for other iterations}
</i></font><font color="#FF00FF">@LH:
 stosb        </font><font color="#008000"><i>{plot and move x, doesn't affect flags}
 </i></font><font color="#FF00FF">jns @SH      </font><font color="#008000"><i>{decision var rollover in bx?}
 </i></font><font color="#FF00FF">add bx,si
 loop @LH   </font><font color="#008000"><i>{doesn't affect flags}
 </i></font><font color="#FF00FF">jmp @X
@SH:
 add di,bp
 add bx,dx
 loop @LH   </font><font color="#008000"><i>{doesn't affect flags}
 </i></font><font color="#FF00FF">jmp @X
@DIAG_V:
</font><font color="#008000"><i>{mostly-vertical diagonal line}
 </i></font><font color="#FF00FF">or bx,bx    </font><font color="#008000"><i>{set flags initially, set at end of loop for other iterations}
</i></font><font color="#FF00FF">@LV:
 mov es:[di],al   </font><font color="#008000"><i>{plot, doesn't affect flags}
 </i></font><font color="#FF00FF">jns @SV          </font><font color="#008000"><i>{decision var rollover in bx?}
 </i></font><font color="#FF00FF">add di,bp        </font><font color="#008000"><i>{update y coord}
 </i></font><font color="#FF00FF">add bx,si
 loop @LV         </font><font color="#008000"><i>{doesn't affect flags}
 </i></font><font color="#FF00FF">jmp @X
@SV:
 scasb   </font><font color="#008000"><i>{sure this is superfluous but it's a quick way to inc/dec x coord!}
 </i></font><font color="#FF00FF">add di,bp        </font><font color="#008000"><i>{update y coord}
 </i></font><font color="#FF00FF">add bx,dx
 loop @LV         </font><font color="#008000"><i>{doesn't affect flags}
</i></font><font color="#FF00FF">@X:
 pop bp
@EXIT:
 </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>PROCEDURE </b></font>Fade_Area<font color="#000080">(</font>x<font color="#000080">, </font>y<font color="#000080">, </font>x2<font color="#000080">, </font>y2<font color="#000080">: </font>Word<font color="#000080">;  </font>Difference<font color="#000080">: </font>Integer<font color="#000080">; </font>Page<font color="#000080">: </font>Word<font color="#000080">);
          </font><font color="#FF0000"><b>Var
             </b></font>Color<font color="#000080">: </font>Byte<font color="#000080">;
             </font>ty<font color="#000080">,
             </font>tx   <font color="#000080">: </font>Word<font color="#000080">;

          </font><font color="#FF0000"><b>Begin
               For </b></font>ty <font color="#000080">:= </font>y <font color="#FF0000"><b>to </b></font>y2 <font color="#FF0000"><b>Do
                   for </b></font>tx <font color="#000080">:= </font>x <font color="#FF0000"><b>to </b></font>x2 <font color="#FF0000"><b>Do
                       </b></font>SetPix<font color="#000080">(</font>tx<font color="#000080">, </font>ty<font color="#000080">, </font>GetPix<font color="#000080">(</font>tx<font color="#000080">, </font>ty<font color="#000080">, </font>View_Page<font color="#000080">) + </font>Difference<font color="#000080">, </font>View_Page<font color="#000080">);
          </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>BEGIN
END</b></font><font color="#000080">.</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to EGAVGA SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0246.PAS">Original</a><b>]</b></p></body>
</html>
