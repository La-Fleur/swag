<html>
<head><title> "Yet another Fader" by EIRIK MILCH PEDERESEN</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to EGAVGA SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0010.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
Eirik Milch Pedersen

&gt; I too, would appreciate the source for fading colours in 16 colour text
&gt; mode on a VGA, i've tried my hand at it but can't work out a decent
&gt; algoritm, i've been using int 10h to set a block of colour regs for speed
&gt; but can't seem to work out how to fade the colours!

I replyed to the author of the first fade-question, but I might as well post
my code to the public. This is a little demo I made in TP60 for fading form a
palette to another. So techincal you can fade from anything to anything. :-)
The routine should be fast enough for most computers, but if you start to
see 'snow' on the screen try to reduce the number of colors that are faded.
}

{$G+}
</i></font><font color="#FF0000"><b>uses
  </b></font>crt<font color="#000080">;

</font><font color="#FF0000"><b>type
  </b></font>ColorType <font color="#000080">= </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">255</font><font color="#000080">] </font><font color="#FF0000"><b>of record
                                 </b></font>R<font color="#000080">, </font>G<font color="#000080">, </font>B <font color="#000080">: </font>byte<font color="#000080">;
                               </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>var
  </b></font>Colors<font color="#000080">,
  </font>White<font color="#000080">,
  </font>Black   <font color="#000080">: </font>ColorType<font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>SetMode<font color="#000080">(</font>Mode <font color="#000080">: </font>word<font color="#000080">); </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>asm
  </b></font><font color="#FF00FF">mov  ax, Mode
  int  010h
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>MakeColors<font color="#000080">(</font>ColorArray <font color="#000080">: </font>pointer<font color="#000080">); </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>label
  </b></font>RLoop<font color="#000080">, </font>GLoop<font color="#000080">, </font>BLoop<font color="#000080">;
</font><font color="#FF0000"><b>asm
  </b></font><font color="#FF00FF">les  di, ColorArray

  mov  cx, 85
  xor  al, al
 RLoop:
  mov  byte ptr es:[di+0], al
  mov  byte ptr es:[di+1], 0
  mov  byte ptr es:[di+2], 0
  add  di, 3
  inc  al
  and  al, 03Fh
  loop Rloop

  mov  cx, 85
  xor  al, al
 GLoop:
  mov  byte ptr es:[di+0], 0
  mov  byte ptr es:[di+1], al
  mov  byte ptr es:[di+2], 0
  add  di, 3
  inc  al
  and  al, 03Fh
  loop Gloop

  mov  cx, 86
  xor  al, al
 BLoop:
  mov  byte ptr es:[di+0], 0
  mov  byte ptr es:[di+1], 0
  mov  byte ptr es:[di+2], al
  add  di, 3
  inc  al
  and  al, 03Fh
  loop Bloop
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>DrawBars<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>label
  </b></font>LineLoop<font color="#000080">, </font>PixelLoop<font color="#000080">;
</font><font color="#FF0000"><b>asm
  </b></font><font color="#FF00FF">mov  ax, 0A000h
  mov  es, ax
  xor  di, di

  mov  cx, 200
 LineLoop:
  xor  al, al
  push cx
  mov  cx, 320
 PixelLoop:
  stosb
  inc  al
  loop PixelLoop

  pop  cx
  loop LineLoop
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>UpdateColorsSlow<font color="#000080">(</font>ColorBuffer <font color="#000080">: </font>pointer<font color="#000080">); </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>label
  </b></font>ColorLoop<font color="#000080">;
</font><font color="#FF0000"><b>asm
  </b></font><font color="#FF00FF">push ds

  lds  si, ColorBuffer
  mov  cx, 3*256

  mov  dx, 03C8h
  xor  al, al
  out  dx, al
  inc  dx
 ColorLoop:                         </font><font color="#008000"><i>{ here is the substitute that }
  </i></font><font color="#FF00FF">lodsb                      </font><font color="#008000"><i>{ goes round the problem.     }
  </i></font><font color="#FF00FF">out  dx, al
  loop ColorLoop

  pop  ds
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>UpdateColorsFast<font color="#000080">(</font>ColorBuffer <font color="#000080">: </font>pointer<font color="#000080">); </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>asm
  </b></font><font color="#FF00FF">push ds

  lds  si, ColorBuffer
  mov  cx, 3*256

  mov  dx, 03C8h
  xor  al, al
  out  dx, al
  inc  dx

  rep  outsb              </font><font color="#008000"><i>{ here is the cause of the problem. }

  </i></font><font color="#FF00FF">pop  ds
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>procedure </b></font>FadeColors<font color="#000080">(</font>FromColors<font color="#000080">, </font>ToColors <font color="#000080">: </font>Pointer<font color="#000080">;
                     </font>StartCol<font color="#000080">, </font>NoColors<font color="#000080">, </font>NoSteps <font color="#000080">: </font>byte<font color="#000080">); </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>label
  </b></font>Start<font color="#000080">, </font>DummyPalette<font color="#000080">, </font>NoColorsX3<font color="#000080">,
  </font>DummySub<font color="#000080">, </font>StepLoop<font color="#000080">, </font>ColorLoop<font color="#000080">,
        </font>SubLoop<font color="#000080">, </font>RetrLoop1<font color="#000080">, </font>RetrLoop2<font color="#000080">, </font>Over1<font color="#000080">, </font>Over2<font color="#000080">;
</font><font color="#FF0000"><b>asm
        </b></font><font color="#FF00FF">jmp        Start
 DummyPalette:
        db 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
        db 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
        db 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
        db 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
        db 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
        db 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
        db 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
        db 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
        db 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
        db 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
        db 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
        db 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
        db 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
        db 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
        db 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
        db 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
        db 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
        db 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
        db 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
        db 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
        db 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
        db 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
        db 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
        db 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
 DummySub:
        db 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
        db 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
        db 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
        db 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
        db 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
        db 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
        db 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
        db 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
        db 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
        db 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
        db 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
        db 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
        db 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
        db 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
        db 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
        db 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
        db 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
        db 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
        db 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
        db 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
        db 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
        db 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
        db 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
  db 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0
 NoColorsX3 :
  dw          0
 Start:
        push ds

        lds         si, ToColors
  les         di, FromColors
  xor  ch, ch
  mov         cl, NoColors
  shl         cx, 1
  add         cl, NoColors
  adc  ch, 0
  mov         word ptr cs:[NoColorsX3], cx
  mov         bx, 0
  push di
 SubLoop:
        lodsb
        sub         al, byte ptr es:di
        mov         byte ptr cs:[DummySub+bx], al
  inc         di
  inc         bx
        loop SubLoop
  pop         di

  push cs
  pop         ds
        mov         dh, 0
  mov  dl, NoSteps
 StepLoop:
  push di
  mov         cx, word ptr cs:[NoColorsX3]
  mov         bx, 0
 ColorLoop:
  xor         ah, ah
        mov         al, byte ptr cs:[DummySub+bx]
  or         al, al
  jns         over1
  neg         al
 over1:
  mul         dh
  div         dl
  cmp  byte ptr cs:[DummySub+bx], 0
  jge         over2
  neg         al
 over2:
  mov         ah, byte ptr es:[di]
  add         ah, al
  mov         byte ptr cs:[DummyPalette+bx], ah
  inc         bx
  inc         di
  loop ColorLoop

  push dx
  mov  si, offset DummyPalette
  mov  cx, word ptr cs:[NoColorsX3]

  mov  dx, 03DAh
 retrloop1:
  in          al, dx
  test al, 8
  jnz  retrloop1
 retrloop2:
  in          al, dx
  test al, 8
  jz   retrloop2

  mov  dx, 03C8h
  mov  al, StartCol
  out  dx, al
  inc  dx
  rep         outsb

  pop         dx

  pop         di
  inc         dh
  cmp         dh, dl
  jbe         StepLoop

  pop         ds
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;



</font><font color="#FF0000"><b>begin
  </b></font>ClrScr<font color="#000080">;
  </font>MakeColors<font color="#000080">(@</font>Colors<font color="#000080">);
  </font>FillChar<font color="#000080">(</font>Black<font color="#000080">, </font><font color="#800000">256 </font><font color="#000080">* </font><font color="#800000">3</font><font color="#000080">, </font><font color="#800000">0</font><font color="#000080">);
  </font>FillChar<font color="#000080">(</font>White<font color="#000080">, </font><font color="#800000">256 </font><font color="#000080">* </font><font color="#800000">3</font><font color="#000080">, </font><font color="#800000">63</font><font color="#000080">);

  </font>SetMode<font color="#000080">(</font><font color="#800000">$13</font><font color="#000080">);
  </font>UpdateColorsSlow<font color="#000080">(@</font>Black<font color="#000080">);
  </font>DrawBars<font color="#000080">;

  </font><font color="#FF0000"><b>REPEAT
    </b></font>FadeColors<font color="#000080">(@</font>Black<font color="#000080">, @</font>Colors<font color="#000080">, </font><font color="#800000">0</font><font color="#000080">, </font><font color="#800000">255</font><font color="#000080">, </font><font color="#800000">100</font><font color="#000080">);
    </font>FadeColors<font color="#000080">(@</font>Colors<font color="#000080">, @</font>White<font color="#000080">, </font><font color="#800000">0</font><font color="#000080">, </font><font color="#800000">255</font><font color="#000080">, </font><font color="#800000">100</font><font color="#000080">);
    </font>FadeColors<font color="#000080">(@</font>White<font color="#000080">, @</font>Colors<font color="#000080">, </font><font color="#800000">0</font><font color="#000080">, </font><font color="#800000">255</font><font color="#000080">, </font><font color="#800000">100</font><font color="#000080">);
    </font>FadeColors<font color="#000080">(@</font>Colors<font color="#000080">, @</font>Black<font color="#000080">, </font><font color="#800000">0</font><font color="#000080">, </font><font color="#800000">255</font><font color="#000080">, </font><font color="#800000">100</font><font color="#000080">);
  </font><font color="#FF0000"><b>UNTIL </b></font>keyPressed<font color="#000080">;

  </font>SetMode<font color="#000080">(</font><font color="#800000">$3</font><font color="#000080">);
</font><font color="#FF0000"><b>END</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to EGAVGA SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0010.PAS">Original</a><b>]</b></p></body>
</html>
