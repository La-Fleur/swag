<html>
<head><title> "Fader in textmode" by GRANT BEATTIE</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to EGAVGA SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0118.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#FF0000"><b>Unit </b></font>FadeUnit<font color="#000080">;          </font><font color="#008000"><i>{ called FadeUnit.Pas }

{ This unit does fading for text/graph modes }

</i></font><font color="#FF0000"><b>interface

procedure </b></font>InitCol<font color="#000080">; </font><font color="#008000"><i>{ gets the current palette and saves it }
</i></font><font color="#FF0000"><b>procedure </b></font>FadeOut<font color="#000080">(</font>Duration <font color="#000080">: </font>byte<font color="#000080">);   </font><font color="#008000"><i>{ lowers/increases the brightness, }
</i></font><font color="#FF0000"><b>procedure </b></font>FadeIn<font color="#000080">(</font>Duration <font color="#000080">: </font>byte<font color="#000080">);    </font><font color="#008000"><i>{ duration determines the time it takes}
</i></font><font color="#FF0000"><b>procedure </b></font>SetBrightness<font color="#000080">(</font>Brightness <font color="#000080">: </font>byte<font color="#000080">); </font><font color="#008000"><i>{ sets the brightness to brightnes}

</i></font><font color="#FF0000"><b>implementation

uses </b></font>Crt<font color="#000080">; </font><font color="#008000"><i>{ use Delay procedure from there }

</i></font><font color="#FF0000"><b>const
</b></font>PelIdxR  <font color="#000080">= </font><font color="#800000">$3C7</font><font color="#000080">; </font><font color="#008000"><i>{ Port to read from }
</i></font>PelIdxW  <font color="#000080">= </font><font color="#800000">$3C8</font><font color="#000080">; </font><font color="#008000"><i>{ Port to write to }
</i></font>PelData  <font color="#000080">= </font><font color="#800000">$3C9</font><font color="#000080">; </font><font color="#008000"><i>{ Dataport }
</i></font>Maxreg   <font color="#000080">= </font><font color="#800000">63</font><font color="#000080">;   </font><font color="#008000"><i>{ Set to 255 for graphmode }
</i></font>MaxInten <font color="#000080">= </font><font color="#800000">63</font><font color="#000080">;

</font><font color="#FF0000"><b>type
</b></font>TRGB <font color="#000080">= </font><font color="#FF0000"><b>record </b></font>R<font color="#000080">, </font>G<font color="#000080">, </font>B <font color="#000080">: </font>byte <font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>var
</b></font>Col <font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font>MaxReg<font color="#000080">] </font><font color="#FF0000"><b>of </b></font>TRGB<font color="#000080">;
</font>I <font color="#000080">: </font>byte<font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>GetCol<font color="#000080">(</font>ColNr <font color="#000080">: </font>byte<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>R<font color="#000080">, </font>G<font color="#000080">, </font>B <font color="#000080">: </font>byte<font color="#000080">); </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Asm
</b></font><font color="#FF00FF">MOV DX,PelIdxR
MOV AL,ColNr
OUT DX,AL
MOV DX,PelData
LES SI,R
IN AL,DX
MOV BYTE PTR [ES:SI],AL
LES SI,G
IN AL,DX
MOV BYTE PTR [ES:SI],AL
LES SI,B
IN AL,DX
MOV BYTE PTR [ES:SI],AL
</font><font color="#FF0000"><b>End</b></font><font color="#000080">; </font><font color="#008000"><i>{ GetCol }

</i></font><font color="#FF0000"><b>Procedure </b></font>SetCol<font color="#000080">(</font>ColNr<font color="#000080">, </font>R<font color="#000080">, </font>G<font color="#000080">, </font>B <font color="#000080">: </font>byte<font color="#000080">); </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">; </font><font color="#008000"><i>{ Change just one color }
</i></font><font color="#FF0000"><b>Asm
</b></font><font color="#FF00FF">MOV DX,PelIdxW
MOV AL,ColNr
OUT DX,AL
MOV DX,PelData
MOV AL,R
OUT DX,AL
MOV AL,G
OUT DX,AL
MOV AL,B
OUT DX,AL
</font><font color="#FF0000"><b>End</b></font><font color="#000080">; </font><font color="#008000"><i>{ SetCol }

</i></font><font color="#FF0000"><b>Procedure </b></font>InitCol<font color="#000080">; </font><font color="#008000"><i>{ Save initial palette }
</i></font><font color="#FF0000"><b>Begin
for </b></font>I <font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font>MaxReg <font color="#FF0000"><b>do </b></font>GetCol<font color="#000080">(</font>I<font color="#000080">, </font>Col<font color="#000080">[</font>I<font color="#000080">].</font>R<font color="#000080">, </font>Col<font color="#000080">[</font>I<font color="#000080">].</font>G<font color="#000080">, </font>Col<font color="#000080">[</font>I<font color="#000080">].</font>B<font color="#000080">)
</font><font color="#FF0000"><b>End</b></font><font color="#000080">; </font><font color="#008000"><i>{ InitCol }

</i></font><font color="#FF0000"><b>Procedure </b></font>SetBrightness<font color="#000080">;
</font><font color="#FF0000"><b>Begin
for </b></font>I <font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font>MaxReg <font color="#FF0000"><b>do
</b></font>SetCol<font color="#000080">(</font>I<font color="#000080">,
</font>Col<font color="#000080">[</font>I<font color="#000080">].</font>R <font color="#000080">* </font>Brightness <font color="#FF0000"><b>div </b></font>MaxInten<font color="#000080">,
</font>Col<font color="#000080">[</font>I<font color="#000080">].</font>G <font color="#000080">* </font>Brightness <font color="#FF0000"><b>div </b></font>MaxInten<font color="#000080">,
</font>Col<font color="#000080">[</font>I<font color="#000080">].</font>B <font color="#000080">* </font>Brightness <font color="#FF0000"><b>div </b></font>MaxInten<font color="#000080">)
</font><font color="#FF0000"><b>End</b></font><font color="#000080">; </font><font color="#008000"><i>{ SetBrightness }

</i></font><font color="#FF0000"><b>Procedure </b></font>FadeOut<font color="#000080">;
</font><font color="#FF0000"><b>var </b></font>I <font color="#000080">: </font>byte<font color="#000080">;
</font><font color="#FF0000"><b>Begin
for </b></font>I <font color="#000080">:= </font>MaxInten <font color="#FF0000"><b>downto </b></font><font color="#800000">0 </font><font color="#FF0000"><b>do
begin
</b></font>SetBrightness<font color="#000080">(</font>I<font color="#000080">);
</font>Delay<font color="#000080">(</font>Duration<font color="#000080">)
</font><font color="#FF0000"><b>end
End</b></font><font color="#000080">; </font><font color="#008000"><i>{ FadeOut }

</i></font><font color="#FF0000"><b>Procedure </b></font>FadeIn<font color="#000080">;
</font><font color="#FF0000"><b>var </b></font>I <font color="#000080">: </font>byte<font color="#000080">;
</font><font color="#FF0000"><b>Begin
for </b></font>I <font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font>MaxInten <font color="#FF0000"><b>do
begin
</b></font>SetBrightness<font color="#000080">(</font>I<font color="#000080">);
</font>Delay<font color="#000080">(</font>Duration<font color="#000080">)
</font><font color="#FF0000"><b>end
End</b></font><font color="#000080">; </font><font color="#008000"><i>{ FadeIn }

</i></font><font color="#FF0000"><b>End</b></font><font color="#000080">. </font><font color="#008000"><i>{ FADEUNIT.PAS }
</i></font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to EGAVGA SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0118.PAS">Original</a><b>]</b></p></body>
</html>
