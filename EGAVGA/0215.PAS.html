<html>
<head><title> "SVGA GIF Displayer with FULL VESA UNIT!" by LIONEL CORDESSES</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to EGAVGA SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0215.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
    I modified  the unit written  by Sean Wenzel in order  to speed
up the  decoding of a picture . I wrote several parts using the ASM
capability of BP 7.0,but I did not change the NextCode procedure at
the beginning.
    As I was interested in any improvement,I decided to use an external
procedure written in assembly language (named ASMGIF3.ASM) : I was
a little bit disappointed:it is  not faster (not noticeable ...).

    You can find :
      - GIFUTIL9.PAS :the new unit ONLY for 256 colors !!!!!!
      - GIFTST.PAS   :an example based on the one written by Sean Wenzel.
      - ASMGIF3.ASM  :the ASM source of NextByte.

  You can use,modified an distribute this source as long as credit is given.


                                      Lionel CORDESSES
                                      from FRANCE.
                                      November 1994
    E-Mail:
      cordesse@opgc.univ-bpclermont.fr



 &quot;The Graphics Interchange Format(c) is the Copyright property of
  CompuServe Incorporated. GIF(sm) is a Service Mark property  of
  CompuServe Incorporated.&quot;
}

</i></font><font color="#FF0000"><b>unit </b></font>GifUtil9<font color="#000080">;


</font><font color="#008000"><i>{$R-} { range checking off }  { Put them on if you like but it slows down }
{$S-} { stack checking off }  { The decoding  (almost doubles it!) }
{$I-} { i/o checking off }

</i></font><font color="#FF0000"><b>interface


var </b></font>status<font color="#000080">:</font>byte<font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>general<font color="#000080">(</font>nom<font color="#000080">:</font><font color="#FF0000"><b>string</b></font><font color="#000080">);


</font><font color="#FF0000"><b>implementation

uses </b></font>usvesa<font color="#000080">, </font>Crt<font color="#000080">;
</font><font color="#FF0000"><b>type
 </b></font>TDataSubBlock <font color="#000080">= </font><font color="#FF0000"><b>record
  </b></font>Size<font color="#000080">: </font>byte<font color="#000080">;     </font><font color="#008000"><i>{ size of the block -- 0 to 255 }
  </i></font>Data<font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">255</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">; </font><font color="#008000"><i>{ the data }
 </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>const
 </b></font>BlockTerminator<font color="#000080">: </font>byte <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">; </font><font color="#008000"><i>{ terminates stream of data blocks }

</i></font><font color="#FF0000"><b>type
 </b></font>THeader <font color="#000080">= </font><font color="#FF0000"><b>record
  </b></font>Signature<font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">2</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>char<font color="#000080">; </font><font color="#008000"><i>{ contains 'GIF' }
  </i></font>Version<font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">2</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>char<font color="#000080">;   </font><font color="#008000"><i>{ '87a' or '89a' }
 </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

 </font>TLogicalScreenDescriptor <font color="#000080">= </font><font color="#FF0000"><b>record
  </b></font>ScreenWidth<font color="#000080">: </font>word<font color="#000080">;              </font><font color="#008000"><i>{ logical screen width }
  </i></font>ScreenHeight<font color="#000080">: </font>word<font color="#000080">;  </font><font color="#008000"><i>{ logical screen height }
  </i></font>PackedFields<font color="#000080">: </font>byte<font color="#000080">;     </font><font color="#008000"><i>{ packed fields - see below }
  </i></font>BackGroundColorIndex<font color="#000080">: </font>byte<font color="#000080">;     </font><font color="#008000"><i>{ index to global color table }
  </i></font>AspectRatio<font color="#000080">: </font>byte<font color="#000080">;      </font><font color="#008000"><i>{ actual ratio = (AspectRatio + 15) / 64 }
 </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>const
</b></font><font color="#008000"><i>{ logical screen descriptor packed field masks }
 </i></font>lsdGlobalColorTable <font color="#000080">= </font><font color="#800000">$80</font><font color="#000080">;  </font><font color="#008000"><i>{ set if global color table follows L.S.D. }
 </i></font>lsdColorResolution <font color="#000080">= </font><font color="#800000">$70</font><font color="#000080">;               </font><font color="#008000"><i>{ Color resolution - 3 bits }
 </i></font>lsdSort <font color="#000080">= </font><font color="#800000">$08</font><font color="#000080">;
</font><font color="#008000"><i>{ set if global color table is sorted - 1 bit }
 </i></font>lsdColorTableSize <font color="#000080">= </font><font color="#800000">$07</font><font color="#000080">;                </font><font color="#008000"><i>{ size of global color
table - 3 bits }

      { Actual size =
2^value+1    - value is 3 bits }

</i></font><font color="#FF0000"><b>type
 </b></font>TColorItem <font color="#000080">= </font><font color="#FF0000"><b>record     </b></font><font color="#008000"><i>{ one item a a color table }
  </i></font>Red<font color="#000080">: </font>byte<font color="#000080">;
  </font>Green<font color="#000080">: </font>byte<font color="#000080">;
  </font>Blue<font color="#000080">: </font>byte<font color="#000080">;
 </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

 </font>TColorTable <font color="#000080">= </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">255</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>TColorItem<font color="#000080">;      </font><font color="#008000"><i>{ the color table }

</i></font><font color="#FF0000"><b>const
 </b></font>ImageSeperator<font color="#000080">: </font>byte <font color="#000080">= </font><font color="#800000">$2C</font><font color="#000080">;

</font><font color="#FF0000"><b>type
 </b></font>TImageDescriptor <font color="#000080">= </font><font color="#FF0000"><b>record
  </b></font>Seperator<font color="#000080">: </font>byte<font color="#000080">;                         </font><font color="#008000"><i>{ fixed value
of ImageSeperator }
  </i></font>ImageLeftPos<font color="#000080">: </font>word<font color="#000080">; </font><font color="#008000"><i>{Column in pixels in respect to
left edge of logical screen }
  </i></font>ImageTopPos<font color="#000080">: </font>word<font color="#000080">;</font><font color="#008000"><i>{row in pixels in respect to top of
logical screen }
  </i></font>ImageWidth<font color="#000080">: </font>word<font color="#000080">;       </font><font color="#008000"><i>{ width of image in pixels }
  </i></font>ImageHeight<font color="#000080">: </font>word<font color="#000080">;      </font><font color="#008000"><i>{ height of image in pixels }
  </i></font>PackedFields<font color="#000080">: </font>byte<font color="#000080">; </font><font color="#008000"><i>{ see below }
 </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>const
 </b></font><font color="#008000"><i>{ image descriptor bit masks }
  </i></font>idLocalColorTable <font color="#000080">= </font><font color="#800000">$80</font><font color="#000080">; </font><font color="#008000"><i>{ set if a local color table follows }
  </i></font>idInterlaced <font color="#000080">= </font><font color="#800000">$40</font><font color="#000080">;                      </font><font color="#008000"><i>{ set if image
is interlaced }
  </i></font>idSort <font color="#000080">= </font><font color="#800000">$20</font><font color="#000080">;
 </font><font color="#008000"><i>{ set if color table is sorted }
  </i></font>idReserved <font color="#000080">= </font><font color="#800000">$0C</font><font color="#000080">;                                </font><font color="#008000"><i>{
reserved - must be set to $00 }
  </i></font>idColorTableSize <font color="#000080">= </font><font color="#800000">$07</font><font color="#000080">;  </font><font color="#008000"><i>{ size of color table as above }

 </i></font>Trailer<font color="#000080">: </font>byte <font color="#000080">= </font><font color="#800000">$3B</font><font color="#000080">;    </font><font color="#008000"><i>{ indicates the end of the GIF data stream }

{ other extension blocks not currently supported by this unit
 - Graphic Control extension
 - Comment extension           I'm not sure what will happen if these blocks
 - Plain text extension        are encountered but it'll be interesting
 - application extension }

</i></font><font color="#FF0000"><b>const
 </b></font>ExtensionIntroducer<font color="#000080">: </font>byte <font color="#000080">= </font><font color="#800000">$21</font><font color="#000080">;
 </font>MAXSCREENWIDTH <font color="#000080">= </font><font color="#800000">800</font><font color="#000080">;

</font><font color="#FF0000"><b>type
 </b></font>TExtensionBlock <font color="#000080">= </font><font color="#FF0000"><b>record
  </b></font>Introducer<font color="#000080">: </font>byte<font color="#000080">;                               </font><font color="#008000"><i>{ fixed
value of ExtensionIntroducer }
  </i></font>ExtensionLabel<font color="#000080">: </font>byte<font color="#000080">;
  </font>BlockSize<font color="#000080">: </font>byte<font color="#000080">;
 </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

 </font>PCodeItem <font color="#000080">= ^</font>TCodeItem<font color="#000080">;
 </font>TCodeItem <font color="#000080">= </font><font color="#FF0000"><b>record
  </b></font>Code1<font color="#000080">, </font>Code2<font color="#000080">: </font>byte<font color="#000080">;
 </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>const
 </b></font>MAXCODES <font color="#000080">= </font><font color="#800000">4095</font><font color="#000080">;        </font><font color="#008000"><i>{ the maximum number of different codes
0 inclusive }



</i></font><font color="#FF0000"><b>const
</b></font><font color="#008000"><i>{ error constants }
 </i></font>geNoError <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">;                          </font><font color="#008000"><i>{ no errors found }
 </i></font>geNoFile <font color="#000080">= </font><font color="#800000">1</font><font color="#000080">;         </font><font color="#008000"><i>{ gif file not found }
 </i></font>geNotGIF <font color="#000080">= </font><font color="#800000">2</font><font color="#000080">;         </font><font color="#008000"><i>{ file is not a gif file }
 </i></font>geNoGlobalColor <font color="#000080">= </font><font color="#800000">3</font><font color="#000080">;  </font><font color="#008000"><i>{ no Global Color table found }
 </i></font>geImagePreceded <font color="#000080">= </font><font color="#800000">4</font><font color="#000080">;  </font><font color="#008000"><i>{ image descriptor preceeded by other unknown data }
 </i></font>geEmptyBlock <font color="#000080">= </font><font color="#800000">5</font><font color="#000080">;                       </font><font color="#008000"><i>{ Block has no data }
 </i></font>geUnExpectedEOF <font color="#000080">= </font><font color="#800000">6</font><font color="#000080">;  </font><font color="#008000"><i>{ unexpected EOF }
 </i></font>geBadCodeSize <font color="#000080">= </font><font color="#800000">7</font><font color="#000080">;    </font><font color="#008000"><i>{ bad code size }
 </i></font>geBadCode <font color="#000080">= </font><font color="#800000">8</font><font color="#000080">;                          </font><font color="#008000"><i>{ Bad code was found }
 </i></font>geBitSizeOverflow <font color="#000080">= </font><font color="#800000">9</font><font color="#000080">; </font><font color="#008000"><i>{ bit size went beyond 12 bits }

</i></font><font color="#FF0000"><b>type
  </b></font>stream_ptr<font color="#000080">=^</font>stream_type<font color="#000080">;
  </font>stream_type<font color="#000080">=</font><font color="#FF0000"><b>record
  </b></font>Header<font color="#000080">: </font>THeader<font color="#000080">;
                                        </font><font color="#008000"><i>{ gif file header }
  </i></font>LogicalScreen<font color="#000080">: </font>TLogicalScreenDescriptor<font color="#000080">;  </font><font color="#008000"><i>{ gif screen descriptor }
              </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>var </b></font>fichier<font color="#000080">:</font><font color="#FF0000"><b>file</b></font><font color="#000080">;
    </font>stream<font color="#000080">:</font>stream_type<font color="#000080">;
    </font>TableSize<font color="#000080">: </font>word<font color="#000080">;   </font><font color="#008000"><i>{ number of entrys in the color table }
    </i></font>GlobalColorTable<font color="#000080">: </font>TColorTable<font color="#000080">;            </font><font color="#008000"><i>{ global color table }
    </i></font>LocalColorTable<font color="#000080">: </font>TColorTable<font color="#000080">;             </font><font color="#008000"><i>{ local color table }
    </i></font>ImageDescriptor<font color="#000080">: </font>TImageDescriptor<font color="#000080">;        </font><font color="#008000"><i>{ image descriptor }
    </i></font>UseLocalColors<font color="#000080">: </font>boolean<font color="#000080">;                  </font><font color="#008000"><i>{ true if local colors in use }
    </i></font>Interlaced<font color="#000080">: </font>boolean<font color="#000080">;                      </font><font color="#008000"><i>{ true if image is interlaced }
    </i></font>InterlacePass<font color="#000080">: </font>byte<font color="#000080">;                      </font><font color="#008000"><i>{ interlace pass number }
    </i></font>LZWCodeSize<font color="#000080">: </font>byte<font color="#000080">;                        </font><font color="#008000"><i>{ minimum size of the LZW
codes in bits }
    </i></font>BitsLeft<font color="#000080">,</font>BytesLeft<font color="#000080">: </font>integer<font color="#000080">;</font><font color="#008000"><i>{ bits left in byte - bytes left in block }
    </i></font>BadCodeCount<font color="#000080">: </font>word<font color="#000080">;          </font><font color="#008000"><i>{ bad code counter }
    </i></font>CurrCodeSize<font color="#000080">: </font>integer<font color="#000080">;       </font><font color="#008000"><i>{ Current size of code in bits }
    </i></font>ClearCode<font color="#000080">: </font>integer<font color="#000080">;          </font><font color="#008000"><i>{ Clear code value }
    </i></font>EndingCode<font color="#000080">: </font>integer<font color="#000080">;         </font><font color="#008000"><i>{ ending code value }
    </i></font>Slot<font color="#000080">: </font>word<font color="#000080">;                  </font><font color="#008000"><i>{ position that the next new code is to be
added }
    </i></font>TopSlot<font color="#000080">: </font>word<font color="#000080">;               </font><font color="#008000"><i>{ highest slot position for the
current code size }
    </i></font>HighCode<font color="#000080">: </font>word<font color="#000080">;              </font><font color="#008000"><i>{ highest code that does not require decoding
}
    </i></font>NextByte<font color="#000080">: </font>integer<font color="#000080">;           </font><font color="#008000"><i>{ the index to the next byte in the
datablock array }
    </i></font>CurrByte<font color="#000080">: </font>byte<font color="#000080">;              </font><font color="#008000"><i>{ the current byte }
    </i></font>CurrentX<font color="#000080">, </font>CurrentY<font color="#000080">: </font>integer<font color="#000080">; </font><font color="#008000"><i>{ current screen locations }
    </i></font>ImageData<font color="#000080">: </font>TDataSubBlock<font color="#000080">;    </font><font color="#008000"><i>{ variable to store incoming gif data }
    </i></font>DecodeStack<font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font>MAXCODES<font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">; </font><font color="#008000"><i>{ stack for the decoded codes }
    </i></font>Prefix<font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font>MAXCODES<font color="#000080">] </font><font color="#FF0000"><b>of </b></font>word<font color="#000080">; </font><font color="#008000"><i>{ array for code prefixes }
    </i></font>Suffix<font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font>MAXCODES<font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">; </font><font color="#008000"><i>{ array for code suffixes }
    </i></font>LineBuffer<font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font>MAXSCREENWIDTH<font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">; </font><font color="#008000"><i>{ array for buffer line
output }
    </i></font>table<font color="#000080">:</font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">767</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">;
    </font>indice_sp<font color="#000080">:</font>integer<font color="#000080">;           </font><font color="#008000"><i>{ index to the decode stack }
    </i></font>indice<font color="#000080">:</font>word<font color="#000080">;
    </font>Retour<font color="#000080">: </font>longint<font color="#000080">;             </font><font color="#008000"><i>{ temporary return value }

{$L asmgif3}

</i></font><font color="#FF0000"><b>function </b></font>Power<font color="#000080">(</font>A<font color="#000080">, </font>N<font color="#000080">: </font>integer<font color="#000080">): </font>integer<font color="#000080">;       </font><font color="#008000"><i>{ returns A raised to the
power of N }
</i></font><font color="#FF0000"><b>begin
 </b></font>Power <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>shl </b></font>n<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>TGif_Error<font color="#000080">(</font>What<font color="#000080">: </font>integer<font color="#000080">);
</font><font color="#FF0000"><b>begin
 </b></font>Status <font color="#000080">:= </font>What<font color="#000080">;
        </font><font color="#FF0000"><b>if </b></font>What<font color="#000080">=</font>geNoFile <font color="#FF0000"><b>then </b></font>halt<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#008000"><i>{ TGif }
</i></font><font color="#FF0000"><b>procedure </b></font>TGif_Init<font color="#000080">(</font>AGIFName<font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">);
  </font><font color="#FF0000"><b>begin
 if </b></font>Pos<font color="#000080">(</font><font color="#800000">'.'</font><font color="#000080">,</font>AGifName<font color="#000080">) = </font><font color="#800000">0 </font><font color="#FF0000"><b>then     </b></font><font color="#008000"><i>{ if the filename has no
extension add one }

  </i></font>AGifName <font color="#000080">:= </font>AGifName <font color="#000080">+ </font><font color="#800000">'.gif'</font><font color="#000080">;
</font><font color="#008000"><i>{ New(stream,  2048);}
        </i></font>assign<font color="#000080">(</font>fichier<font color="#000080">,</font>agifname<font color="#000080">);
        </font><font color="#008000"><i>{$i-}
        </i></font>reset<font color="#000080">(</font>fichier<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">);
        </font><font color="#FF0000"><b>if </b></font>ioresult<font color="#000080">&lt;&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>tgif_Error<font color="#000080">(</font>geNoFile<font color="#000080">);
        </font>blockRead<font color="#000080">(</font>fichier<font color="#000080">,</font>stream<font color="#000080">, </font>sizeof<font color="#000080">(</font>Theader<font color="#000080">));   </font><font color="#008000"><i>{ read the header }
 </i></font><font color="#FF0000"><b>if </b></font>stream<font color="#000080">.</font>Header<font color="#000080">.</font>Signature <font color="#000080">&lt;&gt; </font><font color="#800000">'GIF' </font><font color="#FF0000"><b>then </b></font>tgif_Error<font color="#000080">(</font>geNotGIF<font color="#000080">);
                            </font><font color="#008000"><i>{ is vaild signature }
 </i></font>blockRead<font color="#000080">(</font>fichier<font color="#000080">,</font>stream<font color="#000080">.</font>LogicalScreen<font color="#000080">, </font>sizeof<font color="#000080">(</font>TLogicalScreenDescriptor<font color="#000080">));
 </font><font color="#FF0000"><b>if </b></font>stream<font color="#000080">.</font>LogicalScreen<font color="#000080">.</font>PackedFields <font color="#FF0000"><b>and </b></font>lsdGlobalColorTable <font color="#000080">=
</font>lsdGlobalColorTable <font color="#FF0000"><b>then
 begin
  </b></font>TableSize <font color="#000080">:=
</font>trunc<font color="#000080">(</font>Power<font color="#000080">(</font><font color="#800000">2</font><font color="#000080">,(</font>stream<font color="#000080">.</font>LogicalScreen<font color="#000080">.</font>PackedFields <font color="#FF0000"><b>and </b></font>lsdColorTableSize<font color="#000080">)+</font><font color="#800000">1</font><font color="#000080">));
  </font>blockread<font color="#000080">(</font>fichier<font color="#000080">,</font>GlobalColorTable<font color="#000080">,
</font>TableSize<font color="#000080">*</font>sizeof<font color="#000080">(</font>TColorItem<font color="#000080">)); </font><font color="#008000"><i>{ read Global Color Table }
 </i></font><font color="#FF0000"><b>end
 else
  </b></font>tgif_Error<font color="#000080">(</font>geNoGlobalColor<font color="#000080">);
 </font>blockread<font color="#000080">(</font>fichier<font color="#000080">,</font>ImageDescriptor<font color="#000080">, </font>sizeof<font color="#000080">(</font>ImageDescriptor<font color="#000080">)); </font><font color="#008000"><i>{
read image descriptor }
 </i></font><font color="#FF0000"><b>if </b></font>ImageDescriptor<font color="#000080">.</font>Seperator <font color="#000080">&lt;&gt; </font>ImageSeperator <font color="#FF0000"><b>then
        </b></font><font color="#008000"><i>{ verify that it is the descriptor }
  </i></font>tgif_Error<font color="#000080">(</font>geImagePreceded<font color="#000080">);
 </font><font color="#FF0000"><b>if </b></font>ImageDescriptor<font color="#000080">.</font>PackedFields <font color="#FF0000"><b>and </b></font>idLocalColorTable <font color="#000080">=
</font>idLocalColorTable <font color="#FF0000"><b>then
 begin
          </b></font><font color="#008000"><i>{ if local color table }
  </i></font>TableSize <font color="#000080">:=
</font>trunc<font color="#000080">(</font>Power<font color="#000080">(</font><font color="#800000">2</font><font color="#000080">,(</font>ImageDescriptor<font color="#000080">.</font>PackedFields <font color="#FF0000"><b>and </b></font>idColorTableSize<font color="#000080">)+</font><font color="#800000">1</font><font color="#000080">));
  </font>blockread<font color="#000080">(</font>fichier<font color="#000080">,</font>LocalColorTable<font color="#000080">,
</font>TableSize<font color="#000080">*</font>sizeof<font color="#000080">(</font>TColorItem<font color="#000080">)); </font><font color="#008000"><i>{ read Local Color Table }
  </i></font>UseLocalColors <font color="#000080">:= </font>True<font color="#000080">;
 </font><font color="#FF0000"><b>end
 else
  </b></font>UseLocalColors <font color="#000080">:= </font>false<font color="#000080">;
 </font><font color="#FF0000"><b>if </b></font>ImageDescriptor<font color="#000080">.</font>PackedFields <font color="#FF0000"><b>and </b></font>idInterlaced <font color="#000080">= </font>idInterlaced <font color="#FF0000"><b>then
 begin
  </b></font>Interlaced <font color="#000080">:= </font>true<font color="#000080">;
  </font>InterlacePass <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
 </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
 </font>Status <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
        </font>writeln<font color="#000080">(</font><font color="#800000">'nb coul: '</font><font color="#000080">,</font>tablesize<font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>TGif_Done<font color="#000080">;
  </font><font color="#FF0000"><b>begin
        </b></font>close<font color="#000080">(</font>fichier<font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>procedure </b></font>InitCompressionStream<font color="#000080">;
</font><font color="#FF0000"><b>var
 </b></font>I<font color="#000080">: </font>integer<font color="#000080">;
        </font>n<font color="#000080">:</font>byte<font color="#000080">;
</font><font color="#FF0000"><b>begin
                            </b></font><font color="#008000"><i>{ Initialize the graphics display }
 </i></font>blockread<font color="#000080">(</font>fichier<font color="#000080">,</font>LZWCodeSize<font color="#000080">, </font>sizeof<font color="#000080">(</font>byte<font color="#000080">));</font><font color="#008000"><i>{ get minimum code size }
 </i></font><font color="#FF0000"><b>if not </b></font><font color="#000080">(</font>LZWCodeSize <font color="#FF0000"><b>in </b></font><font color="#000080">[</font><font color="#800000">2</font><font color="#000080">..</font><font color="#800000">9</font><font color="#000080">]) </font><font color="#FF0000"><b>then     </b></font><font color="#008000"><i>{ valid code sizes 2-9 bits }
  </i></font>tgif_Error<font color="#000080">(</font>geBadCodeSize<font color="#000080">);

 </font>CurrCodeSize <font color="#000080">:= </font>succ<font color="#000080">(</font>LZWCodeSize<font color="#000080">); </font><font color="#008000"><i>{ set the initial code size }
 </i></font>ClearCode <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>shl </b></font>LZWCodeSize<font color="#000080">;    </font><font color="#008000"><i>{ set the clear code }
 </i></font>EndingCode <font color="#000080">:= </font>succ<font color="#000080">(</font>ClearCode<font color="#000080">);     </font><font color="#008000"><i>{ set the ending code }
 </i></font>HighCode <font color="#000080">:= </font>pred<font color="#000080">(</font>ClearCode<font color="#000080">);                     </font><font color="#008000"><i>{ set the
highest code not needing decoding }
 </i></font>BytesLeft <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;                    </font><font color="#008000"><i>{ clear other variables }
 </i></font>BitsLeft <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
 </font>CurrentX <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
 </font>CurrentY <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#008000"><i>{$f-}
</i></font><font color="#FF0000"><b>procedure </b></font>TGif_ReadSubBlock<font color="#000080">;
</font><font color="#FF0000"><b>begin
 </b></font>blockread<font color="#000080">(</font>fichier<font color="#000080">,</font>ImageData<font color="#000080">.</font>Size<font color="#000080">, </font>sizeof<font color="#000080">(</font>ImageData<font color="#000080">.</font>Size<font color="#000080">)); </font><font color="#008000"><i>{
get the data block size }
 </i></font><font color="#FF0000"><b>if </b></font>ImageData<font color="#000080">.</font>Size <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>tgif_Error<font color="#000080">(</font>geEmptyBlock<font color="#000080">); </font><font color="#008000"><i>{ check
for empty block }
 </i></font>blockread<font color="#000080">(</font>fichier<font color="#000080">,</font>ImageData<font color="#000080">.</font>Data<font color="#000080">, </font>ImageData<font color="#000080">.</font>Size<font color="#000080">);   </font><font color="#008000"><i>{ read in the block }
 </i></font>NextByte <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;                                  </font><font color="#008000"><i>{ reset next byte }
 </i></font>BytesLeft <font color="#000080">:= </font>ImageData<font color="#000080">.</font>Size<font color="#000080">;
                                        </font><font color="#008000"><i>{ reset bytes left }
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>const
 </b></font>CodeMask<font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">12</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>longint <font color="#000080">= (  </font><font color="#008000"><i>{ bit masks for use with Next code }
  </i></font><font color="#800000">0</font><font color="#000080">,
  </font><font color="#800000">$0001</font><font color="#000080">, </font><font color="#800000">$0003</font><font color="#000080">,
  </font><font color="#800000">$0007</font><font color="#000080">, </font><font color="#800000">$000F</font><font color="#000080">,
  </font><font color="#800000">$001F</font><font color="#000080">, </font><font color="#800000">$003F</font><font color="#000080">,
  </font><font color="#800000">$007F</font><font color="#000080">, </font><font color="#800000">$00FF</font><font color="#000080">,
  </font><font color="#800000">$01FF</font><font color="#000080">, </font><font color="#800000">$03FF</font><font color="#000080">,
  </font><font color="#800000">$07FF</font><font color="#000080">, </font><font color="#800000">$0FFF</font><font color="#000080">);

</font><font color="#008000"><i>{$f-}
</i></font><font color="#FF0000"><b>function </b></font>NextCode<font color="#000080">: </font>word<font color="#000080">;</font><font color="#FF0000"><b>external</b></font><font color="#000080">; </font><font color="#008000"><i>{ returns a code of the proper bit size }

</i></font><font color="#FF0000"><b>procedure </b></font>write_pal<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>pal<font color="#000080">;</font>start<font color="#000080">,</font>quant<font color="#000080">:</font>word<font color="#000080">);
  </font><font color="#FF0000"><b>begin
    asm
      </b></font><font color="#FF00FF">push ds
      lds si,pal
      mov dx,3c8h
      cld
      mov cx,quant
      mov bx,start
      @deb1:
        mov al,bl
        out dx,al
        inc dx
        lodsb
        out dx,al
        lodsb
        out dx,al
        lodsb
        out dx,al
        dec dx
        inc bl
      loop @deb1
      pop ds
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>procedure </b></font>InitGraphics<font color="#000080">;
</font><font color="#FF0000"><b>var
        </b></font>n<font color="#000080">:</font>byte<font color="#000080">;
        </font>x<font color="#000080">,</font>y<font color="#000080">,</font>i<font color="#000080">:</font>word<font color="#000080">;
</font><font color="#FF0000"><b>begin
        </b></font><font color="#008000"><i>{ you can change the $101 value for other VESA modes }
        </i></font>n<font color="#000080">:=</font>setmode<font color="#000080">(</font><font color="#800000">$101</font><font color="#000080">);
 </font><font color="#FF0000"><b>if </b></font>n <font color="#000080">=</font><font color="#800000">0  </font><font color="#FF0000"><b>then
 begin
  </b></font>Writeln<font color="#000080">(</font><font color="#800000">'vesa error '</font><font color="#000080">);
  </font>Halt<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">);
 </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

 </font><font color="#008000"><i>{ the following loop sets up the RGB palette }
        </i></font>x<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
 </font><font color="#FF0000"><b>if not </b></font>UseLocalColors <font color="#FF0000"><b>then
          begin
            for </b></font>I <font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font>TableSize <font color="#000080">- </font><font color="#800000">1 </font><font color="#FF0000"><b>do
              begin
               </b></font>table<font color="#000080">[</font>x<font color="#000080">]:=</font>GlobalColorTable<font color="#000080">[</font>I<font color="#000080">].</font>Red <font color="#FF0000"><b>div </b></font><font color="#800000">4</font><font color="#000080">;
               </font>inc<font color="#000080">(</font>x<font color="#000080">);
               </font>table<font color="#000080">[</font>x<font color="#000080">]:=</font>GlobalColorTable<font color="#000080">[</font>i<font color="#000080">].</font>Green <font color="#FF0000"><b>div </b></font><font color="#800000">4</font><font color="#000080">;
               </font>inc<font color="#000080">(</font>x<font color="#000080">);
               </font>table<font color="#000080">[</font>x<font color="#000080">]:=</font>GlobalColorTable<font color="#000080">[</font>I<font color="#000080">].</font>Blue <font color="#FF0000"><b>div </b></font><font color="#800000">4</font><font color="#000080">;
               </font>inc<font color="#000080">(</font>x<font color="#000080">);
             </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
             </font>write_pal<font color="#000080">(</font>table<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">],</font><font color="#800000">0</font><font color="#000080">,</font>tablesize<font color="#000080">);
          </font><font color="#FF0000"><b>end
 else
          begin
            </b></font>x<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
            </font><font color="#FF0000"><b>for </b></font>I <font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font>TableSize <font color="#000080">- </font><font color="#800000">1 </font><font color="#FF0000"><b>do
              begin
               </b></font>table<font color="#000080">[</font>x<font color="#000080">]:=</font>localColorTable<font color="#000080">[</font>I<font color="#000080">].</font>Red <font color="#FF0000"><b>div </b></font><font color="#800000">4</font><font color="#000080">;
               </font>inc<font color="#000080">(</font>x<font color="#000080">);
               </font>table<font color="#000080">[</font>x<font color="#000080">]:=</font>localColorTable<font color="#000080">[</font>i<font color="#000080">].</font>Green <font color="#FF0000"><b>div </b></font><font color="#800000">4</font><font color="#000080">;
               </font>inc<font color="#000080">(</font>x<font color="#000080">);
               </font>table<font color="#000080">[</font>x<font color="#000080">]:=</font>localColorTable<font color="#000080">[</font>I<font color="#000080">].</font>Blue <font color="#FF0000"><b>div </b></font><font color="#800000">4</font><font color="#000080">;
               </font>inc<font color="#000080">(</font>x<font color="#000080">);
             </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
             </font>write_pal<font color="#000080">(</font>table<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">],</font><font color="#800000">0</font><font color="#000080">,</font>tablesize<font color="#000080">);
           </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#008000"><i>{
       for x:=0 to 255 do
         for y:=0 to 255 do
           setpix(x,y,x);}
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>procedure </b></font>DrawLine<font color="#000080">;
</font><font color="#FF0000"><b>var
 </b></font>I<font color="#000080">: </font>integer<font color="#000080">;

</font><font color="#FF0000"><b>begin
        if not </b></font>write_fast<font color="#000080">(</font><font color="#800000">0</font><font color="#000080">,</font>CurrentY<font color="#000080">,</font>ImageDescriptor<font color="#000080">.</font>ImageWidth<font color="#000080">,
          </font>LineBuffer<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">]) </font><font color="#FF0000"><b>then
 for </b></font>I <font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font>ImageDescriptor<font color="#000080">.</font>ImageWidth <font color="#FF0000"><b>do
  </b></font>setpix<font color="#000080">(</font>I<font color="#000080">, </font>CurrentY<font color="#000080">, </font>LineBuffer<font color="#000080">[</font>I<font color="#000080">]);
 </font>inc<font color="#000080">(</font>CurrentY<font color="#000080">);

 </font><font color="#FF0000"><b>if </b></font>InterLaced <font color="#FF0000"><b>then     </b></font><font color="#008000"><i>{ Interlace support }
 </i></font><font color="#FF0000"><b>begin
  case </b></font>InterlacePass <font color="#FF0000"><b>of
   </b></font><font color="#800000">0</font><font color="#000080">: </font>CurrentY <font color="#000080">:= </font>CurrentY <font color="#000080">+ </font><font color="#800000">7</font><font color="#000080">;
   </font><font color="#800000">1</font><font color="#000080">: </font>CurrentY <font color="#000080">:= </font>CurrentY <font color="#000080">+ </font><font color="#800000">7</font><font color="#000080">;
   </font><font color="#800000">2</font><font color="#000080">: </font>CurrentY <font color="#000080">:= </font>CurrentY <font color="#000080">+ </font><font color="#800000">3</font><font color="#000080">;
   </font><font color="#800000">3</font><font color="#000080">: </font>CurrentY <font color="#000080">:= </font>CurrentY <font color="#000080">+ </font><font color="#800000">1</font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font>CurrentY <font color="#000080">&gt;= </font>ImageDescriptor<font color="#000080">.</font>ImageHeight <font color="#FF0000"><b>then
  begin
   </b></font>inc<font color="#000080">(</font>InterLacePass<font color="#000080">);
   </font><font color="#FF0000"><b>case </b></font>InterLacePass <font color="#FF0000"><b>of
    </b></font><font color="#800000">1</font><font color="#000080">: </font>CurrentY <font color="#000080">:= </font><font color="#800000">4</font><font color="#000080">;
    </font><font color="#800000">2</font><font color="#000080">: </font>CurrentY <font color="#000080">:= </font><font color="#800000">2</font><font color="#000080">;
    </font><font color="#800000">3</font><font color="#000080">: </font>CurrentY <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;
   </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
 </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{ this procedure initializes the graphics mode and actually decodes the
 GIF image }
</i></font><font color="#FF0000"><b>procedure </b></font>Decode<font color="#000080">(</font>Beep<font color="#000080">: </font>boolean<font color="#000080">);


</font><font color="#008000"><i>{ local procedure that decodes a code and puts it on the decode stack }
</i></font><font color="#FF0000"><b>procedure </b></font>DecodeCode<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>code<font color="#000080">:</font>word<font color="#000080">);</font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>asm
      </b></font><font color="#FF00FF">les di,code
      mov bx,word ptr [es:di]
      mov si,indice_sp
      cmp bx,HighCode
      jbe @@fin

    @@boucle:
      mov al,[offset word ptr Suffix+bx]  </font><font color="#008000"><i>{ al:=suffix[code] }
      </i></font><font color="#FF00FF">mov [Offset word ptr DecodeStack+si],al      </font><font color="#008000"><i>{ decodestack:=al }
      </i></font><font color="#FF00FF">inc si

      shl bx,1   </font><font color="#008000"><i>{ array of  word }
      </i></font><font color="#FF00FF">mov bx,[Offset word ptr Prefix+bx]    </font><font color="#008000"><i>{code:=prefix[code }
      </i></font><font color="#FF00FF">cmp bx,word ptr HighCode
      ja @@boucle

    @@fin:
      mov [Offset word ptr DecodeStack+si],bx

      inc si
      mov indice_sp,si
      mov word ptr [es:di],bx
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>var
 </b></font>TempOldCode<font color="#000080">, </font>OldCode<font color="#000080">: </font>word<font color="#000080">;
 </font>BufCnt<font color="#000080">: </font>word<font color="#000080">;           </font><font color="#008000"><i>{ line buffer counter }
 </i></font>Code<font color="#000080">, </font>C<font color="#000080">: </font>word<font color="#000080">;
 </font>CurrBuf<font color="#000080">: </font>word<font color="#000080">;  </font><font color="#008000"><i>{ line buffer index }
</i></font><font color="#FF0000"><b>begin
 </b></font>InitGraphics<font color="#000080">;             </font><font color="#008000"><i>{ Initialize the graphics mode and RGB palette }
 </i></font>InitCompressionStream<font color="#000080">;    </font><font color="#008000"><i>{ Initialize decoding paramaters }
 </i></font>OldCode <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
 </font>indice_sp <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
 </font>BufCnt <font color="#000080">:= </font>ImageDescriptor<font color="#000080">.</font>ImageWidth<font color="#000080">; </font><font color="#008000"><i>{ set the Image Width }
 </i></font>CurrBuf <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;

 </font>C <font color="#000080">:= </font>NextCode<font color="#000080">;                                          </font><font color="#008000"><i>{ get
the initial code - should be a clear code }
 </i></font><font color="#FF0000"><b>while </b></font>C <font color="#000080">&lt;&gt; </font>EndingCode <font color="#FF0000"><b>do  </b></font><font color="#008000"><i>{ main loop until ending code is found }
 </i></font><font color="#FF0000"><b>begin
  if </b></font>C <font color="#000080">= </font>ClearCode <font color="#FF0000"><b>then   </b></font><font color="#008000"><i>{ code is a clear code - so clear }
  </i></font><font color="#FF0000"><b>begin
   </b></font>CurrCodeSize <font color="#000080">:= </font>LZWCodeSize <font color="#000080">+ </font><font color="#800000">1</font><font color="#000080">;</font><font color="#008000"><i>{ reset the code size }
   </i></font>Slot <font color="#000080">:= </font>EndingCode <font color="#000080">+ </font><font color="#800000">1</font><font color="#000080">;
        </font><font color="#008000"><i>{ set slot for next new code }
   </i></font>TopSlot <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>shl </b></font>CurrCodeSize<font color="#000080">;  </font><font color="#008000"><i>{ set max slot number }
   </i></font><font color="#FF0000"><b>while </b></font>C <font color="#000080">= </font>ClearCode <font color="#FF0000"><b>do
    </b></font>C <font color="#000080">:= </font>NextCode<font color="#000080">;                  </font><font color="#008000"><i>{ read
until all clear codes gone - shouldn't happen }
   </i></font><font color="#FF0000"><b>if </b></font>C <font color="#000080">= </font>EndingCode <font color="#FF0000"><b>then
   begin
    </b></font>tgif_Error<font color="#000080">(</font>geBadCode<font color="#000080">);   </font><font color="#008000"><i>{ ending code
after a clear code }
    </i></font>break<font color="#000080">;
                </font><font color="#008000"><i>{ this also should never happen }
   </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;
   </font><font color="#FF0000"><b>if </b></font>C <font color="#000080">&gt;= </font>Slot <font color="#008000"><i>{ if the code is beyond preset
codes then set to zero }
    </i></font><font color="#FF0000"><b>then </b></font>c <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
   </font>OldCode <font color="#000080">:= </font>C<font color="#000080">;
   </font>DecodeStack<font color="#000080">[</font>indice_sp<font color="#000080">] := </font>C<font color="#000080">;
               </font><font color="#008000"><i>{ output code to decoded stack }
   </i></font>inc<font color="#000080">(</font>indice_sp<font color="#000080">);
                         </font><font color="#008000"><i>{ increment decode stack index }
  </i></font><font color="#FF0000"><b>end
  else   </b></font><font color="#008000"><i>{ the code is not a clear code or an ending code
so it must }
  </i></font><font color="#FF0000"><b>begin  </b></font><font color="#008000"><i>{ be a code code - so decode the code }
   </i></font>Code <font color="#000080">:= </font>C<font color="#000080">;
   </font><font color="#FF0000"><b>if </b></font>Code <font color="#000080">&lt; </font>Slot <font color="#FF0000"><b>then     </b></font><font color="#008000"><i>{ is the code in the table? }
   </i></font><font color="#FF0000"><b>begin
    </b></font>DecodeCode<font color="#000080">(</font>Code<font color="#000080">);
                </font><font color="#008000"><i>{ decode the code }
    </i></font><font color="#FF0000"><b>if </b></font>Slot <font color="#000080">&lt;= </font>TopSlot <font color="#FF0000"><b>then
    begin                             </b></font><font color="#008000"><i>{ add
the new code to the table }
                                 </i></font>Suffix<font color="#000080">[</font>Slot<font color="#000080">] := </font>Code<font color="#000080">;
        </font><font color="#008000"><i>{ make the suffix }
     </i></font>PreFix<font color="#000080">[</font>slot<font color="#000080">] := </font>OldCode<font color="#000080">;
</font><font color="#008000"><i>{ the previous code - a link to the data }
     </i></font>inc<font color="#000080">(</font>Slot<font color="#000080">);
                                        </font><font color="#008000"><i>{ increment slot number }
     </i></font>OldCode <font color="#000080">:= </font>C<font color="#000080">;
                                </font><font color="#008000"><i>{ set oldcode }
    </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>if </b></font>Slot <font color="#000080">&gt;= </font>TopSlot <font color="#FF0000"><b>then </b></font><font color="#008000"><i>{ have reached
the top slot for bit size }
    </i></font><font color="#FF0000"><b>begin                   </b></font><font color="#008000"><i>{ increment code bit size }
     </i></font><font color="#FF0000"><b>if </b></font>CurrCodeSize <font color="#000080">&lt; </font><font color="#800000">12 </font><font color="#FF0000"><b>then </b></font><font color="#008000"><i>{ new
bit size not too big? }
     </i></font><font color="#FF0000"><b>begin
      </b></font>TopSlot <font color="#000080">:= </font>TopSlot <font color="#FF0000"><b>shl
</b></font><font color="#800000">1</font><font color="#000080">;       </font><font color="#008000"><i>{ new top slot }
      </i></font>inc<font color="#000080">(</font>CurrCodeSize<font color="#000080">)
                                </font><font color="#008000"><i>{ new code size }
     </i></font><font color="#FF0000"><b>end
     else

</b></font>tgif_Error<font color="#000080">(</font>geBitSizeOverflow<font color="#000080">); </font><font color="#008000"><i>{ encoder made a boo boo }
    </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;
   </font><font color="#FF0000"><b>end
   else
   begin           </b></font><font color="#008000"><i>{ the code is not in the table }
    </i></font><font color="#FF0000"><b>if </b></font>Code <font color="#000080">&lt;&gt; </font>Slot <font color="#FF0000"><b>then
</b></font><font color="#008000"><i>{ code is not the next available slot }
     </i></font>tgif_Error<font color="#000080">(</font>geBadCode<font color="#000080">);  </font><font color="#008000"><i>{ so error out }

    { the code does not exist so make a new
entry in the code table
     and then translate the new code }
    </i></font>TempOldCode <font color="#000080">:= </font>OldCode<font color="#000080">;  </font><font color="#008000"><i>{ make a copy
of the old code }
    </i></font><font color="#FF0000"><b>while </b></font>OldCode <font color="#000080">&gt; </font>HighCode <font color="#FF0000"><b>do </b></font><font color="#008000"><i>{ translate
the old code and place it }
    </i></font><font color="#FF0000"><b>begin
</b></font><font color="#008000"><i>{ on the decode stack }
     </i></font>DecodeStack<font color="#000080">[</font>indice_sp<font color="#000080">] :=
</font>Suffix<font color="#000080">[</font>OldCode<font color="#000080">]; </font><font color="#008000"><i>{ do the suffix }
     </i></font>OldCode <font color="#000080">:= </font>Prefix<font color="#000080">[</font>OldCode<font color="#000080">];
    </font><font color="#008000"><i>{ get next prefix }
    </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font>DecodeStack<font color="#000080">[</font>indice_sp<font color="#000080">] := </font>OldCode<font color="#000080">;
</font><font color="#008000"><i>{ put the code onto the decode stack }


{ but DO NOT increment stack index }
    { the decode stack is not incremented
because because we are only
     translating the oldcode to get
the first character }
    </i></font><font color="#FF0000"><b>if </b></font>Slot <font color="#000080">&lt;= </font>TopSlot <font color="#FF0000"><b>then
    begin                 </b></font><font color="#008000"><i>{ make new code entry }
     </i></font>Suffix<font color="#000080">[</font>Slot<font color="#000080">] := </font>OldCode<font color="#000080">;
         </font><font color="#008000"><i>{ first char of old code }
     </i></font>Prefix<font color="#000080">[</font>Slot<font color="#000080">] := </font>TempOldCode<font color="#000080">; </font><font color="#008000"><i>{
link to the old code prefix }
     </i></font>inc<font color="#000080">(</font>Slot<font color="#000080">);                   </font><font color="#008000"><i>{
increment slot }
    </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>if </b></font>Slot <font color="#000080">&gt;= </font>TopSlot <font color="#FF0000"><b>then </b></font><font color="#008000"><i>{ slot is too big }
    </i></font><font color="#FF0000"><b>begin                   </b></font><font color="#008000"><i>{ increment code size }
     </i></font><font color="#FF0000"><b>if </b></font>CurrCodeSize <font color="#000080">&lt; </font><font color="#800000">12 </font><font color="#FF0000"><b>then
     begin
      </b></font>TopSlot <font color="#000080">:= </font>TopSlot <font color="#FF0000"><b>shl
</b></font><font color="#800000">1</font><font color="#000080">;       </font><font color="#008000"><i>{ new top slot }
      </i></font>inc<font color="#000080">(</font>CurrCodeSize<font color="#000080">)
                                </font><font color="#008000"><i>{ new code size }
     </i></font><font color="#FF0000"><b>end
     else
      </b></font>tgif_Error<font color="#000080">(</font>geBitSizeOverFlow<font color="#000080">);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font>DecodeCode<font color="#000080">(</font>Code<font color="#000080">); </font><font color="#008000"><i>{ now that the table
entry exists decode it }
    </i></font>OldCode <font color="#000080">:= </font>C<font color="#000080">;     </font><font color="#008000"><i>{ set the new old code }
   </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#008000"><i>{ the decoded string is on the decode stack so pop it
off and put it
   into the line buffer }

                        </i></font><font color="#FF0000"><b>asm
                          </b></font><font color="#FF00FF">mov cx,BufCnt
                          mov si,CurrBuf
                          mov bx,indice_sp
                          cmp bx,0
                          je @@fin

                        @@boucle:
                          dec bx
                          mov al,[offset byte ptr DecodeStack+bx]
                          mov  [offset byte ptr LineBuffer+si],al
                          inc si
                          dec cx
                          jnz @@suite
                                  pusha
                                  push di
                                  call DrawLine
                                  pop di
                                  popa
                                  mov si,0
                                  mov cx,[offset ImageDescriptor.ImageWidth]
                        @@suite:
                          cmp bx,0
                          ja @@boucle
                        @@fin:
                          mov BufCnt,cx
                          mov indice_sp,bx
                          mov CurrBuf,si
                        </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

 </font>C <font color="#000080">:= </font>NextCode<font color="#000080">;  </font><font color="#008000"><i>{ get the next code and go at is some more }
 </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;            </font><font color="#008000"><i>{ now that wasn't all that bad was it? }
 </i></font><font color="#FF0000"><b>if </b></font>Beep <font color="#FF0000"><b>then
  if </b></font>Status <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>then
  begin
   </b></font>Sound<font color="#000080">(</font><font color="#800000">200</font><font color="#000080">);     </font><font color="#008000"><i>{ Beep if status is ok }
   </i></font>Delay<font color="#000080">(</font><font color="#800000">0</font><font color="#000080">);
   </font>NoSound<font color="#000080">;
  </font><font color="#FF0000"><b>end
  else
  begin
   </b></font>Sound<font color="#000080">(</font><font color="#800000">1100</font><font color="#000080">); </font><font color="#008000"><i>{ Boop if status is not ok }
   </i></font>Delay<font color="#000080">(</font><font color="#800000">0</font><font color="#000080">);
   </font>NoSound<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>general<font color="#000080">(</font>nom<font color="#000080">:</font><font color="#FF0000"><b>string</b></font><font color="#000080">);
  </font><font color="#FF0000"><b>begin
    </b></font>tgif_init<font color="#000080">(</font>nom<font color="#000080">);
    </font>decode<font color="#000080">(</font>true<font color="#000080">);
    </font>tgif_done<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>end</b></font><font color="#000080">.

</font><font color="#008000"><i>{
cut here
----------------------------------------------------------------------------
}

</i></font><font color="#FF0000"><b>program </b></font>Gift<font color="#000080">;
</font><font color="#008000"><i>{
 Gifutil9 sample program
 November 1994

}

</i></font><font color="#FF0000"><b>uses </b></font>GifUtil9<font color="#000080">, </font>CRT<font color="#000080">, </font>Dos<font color="#000080">;




</font><font color="#FF0000"><b>var
 </b></font>A<font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;
 </font>Hours<font color="#000080">, </font>Minutes<font color="#000080">, </font>Seconds<font color="#000080">, </font>Sec100<font color="#000080">: </font>word<font color="#000080">;
 </font>H<font color="#000080">, </font>M<font color="#000080">, </font>S<font color="#000080">, </font>S100<font color="#000080">: </font>word<font color="#000080">;
        </font>tps1<font color="#000080">,</font>tps2<font color="#000080">:</font>longint<font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>donne_heure<font color="#000080">:</font>longint<font color="#000080">;
</font><font color="#FF0000"><b>var </b></font>heure<font color="#000080">,</font>minute<font color="#000080">,</font>seconde<font color="#000080">,</font>sec100<font color="#000080">:</font>word<font color="#000080">;
  </font><font color="#FF0000"><b>begin
    </b></font>gettime<font color="#000080">(</font>heure<font color="#000080">,</font>minute<font color="#000080">,</font>seconde<font color="#000080">,</font>sec100<font color="#000080">);
    </font>donne_heure<font color="#000080">:=</font>heure<font color="#000080">*</font><font color="#800000">3600</font><font color="#000080">*</font><font color="#800000">100</font><font color="#000080">+</font>minute<font color="#000080">*</font><font color="#800000">60</font><font color="#000080">*</font><font color="#800000">100</font><font color="#000080">+</font>seconde<font color="#000080">*</font><font color="#800000">100</font><font color="#000080">+</font>sec100<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>begin
 </b></font>Writeln<font color="#000080">(</font><font color="#800000">'Sample program for using GIFUTIL9.PAS unit'</font><font color="#000080">);
        </font>Writeln<font color="#000080">;
        </font>Writeln<font color="#000080">(</font><font color="#800000">'Based on code written by Sean Wenzel '</font><font color="#000080">);
        </font>Writeln<font color="#000080">(</font><font color="#800000">'Modified by Lionel Cordesses ( FRANCE )'</font><font color="#000080">);
        </font>Writeln<font color="#000080">(</font><font color="#800000">'Only tested with 256 colors GIF pictures ...'</font><font color="#000080">);
 </font>Writeln<font color="#000080">(</font><font color="#800000">'Press ENTER '</font><font color="#000080">);
        </font>Readln<font color="#000080">;


 </font><font color="#FF0000"><b>if </b></font>ParamCount <font color="#000080">&lt;&gt; </font><font color="#800000">1 </font><font color="#FF0000"><b>then
 begin
  </b></font>Writeln<font color="#000080">(</font><font color="#800000">'use: gift &lt;gifname&gt;[.gif] to run...'</font><font color="#000080">);
  </font>Exit<font color="#000080">;
 </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
 </font>GetTime<font color="#000080">(</font>Hours<font color="#000080">, </font>Minutes<font color="#000080">, </font>Seconds<font color="#000080">, </font>Sec100<font color="#000080">);
        </font>tps1<font color="#000080">:=</font>donne_heure<font color="#000080">;
  </font>general<font color="#000080">(</font>ParamStr<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">));
        </font>tps2<font color="#000080">:=</font>donne_heure<font color="#000080">;
 </font>GetTime<font color="#000080">(</font>H<font color="#000080">, </font>M<font color="#000080">, </font>S<font color="#000080">, </font>S100<font color="#000080">);
        </font>readln<font color="#000080">;
        </font>textmode<font color="#000080">(</font>co80<font color="#000080">);


        </font>writeln<font color="#000080">(</font><font color="#800000">'time: '</font><font color="#000080">,</font>tps2<font color="#000080">-</font>tps1<font color="#000080">);
 </font><font color="#FF0000"><b>while not</b></font><font color="#000080">(</font>KeyPressed<font color="#000080">) </font><font color="#FF0000"><b>do</b></font><font color="#000080">;

 </font>writeln<font color="#000080">(</font><font color="#800000">'&quot;The Graphics Interchange Format(c) is the Copyright property of'</font><font color="#000080">);
 </font>writeln<font color="#000080">(</font><font color="#800000">'CompuServe Incorporated. GIF(sm) is a Service Mark property of '</font><font color="#000080">);
 </font>writeln<font color="#000080">(</font><font color="#800000">'CompuServe Incorporated.&quot;'</font><font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">.

</font><font color="#008000"><i>{ cut here
-----------------------------------------------------------------------------
}
</i></font><font color="#000080">;</font>ASMGIF3 <font color="#FF0000"><b>for  </b></font>GIFUTILxx<font color="#000080">.</font>pas   Lionel CORDESSES <font color="#000080">(</font>November <font color="#800000">1994 </font><font color="#000080">)

.</font>model large<font color="#000080">,</font><font color="#FF0000"><b>pascal

</b></font>data segment <font color="#FF0000"><b>public
</b></font>data ends

radix <font color="#800000">10
</font>P386
NOSMART

dataseg
  extrn NextByte<font color="#000080">:</font>word<font color="#000080">;
  </font>extrn BitsLeft<font color="#000080">:</font>word<font color="#000080">;
  </font>extrn BytesLeft<font color="#000080">:</font>word<font color="#000080">;
  </font>extrn ImageData<font color="#000080">:</font><font color="#FF0000"><b>near </b></font>ptr dword<font color="#000080">;
  </font>extrn CurrByte<font color="#000080">:</font>byte<font color="#000080">;
  </font>extrn retour<font color="#000080">:</font>dword<font color="#000080">;
  </font>extrn CurrCodeSize<font color="#000080">:</font>word<font color="#000080">;
  </font>extrn CodeMask<font color="#000080">:</font><font color="#FF0000"><b>near </b></font>ptr dword<font color="#000080">;

.</font>code

extrn tgif_ReadSubBlock


NextCode  PROC <font color="#FF0000"><b>near
public </b></font>NextCode

       mov ax<font color="#000080">,[</font>BitsLeft<font color="#000080">]
       </font>cmp ax<font color="#000080">,</font><font color="#800000">0
       </font>jg <font color="#000080">@@</font>suite1

       mov ax<font color="#000080">,[</font>BytesLeft<font color="#000080">]
       </font>cmp ax<font color="#000080">,</font><font color="#800000">0
       </font>jg <font color="#000080">@@</font>suite2

<font color="#000080">;         </font><font color="#FF0000"><b>if </b></font>buffer <font color="#FF0000"><b>is </b></font>empty
       pusha
       push di
       call <font color="#FF0000"><b>near </b></font>ptr Tgif_ReadSubBlock
       pop di
       popa

    <font color="#000080">@@</font>suite2<font color="#000080">:
       </font>mov bx<font color="#000080">,[</font>NextByte<font color="#000080">]

       </font>mov al<font color="#000080">,</font>byte ptr <font color="#000080">[</font>offset ImageData<font color="#000080">+</font>bx<font color="#000080">] ;
       </font>mov <font color="#000080">[</font>CurrByte<font color="#000080">],</font>al

       inc bx
       mov <font color="#000080">[</font>NextByte<font color="#000080">],</font>bx
       mov <font color="#000080">[</font>BitsLeft<font color="#000080">],</font><font color="#800000">8
       </font>dec <font color="#000080">[</font>BytesLeft<font color="#000080">]

    @@</font>suite1<font color="#000080">:
       </font>mov eax<font color="#000080">,</font><font color="#800000">0
       </font>mov al<font color="#000080">,[</font>CurrByte<font color="#000080">]
       </font>mov cx<font color="#000080">,</font><font color="#800000">8
       </font>mov dx<font color="#000080">,[</font>BitsLeft<font color="#000080">]
       </font>sub cx<font color="#000080">,</font>dx
       <font color="#FF0000"><b>shr </b></font>eax<font color="#000080">,</font>cl
       mov cx<font color="#000080">,</font>dx          <font color="#000080">;</font>save BitsLeft <font color="#FF0000"><b>in </b></font>CX
       mov edx<font color="#000080">,</font>eax
       mov bx<font color="#000080">,[</font>NextByte<font color="#000080">]

    @@</font><font color="#FF0000"><b>while</b></font><font color="#000080">:
       </font>cmp <font color="#000080">[</font>CurrCodeSize<font color="#000080">],</font>cx
       jng <font color="#000080">@@</font>fin2

       cmp <font color="#000080">[</font>BytesLeft<font color="#000080">],</font><font color="#800000">0
       </font>jg <font color="#000080">@@</font>suite4
<font color="#000080">;         </font><font color="#FF0000"><b>if </b></font>buffer <font color="#FF0000"><b>is </b></font>empty
       pusha
       push di
       call <font color="#FF0000"><b>near </b></font>ptr Tgif_ReadSubBlock
       pop di
       popa
       mov bx<font color="#000080">,[</font>NextByte<font color="#000080">]

    @@</font>suite4<font color="#000080">:

       </font>mov eax<font color="#000080">,</font><font color="#800000">0

       </font>mov al<font color="#000080">,</font>byte ptr <font color="#000080">[</font>offset ImageData<font color="#000080">+</font>bx<font color="#000080">] ;
       </font>mov <font color="#000080">[</font>CurrByte<font color="#000080">],</font>al
       inc bx


       <font color="#FF0000"><b>shl </b></font>eax<font color="#000080">,</font>cl
       <font color="#FF0000"><b>or </b></font>edx<font color="#000080">,</font>eax

       add cx<font color="#000080">,</font><font color="#800000">8
       </font>dec <font color="#000080">[</font>BytesLeft<font color="#000080">]

       </font>jmp <font color="#000080">@@</font><font color="#FF0000"><b>while

    </b></font><font color="#000080">@@</font>fin2<font color="#000080">:
       </font>mov <font color="#000080">[</font>NextByte<font color="#000080">],</font>bx
       mov bx<font color="#000080">,[</font>CurrCodeSize<font color="#000080">]
       </font>sub cx<font color="#000080">,</font>bx
       mov <font color="#000080">[</font>BitsLeft<font color="#000080">],</font>cx
       <font color="#FF0000"><b>shl </b></font>bx<font color="#000080">,</font><font color="#800000">2               </font><font color="#000080">; </font>longint <font color="#000080">= </font><font color="#800000">4 </font>Bytes <font color="#000080">!!!!
       </font>lea di<font color="#000080">,[</font>CodeMask<font color="#000080">]
       </font>mov eax<font color="#000080">,[</font>di<font color="#000080">+</font>bx<font color="#000080">]
       </font><font color="#FF0000"><b>and </b></font>edx<font color="#000080">,</font>eax
<font color="#000080">;       </font>mov <font color="#000080">[</font>retour<font color="#000080">],</font>edx
       mov ax<font color="#000080">,</font>dx
       ret


<font color="#000080">;</font>tasm_shl endp
NextCode endp

<font color="#FF0000"><b>end

</b></font><font color="#008000"><i>{ cut here
-----------------------------------------------------------------------------
  Here is the ASMGIF3.OBJ file in .XX format
}


</i></font><font color="#000080">*</font>XX3402<font color="#000080">-</font><font color="#800000">001268</font><font color="#000080">-</font><font color="#800000">171194</font><font color="#000080">--</font><font color="#800000">72</font><font color="#000080">--</font><font color="#800000">85</font><font color="#000080">-</font><font color="#800000">08325</font><font color="#000080">-----</font>ASMGIF3<font color="#000080">.</font>OBJ<font color="#000080">--</font><font color="#800000">1</font><font color="#000080">-</font><font color="#FF0000"><b>OF</b></font><font color="#000080">--</font><font color="#800000">1
</font>U02<font color="#000080">+</font><font color="#800000">5</font>oAuL27EL2l7HplHJYR<font color="#000080">-</font>L3J5GINQEJBBFoZ4Amt<font color="#000080">-</font>IoogW0<font color="#000080">+++++</font>QJ5JmMawUELBnNKpW
P4Jm60<font color="#000080">-</font>KNL7nOKxi61AiAda67k<font color="#000080">-+</font>uJ6yMFoTEndQEZ<font color="#000080">-</font>QH2ZDL3BKFo3QJIR7FZl<font color="#000080">-</font>Iop5GIMn
<font color="#800000">9</font>Y3HHSS6<font color="#000080">+</font>k<font color="#000080">-+</font>uImK<font color="#000080">+</font>U<font color="#000080">++</font>O6U1<font color="#000080">+</font><font color="#800000">20</font>VZ7MH<font color="#000080">++</font>l<font color="#000080">-</font>Iop5GIMnLpF3K3E2Eox2FNuM<font color="#000080">-</font>k<font color="#000080">-</font><font color="#800000">6e</font>U<font color="#000080">+</font><font color="#800000">0</font><font color="#000080">+</font>k3d
ZUk<font color="#000080">+-</font>Jx2EJF<font color="#000080">--</font><font color="#800000">2</font>F<font color="#000080">-</font>J250a<font color="#000080">+</font>Q<font color="#000080">+</font>G<font color="#000080">+++-+</font>I<font color="#000080">-</font><font color="#800000">1</font>tM4<font color="#000080">++</font>F2EJF<font color="#000080">-</font>FdU5<font color="#000080">+</font><font color="#800000">4</font>U<font color="#000080">+++</font>M<font color="#000080">-+</font>T4K0<font color="#000080">++</font><font color="#800000">4</font>F2RGHpJE
Wtc2<font color="#000080">++</font>Tz<font color="#000080">+</font>ZeA0k<font color="#000080">+</font><font color="#800000">6</font>HaJsR27tR4I<font color="#000080">+</font><font color="#800000">9</font>cU2<font color="#000080">+</font><font color="#800000">21</font>U0YeA0k<font color="#000080">+</font><font color="#800000">6E</font>aZoQolZNbE<font color="#000080">+</font>F6U2<font color="#000080">+</font><font color="#800000">21</font>U0YeA1<font color="#000080">++</font><font color="#800000">7
</font>EbZoNLBANKNo<font color="#000080">+</font>Aq6<font color="#000080">-+-+</font>s<font color="#000080">+</font>d8X<font color="#000080">+</font>k<font color="#000080">+</font><font color="#800000">0</font>IZhMKRZF43oME<font color="#000080">+</font><font color="#800000">0</font>W<font color="#000080">+</font>E<font color="#000080">+</font>EC<font color="#000080">+</font><font color="#800000">8</font>Gck9<font color="#000080">++</font>V1RL7mEbZoNE<font color="#000080">+</font>l
W<font color="#000080">+</font>E<font color="#000080">+</font>EC<font color="#000080">+</font><font color="#800000">6</font>H6k7<font color="#000080">++</font>NmNLFjRL6<font color="#000080">+</font>l6U2<font color="#000080">+</font><font color="#800000">21</font>U12WA1k<font color="#000080">+</font>AErJmQYBjN4JHOLdZ<font color="#000080">+</font><font color="#800000">8</font>S6<font color="#000080">-+-+</font>s<font color="#000080">+</font>d8X<font color="#000080">+</font>g<font color="#000080">+
</font><font color="#800000">02</font>BjN4JBMLBf<font color="#000080">+</font><font color="#800000">3e6</font><font color="#000080">-+-+</font>s<font color="#000080">+</font>d8X<font color="#000080">-</font>E<font color="#000080">+</font><font color="#800000">2</font>LFbOKNTIaJVN3BpMY7gPqBf<font color="#000080">+</font><font color="#800000">9</font>K6<font color="#000080">-+-+</font>s<font color="#000080">+</font>d8Y<font color="#000080">+</font>w<font color="#000080">+++</font><font color="#800000">26
</font>HaJsR2BjN4I<font color="#000080">++++</font>yW<font color="#000080">+</font>I<font color="#000080">+</font>EC2R<font color="#000080">+</font><font color="#800000">1</font>K6<font color="#000080">-+-+</font>cU4FW<font color="#000080">+</font>I<font color="#000080">+</font>ECc2<font color="#000080">+</font><font color="#800000">2</font>K60<font color="#000080">+-+</font>slU<font color="#000080">+-</font>U<font color="#000080">+</font>e<font color="#000080">-</font>MU7<font color="#000080">+</font><font color="#800000">21</font>X4E<font color="#000080">++
+</font><font color="#800000">0E</font><font color="#000080">+</font><font color="#800000">1</font>sU7<font color="#000080">+</font><font color="#800000">21</font>X4U<font color="#000080">+++</font><font color="#800000">0E</font><font color="#000080">-</font><font color="#800000">1</font>MU9<font color="#000080">+</font><font color="#800000">21</font>X4k<font color="#000080">+++</font><font color="#800000">0</font>A<font color="#000080">++++</font>AW<font color="#000080">+</font>g<font color="#000080">+</font>ECAQ<font color="#000080">++++</font><font color="#800000">6</font>k<font color="#000080">+</font><font color="#800000">2</font><font color="#000080">++</font>S60k<font color="#000080">-+</font>slo<font color="#000080">++++</font>X
<font color="#000080">++</font><font color="#800000">2</font><font color="#000080">+</font><font color="#800000">0</font>MU9<font color="#000080">+</font><font color="#800000">21</font>X5U<font color="#000080">+++</font><font color="#800000">0</font>A<font color="#000080">+-</font>E<font color="#000080">+</font><font color="#800000">2</font>W<font color="#000080">+</font>c<font color="#000080">+</font>ECAT<font color="#000080">++</font><font color="#800000">6</font><font color="#000080">+</font><font color="#800000">3E</font>k<font color="#000080">+</font><font color="#800000">0</font>MUc<font color="#000080">+</font><font color="#800000">21</font>c<font color="#000080">+-</font>x1CZl0I3lAGIxQIpN5EJlJ
FoZ4L23HHIR7FXAiEJBBIXtV5SSIsk<font color="#000080">+++</font>G<font color="#000080">+++++</font>V<font color="#000080">++</font>A<font color="#000080">+</font><font color="#800000">6</font>U<font color="#000080">+</font><font color="#800000">4</font><font color="#000080">+</font><font color="#800000">0E</font><font color="#000080">+</font><font color="#800000">0</font>U<font color="#000080">+</font>Z<font color="#000080">++</font>o<font color="#000080">+</font><font color="#800000">7</font>U<font color="#000080">+</font>E<font color="#000080">+</font><font color="#800000">0</font>Y<font color="#000080">+</font><font color="#800000">3</font><font color="#000080">++</font>e
<font color="#000080">+-</font>I<font color="#000080">+</font><font color="#800000">8</font>k<font color="#000080">+</font>K<font color="#000080">+</font><font color="#800000">0</font>k<font color="#000080">+</font><font color="#800000">4E</font><font color="#000080">+</font>h<font color="#000080">+-</font>c<font color="#000080">+</font>A<font color="#000080">++</font>P<font color="#000080">+</font><font color="#800000">16</font><font color="#000080">+</font><font color="#800000">5</font>k<font color="#000080">+</font>n<font color="#000080">+</font><font color="#800000">0</font>A<font color="#000080">+</font>BE<font color="#000080">+</font>a<font color="#000080">+</font><font color="#800000">1</font>M<font color="#000080">+</font><font color="#800000">7</font>k<font color="#000080">+</font>r<font color="#000080">+</font><font color="#800000">0</font>g<font color="#000080">+</font>C<font color="#000080">++</font>l<font color="#000080">+</font><font color="#800000">1</font>g<font color="#000080">+</font>BE<font color="#000080">+</font>w<font color="#000080">+</font><font color="#800000">1</font>g<font color="#000080">+</font>DE<font color="#000080">+</font>y
<font color="#000080">+</font><font color="#800000">1</font>s<font color="#000080">+</font>EE<font color="#000080">+</font>z<font color="#000080">+</font><font color="#800000">2</font>I<font color="#000080">+</font>E<font color="#000080">+-</font><font color="#800000">5</font><font color="#000080">+</font><font color="#800000">22</font><font color="#000080">+</font>GU<font color="#000080">-</font><font color="#800000">0</font><font color="#000080">+</font><font color="#800000">2</font>k<font color="#000080">+</font>Ek<font color="#000080">-</font>D<font color="#000080">+</font><font color="#800000">2</font>M<font color="#000080">+</font>Ik<font color="#000080">-</font><font color="#800000">5</font><font color="#000080">+</font><font color="#800000">3</font>Q<font color="#000080">+</font>GE<font color="#000080">-</font>P<font color="#000080">+</font><font color="#800000">2</font>c<font color="#000080">+</font>M<font color="#000080">+-</font>A<font color="#000080">+</font><font color="#800000">4E</font><font color="#000080">+</font>HE<font color="#000080">-</font>Z<font color="#000080">+</font><font color="#800000">2</font>s<font color="#000080">+</font>NU<font color="#000080">-</font>D
<font color="#000080">+</font><font color="#800000">4</font>Y<font color="#000080">+</font>I<font color="#000080">+-</font>e<font color="#000080">+</font><font color="#800000">32</font><font color="#000080">+</font>Ok<font color="#000080">-</font>J<font color="#000080">+</font><font color="#800000">4</font>w<font color="#000080">+</font>Jk<font color="#000080">-</font>p<font color="#000080">+</font><font color="#800000">3</font>U<font color="#000080">+</font>SE<font color="#000080">-</font>N<font color="#000080">+</font><font color="#800000">5</font>k<font color="#000080">+</font>L<font color="#000080">+-</font>x<font color="#000080">+</font><font color="#800000">3</font>o<font color="#000080">+</font>U<font color="#000080">+-</font>T<font color="#000080">+</font><font color="#800000">6</font>A<font color="#000080">+</font>M<font color="#000080">+</font><font color="#800000">04</font><font color="#000080">+</font><font color="#800000">46</font><font color="#000080">+</font>WU<font color="#000080">-</font>Z<font color="#000080">+</font><font color="#800000">6</font>k<font color="#000080">+</font>NU0E
<font color="#000080">+</font><font color="#800000">4</font>Q<font color="#000080">+</font>Z<font color="#000080">+-</font>c<font color="#000080">+</font><font color="#800000">7</font>M<font color="#000080">+</font>OE0O<font color="#000080">+</font><font color="#800000">4</font>c<font color="#000080">+</font>bE<font color="#000080">-</font>f<font color="#000080">+</font><font color="#800000">82</font><font color="#000080">+</font>P<font color="#000080">+</font><font color="#800000">0</font>Y<font color="#000080">+</font><font color="#800000">4</font>s<font color="#000080">+</font>dk<font color="#000080">-</font>j<font color="#000080">+</font><font color="#800000">8</font>Y<font color="#000080">+</font>ZMUG<font color="#000080">+</font><font color="#800000">21</font>a02<font color="#000080">-+</font>IpJ7J2Im4E<font color="#000080">+++</font>Fg<font color="#000080">+
</font>lsUG<font color="#000080">+</font><font color="#800000">21</font>a02<font color="#000080">-+</font>IpJ7J2Il4E<font color="#000080">+++</font>HI<font color="#000080">+</font>fcUF<font color="#000080">+</font><font color="#800000">21</font>a<font color="#000080">-</font>o<font color="#000080">-+</font>JoV7H2IN<font color="#000080">+++-</font>Ik1IW<font color="#000080">-</font><font color="#800000">6</font><font color="#000080">+</font>ECM6E2<font color="#000080">-</font>HJIZI
FHEN<font color="#000080">+++-</font>Pk<font color="#000080">-</font>lW<font color="#000080">-++</font>ECM4E2<font color="#000080">-</font><font color="#800000">4</font>GIsm4E<font color="#000080">+++</font>Mk<font color="#000080">+-</font>sUG<font color="#000080">+</font><font color="#800000">21</font>a02t3K3F1HoF35E<font color="#000080">+++</font>E<font color="#000080">++</font>k80i<font color="#000080">++</font><font color="#800000">2</font><font color="#000080">+
+</font><font color="#800000">82</font><font color="#000080">++</font><font color="#800000">1</font>o<font color="#000080">++</font><font color="#800000">5</font>whY70V<font color="#000080">+++</font>x<font color="#000080">++-</font>z0N0EM3Tc<font color="#000080">++-</font>TMMgS<font color="#000080">++</font><font color="#800000">08</font>Vk<font color="#000080">++</font>cU<font color="#000080">++</font>EsYS<font color="#000080">++</font><font color="#800000">15</font><font color="#000080">-</font>U<font color="#000080">++</font><font color="#800000">0</font><font color="#000080">+</font><font color="#800000">1</font>z1U<font color="#000080">++
</font>NfU<font color="#000080">+++++</font>c<font color="#000080">+++</font>iEU<font color="#000080">+</font>WlM<font color="#000080">++</font><font color="#800000">0</font>j8NhDcWwdaWx095U<font color="#000080">++</font>CEs<font color="#000080">++</font><font color="#800000">5</font>snY701DU<font color="#000080">+++</font><font color="#800000">5</font>wBY7<font color="#000080">-</font>UJyU<font color="#000080">++</font><font color="#800000">3</font>xV
Wls<font color="#000080">++</font><font color="#800000">4</font>Os<font color="#000080">+++++</font><font color="#800000">6e5</font><font color="#000080">++</font><font color="#800000">0</font>W<font color="#000080">++-</font><font color="#800000">1</font>NhDUNUjEUw26zks<font color="#000080">++</font>Cj5WFs<font color="#000080">++</font><font color="#800000">6</font>gS<font color="#000080">+++</font>fmsYC<font color="#000080">++</font><font color="#800000">1</font><font color="#000080">-</font>sk8BDU<font color="#000080">++
</font>Ncg<font color="#000080">-</font>NWDEWw91Jdlo<font color="#000080">+</font>AE<font color="#000080">-</font><font color="#800000">3</font>U20l<font color="#000080">+</font>gK<font color="#000080">+</font>EC23kM<font color="#000080">-</font><font color="#800000">0</font>QER3U2<font color="#000080">-</font>l02K<font color="#000080">+</font>EH27<font color="#000080">-</font>M<font color="#000080">--</font>QEd3U2<font color="#000080">-</font>l0oK<font color="#000080">+</font>E92
AlM<font color="#000080">-+</font>wEw3U23l2AK<font color="#000080">+</font>E92IFM<font color="#000080">-+</font>QFJ3U25l3oK<font color="#000080">+</font>EC2NkM<font color="#000080">-</font><font color="#800000">0</font>QFh3U2<font color="#000080">-</font>l5QK<font color="#000080">+</font>EH2SVM<font color="#000080">--</font>QG63U21
l6sK<font color="#000080">+</font>E52YVM<font color="#000080">--</font>wGM3U20l7wK<font color="#000080">+</font>EVLWU6<font color="#000080">++</font><font color="#800000">5E</font><font color="#000080">+
***** </font><font color="#FF0000"><b>END OF </b></font>BLOCK <font color="#800000">1 </font><font color="#000080">*****

</font><font color="#008000"><i>{ cut here
----------------------------------------------------------------------------
}

</i></font><font color="#FF0000"><b>unit </b></font>usvesa<font color="#000080">;
</font><font color="#008000"><i>{
****************************************************************************

      Here is an other VESA unit !!!!!!

      It is based on various sources ( DVPEG,John Bridges VGAKIT,
    SWAG an many others ).
      You can use,modified an distribute this source as long as credit
    is given.


    Supported modes:
      - 256 colors
      - 32768 colors
      - 16 millions colors


    The demo program for this unit is DemoVesa.

                                              Lionel Cordesses
                                              From FRANCE.
                                              November 1994

****************************************************************************
}

{$f+}
</i></font><font color="#FF0000"><b>interface

uses </b></font>dos<font color="#000080">,</font>crt<font color="#000080">;


</font><font color="#FF0000"><b>var

  </b></font>use_16<font color="#000080">,</font>use_32<font color="#000080">:</font>boolean<font color="#000080">;
  </font>x_size<font color="#000080">:</font>word<font color="#000080">;

</font><font color="#FF0000"><b>function  </b></font>write_fast<font color="#000080">(</font>x1<font color="#000080">,</font>y<font color="#000080">,</font>x2<font color="#000080">:</font>word<font color="#000080">;</font><font color="#FF0000"><b>var </b></font>entree<font color="#000080">):</font>boolean<font color="#000080">;
</font><font color="#FF0000"><b>procedure </b></font>getpix_16<font color="#000080">(</font>x<font color="#000080">,</font>y<font color="#000080">:</font>word<font color="#000080">;</font><font color="#FF0000"><b>var </b></font>rouge<font color="#000080">,</font>vert<font color="#000080">,</font>bleu<font color="#000080">:</font>byte<font color="#000080">);
</font><font color="#FF0000"><b>procedure </b></font>find_black<font color="#000080">(</font>max_color<font color="#000080">:</font>word<font color="#000080">;</font><font color="#FF0000"><b>var </b></font>black<font color="#000080">,</font>white<font color="#000080">:</font>byte<font color="#000080">);
</font><font color="#FF0000"><b>function  </b></font>setmode<font color="#000080">(</font>mode<font color="#000080">:</font>word<font color="#000080">):</font>byte<font color="#000080">;  </font><font color="#008000"><i>{ return 0 if bad, 1 if OK }
</i></font><font color="#FF0000"><b>procedure </b></font>setpix<font color="#000080">(</font>x<font color="#000080">,</font>y<font color="#000080">,</font>col<font color="#000080">:</font>word<font color="#000080">);
</font><font color="#FF0000"><b>procedure </b></font>setpix_16<font color="#000080">(</font>x<font color="#000080">,</font>y<font color="#000080">:</font>word<font color="#000080">;</font>rouge<font color="#000080">,</font>vert<font color="#000080">,</font>bleu<font color="#000080">:</font>byte<font color="#000080">);
</font><font color="#FF0000"><b>function  </b></font>getpix<font color="#000080">(</font>x<font color="#000080">,</font>y<font color="#000080">:</font>word<font color="#000080">):</font>byte<font color="#000080">;
</font><font color="#FF0000"><b>procedure </b></font>wrtxt<font color="#000080">(</font>x<font color="#000080">,</font>y<font color="#000080">:</font>word<font color="#000080">;</font>txt<font color="#000080">:</font><font color="#FF0000"><b>string</b></font><font color="#000080">);</font><font color="#008000"><i>{write TXT to pos (X,Y)}







</i></font><font color="#FF0000"><b>implementation


var
  </b></font>reg<font color="#000080">:</font>registers<font color="#000080">;
  </font>vgran<font color="#000080">,</font>curbank<font color="#000080">:</font>word<font color="#000080">;
  </font>add_bank<font color="#000080">:</font><font color="#FF0000"><b>procedure</b></font><font color="#000080">;
  </font>tps1<font color="#000080">,</font>tps2<font color="#000080">:</font>longint<font color="#000080">;
  </font>heure<font color="#000080">,</font>minute<font color="#000080">,</font>seconde<font color="#000080">,</font>sec100<font color="#000080">:</font>word<font color="#000080">;





</font><font color="#008000"><i>{$ifdef msdos}
</i></font><font color="#FF0000"><b>procedure </b></font>setbank<font color="#000080">(</font>bank<font color="#000080">:</font>byte<font color="#000080">);</font><font color="#FF0000"><b>far</b></font><font color="#000080">;
</font><font color="#FF0000"><b>var </b></font>banque<font color="#000080">:</font>word<font color="#000080">;
  </font><font color="#FF0000"><b>begin
    </b></font>banque<font color="#000080">:=</font>bank<font color="#000080">*</font>longint<font color="#000080">(</font><font color="#800000">64</font><font color="#000080">) </font><font color="#FF0000"><b>div </b></font>vgran<font color="#000080">;
    </font><font color="#FF0000"><b>asm
      </b></font><font color="#FF00FF">mov bl, 0
      mov dx, banque
      call  [add_bank]
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font>curbank<font color="#000080">:=</font>bank<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{$else}

</i></font><font color="#FF0000"><b>procedure </b></font>setbank<font color="#000080">(</font>bank<font color="#000080">:</font>byte<font color="#008000"><i>{word}</i></font><font color="#000080">);</font><font color="#FF0000"><b>far</b></font><font color="#000080">;
</font><font color="#FF0000"><b>var </b></font>banque<font color="#000080">:</font>word<font color="#000080">;

  </font><font color="#FF0000"><b>begin
             </b></font>reg<font color="#000080">.</font>ax<font color="#000080">:=</font><font color="#800000">$4f05</font><font color="#000080">;
             </font>reg<font color="#000080">.</font>bx<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
             </font>reg<font color="#000080">.</font>dx<font color="#000080">:=</font>bank<font color="#000080">*</font>longint<font color="#000080">(</font><font color="#800000">64</font><font color="#000080">) </font><font color="#FF0000"><b>div </b></font>vgran<font color="#000080">;

             </font>intr<font color="#000080">(</font><font color="#800000">$10</font><font color="#000080">,</font>reg<font color="#000080">);
             </font>reg<font color="#000080">.</font>ax<font color="#000080">:=</font><font color="#800000">$4f05</font><font color="#000080">;
             </font>reg<font color="#000080">.</font>bx<font color="#000080">:=</font><font color="#800000">1</font><font color="#000080">;
             </font>intr<font color="#000080">(</font><font color="#800000">$10</font><font color="#000080">,</font>reg<font color="#000080">);

  </font>curbank<font color="#000080">:=</font><font color="#800000">255</font><font color="#000080">;</font><font color="#008000"><i>{bank;}
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#008000"><i>{$endif}

</i></font><font color="#FF0000"><b>function </b></font>setvesa<font color="#000080">(</font>mode<font color="#000080">:</font>word<font color="#000080">):</font>byte<font color="#000080">;

  </font><font color="#FF0000"><b>begin
    asm
     </b></font><font color="#FF00FF">mov ax,4F02h
     mov bx,mode
     int 10h
     sub ax,004Fh
</font><font color="#008000"><i>(*     mov al,0
     cmp ah,1   { if ah=1 that is bad ==&gt;false }
     je  @fin
     mov al,1  {false }
   @fin:*)

     </i></font><font color="#FF00FF">mov @RESULT,al
   </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#008000"><i>{   reg.ax:=$4f02;
   reg.bx:=mode;
   intr($10,reg);
   setvesa:=reg.al;}
{  textmode(co80);
  write(reg.ah,' ',reg.al);
  readln;}

  </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;



</font><font color="#008000"><i>{$ifdef msdos}
</i></font><font color="#FF0000"><b>function </b></font>setmode<font color="#000080">(</font>mode<font color="#000080">:</font>word<font color="#000080">):</font>byte<font color="#000080">;  </font><font color="#008000"><i>{ 0 if bad,1 if OK}
</i></font><font color="#FF0000"><b>type </b></font>type_vesarec<font color="#000080">=</font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">555</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">;
     </font>ves_ptr<font color="#000080">=^</font>type_vesarec<font color="#000080">;

</font><font color="#FF0000"><b>type
  </b></font>long<font color="#000080">=</font><font color="#FF0000"><b>record
         </b></font>lo<font color="#000080">,</font>hi<font color="#000080">:</font>word<font color="#000080">;
       </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>var </b></font>pro<font color="#000080">:</font>byte<font color="#000080">;
    </font>vesarec<font color="#000080">:</font>ves_ptr<font color="#000080">;

    </font>vesa_info<font color="#000080">:</font><font color="#FF0000"><b>record
      </b></font>debut<font color="#000080">:</font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">3</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">;
      </font>granularite<font color="#000080">:</font>word<font color="#000080">;
      </font>winsize<font color="#000080">,
      </font>winaseg<font color="#000080">,
      </font>winbseg<font color="#000080">:</font>word<font color="#000080">;
      </font>add_proc<font color="#000080">:</font><font color="#FF0000"><b>procedure</b></font><font color="#000080">;
      </font>bytes<font color="#000080">:</font>word<font color="#000080">;
      </font>width<font color="#000080">,
      </font>height<font color="#000080">:</font>word<font color="#000080">;
      </font>reste<font color="#000080">:</font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">250</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;


  </font><font color="#FF0000"><b>begin
    </b></font>setmode<font color="#000080">:=</font><font color="#800000">1</font><font color="#000080">;
    </font>getmem<font color="#000080">(</font>vesarec<font color="#000080">,</font><font color="#800000">556</font><font color="#000080">);
    </font>pro<font color="#000080">:=</font>setvesa<font color="#000080">(</font>mode<font color="#000080">);
    </font>fillchar<font color="#000080">(</font>vesarec<font color="#000080">^[</font><font color="#800000">0</font><font color="#000080">],</font><font color="#800000">256</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">); </font><font color="#008000"><i>{ set all to zero  }

      </i></font>reg<font color="#000080">.</font>ax<font color="#000080">:=</font><font color="#800000">$4f01</font><font color="#000080">;
      </font>reg<font color="#000080">.</font>cx<font color="#000080">:=</font>mode<font color="#000080">;
      </font>reg<font color="#000080">.</font>es<font color="#000080">:=</font>long<font color="#000080">(</font>vesarec<font color="#000080">).</font>hi<font color="#000080">;
      </font>reg<font color="#000080">.</font>di<font color="#000080">:=</font>long<font color="#000080">(</font>vesarec<font color="#000080">).</font>lo<font color="#000080">;

      </font>intr<font color="#000080">(</font><font color="#800000">$10</font><font color="#000080">,</font>reg<font color="#000080">);
      </font><font color="#FF0000"><b>if </b></font>reg<font color="#000080">.</font>ah<font color="#000080">=</font><font color="#800000">0 </font><font color="#FF0000"><b>then
        begin
          </b></font>setmode<font color="#000080">:=</font><font color="#800000">1</font><font color="#000080">;
          </font>pro<font color="#000080">:=</font><font color="#800000">1</font><font color="#000080">;
        </font><font color="#FF0000"><b>end
      else
        begin
          </b></font>setmode<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
          </font>pro<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
        </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

      </font>move<font color="#000080">(</font>vesarec<font color="#000080">^[</font><font color="#800000">0</font><font color="#000080">],</font>vesa_info<font color="#000080">.</font>debut<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">],</font><font color="#800000">256</font><font color="#000080">);
      </font><font color="#FF0000"><b>if </b></font>reg<font color="#000080">.</font>al<font color="#000080">=</font><font color="#800000">0 </font><font color="#FF0000"><b>then
        begin
          </b></font>setmode<font color="#000080">:=</font><font color="#800000">1</font><font color="#000080">;
          </font>pro<font color="#000080">:=</font><font color="#800000">1</font><font color="#000080">;
        </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font>vgran<font color="#000080">:=</font>vesa_info<font color="#000080">.</font>granularite<font color="#000080">;
      </font>x_size<font color="#000080">:=</font>vesa_info<font color="#000080">.</font>width<font color="#000080">;                 </font><font color="#008000"><i>{ nb pt per lines }
      </i></font>add_bank<font color="#000080">:=</font>vesa_info<font color="#000080">.</font>add_proc<font color="#000080">;        </font><font color="#008000"><i>{ change bank far ptr }

    </i></font>freemem<font color="#000080">(</font>vesarec<font color="#000080">,</font><font color="#800000">556</font><font color="#000080">);

    </font>use_16<font color="#000080">:=</font>false<font color="#000080">;
    </font>use_32<font color="#000080">:=</font>false<font color="#000080">;
    </font><font color="#FF0000"><b>if </b></font>mode<font color="#000080">=</font><font color="#800000">$112 </font><font color="#FF0000"><b>then </b></font>use_16<font color="#000080">:=</font>true<font color="#000080">;
    </font><font color="#FF0000"><b>if </b></font>mode<font color="#000080">=</font><font color="#800000">$110 </font><font color="#FF0000"><b>then </b></font>use_32<font color="#000080">:=</font>true<font color="#000080">;




  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#008000"><i>{$endif}

</i></font><font color="#FF0000"><b>procedure </b></font>setpix<font color="#000080">(</font>x<font color="#000080">,</font>y<font color="#000080">,</font>col<font color="#000080">:</font>word<font color="#000080">);</font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>var  </b></font>decalage<font color="#000080">:</font>word<font color="#000080">;
      </font><font color="#FF0000"><b>asm
 </b></font><font color="#FF00FF">mov bx,x
 mov ax,y </font><font color="#008000"><i>{removed all range checking on x,y for speed}
 </i></font><font color="#FF00FF">mul x_size </font><font color="#008000"><i>{640 bytes wide in most cases}
 </i></font><font color="#FF00FF">add bx,ax
 adc dx,0
 mov ax, dx </font><font color="#008000"><i>{ what a $#%%# stupid microprocessor}
 </i></font><font color="#FF00FF">adc ax, 0

        </font><font color="#008000"><i>{mov provi,al}   { bank  }
        </i></font><font color="#FF00FF">mov decalage,bx
        cmp ax,curbank
        jz @nonew
        mov ah,0
        push cs
        push ax
        call  far ptr setbank   </font><font color="#008000"><i>{ here ax = bank }
        </i></font><font color="#FF00FF">@nonew:

          mov bx,col
          mov ax,sega000
          mov es,ax
          mov di,decalage
          mov [es:di],bl
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>getpix_16<font color="#000080">(</font>x<font color="#000080">,</font>y<font color="#000080">:</font>word<font color="#000080">;</font><font color="#FF0000"><b>var </b></font>rouge<font color="#000080">,</font>vert<font color="#000080">,</font>bleu<font color="#000080">:</font>byte<font color="#000080">);</font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>var </b></font>l<font color="#000080">:</font>longint<font color="#000080">;
    </font>provi<font color="#000080">:</font>byte<font color="#000080">;
    </font>couleur<font color="#000080">,</font>decalage<font color="#000080">:</font>word<font color="#000080">;

      </font><font color="#FF0000"><b>asm
        </b></font><font color="#FF00FF">mov al,use_16
        cmp al,0
        je @v32000

 mov bx,x
        mov ax,bx
        shl bx,1
        add bx,ax       </font><font color="#008000"><i>{ x*3 }
 </i></font><font color="#FF00FF">mov ax,y </font><font color="#008000"><i>{removed all range checking on x,y for speed}
        </i></font><font color="#FF00FF">shl ax,1
        add ax,y        </font><font color="#008000"><i>{ y*3 }
 </i></font><font color="#FF00FF">mul x_size </font><font color="#008000"><i>{640 bytes wide in most cases}
 </i></font><font color="#FF00FF">add bx,ax
 adc dx,0
 mov ax, dx </font><font color="#008000"><i>{ what a $#%%# stupid microprocessor}
 </i></font><font color="#FF00FF">adc ax, 0

        mov provi,al   </font><font color="#008000"><i>{ bank  }
        </i></font><font color="#FF00FF">mov decalage,bx
        cmp ax,curbank
        jz @nonewa
        mov ah,0
        push cs
        push ax
        call  far ptr setbank   </font><font color="#008000"><i>{ here ax= bank }
        </i></font><font color="#FF00FF">@nonewa:

          mov ax,sega000
          mov es,ax
          mov di,decalage
          mov bl,[es:di]
          les di,bleu
          mov byte ptr [es:di],bl

        add decalage,1
        mov ah,0
        mov al,provi
        adc ax,0
        mov provi,al
        cmp ax,curbank
        jz @nonew1
        mov ah,0
        push cs
        push ax
        call  far ptr setbank   </font><font color="#008000"><i>{  ax = bank }
        </i></font><font color="#FF00FF">@nonew1:

          mov ax,sega000
          mov es,ax
          mov di,decalage
          mov bl,[es:di]
          les di,vert
          mov byte ptr [es:di],bl

        add decalage,1
        mov ah,0
        mov al,provi
        adc ax,0
        cmp ax,curbank
        jz @nonew2
        mov ah,0
        push cs
        push ax
        call  far ptr setbank   </font><font color="#008000"><i>{  ax= bank }
        </i></font><font color="#FF00FF">@nonew2:

          mov ax,sega000
          mov es,ax
          mov di,decalage
          mov bl,[es:di]
          les di,rouge
          mov byte ptr [es:di],bl

          jmp @fin

      @v32000:
 mov bx,x
 mov ax,y </font><font color="#008000"><i>{removed all range checking on x,y for speed}
 </i></font><font color="#FF00FF">mul x_size </font><font color="#008000"><i>{640 bytes wide in most cases}
 </i></font><font color="#FF00FF">add bx,ax
 adc dx,0
 mov ax, dx </font><font color="#008000"><i>{ what a $#%%# stupid microprocessor}
 </i></font><font color="#FF00FF">shl ax, 1
 shl bx, 1
 adc ax, 0   </font><font color="#008000"><i>{ pour untiliser un eventuel carry
                          positionne par precedent ADD }

        </i></font><font color="#FF00FF">mov provi,al   </font><font color="#008000"><i>{ bank  }
        </i></font><font color="#FF00FF">mov decalage,bx
        cmp ax,curbank
        je @nonew
</font><font color="#008000"><i>{        mov ah,0}
        </i></font><font color="#FF00FF">push cs
        push ax
        call  far ptr setbank   </font><font color="#008000"><i>{  ax = bank }
        </i></font><font color="#FF00FF">@nonew:


        mov ax,sega000
        mov es,ax
        mov di,decalage
        mov bx,[es:di]
        mov al,bl
        and al,31
        shl al,3
        les di,bleu
        mov byte ptr [es:di],al
        shr bx,5
        mov al,bl
        and al,31
        shl al,3
        les di,vert
        mov byte ptr [es:di],al
        shr bx,5
        mov al,bl
        and al,31
        shl al,3
        les di,rouge
        mov byte ptr [es:di],al

        @fin:
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;



</font><font color="#FF0000"><b>procedure </b></font>setpix_16<font color="#000080">(</font>x<font color="#000080">,</font>y<font color="#000080">:</font>word<font color="#000080">;</font>rouge<font color="#000080">,</font>vert<font color="#000080">,</font>bleu<font color="#000080">:</font>byte<font color="#000080">);
</font><font color="#FF0000"><b>var </b></font>l<font color="#000080">:</font>longint<font color="#000080">;
    </font>provi<font color="#000080">:</font>byte<font color="#000080">;
    </font>couleur<font color="#000080">,</font>decalage<font color="#000080">:</font>word<font color="#000080">;
  </font><font color="#FF0000"><b>begin
    if </b></font>use_16<font color="#000080">=</font>true <font color="#FF0000"><b>then
      asm

 </b></font><font color="#FF00FF">mov bx,x
        mov ax,bx
        shl bx,1
        add bx,ax       </font><font color="#008000"><i>{ x*3 }
 </i></font><font color="#FF00FF">mov ax,y </font><font color="#008000"><i>{removed all range checking on x,y for speed}
        </i></font><font color="#FF00FF">shl ax,1
        add ax,y        </font><font color="#008000"><i>{ y*3 }
 </i></font><font color="#FF00FF">mul x_size </font><font color="#008000"><i>{640 bytes wide in most cases}
 </i></font><font color="#FF00FF">add bx,ax
 adc dx,0
 mov ax, dx </font><font color="#008000"><i>{ what a $#%%# stupid microprocessor}
 </i></font><font color="#FF00FF">adc ax, 0

        mov provi,al   </font><font color="#008000"><i>{ bank  }
        </i></font><font color="#FF00FF">mov decalage,bx
        cmp ax,curbank
        jz @nonew
        mov ah,0
        push cs
        push ax
        call  far ptr setbank   </font><font color="#008000"><i>{ ax= bank }
        </i></font><font color="#FF00FF">@nonew:

          mov bl,bleu
          mov ax,sega000
          mov es,ax
          mov di,decalage
          mov [es:di],bl

        add decalage,1
        mov ah,0
        mov al,provi
        adc ax,0
        mov provi,al
        cmp ax,curbank
        jz @nonew1
        mov ah,0
        push cs
        push ax
        call  far ptr setbank   </font><font color="#008000"><i>{  ax= bank }
        </i></font><font color="#FF00FF">@nonew1:

          mov bl,vert
          mov ax,sega000
          mov es,ax
          mov di,decalage
          mov [es:di],bl

        add decalage,1
        mov ah,0
        mov al,provi
        adc ax,0
        cmp ax,curbank
        jz @nonew2
        mov ah,0
        push cs
        push ax
        call  far ptr setbank   </font><font color="#008000"><i>{ ax= bank }
        </i></font><font color="#FF00FF">@nonew2:

          mov bl,rouge
          mov ax,sega000
          mov es,ax
          mov di,decalage
          mov [es:di],bl


      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>if </b></font>use_32<font color="#000080">=</font>true <font color="#FF0000"><b>then
      asm
 </b></font><font color="#FF00FF">mov bx,x
 mov ax,y </font><font color="#008000"><i>{removed all range checking on x,y for speed}
 </i></font><font color="#FF00FF">mul x_size </font><font color="#008000"><i>{640 bytes wide in most cases}
 </i></font><font color="#FF00FF">add bx,ax
 adc dx,0
 mov ax, dx </font><font color="#008000"><i>{ what a $#%%# stupid microprocessor}
 </i></font><font color="#FF00FF">shl ax, 1
 shl bx, 1
 adc ax, 0   </font><font color="#008000"><i>{ pour untiliser un eventuel carry
                          positionne par precedent ADD }

        </i></font><font color="#FF00FF">mov provi,al   </font><font color="#008000"><i>{ bank  }
        </i></font><font color="#FF00FF">mov decalage,bx
        cmp ax,curbank
        je @nonew
</font><font color="#008000"><i>{        mov ah,0}
        </i></font><font color="#FF00FF">push cs
        push ax
        call  far ptr setbank   </font><font color="#008000"><i>{  ax= bank }
        </i></font><font color="#FF00FF">@nonew:


        mov al,rouge
        shr al,3
        mov ah,0
        shl ax,10
        mov bl,vert
        shr bl,3
        mov bh,0
        shl bx,5
        add ax,bx
        mov bl,bleu
        shr bl,3
        mov bh,0
        add bx,ax
        mov ax,sega000
        mov es,ax
        mov di,decalage
        mov [es:di],bx
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>Move16<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>Source<font color="#000080">,</font>Dest<font color="#000080">;</font>Count<font color="#000080">:</font>Word<font color="#000080">); </font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Asm
  </b></font><font color="#FF00FF">PUSH DS
  LDS SI,SOURCE
  LES DI,DEST
  MOV AX,COUNT
  MOV CX,AX
  SHR CX,1
  REP MOVSW
  TEST AX,1
  JZ @</font><font color="#FF0000"><b>end
  </b></font>MOVSB
<font color="#000080">@</font><font color="#FF0000"><b>end</b></font><font color="#000080">:</font>POP DS
<font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>function </b></font>write_fast<font color="#000080">(</font>x1<font color="#000080">,</font>y<font color="#000080">,</font>x2<font color="#000080">:</font>word<font color="#000080">;</font><font color="#FF0000"><b>var </b></font>entree<font color="#000080">):</font>boolean<font color="#000080">;

</font><font color="#FF0000"><b>var </b></font>coord1<font color="#000080">,</font>coord2<font color="#000080">:</font>longint<font color="#000080">;
    </font>couleur<font color="#000080">:</font>byte<font color="#000080">;
  </font><font color="#FF0000"><b>begin
    </b></font>write_fast<font color="#000080">:=</font>false<font color="#000080">;
    </font>coord1<font color="#000080">:=</font>longint<font color="#000080">(</font>y<font color="#000080">)*</font>longint<font color="#000080">(</font>x_size<font color="#000080">)+</font>x1<font color="#000080">;
    </font>coord2<font color="#000080">:=</font>coord1<font color="#000080">+</font>longint<font color="#000080">((</font>x2<font color="#000080">-</font>x1<font color="#000080">)+</font><font color="#800000">1</font><font color="#000080">);
    </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>coord1 <font color="#FF0000"><b>shr </b></font><font color="#800000">16</font><font color="#000080">)&lt;&gt; </font>curbank <font color="#FF0000"><b>then  </b></font>setbank<font color="#000080">(</font>coord1 <font color="#FF0000"><b>shr </b></font><font color="#800000">16</font><font color="#000080">);
    </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>coord1 <font color="#FF0000"><b>shr </b></font><font color="#800000">16</font><font color="#000080">)=(</font>coord2 <font color="#FF0000"><b>shr </b></font><font color="#800000">16</font><font color="#000080">) </font><font color="#FF0000"><b>then
      begin
         </b></font>move16<font color="#000080">(</font>entree<font color="#000080">,</font>mem<font color="#000080">[</font>sega000<font color="#000080">:(</font>coord1 <font color="#FF0000"><b>mod </b></font><font color="#800000">65536</font><font color="#000080">)],(</font>x2<font color="#000080">-</font>x1<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">));
         </font>write_fast<font color="#000080">:=</font>true<font color="#000080">;
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>function </b></font>donne_heure<font color="#000080">:</font>longint<font color="#000080">;
</font><font color="#FF0000"><b>var </b></font>heure<font color="#000080">,</font>minute<font color="#000080">,</font>seconde<font color="#000080">,</font>sec100<font color="#000080">:</font>word<font color="#000080">;
  </font><font color="#FF0000"><b>begin
    </b></font>gettime<font color="#000080">(</font>heure<font color="#000080">,</font>minute<font color="#000080">,</font>seconde<font color="#000080">,</font>sec100<font color="#000080">);
    </font>donne_heure<font color="#000080">:=</font>heure<font color="#000080">*</font><font color="#800000">3600</font><font color="#000080">*</font><font color="#800000">100</font><font color="#000080">+</font>minute<font color="#000080">*</font><font color="#800000">60</font><font color="#000080">*</font><font color="#800000">100</font><font color="#000080">+</font>seconde<font color="#000080">*</font><font color="#800000">100</font><font color="#000080">+</font>sec100<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;




</font><font color="#FF0000"><b>procedure </b></font>find_black<font color="#000080">(</font>max_color<font color="#000080">:</font>word<font color="#000080">;</font><font color="#FF0000"><b>var </b></font>black<font color="#000080">,</font>white<font color="#000080">:</font>byte<font color="#000080">);
</font><font color="#FF0000"><b>var </b></font>luminance<font color="#000080">,</font>n<font color="#000080">:</font>byte<font color="#000080">;
    </font>reg<font color="#000080">:</font>registers<font color="#000080">;
    </font>table<font color="#000080">:</font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">767</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">;
    </font>i<font color="#000080">,</font>x<font color="#000080">,</font>y<font color="#000080">:</font>word<font color="#000080">;

  </font><font color="#FF0000"><b>begin
       with </b></font>reg <font color="#FF0000"><b>do
         begin
           </b></font>ah<font color="#000080">:=</font><font color="#800000">$10</font><font color="#000080">;
           </font>al<font color="#000080">:=</font><font color="#800000">$17</font><font color="#000080">;
           </font>bx<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
           </font>cx<font color="#000080">:=</font>max_color<font color="#000080">;
           </font>es<font color="#000080">:=</font>seg<font color="#000080">(</font>table<font color="#000080">);
           </font>dx<font color="#000080">:=</font>ofs<font color="#000080">(</font>table<font color="#000080">);
           </font>intr<font color="#000080">(</font><font color="#800000">$10</font><font color="#000080">,</font>reg<font color="#000080">);
         </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font>i<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
    </font>white<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
    </font>black<font color="#000080">:=</font><font color="#800000">255</font><font color="#000080">;
    </font><font color="#FF0000"><b>for </b></font>n<font color="#000080">:=</font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font>max_color<font color="#000080">-</font><font color="#800000">1 </font><font color="#FF0000"><b>do
      begin
        </b></font>luminance<font color="#000080">:=</font>round<font color="#000080">(((</font><font color="#800000">0.59</font><font color="#000080">*</font>table<font color="#000080">[</font>i<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">])+(</font><font color="#800000">0.3</font><font color="#000080">*</font>table<font color="#000080">[</font>i<font color="#000080">])+
        (</font><font color="#800000">0.11</font><font color="#000080">*</font>table<font color="#000080">[</font>i<font color="#000080">+</font><font color="#800000">2</font><font color="#000080">])));
        </font><font color="#FF0000"><b>if </b></font>luminance<font color="#000080">&gt;</font>white <font color="#FF0000"><b>then
          begin
            </b></font>white<font color="#000080">:=</font>luminance<font color="#000080">;
            </font>x<font color="#000080">:=</font>n<font color="#000080">;
          </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
        </font><font color="#FF0000"><b>if </b></font>luminance<font color="#000080">&lt;</font>black <font color="#FF0000"><b>then
          begin
            </b></font>black<font color="#000080">:=</font>luminance<font color="#000080">;
            </font>y<font color="#000080">:=</font>n<font color="#000080">;
          </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
        </font>inc<font color="#000080">(</font>i<font color="#000080">,</font><font color="#800000">3</font><font color="#000080">);
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font>i<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
    </font>black<font color="#000080">:=</font>y<font color="#000080">;
    </font>white<font color="#000080">:=</font>x<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>procedure </b></font>wrtxt<font color="#000080">(</font>x<font color="#000080">,</font>y<font color="#000080">:</font>word<font color="#000080">;</font>txt<font color="#000080">:</font><font color="#FF0000"><b>string</b></font><font color="#000080">);</font><font color="#008000"><i>{write TXT to pos (X,Y)}
</i></font><font color="#FF0000"><b>type
  </b></font>pchar<font color="#000080">=</font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font>char<font color="#000080">] </font><font color="#FF0000"><b>of array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">15</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">;
</font><font color="#FF0000"><b>var
  </b></font>p<font color="#000080">:^</font>pchar<font color="#000080">;
  </font>c<font color="#000080">:</font>char<font color="#000080">;
  </font>i<font color="#000080">,</font>j<font color="#000080">,</font>z<font color="#000080">,</font>b<font color="#000080">:</font>integer<font color="#000080">;
  </font>noir<font color="#000080">,</font>blanc<font color="#000080">:</font>byte<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>reg<font color="#000080">.</font>ax<font color="#000080">:=</font><font color="#800000">$1130</font><font color="#000080">;
  </font>reg<font color="#000080">.</font>bh<font color="#000080">:=</font><font color="#800000">6</font><font color="#000080">;
  </font>intr<font color="#000080">(</font><font color="#800000">$10</font><font color="#000080">,</font>reg<font color="#000080">);
  </font>p<font color="#000080">:=</font>ptr<font color="#000080">(</font>reg<font color="#000080">.</font>es<font color="#000080">,</font>reg<font color="#000080">.</font>bp<font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>use_16<font color="#000080">=</font>false<font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>use_32<font color="#000080">=</font>false<font color="#000080">) </font><font color="#FF0000"><b>then
    </b></font>find_black<font color="#000080">(</font><font color="#800000">256</font><font color="#000080">,</font>noir<font color="#000080">,</font>blanc<font color="#000080">)
  </font><font color="#FF0000"><b>else
    begin
      </b></font>noir<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
      </font>blanc<font color="#000080">:=</font><font color="#800000">255</font><font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>for </b></font>z<font color="#000080">:=</font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>length<font color="#000080">(</font>txt<font color="#000080">) </font><font color="#FF0000"><b>do
      begin
        </b></font>c<font color="#000080">:=</font>txt<font color="#000080">[</font>z<font color="#000080">];
        </font><font color="#FF0000"><b>for </b></font>j<font color="#000080">:=</font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font><font color="#800000">15 </font><font color="#FF0000"><b>do
        begin
          </b></font>b<font color="#000080">:=</font>p<font color="#000080">^[</font>c<font color="#000080">][</font>j<font color="#000080">];
          </font><font color="#FF0000"><b>for </b></font>i<font color="#000080">:=</font>x<font color="#000080">+</font><font color="#800000">7 </font><font color="#FF0000"><b>downto </b></font>x <font color="#FF0000"><b>do
          begin
            if </b></font><font color="#000080">(</font>use_16<font color="#000080">=</font>false<font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>use_32<font color="#000080">=</font>false<font color="#000080">)  </font><font color="#FF0000"><b>then
              begin
                if </b></font>odd<font color="#000080">(</font>b<font color="#000080">) </font><font color="#FF0000"><b>then </b></font>setpix<font color="#000080">(</font>i<font color="#000080">,</font>y<font color="#000080">+</font>j<font color="#000080">,</font>blanc<font color="#000080">)
                          </font><font color="#FF0000"><b>else </b></font>setpix<font color="#000080">(</font>i<font color="#000080">,</font>y<font color="#000080">+</font>j<font color="#000080">,</font>noir<font color="#000080">);
              </font><font color="#FF0000"><b>end
            else
              begin
                if </b></font>odd<font color="#000080">(</font>b<font color="#000080">) </font><font color="#FF0000"><b>then </b></font>setpix_16<font color="#000080">(</font>i<font color="#000080">,</font>y<font color="#000080">+</font>j<font color="#000080">,</font>blanc<font color="#000080">,</font>blanc<font color="#000080">,</font>blanc<font color="#000080">)
                          </font><font color="#FF0000"><b>else </b></font>setpix_16<font color="#000080">(</font>i<font color="#000080">,</font>y<font color="#000080">+</font>j<font color="#000080">,</font>noir<font color="#000080">,</font>noir<font color="#000080">,</font>noir<font color="#000080">);
              </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

            </font>b<font color="#000080">:=</font>b <font color="#FF0000"><b>shr </b></font><font color="#800000">1</font><font color="#000080">;
          </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
        </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
        </font>inc<font color="#000080">(</font>x<font color="#000080">,</font><font color="#800000">8</font><font color="#000080">);
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>getpix<font color="#000080">(</font>x<font color="#000080">,</font>y<font color="#000080">:</font>word<font color="#000080">):</font>byte<font color="#000080">;</font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>var  </b></font>decalage<font color="#000080">:</font>word<font color="#000080">;
      </font><font color="#FF0000"><b>asm
 </b></font><font color="#FF00FF">mov bx,x
 mov ax,y </font><font color="#008000"><i>{removed all range checking on x,y for speed}
 </i></font><font color="#FF00FF">mul x_size </font><font color="#008000"><i>{640 bytes wide in most cases}
 </i></font><font color="#FF00FF">add bx,ax
 adc dx,0
 mov ax, dx </font><font color="#008000"><i>{ what a $#%%# stupid microprocessor}
 </i></font><font color="#FF00FF">adc ax, 0

        </font><font color="#008000"><i>{mov provi,al}   { bank  }
        </i></font><font color="#FF00FF">mov decalage,bx
        cmp ax,curbank
        jz @nonew
        mov ah,0
        push cs
        push ax
        call  far ptr setbank   </font><font color="#008000"><i>{ ax= bank }
        </i></font><font color="#FF00FF">@nonew:

          mov ax,sega000
          mov es,ax
          mov di,decalage
          mov al,[es:di]
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>end</b></font><font color="#000080">.


</font><font color="#008000"><i>{
  This is the second part of a message for SWAG dealing with VESA
cards.

{
****************************************************************************

      Here is an other VESA unit !!!!!!

      It is based on various sources ( DVPEG,John Bridges VGAKIT,
    SWAG an many others ).
      You can use,modified an distribute this source as long as credit
    is given.


    Supported modes:
      - 256 colors
      - 32768 colors
      - 16 millions colors


    The demo program for this unit is DemoVesa.

                                              Lionel Cordesses
                                              From FRANCE.
                                              November 1994

    E-Mail:
      cordesse@opgc.univ-bpclermont.fr

****************************************************************************
}
</i></font><font color="#FF0000"><b>unit </b></font>usvesa<font color="#000080">;
</font><font color="#008000"><i>{$f+}
</i></font><font color="#FF0000"><b>interface

uses </b></font>dos<font color="#000080">,</font>crt<font color="#000080">;


</font><font color="#FF0000"><b>var

  </b></font>use_16<font color="#000080">,</font>use_32<font color="#000080">:</font>boolean<font color="#000080">;
  </font>x_size<font color="#000080">:</font>word<font color="#000080">;

</font><font color="#FF0000"><b>function  </b></font>write_fast<font color="#000080">(</font>x1<font color="#000080">,</font>y<font color="#000080">,</font>x2<font color="#000080">:</font>word<font color="#000080">;</font><font color="#FF0000"><b>var </b></font>entree<font color="#000080">):</font>boolean<font color="#000080">;
</font><font color="#FF0000"><b>procedure </b></font>getpix_16<font color="#000080">(</font>x<font color="#000080">,</font>y<font color="#000080">:</font>word<font color="#000080">;</font><font color="#FF0000"><b>var </b></font>rouge<font color="#000080">,</font>vert<font color="#000080">,</font>bleu<font color="#000080">:</font>byte<font color="#000080">);
</font><font color="#FF0000"><b>procedure </b></font>find_black<font color="#000080">(</font>max_color<font color="#000080">:</font>word<font color="#000080">;</font><font color="#FF0000"><b>var </b></font>black<font color="#000080">,</font>white<font color="#000080">:</font>byte<font color="#000080">);
</font><font color="#FF0000"><b>function  </b></font>setmode<font color="#000080">(</font>mode<font color="#000080">:</font>word<font color="#000080">):</font>byte<font color="#000080">;  </font><font color="#008000"><i>{ return 0 if bad, 1 if OK }
</i></font><font color="#FF0000"><b>procedure </b></font>setpix<font color="#000080">(</font>x<font color="#000080">,</font>y<font color="#000080">,</font>col<font color="#000080">:</font>word<font color="#000080">);
</font><font color="#FF0000"><b>procedure </b></font>setpix_16<font color="#000080">(</font>x<font color="#000080">,</font>y<font color="#000080">:</font>word<font color="#000080">;</font>rouge<font color="#000080">,</font>vert<font color="#000080">,</font>bleu<font color="#000080">:</font>byte<font color="#000080">);
</font><font color="#FF0000"><b>function  </b></font>getpix<font color="#000080">(</font>x<font color="#000080">,</font>y<font color="#000080">:</font>word<font color="#000080">):</font>byte<font color="#000080">;
</font><font color="#FF0000"><b>procedure </b></font>wrtxt<font color="#000080">(</font>x<font color="#000080">,</font>y<font color="#000080">:</font>word<font color="#000080">;</font>txt<font color="#000080">:</font><font color="#FF0000"><b>string</b></font><font color="#000080">);</font><font color="#008000"><i>{write TXT to pos (X,Y)}







</i></font><font color="#FF0000"><b>implementation


var
  </b></font>reg<font color="#000080">:</font>registers<font color="#000080">;
  </font>vgran<font color="#000080">,</font>curbank<font color="#000080">:</font>word<font color="#000080">;
  </font>add_bank<font color="#000080">:</font><font color="#FF0000"><b>procedure</b></font><font color="#000080">;
  </font>tps1<font color="#000080">,</font>tps2<font color="#000080">:</font>longint<font color="#000080">;
  </font>heure<font color="#000080">,</font>minute<font color="#000080">,</font>seconde<font color="#000080">,</font>sec100<font color="#000080">:</font>word<font color="#000080">;





</font><font color="#008000"><i>{$ifdef msdos}
</i></font><font color="#FF0000"><b>procedure </b></font>setbank<font color="#000080">(</font>bank<font color="#000080">:</font>byte<font color="#000080">);</font><font color="#FF0000"><b>far</b></font><font color="#000080">;
</font><font color="#FF0000"><b>var </b></font>banque<font color="#000080">:</font>word<font color="#000080">;
  </font><font color="#FF0000"><b>begin
    </b></font>banque<font color="#000080">:=</font>bank<font color="#000080">*</font>longint<font color="#000080">(</font><font color="#800000">64</font><font color="#000080">) </font><font color="#FF0000"><b>div </b></font>vgran<font color="#000080">;
    </font><font color="#FF0000"><b>asm
      </b></font><font color="#FF00FF">mov bl, 0
      mov dx, banque
      call  [add_bank]
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font>curbank<font color="#000080">:=</font>bank<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{$else}

</i></font><font color="#FF0000"><b>procedure </b></font>setbank<font color="#000080">(</font>bank<font color="#000080">:</font>byte<font color="#008000"><i>{word}</i></font><font color="#000080">);</font><font color="#FF0000"><b>far</b></font><font color="#000080">;
</font><font color="#FF0000"><b>var </b></font>banque<font color="#000080">:</font>word<font color="#000080">;

  </font><font color="#FF0000"><b>begin
             </b></font>reg<font color="#000080">.</font>ax<font color="#000080">:=</font><font color="#800000">$4f05</font><font color="#000080">;
             </font>reg<font color="#000080">.</font>bx<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
             </font>reg<font color="#000080">.</font>dx<font color="#000080">:=</font>bank<font color="#000080">*</font>longint<font color="#000080">(</font><font color="#800000">64</font><font color="#000080">) </font><font color="#FF0000"><b>div </b></font>vgran<font color="#000080">;

             </font>intr<font color="#000080">(</font><font color="#800000">$10</font><font color="#000080">,</font>reg<font color="#000080">);
             </font>reg<font color="#000080">.</font>ax<font color="#000080">:=</font><font color="#800000">$4f05</font><font color="#000080">;
             </font>reg<font color="#000080">.</font>bx<font color="#000080">:=</font><font color="#800000">1</font><font color="#000080">;
             </font>intr<font color="#000080">(</font><font color="#800000">$10</font><font color="#000080">,</font>reg<font color="#000080">);

  </font>curbank<font color="#000080">:=</font><font color="#800000">255</font><font color="#000080">;</font><font color="#008000"><i>{bank;}
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#008000"><i>{$endif}

</i></font><font color="#FF0000"><b>function </b></font>setvesa<font color="#000080">(</font>mode<font color="#000080">:</font>word<font color="#000080">):</font>byte<font color="#000080">;

  </font><font color="#FF0000"><b>begin
    asm
     </b></font><font color="#FF00FF">mov ax,4F02h
     mov bx,mode
     int 10h
     sub ax,004Fh
</font><font color="#008000"><i>(*     mov al,0
     cmp ah,1   { if ah=1 that is bad ==&gt;false }
     je  @fin
     mov al,1  {false }
   @fin:*)

     </i></font><font color="#FF00FF">mov @RESULT,al
   </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#008000"><i>{   reg.ax:=$4f02;
   reg.bx:=mode;
   intr($10,reg);
   setvesa:=reg.al;}
{  textmode(co80);
  write(reg.ah,' ',reg.al);
  readln;}

  </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;



</font><font color="#008000"><i>{$ifdef msdos}
</i></font><font color="#FF0000"><b>function </b></font>setmode<font color="#000080">(</font>mode<font color="#000080">:</font>word<font color="#000080">):</font>byte<font color="#000080">;  </font><font color="#008000"><i>{ 0 if bad,1 if OK}
</i></font><font color="#FF0000"><b>type </b></font>type_vesarec<font color="#000080">=</font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">555</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">;
     </font>ves_ptr<font color="#000080">=^</font>type_vesarec<font color="#000080">;

</font><font color="#FF0000"><b>type
  </b></font>long<font color="#000080">=</font><font color="#FF0000"><b>record
         </b></font>lo<font color="#000080">,</font>hi<font color="#000080">:</font>word<font color="#000080">;
       </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>var </b></font>pro<font color="#000080">:</font>byte<font color="#000080">;
    </font>vesarec<font color="#000080">:</font>ves_ptr<font color="#000080">;

    </font>vesa_info<font color="#000080">:</font><font color="#FF0000"><b>record
      </b></font>debut<font color="#000080">:</font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">3</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">;
      </font>granularite<font color="#000080">:</font>word<font color="#000080">;
      </font>winsize<font color="#000080">,
      </font>winaseg<font color="#000080">,
      </font>winbseg<font color="#000080">:</font>word<font color="#000080">;
      </font>add_proc<font color="#000080">:</font><font color="#FF0000"><b>procedure</b></font><font color="#000080">;
      </font>bytes<font color="#000080">:</font>word<font color="#000080">;
      </font>width<font color="#000080">,
      </font>height<font color="#000080">:</font>word<font color="#000080">;
      </font>reste<font color="#000080">:</font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">250</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;


  </font><font color="#FF0000"><b>begin
    </b></font>setmode<font color="#000080">:=</font><font color="#800000">1</font><font color="#000080">;
    </font>getmem<font color="#000080">(</font>vesarec<font color="#000080">,</font><font color="#800000">556</font><font color="#000080">);
    </font>pro<font color="#000080">:=</font>setvesa<font color="#000080">(</font>mode<font color="#000080">);
    </font>fillchar<font color="#000080">(</font>vesarec<font color="#000080">^[</font><font color="#800000">0</font><font color="#000080">],</font><font color="#800000">256</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">); </font><font color="#008000"><i>{ set all to zero  }

      </i></font>reg<font color="#000080">.</font>ax<font color="#000080">:=</font><font color="#800000">$4f01</font><font color="#000080">;
      </font>reg<font color="#000080">.</font>cx<font color="#000080">:=</font>mode<font color="#000080">;
      </font>reg<font color="#000080">.</font>es<font color="#000080">:=</font>long<font color="#000080">(</font>vesarec<font color="#000080">).</font>hi<font color="#000080">;
      </font>reg<font color="#000080">.</font>di<font color="#000080">:=</font>long<font color="#000080">(</font>vesarec<font color="#000080">).</font>lo<font color="#000080">;

      </font>intr<font color="#000080">(</font><font color="#800000">$10</font><font color="#000080">,</font>reg<font color="#000080">);
      </font><font color="#FF0000"><b>if </b></font>reg<font color="#000080">.</font>ah<font color="#000080">=</font><font color="#800000">0 </font><font color="#FF0000"><b>then
        begin
          </b></font>setmode<font color="#000080">:=</font><font color="#800000">1</font><font color="#000080">;
          </font>pro<font color="#000080">:=</font><font color="#800000">1</font><font color="#000080">;
        </font><font color="#FF0000"><b>end
      else
        begin
          </b></font>setmode<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
          </font>pro<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
        </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

      </font>move<font color="#000080">(</font>vesarec<font color="#000080">^[</font><font color="#800000">0</font><font color="#000080">],</font>vesa_info<font color="#000080">.</font>debut<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">],</font><font color="#800000">256</font><font color="#000080">);
      </font><font color="#FF0000"><b>if </b></font>reg<font color="#000080">.</font>al<font color="#000080">=</font><font color="#800000">0 </font><font color="#FF0000"><b>then
        begin
          </b></font>setmode<font color="#000080">:=</font><font color="#800000">1</font><font color="#000080">;
          </font>pro<font color="#000080">:=</font><font color="#800000">1</font><font color="#000080">;
        </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font>vgran<font color="#000080">:=</font>vesa_info<font color="#000080">.</font>granularite<font color="#000080">;
      </font>x_size<font color="#000080">:=</font>vesa_info<font color="#000080">.</font>width<font color="#000080">;                 </font><font color="#008000"><i>{ nb pt per lines }
      </i></font>add_bank<font color="#000080">:=</font>vesa_info<font color="#000080">.</font>add_proc<font color="#000080">;        </font><font color="#008000"><i>{ change bank far ptr }

    </i></font>freemem<font color="#000080">(</font>vesarec<font color="#000080">,</font><font color="#800000">556</font><font color="#000080">);

    </font>use_16<font color="#000080">:=</font>false<font color="#000080">;
    </font>use_32<font color="#000080">:=</font>false<font color="#000080">;
    </font><font color="#FF0000"><b>if </b></font>mode<font color="#000080">=</font><font color="#800000">$112 </font><font color="#FF0000"><b>then </b></font>use_16<font color="#000080">:=</font>true<font color="#000080">;
    </font><font color="#FF0000"><b>if </b></font>mode<font color="#000080">=</font><font color="#800000">$110 </font><font color="#FF0000"><b>then </b></font>use_32<font color="#000080">:=</font>true<font color="#000080">;




  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#008000"><i>{$endif}

</i></font><font color="#FF0000"><b>procedure </b></font>setpix<font color="#000080">(</font>x<font color="#000080">,</font>y<font color="#000080">,</font>col<font color="#000080">:</font>word<font color="#000080">);</font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>var  </b></font>decalage<font color="#000080">:</font>word<font color="#000080">;
      </font><font color="#FF0000"><b>asm
 </b></font><font color="#FF00FF">mov bx,x
 mov ax,y </font><font color="#008000"><i>{removed all range checking on x,y for speed}
 </i></font><font color="#FF00FF">mul x_size </font><font color="#008000"><i>{640 bytes wide in most cases}
 </i></font><font color="#FF00FF">add bx,ax
 adc dx,0
 mov ax, dx </font><font color="#008000"><i>{ what a $#%%# stupid microprocessor}
 </i></font><font color="#FF00FF">adc ax, 0

        </font><font color="#008000"><i>{mov provi,al}   { bank  }
        </i></font><font color="#FF00FF">mov decalage,bx
        cmp ax,curbank
        jz @nonew
        mov ah,0
        push cs
        push ax
        call  far ptr setbank   </font><font color="#008000"><i>{ here ax = bank }
        </i></font><font color="#FF00FF">@nonew:

          mov bx,col
          mov ax,sega000
          mov es,ax
          mov di,decalage
          mov [es:di],bl
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>getpix_16<font color="#000080">(</font>x<font color="#000080">,</font>y<font color="#000080">:</font>word<font color="#000080">;</font><font color="#FF0000"><b>var </b></font>rouge<font color="#000080">,</font>vert<font color="#000080">,</font>bleu<font color="#000080">:</font>byte<font color="#000080">);</font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>var </b></font>l<font color="#000080">:</font>longint<font color="#000080">;
    </font>provi<font color="#000080">:</font>byte<font color="#000080">;
    </font>couleur<font color="#000080">,</font>decalage<font color="#000080">:</font>word<font color="#000080">;

      </font><font color="#FF0000"><b>asm
        </b></font><font color="#FF00FF">mov al,use_16
        cmp al,0
        je @v32000

 mov bx,x
        mov ax,bx
        shl bx,1
        add bx,ax       </font><font color="#008000"><i>{ x*3 }
 </i></font><font color="#FF00FF">mov ax,y </font><font color="#008000"><i>{removed all range checking on x,y for speed}
        </i></font><font color="#FF00FF">shl ax,1
        add ax,y        </font><font color="#008000"><i>{ y*3 }
 </i></font><font color="#FF00FF">mul x_size </font><font color="#008000"><i>{640 bytes wide in most cases}
 </i></font><font color="#FF00FF">add bx,ax
 adc dx,0
 mov ax, dx </font><font color="#008000"><i>{ what a $#%%# stupid microprocessor}
 </i></font><font color="#FF00FF">adc ax, 0

        mov provi,al   </font><font color="#008000"><i>{ bank  }
        </i></font><font color="#FF00FF">mov decalage,bx
        cmp ax,curbank
        jz @nonewa
        mov ah,0
        push cs
        push ax
        call  far ptr setbank   </font><font color="#008000"><i>{ here ax= bank }
        </i></font><font color="#FF00FF">@nonewa:

          mov ax,sega000
          mov es,ax
          mov di,decalage
          mov bl,[es:di]
          les di,bleu
          mov byte ptr [es:di],bl

        add decalage,1
        mov ah,0
        mov al,provi
        adc ax,0
        mov provi,al
        cmp ax,curbank
        jz @nonew1
        mov ah,0
        push cs
        push ax
        call  far ptr setbank   </font><font color="#008000"><i>{  ax = bank }
        </i></font><font color="#FF00FF">@nonew1:

          mov ax,sega000
          mov es,ax
          mov di,decalage
          mov bl,[es:di]
          les di,vert
          mov byte ptr [es:di],bl

        add decalage,1
        mov ah,0
        mov al,provi
        adc ax,0
        cmp ax,curbank
        jz @nonew2
        mov ah,0
        push cs
        push ax
        call  far ptr setbank   </font><font color="#008000"><i>{  ax= bank }
        </i></font><font color="#FF00FF">@nonew2:

          mov ax,sega000
          mov es,ax
          mov di,decalage
          mov bl,[es:di]
          les di,rouge
          mov byte ptr [es:di],bl

          jmp @fin

      @v32000:
 mov bx,x
 mov ax,y </font><font color="#008000"><i>{removed all range checking on x,y for speed}
 </i></font><font color="#FF00FF">mul x_size </font><font color="#008000"><i>{640 bytes wide in most cases}
 </i></font><font color="#FF00FF">add bx,ax
 adc dx,0
 mov ax, dx </font><font color="#008000"><i>{ what a $#%%# stupid microprocessor}
 </i></font><font color="#FF00FF">shl ax, 1
 shl bx, 1
 adc ax, 0   </font><font color="#008000"><i>{ if carry }

        </i></font><font color="#FF00FF">mov provi,al   </font><font color="#008000"><i>{ bank  }
        </i></font><font color="#FF00FF">mov decalage,bx
        cmp ax,curbank
        je @nonew
</font><font color="#008000"><i>{        mov ah,0}
        </i></font><font color="#FF00FF">push cs
        push ax

        call  far ptr setbank   </font><font color="#008000"><i>{  ax = bank }
        </i></font><font color="#FF00FF">@nonew:


        mov ax,sega000
        mov es,ax
        mov di,decalage
        mov bx,[es:di]
        mov al,bl
        and al,31
        shl al,3
        les di,bleu
        mov byte ptr [es:di],al
        shr bx,5
        mov al,bl
        and al,31
        shl al,3
        les di,vert
        mov byte ptr [es:di],al
        shr bx,5
        mov al,bl
        and al,31
        shl al,3
        les di,rouge
        mov byte ptr [es:di],al

        @fin:
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;



</font><font color="#FF0000"><b>procedure </b></font>setpix_16<font color="#000080">(</font>x<font color="#000080">,</font>y<font color="#000080">:</font>word<font color="#000080">;</font>rouge<font color="#000080">,</font>vert<font color="#000080">,</font>bleu<font color="#000080">:</font>byte<font color="#000080">);
</font><font color="#FF0000"><b>var </b></font>l<font color="#000080">:</font>longint<font color="#000080">;
    </font>provi<font color="#000080">:</font>byte<font color="#000080">;
    </font>couleur<font color="#000080">,</font>decalage<font color="#000080">:</font>word<font color="#000080">;
  </font><font color="#FF0000"><b>begin
    if </b></font>use_16<font color="#000080">=</font>true <font color="#FF0000"><b>then
      asm

 </b></font><font color="#FF00FF">mov bx,x
        mov ax,bx
        shl bx,1
        add bx,ax       </font><font color="#008000"><i>{ x*3 }
 </i></font><font color="#FF00FF">mov ax,y </font><font color="#008000"><i>{removed all range checking on x,y for speed}
        </i></font><font color="#FF00FF">shl ax,1
        add ax,y        </font><font color="#008000"><i>{ y*3 }
 </i></font><font color="#FF00FF">mul x_size </font><font color="#008000"><i>{640 bytes wide in most cases}
 </i></font><font color="#FF00FF">add bx,ax
 adc dx,0
 mov ax, dx </font><font color="#008000"><i>{ what a $#%%# stupid microprocessor}
 </i></font><font color="#FF00FF">adc ax, 0

        mov provi,al   </font><font color="#008000"><i>{ bank  }
        </i></font><font color="#FF00FF">mov decalage,bx
        cmp ax,curbank
        jz @nonew
        mov ah,0
        push cs
        push ax
        call  far ptr setbank   </font><font color="#008000"><i>{ ax= bank }
        </i></font><font color="#FF00FF">@nonew:

          mov bl,bleu
          mov ax,sega000
          mov es,ax
          mov di,decalage
          mov [es:di],bl

        add decalage,1
        mov ah,0
        mov al,provi
        adc ax,0
        mov provi,al
        cmp ax,curbank
        jz @nonew1
        mov ah,0
        push cs
        push ax
        call  far ptr setbank   </font><font color="#008000"><i>{  ax= bank }
        </i></font><font color="#FF00FF">@nonew1:

          mov bl,vert
          mov ax,sega000
          mov es,ax
          mov di,decalage
          mov [es:di],bl

        add decalage,1
        mov ah,0
        mov al,provi
        adc ax,0
        cmp ax,curbank
        jz @nonew2
        mov ah,0
        push cs
        push ax
        call  far ptr setbank   </font><font color="#008000"><i>{ ax= bank }
        </i></font><font color="#FF00FF">@nonew2:

          mov bl,rouge
          mov ax,sega000
          mov es,ax
          mov di,decalage
          mov [es:di],bl


      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>if </b></font>use_32<font color="#000080">=</font>true <font color="#FF0000"><b>then
      asm
 </b></font><font color="#FF00FF">mov bx,x
 mov ax,y </font><font color="#008000"><i>{removed all range checking on x,y for speed}
 </i></font><font color="#FF00FF">mul x_size </font><font color="#008000"><i>{640 bytes wide in most cases}
 </i></font><font color="#FF00FF">add bx,ax
 adc dx,0
 mov ax, dx </font><font color="#008000"><i>{ what a $#%%# stupid microprocessor}
 </i></font><font color="#FF00FF">shl ax, 1
 shl bx, 1
 adc ax, 0   </font><font color="#008000"><i>{ if carry }

        </i></font><font color="#FF00FF">mov provi,al   </font><font color="#008000"><i>{ bank  }
        </i></font><font color="#FF00FF">mov decalage,bx
        cmp ax,curbank
        je @nonew
</font><font color="#008000"><i>{        mov ah,0}
        </i></font><font color="#FF00FF">push cs
        push ax
        call  far ptr setbank   </font><font color="#008000"><i>{  ax= bank }
        </i></font><font color="#FF00FF">@nonew:


        mov al,rouge
        shr al,3
        mov ah,0
        shl ax,10
        mov bl,vert
        shr bl,3
        mov bh,0
        shl bx,5
        add ax,bx
        mov bl,bleu
        shr bl,3
        mov bh,0
        add bx,ax
        mov ax,sega000
        mov es,ax
        mov di,decalage
        mov [es:di],bx
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>Move16<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>Source<font color="#000080">,</font>Dest<font color="#000080">;</font>Count<font color="#000080">:</font>Word<font color="#000080">); </font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Asm
  </b></font><font color="#FF00FF">PUSH DS
  LDS SI,SOURCE
  LES DI,DEST
  MOV AX,COUNT
  MOV CX,AX
  SHR CX,1
  REP MOVSW
  TEST AX,1
  JZ @</font><font color="#FF0000"><b>end
  </b></font>MOVSB
<font color="#000080">@</font><font color="#FF0000"><b>end</b></font><font color="#000080">:</font>POP DS
<font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>function </b></font>write_fast<font color="#000080">(</font>x1<font color="#000080">,</font>y<font color="#000080">,</font>x2<font color="#000080">:</font>word<font color="#000080">;</font><font color="#FF0000"><b>var </b></font>entree<font color="#000080">):</font>boolean<font color="#000080">;
</font><font color="#FF0000"><b>var </b></font>coord1<font color="#000080">,</font>coord2<font color="#000080">:</font>longint<font color="#000080">;
    </font>couleur<font color="#000080">:</font>byte<font color="#000080">;
  </font><font color="#FF0000"><b>begin
    </b></font>write_fast<font color="#000080">:=</font>false<font color="#000080">;
    </font>coord1<font color="#000080">:=</font>longint<font color="#000080">(</font>y<font color="#000080">)*</font>longint<font color="#000080">(</font>x_size<font color="#000080">)+</font>x1<font color="#000080">;
    </font>coord2<font color="#000080">:=</font>coord1<font color="#000080">+</font>longint<font color="#000080">((</font>x2<font color="#000080">-</font>x1<font color="#000080">)+</font><font color="#800000">1</font><font color="#000080">);
    </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>coord1 <font color="#FF0000"><b>shr </b></font><font color="#800000">16</font><font color="#000080">)&lt;&gt; </font>curbank <font color="#FF0000"><b>then  </b></font>setbank<font color="#000080">(</font>coord1 <font color="#FF0000"><b>shr </b></font><font color="#800000">16</font><font color="#000080">);
    </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>coord1 <font color="#FF0000"><b>shr </b></font><font color="#800000">16</font><font color="#000080">)=(</font>coord2 <font color="#FF0000"><b>shr </b></font><font color="#800000">16</font><font color="#000080">) </font><font color="#FF0000"><b>then
      begin
         </b></font>move16<font color="#000080">(</font>entree<font color="#000080">,</font>mem<font color="#000080">[</font>sega000<font color="#000080">:(</font>coord1 <font color="#FF0000"><b>mod </b></font><font color="#800000">65536</font><font color="#000080">)],(</font>x2<font color="#000080">-</font>x1<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">));
         </font>write_fast<font color="#000080">:=</font>true<font color="#000080">;
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>function </b></font>donne_heure<font color="#000080">:</font>longint<font color="#000080">;
</font><font color="#FF0000"><b>var </b></font>heure<font color="#000080">,</font>minute<font color="#000080">,</font>seconde<font color="#000080">,</font>sec100<font color="#000080">:</font>word<font color="#000080">;
  </font><font color="#FF0000"><b>begin
    </b></font>gettime<font color="#000080">(</font>heure<font color="#000080">,</font>minute<font color="#000080">,</font>seconde<font color="#000080">,</font>sec100<font color="#000080">);
    </font>donne_heure<font color="#000080">:=</font>heure<font color="#000080">*</font><font color="#800000">3600</font><font color="#000080">*</font><font color="#800000">100</font><font color="#000080">+</font>minute<font color="#000080">*</font><font color="#800000">60</font><font color="#000080">*</font><font color="#800000">100</font><font color="#000080">+</font>seconde<font color="#000080">*</font><font color="#800000">100</font><font color="#000080">+</font>sec100<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;




</font><font color="#FF0000"><b>procedure </b></font>find_black<font color="#000080">(</font>max_color<font color="#000080">:</font>word<font color="#000080">;</font><font color="#FF0000"><b>var </b></font>black<font color="#000080">,</font>white<font color="#000080">:</font>byte<font color="#000080">);
</font><font color="#FF0000"><b>var </b></font>luminance<font color="#000080">,</font>n<font color="#000080">:</font>byte<font color="#000080">;
    </font>reg<font color="#000080">:</font>registers<font color="#000080">;
    </font>table<font color="#000080">:</font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">767</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">;
    </font>i<font color="#000080">,</font>x<font color="#000080">,</font>y<font color="#000080">:</font>word<font color="#000080">;

  </font><font color="#FF0000"><b>begin
       with </b></font>reg <font color="#FF0000"><b>do
         begin
           </b></font>ah<font color="#000080">:=</font><font color="#800000">$10</font><font color="#000080">;
           </font>al<font color="#000080">:=</font><font color="#800000">$17</font><font color="#000080">;
           </font>bx<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
           </font>cx<font color="#000080">:=</font>max_color<font color="#000080">;
           </font>es<font color="#000080">:=</font>seg<font color="#000080">(</font>table<font color="#000080">);
           </font>dx<font color="#000080">:=</font>ofs<font color="#000080">(</font>table<font color="#000080">);
           </font>intr<font color="#000080">(</font><font color="#800000">$10</font><font color="#000080">,</font>reg<font color="#000080">);
         </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font>i<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
    </font>white<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
    </font>black<font color="#000080">:=</font><font color="#800000">255</font><font color="#000080">;
    </font><font color="#FF0000"><b>for </b></font>n<font color="#000080">:=</font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font>max_color<font color="#000080">-</font><font color="#800000">1 </font><font color="#FF0000"><b>do
      begin
        </b></font>luminance<font color="#000080">:=</font>round<font color="#000080">(((</font><font color="#800000">0.59</font><font color="#000080">*</font>table<font color="#000080">[</font>i<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">])+(</font><font color="#800000">0.3</font><font color="#000080">*</font>table<font color="#000080">[</font>i<font color="#000080">])+
        (</font><font color="#800000">0.11</font><font color="#000080">*</font>table<font color="#000080">[</font>i<font color="#000080">+</font><font color="#800000">2</font><font color="#000080">])));
        </font><font color="#FF0000"><b>if </b></font>luminance<font color="#000080">&gt;</font>white <font color="#FF0000"><b>then
          begin
            </b></font>white<font color="#000080">:=</font>luminance<font color="#000080">;
            </font>x<font color="#000080">:=</font>n<font color="#000080">;
          </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
        </font><font color="#FF0000"><b>if </b></font>luminance<font color="#000080">&lt;</font>black <font color="#FF0000"><b>then
          begin
            </b></font>black<font color="#000080">:=</font>luminance<font color="#000080">;
            </font>y<font color="#000080">:=</font>n<font color="#000080">;
          </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
        </font>inc<font color="#000080">(</font>i<font color="#000080">,</font><font color="#800000">3</font><font color="#000080">);
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font>i<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
    </font>black<font color="#000080">:=</font>y<font color="#000080">;
    </font>white<font color="#000080">:=</font>x<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>procedure </b></font>wrtxt<font color="#000080">(</font>x<font color="#000080">,</font>y<font color="#000080">:</font>word<font color="#000080">;</font>txt<font color="#000080">:</font><font color="#FF0000"><b>string</b></font><font color="#000080">);</font><font color="#008000"><i>{write TXT to pos (X,Y)}
</i></font><font color="#FF0000"><b>type
  </b></font>pchar<font color="#000080">=</font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font>char<font color="#000080">] </font><font color="#FF0000"><b>of array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">15</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">;
</font><font color="#FF0000"><b>var
  </b></font>p<font color="#000080">:^</font>pchar<font color="#000080">;
  </font>c<font color="#000080">:</font>char<font color="#000080">;
  </font>i<font color="#000080">,</font>j<font color="#000080">,</font>z<font color="#000080">,</font>b<font color="#000080">:</font>integer<font color="#000080">;
  </font>noir<font color="#000080">,</font>blanc<font color="#000080">:</font>byte<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>reg<font color="#000080">.</font>ax<font color="#000080">:=</font><font color="#800000">$1130</font><font color="#000080">;
  </font>reg<font color="#000080">.</font>bh<font color="#000080">:=</font><font color="#800000">6</font><font color="#000080">;
  </font>intr<font color="#000080">(</font><font color="#800000">$10</font><font color="#000080">,</font>reg<font color="#000080">);
  </font>p<font color="#000080">:=</font>ptr<font color="#000080">(</font>reg<font color="#000080">.</font>es<font color="#000080">,</font>reg<font color="#000080">.</font>bp<font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>use_16<font color="#000080">=</font>false<font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>use_32<font color="#000080">=</font>false<font color="#000080">) </font><font color="#FF0000"><b>then
    </b></font>find_black<font color="#000080">(</font><font color="#800000">256</font><font color="#000080">,</font>noir<font color="#000080">,</font>blanc<font color="#000080">)
  </font><font color="#FF0000"><b>else
    begin
      </b></font>noir<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
      </font>blanc<font color="#000080">:=</font><font color="#800000">255</font><font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>for </b></font>z<font color="#000080">:=</font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>length<font color="#000080">(</font>txt<font color="#000080">) </font><font color="#FF0000"><b>do
      begin
        </b></font>c<font color="#000080">:=</font>txt<font color="#000080">[</font>z<font color="#000080">];
        </font><font color="#FF0000"><b>for </b></font>j<font color="#000080">:=</font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font><font color="#800000">15 </font><font color="#FF0000"><b>do
        begin
          </b></font>b<font color="#000080">:=</font>p<font color="#000080">^[</font>c<font color="#000080">][</font>j<font color="#000080">];
          </font><font color="#FF0000"><b>for </b></font>i<font color="#000080">:=</font>x<font color="#000080">+</font><font color="#800000">7 </font><font color="#FF0000"><b>downto </b></font>x <font color="#FF0000"><b>do
          begin
            if </b></font><font color="#000080">(</font>use_16<font color="#000080">=</font>false<font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>use_32<font color="#000080">=</font>false<font color="#000080">)  </font><font color="#FF0000"><b>then
              begin
                if </b></font>odd<font color="#000080">(</font>b<font color="#000080">) </font><font color="#FF0000"><b>then </b></font>setpix<font color="#000080">(</font>i<font color="#000080">,</font>y<font color="#000080">+</font>j<font color="#000080">,</font>blanc<font color="#000080">)
                          </font><font color="#FF0000"><b>else </b></font>setpix<font color="#000080">(</font>i<font color="#000080">,</font>y<font color="#000080">+</font>j<font color="#000080">,</font>noir<font color="#000080">);
              </font><font color="#FF0000"><b>end
            else
              begin
                if </b></font>odd<font color="#000080">(</font>b<font color="#000080">) </font><font color="#FF0000"><b>then </b></font>setpix_16<font color="#000080">(</font>i<font color="#000080">,</font>y<font color="#000080">+</font>j<font color="#000080">,</font>blanc<font color="#000080">,</font>blanc<font color="#000080">,</font>blanc<font color="#000080">)
                          </font><font color="#FF0000"><b>else </b></font>setpix_16<font color="#000080">(</font>i<font color="#000080">,</font>y<font color="#000080">+</font>j<font color="#000080">,</font>noir<font color="#000080">,</font>noir<font color="#000080">,</font>noir<font color="#000080">);
              </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

            </font>b<font color="#000080">:=</font>b <font color="#FF0000"><b>shr </b></font><font color="#800000">1</font><font color="#000080">;
          </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
        </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
        </font>inc<font color="#000080">(</font>x<font color="#000080">,</font><font color="#800000">8</font><font color="#000080">);
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>getpix<font color="#000080">(</font>x<font color="#000080">,</font>y<font color="#000080">:</font>word<font color="#000080">):</font>byte<font color="#000080">;</font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>var  </b></font>decalage<font color="#000080">:</font>word<font color="#000080">;
      </font><font color="#FF0000"><b>asm
 </b></font><font color="#FF00FF">mov bx,x
 mov ax,y </font><font color="#008000"><i>{removed all range checking on x,y for speed}
 </i></font><font color="#FF00FF">mul x_size </font><font color="#008000"><i>{640 bytes wide in most cases}
 </i></font><font color="#FF00FF">add bx,ax
 adc dx,0
 mov ax, dx </font><font color="#008000"><i>{ what a $#%%# stupid microprocessor}
 </i></font><font color="#FF00FF">adc ax, 0

        </font><font color="#008000"><i>{mov provi,al}   { bank  }
        </i></font><font color="#FF00FF">mov decalage,bx
        cmp ax,curbank
        jz @nonew
        mov ah,0
        push cs
        push ax
        call  far ptr setbank   </font><font color="#008000"><i>{ ax= bank }
        </i></font><font color="#FF00FF">@nonew:

          mov ax,sega000
          mov es,ax
          mov di,decalage
          mov al,[es:di]
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>end</b></font><font color="#000080">.

</font><font color="#008000"><i>{ cut here
----------------------------------------------------------------------------
}

</i></font><font color="#FF0000"><b>program </b></font>VesaDemo<font color="#000080">;
</font><font color="#008000"><i>{
*****************************************************************************

    Sample program for the unit Usvesa.

    Only 2 mode tested here:
      - 256 colors
      - 16 millions colors

    You can change the
       &quot;n:=setmode($112);&quot; and write :
       &quot;n:=setmode($110);&quot; .
    I am sure that you will see the difference between 32768 an 16 millions
  colors !!!

                                           Lionel Cordesses
                                           From FRANCE.
                                           November 1994
*****************************************************************************
}

{$f+}

</i></font><font color="#FF0000"><b>uses </b></font>dos<font color="#000080">,</font>crt<font color="#000080">,</font>usvesa<font color="#000080">;

</font><font color="#FF0000"><b>var </b></font>n<font color="#000080">:</font>byte<font color="#000080">;
    </font>x<font color="#000080">,</font>y<font color="#000080">,</font>i<font color="#000080">:</font>word<font color="#000080">;
    </font>ch<font color="#000080">:</font>char<font color="#000080">;
    </font>funckey<font color="#000080">:</font>boolean<font color="#000080">;
    </font>code<font color="#000080">:</font>byte<font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>touche<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>funckey<font color="#000080">:</font>boolean<font color="#000080">;</font><font color="#FF0000"><b>var </b></font>code<font color="#000080">:</font>byte<font color="#000080">);
</font><font color="#FF0000"><b>var </b></font>ch<font color="#000080">:</font>char<font color="#000080">;
  </font><font color="#FF0000"><b>begin

    while </b></font>keypressed <font color="#FF0000"><b>do
      </b></font>ch<font color="#000080">:=</font>readkey<font color="#000080">;
    </font><font color="#FF0000"><b>repeat
    until not </b></font>keypressed<font color="#000080">;
    </font>ch<font color="#000080">:=</font>readkey<font color="#000080">;
    </font><font color="#FF0000"><b>if </b></font>ch<font color="#000080">&lt;&gt;</font><font color="#800000">#0 </font><font color="#FF0000"><b>then </b></font>funckey<font color="#000080">:=</font>false
    <font color="#FF0000"><b>else
      begin
        </b></font>funckey<font color="#000080">:=</font>true<font color="#000080">;
        </font>ch<font color="#000080">:=</font>readkey<font color="#000080">;
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font>code<font color="#000080">:=</font>ord<font color="#000080">(</font>ch<font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;



</font><font color="#FF0000"><b>procedure </b></font>test_256<font color="#000080">;
  </font><font color="#FF0000"><b>begin
    </b></font>clrscr<font color="#000080">;
    </font>writeln<font color="#000080">(</font><font color="#800000">'Testing VESA mode 640x480 256 colors'</font><font color="#000080">);
    </font>writeln<font color="#000080">(</font><font color="#800000">'Press a key ...'</font><font color="#000080">);
    </font><font color="#FF0000"><b>repeat
      </b></font>touche<font color="#000080">(</font>funckey<font color="#000080">,</font>code<font color="#000080">)
    </font><font color="#FF0000"><b>until </b></font><font color="#000080">(</font>code<font color="#000080">&lt;&gt;</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>or </b></font><font color="#000080">(</font>funckey<font color="#000080">=</font>true<font color="#000080">);
    </font>n<font color="#000080">:=</font>setmode<font color="#000080">(</font><font color="#800000">$101</font><font color="#000080">);
    </font><font color="#FF0000"><b>if </b></font>n<font color="#000080">=</font><font color="#800000">0 </font><font color="#FF0000"><b>then
      begin
        </b></font>textmode<font color="#000080">(</font>co80<font color="#000080">);
        </font>writeln<font color="#000080">(</font><font color="#800000">'WARNING:no VESA driver or unsupported mode !!! '</font><font color="#000080">);
        </font>halt<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">);
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>for </b></font>x<font color="#000080">:=</font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font><font color="#800000">255 </font><font color="#FF0000"><b>do
      for </b></font>y<font color="#000080">:=</font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font><font color="#800000">255 </font><font color="#FF0000"><b>do
        </b></font>setpix<font color="#000080">(</font>x<font color="#000080">,</font>y<font color="#000080">,</font>x<font color="#000080">);
    </font>wrtxt<font color="#000080">(</font><font color="#800000">10</font><font color="#000080">,</font><font color="#800000">300</font><font color="#000080">,</font><font color="#800000">'Mode VESA 101h OK : Press a key to quit ...'</font><font color="#000080">);
    </font><font color="#FF0000"><b>repeat
       </b></font>touche<font color="#000080">(</font>funckey<font color="#000080">,</font>code<font color="#000080">)
    </font><font color="#FF0000"><b>until </b></font><font color="#000080">(</font>code<font color="#000080">&lt;&gt;</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>or </b></font><font color="#000080">(</font>funckey<font color="#000080">=</font>true<font color="#000080">);
    </font>textmode<font color="#000080">(</font>co80<font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>test_16<font color="#000080">;
  </font><font color="#FF0000"><b>begin
    </b></font>clrscr<font color="#000080">;
    </font>writeln<font color="#000080">(</font><font color="#800000">'Testing VESA mode 640x480 16 millions  colors'</font><font color="#000080">);
    </font>writeln<font color="#000080">(</font><font color="#800000">'Press a key ...'</font><font color="#000080">);
    </font><font color="#FF0000"><b>repeat
      </b></font>touche<font color="#000080">(</font>funckey<font color="#000080">,</font>code<font color="#000080">)
    </font><font color="#FF0000"><b>until </b></font><font color="#000080">(</font>code<font color="#000080">&lt;&gt;</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>or </b></font><font color="#000080">(</font>funckey<font color="#000080">=</font>true<font color="#000080">);
    </font>n<font color="#000080">:=</font>setmode<font color="#000080">(</font><font color="#800000">$112</font><font color="#000080">);
    </font><font color="#FF0000"><b>if </b></font>n<font color="#000080">=</font><font color="#800000">0 </font><font color="#FF0000"><b>then
      begin
        </b></font>textmode<font color="#000080">(</font>co80<font color="#000080">);
        </font>writeln<font color="#000080">(</font><font color="#800000">'WARNING:no VESA driver or unsupported mode !!! '</font><font color="#000080">);
        </font>halt<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">);
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>for </b></font>y<font color="#000080">:=</font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font><font color="#800000">255 </font><font color="#FF0000"><b>do
      for </b></font>x<font color="#000080">:=</font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font><font color="#800000">255 </font><font color="#FF0000"><b>do
        </b></font>setpix_16<font color="#000080">(</font>x<font color="#000080">,</font>y<font color="#000080">,</font>x<font color="#000080">,</font>y<font color="#000080">,</font><font color="#800000">255</font><font color="#000080">-</font>x<font color="#000080">);
     </font>wrtxt<font color="#000080">(</font><font color="#800000">10</font><font color="#000080">,</font><font color="#800000">300</font><font color="#000080">,</font><font color="#800000">'Mode VESA 112h OK : Press a key to quit ...'</font><font color="#000080">);
    </font><font color="#FF0000"><b>repeat
      </b></font>touche<font color="#000080">(</font>funckey<font color="#000080">,</font>code<font color="#000080">)
    </font><font color="#FF0000"><b>until </b></font><font color="#000080">(</font>code<font color="#000080">&lt;&gt;</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>or </b></font><font color="#000080">(</font>funckey<font color="#000080">=</font>true<font color="#000080">);
    </font>textmode<font color="#000080">(</font>co80<font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>begin
  </b></font>test_256<font color="#000080">;
  </font>test_16<font color="#000080">;
  </font>textmode<font color="#000080">(</font>co80<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to EGAVGA SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0215.PAS">Original</a><b>]</b></p></body>
</html>
