<html>
<head><title> "Another Text Fader" by SAM VILAIN</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to EGAVGA SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0257.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code>
<font color="#FF0000"><b>Program </b></font>Fade<font color="#000080">;         </font><font color="#008000"><i>{ Fades to Black, Clears the screen and restores palet }

</i></font><font color="#FF0000"><b>Uses </b></font>Crt<font color="#000080">, </font>DOS<font color="#000080">;

</font><font color="#FF0000"><b>Const </b></font>SizeOfPal <font color="#000080">= </font><font color="#800000">255</font><font color="#000080">;    </font><font color="#008000"><i>{ Size of palette to be altered...255 works in all}
      </i></font>UpLim     <font color="#000080">= </font>Sizeofpal <font color="#000080">+ </font><font color="#800000">1</font><font color="#000080">; </font><font color="#008000"><i>{ &lt;256 cols modes. }

</i></font><font color="#FF0000"><b>Type </b></font>Pal <font color="#000080">= </font><font color="#FF0000"><b>Record
             </b></font>Red<font color="#000080">, </font>Green<font color="#000080">, </font>Blue <font color="#000080">: </font>Byte<font color="#000080">; </font><font color="#008000"><i>{ Red, Green and Blue Colour Registers }
           </i></font><font color="#FF0000"><b>End</b></font><font color="#000080">;
  </font>FullPal <font color="#000080">= </font><font color="#FF0000"><b>Record
              </b></font>Data <font color="#000080">: </font><font color="#FF0000"><b>Array </b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font>SizeOfPal<font color="#000080">] </font><font color="#FF0000"><b>Of </b></font>Pal<font color="#000080">;
            </font><font color="#FF0000"><b>End</b></font><font color="#000080">;                          </font><font color="#008000"><i>{ This is basically a full palette }

</i></font><font color="#FF0000"><b>Procedure </b></font>GetPalette <font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>Hello <font color="#000080">: </font>Fullpal<font color="#000080">);    </font><font color="#008000"><i>{ Returns the current Palette }
  { uses BIOS }
</i></font><font color="#FF0000"><b>Var </b></font>Regs<font color="#000080">: </font>Registers<font color="#000080">;
</font><font color="#FF0000"><b>Begin
  With </b></font>Regs <font color="#FF0000"><b>Do
  Begin
    </b></font>AX <font color="#000080">:= </font><font color="#800000">$1017</font><font color="#000080">;      </font><font color="#008000"><i>{ Get Block Of Color Registers }
    </i></font>BX <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;          </font><font color="#008000"><i>{ First Colour register to be changed is 0 - black }
    </i></font>CX <font color="#000080">:= </font>Uplim<font color="#000080">;      </font><font color="#008000"><i>{ Change &lt;UpLim&gt; registers }
    </i></font>ES <font color="#000080">:= </font>Seg <font color="#000080">(</font>Hello<font color="#000080">);</font><font color="#008000"><i>{ Segment address of Hello }
    </i></font>DX <font color="#000080">:= </font>Ofs <font color="#000080">(</font>Hello<font color="#000080">);</font><font color="#008000"><i>{ Offset address of Hello -&gt; DX }
  </i></font><font color="#FF0000"><b>End</b></font><font color="#000080">;
  </font>Intr <font color="#000080">(</font><font color="#800000">$10</font><font color="#000080">, </font>Regs<font color="#000080">);   </font><font color="#008000"><i>{ Call video interrupt (get palette -&gt; Hello) } </i></font><font color="#FF0000"><b>End</b></font><font color="#000080">; </font><font color="#008000"><i>{GetPalette }
</i></font><font color="#FF0000"><b>Procedure </b></font>WritePalette <font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>Hello <font color="#000080">: </font>Fullpal<font color="#000080">);
    </font><font color="#008000"><i>{ Writes to screen passed palette }
</i></font><font color="#FF0000"><b>Var </b></font>Regs<font color="#000080">: </font>Registers<font color="#000080">;
</font><font color="#FF0000"><b>Begin
  With </b></font>Regs <font color="#FF0000"><b>Do
  Begin
    </b></font>ES <font color="#000080">:= </font>Seg <font color="#000080">(</font>Hello<font color="#000080">);
    </font>AX <font color="#000080">:= </font><font color="#800000">$1012</font><font color="#000080">; </font><font color="#008000"><i>{ Write block of color registers }
    </i></font>BX <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;     </font><font color="#008000"><i>{ Everything else is basically the same as GetPallette }
    </i></font>CX <font color="#000080">:= </font>Uplim<font color="#000080">;
    </font>DX <font color="#000080">:= </font>Ofs <font color="#000080">(</font>Hello<font color="#000080">);
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
  </font>Intr <font color="#000080">(</font><font color="#800000">$10</font><font color="#000080">, </font>Regs<font color="#000080">);
</font><font color="#FF0000"><b>End</b></font><font color="#000080">; </font><font color="#008000"><i>{ WritePalette }

</i></font><font color="#FF0000"><b>Procedure </b></font>Sync<font color="#000080">;
</font><font color="#FF0000"><b>Var </b></font>CRTC <font color="#000080">: </font>Word<font color="#000080">;
</font><font color="#FF0000"><b>Begin
  </b></font>CRTC <font color="#000080">:= </font>Memw <font color="#000080">[</font><font color="#800000">$40</font><font color="#000080">:</font><font color="#800000">$63</font><font color="#000080">];  </font><font color="#008000"><i>{ get CRTC address }
  </i></font><font color="#FF0000"><b>If </b></font>CRTC <font color="#000080">&lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>Then        </b></font><font color="#008000"><i>{ in case no video controller/fn not supported }
  </i></font><font color="#FF0000"><b>Begin
    </b></font>CRTC <font color="#000080">:= </font>CRTC <font color="#000080">+ </font><font color="#800000">6</font><font color="#000080">; </font><font color="#008000"><i>{ set address to register including retrace signal. }
    </i></font><font color="#FF0000"><b>Repeat Until </b></font><font color="#000080">(</font>port <font color="#000080">[</font>crtc<font color="#000080">] </font><font color="#FF0000"><b>And </b></font><font color="#800000">8</font><font color="#000080">) = </font><font color="#800000">0</font><font color="#000080">;
    </font><font color="#FF0000"><b>Repeat Until </b></font><font color="#000080">(</font>port <font color="#000080">[</font>crtc<font color="#000080">] </font><font color="#FF0000"><b>And </b></font><font color="#800000">8</font><font color="#000080">) = </font><font color="#800000">8</font><font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Var
  </b></font>Saved<font color="#000080">, </font>Nyar  <font color="#000080">: </font>Fullpal<font color="#000080">;
  </font>C<font color="#000080">, </font>Q         <font color="#000080">: </font>Byte<font color="#000080">;
  </font>Cls          <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">;
  </font>Regs         <font color="#000080">: </font>Registers<font color="#000080">;

</font><font color="#FF0000"><b>Begin
  </b></font>GetPalette <font color="#000080">(</font>Saved<font color="#000080">);
  </font>Move <font color="#000080">(</font>Saved<font color="#000080">, </font>Nyar<font color="#000080">, </font>SizeOf <font color="#000080">(</font>Fullpal<font color="#000080">) );

  </font><font color="#FF0000"><b>For </b></font>Q <font color="#000080">:= </font><font color="#800000">63 </font><font color="#FF0000"><b>Downto </b></font><font color="#800000">1 </font><font color="#FF0000"><b>Do Begin
    For </b></font>C <font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>To </b></font>SizeOfPal <font color="#FF0000"><b>Do Begin
      With </b></font>Nyar<font color="#000080">. </font>Data <font color="#000080">[</font>c<font color="#000080">] </font><font color="#FF0000"><b>Do Begin
        </b></font>Dec <font color="#000080">(</font>Red<font color="#000080">);    </font><font color="#FF0000"><b>If </b></font>Red   <font color="#000080">&gt; </font><font color="#800000">63 </font><font color="#FF0000"><b>Then </b></font>Red   <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
        </font>Dec <font color="#000080">(</font>Green<font color="#000080">);  </font><font color="#FF0000"><b>If </b></font>Green <font color="#000080">&gt; </font><font color="#800000">63 </font><font color="#FF0000"><b>Then </b></font>Green <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
        </font>Dec <font color="#000080">(</font>Blue<font color="#000080">);   </font><font color="#FF0000"><b>If </b></font>Blue  <font color="#000080">&gt; </font><font color="#800000">63 </font><font color="#FF0000"><b>Then </b></font>Blue  <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
      </font><font color="#FF0000"><b>End</b></font><font color="#000080">; </font><font color="#008000"><i>{ With Nyar.Data[c] }
    </i></font><font color="#FF0000"><b>End</b></font><font color="#000080">; </font><font color="#008000"><i>{ For C := 0 To SizeOfPal }
    </i></font>Sync<font color="#000080">;
    </font>WritePalette <font color="#000080">(</font>Nyar<font color="#000080">);
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">; </font><font color="#008000"><i>{ For Q:=63 DownTo 1 }

  </i></font>Cls <font color="#000080">:= </font><font color="#800000">'`[40m'</font><font color="#000080">;

  </font><font color="#FF0000"><b>With </b></font>Regs <font color="#FF0000"><b>do
    Begin
    </b></font>AH <font color="#000080">:= </font><font color="#800000">$40</font><font color="#000080">;        </font><font color="#008000"><i>{ Write to DOS File Handle }
    </i></font>BX <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;          </font><font color="#008000"><i>{ Standard Output }
    </i></font>CX <font color="#000080">:= </font><font color="#800000">5</font><font color="#000080">;          </font><font color="#008000"><i>{ 5 bytes }
    </i></font>DS <font color="#000080">:= </font>Seg<font color="#000080">(</font>Cls<font color="#000080">);   </font><font color="#008000"><i>{ Segment of CLS }
    </i></font>DX <font color="#000080">:= </font>ofs<font color="#000080">(</font>Cls<font color="#000080">);   </font><font color="#008000"><i>{ Offset of CLS[1] }
    </i></font><font color="#FF0000"><b>End</b></font><font color="#000080">;
  </font>MSDos<font color="#000080">(</font>Regs<font color="#000080">);
  </font>TextAttr <font color="#000080">:= </font>TextAttr <font color="#FF0000"><b>And </b></font><font color="#800000">15</font><font color="#000080">;
  </font>ClrScr<font color="#000080">;
  </font><font color="#FF0000"><b>With </b></font>Regs <font color="#FF0000"><b>do
    Begin
    </b></font>AX <font color="#000080">:= </font><font color="#800000">$1001</font><font color="#000080">;
    </font>BH <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
    </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
  </font>Intr<font color="#000080">(</font><font color="#800000">$10</font><font color="#000080">,</font>Regs<font color="#000080">);
  </font>Writepalette <font color="#000080">(</font>Saved<font color="#000080">);
</font><font color="#FF0000"><b>End</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to EGAVGA SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0257.PAS">Original</a><b>]</b></p></body>
</html>
