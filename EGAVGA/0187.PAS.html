<html>
<head><title> "3D Graphics Routines" by SCOTT STONE</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to EGAVGA SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0187.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code>
<font color="#008000"><i>{ Updated EGAVGA.SWG on May 26, 1995 }

{
From: ss8913@u.cc.utah.edu (Scott Stone)

Well, here it is.  A version of the unit that should calculate stuff
properly. :)  Also, it uses DOUBLE precision instead of REAL.  If it
won't work on your system (should, with the coprocessor-emulation
directive in there), then just change all the DOUBLEs back to REALs.

}
</i></font><font color="#FF0000"><b>Unit </b></font>Graph3d<font color="#000080">; </font><font color="#008000"><i>{Version 0.02 1/12/95}

{Written 1/7/95 by Scott Stone &lt;scott.stone@m.cc.utah.edu&gt;
 I wrote this because nobody is willing to help a newbie who lacks this
 info, so go ahead and use it freely - I wouldn't mind a mention in your
 credits, however! }

{Keep in mind, all procedures that require inputs of an angular measurement
 require the measurement in DEGREES, due to the cosine/sine tables involved}

{This version uses DOUBLE precision, hence the new compiler directive.
 It also fixes the bug that prevents the previous version from working.}


</i></font><font color="#FF0000"><b>Interface
</b></font><font color="#008000"><i>{$N+}

</i></font><font color="#FF0000"><b>Var
  </b></font>sint<font color="#000080">,</font>cost <font color="#000080">: </font><font color="#FF0000"><b>array </b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">359</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>double<font color="#000080">;

</font><font color="#FF0000"><b>function </b></font>rd<font color="#000080">(</font>radians <font color="#000080">: </font>double<font color="#000080">) : </font>double<font color="#000080">;
</font><font color="#FF0000"><b>function </b></font>dr<font color="#000080">(</font>degrees <font color="#000080">: </font>double<font color="#000080">) : </font>double<font color="#000080">;
</font><font color="#FF0000"><b>procedure </b></font>maketables<font color="#000080">;
</font><font color="#FF0000"><b>Procedure </b></font>Rotatexy<font color="#000080">(</font>ra <font color="#000080">: </font>integer<font color="#000080">; </font>ox<font color="#000080">,</font>oy <font color="#000080">: </font>double<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>nx<font color="#000080">,</font>ny <font color="#000080">: </font>double<font color="#000080">);
</font><font color="#FF0000"><b>Procedure </b></font>Rotatexyz<font color="#000080">(</font>rx<font color="#000080">,</font>ry<font color="#000080">,</font>rz <font color="#000080">: </font>integer<font color="#000080">; </font>ox<font color="#000080">,</font>oy<font color="#000080">,</font>oz <font color="#000080">: </font>double<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>nx<font color="#000080">,</font>ny<font color="#000080">,</font>nz <font color="#000080">:
</font>double<font color="#000080">);
</font><font color="#FF0000"><b>Procedure </b></font>Rotate3X<font color="#000080">(</font>rx <font color="#000080">: </font>integer<font color="#000080">; </font>ox<font color="#000080">,</font>oy<font color="#000080">,</font>oz <font color="#000080">: </font>double<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>nx<font color="#000080">,</font>ny<font color="#000080">,</font>nz <font color="#000080">: </font>double<font color="#000080">);
</font><font color="#FF0000"><b>Procedure </b></font>Rotate3Y<font color="#000080">(</font>ry <font color="#000080">: </font>integer<font color="#000080">; </font>ox<font color="#000080">,</font>oy<font color="#000080">,</font>oz <font color="#000080">: </font>double<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>nx<font color="#000080">,</font>ny<font color="#000080">,</font>nz <font color="#000080">: </font>double<font color="#000080">);
</font><font color="#FF0000"><b>Procedure </b></font>Rotate3Z<font color="#000080">(</font>rz <font color="#000080">: </font>integer<font color="#000080">; </font>ox<font color="#000080">,</font>oy<font color="#000080">,</font>oz <font color="#000080">: </font>double<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>nx<font color="#000080">,</font>ny<font color="#000080">,</font>nz <font color="#000080">: </font>double<font color="#000080">);
</font><font color="#FF0000"><b>Procedure </b></font>C32<font color="#000080">(</font>ox<font color="#000080">,</font>oy<font color="#000080">,</font>oz <font color="#000080">: </font>double<font color="#000080">; </font>ep <font color="#000080">: </font>integer<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>nx<font color="#000080">,</font>ny <font color="#000080">: </font>integer<font color="#000080">);
</font><font color="#FF0000"><b>function </b></font>arccos<font color="#000080">(</font>ca <font color="#000080">: </font>double<font color="#000080">) : </font>double<font color="#000080">;
</font><font color="#FF0000"><b>Function </b></font>A2V<font color="#000080">(</font>i1<font color="#000080">,</font>j1<font color="#000080">,</font>k1<font color="#000080">,</font>i2<font color="#000080">,</font>j2<font color="#000080">,</font>k2 <font color="#000080">: </font>double<font color="#000080">) : </font>double<font color="#000080">;

</font><font color="#FF0000"><b>Implementation

Function </b></font>RD <font color="#000080">(</font>radians <font color="#000080">: </font>double<font color="#000080">) : </font>double<font color="#000080">; </font><font color="#008000"><i>{Converts Radians ==&gt;&gt; Degrees}
</i></font><font color="#FF0000"><b>Begin
  </b></font>rd<font color="#000080">:=((</font><font color="#800000">180</font><font color="#000080">*</font>radians<font color="#000080">)/</font>pi<font color="#000080">);
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>DR <font color="#000080">(</font>degrees <font color="#000080">: </font>double<font color="#000080">) : </font>double<font color="#000080">; </font><font color="#008000"><i>{Converts Degrees =&gt;&gt; Radians}
</i></font><font color="#FF0000"><b>Begin
  </b></font>dr<font color="#000080">:=</font>abs<font color="#000080">(</font>degrees<font color="#000080">)*</font>pi<font color="#000080">/</font><font color="#800000">180.0</font><font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;


</font><font color="#FF0000"><b>Procedure </b></font>MakeTables<font color="#000080">; </font><font color="#008000"><i>{Makes Sine/Cosine tables for faster lookups}
</i></font><font color="#FF0000"><b>Var
  </b></font>cc <font color="#000080">: </font>integer<font color="#000080">;
</font><font color="#FF0000"><b>Begin                 </b></font><font color="#008000"><i>{Defines SINT &amp; COST - used in terms of degrees}
  </i></font><font color="#FF0000"><b>for </b></font>cc<font color="#000080">:=</font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font><font color="#800000">359 </font><font color="#FF0000"><b>do
  begin
    </b></font>sint<font color="#000080">[</font>cc<font color="#000080">]:=</font>sin<font color="#000080">(</font>dr<font color="#000080">(</font>cc<font color="#000080">));
    </font>cost<font color="#000080">[</font>cc<font color="#000080">]:=</font>cos<font color="#000080">(</font>dr<font color="#000080">(</font>cc<font color="#000080">))
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>Rotatexy<font color="#000080">(</font>ra <font color="#000080">: </font>integer<font color="#000080">; </font>ox<font color="#000080">,</font>oy <font color="#000080">: </font>double<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>nx<font color="#000080">,</font>ny <font color="#000080">: </font>double<font color="#000080">);
</font><font color="#008000"><i>{Rotate a 2-D point about the origin - positive degrees are COUNTERclockwise}
{RA=amount to rotate, in degrees.  ox,oy = old X,Y.  nx,ny = new X,Y}
</i></font><font color="#FF0000"><b>Begin
  </b></font>nx<font color="#000080">:=(</font>ox<font color="#000080">*(</font>cost<font color="#000080">[</font>ra<font color="#000080">]))-(</font>oy<font color="#000080">*(</font>sint<font color="#000080">[</font>ra<font color="#000080">]));
  </font>ny<font color="#000080">:=(</font>ox<font color="#000080">*(</font>sint<font color="#000080">[</font>ra<font color="#000080">]))+(</font>oy<font color="#000080">*(</font>cost<font color="#000080">[</font>ra<font color="#000080">]));
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>Rotatexyz<font color="#000080">(</font>rx<font color="#000080">,</font>ry<font color="#000080">,</font>rz <font color="#000080">: </font>integer<font color="#000080">; </font>ox<font color="#000080">,</font>oy<font color="#000080">,</font>oz <font color="#000080">: </font>double<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>nx<font color="#000080">,</font>ny<font color="#000080">,</font>nz <font color="#000080">:
</font>double<font color="#000080">);
</font><font color="#008000"><i>{Rotate a 3-D point.  rx,ry,rz=amount to rotate about each axis.}
{ox,oy,oz = old x,y,z.  nx,ny,nz=new x,y,z}
</i></font><font color="#FF0000"><b>Var
  </b></font>tx<font color="#000080">,</font>ty<font color="#000080">,</font>tz <font color="#000080">: </font>double<font color="#000080">;
  </font>tx1<font color="#000080">,</font>ty1<font color="#000080">,</font>tz1 <font color="#000080">: </font>double<font color="#000080">;
</font><font color="#FF0000"><b>Begin
  </b></font><font color="#008000"><i>{first rotate about X-axis}
  </i></font>tx<font color="#000080">:=</font>ox<font color="#000080">;
  </font>ty<font color="#000080">:=(</font>oy<font color="#000080">*(</font>cost<font color="#000080">[</font>rx<font color="#000080">]))-(</font>oz<font color="#000080">*(</font>sint<font color="#000080">[</font>rx<font color="#000080">]));
  </font>tz<font color="#000080">:=(</font>oy<font color="#000080">*(</font>sint<font color="#000080">[</font>rx<font color="#000080">]))+(</font>oz<font color="#000080">*(</font>cost<font color="#000080">[</font>rx<font color="#000080">]));
  </font><font color="#008000"><i>{now about the Y-axis}
  </i></font>tx1<font color="#000080">:=(</font>tx<font color="#000080">*(</font>cost<font color="#000080">[</font>ry<font color="#000080">]))+(</font>tz<font color="#000080">*(</font>sint<font color="#000080">[</font>ry<font color="#000080">]));
  </font>ty1<font color="#000080">:=</font>ty<font color="#000080">;
  </font>tz1<font color="#000080">:=-(</font>tx<font color="#000080">*(</font>sint<font color="#000080">[</font>ry<font color="#000080">]))+(</font>tz<font color="#000080">*(</font>cost<font color="#000080">[</font>ry<font color="#000080">]));
  </font><font color="#008000"><i>{now about the Z-axis}
  </i></font>nx<font color="#000080">:=(</font>tx1<font color="#000080">*(</font>cost<font color="#000080">[</font>rz<font color="#000080">]))-(</font>ty1<font color="#000080">*(</font>sint<font color="#000080">[</font>rz<font color="#000080">]));
  </font>ny<font color="#000080">:=(</font>tx1<font color="#000080">*(</font>sint<font color="#000080">[</font>rz<font color="#000080">]))+(</font>ty1<font color="#000080">*(</font>cost<font color="#000080">[</font>rz<font color="#000080">]));
  </font>nz<font color="#000080">:=</font>tz1<font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>Rotate3X<font color="#000080">(</font>rx <font color="#000080">: </font>integer<font color="#000080">; </font>ox<font color="#000080">,</font>oy<font color="#000080">,</font>oz <font color="#000080">: </font>double<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>nx<font color="#000080">,</font>ny<font color="#000080">,</font>nz <font color="#000080">: </font>double<font color="#000080">);
</font><font color="#008000"><i>{Just rotate a 3-D point around X-axis - separates might be faster}
</i></font><font color="#FF0000"><b>Begin
  if </b></font><font color="#000080">(</font>rx<font color="#000080">&lt;&gt;</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>then </b></font><font color="#008000"><i>{don't do if rx=0 - might save some speed in some cases}
  </i></font><font color="#FF0000"><b>begin
    </b></font>nx<font color="#000080">:=</font>ox<font color="#000080">;
    </font>ny<font color="#000080">:=(</font>oy<font color="#000080">*(</font>cost<font color="#000080">[</font>rx<font color="#000080">]))-(</font>oz<font color="#000080">*(</font>sint<font color="#000080">[</font>rx<font color="#000080">]));
    </font>nz<font color="#000080">:=(</font>oy<font color="#000080">*(</font>sint<font color="#000080">[</font>rx<font color="#000080">]))+(</font>oz<font color="#000080">*(</font>cost<font color="#000080">[</font>rx<font color="#000080">]))
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>Rotate3Y<font color="#000080">(</font>ry <font color="#000080">: </font>integer<font color="#000080">; </font>ox<font color="#000080">,</font>oy<font color="#000080">,</font>oz <font color="#000080">: </font>double<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>nx<font color="#000080">,</font>ny<font color="#000080">,</font>nz <font color="#000080">: </font>double<font color="#000080">);
</font><font color="#FF0000"><b>Begin
  if </b></font><font color="#000080">(</font>ry<font color="#000080">&lt;&gt;</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>then
  begin
    </b></font>nx<font color="#000080">:=(</font>ox<font color="#000080">*(</font>cost<font color="#000080">[</font>ry<font color="#000080">]))+(</font>oz<font color="#000080">*(</font>sint<font color="#000080">[</font>ry<font color="#000080">]));
    </font>ny<font color="#000080">:=</font>oy<font color="#000080">;
    </font>nz<font color="#000080">:=-(</font>ox<font color="#000080">*(</font>sint<font color="#000080">[</font>ry<font color="#000080">]))+(</font>oz<font color="#000080">*(</font>cost<font color="#000080">[</font>ry<font color="#000080">]))
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>Rotate3Z<font color="#000080">(</font>rz <font color="#000080">: </font>integer<font color="#000080">; </font>ox<font color="#000080">,</font>oy<font color="#000080">,</font>oz <font color="#000080">: </font>double<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>nx<font color="#000080">,</font>ny<font color="#000080">,</font>nz <font color="#000080">: </font>double<font color="#000080">);
</font><font color="#FF0000"><b>Begin
  if </b></font><font color="#000080">(</font>rz<font color="#000080">&lt;&gt;</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>then
  begin
    </b></font>nx<font color="#000080">:=(</font>ox<font color="#000080">*(</font>cost<font color="#000080">[</font>rz<font color="#000080">]))-(</font>oy<font color="#000080">*(</font>sint<font color="#000080">[</font>rz<font color="#000080">]));
    </font>ny<font color="#000080">:=(</font>ox<font color="#000080">*(</font>sint<font color="#000080">[</font>rz<font color="#000080">]))+(</font>oy<font color="#000080">*(</font>cost<font color="#000080">[</font>rz<font color="#000080">]));
    </font>nz<font color="#000080">:=</font>oz
  <font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>C32<font color="#000080">(</font>ox<font color="#000080">,</font>oy<font color="#000080">,</font>oz <font color="#000080">: </font>double<font color="#000080">; </font>ep <font color="#000080">: </font>integer<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>nx<font color="#000080">,</font>ny <font color="#000080">: </font>integer<font color="#000080">);
</font><font color="#008000"><i>{Converts 3-D point to 2-D point}
{EP = Expansion Factor - useful for 3-D starfields - set to 1 for doubleism}
</i></font><font color="#FF0000"><b>Begin
  </b></font>nx<font color="#000080">:=</font>round<font color="#000080">((</font>ox<font color="#000080">*</font>ep<font color="#000080">)/</font>oz<font color="#000080">);
  </font>ny<font color="#000080">:=</font>round<font color="#000080">((</font>oy<font color="#000080">*</font>ep<font color="#000080">)/</font>oz<font color="#000080">); </font><font color="#008000"><i>{have to round to integers for screen}
</i></font><font color="#FF0000"><b>End</b></font><font color="#000080">; </font><font color="#008000"><i>{* Note - Make sure you clip your screen points to fit screen res}

</i></font><font color="#FF0000"><b>function </b></font>arccos<font color="#000080">(</font>ca <font color="#000080">: </font>double<font color="#000080">) : </font>double<font color="#000080">;
</font><font color="#008000"><i>{While compiling this unit, TP7 said that there was no predefined ARCCOS
 function.  There is a pre-defined ARCTAN function, so this procedure
 finds the ARCCOS in terms of the ARCTAN.  This was the hardest part about
 writing this unit.  Isn't math cool? :)  BTW - if this doesn't work, let
 me know.  Better yet, let me know and tell me why it doesn't work. }

</i></font><font color="#FF0000"><b>var
  </b></font>r<font color="#000080">,</font>r0<font color="#000080">,</font>r1 <font color="#000080">: </font>double<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>r<font color="#000080">:=</font>sqrt<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">-(</font>abs<font color="#000080">(</font>sqr<font color="#000080">(</font>ca<font color="#000080">))));
  </font>r0<font color="#000080">:=</font>r<font color="#000080">/</font>ca<font color="#000080">;
  </font>r1<font color="#000080">:=</font>arctan<font color="#000080">(</font>r0<font color="#000080">);
  </font>arccos<font color="#000080">:=</font>r1<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>Function </b></font>A2V<font color="#000080">(</font>i1<font color="#000080">,</font>j1<font color="#000080">,</font>k1<font color="#000080">,</font>i2<font color="#000080">,</font>j2<font color="#000080">,</font>k2 <font color="#000080">: </font>double<font color="#000080">) : </font>double<font color="#000080">;
</font><font color="#008000"><i>{Finds angle between two vectors - parameters are vector components}
</i></font><font color="#FF0000"><b>Var
  </b></font>theta <font color="#000080">: </font>double<font color="#000080">;
  </font>vm1<font color="#000080">,</font>vm2 <font color="#000080">: </font>double<font color="#000080">;
  </font>dp <font color="#000080">: </font>double<font color="#000080">;
  </font>ff <font color="#000080">: </font>double<font color="#000080">;
</font><font color="#FF0000"><b>Begin
  </b></font>vm1<font color="#000080">:=</font>sqrt<font color="#000080">(</font>abs<font color="#000080">(</font>sqr<font color="#000080">(</font>i1<font color="#000080">))+</font>abs<font color="#000080">(</font>sqr<font color="#000080">(</font>j1<font color="#000080">))+</font>abs<font color="#000080">(</font>sqr<font color="#000080">(</font>k1<font color="#000080">)));
  </font>vm2<font color="#000080">:=</font>sqrt<font color="#000080">(</font>abs<font color="#000080">(</font>sqr<font color="#000080">(</font>i2<font color="#000080">))+</font>abs<font color="#000080">(</font>sqr<font color="#000080">(</font>j2<font color="#000080">))+</font>abs<font color="#000080">(</font>sqr<font color="#000080">(</font>k2<font color="#000080">)));
  </font>dp<font color="#000080">:=(</font>i1<font color="#000080">*</font>i2<font color="#000080">)+(</font>j1<font color="#000080">*</font>j2<font color="#000080">)+(</font>k1<font color="#000080">*</font>k2<font color="#000080">);
  </font>ff<font color="#000080">:=(</font>dp<font color="#000080">/(</font>vm1<font color="#000080">*</font>vm2<font color="#000080">));
  </font>theta<font color="#000080">:=</font>arccos<font color="#000080">(</font>ff<font color="#000080">);
  </font>a2v<font color="#000080">:=</font>theta<font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;


</font><font color="#FF0000"><b>Begin
End</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to EGAVGA SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0187.PAS">Original</a><b>]</b></p></body>
</html>
