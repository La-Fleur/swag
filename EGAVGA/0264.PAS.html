<html>
<head><title> "Phong-shading" by JEROEN BOUWENS</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to EGAVGA SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0264.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
Ok, here it is. A freeware 100% pascal phongshading program. No extra units
are required. Just extract the program, and run it. I wrote it in bp 7, but I
assume it will work in lower versions as well.A few remarks: 
1) The 'phong-map' is pretty crappy, so it looks a bit like gouraudshading
   (Trust me, it's not :-).
2) Don't tell me it's slow, I know that (My latest routines are 6 times
   faster).
3) Feel free to use it anywhere you want, and spread it if you want.
4) Comments are appreciated, as long as they are positive :-).

I wrote this version exclusively for this purpose, and removing the need for
extra units or external files wasn't easy (Look at CreateTorusData, it was a
real pain in the ...). I might post another program in the future calculate
phong-maps using the complete phong-model, which looks a zillion times better.
But don't count on it. Just an idea: You can try to use the texture-map
routine from gfxfx2 to speed it up. I haven't tried it, but it should be
possible. Last words: Have fun.

&gt;---&gt;---Cut here---&gt;---&gt;

{Freeware phong-shading routine. Spread it if you want. Credit me if you
use it. Made by Jeroen Bouwens, The Netherlands.
Mail me:

e-mail : j.bouwens@tn.ft.hse.nl (Preferred)
Fido   : 2:284/123.3

Greets: Alex,Rob,Martijn,Maarten,Bas,Sean,Richard,Marcel,Jurjen,Michel,
        Sonja,N-Faktor and all the other people I met at Wired (Cool party)}

</i></font><font color="#FF0000"><b>Uses </b></font>Crt<font color="#000080">;</font><font color="#008000"><i>{$R- $Q-}

</i></font><font color="#FF0000"><b>Var </b></font>Faces                                <font color="#000080">: </font><font color="#FF0000"><b>Array </b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">320</font><font color="#000080">,</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">3</font><font color="#000080">] </font><font color="#FF0000"><b>Of </b></font>Integer<font color="#000080">;
    </font>FNX<font color="#000080">,</font>FNY<font color="#000080">,</font>FNZ<font color="#000080">,</font>Pind<font color="#000080">,</font>PolyZ               <font color="#000080">: </font><font color="#FF0000"><b>Array </b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">320</font><font color="#000080">] </font><font color="#FF0000"><b>Of </b></font>Integer<font color="#000080">;
    </font>BX<font color="#000080">,</font>BY<font color="#000080">,</font>BZ<font color="#000080">,</font>UT<font color="#000080">,</font>VT<font color="#000080">,</font>X<font color="#000080">,</font>Y<font color="#000080">,</font>Z<font color="#000080">,</font>NX<font color="#000080">,</font>NY<font color="#000080">,</font>NZ        <font color="#000080">: </font><font color="#FF0000"><b>Array </b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">160</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Integer<font color="#000080">;
    </font>Cosinus<font color="#000080">,</font>Sinus                        <font color="#000080">: </font><font color="#FF0000"><b>Array </b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">255</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>LongInt<font color="#000080">;
    </font>Pict<font color="#000080">,</font>Screen2                         <font color="#000080">: </font>Pointer<font color="#000080">;
    </font>NumOfVerts<font color="#000080">,</font>NumOfFaces<font color="#000080">,</font>EyeDist<font color="#000080">,</font>VirSeg <font color="#000080">: </font>Word<font color="#000080">;
    </font>I<font color="#000080">,</font>J<font color="#000080">,</font>G<font color="#000080">,</font>NumVisible<font color="#000080">,</font>XT1<font color="#000080">,</font>YT1<font color="#000080">,</font>ZT1         <font color="#000080">: </font>Integer<font color="#000080">;
    </font>Alpha<font color="#000080">,</font>Beta<font color="#000080">,</font>Gamma<font color="#000080">,</font>K                   <font color="#000080">: </font>Byte<font color="#000080">;
    </font><font color="#008000"><i>{Timer variables}</i></font>Time                <font color="#000080">: </font>Longint <font color="#FF0000"><b>ABSOLUTE </b></font><font color="#800000">$0040</font><font color="#000080">:</font><font color="#800000">$006C</font><font color="#000080">;
    </font>T1<font color="#000080">,</font>Aantal                            <font color="#000080">: </font>LongInt<font color="#000080">;

</font><font color="#008000"><i>{------Procedures that are not time-critical (Not used during rotation)------}

</i></font><font color="#FF0000"><b>Procedure </b></font>Palette<font color="#000080">(</font>ColNum<font color="#000080">,</font>R<font color="#000080">,</font>G<font color="#000080">,</font>B<font color="#000080">:</font>Byte<font color="#000080">); </font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Asm </b></font><font color="#FF00FF">Mov dx,$3c8; Mov al,ColNum; Out dx,al; Inc dx; Mov al,R;
    Out dx,al; Mov al,G; Out dx,al; Mov al,B; Out dx,al </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>CalcVertexNormals<font color="#000080">;
</font><font color="#008000"><i>{Calculate the average normal vector at each vertex-point}
</i></font><font color="#FF0000"><b>Var </b></font>I<font color="#000080">,</font>J<font color="#000080">,</font>NF                                 <font color="#000080">: </font>Integer<font color="#000080">;
    </font>RelX1<font color="#000080">,</font>RelY1<font color="#000080">,</font>RelZ1<font color="#000080">,</font>RelX2<font color="#000080">,</font>RelY2<font color="#000080">,</font>RelZ2<font color="#000080">,</font>VL <font color="#000080">: </font>Real<font color="#000080">;
</font><font color="#FF0000"><b>Begin
  </b></font><font color="#008000"><i>{In which face is each point used, and average these face-normals}
  </i></font><font color="#FF0000"><b>For </b></font>I<font color="#000080">:=</font><font color="#800000">1 </font><font color="#FF0000"><b>To </b></font>NumOfVerts <font color="#FF0000"><b>Do Begin
    </b></font>RelX1<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">; </font>RelY1<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">; </font>RelZ1<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">; </font>NF<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
    </font><font color="#FF0000"><b>For </b></font>J<font color="#000080">:=</font><font color="#800000">1 </font><font color="#FF0000"><b>To </b></font>NumOfFaces <font color="#FF0000"><b>Do Begin
      If </b></font><font color="#000080">(</font>Faces<font color="#000080">[</font>J<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">]=</font>I<font color="#000080">) </font><font color="#FF0000"><b>Or </b></font><font color="#000080">(</font>Faces<font color="#000080">[</font>J<font color="#000080">,</font><font color="#800000">2</font><font color="#000080">]=</font>I<font color="#000080">) </font><font color="#FF0000"><b>Or </b></font><font color="#000080">(</font>Faces<font color="#000080">[</font>J<font color="#000080">,</font><font color="#800000">3</font><font color="#000080">]=</font>I<font color="#000080">) </font><font color="#FF0000"><b>Then Begin
        </b></font>RelX1<font color="#000080">:=</font>RelX1<font color="#000080">+</font>FNX<font color="#000080">[</font>J<font color="#000080">]; </font>RelY1<font color="#000080">:=</font>RelY1<font color="#000080">+</font>FNY<font color="#000080">[</font>J<font color="#000080">]; </font>RelZ1<font color="#000080">:=</font>RelZ1<font color="#000080">+</font>FNZ<font color="#000080">[</font>J<font color="#000080">];
        </font>Inc<font color="#000080">(</font>NF<font color="#000080">);
      </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>If </b></font>NF<font color="#000080">&lt;&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>then Begin
      </b></font>RelX1<font color="#000080">:=</font>RelX1<font color="#000080">/</font>NF<font color="#000080">; </font>RelY1<font color="#000080">:=</font>RelY1<font color="#000080">/</font>NF<font color="#000080">; </font>RelZ1<font color="#000080">:=</font>RelZ1<font color="#000080">/</font>NF<font color="#000080">;
      </font>VL<font color="#000080">:=</font>Sqrt<font color="#000080">(</font>RelX1<font color="#000080">*</font>RelX1<font color="#000080">+</font>RelY1<font color="#000080">*</font>RelY1<font color="#000080">+</font>RelZ1<font color="#000080">*</font>RelZ1<font color="#000080">);
      </font>NX<font color="#000080">[</font>I<font color="#000080">]:=</font>Round<font color="#000080">((</font>RelX1<font color="#000080">/</font>VL<font color="#000080">)*</font><font color="#800000">120</font><font color="#000080">); </font>NY<font color="#000080">[</font>I<font color="#000080">]:=</font>Round<font color="#000080">((</font>RelY1<font color="#000080">/</font>VL<font color="#000080">)*</font><font color="#800000">120</font><font color="#000080">);
      </font>NZ<font color="#000080">[</font>I<font color="#000080">]:=</font>Round<font color="#000080">((</font>RelZ1<font color="#000080">/</font>VL<font color="#000080">)*</font><font color="#800000">120</font><font color="#000080">);
    </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;</font><font color="#008000"><i>{CalcVertexNormals}

</i></font><font color="#FF0000"><b>Procedure </b></font>CreateTorusData<font color="#000080">;
</font><font color="#FF0000"><b>Var </b></font>HorAngle<font color="#000080">,</font>VertAngle<font color="#000080">,</font>Count       <font color="#000080">: </font>Integer<font color="#000080">;
    </font>CX<font color="#000080">,</font>CY<font color="#000080">,</font>RX1<font color="#000080">,</font>RY1<font color="#000080">,</font>RZ1<font color="#000080">,</font>RX2<font color="#000080">,</font>RY2<font color="#000080">,</font>RZ2  <font color="#000080">: </font>Real<font color="#000080">;
</font><font color="#FF0000"><b>Begin

  </b></font>NumOfVerts<font color="#000080">:=</font><font color="#800000">160</font><font color="#000080">; </font>NumOfFaces<font color="#000080">:=</font><font color="#800000">320</font><font color="#000080">; </font>Count<font color="#000080">:=</font><font color="#800000">1</font><font color="#000080">;
  </font><font color="#FF0000"><b>For </b></font>HorAngle<font color="#000080">:=</font><font color="#800000">0 </font><font color="#FF0000"><b>To </b></font><font color="#800000">15 </font><font color="#FF0000"><b>Do Begin</b></font><font color="#008000"><i>{Calculate vertex-positions}
    </i></font>CX<font color="#000080">:=</font>Cos<font color="#000080">(</font>HorAngle<font color="#000080">/</font><font color="#800000">2.546479089</font><font color="#000080">)*</font><font color="#800000">170</font><font color="#000080">;
    </font>CY<font color="#000080">:=</font>Sin<font color="#000080">(</font>HorAngle<font color="#000080">/</font><font color="#800000">2.546479089</font><font color="#000080">)*</font><font color="#800000">170</font><font color="#000080">;
    </font><font color="#FF0000"><b>For </b></font>VertAngle<font color="#000080">:=</font><font color="#800000">0 </font><font color="#FF0000"><b>To </b></font><font color="#800000">9 </font><font color="#FF0000"><b>Do Begin
      </b></font>X<font color="#000080">[</font>Count<font color="#000080">]:=</font>Round<font color="#000080">(</font>CX<font color="#000080">+</font>Cos<font color="#000080">(</font>VertAngle<font color="#000080">/</font><font color="#800000">1.592</font><font color="#000080">)*</font>Cos<font color="#000080">(</font>HorAngle<font color="#000080">/</font><font color="#800000">2.546</font><font color="#000080">)*</font><font color="#800000">90</font><font color="#000080">);
      </font>Y<font color="#000080">[</font>Count<font color="#000080">]:=</font>Round<font color="#000080">(</font>CY<font color="#000080">+</font>Cos<font color="#000080">(</font>VertAngle<font color="#000080">/</font><font color="#800000">1.592</font><font color="#000080">)*</font>Sin<font color="#000080">(</font>HorAngle<font color="#000080">/</font><font color="#800000">2.546</font><font color="#000080">)*</font><font color="#800000">90</font><font color="#000080">);
      </font>Z<font color="#000080">[</font>Count<font color="#000080">]:=</font>Round<font color="#000080">(</font>Sin<font color="#000080">(</font>VertAngle<font color="#000080">/</font><font color="#800000">1.59154931</font><font color="#000080">)*</font><font color="#800000">90</font><font color="#000080">);
      </font>Inc<font color="#000080">(</font>Count<font color="#000080">);
    </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

  </font>Count<font color="#000080">:=</font><font color="#800000">1</font><font color="#000080">;
  </font><font color="#FF0000"><b>For </b></font>HorAngle<font color="#000080">:=</font><font color="#800000">0 </font><font color="#FF0000"><b>To </b></font><font color="#800000">15 </font><font color="#FF0000"><b>Do</b></font><font color="#008000"><i>{Store face-data (Which veticies form which face}
    </i></font><font color="#FF0000"><b>For </b></font>VertAngle<font color="#000080">:=</font><font color="#800000">0 </font><font color="#FF0000"><b>To </b></font><font color="#800000">9 </font><font color="#FF0000"><b>Do Begin
      </b></font>Faces<font color="#000080">[</font>Count<font color="#000080">,</font><font color="#800000">3</font><font color="#000080">]:=</font>HorAngle<font color="#000080">*</font><font color="#800000">10</font><font color="#000080">+</font>VertAngle<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">;
      </font>Faces<font color="#000080">[</font>Count<font color="#000080">,</font><font color="#800000">2</font><font color="#000080">]:=</font>HorAngle<font color="#000080">*</font><font color="#800000">10</font><font color="#000080">+(</font>VertAngle<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">) </font><font color="#FF0000"><b>Mod </b></font><font color="#800000">10</font><font color="#000080">+</font><font color="#800000">1</font><font color="#000080">;
      </font>Faces<font color="#000080">[</font>Count<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">]:=(</font>HorAngle<font color="#000080">*</font><font color="#800000">10</font><font color="#000080">+</font>VertAngle<font color="#000080">+</font><font color="#800000">10</font><font color="#000080">) </font><font color="#FF0000"><b>Mod </b></font><font color="#800000">160</font><font color="#000080">+</font><font color="#800000">1</font><font color="#000080">;
      </font>Inc<font color="#000080">(</font>Count<font color="#000080">);
      </font>Faces<font color="#000080">[</font>Count<font color="#000080">,</font><font color="#800000">3</font><font color="#000080">]:=</font>HorAngle<font color="#000080">*</font><font color="#800000">10</font><font color="#000080">+(</font>VertAngle<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">) </font><font color="#FF0000"><b>Mod </b></font><font color="#800000">10</font><font color="#000080">+</font><font color="#800000">1</font><font color="#000080">;
      </font>Faces<font color="#000080">[</font>Count<font color="#000080">,</font><font color="#800000">2</font><font color="#000080">]:=(</font>HorAngle<font color="#000080">*</font><font color="#800000">10</font><font color="#000080">+(</font>VertAngle<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">) </font><font color="#FF0000"><b>Mod </b></font><font color="#800000">10</font><font color="#000080">+</font><font color="#800000">10</font><font color="#000080">) </font><font color="#FF0000"><b>Mod </b></font><font color="#800000">160</font><font color="#000080">+</font><font color="#800000">1</font><font color="#000080">;
      </font>Faces<font color="#000080">[</font>Count<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">]:=(</font>HorAngle<font color="#000080">*</font><font color="#800000">10</font><font color="#000080">+</font>VertAngle<font color="#000080">+</font><font color="#800000">10</font><font color="#000080">) </font><font color="#FF0000"><b>Mod </b></font><font color="#800000">160</font><font color="#000080">+</font><font color="#800000">1</font><font color="#000080">;
      </font>Inc<font color="#000080">(</font>Count<font color="#000080">);
    </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>For </b></font>Count<font color="#000080">:=</font><font color="#800000">1 </font><font color="#FF0000"><b>To </b></font><font color="#800000">320 </font><font color="#FF0000"><b>Do Begin</b></font><font color="#008000"><i>{Calculate and store face-normals}
    </i></font>RX1<font color="#000080">:=</font>X<font color="#000080">[</font>Faces<font color="#000080">[</font>Count<font color="#000080">,</font><font color="#800000">2</font><font color="#000080">]]-</font>X<font color="#000080">[</font>Faces<font color="#000080">[</font>Count<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">]];
    </font>RY1<font color="#000080">:=</font>Y<font color="#000080">[</font>Faces<font color="#000080">[</font>Count<font color="#000080">,</font><font color="#800000">2</font><font color="#000080">]]-</font>Y<font color="#000080">[</font>Faces<font color="#000080">[</font>Count<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">]];
    </font>RZ1<font color="#000080">:=</font>Z<font color="#000080">[</font>Faces<font color="#000080">[</font>Count<font color="#000080">,</font><font color="#800000">2</font><font color="#000080">]]-</font>Z<font color="#000080">[</font>Faces<font color="#000080">[</font>Count<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">]];
    </font>RX2<font color="#000080">:=</font>X<font color="#000080">[</font>Faces<font color="#000080">[</font>Count<font color="#000080">,</font><font color="#800000">3</font><font color="#000080">]]-</font>X<font color="#000080">[</font>Faces<font color="#000080">[</font>Count<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">]];
    </font>RY2<font color="#000080">:=</font>Y<font color="#000080">[</font>Faces<font color="#000080">[</font>Count<font color="#000080">,</font><font color="#800000">3</font><font color="#000080">]]-</font>Y<font color="#000080">[</font>Faces<font color="#000080">[</font>Count<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">]];
    </font>RZ2<font color="#000080">:=</font>Z<font color="#000080">[</font>Faces<font color="#000080">[</font>Count<font color="#000080">,</font><font color="#800000">3</font><font color="#000080">]]-</font>Z<font color="#000080">[</font>Faces<font color="#000080">[</font>Count<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">]];
    </font>FNX<font color="#000080">[</font>Count<font color="#000080">]:=</font>Round<font color="#000080">(</font>RY1<font color="#000080">*</font>RZ2<font color="#000080">-</font>RY2<font color="#000080">*</font>RZ1<font color="#000080">);
    </font>FNY<font color="#000080">[</font>Count<font color="#000080">]:=</font>Round<font color="#000080">(</font>RZ1<font color="#000080">*</font>RX2<font color="#000080">-</font>RZ2<font color="#000080">*</font>RX1<font color="#000080">);
    </font>FNZ<font color="#000080">[</font>Count<font color="#000080">]:=</font>Round<font color="#000080">(</font>RX1<font color="#000080">*</font>RY2<font color="#000080">-</font>RX2<font color="#000080">*</font>RY1<font color="#000080">);
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;</font><font color="#008000"><i>{CreateTorusData}

</i></font><font color="#FF0000"><b>Procedure </b></font>Initialize<font color="#000080">;
</font><font color="#FF0000"><b>Begin

  Asm </b></font><font color="#FF00FF">Mov ax,$13; Int $10 </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
  </font>GetMem<font color="#000080">(</font>Screen2<font color="#000080">,</font><font color="#800000">64000</font><font color="#000080">);
  </font>VirSeg<font color="#000080">:=</font>Seg<font color="#000080">(</font>Screen2<font color="#000080">^);

  </font>CreateTorusData<font color="#000080">;
  </font>CalcVertexNormals<font color="#000080">;

  </font><font color="#FF0000"><b>For </b></font>I<font color="#000080">:=</font><font color="#800000">0 </font><font color="#FF0000"><b>To </b></font><font color="#800000">255 </font><font color="#FF0000"><b>Do Begin
    </b></font>Cosinus<font color="#000080">[</font>I<font color="#000080">]:=</font>Round<font color="#000080">(</font>Cos<font color="#000080">(</font>I<font color="#000080">/</font><font color="#800000">40.585707465</font><font color="#000080">)*</font><font color="#800000">128</font><font color="#000080">);
    </font>Sinus<font color="#000080">[</font>I<font color="#000080">]:=</font>Round<font color="#000080">(</font>Sin<font color="#000080">(</font>I<font color="#000080">/</font><font color="#800000">40.585707465</font><font color="#000080">)*</font><font color="#800000">128</font><font color="#000080">);
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

  </font>GetMem<font color="#000080">(</font>Pict<font color="#000080">,</font><font color="#800000">65535</font><font color="#000080">);
  </font><font color="#008000"><i>{Palette-creation. Skip this one to see the non-lineair colour transition}
  </i></font><font color="#FF0000"><b>For </b></font>I<font color="#000080">:=</font><font color="#800000">1 </font><font color="#FF0000"><b>To </b></font><font color="#800000">63 </font><font color="#FF0000"><b>Do </b></font>Palette<font color="#000080">(</font>I<font color="#000080">,</font>I<font color="#000080">,</font><font color="#800000">10</font><font color="#000080">+</font>Round<font color="#000080">(</font>I<font color="#000080">/</font><font color="#800000">1.4</font><font color="#000080">),</font><font color="#800000">20</font><font color="#000080">+</font>Round<font color="#000080">(</font>I<font color="#000080">/</font><font color="#800000">1.6</font><font color="#000080">));
  </font><font color="#008000"><i>{Here, the 'phong-map' as I call it is created. Normally I use a different
   routine for that (Looks WAY better), but that one is too big}
  </i></font><font color="#FF0000"><b>For </b></font>I<font color="#000080">:=</font><font color="#800000">0 </font><font color="#FF0000"><b>To </b></font><font color="#800000">255 </font><font color="#FF0000"><b>Do For </b></font>J<font color="#000080">:=</font><font color="#800000">0 </font><font color="#FF0000"><b>To </b></font><font color="#800000">255 </font><font color="#FF0000"><b>Do Begin
    </b></font>Mem<font color="#000080">[</font>Seg<font color="#000080">(</font>Pict<font color="#000080">^):</font>Ofs<font color="#000080">(</font>Pict<font color="#000080">^)+</font>Word<font color="#000080">(</font><font color="#800000">256</font><font color="#000080">*</font>I<font color="#000080">)+</font>J<font color="#000080">]:=
        </font>Round<font color="#000080">(</font>Sqr<font color="#000080">(</font>Sqr<font color="#000080">(</font>Sin<font color="#000080">(</font>I<font color="#000080">/</font><font color="#800000">81.487</font><font color="#000080">)))*</font>Sqr<font color="#000080">(</font>Sqr<font color="#000080">(</font>Sin<font color="#000080">(</font>J<font color="#000080">/</font><font color="#800000">81.487</font><font color="#000080">)))*</font><font color="#800000">62</font><font color="#000080">)+</font><font color="#800000">1</font><font color="#000080">;
    </font><font color="#008000"><i>{Just to show you how it looks:   }
    </i></font>Mem<font color="#000080">[</font><font color="#800000">$A000</font><font color="#000080">:</font><font color="#800000">320</font><font color="#000080">*</font>Round<font color="#000080">(</font>I<font color="#000080">/</font><font color="#800000">1.25</font><font color="#000080">)+</font>J<font color="#000080">]:=</font>Mem<font color="#000080">[</font>Seg<font color="#000080">(</font>Pict<font color="#000080">^):</font>Ofs<font color="#000080">(</font>Pict<font color="#000080">^)+</font>Word<font color="#000080">(</font><font color="#800000">256</font><font color="#000080">*</font>I<font color="#000080">)+</font>J<font color="#000080">];
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>End</b></font><font color="#000080">;</font><font color="#008000"><i>{Initialize}

{----------Procedures that are time-critical (Used during rotation)----------}
</i></font><font color="#FF0000"><b>Procedure </b></font>SwapScreen<font color="#000080">; </font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Asm </b></font><font color="#FF00FF">Mov dx,$3DA; @@WaitVBL: In al,dx; and al,8; jz @@WaitVBL; Push ds;
    Lds  si,Screen2; Mov  ax,$A000; Mov  es,ax; Xor  di,di;  Mov  cx,16000;
    db $66; Rep  Movsw; Pop  ds </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>Cls<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>Where<font color="#000080">); </font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Asm </b></font><font color="#FF00FF">Les di,Where; Mov cx,16000; db $66; Xor ax,ax; db $66; Rep Stosw; </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>Quicksort<font color="#000080">(</font>Hi <font color="#000080">: </font>Integer<font color="#000080">);
</font><font color="#FF0000"><b>Procedure </b></font>Sort<font color="#000080">(</font>L<font color="#000080">,</font>R <font color="#000080">: </font>Integer<font color="#000080">);
</font><font color="#FF0000"><b>Var </b></font>I<font color="#000080">,</font>J<font color="#000080">,</font>X<font color="#000080">,</font>Y <font color="#000080">: </font>Integer<font color="#000080">;
</font><font color="#FF0000"><b>Begin
  </b></font>I<font color="#000080">:=</font>L<font color="#000080">; </font>J<font color="#000080">:=</font>R<font color="#000080">; </font>X<font color="#000080">:=</font>PolyZ<font color="#000080">[(</font>L<font color="#000080">+</font>R<font color="#000080">) </font><font color="#FF0000"><b>Div </b></font><font color="#800000">2</font><font color="#000080">];
  </font><font color="#FF0000"><b>Repeat
    While </b></font>polyz<font color="#000080">[</font>i<font color="#000080">]&gt;</font>x <font color="#FF0000"><b>do </b></font>inc<font color="#000080">(</font>i<font color="#000080">); </font><font color="#FF0000"><b>While </b></font>x<font color="#000080">&gt;</font>polyz<font color="#000080">[</font>j<font color="#000080">] </font><font color="#FF0000"><b>do </b></font>dec<font color="#000080">(</font>j<font color="#000080">);
    </font><font color="#FF0000"><b>If </b></font>I<font color="#000080">&lt;=</font>J <font color="#FF0000"><b>Then Begin
      </b></font>Y<font color="#000080">:=</font>PolyZ<font color="#000080">[</font>I<font color="#000080">]; </font>PolyZ<font color="#000080">[</font>I<font color="#000080">]:=</font>PolyZ<font color="#000080">[</font>J<font color="#000080">]; </font>PolyZ<font color="#000080">[</font>J<font color="#000080">]:=</font>Y<font color="#000080">;
      </font>Y<font color="#000080">:=</font>Pind<font color="#000080">[</font>I<font color="#000080">]; </font>Pind<font color="#000080">[</font>I<font color="#000080">]:=</font>Pind<font color="#000080">[</font>J<font color="#000080">]; </font>Pind<font color="#000080">[</font>J<font color="#000080">]:=</font>Y<font color="#000080">;
      </font>Inc<font color="#000080">(</font>I<font color="#000080">); </font>Dec<font color="#000080">(</font>J<font color="#000080">);
    </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>Until </b></font>I<font color="#000080">&gt;</font>J<font color="#000080">;
  </font><font color="#FF0000"><b>If </b></font>L<font color="#000080">&lt;</font>J <font color="#FF0000"><b>Then </b></font>Sort<font color="#000080">(</font>L<font color="#000080">,</font>J<font color="#000080">); </font><font color="#FF0000"><b>If </b></font>I<font color="#000080">&lt;</font>R <font color="#FF0000"><b>Then </b></font>Sort<font color="#000080">(</font>I<font color="#000080">,</font>R<font color="#000080">);
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Begin </b></font>Sort<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">,</font>Hi<font color="#000080">) </font><font color="#FF0000"><b>End</b></font><font color="#000080">;</font><font color="#008000"><i>{QuickSort}

</i></font><font color="#FF0000"><b>Procedure </b></font>NewTex<font color="#000080">(</font>X1<font color="#000080">,</font>Y1<font color="#000080">,</font>U1<font color="#000080">,</font>V1<font color="#000080">,</font>X2<font color="#000080">,</font>Y2<font color="#000080">,</font>U2<font color="#000080">,</font>V2<font color="#000080">,</font>X3<font color="#000080">,</font>Y3<font color="#000080">,</font>U3<font color="#000080">,</font>V3<font color="#000080">:</font>Integer<font color="#000080">;</font>Texture<font color="#000080">:</font>Pointer<font color="#000080">);
</font><font color="#008000"><i>{The actual texture-map routine. Only a little commented :-}
</i></font><font color="#FF0000"><b>Var </b></font>TexOfs                                       <font color="#000080">: </font><font color="#FF0000"><b>Array </b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">320</font><font color="#000080">] </font><font color="#FF0000"><b>Of </b></font>Word<font color="#000080">;
    </font>SO<font color="#000080">,</font>Long                                      <font color="#000080">: </font>Word<font color="#000080">;
    </font>XL<font color="#000080">,</font>UL<font color="#000080">,</font>VL<font color="#000080">,</font>XR<font color="#000080">,</font>UR<font color="#000080">,</font>VR                            <font color="#000080">: </font><font color="#FF0000"><b>Array </b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">200</font><font color="#000080">] </font><font color="#FF0000"><b>Of </b></font>LongInt<font color="#000080">;
    </font>DY21<font color="#000080">,</font>DY31<font color="#000080">,</font>DY32<font color="#000080">,</font>DX21<font color="#000080">,</font>DX31<font color="#000080">,</font>DX32<font color="#000080">,</font>DU21<font color="#000080">,</font>DU31<font color="#000080">,</font>DU32 <font color="#000080">: </font>LongInt<font color="#000080">;
    </font>DV21<font color="#000080">,</font>DV31<font color="#000080">,</font>DV32<font color="#000080">,</font>U<font color="#000080">,</font>V<font color="#000080">,</font>I<font color="#000080">,</font>J<font color="#000080">,</font>K                     <font color="#000080">: </font>LongInt<font color="#000080">;
</font><font color="#FF0000"><b>Begin

  </b></font><font color="#008000"><i>{Sort for increasing y-coordinates}
  </i></font><font color="#FF0000"><b>For </b></font>I<font color="#000080">:=</font><font color="#800000">1 </font><font color="#FF0000"><b>To </b></font><font color="#800000">2 </font><font color="#FF0000"><b>Do Begin
    If </b></font>Y3<font color="#000080">&lt;</font>Y2 <font color="#FF0000"><b>Then Begin
      </b></font>J<font color="#000080">:=</font>Y3<font color="#000080">; </font>Y3<font color="#000080">:=</font>Y2<font color="#000080">; </font>Y2<font color="#000080">:=</font>J<font color="#000080">; </font>J<font color="#000080">:=</font>X3<font color="#000080">; </font>X3<font color="#000080">:=</font>X2<font color="#000080">; </font>X2<font color="#000080">:=</font>J<font color="#000080">;
      </font>J<font color="#000080">:=</font>U3<font color="#000080">; </font>U3<font color="#000080">:=</font>U2<font color="#000080">; </font>U2<font color="#000080">:=</font>J<font color="#000080">; </font>J<font color="#000080">:=</font>V3<font color="#000080">; </font>V3<font color="#000080">:=</font>V2<font color="#000080">; </font>V2<font color="#000080">:=</font>J<font color="#000080">; </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>If </b></font>Y2<font color="#000080">&lt;</font>Y1 <font color="#FF0000"><b>Then Begin
      </b></font>J<font color="#000080">:=</font>Y1<font color="#000080">; </font>Y1<font color="#000080">:=</font>Y2<font color="#000080">; </font>Y2<font color="#000080">:=</font>J<font color="#000080">; </font>J<font color="#000080">:=</font>X1<font color="#000080">; </font>X1<font color="#000080">:=</font>X2<font color="#000080">; </font>X2<font color="#000080">:=</font>J<font color="#000080">;
      </font>J<font color="#000080">:=</font>U1<font color="#000080">; </font>U1<font color="#000080">:=</font>U2<font color="#000080">; </font>U2<font color="#000080">:=</font>J<font color="#000080">; </font>J<font color="#000080">:=</font>V1<font color="#000080">; </font>V1<font color="#000080">:=</font>V2<font color="#000080">; </font>V2<font color="#000080">:=</font>J<font color="#000080">; </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>If </b></font>Y3<font color="#000080">&lt;</font>Y1 <font color="#FF0000"><b>Then Begin
      </b></font>J<font color="#000080">:=</font>Y1<font color="#000080">; </font>Y1<font color="#000080">:=</font>Y3<font color="#000080">; </font>Y3<font color="#000080">:=</font>J<font color="#000080">; </font>J<font color="#000080">:=</font>X1<font color="#000080">; </font>X1<font color="#000080">:=</font>X3<font color="#000080">; </font>X3<font color="#000080">:=</font>J<font color="#000080">;
      </font>J<font color="#000080">:=</font>U1<font color="#000080">; </font>U1<font color="#000080">:=</font>U3<font color="#000080">; </font>U3<font color="#000080">:=</font>J<font color="#000080">; </font>J<font color="#000080">:=</font>V1<font color="#000080">; </font>V1<font color="#000080">:=</font>V3<font color="#000080">; </font>V3<font color="#000080">:=</font>J <font color="#FF0000"><b>End
  End</b></font><font color="#000080">;

  </font><font color="#008000"><i>{Exception occurs when there are two top y-coords with the same value}
  </i></font><font color="#FF0000"><b>If </b></font><font color="#000080">(</font>Y1<font color="#000080">=</font>Y2<font color="#000080">) </font><font color="#FF0000"><b>And </b></font><font color="#000080">(</font>X1<font color="#000080">&gt;</font>X2<font color="#000080">) </font><font color="#FF0000"><b>Then Begin
    </b></font>J<font color="#000080">:=</font>X1<font color="#000080">; </font>X1<font color="#000080">:=</font>X2<font color="#000080">; </font>X2<font color="#000080">:=</font>J<font color="#000080">; </font>J<font color="#000080">:=</font>U1<font color="#000080">; </font>U1<font color="#000080">:=</font>U2<font color="#000080">; </font>U2<font color="#000080">:=</font>J<font color="#000080">; </font>J<font color="#000080">:=</font>V1<font color="#000080">; </font>V1<font color="#000080">:=</font>V2<font color="#000080">; </font>V2<font color="#000080">:=</font>J <font color="#FF0000"><b>End</b></font><font color="#000080">;

  </font><font color="#008000"><i>{Calculate X,U and V along the edges and store these}
</i></font>DY21<font color="#000080">:=</font>Y2<font color="#000080">-</font>Y1<font color="#000080">; </font>DY31<font color="#000080">:=</font>Y3<font color="#000080">-</font>Y1<font color="#000080">; </font>DY32<font color="#000080">:=</font>Y3<font color="#000080">-</font>Y2<font color="#000080">; </font>DX21<font color="#000080">:=</font>X2<font color="#000080">-</font>X1<font color="#000080">; </font>DX31<font color="#000080">:=</font>X3<font color="#000080">-</font>X1<font color="#000080">; </font>DX32<font color="#000080">:=</font>X3<font color="#000080">-</font>X2<font color="#000080">;
</font>DU21<font color="#000080">:=</font>U2<font color="#000080">-</font>U1<font color="#000080">; </font>DU31<font color="#000080">:=</font>U3<font color="#000080">-</font>U1<font color="#000080">; </font>DU32<font color="#000080">:=</font>U3<font color="#000080">-</font>U2<font color="#000080">; </font>DV21<font color="#000080">:=</font>V2<font color="#000080">-</font>V1<font color="#000080">; </font>DV31<font color="#000080">:=</font>V3<font color="#000080">-</font>V1<font color="#000080">; </font>DV32<font color="#000080">:=</font>V3<font color="#000080">-</font>V2<font color="#000080">;
  </font>XL<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">]:=</font>X1<font color="#000080">; </font>XL<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">]:=</font>XL<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">]*</font><font color="#800000">256</font><font color="#000080">; </font>UL<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">]:=</font>U1<font color="#000080">;
  </font>UL<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">]:=</font>UL<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">]*</font><font color="#800000">256</font><font color="#000080">; </font>VL<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">]:=</font>V1<font color="#000080">; </font>VL<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">]:=</font>VL<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">]*</font><font color="#800000">256</font><font color="#000080">;
  </font><font color="#FF0000"><b>If </b></font>Y1<font color="#000080">=</font>Y2 <font color="#FF0000"><b>Then Begin
    </b></font>XR<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">]:=</font>X2<font color="#000080">; </font>XR<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">]:=</font>XR<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">]*</font><font color="#800000">256</font><font color="#000080">; </font>UR<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">]:=</font>U2<font color="#000080">; </font>UR<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">]:=</font>UR<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">]*</font><font color="#800000">256</font><font color="#000080">;
    </font>VR<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">]:=</font>V2<font color="#000080">; </font>VR<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">]:=</font>VR<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">]*</font><font color="#800000">256 </font><font color="#FF0000"><b>End Else Begin
    </b></font>XR<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">]:=</font>XL<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">]; </font>UR<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">]:=</font>UL<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">]; </font>VR<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">]:=</font>VL<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">]; </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>For </b></font>I<font color="#000080">:=</font>Y1<font color="#000080">+</font><font color="#800000">1 </font><font color="#FF0000"><b>To </b></font>Y2 <font color="#FF0000"><b>Do Begin
    </b></font>XL<font color="#000080">[</font>I<font color="#000080">-</font>Y1<font color="#000080">]:=</font>XL<font color="#000080">[</font>I<font color="#000080">-</font>Y1<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">]+(</font>DX31<font color="#000080">*</font><font color="#800000">256</font><font color="#000080">) </font><font color="#FF0000"><b>Div </b></font>DY31<font color="#000080">;
    </font>XR<font color="#000080">[</font>I<font color="#000080">-</font>Y1<font color="#000080">]:=</font>XR<font color="#000080">[</font>I<font color="#000080">-</font>Y1<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">]+(</font>DX21<font color="#000080">*</font><font color="#800000">256</font><font color="#000080">) </font><font color="#FF0000"><b>Div </b></font>DY21<font color="#000080">;
    </font>UL<font color="#000080">[</font>I<font color="#000080">-</font>Y1<font color="#000080">]:=</font>UL<font color="#000080">[</font>I<font color="#000080">-</font>Y1<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">]+(</font>DU31<font color="#000080">*</font><font color="#800000">256</font><font color="#000080">) </font><font color="#FF0000"><b>Div </b></font>DY31<font color="#000080">;
    </font>UR<font color="#000080">[</font>I<font color="#000080">-</font>Y1<font color="#000080">]:=</font>UR<font color="#000080">[</font>I<font color="#000080">-</font>Y1<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">]+(</font>DU21<font color="#000080">*</font><font color="#800000">256</font><font color="#000080">) </font><font color="#FF0000"><b>Div </b></font>DY21<font color="#000080">;
    </font>VL<font color="#000080">[</font>I<font color="#000080">-</font>Y1<font color="#000080">]:=</font>VL<font color="#000080">[</font>I<font color="#000080">-</font>Y1<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">]+(</font>DV31<font color="#000080">*</font><font color="#800000">256</font><font color="#000080">) </font><font color="#FF0000"><b>Div </b></font>DY31<font color="#000080">;
    </font>VR<font color="#000080">[</font>I<font color="#000080">-</font>Y1<font color="#000080">]:=</font>VR<font color="#000080">[</font>I<font color="#000080">-</font>Y1<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">]+(</font>DV21<font color="#000080">*</font><font color="#800000">256</font><font color="#000080">) </font><font color="#FF0000"><b>Div </b></font>DY21<font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>For </b></font>I<font color="#000080">:=</font>Y2<font color="#000080">+</font><font color="#800000">1 </font><font color="#FF0000"><b>To </b></font>Y3 <font color="#FF0000"><b>Do Begin
    </b></font>XL<font color="#000080">[</font>I<font color="#000080">-</font>Y1<font color="#000080">]:=</font>XL<font color="#000080">[</font>I<font color="#000080">-</font>Y1<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">]+(</font>DX31<font color="#000080">*</font><font color="#800000">256</font><font color="#000080">) </font><font color="#FF0000"><b>Div </b></font>DY31<font color="#000080">;
    </font>XR<font color="#000080">[</font>I<font color="#000080">-</font>Y1<font color="#000080">]:=</font>XR<font color="#000080">[</font>I<font color="#000080">-</font>Y1<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">]+(</font>DX32<font color="#000080">*</font><font color="#800000">256</font><font color="#000080">) </font><font color="#FF0000"><b>Div </b></font>DY32<font color="#000080">;
    </font>UL<font color="#000080">[</font>I<font color="#000080">-</font>Y1<font color="#000080">]:=</font>UL<font color="#000080">[</font>I<font color="#000080">-</font>Y1<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">]+(</font>DU31<font color="#000080">*</font><font color="#800000">256</font><font color="#000080">) </font><font color="#FF0000"><b>Div </b></font>DY31<font color="#000080">;
    </font>UR<font color="#000080">[</font>I<font color="#000080">-</font>Y1<font color="#000080">]:=</font>UR<font color="#000080">[</font>I<font color="#000080">-</font>Y1<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">]+(</font>DU32<font color="#000080">*</font><font color="#800000">256</font><font color="#000080">) </font><font color="#FF0000"><b>Div </b></font>DY32<font color="#000080">;
    </font>VL<font color="#000080">[</font>I<font color="#000080">-</font>Y1<font color="#000080">]:=</font>VL<font color="#000080">[</font>I<font color="#000080">-</font>Y1<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">]+(</font>DV31<font color="#000080">*</font><font color="#800000">256</font><font color="#000080">) </font><font color="#FF0000"><b>Div </b></font>DY31<font color="#000080">;
    </font>VR<font color="#000080">[</font>I<font color="#000080">-</font>Y1<font color="#000080">]:=</font>VR<font color="#000080">[</font>I<font color="#000080">-</font>Y1<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">]+(</font>DV32<font color="#000080">*</font><font color="#800000">256</font><font color="#000080">) </font><font color="#FF0000"><b>Div </b></font>DY32<font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

  </font><font color="#008000"><i>{Calculate texture-offsets for longest horizontal line (at Y=Y2)}
  </i></font>Long<font color="#000080">:=</font>Y2<font color="#000080">-</font>Y1<font color="#000080">;
  </font><font color="#FF0000"><b>If </b></font>XL<font color="#000080">[</font>Long<font color="#000080">]&lt;</font>XR<font color="#000080">[</font>Long<font color="#000080">] </font><font color="#FF0000"><b>Then Begin
    </b></font>U<font color="#000080">:=</font>UL<font color="#000080">[</font>Long<font color="#000080">]; </font>V<font color="#000080">:=</font>VL<font color="#000080">[</font>Long<font color="#000080">]; </font>SO<font color="#000080">:=</font><font color="#800000">256</font><font color="#000080">*(</font>V <font color="#FF0000"><b>Shr </b></font><font color="#800000">8</font><font color="#000080">)+(</font>U <font color="#FF0000"><b>Shr </b></font><font color="#800000">8</font><font color="#000080">);
    </font><font color="#FF0000"><b>For </b></font>I<font color="#000080">:=</font><font color="#800000">0 </font><font color="#FF0000"><b>To </b></font>XR<font color="#000080">[</font>Long<font color="#000080">] </font><font color="#FF0000"><b>Shr </b></font><font color="#800000">8</font><font color="#000080">-</font>XL<font color="#000080">[</font>Long<font color="#000080">] </font><font color="#FF0000"><b>Shr </b></font><font color="#800000">8 </font><font color="#FF0000"><b>Do Begin
      </b></font>TexOfs<font color="#000080">[</font>I<font color="#000080">]:=</font><font color="#800000">256</font><font color="#000080">*(</font>V <font color="#FF0000"><b>Shr </b></font><font color="#800000">8</font><font color="#000080">)+(</font>U <font color="#FF0000"><b>Shr </b></font><font color="#800000">8</font><font color="#000080">)-</font>SO<font color="#000080">;
      </font>U<font color="#000080">:=</font>U<font color="#000080">+((</font>UR<font color="#000080">[</font>Long<font color="#000080">]-</font>UL<font color="#000080">[</font>Long<font color="#000080">])*</font><font color="#800000">256</font><font color="#000080">) </font><font color="#FF0000"><b>Div </b></font><font color="#000080">(</font>XR<font color="#000080">[</font>Long<font color="#000080">]-</font>XL<font color="#000080">[</font>Long<font color="#000080">]+</font><font color="#800000">1</font><font color="#000080">);
      </font>V<font color="#000080">:=</font>V<font color="#000080">+((</font>VR<font color="#000080">[</font>Long<font color="#000080">]-</font>VL<font color="#000080">[</font>Long<font color="#000080">])*</font><font color="#800000">256</font><font color="#000080">) </font><font color="#FF0000"><b>Div </b></font><font color="#000080">(</font>XR<font color="#000080">[</font>Long<font color="#000080">]-</font>XL<font color="#000080">[</font>Long<font color="#000080">]+</font><font color="#800000">1</font><font color="#000080">);
    </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>End Else Begin
    </b></font>U<font color="#000080">:=</font>UR<font color="#000080">[</font>Long<font color="#000080">]; </font>V<font color="#000080">:=</font>VR<font color="#000080">[</font>Long<font color="#000080">]; </font>SO<font color="#000080">:=</font><font color="#800000">256</font><font color="#000080">*(</font>V <font color="#FF0000"><b>Shr </b></font><font color="#800000">8</font><font color="#000080">)+(</font>U <font color="#FF0000"><b>Shr </b></font><font color="#800000">8</font><font color="#000080">);
    </font><font color="#FF0000"><b>For </b></font>I<font color="#000080">:=</font><font color="#800000">0 </font><font color="#FF0000"><b>To </b></font>XL<font color="#000080">[</font>Long<font color="#000080">] </font><font color="#FF0000"><b>Shr </b></font><font color="#800000">8</font><font color="#000080">-</font>XR<font color="#000080">[</font>Long<font color="#000080">] </font><font color="#FF0000"><b>Shr </b></font><font color="#800000">8 </font><font color="#FF0000"><b>Do Begin
      </b></font>TexOfs<font color="#000080">[</font>I<font color="#000080">]:=</font><font color="#800000">256</font><font color="#000080">*(</font>V <font color="#FF0000"><b>Shr </b></font><font color="#800000">8</font><font color="#000080">)+(</font>U <font color="#FF0000"><b>Shr </b></font><font color="#800000">8</font><font color="#000080">)-</font>SO<font color="#000080">;
      </font>U<font color="#000080">:=</font>U<font color="#000080">+((</font>UL<font color="#000080">[</font>Long<font color="#000080">]-</font>UR<font color="#000080">[</font>Long<font color="#000080">])*</font><font color="#800000">256</font><font color="#000080">) </font><font color="#FF0000"><b>Div </b></font><font color="#000080">(</font>XL<font color="#000080">[</font>Long<font color="#000080">]-</font>XR<font color="#000080">[</font>Long<font color="#000080">]+</font><font color="#800000">1</font><font color="#000080">);
      </font>V<font color="#000080">:=</font>V<font color="#000080">+((</font>VL<font color="#000080">[</font>Long<font color="#000080">]-</font>VR<font color="#000080">[</font>Long<font color="#000080">])*</font><font color="#800000">256</font><font color="#000080">) </font><font color="#FF0000"><b>Div </b></font><font color="#000080">(</font>XL<font color="#000080">[</font>Long<font color="#000080">]-</font>XR<font color="#000080">[</font>Long<font color="#000080">]+</font><font color="#800000">1</font><font color="#000080">);
    </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

  </font><font color="#008000"><i>{Fill polygon (=Read back X,U and V-coordinates from buffer) }
  </i></font><font color="#FF0000"><b>If </b></font>XL<font color="#000080">[</font>Long<font color="#000080">]&lt;</font>XR<font color="#000080">[</font>Long<font color="#000080">] </font><font color="#FF0000"><b>Then
    For </b></font>I<font color="#000080">:=</font><font color="#800000">0 </font><font color="#FF0000"><b>To </b></font>Y3<font color="#000080">-</font>Y1 <font color="#FF0000"><b>Do Begin
      </b></font>SO<font color="#000080">:=</font><font color="#800000">256</font><font color="#000080">*(</font>VL<font color="#000080">[</font>I<font color="#000080">] </font><font color="#FF0000"><b>Shr </b></font><font color="#800000">8</font><font color="#000080">)+(</font>UL<font color="#000080">[</font>I<font color="#000080">] </font><font color="#FF0000"><b>Shr </b></font><font color="#800000">8</font><font color="#000080">);
      </font><font color="#FF0000"><b>For </b></font>J<font color="#000080">:=</font>XL<font color="#000080">[</font>I<font color="#000080">] </font><font color="#FF0000"><b>Shr </b></font><font color="#800000">8 </font><font color="#FF0000"><b>To </b></font>XR<font color="#000080">[</font>I<font color="#000080">] </font><font color="#FF0000"><b>Shr </b></font><font color="#800000">8 </font><font color="#FF0000"><b>Do
        </b></font>Mem<font color="#000080">[</font>VirSeg<font color="#000080">:</font><font color="#800000">320</font><font color="#000080">*(</font>I<font color="#000080">+</font>Y1<font color="#000080">)+</font>J<font color="#000080">]:=</font>Mem<font color="#000080">[</font>Seg<font color="#000080">(</font>Texture<font color="#000080">^):</font>Ofs<font color="#000080">(</font>Texture<font color="#000080">^)+</font>SO<font color="#000080">+
                                      </font>TexOfs<font color="#000080">[</font>J<font color="#000080">-</font>XL<font color="#000080">[</font>I<font color="#000080">] </font><font color="#FF0000"><b>Shr </b></font><font color="#800000">8</font><font color="#000080">]]
    </font><font color="#FF0000"><b>End
  Else
    For </b></font>I<font color="#000080">:=</font><font color="#800000">0 </font><font color="#FF0000"><b>To </b></font>Y3<font color="#000080">-</font>Y1 <font color="#FF0000"><b>Do Begin
      </b></font>SO<font color="#000080">:=</font><font color="#800000">256</font><font color="#000080">*(</font>VR<font color="#000080">[</font>I<font color="#000080">] </font><font color="#FF0000"><b>Shr </b></font><font color="#800000">8</font><font color="#000080">)+(</font>UR<font color="#000080">[</font>I<font color="#000080">] </font><font color="#FF0000"><b>Shr </b></font><font color="#800000">8</font><font color="#000080">);
      </font><font color="#FF0000"><b>For </b></font>J<font color="#000080">:=</font>XR<font color="#000080">[</font>I<font color="#000080">] </font><font color="#FF0000"><b>Shr </b></font><font color="#800000">8 </font><font color="#FF0000"><b>To </b></font>XL<font color="#000080">[</font>I<font color="#000080">] </font><font color="#FF0000"><b>Shr </b></font><font color="#800000">8 </font><font color="#FF0000"><b>Do
        </b></font>Mem<font color="#000080">[</font>VirSeg<font color="#000080">:</font><font color="#800000">320</font><font color="#000080">*(</font>I<font color="#000080">+</font>Y1<font color="#000080">)+</font>J<font color="#000080">]:=</font>Mem<font color="#000080">[</font>Seg<font color="#000080">(</font>Texture<font color="#000080">^):</font>Ofs<font color="#000080">(</font>Texture<font color="#000080">^)+</font>SO<font color="#000080">+
                                      </font>TexOfs<font color="#000080">[</font>J<font color="#000080">-</font>XR<font color="#000080">[</font>I<font color="#000080">] </font><font color="#FF0000"><b>Shr </b></font><font color="#800000">8</font><font color="#000080">]]
    </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;</font><font color="#008000"><i>{NewTex}

</i></font><font color="#FF0000"><b>Procedure </b></font>Rotate<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>X<font color="#000080">,</font>Y<font color="#000080">,</font>Z<font color="#000080">:</font>Integer<font color="#000080">;</font>Alpha<font color="#000080">,</font>Beta<font color="#000080">,</font>Gamma<font color="#000080">:</font>Byte<font color="#000080">);
</font><font color="#FF0000"><b>Var </b></font>X2<font color="#000080">,</font>X3<font color="#000080">,</font>Y1<font color="#000080">,</font>Y3<font color="#000080">,</font>Z1<font color="#000080">,</font>Z2 <font color="#000080">: </font>Integer<font color="#000080">;
</font><font color="#FF0000"><b>Begin
  </b></font>Y1<font color="#000080">:=(</font>Cosinus<font color="#000080">[</font>Alpha<font color="#000080">]*</font>Y<font color="#000080">-</font>Sinus<font color="#000080">[</font>Alpha<font color="#000080">]*</font>Z<font color="#000080">) </font><font color="#FF0000"><b>Div </b></font><font color="#800000">128</font><font color="#000080">;
  </font>Z1<font color="#000080">:=(</font>Sinus<font color="#000080">[</font>Alpha<font color="#000080">]*</font>Y<font color="#000080">+</font>Cosinus<font color="#000080">[</font>Alpha<font color="#000080">]*</font>Z<font color="#000080">) </font><font color="#FF0000"><b>Div </b></font><font color="#800000">128</font><font color="#000080">;
  </font>X2<font color="#000080">:=(</font>Cosinus<font color="#000080">[</font>Beta<font color="#000080">]*</font>X<font color="#000080">+</font>Sinus<font color="#000080">[</font>Beta<font color="#000080">]*</font>Z1<font color="#000080">) </font><font color="#FF0000"><b>Div </b></font><font color="#800000">128</font><font color="#000080">;
  </font>Z<font color="#000080">:=(</font>Cosinus<font color="#000080">[</font>Beta<font color="#000080">]*</font>Z1<font color="#000080">-</font>Sinus<font color="#000080">[</font>Beta<font color="#000080">]*</font>X<font color="#000080">) </font><font color="#FF0000"><b>Div </b></font><font color="#800000">128</font><font color="#000080">;
  </font>X<font color="#000080">:=(</font>Cosinus<font color="#000080">[</font>Gamma<font color="#000080">]*</font>X2<font color="#000080">-</font>Sinus<font color="#000080">[</font>Gamma<font color="#000080">]*</font>Y1<font color="#000080">) </font><font color="#FF0000"><b>Div </b></font><font color="#800000">128</font><font color="#000080">;
  </font>Y<font color="#000080">:=(</font>Sinus<font color="#000080">[</font>Gamma<font color="#000080">]*</font>X2<font color="#000080">+</font>Cosinus<font color="#000080">[</font>Gamma<font color="#000080">]*</font>Y1<font color="#000080">) </font><font color="#FF0000"><b>Div </b></font><font color="#800000">128</font><font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;</font><font color="#008000"><i>{Rotate}

{--------------------------Main program-------------------------------------}

</i></font><font color="#FF0000"><b>Begin

  </b></font>Initialize<font color="#000080">; </font>EyeDist<font color="#000080">:=</font><font color="#800000">150</font><font color="#000080">; </font>Alpha<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">; </font>Beta<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">; </font>Gamma<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
  </font>Aantal<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">; </font>T1<font color="#000080">:=</font>Time<font color="#000080">;
  </font><font color="#FF0000"><b>Repeat
    </b></font>Cls<font color="#000080">(</font>Screen2<font color="#000080">^);

    </font><font color="#FF0000"><b>For </b></font>I<font color="#000080">:=</font><font color="#800000">1 </font><font color="#FF0000"><b>To </b></font>NumOfVerts <font color="#FF0000"><b>do Begin
      </b></font><font color="#008000"><i>{Rotate the vertex-coordinates}
      </i></font>XT1<font color="#000080">:=</font>X<font color="#000080">[</font>I<font color="#000080">]; </font>YT1<font color="#000080">:=</font>Y<font color="#000080">[</font>I<font color="#000080">]; </font>ZT1<font color="#000080">:=</font>Z<font color="#000080">[</font>I<font color="#000080">];
      </font>Rotate<font color="#000080">(</font>XT1<font color="#000080">,</font>YT1<font color="#000080">,</font>ZT1<font color="#000080">,</font>Alpha<font color="#000080">,</font>Beta<font color="#000080">,</font>Gamma<font color="#000080">);
      </font>Inc<font color="#000080">(</font>ZT1<font color="#000080">,</font><font color="#800000">468</font><font color="#000080">);
      </font>BX<font color="#000080">[</font>I<font color="#000080">]:=</font><font color="#800000">160</font><font color="#000080">+(</font>XT1<font color="#000080">*</font>EyeDist<font color="#000080">) </font><font color="#FF0000"><b>Div </b></font>ZT1<font color="#000080">;
      </font>BY<font color="#000080">[</font>I<font color="#000080">]:=</font><font color="#800000">100</font><font color="#000080">+((</font>YT1<font color="#000080">*</font>EyeDist<font color="#000080">*</font><font color="#800000">83</font><font color="#000080">) </font><font color="#FF0000"><b>Div </b></font><font color="#800000">100</font><font color="#000080">) </font><font color="#FF0000"><b>Div </b></font>ZT1<font color="#000080">;
      </font>BZ<font color="#000080">[</font>I<font color="#000080">]:=</font>ZT1<font color="#000080">;
      </font><font color="#008000"><i>{Rotate vertex normals (Here's where the phong-shading is done}
      </i></font>XT1<font color="#000080">:=</font>NX<font color="#000080">[</font>I<font color="#000080">]; </font>YT1<font color="#000080">:=</font>NY<font color="#000080">[</font>I<font color="#000080">]; </font>ZT1<font color="#000080">:=</font>NZ<font color="#000080">[</font>I<font color="#000080">];
      </font>Rotate<font color="#000080">(</font>XT1<font color="#000080">,</font>YT1<font color="#000080">,</font>ZT1<font color="#000080">,</font>Alpha<font color="#000080">,</font>Beta<font color="#000080">,</font>Gamma<font color="#000080">);
      </font>UT<font color="#000080">[</font>I<font color="#000080">]:=</font><font color="#800000">128</font><font color="#000080">+</font>XT1<font color="#000080">; </font>VT<font color="#000080">[</font>I<font color="#000080">]:=</font><font color="#800000">128</font><font color="#000080">+</font>YT1<font color="#000080">;
    </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

    </font><font color="#008000"><i>{Sort the polygons by z-value, so I know in which order to draw them}
    </i></font>NumVisible<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
    </font><font color="#FF0000"><b>For </b></font>I<font color="#000080">:=</font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>NumOfFaces <font color="#FF0000"><b>Do
      If </b></font><font color="#000080">(</font>BX<font color="#000080">[</font>Faces<font color="#000080">[</font>I<font color="#000080">,</font><font color="#800000">3</font><font color="#000080">]]-</font>BX<font color="#000080">[</font>Faces<font color="#000080">[</font>I<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">]])*(</font>BY<font color="#000080">[</font>Faces<font color="#000080">[</font>I<font color="#000080">,</font><font color="#800000">2</font><font color="#000080">]]-</font>BY<font color="#000080">[</font>Faces<font color="#000080">[</font>I<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">]])-
      (</font>BX<font color="#000080">[</font>Faces<font color="#000080">[</font>I<font color="#000080">,</font><font color="#800000">2</font><font color="#000080">]]-</font>BX<font color="#000080">[</font>Faces<font color="#000080">[</font>I<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">]])*(</font>BY<font color="#000080">[</font>Faces<font color="#000080">[</font>I<font color="#000080">,</font><font color="#800000">3</font><font color="#000080">]]-</font>BY<font color="#000080">[</font>Faces<font color="#000080">[</font>I<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">]])&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>Then
      Begin
        </b></font>Inc<font color="#000080">(</font>NumVisible<font color="#000080">); </font>Pind<font color="#000080">[</font>NumVisible<font color="#000080">]:=</font>I<font color="#000080">;
        </font>PolyZ<font color="#000080">[</font>NumVisible<font color="#000080">]:=</font>BZ<font color="#000080">[</font>Faces<font color="#000080">[</font>I<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">]]+</font>BZ<font color="#000080">[</font>Faces<font color="#000080">[</font>I<font color="#000080">,</font><font color="#800000">2</font><font color="#000080">]]+</font>BZ<font color="#000080">[</font>Faces<font color="#000080">[</font>I<font color="#000080">,</font><font color="#800000">3</font><font color="#000080">]];
      </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

    </font>QuickSort<font color="#000080">(</font>NumVisible<font color="#000080">);

    </font><font color="#008000"><i>{Draw the object}
    </i></font><font color="#FF0000"><b>For </b></font>I<font color="#000080">:=</font><font color="#800000">1 </font><font color="#FF0000"><b>To </b></font>NumVisible <font color="#FF0000"><b>Do
      </b></font>NewTex<font color="#000080">(</font>BX<font color="#000080">[</font>Faces<font color="#000080">[</font>Pind<font color="#000080">[</font>I<font color="#000080">],</font><font color="#800000">1</font><font color="#000080">]],</font>BY<font color="#000080">[</font>Faces<font color="#000080">[</font>Pind<font color="#000080">[</font>I<font color="#000080">],</font><font color="#800000">1</font><font color="#000080">]],
             </font>UT<font color="#000080">[</font>Faces<font color="#000080">[</font>Pind<font color="#000080">[</font>I<font color="#000080">],</font><font color="#800000">1</font><font color="#000080">]],</font>VT<font color="#000080">[</font>Faces<font color="#000080">[</font>Pind<font color="#000080">[</font>I<font color="#000080">],</font><font color="#800000">1</font><font color="#000080">]],
             </font>BX<font color="#000080">[</font>Faces<font color="#000080">[</font>Pind<font color="#000080">[</font>I<font color="#000080">],</font><font color="#800000">2</font><font color="#000080">]],</font>BY<font color="#000080">[</font>Faces<font color="#000080">[</font>Pind<font color="#000080">[</font>I<font color="#000080">],</font><font color="#800000">2</font><font color="#000080">]],
             </font>UT<font color="#000080">[</font>Faces<font color="#000080">[</font>Pind<font color="#000080">[</font>I<font color="#000080">],</font><font color="#800000">2</font><font color="#000080">]],</font>VT<font color="#000080">[</font>Faces<font color="#000080">[</font>Pind<font color="#000080">[</font>I<font color="#000080">],</font><font color="#800000">2</font><font color="#000080">]],
             </font>BX<font color="#000080">[</font>Faces<font color="#000080">[</font>Pind<font color="#000080">[</font>I<font color="#000080">],</font><font color="#800000">3</font><font color="#000080">]],</font>BY<font color="#000080">[</font>Faces<font color="#000080">[</font>Pind<font color="#000080">[</font>I<font color="#000080">],</font><font color="#800000">3</font><font color="#000080">]],
             </font>UT<font color="#000080">[</font>Faces<font color="#000080">[</font>Pind<font color="#000080">[</font>I<font color="#000080">],</font><font color="#800000">3</font><font color="#000080">]],</font>VT<font color="#000080">[</font>Faces<font color="#000080">[</font>Pind<font color="#000080">[</font>I<font color="#000080">],</font><font color="#800000">3</font><font color="#000080">]],</font>Pict<font color="#000080">);

    </font>Alpha<font color="#000080">:=(</font>Alpha<font color="#000080">+</font><font color="#800000">2</font><font color="#000080">)</font><font color="#FF0000"><b>Mod </b></font><font color="#800000">256</font><font color="#000080">;</font>Beta<font color="#000080">:=(</font>Beta<font color="#000080">+</font><font color="#800000">255</font><font color="#000080">)</font><font color="#FF0000"><b>Mod </b></font><font color="#800000">256</font><font color="#000080">;</font>Gamma<font color="#000080">:=(</font>Gamma<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">)</font><font color="#FF0000"><b>Mod </b></font><font color="#800000">256</font><font color="#000080">;
    </font>Inc<font color="#000080">(</font>Aantal<font color="#000080">); </font>SwapScreen<font color="#000080">;
  </font><font color="#FF0000"><b>Until </b></font>KeyPressed<font color="#000080">;

  </font>T1<font color="#000080">:=</font>Time<font color="#000080">-</font>T1<font color="#000080">; </font>TextMode<font color="#000080">(</font>LastMode<font color="#000080">);
  </font>WriteLn<font color="#000080">(</font>Aantal<font color="#000080">/(</font>T1<font color="#000080">/</font><font color="#800000">18.2</font><font color="#000080">) :</font><font color="#800000">1</font><font color="#000080">:</font><font color="#800000">2</font><font color="#000080">,</font><font color="#800000">' Frames per second'</font><font color="#000080">);
  </font>ReadLn<font color="#000080">; </font>Dispose<font color="#000080">(</font>Pict<font color="#000080">);</font>Dispose<font color="#000080">(</font>Screen2<font color="#000080">);
</font><font color="#FF0000"><b>End</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to EGAVGA SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0264.PAS">Original</a><b>]</b></p></body>
</html>
