<html>
<head><title> "VGA Fonts from file" by SEAN PALMER</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to EGAVGA SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0043.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
  Sean Palmer

&gt; Does anyone know of any way to display a single screen of Graphics on
&gt; EGA 640x350 mode *quickly*.  It can be VGA as well; I'm just trying to
&gt; display the screen *fast* from a disk File.  I know, I could have used
&gt; the GIF or PCX format (or any other format), but I want to make a
&gt; proprietary format to deter hacking of the picture.  So, what I want to
&gt; know is how to read the data from disk directly to screen.  I've
&gt; figured out that BlockRead (if I can get it to work) is the best method
&gt; of reading the data from the disk, but I don't know of any fast, and I
&gt; mean *fast*, methods of writing the data to the screen.  Would it be
&gt; feasible to use an Array the size of the screen and Move the Array to
&gt; the screen (I'd need memory locations For that, if possible)?  Any
&gt; response (ideas, solutions, code fragments) would be appreciated.

You could set up the screen as an Absolute Variable.
Then read in each plane as an Array DIRECTLY from the disk File.
Before reading each plane, set up Write mode 0 (should be already in mode 0)
and make sure that the enable set/reset register is set to 0 so that the cpu
Writes go directly to the planes. Set the sequencer map mask register for
each plane so you only Write to them one at a time. and enable the entire Bit
Mask register ($0F). Then after telling it which plane, read directly from
the File. No I haven't tested the following code and most of it's gonna be
from memory but give it a try:

the File:
  Plane 0
  Plane 1
  Plane 2
  Plane 3

each Plane:
  350 rows of 80 Bytes (each bit belongs to a different pixel)
}

</i></font><font color="#FF0000"><b>Type
  </b></font>scrRec <font color="#000080">= </font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">640 </font><font color="#000080">* </font><font color="#800000">350 </font><font color="#FF0000"><b>div </b></font><font color="#800000">8 </font><font color="#000080">- </font><font color="#800000">1</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Byte<font color="#000080">;
</font><font color="#FF0000"><b>Var
  </b></font>screen <font color="#000080">: </font>scrRec <font color="#FF0000"><b>Absolute </b></font><font color="#800000">$A000 </font><font color="#000080">: </font><font color="#800000">0000</font><font color="#000080">;
  </font>dFile  <font color="#000080">: </font><font color="#FF0000"><b>File of </b></font>scrRec<font color="#000080">;

</font><font color="#FF0000"><b>Const
  </b></font>gcPort  <font color="#000080">= </font><font color="#800000">$3CE</font><font color="#000080">;  </font><font color="#008000"><i>{EGA/VGA Graphics controller port}
  </i></font>seqPort <font color="#000080">= </font><font color="#800000">$3C4</font><font color="#000080">;  </font><font color="#008000"><i>{EGA/VGA sequencer port}

</i></font><font color="#FF0000"><b>Procedure </b></font>readFileToMode10h<font color="#000080">(</font>s<font color="#000080">:</font><font color="#FF0000"><b>String</b></font><font color="#000080">);
</font><font color="#FF0000"><b>Var
  </b></font>dFile <font color="#000080">: </font><font color="#FF0000"><b>File of </b></font>scrRec<font color="#000080">;
  </font>i     <font color="#000080">: </font>Byte<font color="#000080">;
</font><font color="#FF0000"><b>begin
  Asm
    </b></font><font color="#FF00FF">mov ax, $10;
    int $10;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;  </font><font color="#008000"><i>{set up video mode}
  </i></font>assign <font color="#000080">(</font>dFile<font color="#000080">,</font>s<font color="#000080">);
  </font>reset<font color="#000080">(</font>s<font color="#000080">);  </font><font color="#008000"><i>{no error checking 8) }
  </i></font>portw<font color="#000080">[</font>gcPort<font color="#000080">] := </font><font color="#800000">$0001</font><font color="#000080">;    </font><font color="#008000"><i>{clear enable set/reset reg}
  </i></font>portw<font color="#000080">[</font>gcPort<font color="#000080">] := </font><font color="#800000">$FF08</font><font color="#000080">;    </font><font color="#008000"><i>{set entire bit mask (this is the default?)}
  </i></font><font color="#FF0000"><b>For </b></font>i <font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font><font color="#800000">3 </font><font color="#FF0000"><b>do
  begin
   </b></font><font color="#008000"><i>{set map mask reg to correct plane}
   </i></font>portw<font color="#000080">[</font>seqPort<font color="#000080">] := (</font><font color="#800000">1 </font><font color="#FF0000"><b>shl </b></font><font color="#000080">(</font>i <font color="#000080">+ </font><font color="#800000">8</font><font color="#000080">)) + </font><font color="#800000">$02</font><font color="#000080">;
   </font>read<font color="#000080">(</font>dFile<font color="#000080">, </font>screen<font color="#000080">); </font><font color="#008000"><i>{load that plane in}
  </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>portw<font color="#000080">[</font>seqPort<font color="#000080">] := </font><font color="#800000">$0F02</font><font color="#000080">;   </font><font color="#008000"><i>{restore stuff to normal}
  </i></font>portw<font color="#000080">[</font>gcPort<font color="#000080">]  := </font><font color="#800000">$0F01</font><font color="#000080">;
  </font>close<font color="#000080">(</font>dFile<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to EGAVGA SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0043.PAS">Original</a><b>]</b></p></body>
</html>
