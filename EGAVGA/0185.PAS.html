<html>
<head><title> "Vesa and 320x200x256" by JOHN STEPHENSON</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to EGAVGA SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0185.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{CF&gt; Does any one have code to do Vesa 320x200x256?  Also page flipping?
 CF&gt; And s' stuff? }

 
{Here's my VESA unit}
 
{$A+,B-,D+,E+,F-,G+,I-,L+,N-,O-,P-,Q-,R-,S-,T-,V+,X+}
{$M 1024,0,65536}
</i></font><font color="#FF0000"><b>Unit </b></font>Vesa<font color="#000080">;
</font><font color="#FF0000"><b>Interface
Uses </b></font>Crt<font color="#000080">,</font>Dos<font color="#000080">;
</font><font color="#FF0000"><b>Var
  </b></font>xMax<font color="#000080">,
  </font>yMax<font color="#000080">: </font>word<font color="#000080">; </font><font color="#008000"><i>{ VERY important you set these upon init'ing }
</i></font><font color="#FF0000"><b>Type
  </b></font>tRGB <font color="#000080">= </font><font color="#FF0000"><b>record </b></font>R<font color="#000080">,</font>G<font color="#000080">,</font>B<font color="#000080">: </font>byte<font color="#000080">; </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>tDAC <font color="#000080">= </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">255</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>tRGB<font color="#000080">;
</font><font color="#FF0000"><b>Const
  </b></font><font color="#008000"><i>{ Standard text }
  </i></font>_40x25t        <font color="#000080">= </font><font color="#800000">$02</font><font color="#000080">;
  </font>_80x25t        <font color="#000080">= </font><font color="#800000">$03</font><font color="#000080">;
  </font><font color="#008000"><i>{ Standard VGA }
  </i></font>_640x480x2     <font color="#000080">= </font><font color="#800000">$11</font><font color="#000080">;
  </font>_640x480x16    <font color="#000080">= </font><font color="#800000">$12</font><font color="#000080">;
  </font>_320x200x256   <font color="#000080">= </font><font color="#800000">$13</font><font color="#000080">;
  </font><font color="#008000"><i>{ Standard VESA }
  </i></font>_640x400x256   <font color="#000080">= </font><font color="#800000">$100</font><font color="#000080">;
  </font>_640x480x256   <font color="#000080">= </font><font color="#800000">$101</font><font color="#000080">;
  </font>_800x600x16    <font color="#000080">= </font><font color="#800000">$102</font><font color="#000080">;
  </font>_800x600x256   <font color="#000080">= </font><font color="#800000">$103</font><font color="#000080">;
  </font>_1024x768x16   <font color="#000080">= </font><font color="#800000">$104</font><font color="#000080">;
  </font>_1024x768x256  <font color="#000080">= </font><font color="#800000">$105</font><font color="#000080">;
  </font>_1280x1024x16  <font color="#000080">= </font><font color="#800000">$106</font><font color="#000080">;
  </font>_1280x1024x256 <font color="#000080">= </font><font color="#800000">$107</font><font color="#000080">;
  </font><font color="#008000"><i>{ Textmode modes for VESA }
  </i></font>_80x60t        <font color="#000080">= </font><font color="#800000">$108</font><font color="#000080">;
  </font>_132x25t       <font color="#000080">= </font><font color="#800000">$109</font><font color="#000080">;
  </font>_132x43t       <font color="#000080">= </font><font color="#800000">$10A</font><font color="#000080">;
  </font>_132x50t       <font color="#000080">= </font><font color="#800000">$10B</font><font color="#000080">;
  </font>_132x60t       <font color="#000080">= </font><font color="#800000">$10C</font><font color="#000080">;
  </font><font color="#008000"><i>{ Pretty much standard VESA }
  </i></font>_320x200x32K   <font color="#000080">= </font><font color="#800000">$10D</font><font color="#000080">;
  </font>_320x200x64K   <font color="#000080">= </font><font color="#800000">$10E</font><font color="#000080">;
  </font>_320x200x16M   <font color="#000080">= </font><font color="#800000">$10F</font><font color="#000080">;
  </font>_640x480x32K   <font color="#000080">= </font><font color="#800000">$110</font><font color="#000080">;
  </font>_640x480x64K   <font color="#000080">= </font><font color="#800000">$111</font><font color="#000080">;
  </font>_640x480x16M   <font color="#000080">= </font><font color="#800000">$112</font><font color="#000080">;
  </font>_800x600x32K   <font color="#000080">= </font><font color="#800000">$113</font><font color="#000080">;
  </font>_800x600x64K   <font color="#000080">= </font><font color="#800000">$114</font><font color="#000080">;
  </font>_800x600x16M   <font color="#000080">= </font><font color="#800000">$115</font><font color="#000080">;
  </font>_1024x768x32K  <font color="#000080">= </font><font color="#800000">$116</font><font color="#000080">;
  </font>_1024x768x64K  <font color="#000080">= </font><font color="#800000">$117</font><font color="#000080">;
  </font>_1024x768x16M  <font color="#000080">= </font><font color="#800000">$118</font><font color="#000080">;
  </font>_1280x1024x32K <font color="#000080">= </font><font color="#800000">$119</font><font color="#000080">;
  </font>_1280x1024x64K <font color="#000080">= </font><font color="#800000">$11A</font><font color="#000080">;
  </font>_1280x1024x16M <font color="#000080">= </font><font color="#800000">$11B</font><font color="#000080">;
</font><font color="#FF0000"><b>Var
  </b></font>Current_bank<font color="#000080">: </font>byte<font color="#000080">;
  </font>Pp<font color="#000080">: </font>byte<font color="#000080">;
</font><font color="#FF0000"><b>Const
  </b></font>vCycle_direction<font color="#000080">: </font>byte <font color="#000080">= </font><font color="#800000">1</font><font color="#000080">;

</font><font color="#008000"><i>{&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;}
</i></font><font color="#FF0000"><b>Procedure </b></font>Clearscreen<font color="#000080">(</font>c<font color="#000080">: </font>byte<font color="#000080">);
</font><font color="#FF0000"><b>procedure </b></font>Line<font color="#000080">(</font>X1<font color="#000080">,</font>Y1<font color="#000080">,</font>X2<font color="#000080">,</font>Y2<font color="#000080">: </font>Integer<font color="#000080">; </font>Color<font color="#000080">: </font>Byte<font color="#000080">);
</font><font color="#FF0000"><b>Procedure </b></font>HLine<font color="#000080">(</font>x<font color="#000080">,</font>y<font color="#000080">,</font>x2<font color="#000080">: </font>integer<font color="#000080">; </font>color<font color="#000080">: </font>byte<font color="#000080">);
</font><font color="#FF0000"><b>Procedure </b></font>VLine<font color="#000080">(</font>x<font color="#000080">,</font>y<font color="#000080">,</font>y2<font color="#000080">: </font>integer<font color="#000080">; </font>color<font color="#000080">: </font>byte<font color="#000080">);
</font><font color="#FF0000"><b>Procedure </b></font>Circle<font color="#000080">(</font>X<font color="#000080">,</font>y<font color="#000080">,</font>size<font color="#000080">: </font>longint<font color="#000080">; </font>color<font color="#000080">: </font>byte<font color="#000080">);
</font><font color="#FF0000"><b>Procedure </b></font>SwitchBank<font color="#000080">(</font>bank<font color="#000080">: </font>byte<font color="#000080">);
</font><font color="#FF0000"><b>Procedure </b></font>PutPix<font color="#000080">(</font>x<font color="#000080">,</font>y<font color="#000080">: </font>word<font color="#000080">; </font>c<font color="#000080">: </font>byte<font color="#000080">);
</font><font color="#FF0000"><b>Procedure </b></font>Cycle<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>vpTemp<font color="#000080">: </font>tDAC<font color="#000080">; </font>start<font color="#000080">,</font>finish<font color="#000080">: </font>Byte<font color="#000080">);
</font><font color="#FF0000"><b>Procedure </b></font>LoadPal<font color="#000080">(</font>fn<font color="#000080">: </font>pathstr<font color="#000080">);
</font><font color="#FF0000"><b>Procedure </b></font>SetColor<font color="#000080">(</font>Color<font color="#000080">,</font>r<font color="#000080">,</font>g<font color="#000080">,</font>b<font color="#000080">: </font>Byte<font color="#000080">);
</font><font color="#FF0000"><b>Procedure </b></font>GetColor<font color="#000080">(</font>Color<font color="#000080">: </font>byte<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>R<font color="#000080">,</font>G<font color="#000080">,</font>B <font color="#000080">: </font>Byte<font color="#000080">);
</font><font color="#FF0000"><b>Procedure </b></font>SetPalette<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>vPal<font color="#000080">: </font>tDAC<font color="#000080">);
</font><font color="#FF0000"><b>Procedure </b></font>GetPalette<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>vPal<font color="#000080">: </font>tDAC<font color="#000080">);
</font><font color="#FF0000"><b>procedure </b></font>Rectangle<font color="#000080">(</font>x1<font color="#000080">, </font>y1<font color="#000080">, </font>x2<font color="#000080">, </font>y2 <font color="#000080">: </font>word<font color="#000080">; </font>Color <font color="#000080">: </font>byte<font color="#000080">);
</font><font color="#008000"><i>{&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;&Auml;}
</i></font><font color="#FF0000"><b>Function </b></font>SetMode<font color="#000080">(</font>mode<font color="#000080">: </font>word<font color="#000080">): </font>boolean<font color="#000080">; </font><font color="#008000"><i>{ VGA &amp; VESA modes }
</i></font><font color="#FF0000"><b>Function </b></font>GetMode<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>mode<font color="#000080">: </font>word<font color="#000080">): </font>boolean<font color="#000080">;
</font><font color="#008000"><i>{&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;&Iacute;}

</i></font><font color="#FF0000"><b>Implementation

Procedure </b></font>Cycle<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>vpTemp<font color="#000080">: </font>tDAC<font color="#000080">; </font>start<font color="#000080">,</font>finish<font color="#000080">: </font>Byte<font color="#000080">);
</font><font color="#FF0000"><b>Var
  </b></font>count<font color="#000080">,
  </font>speed <font color="#000080">: </font>Byte<font color="#000080">;
  </font>temp <font color="#000080">: </font>tRGB<font color="#000080">;
</font><font color="#FF0000"><b>Begin
  If </b></font>vCycle_direction <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>Exit<font color="#000080">;

  </font><font color="#FF0000"><b>For </b></font>speed <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>Abs<font color="#000080">(</font>vCycle_direction<font color="#000080">) </font><font color="#FF0000"><b>do begin
    </b></font><font color="#008000"><i>{ Forwards? }
    </i></font><font color="#FF0000"><b>If </b></font>Abs<font color="#000080">(</font>vCycle_direction<font color="#000080">) = </font>vCycle_direction <font color="#FF0000"><b>then begin
      </b></font>temp <font color="#000080">:= </font>vpTemp<font color="#000080">[</font>start<font color="#000080">];
      </font><font color="#FF0000"><b>for </b></font>count <font color="#000080">:= </font>start <font color="#FF0000"><b>to </b></font>finish<font color="#000080">-</font><font color="#800000">1 </font><font color="#FF0000"><b>do
        </b></font>vpTemp<font color="#000080">[</font>count<font color="#000080">] := </font>vpTemp<font color="#000080">[</font>count<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">];
      </font>vpTemp<font color="#000080">[</font>finish<font color="#000080">] := </font>temp<font color="#000080">;
    </font><font color="#FF0000"><b>end
    </b></font><font color="#008000"><i>{ Backwards? }
    </i></font><font color="#FF0000"><b>else begin
      </b></font>temp <font color="#000080">:= </font>vpTemp<font color="#000080">[</font>finish<font color="#000080">];
      </font><font color="#FF0000"><b>for </b></font>count <font color="#000080">:= </font>finish <font color="#FF0000"><b>downto </b></font>start<font color="#000080">+</font><font color="#800000">1 </font><font color="#FF0000"><b>do
        </b></font>vpTemp<font color="#000080">[</font>count<font color="#000080">] := </font>vpTemp<font color="#000080">[</font>count<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">];
      </font>vpTemp<font color="#000080">[</font>start<font color="#000080">] := </font>temp<font color="#000080">;
    </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

  </font>Setpalette<font color="#000080">(</font>vpTemp<font color="#000080">);
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>Rectangle<font color="#000080">(</font>x1<font color="#000080">,</font>y1<font color="#000080">,</font>x2<font color="#000080">,</font>y2<font color="#000080">: </font>word<font color="#000080">; </font>Color<font color="#000080">: </font>byte<font color="#000080">);
</font><font color="#FF0000"><b>begin
  </b></font>Line<font color="#000080">(</font>x1<font color="#000080">,</font>y1<font color="#000080">,</font>x2<font color="#000080">,</font>y1<font color="#000080">,</font>Color<font color="#000080">);
  </font>Line<font color="#000080">(</font>x2<font color="#000080">,</font>y1<font color="#000080">,</font>x2<font color="#000080">,</font>y2<font color="#000080">,</font>Color<font color="#000080">);
  </font>Line<font color="#000080">(</font>x2<font color="#000080">,</font>y2<font color="#000080">,</font>x1<font color="#000080">,</font>y2<font color="#000080">,</font>Color<font color="#000080">);
  </font>Line<font color="#000080">(</font>x1<font color="#000080">,</font>y2<font color="#000080">,</font>x1<font color="#000080">,</font>y1<font color="#000080">,</font>Color<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>SetPalette<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>vPal<font color="#000080">: </font>tDAC<font color="#000080">);
</font><font color="#FF0000"><b>Var </b></font>loop<font color="#000080">: </font>byte<font color="#000080">;
</font><font color="#FF0000"><b>Begin
  For </b></font>loop <font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font><font color="#800000">255 </font><font color="#FF0000"><b>do with </b></font>vPal<font color="#000080">[</font>loop<font color="#000080">] </font><font color="#FF0000"><b>do </b></font>SetColor<font color="#000080">(</font>loop<font color="#000080">,</font>r<font color="#000080">,</font>g<font color="#000080">,</font>b<font color="#000080">);
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>GetPalette<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>vPal<font color="#000080">: </font>tDAC<font color="#000080">);
</font><font color="#FF0000"><b>Var </b></font>loop<font color="#000080">: </font>byte<font color="#000080">;
</font><font color="#FF0000"><b>Begin
  For </b></font>loop <font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font><font color="#800000">255 </font><font color="#FF0000"><b>do with </b></font>vPal<font color="#000080">[</font>loop<font color="#000080">] </font><font color="#FF0000"><b>do </b></font>GetColor<font color="#000080">(</font>loop<font color="#000080">,</font>r<font color="#000080">,</font>g<font color="#000080">,</font>b<font color="#000080">);
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>SetColor<font color="#000080">(</font>color<font color="#000080">,</font>r<font color="#000080">,</font>g<font color="#000080">,</font>b<font color="#000080">: </font>Byte<font color="#000080">); </font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Asm
  </b></font><font color="#FF00FF">mov  dx, 3C8h   </font><font color="#008000"><i>{ Color port }
  </i></font><font color="#FF00FF">mov  al, color  </font><font color="#008000"><i>{ Number of color to change }
  </i></font><font color="#FF00FF">out  dx, al
  inc  dx         </font><font color="#008000"><i>{ Inc dx to write }
  </i></font><font color="#FF00FF">mov  al, r      </font><font color="#008000"><i>{ Red value }
  </i></font><font color="#FF00FF">out  dx, al
  mov  al, g      </font><font color="#008000"><i>{ Green }
  </i></font><font color="#FF00FF">out  dx, al
  mov  al, b      </font><font color="#008000"><i>{ Blue }
  </i></font><font color="#FF00FF">out  dx, al
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>GetColor<font color="#000080">(</font>Color<font color="#000080">: </font>byte<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>r<font color="#000080">,</font>g<font color="#000080">,</font>b<font color="#000080">: </font>byte<font color="#000080">); </font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;
</font><font color="#008000"><i>{ This reads the values of the Red, Green and Blue DAC values of a
  certain color and returns them to you in r (red), g (green), b (blue) }
</i></font><font color="#FF0000"><b>asm
  </b></font><font color="#FF00FF">mov  dx, 3C7h
  mov  al, color
  out  dx, al
  add  dx, 2
  in   al, dx
  les  di, r
  stosb
  in   al, dx
  les  di, g
  stosb
  in   al, dx
  les  di, b
  stosb
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>Circle<font color="#000080">(</font>X<font color="#000080">,</font>Y<font color="#000080">,</font>size<font color="#000080">: </font>longint<font color="#000080">; </font>color<font color="#000080">: </font>byte<font color="#000080">);
</font><font color="#FF0000"><b>Var </b></font>Xl<font color="#000080">,</font>Yl <font color="#000080">: </font>LongInt<font color="#000080">;
</font><font color="#FF0000"><b>Begin
  If </b></font>Size<font color="#000080">=</font><font color="#800000">0 </font><font color="#FF0000"><b>Then Begin
    </b></font>PutPix<font color="#000080">(</font>X<font color="#000080">,</font>Y<font color="#000080">,</font>color<font color="#000080">);
    </font>Exit<font color="#000080">;
  </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
  </font>Xl <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font>Yl <font color="#000080">:= </font>Size<font color="#000080">;
  </font>Size <font color="#000080">:= </font>Size<font color="#000080">*</font>Size<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">;
  </font><font color="#FF0000"><b>Repeat
    </b></font>PutPix<font color="#000080">(</font>X<font color="#000080">+</font>Xl<font color="#000080">,</font>Y<font color="#000080">+</font>Yl<font color="#000080">,</font>color<font color="#000080">);
    </font>PutPix<font color="#000080">(</font>X<font color="#000080">-</font>Xl<font color="#000080">,</font>Y<font color="#000080">+</font>Yl<font color="#000080">,</font>color<font color="#000080">);
    </font>PutPix<font color="#000080">(</font>X<font color="#000080">+</font>Xl<font color="#000080">,</font>Y<font color="#000080">-</font>Yl<font color="#000080">,</font>color<font color="#000080">);
    </font>PutPix<font color="#000080">(</font>X<font color="#000080">-</font>Xl<font color="#000080">,</font>Y<font color="#000080">-</font>Yl<font color="#000080">,</font>color<font color="#000080">);
    </font><font color="#FF0000"><b>If </b></font>Xl<font color="#000080">*</font>Xl<font color="#000080">+</font>Yl<font color="#000080">*</font>Yl <font color="#000080">&gt;= </font>Size <font color="#FF0000"><b>Then </b></font>Dec<font color="#000080">(</font>Yl<font color="#000080">)
    </font><font color="#FF0000"><b>Else </b></font>Inc<font color="#000080">(</font>Xl<font color="#000080">);
  </font><font color="#FF0000"><b>Until </b></font>Yl <font color="#000080">= </font><font color="#800000">0</font><font color="#000080">;
  </font>PutPix<font color="#000080">(</font>X<font color="#000080">+</font>Xl<font color="#000080">,</font>Y<font color="#000080">+</font>Yl<font color="#000080">,</font>color<font color="#000080">);
  </font>PutPix<font color="#000080">(</font>X<font color="#000080">-</font>Xl<font color="#000080">,</font>Y<font color="#000080">+</font>Yl<font color="#000080">,</font>color<font color="#000080">);
  </font>PutPix<font color="#000080">(</font>X<font color="#000080">+</font>Xl<font color="#000080">,</font>Y<font color="#000080">-</font>Yl<font color="#000080">,</font>color<font color="#000080">);
  </font>PutPix<font color="#000080">(</font>X<font color="#000080">-</font>Xl<font color="#000080">,</font>Y<font color="#000080">-</font>Yl<font color="#000080">,</font>color<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>HLine<font color="#000080">(</font>x<font color="#000080">,</font>y<font color="#000080">,</font>x2<font color="#000080">: </font>integer<font color="#000080">; </font>color<font color="#000080">: </font>byte<font color="#000080">);
</font><font color="#FF0000"><b>Begin
  for </b></font>x <font color="#000080">:= </font>x <font color="#FF0000"><b>to </b></font>x2 <font color="#FF0000"><b>do </b></font>putpix<font color="#000080">(</font>x<font color="#000080">,</font>y<font color="#000080">,</font>color<font color="#000080">);
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>VLine<font color="#000080">(</font>x<font color="#000080">,</font>y<font color="#000080">,</font>y2<font color="#000080">: </font>integer<font color="#000080">; </font>color<font color="#000080">: </font>byte<font color="#000080">);
</font><font color="#FF0000"><b>Begin
  for </b></font>y <font color="#000080">:= </font>y <font color="#FF0000"><b>to </b></font>y2 <font color="#FF0000"><b>do </b></font>putpix<font color="#000080">(</font>x<font color="#000080">,</font>y<font color="#000080">,</font>color<font color="#000080">);
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;
 
</font><font color="#FF0000"><b>procedure </b></font>Line<font color="#000080">(</font>X1<font color="#000080">, </font>Y1<font color="#000080">, </font>X2<font color="#000080">, </font>Y2<font color="#000080">: </font>Integer<font color="#000080">; </font>Color<font color="#000080">: </font>Byte<font color="#000080">);
</font><font color="#FF0000"><b>var </b></font>X<font color="#000080">, </font>Y<font color="#000080">, </font>Dx<font color="#000080">, </font>Dy<font color="#000080">, </font>Xs<font color="#000080">, </font>Ys<font color="#000080">, </font>Direction<font color="#000080">: </font>Integer<font color="#000080">;
</font><font color="#FF0000"><b>begin
  if </b></font>x1 <font color="#000080">= </font>x2 <font color="#FF0000"><b>then </b></font>hline<font color="#000080">(</font>x1<font color="#000080">,</font>y1<font color="#000080">,</font>y2<font color="#000080">,</font>color<font color="#000080">)
  </font><font color="#FF0000"><b>else if </b></font>y1 <font color="#000080">= </font>y2 <font color="#FF0000"><b>then </b></font>vline<font color="#000080">(</font>x1<font color="#000080">,</font>y1<font color="#000080">,</font>x2<font color="#000080">,</font>color<font color="#000080">)
  </font><font color="#FF0000"><b>else begin
    </b></font>X <font color="#000080">:= </font>X1<font color="#000080">; </font>Y <font color="#000080">:= </font>Y1<font color="#000080">; </font>Xs <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">; </font>Ys <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;
    </font><font color="#FF0000"><b>if </b></font>X1 <font color="#000080">&gt; </font>X2 <font color="#FF0000"><b>then </b></font>Xs <font color="#000080">:= -</font><font color="#800000">1</font><font color="#000080">;
    </font><font color="#FF0000"><b>if </b></font>Y1 <font color="#000080">&gt; </font>Y2 <font color="#FF0000"><b>then </b></font>Ys <font color="#000080">:= </font><font color="#800000">01</font><font color="#000080">;
    </font>Dx <font color="#000080">:= </font>Abs<font color="#000080">(</font>X2 <font color="#000080">- </font>X1<font color="#000080">); </font>Dy <font color="#000080">:= </font>Abs<font color="#000080">(</font>Y2 <font color="#000080">- </font>Y1<font color="#000080">);
    </font><font color="#FF0000"><b>if </b></font>Dx <font color="#000080">= </font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>direction <font color="#000080">:= -</font><font color="#800000">1
    </font><font color="#FF0000"><b>else </b></font>Direction <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
    </font><font color="#FF0000"><b>while not </b></font><font color="#000080">((</font>X <font color="#000080">= </font>X2<font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>Y <font color="#000080">= </font>Y2<font color="#000080">)) </font><font color="#FF0000"><b>do begin
      </b></font>PutPix<font color="#000080">(</font>X<font color="#000080">,</font>Y<font color="#000080">,</font>Color<font color="#000080">);
      </font><font color="#FF0000"><b>if </b></font>Direction <font color="#000080">&lt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then begin                               
        </b></font>Inc<font color="#000080">(</font>Y<font color="#000080">,</font>Ys<font color="#000080">);
        </font>Inc<font color="#000080">(</font>Direction<font color="#000080">,</font>Dx<font color="#000080">);
      </font><font color="#FF0000"><b>end 
      else begin
        </b></font>Inc<font color="#000080">(</font>x<font color="#000080">,</font>Xs<font color="#000080">);
        </font>Dec<font color="#000080">(</font>Direction<font color="#000080">,</font>Dy<font color="#000080">);
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;  </font><font color="#008000"><i>{ Line }

</i></font><font color="#FF0000"><b>Function </b></font>GetMode<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>mode<font color="#000080">: </font>word<font color="#000080">): </font>boolean<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>asm
  </b></font><font color="#FF00FF">Mov  ax, 4F03h
  Int  10h
  Mov  word ptr mode, bx
  Cmp  Al, 4Fh
  Je   @Yes
  mov  al, false
  Jmp  @</font><font color="#FF0000"><b>end
 </b></font><font color="#000080">@</font>Yes<font color="#000080">:
  </font>mov  al<font color="#000080">, </font>true
 <font color="#000080">@</font><font color="#FF0000"><b>End</b></font><font color="#000080">:
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Function </b></font>SetMode<font color="#000080">(</font>mode<font color="#000080">: </font>word<font color="#000080">): </font>boolean<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#008000"><i>{ This function will work for more than just VESA modes, and more than  }
{ Just VESA cards also.  If it's under $100 (where vesa modes begin) it }
{ will use the normal video bios instead. So people without VESA cards/ }
{ drivers still can use this for 320x200x256, etc.                      }
</i></font><font color="#FF0000"><b>asm
  </b></font><font color="#008000"><i>{ Comment this part out if you want to use vesa for this }
  {--}
  </i></font><font color="#FF00FF">Cmp Mode, 100h
  Jb  @Normal_VGA </font><font color="#008000"><i>{ If it's below 100h then it's a std mode, why use VESA? }
  {--}
  </i></font><font color="#FF00FF">Mov Ax, 4F02h   </font><font color="#008000"><i>{ VESA set modes }
  </i></font><font color="#FF00FF">Mov Bx, mode
  Int 10h
  Cmp Ax, 004Fh   </font><font color="#008000"><i>{ AL=4F VESA supported, AH=00 successful }
  </i></font><font color="#FF00FF">Jne @Error      </font><font color="#008000"><i>{ Else Error }
  </i></font><font color="#FF00FF">mov al, true
  jmp @done
 @Error:
  mov al, false
  Jmp @done
 @Normal_VGA:
  mov ax, mode    </font><font color="#008000"><i>{ AH will of course be zero, as intended }
  </i></font><font color="#FF00FF">int 10h
  Mov al, true
 @done:
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>SwitchBank<font color="#000080">(</font>bank<font color="#000080">: </font>byte<font color="#000080">); </font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Asm
  </b></font><font color="#FF00FF">Mov al, bank
  Cmp Current_bank, al
  je @</font><font color="#FF0000"><b>End
  </b></font>Mov Current_bank<font color="#000080">, </font>al
  Mov Ax<font color="#000080">, </font><font color="#800000">4</font>F05h
  <font color="#FF0000"><b>Xor </b></font>Bx<font color="#000080">, </font>Bx
  Adc Dx<font color="#000080">, </font><font color="#800000">0
  </font>Mov Dl<font color="#000080">, </font>bank
  Int <font color="#800000">10</font>h
 <font color="#000080">@</font><font color="#FF0000"><b>End</b></font><font color="#000080">:
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>Clearscreen<font color="#000080">(</font>c<font color="#000080">: </font>byte<font color="#000080">);
</font><font color="#FF0000"><b>var </b></font>loop<font color="#000080">: </font>byte<font color="#000080">;
</font><font color="#FF0000"><b>begin
  for </b></font>loop <font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font><font color="#000080">(</font>longint<font color="#000080">(</font>xmax<font color="#000080">)*</font>ymax<font color="#000080">) </font><font color="#FF0000"><b>div </b></font><font color="#800000">$FFFF </font><font color="#FF0000"><b>do begin
    </b></font>switchbank<font color="#000080">(</font>loop<font color="#000080">);
    </font>Fillchar<font color="#000080">(</font>mem<font color="#000080">[</font>SegA000<font color="#000080">:</font><font color="#800000">0</font><font color="#000080">],</font><font color="#800000">$FFFF</font><font color="#000080">,</font>c<font color="#000080">);
    </font>Fillchar<font color="#000080">(</font>mem<font color="#000080">[</font>SegA000<font color="#000080">:</font><font color="#800000">$FFFF</font><font color="#000080">],</font><font color="#800000">$1</font><font color="#000080">,</font>c<font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>LoadPal<font color="#000080">(</font>Fn<font color="#000080">: </font>PathStr<font color="#000080">);
</font><font color="#FF0000"><b>Var
  </b></font>DAC<font color="#000080">: </font>tDAC<font color="#000080">;
  </font>F<font color="#000080">: </font><font color="#FF0000"><b>file</b></font><font color="#000080">;
  </font>Loop<font color="#000080">: </font>integer<font color="#000080">;
</font><font color="#FF0000"><b>Begin
  </b></font>Assign<font color="#000080">(</font>f<font color="#000080">,</font>Fn<font color="#000080">);
  </font>Reset<font color="#000080">(</font>f<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">);
  </font><font color="#FF0000"><b>If </b></font>ioresult <font color="#000080">&lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>exit<font color="#000080">;
  </font>BlockRead<font color="#000080">(</font>f<font color="#000080">,</font>DAC<font color="#000080">,</font>Sizeof<font color="#000080">(</font>DAC<font color="#000080">));
  </font>Close<font color="#000080">(</font>f<font color="#000080">);
  </font><font color="#FF0000"><b>for </b></font>Loop <font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font><font color="#800000">255 </font><font color="#FF0000"><b>do with </b></font>dac<font color="#000080">[</font>loop<font color="#000080">] </font><font color="#FF0000"><b>do </b></font>SetColor<font color="#000080">(</font>Loop<font color="#000080">,</font>r<font color="#000080">,</font>g<font color="#000080">,</font>b<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>PutPix<font color="#000080">(</font>x<font color="#000080">,</font>y<font color="#000080">: </font>word<font color="#000080">; </font>c<font color="#000080">: </font>byte<font color="#000080">); </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Asm
  </b></font><font color="#008000"><i>{ Do some simple checking }
  </i></font><font color="#FF00FF">mov  ax, x
  cmp  xmax,ax
  jb   @</font><font color="#FF0000"><b>end

  </b></font>mov  ax<font color="#000080">, </font>y
  cmp  ymax<font color="#000080">, </font>ax
  jb   <font color="#000080">@</font><font color="#FF0000"><b>end
  
  </b></font>dec  x

  <font color="#008000"><i>{ Calculate where we're going to place the pixel at A000:???? }
  </i></font>Mov  ES<font color="#000080">, </font>SegA000
  Mov  AX<font color="#000080">, </font>Ymax
  Mul  pp
  Add  Ax<font color="#000080">, </font>Y
  Mov  Bx<font color="#000080">, </font>Ax
  Mov  Ax<font color="#000080">, </font>Xmax
  Mul  Bx
  Add  Ax<font color="#000080">, </font>X
  Adc  Dx<font color="#000080">, </font><font color="#800000">0
  </font>Mov  Di<font color="#000080">, </font>Ax
  Cmp  Dl<font color="#000080">, </font>Current_bank
  <font color="#008000"><i>{ If we're at the bank we need to be, then skip it }
  </i></font>Je   <font color="#000080">@</font>skip
  <font color="#008000"><i>{ Set the video bank to what we need }
  </i></font>Mov  Current_bank<font color="#000080">, </font>Dl
  Mov  Ax<font color="#000080">, </font><font color="#800000">4</font>F05h
  <font color="#FF0000"><b>Xor  </b></font>Bx<font color="#000080">, </font>Bx
  Int  <font color="#800000">10</font>h

 <font color="#000080">@</font>Skip<font color="#000080">:
  </font>Mov  Al<font color="#000080">, </font>C
  Mov  Es<font color="#000080">:[</font>Di<font color="#000080">], </font>Al
 <font color="#000080">@</font><font color="#FF0000"><b>End</b></font><font color="#000080">:
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>End</b></font><font color="#000080">.

... </font>How <font color="#FF0000"><b>do </b></font>blonds get minks<font color="#000080">?  </font>The same way Minks get Minks<font color="#000080">!
--- </font>Blue Wave<font color="#000080">/</font>Max v2<font color="#000080">.</font><font color="#800000">12 </font><font color="#000080">[</font>NR<font color="#000080">]
 * </font>Origin<font color="#000080">: </font>Infinity Complex <font color="#000080">-= </font><font color="#800000">28.8</font>k <font color="#000080">=- (</font><font color="#800000">613</font><font color="#000080">)</font><font color="#800000">549</font><font color="#000080">-</font><font color="#800000">7847 </font><font color="#000080">(</font><font color="#800000">1</font><font color="#000080">:</font><font color="#800000">249</font><font color="#000080">/</font><font color="#800000">153</font><font color="#000080">)
</font>SEEN<font color="#000080">-</font>BY<font color="#000080">: </font><font color="#800000">12</font><font color="#000080">/</font><font color="#800000">12 163</font><font color="#000080">/</font><font color="#800000">99 211 167</font><font color="#000080">/</font><font color="#800000">90 221</font><font color="#000080">/</font><font color="#800000">100 224</font><font color="#000080">/</font><font color="#800000">25 240</font><font color="#000080">/</font><font color="#800000">99 241</font><font color="#000080">/</font><font color="#800000">99
</font>SEEN<font color="#000080">-</font>BY<font color="#000080">: </font><font color="#800000">243</font><font color="#000080">/</font><font color="#800000">3 244</font><font color="#000080">/</font><font color="#800000">99 246</font><font color="#000080">/</font><font color="#800000">1 249</font><font color="#000080">/</font><font color="#800000">1 99 100 101 112 127 128 152
</font>SEEN<font color="#000080">-</font>BY<font color="#000080">: </font><font color="#800000">249</font><font color="#000080">/</font><font color="#800000">153 200 201 396</font><font color="#000080">/</font><font color="#800000">1 3615</font><font color="#000080">/</font><font color="#800000">50 51
</font>PATH<font color="#000080">: </font><font color="#800000">249</font><font color="#000080">/</font><font color="#800000">153 100 99 12</font><font color="#000080">/</font><font color="#800000">12 3615</font><font color="#000080">/</font><font color="#800000">50
</font>                                       
<font color="#008000"><i>{SWAG=???.SWG,JOHN STEPHENSON,Vesa and 320x200x256 3/3}
</i></font>MSGID<font color="#000080">: </font><font color="#800000">1</font><font color="#000080">:</font><font color="#800000">249</font><font color="#000080">/</font><font color="#800000">153.0 2e</font>fc50b2
<font color="#008000"><i>{CF&gt; Does any one have code to do Vesa 320x200x256?  Also page flipping? 
 CF&gt; And s' stuff? 

 Lastly, an example:}
 
</i></font><font color="#FF0000"><b>uses </b></font>crt<font color="#000080">,</font>vesa<font color="#000080">,</font>asmmisc<font color="#000080">;
</font><font color="#FF0000"><b>var
  </b></font>loop<font color="#000080">: </font>word<font color="#000080">;
  </font>vpTemp<font color="#000080">: </font>tDac<font color="#000080">;
  </font>pixels <font color="#000080">: </font>word<font color="#000080">;
  </font>hx<font color="#000080">,</font>hy<font color="#000080">: </font>longint<font color="#000080">;

</font><font color="#FF0000"><b>begin
  </b></font>xmax <font color="#000080">:= </font><font color="#800000">320</font><font color="#000080">;
  </font>ymax <font color="#000080">:= </font><font color="#800000">200</font><font color="#000080">;
  </font>setmode<font color="#000080">(</font>_320x200x256<font color="#000080">);
  </font>LoadPal<font color="#000080">(</font><font color="#800000">'TUNNEL.PAL'</font><font color="#000080">); </font><font color="#008000"><i>{ Get your own palette! }
  </i></font>GetPalette<font color="#000080">(</font>vpTemp<font color="#000080">);
  
  </font><font color="#008000"><i>{ Calculate the amount of pixels to 1,1 from xmax div 2,ymax div 2 using }
  { the pythagorean theorm }
  </i></font>hy <font color="#000080">:= </font>ymax <font color="#FF0000"><b>div </b></font><font color="#800000">2</font><font color="#000080">; </font><font color="#008000"><i>{ Centre Y }
  </i></font>hx <font color="#000080">:= </font>xmax <font color="#FF0000"><b>div </b></font><font color="#800000">2</font><font color="#000080">; </font><font color="#008000"><i>{ Centre X }          {       _____ }
  </i></font>pixels <font color="#000080">:= </font>round<font color="#000080">(</font>sqrt<font color="#000080">((</font>hx<font color="#000080">*</font>hx<font color="#000080">)+(</font>hy<font color="#000080">*</font>hy<font color="#000080">))); </font><font color="#008000"><i>{ c := &ucirc;a&yacute;+b&yacute; }

  </i></font><font color="#FF0000"><b>for </b></font>loop <font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font>pixels <font color="#FF0000"><b>do begin
    </b></font>circle<font color="#000080">(</font>xmax <font color="#FF0000"><b>div </b></font><font color="#800000">2</font><font color="#000080">,</font>ymax <font color="#FF0000"><b>div </b></font><font color="#800000">2</font><font color="#000080">,</font>loop<font color="#000080">,</font>loop <font color="#FF0000"><b>mod </b></font><font color="#800000">255</font><font color="#000080">+</font><font color="#800000">1</font><font color="#000080">);
    </font>Cycle<font color="#000080">(</font>vpTemp<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">255</font><font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>while </b></font>keypressed <font color="#FF0000"><b>do </b></font>readkey<font color="#000080">;
  </font><font color="#008000"><i>{ Don't rotate black! }
  </i></font><font color="#FF0000"><b>while not </b></font>keypressed <font color="#FF0000"><b>do begin
    </b></font>Retrace<font color="#000080">;
    </font>Cycle<font color="#000080">(</font>vpTemp<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">255</font><font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>readkey<font color="#000080">;
  </font>setmode<font color="#000080">(</font>lastmode<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to EGAVGA SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0185.PAS">Original</a><b>]</b></p></body>
</html>
