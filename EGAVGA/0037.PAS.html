<html>
<head><title> "TWEAKED.PAS" by SWAG SUPPORT TEAM</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to EGAVGA SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0037.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
 Hi, would anyone like to tell me how to get the tweaked video
 mode With 4 pages to work With because I'm tired of the 16 color
 2 page demos I'm making.

Sure, here's an adaptation of some code from Dr. Dobbs magazine on Mode-X.
I've only posted the routine to set the VGA to 360x240x256 With 3 pages of
Graphics.  Only 3 pages since the increase in resolution Uses more RAM.
}

</i></font><font color="#FF0000"><b>Procedure </b></font>InitVGA360x240<font color="#000080">;

</font><font color="#FF0000"><b>Const
  </b></font>GC_inDEX    <font color="#000080">= </font><font color="#800000">$03CE</font><font color="#000080">;    </font><font color="#008000"><i>{ VGA Graphics Controller }
  </i></font>SC_inDEX    <font color="#000080">= </font><font color="#800000">$03C4</font><font color="#000080">;    </font><font color="#008000"><i>{ VGA Sequence controller }
  </i></font>CrtC_inDEX  <font color="#000080">= </font><font color="#800000">$03D4</font><font color="#000080">;    </font><font color="#008000"><i>{ VGA Crt Controller      }
  </i></font>MISC_OUTPUT <font color="#000080">= </font><font color="#800000">$03C2</font><font color="#000080">;    </font><font color="#008000"><i>{ VGA Misc Register       }
  </i></font>MAP_MASK    <font color="#000080">= </font><font color="#800000">$02</font><font color="#000080">;      </font><font color="#008000"><i>{ Map Register #          }
  </i></font>READ_MAP    <font color="#000080">= </font><font color="#800000">$04</font><font color="#000080">;      </font><font color="#008000"><i>{ Read Map Register #     }

  </i></font>VMODE_DATA  <font color="#000080">: </font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">17</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Word <font color="#000080">=
                   (</font><font color="#800000">$6B00</font><font color="#000080">,    </font><font color="#008000"><i>{ Horizontal total          }
                    </i></font><font color="#800000">$5901</font><font color="#000080">,    </font><font color="#008000"><i>{ Horizontal displayed      }
                    </i></font><font color="#800000">$5A02</font><font color="#000080">,    </font><font color="#008000"><i>{ Start horizontal blanking }
                    </i></font><font color="#800000">$8E03</font><font color="#000080">,    </font><font color="#008000"><i>{ end horizontal blanking   }
                    </i></font><font color="#800000">$5E04</font><font color="#000080">,    </font><font color="#008000"><i>{ Start H sync.             }
                    </i></font><font color="#800000">$8A05</font><font color="#000080">,    </font><font color="#008000"><i>{ end H sync.               }
                    </i></font><font color="#800000">$0D06</font><font color="#000080">,    </font><font color="#008000"><i>{ Vertical total            }
                    </i></font><font color="#800000">$3E07</font><font color="#000080">,    </font><font color="#008000"><i>{ Overflow                  }
                    </i></font><font color="#800000">$4109</font><font color="#000080">,    </font><font color="#008000"><i>{ Cell height               }
                    </i></font><font color="#800000">$EA10</font><font color="#000080">,    </font><font color="#008000"><i>{ V sync. start             }
                    </i></font><font color="#800000">$AC11</font><font color="#000080">,    </font><font color="#008000"><i>{ V sync. end/Prot CR0 CR7  }
                    </i></font><font color="#800000">$DF12</font><font color="#000080">,    </font><font color="#008000"><i>{ Vertical displayed        }
                    </i></font><font color="#800000">$2D13</font><font color="#000080">,    </font><font color="#008000"><i>{ offset                    }
                    </i></font><font color="#800000">$0014</font><font color="#000080">,    </font><font color="#008000"><i>{ DWord mode off            }
                    </i></font><font color="#800000">$E715</font><font color="#000080">,    </font><font color="#008000"><i>{ V Blank start             }
                    </i></font><font color="#800000">$0616</font><font color="#000080">,    </font><font color="#008000"><i>{ V Blank end               }
                    </i></font><font color="#800000">$E317</font><font color="#000080">);   </font><font color="#008000"><i>{ Turn on Byte mode         }

</i></font><font color="#FF0000"><b>begin
  Asm
   </b></font><font color="#FF00FF">mov   ax, $13
   int   $10

   mov   dx, SC_inDEX           </font><font color="#008000"><i>{ Sequencer Register }
   </i></font><font color="#FF00FF">mov   ax, $0604              </font><font color="#008000"><i>{ Disable Chain 4 Mode }
   </i></font><font color="#FF00FF">out   dx, ax

   mov   ax, $0100              </font><font color="#008000"><i>{ (A)synchronous Reset }
   </i></font><font color="#FF00FF">out   dx, ax

   mov   dx, MISC_OUTPUT        </font><font color="#008000"><i>{ VGA Misc Register }
   </i></font><font color="#FF00FF">mov   al, $E7                </font><font color="#008000"><i>{ Use 28Mhz Clock &amp; 60Hz }
   </i></font><font color="#FF00FF">out   dx, al

   mov   dx, SC_inDEX           </font><font color="#008000"><i>{ Sequencer Register }
   </i></font><font color="#FF00FF">mov   ax, $0300              </font><font color="#008000"><i>{ Restart Sequencer }
   </i></font><font color="#FF00FF">out   dx, ax

   </font><font color="#008000"><i>{
     Diasable Write protect For CrtC Registers 0-7, since we are
     about to change the horizontal &amp; vertical timing settings.
   }
   </i></font><font color="#FF00FF">mov   dx, CrtC_inDEX         </font><font color="#008000"><i>{ VGA CrtC Registers }
   </i></font><font color="#FF00FF">mov   al, $11                </font><font color="#008000"><i>{ CrtC register 11h }
   </i></font><font color="#FF00FF">out   dx, al                 </font><font color="#008000"><i>{ Load current value }
   </i></font><font color="#FF00FF">inc   dx                     </font><font color="#008000"><i>{ Point to data }
   </i></font><font color="#FF00FF">in    al, dx                 </font><font color="#008000"><i>{ Get CrtC register 11h }
   </i></font><font color="#FF00FF">and   al, $7F                </font><font color="#008000"><i>{ Mask out Write protect }
   </i></font><font color="#FF00FF">out   dx, al                 </font><font color="#008000"><i>{ and send it back }

   { Send CrtC data in VMODE_DATA Array to the CrtC. }
   </i></font><font color="#FF00FF">mov   dx, CrtC_inDEX         </font><font color="#008000"><i>{ VGA CrtC Registers }
   </i></font><font color="#FF00FF">cld                          </font><font color="#008000"><i>{ Forward block load }
   </i></font><font color="#FF00FF">mov   si, offset VMODE_DATA  </font><font color="#008000"><i>{ Get parameter data }
   </i></font><font color="#FF00FF">mov   cx, 17                 </font><font color="#008000"><i>{ Number of entries in block }

   </i></font><font color="#FF00FF">@@1:
     mov   ax, ds:[si]      </font><font color="#008000"><i>{ Get next parameter value }
     </i></font><font color="#FF00FF">inc   si               </font><font color="#008000"><i>{ Advance to next Word }
     </i></font><font color="#FF00FF">inc   si
     out   dx, ax           </font><font color="#008000"><i>{ Output next value }
     </i></font><font color="#FF00FF">loop  @@1              </font><font color="#008000"><i>{ Process next value }

   { Clear all VGA memory to black. }
   </i></font><font color="#FF00FF">mov   dx, SC_inDEX     </font><font color="#008000"><i>{ Select all planes }
   </i></font><font color="#FF00FF">mov   ax, $0F02
   out   dx, ax

   mov   ax, VGA_SEG      </font><font color="#008000"><i>{ Point to VGA memory }
   </i></font><font color="#FF00FF">mov   es, ax
   mov   di, 0

   xor   ax, ax           </font><font color="#008000"><i>{ clear 256K }
   </i></font><font color="#FF00FF">mov   cx, $8000        </font><font color="#008000"><i>{ 32K * 2 * 4 planes }
   </i></font><font color="#FF00FF">rep   stosw
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#008000"><i>{
That's about it.  The video memory in this mode is organised a bit differently
than CGA/HERC.  It is a lot like the 16 color modes you're probably used to, in
that you must go through the EGA/VGA Registers to access the memory, by setting
MAP MASK &amp; PLANE SELECT, etc.
}
</i></font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to EGAVGA SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0037.PAS">Original</a><b>]</b></p></body>
</html>
