<html>
<head><title> "Pouring Sand Effect" by MARCIN BORKOWSKI</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to EGAVGA SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0224.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
{ Pouring sand simulator - by Marcin Borkowski 2:480/25.
  VGA and patience required. Program simulates sand poured
  from some height on a flat surface. There are different
  grain densities and different grain colors - denser grains
  are darker. I saw something similar this year during winter
  vacation done from tho pieces of glass, water and sand - this
  program tries to simulate physical effects taking place in
  a real system. Denser grains falls faster and they form flatter
  slopes. ESC ends simulation. }

</i></font><font color="#FF0000"><b>const
  </b></font>maxgrains <font color="#000080">= </font><font color="#800000">199</font><font color="#000080">;

</font><font color="#FF0000"><b>type
  </b></font>data   <font color="#000080">= (</font>x<font color="#000080">,</font>y<font color="#000080">,</font>c<font color="#000080">);

</font><font color="#FF0000"><b>var
  </b></font>sand   <font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font>maxgrains<font color="#000080">,</font>x<font color="#000080">..</font>c<font color="#000080">]</font><font color="#FF0000"><b>of </b></font>integer<font color="#000080">;
  </font>bottom <font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">639</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">1</font><font color="#000080">]</font><font color="#FF0000"><b>of </b></font>integer<font color="#000080">;
  </font>grains<font color="#000080">,</font>source <font color="#000080">: </font>integer<font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>movedown<font color="#000080">(</font>i <font color="#000080">: </font>integer<font color="#000080">);
</font><font color="#FF0000"><b>var
  </b></font>moved <font color="#000080">: </font>boolean<font color="#000080">;
  </font>j <font color="#000080">: </font>integer<font color="#000080">;

  </font><font color="#FF0000"><b>procedure </b></font>totheleft<font color="#000080">;
  </font><font color="#FF0000"><b>var
    </b></font>j <font color="#000080">: </font>integer<font color="#000080">;
  </font><font color="#FF0000"><b>begin
    for </b></font>j<font color="#000080">:=</font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>sand<font color="#000080">[</font>i<font color="#000080">,</font>c<font color="#000080">] </font><font color="#FF0000"><b>do
      if </b></font><font color="#000080">(</font>sand<font color="#000080">[</font>i<font color="#000080">,</font>y<font color="#000080">]&gt;</font>bottom<font color="#000080">[</font>sand<font color="#000080">[</font>i<font color="#000080">,</font>x<font color="#000080">]-</font>j<font color="#000080">,</font><font color="#800000">0</font><font color="#000080">]+</font><font color="#800000">1</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>sand<font color="#000080">[</font>i<font color="#000080">,</font>x<font color="#000080">]&gt;</font><font color="#800000">8</font><font color="#000080">) </font><font color="#FF0000"><b>then
      begin
        </b></font>dec<font color="#000080">(</font>sand<font color="#000080">[</font>i<font color="#000080">,</font>x<font color="#000080">],</font>j<font color="#000080">);
        </font>sand<font color="#000080">[</font>i<font color="#000080">,</font>y<font color="#000080">]:=</font>bottom<font color="#000080">[</font>sand<font color="#000080">[</font>i<font color="#000080">,</font>x<font color="#000080">],</font><font color="#800000">0</font><font color="#000080">]+</font><font color="#800000">1</font><font color="#000080">;
        </font>moved<font color="#000080">:=</font>true<font color="#000080">;
        </font>EXIT
      <font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>procedure </b></font>totheright<font color="#000080">;
  </font><font color="#FF0000"><b>var
    </b></font>j <font color="#000080">: </font>integer<font color="#000080">;
  </font><font color="#FF0000"><b>begin
    for </b></font>j<font color="#000080">:=</font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>sand<font color="#000080">[</font>i<font color="#000080">,</font>c<font color="#000080">] </font><font color="#FF0000"><b>do
      if </b></font><font color="#000080">(</font>sand<font color="#000080">[</font>i<font color="#000080">,</font>y<font color="#000080">]&gt;</font>bottom<font color="#000080">[</font>sand<font color="#000080">[</font>i<font color="#000080">,</font>x<font color="#000080">]+</font>j<font color="#000080">,</font><font color="#800000">0</font><font color="#000080">]+</font><font color="#800000">1</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>sand<font color="#000080">[</font>i<font color="#000080">,</font>x<font color="#000080">]&lt;</font><font color="#800000">632</font><font color="#000080">)  </font><font color="#FF0000"><b>then
      begin
        </b></font>inc<font color="#000080">(</font>sand<font color="#000080">[</font>i<font color="#000080">,</font>x<font color="#000080">],</font>j<font color="#000080">);
        </font>sand<font color="#000080">[</font>i<font color="#000080">,</font>y<font color="#000080">]:=</font>bottom<font color="#000080">[</font>sand<font color="#000080">[</font>i<font color="#000080">,</font>x<font color="#000080">],</font><font color="#800000">0</font><font color="#000080">]+</font><font color="#800000">1</font><font color="#000080">;  </font><font color="#008000"><i>{}
        </i></font>moved<font color="#000080">:=</font>true<font color="#000080">;
        </font>EXIT
      <font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>begin
  </b></font>moved<font color="#000080">:=</font>false<font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font>random<font color="#000080">(</font><font color="#800000">2</font><font color="#000080">)&lt;&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>then
  begin
    </b></font>totheleft<font color="#000080">;
    </font><font color="#FF0000"><b>if not </b></font>moved <font color="#FF0000"><b>then </b></font>totheright<font color="#000080">;
  </font><font color="#FF0000"><b>end
  else
  begin
    </b></font>totheright<font color="#000080">;
    </font><font color="#FF0000"><b>if not </b></font>moved <font color="#FF0000"><b>then </b></font>totheleft<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font>moved <font color="#FF0000"><b>then </b></font>movedown<font color="#000080">(</font>i<font color="#000080">)
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>pour<font color="#000080">;
</font><font color="#FF0000"><b>var
  </b></font>i <font color="#000080">: </font>integer<font color="#000080">;
  </font>addr <font color="#000080">: </font>word<font color="#000080">;
  </font>dummy <font color="#000080">: </font>byte<font color="#000080">;
  </font>px<font color="#000080">,</font>py<font color="#000080">,</font>pc <font color="#000080">: </font>integer<font color="#000080">;
</font><font color="#FF0000"><b>begin
  for </b></font>i<font color="#000080">:=</font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font>grains <font color="#FF0000"><b>do
  begin
    </b></font>dec<font color="#000080">(</font>sand<font color="#000080">[</font>i<font color="#000080">,</font>y<font color="#000080">],</font>sand<font color="#000080">[</font>i<font color="#000080">,</font>c<font color="#000080">]);
    </font><font color="#FF0000"><b>if </b></font>sand<font color="#000080">[</font>i<font color="#000080">,</font>y<font color="#000080">] </font><font color="#FF0000"><b>shr </b></font><font color="#800000">4</font><font color="#000080">&lt;=</font>bottom<font color="#000080">[</font>sand<font color="#000080">[</font>i<font color="#000080">,</font>x<font color="#000080">],</font><font color="#800000">0</font><font color="#000080">] </font><font color="#FF0000"><b>then
    begin
      </b></font>sand<font color="#000080">[</font>i<font color="#000080">,</font>y<font color="#000080">]:=</font>bottom<font color="#000080">[</font>sand<font color="#000080">[</font>i<font color="#000080">,</font>x<font color="#000080">],</font><font color="#800000">0</font><font color="#000080">]+</font><font color="#800000">1</font><font color="#000080">;
      </font>movedown<font color="#000080">(</font>i<font color="#000080">);
      </font>px<font color="#000080">:=</font>sand<font color="#000080">[</font>i<font color="#000080">,</font>x<font color="#000080">];
      </font>py<font color="#000080">:=</font>sand<font color="#000080">[</font>i<font color="#000080">,</font>y<font color="#000080">];
      </font>pc<font color="#000080">:=</font>sand<font color="#000080">[</font>i<font color="#000080">,</font>c<font color="#000080">];
      </font>bottom<font color="#000080">[</font>px<font color="#000080">,</font><font color="#800000">0</font><font color="#000080">]:=</font>py<font color="#000080">;
      </font>bottom<font color="#000080">[</font>px<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">]:=</font>pc<font color="#000080">;
      </font>Port<font color="#000080">[</font><font color="#800000">$3CE</font><font color="#000080">]:=</font><font color="#800000">08</font><font color="#000080">;
      </font>Port<font color="#000080">[</font><font color="#800000">$3CF</font><font color="#000080">]:=</font><font color="#800000">$80 </font><font color="#FF0000"><b>shr </b></font><font color="#000080">(</font>px <font color="#FF0000"><b>and </b></font><font color="#800000">7</font><font color="#000080">);   </font><font color="#008000"><i>{ Bit Mask }
      </i></font>addr<font color="#000080">:=</font><font color="#800000">80</font><font color="#000080">*(</font><font color="#800000">480</font><font color="#000080">-</font>py<font color="#000080">)+</font>px <font color="#FF0000"><b>shr </b></font><font color="#800000">3</font><font color="#000080">;
      </font>dummy<font color="#000080">:=</font>mem<font color="#000080">[</font><font color="#800000">$A000</font><font color="#000080">:</font>addr<font color="#000080">];           </font><font color="#008000"><i>{ load latches }
      </i></font>mem<font color="#000080">[</font><font color="#800000">$A000</font><font color="#000080">:</font>addr<font color="#000080">]:=</font>Lo<font color="#000080">(</font><font color="#800000">17</font><font color="#000080">-</font>pc <font color="#FF0000"><b>shl </b></font><font color="#800000">1</font><font color="#000080">); </font><font color="#008000"><i>{ PutPixel - write mode #2 }
      </i></font>move<font color="#000080">(</font>sand<font color="#000080">[</font>grains<font color="#000080">],</font>sand<font color="#000080">[</font>i<font color="#000080">],</font><font color="#800000">6</font><font color="#000080">);
      </font>dec<font color="#000080">(</font>grains<font color="#000080">);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>while </b></font>grains<font color="#000080">&lt;</font>maxgrains <font color="#FF0000"><b>do
  begin
    </b></font>inc<font color="#000080">(</font>grains<font color="#000080">);
    </font>sand<font color="#000080">[</font>grains<font color="#000080">,</font>x<font color="#000080">]:=</font>source<font color="#000080">;
    </font>sand<font color="#000080">[</font>grains<font color="#000080">,</font>y<font color="#000080">]:=</font><font color="#800000">16</font><font color="#000080">*</font><font color="#800000">400</font><font color="#000080">;
    </font>sand<font color="#000080">[</font>grains<font color="#000080">,</font>c<font color="#000080">]:=</font><font color="#800000">1</font><font color="#000080">+</font>random<font color="#000080">(</font><font color="#800000">8</font><font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>colors16<font color="#000080">;
</font><font color="#FF0000"><b>var
  </b></font>i <font color="#000080">: </font>integer<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>Port<font color="#000080">[</font><font color="#800000">$3C8</font><font color="#000080">]:=</font><font color="#800000">0</font><font color="#000080">;
  </font><font color="#FF0000"><b>for </b></font>i<font color="#000080">:=</font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font><font color="#800000">15 </font><font color="#FF0000"><b>do
  begin
    </b></font>Port<font color="#000080">[</font><font color="#800000">$3C9</font><font color="#000080">]:=</font><font color="#800000">3</font><font color="#000080">+</font><font color="#800000">4</font><font color="#000080">*</font>i<font color="#000080">;
    </font>Port<font color="#000080">[</font><font color="#800000">$3C9</font><font color="#000080">]:=</font><font color="#800000">3</font><font color="#000080">+</font><font color="#800000">4</font><font color="#000080">*</font>i<font color="#000080">;
    </font>Port<font color="#000080">[</font><font color="#800000">$3C9</font><font color="#000080">]:=</font><font color="#800000">3</font><font color="#000080">+</font><font color="#800000">4</font><font color="#000080">*</font>i<font color="#000080">;
    </font>port<font color="#000080">[</font><font color="#800000">$3C0</font><font color="#000080">]:=</font>i<font color="#000080">;
    </font>port<font color="#000080">[</font><font color="#800000">$3C0</font><font color="#000080">]:=</font>i<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>port<font color="#000080">[</font><font color="#800000">$3C0</font><font color="#000080">]:=</font><font color="#800000">$30</font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>begin
  asm </b></font><font color="#FF00FF">mov ax,12h; int 10h </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>randomize<font color="#000080">;
  </font>colors16<font color="#000080">;
  </font>Port<font color="#000080">[</font><font color="#800000">$3C4</font><font color="#000080">]:=</font><font color="#800000">02</font><font color="#000080">;  </font>Port<font color="#000080">[</font><font color="#800000">$3C5</font><font color="#000080">]:=</font><font color="#800000">$0F</font><font color="#000080">;
  </font>Port<font color="#000080">[</font><font color="#800000">$3CE</font><font color="#000080">]:=</font><font color="#800000">05</font><font color="#000080">;  </font>Port<font color="#000080">[</font><font color="#800000">$3CF</font><font color="#000080">]:=(</font>Port<font color="#000080">[</font><font color="#800000">$3CF</font><font color="#000080">] </font><font color="#FF0000"><b>and </b></font><font color="#800000">$FD</font><font color="#000080">) </font><font color="#FF0000"><b>or </b></font><font color="#800000">2</font><font color="#000080">;
  </font>fillchar<font color="#000080">(</font>sand<font color="#000080">,</font>sizeof<font color="#000080">(</font>sand<font color="#000080">),</font><font color="#800000">#0</font><font color="#000080">);
  </font>fillchar<font color="#000080">(</font>bottom<font color="#000080">,</font>sizeof<font color="#000080">(</font>bottom<font color="#000080">),</font><font color="#800000">#0</font><font color="#000080">);
  </font>grains<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
  </font>source<font color="#000080">:=</font><font color="#800000">30</font><font color="#000080">+</font>random<font color="#000080">(</font><font color="#800000">600</font><font color="#000080">);
  </font>sand<font color="#000080">[</font>grains<font color="#000080">,</font>x<font color="#000080">]:=</font>source<font color="#000080">;
  </font>sand<font color="#000080">[</font>grains<font color="#000080">,</font>y<font color="#000080">]:=</font><font color="#800000">16</font><font color="#000080">*</font><font color="#800000">400</font><font color="#000080">;
  </font>sand<font color="#000080">[</font>grains<font color="#000080">,</font>c<font color="#000080">]:=</font><font color="#800000">1</font><font color="#000080">;
  </font><font color="#FF0000"><b>repeat
    </b></font>pour<font color="#000080">;
    </font><font color="#FF0000"><b>if </b></font>random<font color="#000080">(</font><font color="#800000">10000</font><font color="#000080">)&gt;</font><font color="#800000">9997 </font><font color="#FF0000"><b>then </b></font>source<font color="#000080">:=</font><font color="#800000">30</font><font color="#000080">+</font>random<font color="#000080">(</font><font color="#800000">600</font><font color="#000080">)
  </font><font color="#FF0000"><b>until </b></font>port<font color="#000080">[</font><font color="#800000">$60</font><font color="#000080">]=</font><font color="#800000">1</font><font color="#000080">;
  </font><font color="#FF0000"><b>asm </b></font><font color="#FF00FF">mov ax,03h; int 10h </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to EGAVGA SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0224.PAS">Original</a><b>]</b></p></body>
</html>
