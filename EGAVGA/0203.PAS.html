<html>
<head><title> "Fire Code II" by RICK HAINES</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to EGAVGA SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0203.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
&gt;Well... Does anyone know how to make flames? is it a fractal
&gt;or something? does anyone can explain it (Formula ETC.) ???

Actually, it's pretty simple.  Look at this diagram...

 { ...      . - A Pixel                     }
 { .X.      X - Pixel we're on              }
 { 123      1, 2, 3 - Pixels to be averaged }

 {  - fill the bottom row with random numbers             }
 {    - for each row:                                     }
 {      - for each pixel:                                 }
 {        - average the three pixels below it and itself  }
 {        - decrease by one (if not already zero)         }
{
If that wasn't very clear, here's some source (sorry there's asm).
}

{$A+,B-,D+,E+,F-,G+,I+,L-,N-,O-,P-,Q-,R-,S-,T-,V+,X+,Y+}
{$M 16384,0,655360}
</i></font><font color="#FF0000"><b>Program </b></font>Fire<font color="#000080">;
 </font><font color="#FF0000"><b>Uses </b></font>Crt<font color="#000080">;

 </font><font color="#FF0000"><b>Const
  </b></font>VGASeg <font color="#000080">= </font><font color="#800000">$A000</font><font color="#000080">;

 </font><font color="#FF0000"><b>Type
  </b></font>VGAMem  <font color="#000080">= </font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">63999</font><font color="#000080">] </font><font color="#FF0000"><b>Of </b></font>Byte<font color="#000080">;

 </font><font color="#FF0000"><b>Var
  </b></font>VideoMem <font color="#000080">: </font>VGAMem <font color="#FF0000"><b>Absolute </b></font>VGASeg<font color="#000080">:</font><font color="#800000">0</font><font color="#000080">;
  </font>OldMode<font color="#000080">,
  </font>Color    <font color="#000080">: </font>Byte<font color="#000080">;
  </font>I        <font color="#000080">: </font>Word<font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>InitMode13h<font color="#000080">; </font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;
 </font><font color="#FF0000"><b>Asm
  </b></font><font color="#FF00FF">Mov AH, 0Fh       </font><font color="#008000"><i>{ Get Current Video Mode    }
  </i></font><font color="#FF00FF">Int 10h
  Mov [OldMode], AL </font><font color="#008000"><i>{ Save it                   }
  </i></font><font color="#FF00FF">Mov AX, 13H       </font><font color="#008000"><i>{ Init 320x200x256 Graphics }
  </i></font><font color="#FF00FF">Int 10H
 </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>CloseMode13h<font color="#000080">; </font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;
 </font><font color="#FF0000"><b>Asm
  </b></font><font color="#FF00FF">Xor AH, AH
  Mov AL, [OldMode] </font><font color="#008000"><i>{ Init Old Video Mode }
  </i></font><font color="#FF00FF">Int 10H
 </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>PutPixel<font color="#000080">(</font>X<font color="#000080">, </font>Y <font color="#000080">: </font>Word<font color="#000080">; </font>Color <font color="#000080">: </font>Byte<font color="#000080">); </font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;
 </font><font color="#FF0000"><b>Asm
  </b></font><font color="#FF00FF">Mov AX, VGASeg
  Mov ES, AX
  Mov BX, Y
  Mov DI, X
  Mov AH, BL
  Add DI, AX
  ShR AX, 2
  Add DI, AX
  Mov AL, Color
  Mov ES:[DI], AL
 </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>MakePalette<font color="#000080">;
 </font><font color="#FF0000"><b>Begin
  </b></font>Port<font color="#000080">[</font><font color="#800000">$3C6</font><font color="#000080">] := </font><font color="#800000">$FF</font><font color="#000080">;
  </font>Port<font color="#000080">[</font><font color="#800000">$3C8</font><font color="#000080">] := </font><font color="#800000">0</font><font color="#000080">;
  </font><font color="#FF0000"><b>For </b></font>I <font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>To </b></font><font color="#800000">255 </font><font color="#FF0000"><b>Do
   Begin
    </b></font>Port<font color="#000080">[</font><font color="#800000">$3C9</font><font color="#000080">] := </font>I <font color="#FF0000"><b>ShR </b></font><font color="#800000">2</font><font color="#000080">;
    </font>Port<font color="#000080">[</font><font color="#800000">$3C9</font><font color="#000080">] := </font>I <font color="#FF0000"><b>ShR </b></font><font color="#800000">4</font><font color="#000080">;
    </font>Port<font color="#000080">[</font><font color="#800000">$3C9</font><font color="#000080">] := </font><font color="#800000">0</font><font color="#000080">;
   </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
 </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>UpDateFire<font color="#000080">;
 </font><font color="#FF0000"><b>Begin
  For </b></font>I <font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>To </b></font><font color="#800000">319 </font><font color="#FF0000"><b>Do
    If </b></font>Random<font color="#000080">(</font><font color="#800000">2</font><font color="#000080">) = </font><font color="#800000">1 </font><font color="#FF0000"><b>Then
      </b></font>Putpixel<font color="#000080">(</font>I<font color="#000080">, </font><font color="#800000">199</font><font color="#000080">, </font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>Else
        </b></font>Putpixel<font color="#000080">(</font>I<font color="#000080">, </font>I<font color="#000080">, </font><font color="#800000">0</font><font color="#000080">);
   </font><font color="#FF0000"><b>Asm
    </b></font><font color="#FF00FF">Mov DI, 0A000h     </font><font color="#008000"><i>{ ES := Pixel Location (Segment) }
    </i></font><font color="#FF00FF">Mov ES, DI
    Mov DI, 63999-320  </font><font color="#008000"><i>{ DI := Current Pixel location (Offset) }
    </i></font><font color="#FF00FF">Mov CX, 32000      </font><font color="#008000"><i>{ Number of pixels to put (Counter)     }
    </i></font><font color="#FF00FF">Xor DH, DH
   @PixLoop:
    Mov AL, ES:[DI]     </font><font color="#008000"><i>{ AX := Average of colors       }
    </i></font><font color="#FF00FF">Mov DL, ES:[DI+319] </font><font color="#008000"><i>{ DL := Temp Reg to hold colors }
    </i></font><font color="#FF00FF">Add AX, DX
    Mov DL, ES:[DI+320]
    Add AX, DX
    Mov DL, ES:[DI+321]
    Add AX, DX
    ShR AX, 2
    JZ @Skip
    Dec AL
   @Skip:
    Mov ES:[DI], AL
    Dec DI
    Dec CX
    JNZ @PixLoop
   </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
 </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Begin
 </b></font>Randomize<font color="#000080">;
 </font>InitMode13h<font color="#000080">;
 </font>MakePalette<font color="#000080">;
  </font><font color="#FF0000"><b>Repeat
   </b></font>UpDateFire<font color="#000080">;
  </font><font color="#FF0000"><b>Until </b></font>KeyPressed<font color="#000080">;
 </font>ReadKey<font color="#000080">;
 </font>CloseMode13h<font color="#000080">;
 </font>Writeln<font color="#000080">(</font><font color="#800000">'This Program was written by Rick Haines in Turbo Pascal 7.0'</font><font color="#000080">);
</font><font color="#FF0000"><b>End</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to EGAVGA SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0203.PAS">Original</a><b>]</b></p></body>
</html>
