<html>
<head><title> "VESA Putpixel" by JON ZARATE</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to EGAVGA SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0180.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
&gt; Ok, here goes, I'm trying to write my own putpixel routine for
&gt; 640x480x256 and I have one working but the fastest I can do a
&gt; fullscreen memory write using it is 26.85 seconds! Using BGI drivers I
&gt; get 5-6 seconds! what am I missing? Is it because I'm using TP? does
&gt; anyone have inline assembly code for a putpixel at this resolution? I'm
&gt; using mode 101h with VESA driver loaded. I would really like to know
&gt; what I'm missing here! Any help is greatly appreciated.

Here's something I was working on... It's been a while since I touched
these but they work perfectly on my video (ATI/XL24/VESA 1.2). It takes
about 2 seconds to do a full 640x480 (VESA 101) on my 386DX/33.

I'm not sure if it will work on your system and I think it will work
only with window granularity of 64K. Please tell me if it works with
yours, and what granularity is 101 using on your system.
}

</i></font><font color="#FF0000"><b>var
 </b></font>VesaBank <font color="#000080">: </font>Word<font color="#000080">;     </font><font color="#008000"><i>{ bank cache     }
 </i></font>VesaSeg  <font color="#000080">: </font>Word<font color="#000080">;     </font><font color="#008000"><i>{ video segment  }
 </i></font>VesaBPL  <font color="#000080">: </font>Word<font color="#000080">;     </font><font color="#008000"><i>{ bytes per line }

</i></font><font color="#FF0000"><b>procedure </b></font>SetPixel<font color="#000080">(</font>X<font color="#000080">, </font>Y <font color="#000080">: </font>Word<font color="#000080">; </font>C <font color="#000080">: </font>Byte<font color="#000080">); </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>asm
 </b></font><font color="#FF00FF">mov ax,[Y]                   </font><font color="#008000"><i>{ transform X/Y into one linear offset }
 </i></font><font color="#FF00FF">mul [VesaBPL]                </font><font color="#008000"><i>{ DX:AX = Y * VesaBPL                  }
 </i></font><font color="#FF00FF">add ax,[X]                   </font><font color="#008000"><i>{ DX:AX = DX:AX + X                    }
 </i></font><font color="#FF00FF">adc dx,0                     </font><font color="#008000"><i>{                                      }
 </i></font><font color="#FF00FF">cmp dx,[VesaBank]            </font><font color="#008000"><i>{ Time to change bank?                 }
 </i></font><font color="#FF00FF">je @10                       </font><font color="#008000"><i>{ jump if not                          }
 </i></font><font color="#FF00FF">push ax                      </font><font color="#008000"><i>{ set the new memory bank...           }

 </i></font><font color="#FF00FF">mov ax,$4F05                 </font><font color="#008000"><i>{ AX = 4F05h Memory Control            }
 </i></font><font color="#FF00FF">mov bx,$0000                 </font><font color="#008000"><i>{ BH = Set Bank / BL = Window A        }
                              { DX = Memory Bank                     }
 </i></font><font color="#FF00FF">int $10                      </font><font color="#008000"><i>{ call VESA                            }

 </i></font><font color="#FF00FF">mov [VesaBank],dx            </font><font color="#008000"><i>{ save bank # to save time later       }

 </i></font><font color="#FF00FF">pop ax
@10:
 mov bx,ax                    </font><font color="#008000"><i>{ BX = memory offset                   }
 </i></font><font color="#FF00FF">mov ax,[VesaSeg]             </font><font color="#008000"><i>{ ES = Vesa segment                    }
 </i></font><font color="#FF00FF">mov es,ax                    </font><font color="#008000"><i>{                                      }
 </i></font><font color="#FF00FF">mov al,[C]                   </font><font color="#008000"><i>{ AL = pixel value                     }
 </i></font><font color="#FF00FF">mov es:[bx],al               </font><font color="#008000"><i>{ show it...                           }
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{
&gt; Also I'm wondering how to do direct memory writes to memory above 1 meg?
&gt; like 10000h etc... the highest MEM[] lets you go is FFFFh, any help there?

You will have to switch to protected mode to do that. If you just want
to store memory above 1meg, and not access specific parts of it (for
memory viewers, etc.), you can use EMS, XMS or switch over to BP7's
DPMI/protected mode.
}
</i></font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to EGAVGA SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0180.PAS">Original</a><b>]</b></p></body>
</html>
