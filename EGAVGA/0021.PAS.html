<html>
<head><title> "PALETTE tricks" by SWAG SUPPORT TEAM</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to EGAVGA SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0021.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{ FD&gt;  Hey Greg, do you think you could tell me how to access
 FD&gt; Mode-X, preferably the source, if it's no trouble.... :)

not a problem....  Mostly I do Graphics and stuff With C, but when it all comes
down to it, whether you use Pascal or C For the outer shell the main Graphics
routines are in Assembler (For speed) or use direct hardware port access
(again, For speed).
The following is a demo of using palette scrolling techniques in Mode 13h (X)
to produce a flashy &quot;bouncing bars&quot; effect often seen in demos:
}

</i></font><font color="#FF0000"><b>Program </b></font>PaletteTricks<font color="#000080">;
</font><font color="#008000"><i>{ Speccy demo in mode 13h (320x200x256) }

</i></font><font color="#FF0000"><b>Uses </b></font>Crt<font color="#000080">;

</font><font color="#FF0000"><b>Const </b></font>CGA_CharSet_Seg <font color="#000080">= </font><font color="#800000">$0F000</font><font color="#000080">;     </font><font color="#008000"><i>{ Location of BIOS CGA Character set }
      </i></font>CGA_CharSet_ofs <font color="#000080">= </font><font color="#800000">$0FA6E</font><font color="#000080">;
      </font>CharLength      <font color="#000080">= </font><font color="#800000">8</font><font color="#000080">;          </font><font color="#008000"><i>{ Each Char is 8x8 bits,  }
      </i></font>NumChars        <font color="#000080">= </font><font color="#800000">256</font><font color="#000080">;        </font><font color="#008000"><i>{ and there are 256 Chars }
      </i></font>VGA_Segment     <font color="#000080">= </font><font color="#800000">$0A000</font><font color="#000080">;     </font><font color="#008000"><i>{ Start of VGA memory     }
      </i></font>NumCycles       <font color="#000080">= </font><font color="#800000">200</font><font color="#000080">;        </font><font color="#008000"><i>{ Cycles/lines per screen }
      </i></font>Radius          <font color="#000080">= </font><font color="#800000">80</font><font color="#000080">;

      </font>DispStr         <font color="#000080">: </font><font color="#FF0000"><b>String </b></font><font color="#000080">=    </font><font color="#800000">' ...THIS IS A LITTLE '</font><font color="#000080">+
      </font><font color="#800000">'SCROLLY, DESIGNED to TEST SOME GROOVY PASCAL ROUTinES...'</font><font color="#000080">+
      </font><font color="#800000">'                                                        '</font><font color="#000080">;

      </font><font color="#008000"><i>{ Colours For moving bars... Each bar is 15 pixels thick }
      { Three colours are palette entries For RGB values...    }
      </i></font>Colours <font color="#000080">: </font><font color="#FF0000"><b>Array </b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">15</font><font color="#000080">*</font><font color="#800000">3</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Byte <font color="#000080">=
                 (  </font><font color="#800000">7</font><font color="#000080">,  </font><font color="#800000">7</font><font color="#000080">, </font><font color="#800000">63</font><font color="#000080">,
                   </font><font color="#800000">15</font><font color="#000080">, </font><font color="#800000">15</font><font color="#000080">, </font><font color="#800000">63</font><font color="#000080">,
                   </font><font color="#800000">23</font><font color="#000080">, </font><font color="#800000">23</font><font color="#000080">, </font><font color="#800000">63</font><font color="#000080">,
                   </font><font color="#800000">31</font><font color="#000080">, </font><font color="#800000">31</font><font color="#000080">, </font><font color="#800000">63</font><font color="#000080">,
                   </font><font color="#800000">39</font><font color="#000080">, </font><font color="#800000">39</font><font color="#000080">, </font><font color="#800000">63</font><font color="#000080">,
                   </font><font color="#800000">47</font><font color="#000080">, </font><font color="#800000">47</font><font color="#000080">, </font><font color="#800000">63</font><font color="#000080">,
                   </font><font color="#800000">55</font><font color="#000080">, </font><font color="#800000">55</font><font color="#000080">, </font><font color="#800000">63</font><font color="#000080">,
                   </font><font color="#800000">63</font><font color="#000080">, </font><font color="#800000">63</font><font color="#000080">, </font><font color="#800000">63</font><font color="#000080">,
                   </font><font color="#800000">55</font><font color="#000080">, </font><font color="#800000">55</font><font color="#000080">, </font><font color="#800000">63</font><font color="#000080">,
                   </font><font color="#800000">47</font><font color="#000080">, </font><font color="#800000">47</font><font color="#000080">, </font><font color="#800000">63</font><font color="#000080">,
                   </font><font color="#800000">39</font><font color="#000080">, </font><font color="#800000">39</font><font color="#000080">, </font><font color="#800000">63</font><font color="#000080">,
                   </font><font color="#800000">31</font><font color="#000080">, </font><font color="#800000">31</font><font color="#000080">, </font><font color="#800000">63</font><font color="#000080">,
                   </font><font color="#800000">23</font><font color="#000080">, </font><font color="#800000">23</font><font color="#000080">, </font><font color="#800000">63</font><font color="#000080">,
                   </font><font color="#800000">15</font><font color="#000080">, </font><font color="#800000">15</font><font color="#000080">, </font><font color="#800000">63</font><font color="#000080">,
                    </font><font color="#800000">7</font><font color="#000080">,  </font><font color="#800000">7</font><font color="#000080">, </font><font color="#800000">63  </font><font color="#000080">);


</font><font color="#FF0000"><b>Type  </b></font>OneChar <font color="#000080">= </font><font color="#FF0000"><b>Array </b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font>CharLength<font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Byte<font color="#000080">;

</font><font color="#FF0000"><b>Var   </b></font>CharSet<font color="#000080">:  </font><font color="#FF0000"><b>Array </b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font>NumChars<font color="#000080">] </font><font color="#FF0000"><b>of </b></font>OneChar<font color="#000080">;
      </font>Locs<font color="#000080">:     </font><font color="#FF0000"><b>Array </b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font>NumCycles<font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Integer<font color="#000080">;
      </font>BarLocs<font color="#000080">:  </font><font color="#FF0000"><b>Array </b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">4</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Integer<font color="#000080">;         </font><font color="#008000"><i>{ Location of each bar }
      </i></font>CurrVert<font color="#000080">,
      </font>Count<font color="#000080">:    </font>Integer<font color="#000080">;
      </font>Key<font color="#000080">:      </font>Char<font color="#000080">;
      </font>MemPos<font color="#000080">:   </font>Word<font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>GetChars<font color="#000080">;
</font><font color="#008000"><i>{ Read/copy BIOS Character set into Array }
  </i></font><font color="#FF0000"><b>Var </b></font>NumCounter<font color="#000080">,
      </font>ByteCounter<font color="#000080">,
      </font>MemCounter<font color="#000080">:       </font>Integer<font color="#000080">;
  </font><font color="#FF0000"><b>begin
      </b></font>MemCounter<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
      </font><font color="#FF0000"><b>For </b></font>NumCounter<font color="#000080">:=</font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>NumChars <font color="#FF0000"><b>do
        For </b></font>ByteCounter<font color="#000080">:=</font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>CharLength <font color="#FF0000"><b>do
          begin

</b></font>CharSet<font color="#000080">[</font>NumCounter<font color="#000080">][</font>ByteCounter<font color="#000080">]:=</font>Mem<font color="#000080">[</font>CGA_CharSet_Seg<font color="#000080">:</font>CGA_CharSet_ofs<font color="#000080">+</font>MemCounter<font color="#000080">];
            </font>inC<font color="#000080">(</font>MemCounter<font color="#000080">);
          </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>Procedure </b></font>VideoMode <font color="#000080">( </font>Mode <font color="#000080">: </font>Byte <font color="#000080">);
</font><font color="#008000"><i>{ Set the video display mode }
  </i></font><font color="#FF0000"><b>begin
      Asm
        </b></font><font color="#FF00FF">MOV  AH,00
        MOV  AL,Mode
        inT  10h
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>Procedure </b></font>SetColor <font color="#000080">( </font>Color<font color="#000080">, </font>Red<font color="#000080">, </font>Green<font color="#000080">, </font>Blue <font color="#000080">: </font>Byte <font color="#000080">);
</font><font color="#008000"><i>{ Update the colour palette, to define a new colour }
  </i></font><font color="#FF0000"><b>begin
      </b></font>Port<font color="#000080">[</font><font color="#800000">$3C8</font><font color="#000080">] := </font>Color<font color="#000080">;      </font><font color="#008000"><i>{ Colour number to redefine }
      </i></font>Port<font color="#000080">[</font><font color="#800000">$3C9</font><font color="#000080">] := </font>Red<font color="#000080">;        </font><font color="#008000"><i>{ Red value of new colour   }
      </i></font>Port<font color="#000080">[</font><font color="#800000">$3C9</font><font color="#000080">] := </font>Green<font color="#000080">;      </font><font color="#008000"><i>{ Green &quot;   &quot;   &quot;    &quot;      }
      </i></font>Port<font color="#000080">[</font><font color="#800000">$3C9</font><font color="#000080">] := </font>Blue<font color="#000080">;       </font><font color="#008000"><i>{ Blue  &quot;   &quot;   &quot;    &quot;      }
  </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>Procedure </b></font>DispVert <font color="#000080">( </font><font color="#FF0000"><b>Var </b></font>CurrLine <font color="#000080">: </font>Integer <font color="#000080">);
  </font><font color="#008000"><i>{ Display next vertical 'chunk' of the Character onscreen }
  </i></font><font color="#FF0000"><b>Var </b></font>Letter<font color="#000080">:    </font>OneChar<font color="#000080">;
      </font>VertLine<font color="#000080">,
      </font>Count<font color="#000080">:     </font>Integer<font color="#000080">;
  </font><font color="#FF0000"><b>begin
      </b></font><font color="#008000"><i>{ Calculate pixel position of start of letter: }
      </i></font>Letter <font color="#000080">:= </font>CharSet<font color="#000080">[</font>ord<font color="#000080">(</font>DispStr<font color="#000080">[(</font>CurrLine <font color="#FF0000"><b>div </b></font><font color="#800000">8</font><font color="#000080">)+</font><font color="#800000">1</font><font color="#000080">])+</font><font color="#800000">1</font><font color="#000080">];
      </font>VertLine <font color="#000080">:= (</font>CurrLine<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">) </font><font color="#FF0000"><b>Mod </b></font><font color="#800000">8</font><font color="#000080">;

      </font><font color="#008000"><i>{ Push the Character, pixel-by-pixel, to the screen: }
      </i></font><font color="#FF0000"><b>For </b></font>Count <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font><font color="#800000">8 </font><font color="#FF0000"><b>do
        if </b></font>Letter<font color="#000080">[</font>Count<font color="#000080">] </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font><font color="#800000">$80 </font><font color="#FF0000"><b>Shr </b></font>VertLine<font color="#000080">) = </font><font color="#800000">0
          </font><font color="#FF0000"><b>then </b></font>Mem<font color="#000080">[</font>VGA_Segment<font color="#000080">:</font><font color="#800000">185</font><font color="#000080">*</font><font color="#800000">320</font><font color="#000080">+(</font>Count<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">)*</font><font color="#800000">320</font><font color="#000080">+</font><font color="#800000">319</font><font color="#000080">] := </font><font color="#800000">0
          </font><font color="#FF0000"><b>else </b></font>Mem<font color="#000080">[</font>VGa_Segment<font color="#000080">:</font><font color="#800000">185</font><font color="#000080">*</font><font color="#800000">320</font><font color="#000080">+(</font>Count<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">)*</font><font color="#800000">320</font><font color="#000080">+</font><font color="#800000">319</font><font color="#000080">] := </font><font color="#800000">181</font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>CalcLocs<font color="#000080">;
</font><font color="#008000"><i>{ Calculate the location of the top of bars, based on sine curve }
  </i></font><font color="#FF0000"><b>Var </b></font>Count<font color="#000080">:    </font>Integer<font color="#000080">;
  </font><font color="#FF0000"><b>begin
      For </b></font>Count <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>NumCycles <font color="#FF0000"><b>do
        </b></font>Locs<font color="#000080">[</font>Count<font color="#000080">] := </font>Round<font color="#000080">(</font>Radius<font color="#000080">*</font>Sin<font color="#000080">((</font><font color="#800000">2</font><font color="#000080">*</font>Pi<font color="#000080">/</font>NumCycles<font color="#000080">)*</font>Count<font color="#000080">))+</font>Radius<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>Procedure </b></font>DoCycle<font color="#000080">;
</font><font color="#008000"><i>{  Display the bars on screen, by updating the palette entries to
   reflect the values from the COLOUR Array, or black For blank lines }

  </i></font><font color="#FF0000"><b>Label </b></font>Wait<font color="#000080">,</font>Retr<font color="#000080">,</font>BarLoop<font color="#000080">,</font>PrevIsLast<font color="#000080">,</font>Continue1<font color="#000080">,</font>Continue2<font color="#000080">,</font>Rep1<font color="#000080">,</font>Rep2<font color="#000080">;

  </font><font color="#FF0000"><b>begin
       Asm
          </b></font><font color="#008000"><i>{ First, wait For start of vertical retrace: }
          </i></font><font color="#FF00FF">MOV   DX,3DAh
Wait:     in    AL,DX
          TEST  AL,08h
          JZ    Wait
Retr:     in    AL,DX
          TEST  AL,08h
          JNZ   Retr

          </font><font color="#008000"><i>{ then do bars: }
           </i></font><font color="#FF00FF">MOV   BX,0
BarLoop:
           PUSH  BX
           MOV   AX,Word PTR BarLocs[BX]
           MOV   BX,AX
           DEC   BX
           SHL   BX,1
           MOV   AX,Word PTR Locs[BX]
           PUSH  AX
           CMP   BX,0
           JE    PrevIsLast
           DEC   BX
           DEC   BX
           MOV   AX,Word PTR Locs[BX]
           JMP   Continue1

PrevIsLast:
           MOV   AX,Word PTR Locs[(NumCycles-1)*2]

Continue1:
           MOV   DX,03C8h
           OUT   DX,AL
           inC   DX
           MOV   CX,15*3
           MOV   AL,0
Rep1:
           OUT   DX,AL
           LOOP  Rep1

           DEC   DX
           POP   AX
           OUT   DX,AL
           inC   DX
           MOV   CX,15*3
           xor   BX,BX
Rep2:
           MOV   AL,Byte Ptr Colours[BX]
           OUT   DX,AL
           inC   BX
           LOOP  Rep2

           POP   BX
           inC   Word PTR BarLocs[BX]
           CMP   Word PTR BarLocs[BX],NumCycles
           JNG   Continue2

           MOV   Word PTR BarLocs[BX],1
Continue2:
           inC   BX
           inC   BX
           CMP   BX,8
           JNE   BarLoop

        </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>begin

    </b></font>VideoMode<font color="#000080">(</font><font color="#800000">$13</font><font color="#000080">);             </font><font color="#008000"><i>{ Set video mode 320x200x256 }
    </i></font>Port<font color="#000080">[</font><font color="#800000">$3C8</font><font color="#000080">] := </font><font color="#800000">1</font><font color="#000080">;            </font><font color="#008000"><i>{ Write palette table entry }
    </i></font><font color="#FF0000"><b>For </b></font>Count <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font><font color="#800000">180 </font><font color="#FF0000"><b>do    </b></font><font color="#008000"><i>{ Black out the first 180 colours, }
      </i></font>SetColor<font color="#000080">(</font>Count<font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">);    </font><font color="#008000"><i>{ one colour will be used per line }

    { Now colour each scan line using the given palette colour: }
    </i></font>MemPos <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
    </font><font color="#FF0000"><b>For </b></font>Count <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font><font color="#800000">180 </font><font color="#FF0000"><b>do
      begin
        </b></font>FillChar<font color="#000080">(</font>Mem<font color="#000080">[</font>VGA_Segment<font color="#000080">:</font>MemPos<font color="#000080">],</font><font color="#800000">320</font><font color="#000080">,</font>Chr<font color="#000080">(</font>Count<font color="#000080">));
        </font>MemPos <font color="#000080">:= </font>MemPos <font color="#000080">+ </font><font color="#800000">320</font><font color="#000080">;
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

    </font>SetColor<font color="#000080">(</font><font color="#800000">181</font><font color="#000080">,</font><font color="#800000">63</font><font color="#000080">,</font><font color="#800000">63</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">);
    </font>CalcLocs<font color="#000080">;
    </font><font color="#FF0000"><b>For </b></font>Count <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font><font color="#800000">4 </font><font color="#FF0000"><b>do
      </b></font>BarLocs<font color="#000080">[</font>Count<font color="#000080">] := </font>Count<font color="#000080">*</font><font color="#800000">10</font><font color="#000080">;

    </font>GetChars<font color="#000080">;
    </font>CurrVert <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;
    </font><font color="#FF0000"><b>Repeat
      </b></font>DoCycle<font color="#000080">;
      </font><font color="#FF0000"><b>For </b></font>Count <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font><font color="#800000">8 </font><font color="#FF0000"><b>do
        </b></font>Move<font color="#000080">(</font>Mem<font color="#000080">[</font>VGA_Segment<font color="#000080">:</font><font color="#800000">185</font><font color="#000080">*</font><font color="#800000">320</font><font color="#000080">+(</font>Count<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">)*</font><font color="#800000">320</font><font color="#000080">+</font><font color="#800000">1</font><font color="#000080">],
             </font>Mem<font color="#000080">[</font>VGA_Segment<font color="#000080">:</font><font color="#800000">185</font><font color="#000080">*</font><font color="#800000">320</font><font color="#000080">+(</font>Count<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">)*</font><font color="#800000">320</font><font color="#000080">],</font><font color="#800000">319</font><font color="#000080">);
      </font>DispVert<font color="#000080">(</font>CurrVert<font color="#000080">);
      </font>inC<font color="#000080">(</font>CurrVert<font color="#000080">);
      </font><font color="#FF0000"><b>if </b></font>CurrVert <font color="#000080">&gt; </font>Length<font color="#000080">(</font>DispStr<font color="#000080">) * </font><font color="#800000">8
        </font><font color="#FF0000"><b>then </b></font>CurrVert <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;

    </font><font color="#FF0000"><b>Until </b></font>KeyPressed<font color="#000080">;   </font><font color="#008000"><i>{ Repeat Until a key is pressed... }

    </i></font>Key <font color="#000080">:= </font>ReadKey<font color="#000080">;     </font><font color="#008000"><i>{ Absorb the key pressed }
    </i></font>VideoMode<font color="#000080">(</font><font color="#800000">3</font><font color="#000080">);       </font><font color="#008000"><i>{ Reset video mode back to Textmode } </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">.
</font><font color="#FF0000"><b>end</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to EGAVGA SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0021.PAS">Original</a><b>]</b></p></body>
</html>
