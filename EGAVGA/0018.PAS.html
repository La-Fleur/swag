<html>
<head><title> "MODEXY for VGA" by MICHAEL MROSOWSKI</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to EGAVGA SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0018.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
For people who do not find any xsharp Near them, and who would like to test it
anyway i translated some Assembler-Code (not by me) back to to TP6.
I tested it on a 486/33 With multisynch and a 386/40 With an old bw/vga monitor
both worked well. Anyway i cannot guarantee that it works With every pc and is
healthy For every monitor, so be careful.
This Listing changes to 360x480x256 modex and displays some pixels.
Have fun With it !
}
(*Source: VGAKIT Version 3.4
   Copyright 1988,89,90 John Bridges
   Translated to Pascal (why?) by Michael Mrosowski *)

</i></font><font color="#FF0000"><b>Program </b></font>ModexTest<font color="#000080">;

</font><font color="#FF0000"><b>Uses </b></font>Crt<font color="#000080">,</font>Dos<font color="#000080">;

</font><font color="#FF0000"><b>Var
  </b></font>maxx<font color="#000080">,</font>maxy <font color="#000080">: </font>Word<font color="#000080">;

</font><font color="#008000"><i>(*Set Modex 360x480x256 *)

</i></font><font color="#FF0000"><b>Procedure </b></font>SetModex<font color="#000080">;
</font><font color="#FF0000"><b>Const
 </b></font>VptLen<font color="#000080">=</font><font color="#800000">17</font><font color="#000080">;
 </font>Vpt <font color="#000080">: </font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font>VptLen<font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Word <font color="#000080">=
                    (</font><font color="#800000">$6b00 </font><font color="#000080">, </font><font color="#008000"><i>(* horz total                      *)
                     </i></font><font color="#800000">$5901 </font><font color="#000080">, </font><font color="#008000"><i>(* horz displayed                  *)
                     </i></font><font color="#800000">$5a02 </font><font color="#000080">, </font><font color="#008000"><i>(* start horz blanking             *)
                     </i></font><font color="#800000">$8e03 </font><font color="#000080">, </font><font color="#008000"><i>(* end horz blanking               *)
                     </i></font><font color="#800000">$5e04 </font><font color="#000080">, </font><font color="#008000"><i>(* start h sync                    *)
                     </i></font><font color="#800000">$8a05 </font><font color="#000080">, </font><font color="#008000"><i>(* end h sync                      *)
                     </i></font><font color="#800000">$0d06 </font><font color="#000080">, </font><font color="#008000"><i>(* vertical total                  *)
                     </i></font><font color="#800000">$3e07 </font><font color="#000080">, </font><font color="#008000"><i>(* overflow                        *)
                     </i></font><font color="#800000">$4009 </font><font color="#000080">, </font><font color="#008000"><i>(* cell height                     *)
                     </i></font><font color="#800000">$ea10 </font><font color="#000080">, </font><font color="#008000"><i>(* v sync start                    *)
                     </i></font><font color="#800000">$ac11 </font><font color="#000080">, </font><font color="#008000"><i>(* v sync end and protect cr0-cr7  *)
                     </i></font><font color="#800000">$df12 </font><font color="#000080">, </font><font color="#008000"><i>(* vertical displayed              *)
                     </i></font><font color="#800000">$2d13 </font><font color="#000080">, </font><font color="#008000"><i>(* offset                          *)
                     </i></font><font color="#800000">$0014 </font><font color="#000080">, </font><font color="#008000"><i>(* turn off dWord mode             *)
                     </i></font><font color="#800000">$e715 </font><font color="#000080">, </font><font color="#008000"><i>(* v blank start                   *)
                     </i></font><font color="#800000">$0616 </font><font color="#000080">, </font><font color="#008000"><i>(* v blank end                     *)
                     </i></font><font color="#800000">$e317</font><font color="#000080">); </font><font color="#008000"><i>(* turn on Byte mode               *)
</i></font><font color="#FF0000"><b>Var
  </b></font>regs<font color="#000080">:</font>Registers<font color="#000080">;
  </font>i<font color="#000080">:</font>Integer<font color="#000080">;
  </font>cr11<font color="#000080">:</font>Byte<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>maxx<font color="#000080">:=</font><font color="#800000">360</font><font color="#000080">;
  </font>maxy<font color="#000080">:=</font><font color="#800000">480</font><font color="#000080">;
  </font>regs<font color="#000080">.</font>ax<font color="#000080">:=</font><font color="#800000">$13</font><font color="#000080">;       </font><font color="#008000"><i>(*start With standardmode 13h*)
  </i></font>Intr<font color="#000080">(</font><font color="#800000">$10</font><font color="#000080">,</font>regs<font color="#000080">);     </font><font color="#008000"><i>(*hi bios!*)

  </i></font>PortW<font color="#000080">[</font><font color="#800000">$3c4</font><font color="#000080">]:=</font><font color="#800000">$0604</font><font color="#000080">; </font><font color="#008000"><i>(*alter sequencer Registers: disable chain 4*)
  </i></font>PortW<font color="#000080">[</font><font color="#800000">$3c4</font><font color="#000080">]:=</font><font color="#800000">$0F02</font><font color="#000080">; </font><font color="#008000"><i>(*    set Write plane mask to all bit planes*)
  </i></font>FillChar<font color="#000080">(</font>Mem<font color="#000080">[</font><font color="#800000">$a000</font><font color="#000080">:</font><font color="#800000">0</font><font color="#000080">],</font><font color="#800000">43200</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">); </font><font color="#008000"><i>(* Clearscreen *)
                      (*  ((XSIZE*YSIZE)/(4 planes)) *)

  </i></font>PortW<font color="#000080">[</font><font color="#800000">$3c4</font><font color="#000080">]:=</font><font color="#800000">$0100</font><font color="#000080">; </font><font color="#008000"><i>(*synchronous reset*)
  </i></font>Port <font color="#000080">[</font><font color="#800000">$3c2</font><font color="#000080">]:=</font><font color="#800000">$E7</font><font color="#000080">;   </font><font color="#008000"><i>(*misc output : use 28 Mhz dot clock*)
  </i></font>PortW<font color="#000080">[</font><font color="#800000">$3c4</font><font color="#000080">]:=</font><font color="#800000">$0300</font><font color="#000080">; </font><font color="#008000"><i>(*sequencer   : restart*)

  </i></font>Port <font color="#000080">[</font><font color="#800000">$3d4</font><font color="#000080">]:=</font><font color="#800000">$11</font><font color="#000080">;   </font><font color="#008000"><i>(*select Crtc register cr11*)
  </i></font>cr11<font color="#000080">:=</font>Port<font color="#000080">[</font><font color="#800000">$3d5</font><font color="#000080">];
  </font>Port <font color="#000080">[</font><font color="#800000">$3d5</font><font color="#000080">]:=</font>cr11 <font color="#FF0000"><b>and </b></font><font color="#800000">$7F</font><font color="#000080">; </font><font color="#008000"><i>(*Write protect*)

  </i></font><font color="#FF0000"><b>For </b></font>i<font color="#000080">:=</font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>vptlen <font color="#FF0000"><b>do </b></font><font color="#008000"><i>(*Write Crtc-Registers*)
    </i></font>PortW<font color="#000080">[</font><font color="#800000">$3d4</font><font color="#000080">]:=</font>Vpt<font color="#000080">[</font>i<font color="#000080">];
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#008000"><i>(*Put pixel in 360x480 (no check)*)

</i></font><font color="#FF0000"><b>Procedure </b></font>PutPixel<font color="#000080">(</font>x<font color="#000080">,</font>y<font color="#000080">:</font>Word<font color="#000080">;</font>c<font color="#000080">:</font>Byte<font color="#000080">);
</font><font color="#FF0000"><b>begin
  </b></font>PortW<font color="#000080">[</font><font color="#800000">$3c4</font><font color="#000080">]:=(</font><font color="#800000">$100 </font><font color="#FF0000"><b>shl </b></font><font color="#000080">(</font>x <font color="#FF0000"><b>and </b></font><font color="#800000">3</font><font color="#000080">))+</font><font color="#800000">2</font><font color="#000080">; </font><font color="#008000"><i>(*set EGA bit plane mask register*)
  </i></font>Mem<font color="#000080">[</font><font color="#800000">$a000</font><font color="#000080">:</font>y<font color="#000080">*(</font>maxx <font color="#FF0000"><b>shr </b></font><font color="#800000">2</font><font color="#000080">) + (</font>x <font color="#FF0000"><b>shr </b></font><font color="#800000">2</font><font color="#000080">)]:=</font>c<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Var </b></font>c<font color="#000080">:</font>Char<font color="#000080">;
    </font>i<font color="#000080">,</font>j<font color="#000080">:</font>Integer<font color="#000080">;

</font><font color="#FF0000"><b>begin
  </b></font>SetModex<font color="#000080">;
  </font><font color="#FF0000"><b>For </b></font>j<font color="#000080">:=</font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font><font color="#800000">479 </font><font color="#FF0000"><b>do  </b></font><font color="#008000"><i>(* Nearly SVGA With your good old 256k VGA*)
    </i></font><font color="#FF0000"><b>For </b></font>i<font color="#000080">:=</font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font><font color="#800000">359 </font><font color="#FF0000"><b>do
      </b></font>PutPixel<font color="#000080">(</font>i<font color="#000080">,</font>j<font color="#000080">,(</font>i<font color="#000080">+</font>j<font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#800000">$FF</font><font color="#000080">);
  </font>c<font color="#000080">:=</font>ReadKey<font color="#000080">;
  </font>TextMode<font color="#000080">(</font>LastMode<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">.</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to EGAVGA SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0018.PAS">Original</a><b>]</b></p></body>
</html>
