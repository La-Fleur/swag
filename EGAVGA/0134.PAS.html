<html>
<head><title> "640x480x16 Mode Programming" by ARNE DE.BRUIJN</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to EGAVGA SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0134.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
&gt; 640/480/16 mode... Yes I know how to put a pixel with the
&gt; What I want is Line, Bitmap procedure...

The first is mine, the second a bit.
}

</i></font><font color="#FF0000"><b>procedure </b></font>FillBox<font color="#000080">(</font>X1<font color="#000080">,</font>Y1<font color="#000080">,</font>X2<font color="#000080">,</font>Y2<font color="#000080">:</font>word<font color="#000080">; </font>Color<font color="#000080">:</font>byte<font color="#000080">); </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#008000"><i>{ Fill (X1,Y1)-(X2,Y1) with Color, VGA only, 640 lines, 16 color mode, PD }
</i></font><font color="#FF0000"><b>asm
 </b></font><font color="#FF00FF">cld
 mov dx,3ceh
 mov ah,Color
 mov al,0
 out dx,ax
 mov ax,0305h
 out dx,ax
 mov ax,0a000h
 mov es,ax
 mov ax,Y1
 mov si,Y2
 sub si,ax
 jz @NoLines
 </font><font color="#008000"><i>{$ifopt G+}</i></font><font color="#FF00FF">shl ax,6</font><font color="#008000"><i>{$else}</i></font><font color="#FF00FF">mov cl,6;shl ax,cl</font><font color="#008000"><i>{$endif}
 </i></font><font color="#FF00FF">mov di,ax
 </font><font color="#008000"><i>{$ifopt G+}</i></font><font color="#FF00FF">shr ax,2</font><font color="#008000"><i>{$else}</i></font><font color="#FF00FF">shr ax,1; shr ax,1</font><font color="#008000"><i>{$endif}
 </i></font><font color="#FF00FF">add di,ax
 mov ax,X1
 mov cl,al
 </font><font color="#008000"><i>{$ifdef G+}</i></font><font color="#FF00FF">shr ax,3</font><font color="#008000"><i>{$else}</i></font><font color="#FF00FF">shr ax,1; shr ax,1; shr ax,1</font><font color="#008000"><i>{$endif}
 </i></font><font color="#FF00FF">mov bx,X2
 mov ch,bl
 </font><font color="#008000"><i>{$ifdef G+}</i></font><font color="#FF00FF">shr bx,3</font><font color="#008000"><i>{$else}</i></font><font color="#FF00FF">shr bx,1; shr bx,1; shr bx,1</font><font color="#008000"><i>{$endif}
 </i></font><font color="#FF00FF">sub bx,ax
 push bp
 mov bp,bx
 add di,ax
 and cx,707h
 mov bx,0ffffh
 shr bl,cl
 mov cl,ch
 xor cl,7
 inc cx
 shl bh,cl
 or bp,bp
 jnz @NoDub
 and bl,bh
 jz @NoLines2
@NoDub:
 mov al,8
@PutLines:
 cli
 mov al,es:[di]
 mov es:[di],bl
 sti
 inc di
 mov cx,bp
 dec cx
 js @NoPBL
 jz @NoPB
 mov al,0ffh
 rep stosb
@NoPB:
 cli
 mov al,es:[di]
 mov es:[di],bh
 sti
 inc di
@NoPBL:
 sub di,bp
 add di,80-1
 dec si
 jnz @PutLines
@NoLines2:
 pop bp
@NoLines:
 mov ax,0005h
 out dx,ax
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>PixelAddrHGC<font color="#000080">; </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>asm
 </b></font><font color="#FF00FF">mov cl,bl
 </font><font color="#008000"><i>{$ifopt G+}</i></font><font color="#FF00FF">shr bx,3</font><font color="#008000"><i>{$else}</i></font><font color="#FF00FF">shr bx,1;shr bx,1;shr bx,1</font><font color="#008000"><i>{$endif}
 {$ifopt G+}</i></font><font color="#FF00FF">shl ax,6</font><font color="#008000"><i>{$else}</i></font><font color="#FF00FF">mov ch,cl; mov cl,6; shl ax,cl; mov cl,ch;</font><font color="#008000"><i>{$endif}
 </i></font><font color="#FF00FF">add bx,ax
 </font><font color="#008000"><i>{$ifopt G+}</i></font><font color="#FF00FF">shr ax,2</font><font color="#008000"><i>{$else}</i></font><font color="#FF00FF">shr ax,1; shr ax,1;</font><font color="#008000"><i>{$endif}
 </i></font><font color="#FF00FF">add bx,ax
 mov ax,0a000h
 mov es,ax
 and cl,7
 xor cl,7
 mov ah,1
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>Line<font color="#000080">(</font>X1<font color="#000080">,</font>Y1<font color="#000080">,</font>X2<font color="#000080">,</font>Y2<font color="#000080">:</font>word<font color="#000080">; </font>Color<font color="#000080">:</font>byte<font color="#000080">); </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#008000"><i>{ Draw a line from (X1,Y1)-(X2,Y2) in Color, VGA only, 640 lines, 16 colors }
{ Originally from a HGC line routine in a book, converted to VGA by me }
</i></font><font color="#FF0000"><b>const
 </b></font>ByteOffsetShift<font color="#000080">=</font><font color="#800000">3</font><font color="#000080">;
</font><font color="#FF0000"><b>var
 </b></font>Incr1<font color="#000080">,</font>Incr2<font color="#000080">:</font>word<font color="#000080">;
 </font>Routine<font color="#000080">:</font>word<font color="#000080">;
</font><font color="#FF0000"><b>asm
        </b></font><font color="#FF00FF">cld
        mov si,80
        mov dx,3ceh
        mov ah,Color
        xor al,al
        out dx,ax
        mov ax,0305h
        out dx,ax
        mov cx,X2
        sub cx,X1
        jz @VertLineHGC    </font><font color="#008000"><i>{ Jump if X1=X2, VertLine }
        </i></font><font color="#FF00FF">jns @Li01          </font><font color="#008000"><i>{ Jump if X2&gt;X1, no swap }
        </i></font><font color="#FF00FF">neg cx
        mov bx,X2
        xchg bx,X1
        mov X2,bx
        mov bx,Y2
        xchg bx,Y1
        mov Y2,bx
@Li01:  mov bx,Y2
        sub bx,Y1
        jnz @Li02          </font><font color="#008000"><i>{ Jump if Y1&lt;&gt;Y2, no HorizLine }
        </i></font><font color="#FF00FF">jmp @HorizLineHGC
@Li02:  jns @Li03          </font><font color="#008000"><i>{ Jump if Y2 &gt; Y1, no swap }
        </i></font><font color="#FF00FF">neg bx
        neg si
@Li03:  mov routine,offset @LoSlopeLineHGC
        cmp bx,cx
        jle @Li04
        mov routine,offset @HiSlopeLineHGC
        xchg bx,cx
@Li04:  shl bx,1
        mov incr1,bx
        sub bx,cx
        mov di,bx
        sub bx,cx
        mov incr2,bx
        push cx
        mov ax,Y1
        mov bx,X1
        call PixelAddrHGC
        mov al,1
        shl ax,cl
        mov dx,ax
        not dh
        pop cx
        inc cx
        jmp routine          </font><font color="#008000"><i>{ Var containing LoSlope/HiSlope }

</i></font><font color="#FF00FF">@VertLineHGC: mov ax,Y1
        mov bx,Y2
        mov cx,bx
        sub cx,ax
        jge @Li31
        neg cx
        mov ax,bx
@Li31:  inc cx
        mov bx,X1
        push cx
        call PixelAddrHGC
        mov al,1
        shl ax,cl
        not ah
        pop cx
@Li32:  mov ah,es:[bx]
        mov es:[bx],al
        add bx,si
        loop @Li32
        jmp @Liexit

@HorizLineHGC:
        mov ax,Y1
        mov bx,X1
        call PixelAddrHGC
        mov di,bx
        mov dh,ah
        not dh
        mov dl,0ffh
        shl dh,cl
        not dh
        mov cx,X2
        and cl,7
        xor cl,7
        shl dl,cl
        mov ax,X2
        mov bx,X1
        mov cl,ByteOffsetShift
        shr ax,cl
        shr bx,cl
        mov cx,ax
        sub cx,bx
        mov ax,0ffffh
        or dh,dh
        js @Li43
        or cx,cx
        jnz @Li42
        and dl,dh
        jmp @Li44
@Li42:  mov ah,al
        and ah,dh
        mov bl,es:[di]
        mov es:[di],ah
        inc di
        dec cx
@Li43:  or cx,cx
        jz @Li44
@InLoop: mov bl,es:[di]
        stosb
        loop @InLoop
      </font><font color="#008000"><i>{  if mode = NO_OP replace 'or cx,cx'-'loop @InLoop:' with 'rep stosb'}
</i></font><font color="#FF00FF">@Li44:  and al,dl
        mov dl,es:[di]
        mov es:[di],al
        jmp @Liexit

@LoSlopeLineHGC:
@Li10:  mov ah,es:[bx]
        xor ah,ah
@Li11:  or ah,dl
        ror dl,1
        ror dh,1
        jnc @Li14
        or di,di
        jns @Li12
        add di,incr1
        loop @Li11
        mov es:[bx],ah
        jmp @Liexit
@Li12:  add di,incr2
        mov es:[bx],ah
        add bx,si
        loop @Li10
        jmp @Liexit
@Li14:  mov es:[bx],ah
        inc bx
        or di,di
        jns @Li15
        add di,incr1
        loop @Li10
        jmp @Liexit
@Li15:  add di,incr2
        add bx,si
        loop @Li10
        jmp @Liexit

@HiSlopeLineHGC:
@Li21:  mov al,es:[bx]
        mov es:[bx],dl
        add bx,si
        or di,di
        jns @Li23
        add di,incr1
        loop @Li21
        jmp @Liexit
@Li23:  add di,incr2
        ror dl,1
        ror dh,1
        cmc
        adc bx,0
        loop @Li21
@Liexit:
 mov dx,3ceh
 mov ax,5
 out dx,ax
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to EGAVGA SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0134.PAS">Original</a><b>]</b></p></body>
</html>
