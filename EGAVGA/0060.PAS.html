<html>
<head><title> "VGA TEXT Support" by WIM VAN DER VEGT</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to EGAVGA SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0060.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{===========================================================================
Date: 10-09-93 (10:40)
From: WIM VAN DER VEGT
Subj: textmodes w/43/50 lines
---------------------------------------------------------------------------
Here the uncodes sources of some routines I've written to replace
turbo's internal textmode routines to enable 43 &amp; 50 lines textmodes on
VGA. They use the BIOS and can be combined with normal read/write
statements. Just use the unit and call one of the Vgaxxlines routines.

{---------------------------------------------------------}
{  Project : Vga Textmode Support                         }
{  By      : G.W. van der Vegt                            }
{---------------------------------------------------------}
{  Date  .time  Revision                                  }
{  931003.2200  Creatie.                                  }
{---------------------------------------------------------}

</i></font><font color="#FF0000"><b>Unit </b></font>Vts_01<font color="#000080">;

</font><font color="#FF0000"><b>Interface

Function  </b></font>MaxX <font color="#000080">: </font>Byte<font color="#000080">;

</font><font color="#FF0000"><b>Function  </b></font>MaxY <font color="#000080">: </font>Byte<font color="#000080">;

</font><font color="#FF0000"><b>Function  </b></font>WhereX <font color="#000080">: </font>Byte<font color="#000080">;

</font><font color="#FF0000"><b>Function  </b></font>WhereY <font color="#000080">: </font>Byte<font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>GotoXY<font color="#000080">(</font>x<font color="#000080">,</font>y <font color="#000080">: </font>Byte<font color="#000080">);

</font><font color="#FF0000"><b>Function  </b></font>GetXY<font color="#000080">(</font>x<font color="#000080">,</font>y <font color="#000080">: </font>Byte<font color="#000080">) : </font>Char<font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>vga50lines<font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>vga43lines<font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>vga25lines<font color="#000080">;

</font><font color="#008000"><i>{---------------------------------------------------------}

</i></font><font color="#FF0000"><b>Implementation

Uses
  </b></font>Dos<font color="#000080">;

</font><font color="#008000"><i>{---------------------------------------------------------}

</i></font><font color="#FF0000"><b>Function </b></font>MaxX <font color="#000080">: </font>Byte<font color="#000080">;

</font><font color="#008000"><i>{----Return horizontal size of textmode in characters}

</i></font><font color="#FF0000"><b>Var
  </b></font>r      <font color="#000080">: </font>Registers<font color="#000080">;

</font><font color="#FF0000"><b>Begin
  </b></font>r<font color="#000080">.</font>ah<font color="#000080">:=</font><font color="#800000">$0F</font><font color="#000080">;
  </font>Intr<font color="#000080">(</font><font color="#800000">$10</font><font color="#000080">,</font>r<font color="#000080">);
  </font>MaxX<font color="#000080">:=</font>r<font color="#000080">.</font>AH<font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">; </font><font color="#008000"><i>{of MaxX}

{---------------------------------------------------------}

</i></font><font color="#FF0000"><b>Function </b></font>MaxY <font color="#000080">: </font>Byte<font color="#000080">;

</font><font color="#008000"><i>{----Return vertical size of textmode in characters}

</i></font><font color="#FF0000"><b>Var
  </b></font>r      <font color="#000080">: </font>Registers<font color="#000080">;
  </font>buf    <font color="#000080">: </font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">63</font><font color="#000080">] </font><font color="#FF0000"><b>Of </b></font>byte<font color="#000080">;

</font><font color="#FF0000"><b>Begin
  </b></font>r<font color="#000080">.</font>ah<font color="#000080">:=</font><font color="#800000">$1B</font><font color="#000080">;
  </font>r<font color="#000080">.</font>bx<font color="#000080">:=</font><font color="#800000">$00</font><font color="#000080">;
  </font>r<font color="#000080">.</font>es<font color="#000080">:=</font>Seg<font color="#000080">(</font>buf<font color="#000080">);
  </font>r<font color="#000080">.</font>di<font color="#000080">:=</font>Ofs<font color="#000080">(</font>buf<font color="#000080">);
  </font>Intr<font color="#000080">(</font><font color="#800000">$10</font><font color="#000080">,</font>r<font color="#000080">);
  </font>MaxY<font color="#000080">:=</font>buf<font color="#000080">[</font><font color="#800000">$22</font><font color="#000080">];
</font><font color="#FF0000"><b>End</b></font><font color="#000080">; </font><font color="#008000"><i>{of MaxY}

{---------------------------------------------------------}

</i></font><font color="#FF0000"><b>Function </b></font>WhereX <font color="#000080">: </font>Byte<font color="#000080">;

</font><font color="#008000"><i>{----WhereX, aware of textmodes larger than 80x25}

</i></font><font color="#FF0000"><b>Var
  </b></font>r <font color="#000080">: </font>registers<font color="#000080">;

</font><font color="#FF0000"><b>Begin
  </b></font>r<font color="#000080">.</font>ah<font color="#000080">:=</font><font color="#800000">$0f</font><font color="#000080">;
  </font>Intr<font color="#000080">(</font><font color="#800000">$10</font><font color="#000080">,</font>r<font color="#000080">);
  </font>r<font color="#000080">.</font>ah<font color="#000080">:=</font><font color="#800000">$03</font><font color="#000080">;
  </font>Intr<font color="#000080">(</font><font color="#800000">$10</font><font color="#000080">,</font>r<font color="#000080">);
  </font>WhereX<font color="#000080">:=</font>r<font color="#000080">.</font>dl<font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">; </font><font color="#008000"><i>{of WhereX}

{---------------------------------------------------------}

</i></font><font color="#FF0000"><b>Function </b></font>WhereY <font color="#000080">: </font>Byte<font color="#000080">;

</font><font color="#008000"><i>{----WhereY, aware of textmodes larger than 80x25}


</i></font><font color="#FF0000"><b>Var
  </b></font>r <font color="#000080">: </font>registers<font color="#000080">;

</font><font color="#FF0000"><b>Begin
  </b></font>r<font color="#000080">.</font>ah<font color="#000080">:=</font><font color="#800000">$0f</font><font color="#000080">;
  </font>Intr<font color="#000080">(</font><font color="#800000">$10</font><font color="#000080">,</font>r<font color="#000080">);
  </font>r<font color="#000080">.</font>ah<font color="#000080">:=</font><font color="#800000">$03</font><font color="#000080">;
  </font>Intr<font color="#000080">(</font><font color="#800000">$10</font><font color="#000080">,</font>r<font color="#000080">);
  </font>WhereY<font color="#000080">:=</font>r<font color="#000080">.</font>dh<font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">; </font><font color="#008000"><i>{of WhereY}

{---------------------------------------------------------}

</i></font><font color="#FF0000"><b>Procedure </b></font>GotoXY<font color="#000080">(</font>x<font color="#000080">,</font>y <font color="#000080">: </font>Byte<font color="#000080">);

</font><font color="#008000"><i>{----GotoXY, aware of textmodes larger than 80x25}

</i></font><font color="#FF0000"><b>Var
  </b></font>r <font color="#000080">: </font>registers<font color="#000080">;

</font><font color="#FF0000"><b>Begin
  </b></font>r<font color="#000080">.</font>ah<font color="#000080">:=</font><font color="#800000">$0f</font><font color="#000080">;
  </font>Intr<font color="#000080">(</font><font color="#800000">$10</font><font color="#000080">,</font>r<font color="#000080">);
  </font>r<font color="#000080">.</font>ah<font color="#000080">:=</font><font color="#800000">$02</font><font color="#000080">;
  </font>r<font color="#000080">.</font>dh<font color="#000080">:=</font>y<font color="#000080">;
  </font>r<font color="#000080">.</font>dl<font color="#000080">:=</font>x<font color="#000080">;
  </font>Intr<font color="#000080">(</font><font color="#800000">$10</font><font color="#000080">,</font>r<font color="#000080">);
</font><font color="#FF0000"><b>End</b></font><font color="#000080">; </font><font color="#008000"><i>{of GotoXY}

{---------------------------------------------------------}

</i></font><font color="#FF0000"><b>Function </b></font>GetXY<font color="#000080">(</font>x<font color="#000080">,</font>y <font color="#000080">: </font>Byte<font color="#000080">) : </font>Char<font color="#000080">;

</font><font color="#008000"><i>{----GetXY, returns char at x,y and is aware of textmodes larger than 80x25}
{           leave cursor unchanged.                                        }

</i></font><font color="#FF0000"><b>Var
  </b></font>r     <font color="#000080">: </font>registers<font color="#000080">;
  </font>xs<font color="#000080">,</font>ys <font color="#000080">: </font>Byte<font color="#000080">;
</font><font color="#FF0000"><b>Begin
  </b></font>xs<font color="#000080">:=</font>WhereX<font color="#000080">;
  </font>ys<font color="#000080">:=</font>WhereY<font color="#000080">;
  </font>GotoXY<font color="#000080">(</font>x<font color="#000080">,</font>y<font color="#000080">);
  </font>r<font color="#000080">.</font>ah<font color="#000080">:=</font><font color="#800000">$0f</font><font color="#000080">;
  </font>Intr<font color="#000080">(</font><font color="#800000">$10</font><font color="#000080">,</font>r<font color="#000080">);
  </font>r<font color="#000080">.</font>ah<font color="#000080">:=</font><font color="#800000">$08</font><font color="#000080">;
  </font>Intr<font color="#000080">(</font><font color="#800000">$10</font><font color="#000080">,</font>r<font color="#000080">);
  </font>GetXY<font color="#000080">:=</font>Chr<font color="#000080">(</font>r<font color="#000080">.</font>al<font color="#000080">);
  </font>GotoXY<font color="#000080">(</font>xs<font color="#000080">,</font>ys<font color="#000080">);
</font><font color="#FF0000"><b>End</b></font><font color="#000080">; </font><font color="#008000"><i>{of GotoXY}

{---------------------------------------------------------}

</i></font><font color="#FF0000"><b>Procedure </b></font>vga50lines<font color="#000080">;

</font><font color="#008000"><i>{----Put VGA display into 80x50 textmode}

</i></font><font color="#FF0000"><b>Var
  </b></font>r <font color="#000080">: </font>registers<font color="#000080">;
  </font>b <font color="#000080">: </font>Byte<font color="#000080">;

</font><font color="#FF0000"><b>Begin
</b></font><font color="#008000"><i>{----50 line mode}
  </i></font>b<font color="#000080">:=</font>Mem<font color="#000080">[</font><font color="#800000">$40</font><font color="#000080">:</font><font color="#800000">$87</font><font color="#000080">];
  </font>Mem<font color="#000080">[</font><font color="#800000">$40</font><font color="#000080">:</font><font color="#800000">$87</font><font color="#000080">]:=</font>Mem<font color="#000080">[</font><font color="#800000">$40</font><font color="#000080">:</font><font color="#800000">$87</font><font color="#000080">] </font><font color="#FF0000"><b>OR </b></font><font color="#800000">$01</font><font color="#000080">;
  </font>r<font color="#000080">.</font>ah<font color="#000080">:=</font><font color="#800000">$11</font><font color="#000080">;
  </font>r<font color="#000080">.</font>al<font color="#000080">:=</font><font color="#800000">$12</font><font color="#000080">; </font><font color="#008000"><i>{----8x8 Character set}
  </i></font>r<font color="#000080">.</font>bl<font color="#000080">:=</font><font color="#800000">$00</font><font color="#000080">;
  </font>Intr<font color="#000080">(</font><font color="#800000">$10</font><font color="#000080">,</font>r<font color="#000080">);
  </font>Mem<font color="#000080">[</font><font color="#800000">$40</font><font color="#000080">:</font><font color="#800000">$87</font><font color="#000080">]:=</font>b<font color="#000080">;

</font><font color="#008000"><i>{----400 scan lines neccesary}
  </i></font>r<font color="#000080">.</font>ah<font color="#000080">:=</font><font color="#800000">$12</font><font color="#000080">;
  </font>r<font color="#000080">.</font>al<font color="#000080">:=</font><font color="#800000">$02</font><font color="#000080">; </font><font color="#008000"><i>{----400}
  </i></font>r<font color="#000080">.</font>bl<font color="#000080">:=</font><font color="#800000">$30</font><font color="#000080">;
  </font>Intr<font color="#000080">(</font><font color="#800000">$10</font><font color="#000080">,</font>r<font color="#000080">);
</font><font color="#FF0000"><b>End</b></font><font color="#000080">; </font><font color="#008000"><i>{of Vga50lines}

{---------------------------------------------------------}

</i></font><font color="#FF0000"><b>Procedure </b></font>vga43lines<font color="#000080">;

</font><font color="#008000"><i>{----Put VGA display into 80x43 (EGA) textmode}

</i></font><font color="#FF0000"><b>Var
  </b></font>r <font color="#000080">: </font>registers<font color="#000080">;
  </font>b <font color="#000080">: </font>Byte<font color="#000080">;

</font><font color="#FF0000"><b>Begin
</b></font><font color="#008000"><i>{----43 line mode}
  </i></font>b<font color="#000080">:=</font>Mem<font color="#000080">[</font><font color="#800000">$40</font><font color="#000080">:</font><font color="#800000">$87</font><font color="#000080">];
  </font>Mem<font color="#000080">[</font><font color="#800000">$40</font><font color="#000080">:</font><font color="#800000">$87</font><font color="#000080">]:=</font>Mem<font color="#000080">[</font><font color="#800000">$40</font><font color="#000080">:</font><font color="#800000">$87</font><font color="#000080">] </font><font color="#FF0000"><b>OR </b></font><font color="#800000">$01</font><font color="#000080">;
  </font>r<font color="#000080">.</font>ah<font color="#000080">:=</font><font color="#800000">$11</font><font color="#000080">;
  </font>r<font color="#000080">.</font>al<font color="#000080">:=</font><font color="#800000">$12</font><font color="#000080">; </font><font color="#008000"><i>{----8x8 Character set}
  </i></font>r<font color="#000080">.</font>bl<font color="#000080">:=</font><font color="#800000">$00</font><font color="#000080">;
  </font>Intr<font color="#000080">(</font><font color="#800000">$10</font><font color="#000080">,</font>r<font color="#000080">);
  </font>Mem<font color="#000080">[</font><font color="#800000">$40</font><font color="#000080">:</font><font color="#800000">$87</font><font color="#000080">]:=</font>b<font color="#000080">;

</font><font color="#008000"><i>{----350 scan lines neccesary}
  </i></font>r<font color="#000080">.</font>ah<font color="#000080">:=</font><font color="#800000">$12</font><font color="#000080">;
  </font>r<font color="#000080">.</font>al<font color="#000080">:=</font><font color="#800000">$01</font><font color="#000080">; </font><font color="#008000"><i>{----350}
  </i></font>r<font color="#000080">.</font>bl<font color="#000080">:=</font><font color="#800000">$30</font><font color="#000080">;
  </font>Intr<font color="#000080">(</font><font color="#800000">$10</font><font color="#000080">,</font>r<font color="#000080">);
</font><font color="#FF0000"><b>End</b></font><font color="#000080">; </font><font color="#008000"><i>{of Vga43lines}

{---------------------------------------------------------}

</i></font><font color="#FF0000"><b>Procedure </b></font>vga25lines<font color="#000080">;

</font><font color="#008000"><i>{----Put VGA display into 80x25 textmode}

</i></font><font color="#FF0000"><b>Var
  </b></font>r <font color="#000080">: </font>registers<font color="#000080">;
  </font>b <font color="#000080">: </font>Byte<font color="#000080">;

</font><font color="#FF0000"><b>Begin
</b></font><font color="#008000"><i>{----25 line mode}
  </i></font>b<font color="#000080">:=</font>Mem<font color="#000080">[</font><font color="#800000">$40</font><font color="#000080">:</font><font color="#800000">$87</font><font color="#000080">];
  </font>Mem<font color="#000080">[</font><font color="#800000">$40</font><font color="#000080">:</font><font color="#800000">$87</font><font color="#000080">]:=</font>Mem<font color="#000080">[</font><font color="#800000">$40</font><font color="#000080">:</font><font color="#800000">$87</font><font color="#000080">] </font><font color="#FF0000"><b>OR </b></font><font color="#800000">$01</font><font color="#000080">;
  </font>r<font color="#000080">.</font>ah<font color="#000080">:=</font><font color="#800000">$11</font><font color="#000080">;
  </font>r<font color="#000080">.</font>al<font color="#000080">:=</font><font color="#800000">$11</font><font color="#000080">; </font><font color="#008000"><i>{----8x14 Character set}
  </i></font>r<font color="#000080">.</font>bl<font color="#000080">:=</font><font color="#800000">$00</font><font color="#000080">;
  </font>Intr<font color="#000080">(</font><font color="#800000">$10</font><font color="#000080">,</font>r<font color="#000080">);
  </font>Mem<font color="#000080">[</font><font color="#800000">$40</font><font color="#000080">:</font><font color="#800000">$87</font><font color="#000080">]:=</font>b<font color="#000080">;

</font><font color="#008000"><i>{----400 scan lines neccesary}
  </i></font>r<font color="#000080">.</font>ah<font color="#000080">:=</font><font color="#800000">$12</font><font color="#000080">;
  </font>r<font color="#000080">.</font>al<font color="#000080">:=</font><font color="#800000">$02</font><font color="#000080">; </font><font color="#008000"><i>{----400}
  </i></font>r<font color="#000080">.</font>bl<font color="#000080">:=</font><font color="#800000">$30</font><font color="#000080">;
  </font>Intr<font color="#000080">(</font><font color="#800000">$10</font><font color="#000080">,</font>r<font color="#000080">);
</font><font color="#FF0000"><b>End</b></font><font color="#000080">; </font><font color="#008000"><i>{of Vga25lines}

</i></font><font color="#FF0000"><b>End</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to EGAVGA SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0060.PAS">Original</a><b>]</b></p></body>
</html>
