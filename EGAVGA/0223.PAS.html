<html>
<head><title> "100% Pascal Plasma" by STEVEN MCLEOD</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to EGAVGA SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0223.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
&gt; Howdy, I am looking for some Pascal (no ASM please :) plasma or fire
&gt; psudocode..

 well i guess this is better than psuedocode... it creates plasma.img in
 your current directory, so delete it for a new random pattern, also
 change the delay at the end to your liking. l8r! btw I must have posted
 this at least 4 times now to various people in the last two weeks!
}

{$I-}
</i></font><font color="#FF0000"><b>program </b></font>plasma<font color="#000080">;

  </font><font color="#FF0000"><b>uses
    </b></font>Crt<font color="#000080">,</font>Dos<font color="#000080">;

  </font><font color="#FF0000"><b>const
    </b></font>F <font color="#000080">= </font><font color="#800000">0.0000000000000000001</font><font color="#000080">; </font><font color="#008000"><i>{ the &quot;roughness&quot; of the image }

  </i></font><font color="#FF0000"><b>type
    </b></font>ColorValue <font color="#000080">= </font><font color="#FF0000"><b>record </b></font>Rvalue<font color="#000080">,</font>Gvalue<font color="#000080">,</font>Bvalue<font color="#000080">: </font>byte<font color="#000080">; </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font>PaletteType <font color="#000080">= </font><font color="#FF0000"><b>array </b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">255</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>ColorValue<font color="#000080">;

  </font><font color="#FF0000"><b>var
    </b></font>ch<font color="#000080">: </font>char<font color="#000080">;
    </font>i<font color="#000080">: </font>integer<font color="#000080">;
    </font>p<font color="#000080">: </font>PaletteType<font color="#000080">;
    </font>image<font color="#000080">: </font><font color="#FF0000"><b>file</b></font><font color="#000080">;
    </font>ok<font color="#000080">: </font>boolean<font color="#000080">;

  </font><font color="#FF0000"><b>procedure </b></font>SetVGApalette<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>tp<font color="#000080">: </font>PaletteType<font color="#000080">);
    </font><font color="#FF0000"><b>var </b></font>regs<font color="#000080">: </font>Registers<font color="#000080">;
  </font><font color="#FF0000"><b>begin </b></font><font color="#008000"><i>{ procedure SetVGApalette }
    </i></font><font color="#FF0000"><b>with </b></font>regs <font color="#FF0000"><b>do
      begin
        </b></font>AX<font color="#000080">:=</font><font color="#800000">$1012</font><font color="#000080">;
        </font>BX<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">; </font><font color="#008000"><i>{ first register to set }
        </i></font>CX<font color="#000080">:=</font><font color="#800000">256</font><font color="#000080">; </font><font color="#008000"><i>{ number of registers to set }
        </i></font>ES<font color="#000080">:=</font>Seg<font color="#000080">(</font>tp<font color="#000080">); </font>DX<font color="#000080">:=</font>Ofs<font color="#000080">(</font>tp<font color="#000080">);
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font>Intr<font color="#000080">(</font><font color="#800000">$10</font><font color="#000080">,</font>regs<font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{ procedure SetVGApalette }

  </i></font><font color="#FF0000"><b>procedure </b></font>PutPixel<font color="#000080">(</font>x<font color="#000080">,</font>y<font color="#000080">: </font>integer<font color="#000080">; </font>c<font color="#000080">: </font>byte<font color="#000080">);
  </font><font color="#FF0000"><b>begin </b></font><font color="#008000"><i>{ procedure PutPixel }
    </i></font>mem<font color="#000080">[</font><font color="#800000">$A000</font><font color="#000080">:</font>word<font color="#000080">(</font><font color="#800000">320</font><font color="#000080">*</font>y<font color="#000080">+</font>x<font color="#000080">)]:=</font>c<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{ procedure PutPixel }

  </i></font><font color="#FF0000"><b>function </b></font>GetPixel<font color="#000080">(</font>x<font color="#000080">,</font>y<font color="#000080">: </font>integer<font color="#000080">): </font>byte<font color="#000080">;
  </font><font color="#FF0000"><b>begin </b></font><font color="#008000"><i>{ function GetPixel }
    </i></font>GetPixel<font color="#000080">:=</font>mem<font color="#000080">[</font><font color="#800000">$A000</font><font color="#000080">:</font>word<font color="#000080">(</font><font color="#800000">320</font><font color="#000080">*</font>y<font color="#000080">+</font>x<font color="#000080">)];
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{ function GetPixel }

  </i></font><font color="#FF0000"><b>procedure </b></font>adjust<font color="#000080">(</font>xa<font color="#000080">,</font>ya<font color="#000080">,</font>x<font color="#000080">,</font>y<font color="#000080">,</font>xb<font color="#000080">,</font>yb<font color="#000080">: </font>integer<font color="#000080">);
    </font><font color="#FF0000"><b>var
      </b></font>d<font color="#000080">: </font>integer<font color="#000080">;
      </font>v<font color="#000080">: </font>real<font color="#000080">;
  </font><font color="#FF0000"><b>begin </b></font><font color="#008000"><i>{ procedure adjust }
    </i></font><font color="#FF0000"><b>if </b></font>GetPixel<font color="#000080">(</font>x<font color="#000080">,</font>y<font color="#000080">)&lt;&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>exit<font color="#000080">;
    </font>d<font color="#000080">:=</font>Abs<font color="#000080">(</font>xa<font color="#000080">-</font>xb<font color="#000080">)+</font>Abs<font color="#000080">(</font>ya<font color="#000080">-</font>yb<font color="#000080">);
    </font>v<font color="#000080">:=(</font>GetPixel<font color="#000080">(</font>xa<font color="#000080">,</font>ya<font color="#000080">)+</font>GetPixel<font color="#000080">(</font>xb<font color="#000080">,</font>yb<font color="#000080">))/</font><font color="#800000">2</font><font color="#000080">+(</font>random<font color="#000080">-</font><font color="#800000">0.5</font><font color="#000080">)*</font>d<font color="#000080">*</font>F<font color="#000080">;
    </font><font color="#FF0000"><b>if </b></font>v<font color="#000080">&lt;</font><font color="#800000">1 </font><font color="#FF0000"><b>then </b></font>v<font color="#000080">:=</font><font color="#800000">1</font><font color="#000080">;
    </font><font color="#FF0000"><b>if </b></font>v<font color="#000080">&gt;=</font><font color="#800000">193 </font><font color="#FF0000"><b>then </b></font>v<font color="#000080">:=</font><font color="#800000">192</font><font color="#000080">;
    </font>PutPixel<font color="#000080">(</font>x<font color="#000080">,</font>y<font color="#000080">,</font>Trunc<font color="#000080">(</font>v<font color="#000080">));
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{ procedure adjust }

  </i></font><font color="#FF0000"><b>procedure </b></font>subDivide<font color="#000080">(</font>x1<font color="#000080">,</font>y1<font color="#000080">,</font>x2<font color="#000080">,</font>y2<font color="#000080">: </font>integer<font color="#000080">);
    </font><font color="#FF0000"><b>var
      </b></font>x<font color="#000080">,</font>y<font color="#000080">: </font>integer<font color="#000080">;
      </font>v<font color="#000080">: </font>real<font color="#000080">;
  </font><font color="#FF0000"><b>begin </b></font><font color="#008000"><i>{ procedure subDivide }
    </i></font><font color="#FF0000"><b>if </b></font>KeyPressed <font color="#FF0000"><b>then </b></font>exit<font color="#000080">;
    </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>x2<font color="#000080">-</font>x1<font color="#000080">&lt;</font><font color="#800000">2</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>y2<font color="#000080">-</font>y1<font color="#000080">&lt;</font><font color="#800000">2</font><font color="#000080">) </font><font color="#FF0000"><b>then </b></font>exit<font color="#000080">;

    </font>x<font color="#000080">:=(</font>x1<font color="#000080">+</font>x2<font color="#000080">) </font><font color="#FF0000"><b>div </b></font><font color="#800000">2</font><font color="#000080">;
    </font>y<font color="#000080">:=(</font>y1<font color="#000080">+</font>y2<font color="#000080">) </font><font color="#FF0000"><b>div </b></font><font color="#800000">2</font><font color="#000080">;

    </font>adjust<font color="#000080">(</font>x1<font color="#000080">,</font>y1<font color="#000080">,</font>x<font color="#000080">,</font>y1<font color="#000080">,</font>x2<font color="#000080">,</font>y1<font color="#000080">);
    </font>adjust<font color="#000080">(</font>x2<font color="#000080">,</font>y1<font color="#000080">,</font>x2<font color="#000080">,</font>y<font color="#000080">,</font>x2<font color="#000080">,</font>y2<font color="#000080">);
    </font>adjust<font color="#000080">(</font>x1<font color="#000080">,</font>y2<font color="#000080">,</font>x<font color="#000080">,</font>y2<font color="#000080">,</font>x2<font color="#000080">,</font>y2<font color="#000080">);
    </font>adjust<font color="#000080">(</font>x1<font color="#000080">,</font>y1<font color="#000080">,</font>x1<font color="#000080">,</font>y<font color="#000080">,</font>x1<font color="#000080">,</font>y2<font color="#000080">);

    </font><font color="#FF0000"><b>if </b></font>GetPixel<font color="#000080">(</font>x<font color="#000080">,</font>y<font color="#000080">)=</font><font color="#800000">0 </font><font color="#FF0000"><b>then
      begin
        </b></font>v<font color="#000080">:=(</font>GetPixel<font color="#000080">(</font>x1<font color="#000080">,</font>y1<font color="#000080">)+</font>GetPixel<font color="#000080">(</font>x2<font color="#000080">,</font>y1<font color="#000080">)+</font>GetPixel<font color="#000080">(</font>x2<font color="#000080">,</font>y2<font color="#000080">)+</font>GetPixel<font color="#000080">(</font>x1<font color="#000080">,</font>y2<font color="#000080">))/</font><font color="#800000">4</font><font color="#000080">;
        </font>PutPixel<font color="#000080">(</font>x<font color="#000080">,</font>y<font color="#000080">,</font>Trunc<font color="#000080">(</font>v<font color="#000080">));
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

    </font>subDivide<font color="#000080">(</font>x1<font color="#000080">,</font>y1<font color="#000080">,</font>x<font color="#000080">,</font>y<font color="#000080">);
    </font>subDivide<font color="#000080">(</font>x<font color="#000080">,</font>y1<font color="#000080">,</font>x2<font color="#000080">,</font>y<font color="#000080">);
    </font>subDivide<font color="#000080">(</font>x<font color="#000080">,</font>y<font color="#000080">,</font>x2<font color="#000080">,</font>y2<font color="#000080">);
    </font>subDivide<font color="#000080">(</font>x1<font color="#000080">,</font>y<font color="#000080">,</font>x<font color="#000080">,</font>y2<font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{ procedure subDivide }

  </i></font><font color="#FF0000"><b>procedure </b></font>rotatePalette<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>p<font color="#000080">: </font>PaletteType<font color="#000080">; </font>n1<font color="#000080">,</font>n2<font color="#000080">,</font>d<font color="#000080">: </font>integer<font color="#000080">);
    </font><font color="#FF0000"><b>var
      </b></font>q<font color="#000080">: </font>PaletteType<font color="#000080">;
  </font><font color="#FF0000"><b>begin </b></font><font color="#008000"><i>{ procedure rotatePalette }
    </i></font>q<font color="#000080">:=</font>p<font color="#000080">;
    </font><font color="#FF0000"><b>for </b></font>i<font color="#000080">:=</font>n1 <font color="#FF0000"><b>to </b></font>n2 <font color="#FF0000"><b>do
      </b></font>p<font color="#000080">[</font>i<font color="#000080">]:=</font>q<font color="#000080">[</font>n1<font color="#000080">+(</font>i<font color="#000080">+</font>d<font color="#000080">) </font><font color="#FF0000"><b>mod </b></font><font color="#000080">(</font>n2<font color="#000080">-</font>n1<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">)];
    </font>SetVGApalette<font color="#000080">(</font>p<font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{ procedure rotatePalette }

</i></font><font color="#FF0000"><b>begin
  Inline</b></font><font color="#000080">(</font><font color="#800000">$B8</font><font color="#000080">/</font><font color="#800000">$13</font><font color="#000080">/</font><font color="#800000">0</font><font color="#000080">/</font><font color="#800000">$CD</font><font color="#000080">/</font><font color="#800000">$10</font><font color="#000080">); </font><font color="#008000"><i>{ select video mode 13h (320x200 with 256 colors)
}
  </i></font><font color="#FF0000"><b>with </b></font>p<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">] </font><font color="#FF0000"><b>do               </b></font><font color="#008000"><i>{ set background palette entry to grey }
    </i></font><font color="#FF0000"><b>begin
      </b></font>Rvalue<font color="#000080">:=</font><font color="#800000">32</font><font color="#000080">;
      </font>Gvalue<font color="#000080">:=</font><font color="#800000">32</font><font color="#000080">;
      </font>Bvalue<font color="#000080">:=</font><font color="#800000">32</font><font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>for </b></font>i<font color="#000080">:=</font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font><font color="#800000">63 </font><font color="#FF0000"><b>do </b></font><font color="#008000"><i>{ create the color wheel }
    </i></font><font color="#FF0000"><b>begin
      with </b></font>p<font color="#000080">[</font>i<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">] </font><font color="#FF0000"><b>do begin </b></font>Rvalue<font color="#000080">:=</font>i<font color="#000080">; </font>Gvalue<font color="#000080">:=</font><font color="#800000">63</font><font color="#000080">-</font>i<font color="#000080">; </font>Bvalue<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">; </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>with </b></font>p<font color="#000080">[</font>i<font color="#000080">+</font><font color="#800000">65</font><font color="#000080">] </font><font color="#FF0000"><b>do begin </b></font>Rvalue<font color="#000080">:=</font><font color="#800000">63</font><font color="#000080">-</font>i<font color="#000080">; </font>Gvalue<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">; </font>Bvalue<font color="#000080">:=</font>i<font color="#000080">; </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>with </b></font>p<font color="#000080">[</font>i<font color="#000080">+</font><font color="#800000">129</font><font color="#000080">] </font><font color="#FF0000"><b>do begin </b></font>Rvalue<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">; </font>Gvalue<font color="#000080">:=</font>i<font color="#000080">; </font>Bvalue<font color="#000080">:=</font><font color="#800000">63</font><font color="#000080">-</font>i<font color="#000080">; </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font>SetVGApalette<font color="#000080">(</font>p<font color="#000080">);

  </font>Assign<font color="#000080">(</font>image<font color="#000080">,</font><font color="#800000">'PLASMA.IMG'</font><font color="#000080">);
  </font>Reset<font color="#000080">(</font>image<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">);
  </font>ok<font color="#000080">:=(</font>ioResult<font color="#000080">=</font><font color="#800000">0</font><font color="#000080">);

  </font><font color="#FF0000"><b>if not </b></font>ok <font color="#FF0000"><b>or </b></font><font color="#000080">(</font>ParamCount<font color="#000080">&lt;&gt;</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>then </b></font><font color="#008000"><i>{ create a new image }
    </i></font><font color="#FF0000"><b>begin
      </b></font>Randomize<font color="#000080">;

      </font>PutPixel<font color="#000080">(</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">1</font><font color="#000080">+</font>Random<font color="#000080">(</font><font color="#800000">192</font><font color="#000080">));
      </font>PutPixel<font color="#000080">(</font><font color="#800000">319</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">1</font><font color="#000080">+</font>Random<font color="#000080">(</font><font color="#800000">192</font><font color="#000080">));
      </font>PutPixel<font color="#000080">(</font><font color="#800000">319</font><font color="#000080">,</font><font color="#800000">199</font><font color="#000080">,</font><font color="#800000">1</font><font color="#000080">+</font>Random<font color="#000080">(</font><font color="#800000">192</font><font color="#000080">));
      </font>PutPixel<font color="#000080">(</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">199</font><font color="#000080">,</font><font color="#800000">1</font><font color="#000080">+</font>Random<font color="#000080">(</font><font color="#800000">192</font><font color="#000080">));

      </font>subDivide<font color="#000080">(</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">319</font><font color="#000080">,</font><font color="#800000">199</font><font color="#000080">);

      </font>Rewrite<font color="#000080">(</font>image<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">);
      </font>BlockWrite<font color="#000080">(</font>image<font color="#000080">,</font>mem<font color="#000080">[</font><font color="#800000">$A000</font><font color="#000080">:</font><font color="#800000">0</font><font color="#000080">],</font><font color="#800000">$FA00</font><font color="#000080">);
    </font><font color="#FF0000"><b>end
  else </b></font><font color="#008000"><i>{ use the previous image }
    </i></font>BlockRead<font color="#000080">(</font>image<font color="#000080">,</font>mem<font color="#000080">[</font><font color="#800000">$A000</font><font color="#000080">:</font><font color="#800000">0</font><font color="#000080">],</font><font color="#800000">$FA00</font><font color="#000080">);

  </font>Close<font color="#000080">(</font>image<font color="#000080">);

  </font><font color="#FF0000"><b>repeat
    </b></font>rotatePalette<font color="#000080">(</font>p<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">192</font><font color="#000080">,+</font><font color="#800000">1</font><font color="#000080">);
  </font>delay<font color="#000080">(</font><font color="#800000">50</font><font color="#000080">);
  </font><font color="#FF0000"><b>until </b></font>KeyPressed<font color="#000080">;

  </font>ch<font color="#000080">:=</font>ReadKey<font color="#000080">; </font><font color="#FF0000"><b>if </b></font>ch<font color="#000080">=</font><font color="#800000">#0 </font><font color="#FF0000"><b>then </b></font>ch<font color="#000080">:=</font>ReadKey<font color="#000080">;

  </font>TextMode<font color="#000080">(</font>LastMode<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to EGAVGA SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0223.PAS">Original</a><b>]</b></p></body>
</html>
