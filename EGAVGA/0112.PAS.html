<html>
<head><title> "COPPER2.PAS" by DAVID DAHL TEXTMODE COPPE</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to EGAVGA SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0112.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#FF0000"><b>Program </b></font>CopperExampleNo2<font color="#000080">;
</font><font color="#008000"><i>{$G+} { Enable 286 Instructions }

{                                }
{       Copper Example #2        }
{    Programmed by David Dahl    }
{                                }
{ THIS EXAMPLE RUNS IN TEXT MODE }
{                                }
{     This is PUBLIC DOMAIN      }
{                                }


{ This Example Works FLAWLESSLY On My ET4000AX Based VGA Card.    }
{ On My Friend's Trident, However, The Three Sinus Bars Have Snow }
{ Covering Their Leftmost Sides For About An Inch.  This Is Due   }
{ To The Double VGA DAC Set Required To Display Both The Sinus    }
{ Bars And The Smooth Color Transitions Of The Large Text.        }

</i></font><font color="#FF0000"><b>Uses </b></font>CRT<font color="#000080">;

</font><font color="#FF0000"><b>Const </b></font>MaxRaster <font color="#000080">= </font><font color="#800000">399</font><font color="#000080">;

      </font>Status1   <font color="#000080">= </font><font color="#800000">$3DA</font><font color="#000080">;
      </font>DACWrite  <font color="#000080">= </font><font color="#800000">$3C8</font><font color="#000080">;
      </font>DACData   <font color="#000080">= </font><font color="#800000">$3C9</font><font color="#000080">;

</font><font color="#FF0000"><b>Type  </b></font>CopperRec   <font color="#000080">= </font><font color="#FF0000"><b>Record
                          </b></font>Color <font color="#000080">: </font>Byte<font color="#000080">;
                          </font>Red   <font color="#000080">: </font>Byte<font color="#000080">;
                          </font>Green <font color="#000080">: </font>Byte<font color="#000080">;
                          </font>Blue  <font color="#000080">: </font>Byte<font color="#000080">;
                    </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

      </font>CopperArray <font color="#000080">= </font><font color="#FF0000"><b>Array </b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font>MaxRaster<font color="#000080">] </font><font color="#FF0000"><b>of </b></font>CopperRec<font color="#000080">;

      </font>BarArray    <font color="#000080">= </font><font color="#FF0000"><b>Array </b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">19</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>CopperRec<font color="#000080">;

</font><font color="#FF0000"><b>Var   </b></font>CopperList <font color="#000080">: </font>CopperArray<font color="#000080">;

      </font>Bar        <font color="#000080">: </font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">2</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>BarArray<font color="#000080">;
      </font>BarPos     <font color="#000080">: </font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">2</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Integer<font color="#000080">;

      </font>SinTab     <font color="#000080">: </font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">255</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Integer<font color="#000080">;

</font><font color="#008000"><i>{-[ Build Sine Lookup Table ]----------------------------------------------}
</i></font><font color="#FF0000"><b>Procedure </b></font>MakeSinTab<font color="#000080">;
</font><font color="#FF0000"><b>Var </b></font>Counter <font color="#000080">: </font>Integer<font color="#000080">;
</font><font color="#FF0000"><b>Begin
     For </b></font>Counter <font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font><font color="#800000">255 </font><font color="#FF0000"><b>do
         </b></font>SinTab<font color="#000080">[</font>Counter<font color="#000080">] := </font><font color="#800000">115 </font><font color="#000080">+ </font>Round<font color="#000080">(</font><font color="#800000">90 </font><font color="#000080">* </font>Sin<font color="#000080">(</font>Counter <font color="#000080">* </font>PI <font color="#000080">/ </font><font color="#800000">128</font><font color="#000080">));
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;
</font><font color="#008000"><i>{-[ Build Colors For Sinus Bars ]------------------------------------------}
</i></font><font color="#FF0000"><b>Procedure </b></font>MakeBars<font color="#000080">;
</font><font color="#FF0000"><b>Var </b></font>Counter <font color="#000080">: </font>Integer<font color="#000080">;
</font><font color="#FF0000"><b>Begin
     </b></font><font color="#008000"><i>{ Clear Colors }
     </i></font>FillChar <font color="#000080">(</font>Bar<font color="#000080">, </font>SizeOf<font color="#000080">(</font>Bar<font color="#000080">), </font><font color="#800000">0</font><font color="#000080">);

     </font><font color="#FF0000"><b>For </b></font>Counter <font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font><font color="#800000">9 </font><font color="#FF0000"><b>do
     Begin
          </b></font>Bar<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">][</font>Counter<font color="#000080">].</font>Red   <font color="#000080">:= </font>Trunc<font color="#000080">(</font>Counter <font color="#000080">* (</font><font color="#800000">63 </font><font color="#000080">/ </font><font color="#800000">9</font><font color="#000080">));
          </font>Bar<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">][</font>Counter<font color="#000080">].</font>Green <font color="#000080">:= </font>Trunc<font color="#000080">(</font>Counter <font color="#000080">* (</font><font color="#800000">63 </font><font color="#000080">/ </font><font color="#800000">9</font><font color="#000080">));
          </font>Bar<font color="#000080">[</font><font color="#800000">2</font><font color="#000080">][</font>Counter<font color="#000080">].</font>Blue  <font color="#000080">:= </font>Trunc<font color="#000080">(</font>Counter <font color="#000080">* (</font><font color="#800000">63 </font><font color="#000080">/ </font><font color="#800000">9</font><font color="#000080">));
          </font><font color="#FF0000"><b>If </b></font>Odd<font color="#000080">(</font>Counter<font color="#000080">)
          </font><font color="#FF0000"><b>Then
          Begin
               </b></font>Bar<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">][</font>Counter<font color="#000080">].</font>Green <font color="#000080">:= </font>Trunc<font color="#000080">(</font>Counter <font color="#000080">* (</font><font color="#800000">63 </font><font color="#000080">/ </font><font color="#800000">9</font><font color="#000080">));
               </font>Bar<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">][</font>Counter<font color="#000080">].</font>Red   <font color="#000080">:= </font>Trunc<font color="#000080">(</font>Counter <font color="#000080">* (</font><font color="#800000">63 </font><font color="#000080">/ </font><font color="#800000">9</font><font color="#000080">));
               </font>Bar<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">][</font>Counter<font color="#000080">].</font>Blue  <font color="#000080">:= </font>Trunc<font color="#000080">(</font>Counter <font color="#000080">* (</font><font color="#800000">63 </font><font color="#000080">/ </font><font color="#800000">9</font><font color="#000080">));
               </font>Bar<font color="#000080">[</font><font color="#800000">2</font><font color="#000080">][</font>Counter<font color="#000080">].</font>Green <font color="#000080">:= </font>Trunc<font color="#000080">(</font>Counter <font color="#000080">* (</font><font color="#800000">63 </font><font color="#000080">/ </font><font color="#800000">9</font><font color="#000080">));
          </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
     </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
     </font><font color="#FF0000"><b>For </b></font>Counter <font color="#000080">:= </font><font color="#800000">10 </font><font color="#FF0000"><b>to </b></font><font color="#800000">19 </font><font color="#FF0000"><b>do
     Begin
          </b></font>Bar<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">][</font>Counter<font color="#000080">].</font>Red   <font color="#000080">:= </font>Trunc<font color="#000080">((</font><font color="#800000">19</font><font color="#000080">-</font>Counter<font color="#000080">) * (</font><font color="#800000">63 </font><font color="#000080">/ </font><font color="#800000">9</font><font color="#000080">));
          </font>Bar<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">][</font>Counter<font color="#000080">].</font>Green <font color="#000080">:= </font>Trunc<font color="#000080">((</font><font color="#800000">19</font><font color="#000080">-</font>Counter<font color="#000080">) * (</font><font color="#800000">63 </font><font color="#000080">/ </font><font color="#800000">9</font><font color="#000080">));
          </font>Bar<font color="#000080">[</font><font color="#800000">2</font><font color="#000080">][</font>Counter<font color="#000080">].</font>Blue  <font color="#000080">:= </font>Trunc<font color="#000080">((</font><font color="#800000">19</font><font color="#000080">-</font>Counter<font color="#000080">) * (</font><font color="#800000">63 </font><font color="#000080">/ </font><font color="#800000">9</font><font color="#000080">));
          </font><font color="#FF0000"><b>If </b></font>Odd<font color="#000080">(</font>Counter<font color="#000080">)
          </font><font color="#FF0000"><b>Then
          Begin
               </b></font>Bar<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">][</font>Counter<font color="#000080">].</font>Green <font color="#000080">:= </font>Trunc<font color="#000080">((</font><font color="#800000">19</font><font color="#000080">-</font>Counter<font color="#000080">) * (</font><font color="#800000">63 </font><font color="#000080">/ </font><font color="#800000">9</font><font color="#000080">));
               </font>Bar<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">][</font>Counter<font color="#000080">].</font>Red   <font color="#000080">:= </font>Trunc<font color="#000080">((</font><font color="#800000">19</font><font color="#000080">-</font>Counter<font color="#000080">) * (</font><font color="#800000">63 </font><font color="#000080">/ </font><font color="#800000">9</font><font color="#000080">));
               </font>Bar<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">][</font>Counter<font color="#000080">].</font>Blue  <font color="#000080">:= </font>Trunc<font color="#000080">((</font><font color="#800000">19</font><font color="#000080">-</font>Counter<font color="#000080">) * (</font><font color="#800000">63 </font><font color="#000080">/ </font><font color="#800000">9</font><font color="#000080">));
               </font>Bar<font color="#000080">[</font><font color="#800000">2</font><font color="#000080">][</font>Counter<font color="#000080">].</font>Green <font color="#000080">:= </font>Trunc<font color="#000080">((</font><font color="#800000">19</font><font color="#000080">-</font>Counter<font color="#000080">) * (</font><font color="#800000">63 </font><font color="#000080">/ </font><font color="#800000">9</font><font color="#000080">));
          </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
     </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;
</font><font color="#008000"><i>{-[ Make COPPER List ]-----------------------------------------------------}
</i></font><font color="#FF0000"><b>Procedure </b></font>MakeCopperList<font color="#000080">;
</font><font color="#FF0000"><b>Var </b></font>Counter1 <font color="#000080">: </font>Integer<font color="#000080">;
    </font>Counter2 <font color="#000080">: </font>Integer<font color="#000080">;
</font><font color="#FF0000"><b>Begin
     </b></font><font color="#008000"><i>{ Clear List }
     </i></font>FillChar <font color="#000080">(</font>CopperList<font color="#000080">, </font>SizeOf<font color="#000080">(</font>CopperList<font color="#000080">), </font><font color="#800000">0</font><font color="#000080">);

     </font><font color="#008000"><i>{ Make Transition From White To Yellow For }
     { Color 1 On Scanlines 10 Through 250      }
     </i></font><font color="#FF0000"><b>For </b></font>Counter1 <font color="#000080">:= </font><font color="#800000">10 </font><font color="#FF0000"><b>to </b></font><font color="#800000">250 </font><font color="#FF0000"><b>do
     With </b></font>CopperList<font color="#000080">[</font>Counter1<font color="#000080">] </font><font color="#FF0000"><b>do
     Begin
          </b></font>Color <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;
          </font>Red   <font color="#000080">:= </font><font color="#800000">63</font><font color="#000080">;
          </font>Green <font color="#000080">:= </font><font color="#800000">63</font><font color="#000080">;
          </font>Blue  <font color="#000080">:= </font>Round<font color="#000080">((</font><font color="#800000">250 </font><font color="#000080">- </font>Counter1<font color="#000080">) * (</font><font color="#800000">63 </font><font color="#000080">/ </font><font color="#800000">200</font><font color="#000080">));
     </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

     </font><font color="#008000"><i>{ Make Transition From Black To Dark Blue For }
     { Color 0 On Scanlines 254 Through 274        }
     </i></font><font color="#FF0000"><b>For </b></font>Counter1 <font color="#000080">:= </font><font color="#800000">254 </font><font color="#FF0000"><b>to </b></font><font color="#800000">254 </font><font color="#000080">+ </font><font color="#800000">20 </font><font color="#FF0000"><b>do
     With </b></font>CopperList<font color="#000080">[</font>Counter1<font color="#000080">] </font><font color="#FF0000"><b>do
     Begin
          </b></font>Color <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
          </font>Red   <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
          </font>Green <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
          </font>Blue  <font color="#000080">:= </font>Counter1 <font color="#000080">- </font><font color="#800000">254</font><font color="#000080">;
     </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
     </font><font color="#008000"><i>{ Make Dark Blue Background (Color 0) For   }
     { Scanlines 275 Through 287 Except Scanline }
     { 280 Which Is Yellow                       }
     </i></font><font color="#FF0000"><b>For </b></font>Counter1 <font color="#000080">:= </font><font color="#800000">275 </font><font color="#FF0000"><b>to </b></font><font color="#800000">287 </font><font color="#FF0000"><b>do
     With </b></font>CopperList<font color="#000080">[</font>Counter1<font color="#000080">] </font><font color="#FF0000"><b>do
     Begin
          </b></font>Color <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
          </font>Red   <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
          </font>Green <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
          </font><font color="#FF0000"><b>If </b></font>Counter1 <font color="#000080">= </font><font color="#800000">280
          </font><font color="#FF0000"><b>Then
          Begin
               </b></font>Red   <font color="#000080">:= </font><font color="#800000">45</font><font color="#000080">;
               </font>Green <font color="#000080">:= </font><font color="#800000">45</font><font color="#000080">;
          </font><font color="#FF0000"><b>End
          Else
              </b></font>Blue <font color="#000080">:= </font><font color="#800000">20</font><font color="#000080">;
     </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
     </font><font color="#008000"><i>{ Make Dark Blue Background (Color 0) For   }
     { Scanlines 336 Through 394 Except Scanline }
     { 343 Which Is Yellow                       }
     </i></font><font color="#FF0000"><b>For </b></font>Counter1 <font color="#000080">:= </font><font color="#800000">336 </font><font color="#FF0000"><b>to </b></font><font color="#800000">349 </font><font color="#FF0000"><b>do
     With </b></font>CopperList<font color="#000080">[</font>Counter1<font color="#000080">] </font><font color="#FF0000"><b>do
     Begin
          </b></font>Color <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
          </font>Red   <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
          </font>Green <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
          </font><font color="#FF0000"><b>If </b></font>Counter1 <font color="#000080">= </font><font color="#800000">343
          </font><font color="#FF0000"><b>Then
          Begin
               </b></font>Red   <font color="#000080">:= </font><font color="#800000">45</font><font color="#000080">;
               </font>Green <font color="#000080">:= </font><font color="#800000">45</font><font color="#000080">;
          </font><font color="#FF0000"><b>End
          Else
              </b></font>Blue <font color="#000080">:= </font><font color="#800000">20</font><font color="#000080">;
     </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
     </font><font color="#008000"><i>{ Make Transition From Dark Blue To Black }
     { For Background From Scanline 350 to 370 }
     </i></font><font color="#FF0000"><b>For </b></font>Counter1 <font color="#000080">:= </font><font color="#800000">350 </font><font color="#FF0000"><b>to </b></font><font color="#800000">350 </font><font color="#000080">+ </font><font color="#800000">20 </font><font color="#FF0000"><b>do
     With </b></font>CopperList<font color="#000080">[</font>Counter1<font color="#000080">] </font><font color="#FF0000"><b>do
     Begin
          </b></font>Color <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
          </font>Red   <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
          </font>Green <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
          </font>Blue  <font color="#000080">:= (</font><font color="#800000">350 </font><font color="#000080">+ </font><font color="#800000">20 </font><font color="#000080">- </font>Counter1<font color="#000080">);
     </font><font color="#FF0000"><b>End</b></font><font color="#000080">;

     </font><font color="#008000"><i>{ Color Text Lines 18, 19, and 20 For Text Color 1 }
     { As Red -&gt; Yellow (L18), Purple -&gt; White (L20)    }
     </i></font><font color="#FF0000"><b>For </b></font>Counter1  <font color="#000080">:= </font><font color="#800000">18 </font><font color="#FF0000"><b>to </b></font><font color="#800000">20 </font><font color="#FF0000"><b>do
       For </b></font>Counter2 <font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font><font color="#800000">15 </font><font color="#FF0000"><b>do
       With </b></font>CopperList<font color="#000080">[</font>Counter2 <font color="#000080">+ (</font>Counter1 <font color="#000080">* </font><font color="#800000">16</font><font color="#000080">)] </font><font color="#FF0000"><b>do
       Begin
            </b></font>Color <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;
            </font>Red   <font color="#000080">:= </font><font color="#800000">63</font><font color="#000080">;
            </font>Green <font color="#000080">:= </font>Trunc<font color="#000080">(</font>Counter2 <font color="#000080">* (</font><font color="#800000">63 </font><font color="#000080">/ </font><font color="#800000">15</font><font color="#000080">));
            </font>Blue  <font color="#000080">:= ((</font>Counter1 <font color="#000080">- </font><font color="#800000">18</font><font color="#000080">) * </font><font color="#800000">31</font><font color="#000080">) </font><font color="#FF0000"><b>AND </b></font><font color="#800000">63</font><font color="#000080">;
       </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;
</font><font color="#008000"><i>{-[ Center And Write A String As Solid Chars And Spaces ]------------------}
</i></font><font color="#FF0000"><b>Procedure </b></font>WSol <font color="#000080">(</font>StringIn <font color="#000080">: </font><font color="#FF0000"><b>String</b></font><font color="#000080">);
</font><font color="#FF0000"><b>Var </b></font>Counter <font color="#000080">: </font>Integer<font color="#000080">;
</font><font color="#FF0000"><b>Begin
     For </b></font>Counter <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font><font color="#000080">(</font><font color="#800000">40 </font><font color="#000080">- (</font>Length<font color="#000080">(</font>StringIn<font color="#000080">) </font><font color="#FF0000"><b>DIV </b></font><font color="#800000">2</font><font color="#000080">)) </font><font color="#FF0000"><b>do
         </b></font>Write<font color="#000080">(</font><font color="#800000">#32</font><font color="#000080">);

     </font><font color="#FF0000"><b>For </b></font>Counter <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>Length<font color="#000080">(</font>StringIn<font color="#000080">) </font><font color="#FF0000"><b>do
       If </b></font>StringIn<font color="#000080">[</font>Counter<font color="#000080">] &lt;&gt; </font><font color="#800000">#32
       </font><font color="#FF0000"><b>Then
           </b></font>Write <font color="#000080">(</font><font color="#800000">#219</font><font color="#000080">)
       </font><font color="#FF0000"><b>Else
           </b></font>Write <font color="#000080">(</font><font color="#800000">#32</font><font color="#000080">);

     </font>Writeln<font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;
</font><font color="#008000"><i>{-[ Put Text On Screen ]---------------------------------------------------}
</i></font><font color="#FF0000"><b>Procedure </b></font>SetUpScreen<font color="#000080">;
</font><font color="#FF0000"><b>Begin
     </b></font>ClrScr<font color="#000080">;

     </font>GotoXY <font color="#000080">(</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">5</font><font color="#000080">);
     </font>TextColor <font color="#000080">(</font><font color="#800000">1</font><font color="#000080">);
     </font>WSol<font color="#000080">(</font><font color="#800000">'  ####     ####    ######    ######    ########  ######  '</font><font color="#000080">);
     </font>WSol<font color="#000080">(</font><font color="#800000">' ##  ##   ##  ##   ##   ##   ##   ##   ##        ##   ## '</font><font color="#000080">);
     </font>WSol<font color="#000080">(</font><font color="#800000">'##       ##    ##  ##    ##  ##    ##  ##        ##    ##'</font><font color="#000080">);
     </font>WSol<font color="#000080">(</font><font color="#800000">'##       ##    ##  ##    ##  ##    ##  #####     ##    ##'</font><font color="#000080">);
     </font>WSol<font color="#000080">(</font><font color="#800000">'##       ##    ##  ##   ##   ##   ##   ##        ##   ## '</font><font color="#000080">);
     </font>WSol<font color="#000080">(</font><font color="#800000">'##       ##    ##  ######    ######    ##        ######  '</font><font color="#000080">);
     </font>WSol<font color="#000080">(</font><font color="#800000">' ##  ##   ##  ##   ##        ##        ##        ##   ## '</font><font color="#000080">);
     </font>WSol<font color="#000080">(</font><font color="#800000">'  ####     ####    ##        ##        ########  ##    ##'</font><font color="#000080">);
     </font>GotoXY<font color="#000080">(</font><font color="#800000">21</font><font color="#000080">, </font><font color="#800000">19</font><font color="#000080">);
     </font>Writeln<font color="#000080">(</font><font color="#800000">'Textmode COPPER Example #2 by David Dahl'</font><font color="#000080">);
     </font>GotoXY<font color="#000080">(</font><font color="#800000">27</font><font color="#000080">, </font><font color="#800000">21</font><font color="#000080">);
     </font>Writeln<font color="#000080">(</font><font color="#800000">'This Program is Public Domain'</font><font color="#000080">);
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;
</font><font color="#008000"><i>{-[ Update COPPER ]--------------------------------------------------------}
</i></font><font color="#FF0000"><b>Procedure </b></font>UpdateCopper<font color="#000080">;
</font><font color="#FF0000"><b>Var </b></font>Raster     <font color="#000080">: </font>Word<font color="#000080">;
    </font>DrawBar    <font color="#000080">: </font>Integer<font color="#000080">;
    </font>BarNum     <font color="#000080">: </font>Integer<font color="#000080">;
    </font>BarCounter <font color="#000080">: </font>Integer<font color="#000080">;
</font><font color="#FF0000"><b>Begin
     </b></font>Raster <font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;

     </font>DrawBar <font color="#000080">:= -</font><font color="#800000">1</font><font color="#000080">;
     </font>BarNum  <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;

     </font>Inc<font color="#000080">(</font>BarPos<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">],</font><font color="#800000">1</font><font color="#000080">);
     </font>Inc<font color="#000080">(</font>BarPos<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">],</font><font color="#800000">1</font><font color="#000080">);
     </font>Inc<font color="#000080">(</font>BarPos<font color="#000080">[</font><font color="#800000">2</font><font color="#000080">],</font><font color="#800000">1</font><font color="#000080">);

     </font><font color="#008000"><i>{ Sorry For All The Assembly Here, But Plain Vanilla Pascal  }
     { Just Isn't Fast Enough To Properly Display BOTH Sinus Bars }
     { And The Color Transitions For The Large Text.              }
     </i></font><font color="#FF0000"><b>ASM
        </b></font><font color="#FF00FF">PUSH DS
        MOV AX, SEG @Data
        MOV DS, AX
        CLI

        </font><font color="#008000"><i>{ Wait For End Of Vertical Retrace }
        </i></font><font color="#FF00FF">MOV DX, Status1
        @NotVert:
          IN  AL, DX
          AND AL, 8
        JNZ @NotVert
        @IsVert:
          IN  AL, DX
          AND AL, 8
        JZ @IsVert


        @DrawAllBarsLoop:
          </font><font color="#008000"><i>{--- Check For Bars ---}
          </i></font><font color="#FF00FF">MOV CX, 3
          @BarRasterCompare:

            </font><font color="#008000"><i>{ Calculate Location of Bar (Start Line Placed In AX) }
            </i></font><font color="#FF00FF">MOV BX, CX
            DEC BX
            SHL BX, 1
            MOV BX, word(BarPos[BX])
            AND BX, 255
            SHL BX, 1
            MOV AX, word(SinTab[BX])

            </font><font color="#008000"><i>{ Check If A Bar Is On Current Raster }
            </i></font><font color="#FF00FF">CMP AX, Raster
            JNS @BarNotDisplayed
            MOV BX, AX
            ADD AX, 20
            CMP Raster, AX
            JNS @BarNotDisplayed

            </font><font color="#008000"><i>{ Bar Is On Raster So Mark It }
            </i></font><font color="#FF00FF">SUB BX, Raster
            XOR AX, AX
            SUB AX, BX

            MOV word(DrawBar), AX
            MOV word(BarNum), CX
            DEC word(BarNum)

            @BarNotDisplayed:
            @DoneChecking:
          LOOP @BarRasterCompare

          </font><font color="#008000"><i>{--- Draw Bars ---}
          </i></font><font color="#FF00FF">MOV  BX, DrawBar
          OR   BX, BX
          JL   @NoDrawBar

          </font><font color="#008000"><i>{ Build Index To Bar Color Table }
          </i></font><font color="#FF00FF">SHL BX, 2

          MOV AX, word(BarNum)
          MOV CX, AX
          SHL AX, 6
          SHL CX, 4
          ADD AX, CX
          ADD BX, AX

          </font><font color="#008000"><i>{ Set Up Next Scan Line Color }
          </i></font><font color="#FF00FF">MOV DX, DACWRITE
          XOR AX, AX
          OUT DX, AL

          MOV DX, DACDATA
          INC BX
          MOV AL, Byte(Bar[BX])
          OUT DX, AL
          INC BX
          MOV AL, Byte(Bar[BX])
          OUT DX, AL

          </font><font color="#008000"><i>{ Wait For End of Horiz Retrace }
          </i></font><font color="#FF00FF">MOV DX, Status1
          @NotHoriz1:
            IN  AL, DX
            AND AL, 1
          JNZ @NotHoriz1
          @IsHoriz1:
            IN  AL, DX
            AND AL, 1
          JZ @IsHoriz1

          </font><font color="#008000"><i>{ Send Last Byte Of DAC Reg So Color Is Updated }
          </i></font><font color="#FF00FF">MOV DX, DACDATA
          INC BX
          MOV AL, byte(Bar[BX])
          OUT DX, AL

          </font><font color="#008000"><i>{ Update Color From Copper Table }
          </i></font><font color="#FF00FF">MOV DX, DACWRITE
          MOV BX, Raster
          SHL BX, 2
          MOV AL, Byte(CopperList[BX])
          OUT DX, AL

          MOV DX, DACDATA
          INC BX
          MOV AL, Byte(CopperList[BX])
          OUT DX, AL
          INC BX
          MOV AL, Byte(CopperList[BX])
          OUT DX, AL
          INC BX
          MOV AL, Byte(CopperList[BX])
          OUT DX, AL

          JMP @Done

          @NoDrawBar:
          </font><font color="#008000"><i>{ Update Color }
          </i></font><font color="#FF00FF">MOV DX, DACWRITE
          MOV BX, Raster
          SHL BX, 2
          MOV AL, Byte(CopperList[BX])
          OUT DX, AL

          MOV DX, DACDATA
          INC BX
          MOV AL, Byte(CopperList[BX])
          OUT DX, AL
          INC BX
          MOV AL, Byte(CopperList[BX])
          OUT DX, AL

          </font><font color="#008000"><i>{ Wait For End of Horiz Retrace }
          </i></font><font color="#FF00FF">MOV DX, Status1
          @NotHoriz2:
            IN  AL, DX
            AND AL, 1
          JNZ @NotHoriz2
          @IsHoriz2:
            IN  AL, DX
            AND AL, 1
          JZ @IsHoriz2

          </font><font color="#008000"><i>{ Update Last }
          </i></font><font color="#FF00FF">MOV DX, DACDATA
          INC BX
          MOV AL, Byte(CopperList[BX])
          OUT DX, AL

          @Done:

          INC Word(Raster)

       </font><font color="#008000"><i>{ If Raster &lt;= 250 Then Loop }
       </i></font><font color="#FF00FF">CMP Word(Raster), 250
       JLE @DrawAllBarsLoop

       </font><font color="#008000"><i>{--- Color Background And Text At Bottom of Screen ---}
       </i></font><font color="#FF00FF">@TextColorLoop:
          MOV DX, DACWRITE
          MOV BX, Raster
          SHL BX, 2
          MOV AL, Byte(CopperList[BX])
          OUT DX, AL

          MOV DX, DACDATA
          INC BX
          MOV AL, Byte(CopperList[BX])
          OUT DX, AL
          INC BX
          MOV AL, Byte(CopperList[BX])
          OUT DX, AL

          MOV DX, Status1
          @NotHoriz3:
            IN  AL, DX
            AND AL, 1
          JNZ @NotHoriz3
          @IsHoriz3:
            IN  AL, DX
            AND AL, 1
          JZ @IsHoriz3

          MOV DX, DACDATA
          INC BX
          MOV AL, Byte(CopperList[BX])
          OUT DX, AL

          INC Word(Raster)
       CMP Word(Raster), MaxRaster
       JLE @TextColorLoop
       STI
       POP DS
     </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;
</font><font color="#008000"><i>{=[ Main Program ]=========================================================}
</i></font><font color="#FF0000"><b>Var </b></font>Key <font color="#000080">: </font>Char<font color="#000080">;
</font><font color="#FF0000"><b>Begin
     </b></font>TextMode <font color="#000080">(</font>C80<font color="#000080">);
     </font>MakeSinTab<font color="#000080">;
     </font>MakeCopperList<font color="#000080">;
     </font>MakeBars<font color="#000080">;
     </font>SetUpScreen<font color="#000080">;
     </font>BarPos<font color="#000080">[</font><font color="#800000">0</font><font color="#000080">] := </font><font color="#800000">30</font><font color="#000080">;
     </font>BarPos<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">] := </font><font color="#800000">15</font><font color="#000080">;
     </font>BarPos<font color="#000080">[</font><font color="#800000">2</font><font color="#000080">] :=  </font><font color="#800000">0</font><font color="#000080">;
     </font><font color="#FF0000"><b>Repeat
           </b></font>UpdateCopper<font color="#000080">;
     </font><font color="#FF0000"><b>Until </b></font>Keypressed<font color="#000080">;
     </font><font color="#FF0000"><b>While </b></font>Keypressed <font color="#FF0000"><b>do
           </b></font>Key <font color="#000080">:= </font>ReadKey<font color="#000080">;
     </font>TextMode <font color="#000080">(</font>C80<font color="#000080">);
</font><font color="#FF0000"><b>End</b></font><font color="#000080">.

</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to EGAVGA SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0112.PAS">Original</a><b>]</b></p></body>
</html>
