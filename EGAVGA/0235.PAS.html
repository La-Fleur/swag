<html>
<head><title> "360x256x256 Graphics Mode" by KAI ROHRBACHER</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to EGAVGA SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0235.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
  If  you are ready to delve into pure VGA-register programming, you can
  realize  graphic  modes  up  to  400x600x256 pixels on any vanilla-VGA
  card;  watch  out  for  TWEAK*.*  for a cute tool to create such modes
  yourself easily.

  Here's  a  small example for a 360x256x256 mode, give it a try on your
  system:
}

{Purpose  : Demonstrate 360x256x256 graphics resolution              }
{Author   : Kai Rohrbacher, kai.rohrbacher@logo.ka.sub.org           }
{Language : TurboPascal 6.0   }
{Date     : 17.07.1994        }
{Remarks  : Register set generated with Robert Schmidt's TWEAK1.6beta}
{           adopted to Pascal by myself. No guarantees, use on your  }
{           own risk!}
{           If you directly want to play around with Bob's TWEAK,    }
{           here is the original register file:
begin 644 360x256b.256
MP@,`Y]0#`&amp;O4`P%9U`,&quot;6M0#`X[4`P1&gt;U`,%BM0#!B/4`P&gt;RU`,(`-0#&quot;6'4
M`Q`*U`,1K-0#$O_4`Q,MU`,4`-0#%0?4`Q8:U`,7X\0#`0'$`P0&amp;S@,%0,X#
*!@7``Q!!P`,3````
`
end
}

</i></font><font color="#FF0000"><b>USES </b></font>Dos<font color="#000080">;
</font><font color="#FF0000"><b>CONST </b></font>ATTRCON_ADDR <font color="#000080">= </font><font color="#800000">$3c0</font><font color="#000080">;
      </font>MISC_ADDR <font color="#000080">= </font><font color="#800000">$3c2</font><font color="#000080">;
      </font>VGAENABLE_ADDR <font color="#000080">= </font><font color="#800000">$3c3</font><font color="#000080">;
      </font>SEQ_ADDR <font color="#000080">= </font><font color="#800000">$3c4</font><font color="#000080">;
      </font>GRACON_ADDR <font color="#000080">= </font><font color="#800000">$3ce</font><font color="#000080">;
      </font>CRTC_ADDR <font color="#000080">= </font><font color="#800000">$3d4</font><font color="#000080">;
      </font>STATUS_ADDR <font color="#000080">= </font><font color="#800000">$3da</font><font color="#000080">;

</font><font color="#FF0000"><b>TYPE Register</b></font><font color="#000080">=</font><font color="#FF0000"><b>RECORD
      </b></font>prt<font color="#000080">:</font>WORD<font color="#000080">;
      </font>index<font color="#000080">:</font>BYTE<font color="#000080">;
      </font>value<font color="#000080">:</font>BYTE
     <font color="#FF0000"><b>END</b></font><font color="#000080">;
    </font>RegisterPtr<font color="#000080">=^</font><font color="#FF0000"><b>Register</b></font><font color="#000080">;
</font><font color="#FF0000"><b>CONST </b></font>Mode360x256<font color="#000080">: </font><font color="#FF0000"><b>ARRAY</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">24</font><font color="#000080">] </font><font color="#FF0000"><b>OF Register </b></font><font color="#000080">=
 (
  ( </font>prt<font color="#000080">:</font><font color="#800000">$3c2</font><font color="#000080">; </font>index<font color="#000080">:</font><font color="#800000">$0</font><font color="#000080">; </font>value<font color="#000080">:</font><font color="#800000">$e7</font><font color="#000080">),
  ( </font>prt<font color="#000080">:</font><font color="#800000">$3d4</font><font color="#000080">; </font>index<font color="#000080">:</font><font color="#800000">$0</font><font color="#000080">; </font>value<font color="#000080">:</font><font color="#800000">$6b</font><font color="#000080">),
  ( </font>prt<font color="#000080">:</font><font color="#800000">$3d4</font><font color="#000080">; </font>index<font color="#000080">:</font><font color="#800000">$1</font><font color="#000080">; </font>value<font color="#000080">:</font><font color="#800000">$59</font><font color="#000080">),
  ( </font>prt<font color="#000080">:</font><font color="#800000">$3d4</font><font color="#000080">; </font>index<font color="#000080">:</font><font color="#800000">$2</font><font color="#000080">; </font>value<font color="#000080">:</font><font color="#800000">$5a</font><font color="#000080">),
  ( </font>prt<font color="#000080">:</font><font color="#800000">$3d4</font><font color="#000080">; </font>index<font color="#000080">:</font><font color="#800000">$3</font><font color="#000080">; </font>value<font color="#000080">:</font><font color="#800000">$8e</font><font color="#000080">),
  ( </font>prt<font color="#000080">:</font><font color="#800000">$3d4</font><font color="#000080">; </font>index<font color="#000080">:</font><font color="#800000">$4</font><font color="#000080">; </font>value<font color="#000080">:</font><font color="#800000">$5e</font><font color="#000080">),
  ( </font>prt<font color="#000080">:</font><font color="#800000">$3d4</font><font color="#000080">; </font>index<font color="#000080">:</font><font color="#800000">$5</font><font color="#000080">; </font>value<font color="#000080">:</font><font color="#800000">$8a</font><font color="#000080">),
  ( </font>prt<font color="#000080">:</font><font color="#800000">$3d4</font><font color="#000080">; </font>index<font color="#000080">:</font><font color="#800000">$6</font><font color="#000080">; </font>value<font color="#000080">:</font><font color="#800000">$23</font><font color="#000080">),
  ( </font>prt<font color="#000080">:</font><font color="#800000">$3d4</font><font color="#000080">; </font>index<font color="#000080">:</font><font color="#800000">$7</font><font color="#000080">; </font>value<font color="#000080">:</font><font color="#800000">$b2</font><font color="#000080">),
  ( </font>prt<font color="#000080">:</font><font color="#800000">$3d4</font><font color="#000080">; </font>index<font color="#000080">:</font><font color="#800000">$8</font><font color="#000080">; </font>value<font color="#000080">:</font><font color="#800000">$0</font><font color="#000080">),
  ( </font>prt<font color="#000080">:</font><font color="#800000">$3d4</font><font color="#000080">; </font>index<font color="#000080">:</font><font color="#800000">$9</font><font color="#000080">; </font>value<font color="#000080">:</font><font color="#800000">$61</font><font color="#000080">),
  ( </font>prt<font color="#000080">:</font><font color="#800000">$3d4</font><font color="#000080">; </font>index<font color="#000080">:</font><font color="#800000">$10</font><font color="#000080">; </font>value<font color="#000080">:</font><font color="#800000">$a</font><font color="#000080">),
  ( </font>prt<font color="#000080">:</font><font color="#800000">$3d4</font><font color="#000080">; </font>index<font color="#000080">:</font><font color="#800000">$11</font><font color="#000080">; </font>value<font color="#000080">:</font><font color="#800000">$ac</font><font color="#000080">),
  ( </font>prt<font color="#000080">:</font><font color="#800000">$3d4</font><font color="#000080">; </font>index<font color="#000080">:</font><font color="#800000">$12</font><font color="#000080">; </font>value<font color="#000080">:</font><font color="#800000">$ff</font><font color="#000080">),
  ( </font>prt<font color="#000080">:</font><font color="#800000">$3d4</font><font color="#000080">; </font>index<font color="#000080">:</font><font color="#800000">$13</font><font color="#000080">; </font>value<font color="#000080">:</font><font color="#800000">$2d</font><font color="#000080">),
  ( </font>prt<font color="#000080">:</font><font color="#800000">$3d4</font><font color="#000080">; </font>index<font color="#000080">:</font><font color="#800000">$14</font><font color="#000080">; </font>value<font color="#000080">:</font><font color="#800000">$0</font><font color="#000080">),
  ( </font>prt<font color="#000080">:</font><font color="#800000">$3d4</font><font color="#000080">; </font>index<font color="#000080">:</font><font color="#800000">$15</font><font color="#000080">; </font>value<font color="#000080">:</font><font color="#800000">$7</font><font color="#000080">),
  ( </font>prt<font color="#000080">:</font><font color="#800000">$3d4</font><font color="#000080">; </font>index<font color="#000080">:</font><font color="#800000">$16</font><font color="#000080">; </font>value<font color="#000080">:</font><font color="#800000">$1a</font><font color="#000080">),
  ( </font>prt<font color="#000080">:</font><font color="#800000">$3d4</font><font color="#000080">; </font>index<font color="#000080">:</font><font color="#800000">$17</font><font color="#000080">; </font>value<font color="#000080">:</font><font color="#800000">$e3</font><font color="#000080">),
  ( </font>prt<font color="#000080">:</font><font color="#800000">$3c4</font><font color="#000080">; </font>index<font color="#000080">:</font><font color="#800000">$1</font><font color="#000080">; </font>value<font color="#000080">:</font><font color="#800000">$1</font><font color="#000080">),
  ( </font>prt<font color="#000080">:</font><font color="#800000">$3c4</font><font color="#000080">; </font>index<font color="#000080">:</font><font color="#800000">$4</font><font color="#000080">; </font>value<font color="#000080">:</font><font color="#800000">$6</font><font color="#000080">),
  ( </font>prt<font color="#000080">:</font><font color="#800000">$3ce</font><font color="#000080">; </font>index<font color="#000080">:</font><font color="#800000">$5</font><font color="#000080">; </font>value<font color="#000080">:</font><font color="#800000">$40</font><font color="#000080">),
  ( </font>prt<font color="#000080">:</font><font color="#800000">$3ce</font><font color="#000080">; </font>index<font color="#000080">:</font><font color="#800000">$6</font><font color="#000080">; </font>value<font color="#000080">:</font><font color="#800000">$5</font><font color="#000080">),
  ( </font>prt<font color="#000080">:</font><font color="#800000">$3c0</font><font color="#000080">; </font>index<font color="#000080">:</font><font color="#800000">$10</font><font color="#000080">; </font>value<font color="#000080">:</font><font color="#800000">$41</font><font color="#000080">),
  ( </font>prt<font color="#000080">:</font><font color="#800000">$3c0</font><font color="#000080">; </font>index<font color="#000080">:</font><font color="#800000">$13</font><font color="#000080">; </font>value<font color="#000080">:</font><font color="#800000">$0</font><font color="#000080">)
 );

</font><font color="#008000"><i>{
   readyVgaRegs() does the initialization to make the VGA ready to
  accept any combination of configuration register settings.

  This involves enabling writes to index 0 to 7 of the CRT controller
  (port $3d4), by clearing the most significant bit (bit 7) of index
  $11.
}

</i></font><font color="#FF0000"><b>PROCEDURE </b></font>readyVgaRegs<font color="#000080">;
</font><font color="#FF0000"><b>VAR </b></font>v<font color="#000080">:</font>INTEGER<font color="#000080">;
</font><font color="#FF0000"><b>BEGIN
  </b></font>port<font color="#000080">[</font><font color="#800000">$3d4</font><font color="#000080">]:=</font><font color="#800000">$11</font><font color="#000080">;
  </font>v<font color="#000080">:=</font>port<font color="#000080">[</font><font color="#800000">$3d5</font><font color="#000080">] </font><font color="#FF0000"><b>AND </b></font><font color="#800000">$7f</font><font color="#000080">;
  </font>port<font color="#000080">[</font><font color="#800000">$3d4</font><font color="#000080">]:=</font><font color="#800000">$11</font><font color="#000080">;
  </font>port<font color="#000080">[</font><font color="#800000">$3d5</font><font color="#000080">]:=</font>v<font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#008000"><i>{
  outReg sets a single register according to the contents of the
  passed Register structure.
}
</i></font><font color="#FF0000"><b>PROCEDURE </b></font>outReg<font color="#000080">(</font>r<font color="#000080">:</font><font color="#FF0000"><b>Register</b></font><font color="#000080">);
</font><font color="#FF0000"><b>VAR </b></font>dummy<font color="#000080">:</font>BYTE<font color="#000080">;
</font><font color="#FF0000"><b>BEGIN
 IF </b></font>r<font color="#000080">.</font>prt<font color="#000080">=</font>ATTRCON_ADDR
  <font color="#FF0000"><b>THEN BEGIN
        </b></font>dummy<font color="#000080">:=</font>port<font color="#000080">[</font>STATUS_ADDR<font color="#000080">];     </font><font color="#008000"><i>{ reset read/write flip-flop }
        </i></font>port<font color="#000080">[</font>ATTRCON_ADDR<font color="#000080">]:= </font>r<font color="#000080">.</font>index <font color="#FF0000"><b>OR </b></font><font color="#800000">$20</font><font color="#000080">; </font><font color="#008000"><i>{ ensure VGA output is enabled }
        </i></font>port<font color="#000080">[</font>ATTRCON_ADDR<font color="#000080">]:= </font>r<font color="#000080">.</font>value<font color="#000080">;
       </font><font color="#FF0000"><b>END
 ELSE IF </b></font><font color="#000080">(</font>r<font color="#000080">.</font>prt<font color="#000080">=</font>MISC_ADDR<font color="#000080">) </font><font color="#FF0000"><b>OR </b></font><font color="#000080">(</font>r<font color="#000080">.</font>prt<font color="#000080">=</font>VGAENABLE_ADDR<font color="#000080">)
  </font><font color="#FF0000"><b>THEN </b></font>port<font color="#000080">[</font>r<font color="#000080">.</font>prt<font color="#000080">]:=</font>r<font color="#000080">.</font>value   <font color="#008000"><i>{  directly to the port }
 </i></font><font color="#FF0000"><b>ELSE BEGIN
       </b></font>port<font color="#000080">[</font>r<font color="#000080">.</font>prt<font color="#000080">]:=</font>r<font color="#000080">.</font>index<font color="#000080">;  </font><font color="#008000"><i>{  index to port        }
       </i></font>port<font color="#000080">[</font>r<font color="#000080">.</font>prt<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">]:=</font>r<font color="#000080">.</font>value<font color="#000080">;</font><font color="#008000"><i>{  value to port+1        }
      </i></font><font color="#FF0000"><b>END</b></font><font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#008000"><i>{
  outRegArray sets n registers according to the array pointed to by r.
  First, indexes 0-7 of the CRT controller are enabled for writing.
}
</i></font><font color="#FF0000"><b>PROCEDURE </b></font>outRegArray<font color="#000080">(</font>r<font color="#000080">:</font>RegisterPtr<font color="#000080">; </font>n<font color="#000080">:</font>INTEGER<font color="#000080">);
</font><font color="#FF0000"><b>BEGIN
 </b></font>readyVgaRegs<font color="#000080">;
 </font><font color="#FF0000"><b>WHILE </b></font>n<font color="#000080">&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>DO
  BEGIN
   </b></font>DEC<font color="#000080">(</font>n<font color="#000080">);
   </font>outReg<font color="#000080">(</font>r<font color="#000080">^);
   </font><font color="#FF0000"><b>ASM
    </b></font><font color="#FF00FF">LES DI,r
    ADD DI,TYPE Register
    MOV WORD PTR [r],DI
   </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
</font><font color="#FF0000"><b>END</b></font><font color="#000080">;



</font><font color="#FF0000"><b>VAR </b></font>y<font color="#000080">,</font>lastMode<font color="#000080">:</font>INTEGER<font color="#000080">;
    </font>regs<font color="#000080">:</font>REGISTERS<font color="#000080">;
</font><font color="#FF0000"><b>BEGIN
 </b></font><font color="#008000"><i>{Save old BIOS mode}
 </i></font>regs<font color="#000080">.</font>AH <font color="#000080">:= </font><font color="#800000">$0f</font><font color="#000080">; </font>INTR<font color="#000080">(</font><font color="#800000">$10</font><font color="#000080">,</font>regs<font color="#000080">); </font>lastMode <font color="#000080">:= </font>regs<font color="#000080">.</font>AL<font color="#000080">;

 </font><font color="#008000"><i>{Set mode 13h to make sure the EGA palette set is correct for a }
 {256color mode}
 </i></font>regs<font color="#000080">.</font>AX <font color="#000080">:= </font><font color="#800000">$13</font><font color="#000080">; </font>INTR<font color="#000080">(</font><font color="#800000">$10</font><font color="#000080">,</font>regs<font color="#000080">);

  </font><font color="#008000"><i>{ Note that no initialization is neccessary now.  The Register array
      is linked in as global data, and is directly accessible.  Take
      note of the way the number of Register elements in the array is
     calculated: }

 </i></font>outRegArray<font color="#000080">(@</font>Mode360x256<font color="#000080">, </font>sizeof<font color="#000080">(</font>Mode360x256<font color="#000080">) </font><font color="#FF0000"><b>DIV </b></font>sizeof<font color="#000080">(</font><font color="#FF0000"><b>Register</b></font><font color="#000080">));
 </font>portw<font color="#000080">[</font><font color="#800000">$3c4</font><font color="#000080">]:=</font><font color="#800000">$0f02</font><font color="#000080">; </font><font color="#008000"><i>{ Enable all 4 planes }

  { Fill the screen with a blend of red and blue lines, defining the
     palette on the fly. }

  </i></font>port<font color="#000080">[</font><font color="#800000">$3c8</font><font color="#000080">]:=</font><font color="#800000">0</font><font color="#000080">;         </font><font color="#008000"><i>{ start with color 0 }
  </i></font><font color="#FF0000"><b>FOR </b></font>y<font color="#000080">:=</font><font color="#800000">0 </font><font color="#FF0000"><b>TO </b></font><font color="#800000">255 </font><font color="#FF0000"><b>DO
   BEGIN
    </b></font>port<font color="#000080">[</font><font color="#800000">$3c9</font><font color="#000080">]:= </font>y <font color="#FF0000"><b>SHR </b></font><font color="#800000">2</font><font color="#000080">;        </font><font color="#008000"><i>{ red component }
    </i></font>port<font color="#000080">[</font><font color="#800000">$3c9</font><font color="#000080">]:= </font><font color="#800000">0</font><font color="#000080">;              </font><font color="#008000"><i>{ green component }
    </i></font>port<font color="#000080">[</font><font color="#800000">$3c9</font><font color="#000080">]:= (</font><font color="#800000">256</font><font color="#000080">-</font>y<font color="#000080">) </font><font color="#FF0000"><b>SHR </b></font><font color="#800000">2</font><font color="#000080">;  </font><font color="#008000"><i>{ blue component }
    </i></font>FillChar<font color="#000080">(</font>Mem<font color="#000080">[</font>SegA000<font color="#000080">:</font>y<font color="#000080">*</font><font color="#800000">90</font><font color="#000080">],</font><font color="#800000">90</font><font color="#000080">,</font>y<font color="#000080">);
   </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

 </font>y<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
 </font><font color="#FF0000"><b>WHILE </b></font>y<font color="#000080">&lt;</font><font color="#800000">256 </font><font color="#FF0000"><b>DO
  BEGIN
   </b></font>MEM<font color="#000080">[</font>SegA000<font color="#000080">:</font>y<font color="#000080">*</font><font color="#800000">90</font><font color="#000080">]:=</font><font color="#800000">255</font><font color="#000080">;
   </font>inc<font color="#000080">(</font>y<font color="#000080">,</font><font color="#800000">8</font><font color="#000080">)
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;
  </font>readln<font color="#000080">;

  </font><font color="#008000"><i>{ The picture is drawn, so wait for user to get tired of it. }

  { Restore the saved mode number.  Borland's textmode() won't work, as the
      C library still thinks we're in the mode it detected at startup.
     The palette will be set to the BIOS mode's default. }

  </i></font>regs<font color="#000080">.</font>AX <font color="#000080">:= </font>lastMode<font color="#000080">; </font>INTR<font color="#000080">(</font><font color="#800000">$10</font><font color="#000080">,</font>regs<font color="#000080">);

</font><font color="#FF0000"><b>END</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to EGAVGA SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0235.PAS">Original</a><b>]</b></p></body>
</html>
