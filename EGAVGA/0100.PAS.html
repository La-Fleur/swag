<html>
<head><title> "Fade and Palette Routines" by WOLFGANG FRINK</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to EGAVGA SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0100.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code>
<font color="#008000"><i>{$M 16384,0,255360}
</i></font><font color="#FF0000"><b>uses </b></font>Dos<font color="#000080">,</font>crt<font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>waitretrace<font color="#000080">;</font><font color="#FF0000"><b>assembler</b></font><font color="#000080">; </font><font color="#008000"><i>{wait for next vertical retrace}
</i></font><font color="#FF0000"><b>asm
  </b></font><font color="#FF00FF">mov dx,$3DA
  @V1: in al,dx; test al,8; jz @v1;
  @V2: in al,dx; test al,8; jnz @v2;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>type
  </b></font>rgb <font color="#000080">= </font><font color="#FF0000"><b>record </b></font>r<font color="#000080">, </font>g<font color="#000080">, </font>b <font color="#000080">: </font>byte<font color="#000080">; </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>paltype <font color="#000080">= </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">255</font><font color="#000080">]</font><font color="#FF0000"><b>of </b></font>rgb<font color="#000080">;
</font><font color="#FF0000"><b>var
  </b></font>i <font color="#000080">: </font>integer<font color="#000080">;
  </font>pal <font color="#000080">: </font>paltype<font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>get_color<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>pal <font color="#000080">: </font>paltype<font color="#000080">); </font><font color="#008000"><i>{save palette}
</i></font><font color="#FF0000"><b>var
  </b></font>i <font color="#000080">: </font>integer<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>port<font color="#000080">[</font><font color="#800000">$3C7</font><font color="#000080">] := </font><font color="#800000">$00</font><font color="#000080">;
  </font><font color="#FF0000"><b>for </b></font>i<font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font><font color="#800000">255 </font><font color="#FF0000"><b>do begin
    </b></font>pal<font color="#000080">[</font>i<font color="#000080">].</font>r <font color="#000080">:= </font>port<font color="#000080">[</font><font color="#800000">$3C9</font><font color="#000080">];
    </font>pal<font color="#000080">[</font>i<font color="#000080">].</font>g <font color="#000080">:= </font>port<font color="#000080">[</font><font color="#800000">$3C9</font><font color="#000080">];
    </font>pal<font color="#000080">[</font>i<font color="#000080">].</font>b <font color="#000080">:= </font>port<font color="#000080">[</font><font color="#800000">$3C9</font><font color="#000080">];
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>set_intensity<font color="#000080">(</font>intensity <font color="#000080">: </font>byte<font color="#000080">);
</font><font color="#FF0000"><b>var
  </b></font>i <font color="#000080">: </font>integer<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>port<font color="#000080">[</font><font color="#800000">$3C8</font><font color="#000080">] := </font><font color="#800000">$00</font><font color="#000080">;
  </font><font color="#FF0000"><b>for </b></font>i <font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font><font color="#800000">255 </font><font color="#FF0000"><b>do begin
    </b></font>port<font color="#000080">[</font><font color="#800000">$3C9</font><font color="#000080">] := </font>pal<font color="#000080">[</font>i<font color="#000080">].</font>r<font color="#000080">*</font>intensity <font color="#FF0000"><b>div </b></font><font color="#800000">63</font><font color="#000080">;
    </font>port<font color="#000080">[</font><font color="#800000">$3C9</font><font color="#000080">] := </font>pal<font color="#000080">[</font>i<font color="#000080">].</font>g<font color="#000080">*</font>intensity <font color="#FF0000"><b>div </b></font><font color="#800000">63</font><font color="#000080">;
    </font>port<font color="#000080">[</font><font color="#800000">$3C9</font><font color="#000080">] := </font>pal<font color="#000080">[</font>i<font color="#000080">].</font>b<font color="#000080">*</font>intensity <font color="#FF0000"><b>div </b></font><font color="#800000">63</font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>set_to_color<font color="#000080">(</font>r<font color="#000080">,</font>g<font color="#000080">,</font>b<font color="#000080">,</font>h<font color="#000080">: </font>integer<font color="#000080">);
</font><font color="#FF0000"><b>var
  </b></font>i <font color="#000080">: </font>integer<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>port<font color="#000080">[</font><font color="#800000">$3C8</font><font color="#000080">] := </font><font color="#800000">$00</font><font color="#000080">;
  </font><font color="#FF0000"><b>for </b></font>i <font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font><font color="#800000">255 </font><font color="#FF0000"><b>do begin
    </b></font>port<font color="#000080">[</font><font color="#800000">$3C9</font><font color="#000080">] := </font>pal<font color="#000080">[</font>i<font color="#000080">].</font>r<font color="#000080">+(</font>r<font color="#000080">-</font>pal<font color="#000080">[</font>i<font color="#000080">].</font>r<font color="#000080">)*</font>h <font color="#FF0000"><b>div </b></font><font color="#800000">63</font><font color="#000080">;
    </font>port<font color="#000080">[</font><font color="#800000">$3C9</font><font color="#000080">] := </font>pal<font color="#000080">[</font>i<font color="#000080">].</font>g<font color="#000080">+(</font>g<font color="#000080">-</font>pal<font color="#000080">[</font>i<font color="#000080">].</font>g<font color="#000080">)*</font>h <font color="#FF0000"><b>div </b></font><font color="#800000">63</font><font color="#000080">;
    </font>port<font color="#000080">[</font><font color="#800000">$3C9</font><font color="#000080">] := </font>pal<font color="#000080">[</font>i<font color="#000080">].</font>b<font color="#000080">+(</font>b<font color="#000080">-</font>pal<font color="#000080">[</font>i<font color="#000080">].</font>b<font color="#000080">)*</font>h <font color="#FF0000"><b>div </b></font><font color="#800000">63</font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>fade_out<font color="#000080">(</font>t <font color="#000080">: </font>integer<font color="#000080">); </font><font color="#008000"><i>{fades from pal to black}
</i></font><font color="#FF0000"><b>begin
  for </b></font>i <font color="#000080">:= </font><font color="#800000">63 </font><font color="#FF0000"><b>downto </b></font><font color="#800000">0 </font><font color="#FF0000"><b>do begin </b></font>waitretrace<font color="#000080">; </font>set_intensity<font color="#000080">(</font>i<font color="#000080">); </font>delay<font color="#000080">(</font>t<font color="#000080">); </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>fade_in<font color="#000080">(</font>t <font color="#000080">: </font>integer<font color="#000080">);  </font><font color="#008000"><i>{fades from black to pal}
</i></font><font color="#FF0000"><b>begin
  for </b></font>i <font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font><font color="#800000">63 </font><font color="#FF0000"><b>do begin </b></font>waitretrace<font color="#000080">; </font>set_intensity<font color="#000080">(</font>i<font color="#000080">); </font>delay<font color="#000080">(</font>t<font color="#000080">); </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>flash_in<font color="#000080">(</font>r<font color="#000080">,</font>b<font color="#000080">,</font>g<font color="#000080">: </font>byte<font color="#000080">;</font>t <font color="#000080">: </font>integer<font color="#000080">); </font><font color="#008000"><i>{fades from pal to color}
</i></font><font color="#FF0000"><b>begin
  for </b></font>i <font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font><font color="#800000">63 </font><font color="#FF0000"><b>do begin </b></font>waitretrace<font color="#000080">; </font>set_to_color<font color="#000080">(</font>r<font color="#000080">,</font>b<font color="#000080">,</font>g<font color="#000080">,</font>i<font color="#000080">); </font>delay<font color="#000080">(</font>t<font color="#000080">); </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>flash_out<font color="#000080">(</font>r<font color="#000080">,</font>g<font color="#000080">,</font>b<font color="#000080">: </font>byte<font color="#000080">;</font>t <font color="#000080">: </font>integer<font color="#000080">); </font><font color="#008000"><i>{fades from color to pal}
</i></font><font color="#FF0000"><b>begin
  for </b></font>i <font color="#000080">:= </font><font color="#800000">63 </font><font color="#FF0000"><b>downto </b></font><font color="#800000">0 </font><font color="#FF0000"><b>do begin </b></font>waitretrace<font color="#000080">;</font>set_to_color<font color="#000080">(</font>r<font color="#000080">,</font>g<font color="#000080">,</font>b<font color="#000080">,</font>i<font color="#000080">);</font>delay<font color="#000080">(</font>t<font color="#000080">);</font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>BEGIN

  </b></font><font color="#008000"><i>{ Put some stuff on the screen }
  </i></font>SwapVectors<font color="#000080">;
  </font>Exec<font color="#000080">(</font>GetEnv<font color="#000080">(</font><font color="#800000">'COMSPEC'</font><font color="#000080">),</font><font color="#800000">' /c dir \ /w'</font><font color="#000080">);
  </font>SwapVectors<font color="#000080">;
  </font>Get_Color<font color="#000080">(</font>pal<font color="#000080">);
  </font>fade_out<font color="#000080">(</font><font color="#800000">50</font><font color="#000080">);
  </font>fade_in<font color="#000080">(</font><font color="#800000">50</font><font color="#000080">);
  </font>Flash_Out<font color="#000080">(</font><font color="#800000">100</font><font color="#000080">,</font><font color="#800000">16</font><font color="#000080">,</font><font color="#800000">32</font><font color="#000080">,</font><font color="#800000">50</font><font color="#000080">);
  </font>Flash_In <font color="#000080">(</font><font color="#800000">100</font><font color="#000080">,</font><font color="#800000">16</font><font color="#000080">,</font><font color="#800000">32</font><font color="#000080">,</font><font color="#800000">50</font><font color="#000080">);
  </font><font color="#FF0000"><b>ASM
  </b></font><font color="#FF00FF">MOV AX,00003h   </font><font color="#008000"><i>{reset to textmode}
  </i></font><font color="#FF00FF">INT 010h
  </font><font color="#FF0000"><b>END</b></font><font color="#000080">;

</font><font color="#FF0000"><b>END</b></font><font color="#000080">.</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to EGAVGA SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0100.PAS">Original</a><b>]</b></p></body>
</html>
