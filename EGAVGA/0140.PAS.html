<html>
<head><title> "BGI BMP Files" by RANDALL ELTON DING</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to EGAVGA SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0140.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
  Subj: using brute force to load
From: randyd@alpha2.csd.uwm.edu (Randall Elton Ding)

Some have been asking how to load bmp's and such from a file into
the bgi..  Here is a brute force method for doing that in 16 color
EGAVGA or HercMono modes.

There are two programs after this discussion, the first is the bmp
utility and the second is a program that generates a bmp test pattern
with the 16 standard colors used by the bmpgetimage example.

First - if you look at this program, then look in the manual, you will
find that the manual is dead wrong about the setpalette procedure.

          Declaration:
          procedure SetPalette(ColorNum: Word; Color: Shortint);

          Changes the ColorNum entry in the palette to Color.
wrong --&gt; SetPalette(0, LightCyan) makes the first color in the
          palette light cyan. ColorNum can range from 0 to 15......

LightCyan is a constant and is equil to 11 but should be 59, see below.
The color param used by setpalette proc is RGB defined in this way...

    bits: 0 = high intensity blue
          1 = high intensity green
          2 = high intensity red
          3 = low intensity blue
          4 = low intensity green
          5 = low intensity red
          6 = 0
          7 = 0

The bmpgetimage procedure below reads the 64 byte pallet from the bmp
and uses the 2 most sig bits from each BB GG RR 00 entry.
This conversion is not the greatest but this is a brute force method.


-------------- begin 1 of 2 programs ---------------
}
</i></font><font color="#FF0000"><b>program </b></font>bmp2bgi<font color="#000080">;

</font><font color="#FF0000"><b>uses </b></font>graph<font color="#000080">;

</font><font color="#FF0000"><b>type
  </b></font>string80 <font color="#000080">= </font><font color="#FF0000"><b>string</b></font><font color="#000080">[</font><font color="#800000">80</font><font color="#000080">];

</font><font color="#008000"><i>{ for vga putimage data, each line is repeated 4 times (4 bit planes) }
{ one for each color bit (16 color egavga) }
{ for hercmono, there is only 1 bit plane }
{ the word following the end of the last line
{ must be 00 00 in hercmono to tell BGI that there is only 1 bit plane }
{ for VGA the last word is 0F 00 ($000F) for 16 colors (4 bit planes) }

{ ! must be in graphics mode to call this procedure }
{ does getimage like function on either 2 color or 4 color bmp file }
{ use dw=0 dh=0 to get bmp image from dx,dy to extreme edge }
{ this procedure will load a 2 color bmp as a B&amp;W image into a 16 color
{ 4 bit plan putimage structure provided that the current video mode is }
{ egavga, but will not load a 16 color bmp into a single bit plane }
{ when the current video mode is hercmono }
{ no memory will be allocated if an error occurs (error when errs &lt;&gt; '') }

</i></font><font color="#FF0000"><b>procedure </b></font>bmpgetimage
        <font color="#000080">(     </font>fn          <font color="#000080">: </font>string80<font color="#000080">;    </font><font color="#008000"><i>{ bmp file name }
          </i></font><font color="#FF0000"><b>var </b></font>datapointer <font color="#000080">: </font>pointer<font color="#000080">;     </font><font color="#008000"><i>{ ^ to putimage data }
              </i></font>dx<font color="#000080">,</font>dy<font color="#000080">,</font>dw<font color="#000080">,</font>dh <font color="#000080">: </font>word<font color="#000080">;        </font><font color="#008000"><i>{ offset into bmp &amp; requested size }
          </i></font><font color="#FF0000"><b>var </b></font>errs        <font color="#000080">: </font>string80<font color="#000080">;    </font><font color="#008000"><i>{ error string, '' if none }
          </i></font><font color="#FF0000"><b>var </b></font>palette     <font color="#000080">: </font>palettetype<font color="#000080">; </font><font color="#008000"><i>{ returns converted EGA palette }
          </i></font><font color="#FF0000"><b>var </b></font>size        <font color="#000080">: </font>word<font color="#000080">);       </font><font color="#008000"><i>{ returns memory taken by image }
                                         { for caller to release the memory }
                                         { with freemem(datapointer,size); }
  </i></font><font color="#FF0000"><b>type
    </b></font>bmpheadtype <font color="#000080">= </font><font color="#FF0000"><b>record

             </b></font><font color="#008000"><i>{ bit map file header }
             </i></font>bftype<font color="#000080">: </font>word<font color="#000080">;                   </font><font color="#008000"><i>{ &quot;BM&quot; or $4D42 }
             </i></font>bfsize<font color="#000080">: </font>longint<font color="#000080">;                </font><font color="#008000"><i>{ size of file in bytes }
             </i></font>bfreserved1<font color="#000080">: </font>word<font color="#000080">;
             </font>bfreserved2<font color="#000080">: </font>word<font color="#000080">;
             </font>bfoffbits<font color="#000080">: </font>longint<font color="#000080">;             </font><font color="#008000"><i>{ ^ where graphic data begins }

             { bit map information header }
             </i></font>bisize<font color="#000080">: </font>longint<font color="#000080">;                </font><font color="#008000"><i>{ length of this header, $28 }
             </i></font>biwidth<font color="#000080">: </font>longint<font color="#000080">;               </font><font color="#008000"><i>{ pixel width }
             </i></font>biheight<font color="#000080">: </font>longint<font color="#000080">;              </font><font color="#008000"><i>{ pixel height }
             </i></font>biplanes<font color="#000080">: </font>word<font color="#000080">;                 </font><font color="#008000"><i>{ = 1 }
             </i></font>bibitcount<font color="#000080">: </font>word<font color="#000080">;               </font><font color="#008000"><i>{ color bits per pixel }
             </i></font>bicompression<font color="#000080">: </font>longint<font color="#000080">;         </font><font color="#008000"><i>{ = 0 for no compression }
             </i></font>bisizeimage<font color="#000080">: </font>longint<font color="#000080">;           </font><font color="#008000"><i>{ = bfsize - bfoffbits }
             </i></font>bixpelspermeter<font color="#000080">: </font>longint<font color="#000080">;       </font><font color="#008000"><i>{ x pixels per meter }
             </i></font>biypelspermeter<font color="#000080">: </font>longint<font color="#000080">;       </font><font color="#008000"><i>{ y pixels per meter }
             </i></font>biclrused<font color="#000080">: </font>longint<font color="#000080">;             </font><font color="#008000"><i>{ \ I have never seen these }
             </i></font>biclrimportant<font color="#000080">: </font>longint<font color="#000080">;        </font><font color="#008000"><i>{ / two used for anything }
           </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;
           </font><font color="#008000"><i>{ A note on windows BMP files.. }
           { At this point in the bmp file, there is allocated }
           { 1 longint for each color, RGB pallet data BB GG RR 00. }
           { For greyscale viewing on color monitor, BB=GG=RR=shade }
           { Number colors = 2^bibitcount, then pixel data follows. }
           { For 16 colors, there are 64 bytes between header and }
           { line data; Data lines are padded out to 32 bit incrimemts }
           { also, bmp data is saved from bottom line up, and left to right }

  </i></font><font color="#FF0000"><b>label </b></font>badpalette<font color="#000080">,</font>badread<font color="#000080">;

  </font><font color="#FF0000"><b>const
    </b></font>maxbuf <font color="#000080">= </font><font color="#800000">65520</font><font color="#000080">-</font><font color="#800000">1</font><font color="#000080">-</font><font color="#800000">4</font><font color="#000080">;  </font><font color="#008000"><i>{ -4 for iw and ih words }
    </i></font>defaultcolors<font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">15</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte <font color="#000080">=
      (</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">2</font><font color="#000080">,</font><font color="#800000">3</font><font color="#000080">,</font><font color="#800000">4</font><font color="#000080">,</font><font color="#800000">5</font><font color="#000080">,</font><font color="#800000">20</font><font color="#000080">,</font><font color="#800000">7</font><font color="#000080">,</font><font color="#800000">56</font><font color="#000080">,</font><font color="#800000">57</font><font color="#000080">,</font><font color="#800000">58</font><font color="#000080">,</font><font color="#800000">59</font><font color="#000080">,</font><font color="#800000">60</font><font color="#000080">,</font><font color="#800000">61</font><font color="#000080">,</font><font color="#800000">62</font><font color="#000080">,</font><font color="#800000">63</font><font color="#000080">);

  </font><font color="#FF0000"><b>type </b></font>buftype <font color="#000080">= </font><font color="#FF0000"><b>record      </b></font><font color="#008000"><i>{ .data includes trailing word for # bitplanes }
                   </i></font>iw<font color="#000080">,</font>ih<font color="#000080">: </font>word<font color="#000080">;
                   </font>data <font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font>maxbuf<font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">;
                 </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>var
    </b></font>f<font color="#000080">: </font><font color="#FF0000"><b>file</b></font><font color="#000080">;
    </font>bmphead<font color="#000080">: </font>bmpheadtype<font color="#000080">;
    </font>buf<font color="#000080">: ^</font>buftype<font color="#000080">;
    </font>i<font color="#000080">,</font>graphics<font color="#000080">,</font>num<font color="#000080">,</font>n<font color="#000080">,</font>byteskip<font color="#000080">,</font>bw<font color="#000080">,</font>bw1<font color="#000080">,</font>startbit<font color="#000080">: </font>word<font color="#000080">;
    </font>dbyte<font color="#000080">,</font>bit<font color="#000080">,</font>bit1<font color="#000080">,</font>x<font color="#000080">,</font>y<font color="#000080">,</font>loc<font color="#000080">,</font>loc1<font color="#000080">,</font>x1<font color="#000080">: </font>word<font color="#000080">;
    </font>fs<font color="#000080">: </font>longint<font color="#000080">;
    </font>rgbpalette<font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">15</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">3</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">;

  </font><font color="#FF0000"><b>begin  </b></font><font color="#008000"><i>{ loadbmp }
    </i></font>errs<font color="#000080">:= </font><font color="#800000">''</font><font color="#000080">;
    </font>assign<font color="#000080">(</font>f<font color="#000080">,</font>fn<font color="#000080">);
    </font><font color="#008000"><i>{$I-}
    </i></font>reset<font color="#000080">(</font>f<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">);
    </font><font color="#008000"><i>{$I+}
    </i></font><font color="#FF0000"><b>if </b></font>ioresult<font color="#000080">&lt;&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>then begin
      </b></font>errs<font color="#000080">:= </font><font color="#800000">'cannot open '</font><font color="#000080">+</font>fn<font color="#000080">;
      </font>exit<font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font>blockread<font color="#000080">(</font>f<font color="#000080">,</font>bmphead<font color="#000080">,</font>sizeof<font color="#000080">(</font>bmphead<font color="#000080">),</font>num<font color="#000080">);
    </font><font color="#FF0000"><b>if </b></font>num <font color="#000080">&lt; </font>sizeof<font color="#000080">(</font>bmphead<font color="#000080">) </font><font color="#FF0000"><b>then begin
      </b></font>errs<font color="#000080">:= </font><font color="#800000">'unexpected end of file'</font><font color="#000080">;
      </font>close<font color="#000080">(</font>f<font color="#000080">);
      </font>exit<font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>with </b></font>bmphead <font color="#FF0000"><b>do begin
      if </b></font><font color="#000080">(</font>dw<font color="#000080">=</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>biwidth<font color="#000080">&gt;</font>dx<font color="#000080">) </font><font color="#FF0000"><b>then </b></font>dw<font color="#000080">:= </font>biwidth<font color="#000080">-</font>dx<font color="#000080">;
      </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>dh<font color="#000080">=</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>biheight<font color="#000080">&gt;</font>dy<font color="#000080">) </font><font color="#FF0000"><b>then </b></font>dh<font color="#000080">:= </font>biheight<font color="#000080">-</font>dy<font color="#000080">;
      </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>dx<font color="#000080">+</font>dw<font color="#000080">&gt;</font>biwidth<font color="#000080">) </font><font color="#FF0000"><b>or </b></font><font color="#000080">(</font>dy<font color="#000080">+</font>dh<font color="#000080">&gt;</font>biheight<font color="#000080">) </font><font color="#FF0000"><b>or </b></font><font color="#000080">(</font>dw<font color="#000080">=</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>or </b></font><font color="#000080">(</font>dh<font color="#000080">=</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>then begin
        </b></font>errs<font color="#000080">:= </font><font color="#800000">'x+width,y+height exceeds bmp bounds'</font><font color="#000080">;
        </font>close<font color="#000080">(</font>f<font color="#000080">);
        </font>exit<font color="#000080">;
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font>fs<font color="#000080">:= </font>filesize<font color="#000080">(</font>f<font color="#000080">);
      </font><font color="#FF0000"><b>if not </b></font><font color="#000080">((</font>bftype<font color="#000080">=</font><font color="#800000">$4D42</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>fs<font color="#000080">=</font>bfsize<font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>bisizeimage<font color="#000080">=</font>fs<font color="#000080">-</font>bfoffbits<font color="#000080">))
      </font><font color="#FF0000"><b>then begin
        </b></font>errs<font color="#000080">:= </font><font color="#800000">'corrupt bmp file or not a bmp'</font><font color="#000080">;
        </font>close<font color="#000080">(</font>f<font color="#000080">);
        </font>exit<font color="#000080">;
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>if not </b></font><font color="#000080">(</font>bibitcount <font color="#FF0000"><b>in </b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">4</font><font color="#000080">]) </font><font color="#FF0000"><b>then begin
        </b></font>errs<font color="#000080">:= </font><font color="#800000">'bmp must be 2 or 16 color'</font><font color="#000080">;
        </font>close<font color="#000080">(</font>f<font color="#000080">);
        </font>exit<font color="#000080">;
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

      </font>graphics<font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
      </font>size<font color="#000080">:= </font>imagesize<font color="#000080">(</font>dx<font color="#000080">,</font>dy<font color="#000080">,</font>dx<font color="#000080">+</font>dw<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">,</font>dy<font color="#000080">+</font>dh<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">);
      </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>graphresult<font color="#000080">=</font>grerror<font color="#000080">) </font><font color="#FF0000"><b>or </b></font><font color="#000080">(</font>size<font color="#000080">-</font><font color="#800000">4 </font><font color="#000080">&gt; </font>maxbuf<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">) </font><font color="#FF0000"><b>then begin
        </b></font>errs<font color="#000080">:= </font><font color="#800000">'image too large'</font><font color="#000080">;
        </font>close<font color="#000080">(</font>f<font color="#000080">);
        </font>exit<font color="#000080">;
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font>bw1<font color="#000080">:= </font>dw <font color="#FF0000"><b>div </b></font><font color="#800000">8</font><font color="#000080">;
      </font><font color="#FF0000"><b>if </b></font>dw <font color="#FF0000"><b>mod </b></font><font color="#800000">8 </font><font color="#000080">&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>bw1<font color="#000080">:= </font>bw1 <font color="#000080">+ </font><font color="#800000">1</font><font color="#000080">;
      </font><font color="#FF0000"><b>if </b></font>bw1<font color="#000080">*</font>dh<font color="#000080">*</font><font color="#800000">4</font><font color="#000080">+</font><font color="#800000">6</font><font color="#000080">=</font>size <font color="#FF0000"><b>then </b></font>graphics<font color="#000080">:= </font><font color="#800000">4</font><font color="#000080">;  </font><font color="#008000"><i>{ figure out what video mode }
      </i></font><font color="#FF0000"><b>if </b></font>bw1<font color="#000080">*</font>dh<font color="#000080">+</font><font color="#800000">6</font><font color="#000080">=</font>size <font color="#FF0000"><b>then </b></font>graphics<font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;    </font><font color="#008000"><i>{ we are in, 1 or 4 bit planes }
      </i></font><font color="#FF0000"><b>if </b></font>graphics<font color="#000080">=</font><font color="#800000">0 </font><font color="#FF0000"><b>then begin               </b></font><font color="#008000"><i>{ graphics = # bit planes to }
        </i></font>errs<font color="#000080">:= </font><font color="#800000">'internal error'</font><font color="#000080">;             </font><font color="#008000"><i>{ save putimage data with }
        </i></font>close<font color="#000080">(</font>f<font color="#000080">);
        </font>exit<font color="#000080">;
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>graphics<font color="#000080">=</font><font color="#800000">1</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>bibitcount<font color="#000080">&gt;</font><font color="#800000">1</font><font color="#000080">) </font><font color="#FF0000"><b>then begin
        </b></font>errs<font color="#000080">:= </font><font color="#800000">'bmp must be 2 color for present graphics mode'</font><font color="#000080">;
        </font>close<font color="#000080">(</font>f<font color="#000080">);
        </font>exit<font color="#000080">;
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

      </font>getmem<font color="#000080">(</font>datapointer<font color="#000080">,</font>size<font color="#000080">);
      </font>buf<font color="#000080">:= </font>datapointer<font color="#000080">;
      </font>n<font color="#000080">:= </font><font color="#800000">32 </font><font color="#FF0000"><b>div </b></font>bibitcount<font color="#000080">;              </font><font color="#008000"><i>{ pixels per longint }
      </i></font>bw<font color="#000080">:= </font>biwidth <font color="#FF0000"><b>div </b></font>n<font color="#000080">;                 </font><font color="#008000"><i>{ longint width of one line }
      </i></font><font color="#FF0000"><b>if </b></font>biwidth <font color="#FF0000"><b>mod </b></font>n <font color="#000080">&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>bw<font color="#000080">:= </font>bw <font color="#000080">+ </font><font color="#800000">1</font><font color="#000080">;
      </font>bw<font color="#000080">:= </font>bw <font color="#000080">* </font>n<font color="#000080">;                        </font><font color="#008000"><i>{ line length to nearest 32 pixels }
      </i></font>n<font color="#000080">:= </font>n <font color="#FF0000"><b>div </b></font><font color="#800000">4</font><font color="#000080">;                        </font><font color="#008000"><i>{ pixels per byte }
      </i></font>byteskip<font color="#000080">:= (</font>dx<font color="#000080">+</font>dw<font color="#000080">) </font><font color="#FF0000"><b>div </b></font>n<font color="#000080">;
      </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>dx<font color="#000080">+</font>dw<font color="#000080">) </font><font color="#FF0000"><b>mod </b></font>n <font color="#000080">&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>byteskip<font color="#000080">:= </font>byteskip <font color="#000080">+ </font><font color="#800000">1</font><font color="#000080">;
      </font>byteskip<font color="#000080">:= </font>byteskip <font color="#000080">* </font>n<font color="#000080">;
      </font>byteskip<font color="#000080">:= (</font>bw<font color="#000080">-</font>byteskip<font color="#000080">) </font><font color="#FF0000"><b>div </b></font>n<font color="#000080">;     </font><font color="#008000"><i>{ bytes to skip at end of line }
      </i></font>startbit<font color="#000080">:= </font>dx <font color="#FF0000"><b>mod </b></font>n<font color="#000080">;                </font><font color="#008000"><i>{ starting bit position }
      </i></font>dx<font color="#000080">:= </font>dx <font color="#FF0000"><b>div </b></font>n<font color="#000080">;                      </font><font color="#008000"><i>{ x byte offset into data }
      </i></font>byteskip<font color="#000080">:= </font>byteskip <font color="#000080">+ </font>dx<font color="#000080">;           </font><font color="#008000"><i>{ add bytes to skip at beginning }
      </i></font>bw<font color="#000080">:= </font>bw <font color="#FF0000"><b>div </b></font>n<font color="#000080">;                      </font><font color="#008000"><i>{ byte length of line }

      </i></font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>graphics<font color="#000080">=</font><font color="#800000">4</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>bibitcount<font color="#000080">=</font><font color="#800000">4</font><font color="#000080">) </font><font color="#FF0000"><b>then begin
        </b></font><font color="#008000"><i>{$I-}
        </i></font>seek<font color="#000080">(</font>f<font color="#000080">,</font>bisize<font color="#000080">+</font><font color="#800000">14</font><font color="#000080">);
        </font><font color="#008000"><i>{$I+}
        </i></font><font color="#FF0000"><b>if </b></font>ioresult<font color="#000080">&lt;&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>then goto </b></font>badpalette<font color="#000080">;
        </font>blockread<font color="#000080">(</font>f<font color="#000080">,</font>rgbpalette<font color="#000080">,</font>sizeof<font color="#000080">(</font>rgbpalette<font color="#000080">),</font>num<font color="#000080">);
        </font><font color="#FF0000"><b>if </b></font>num<font color="#000080">&lt;&gt;</font>sizeof<font color="#000080">(</font>rgbpalette<font color="#000080">) </font><font color="#FF0000"><b>then begin
          </b></font>badpalette<font color="#000080">:
          </font>errs<font color="#000080">:= </font><font color="#800000">'error reading bmp palette'</font><font color="#000080">;
          </font>close<font color="#000080">(</font>f<font color="#000080">);
          </font>freemem<font color="#000080">(</font>datapointer<font color="#000080">,</font>size<font color="#000080">);
          </font>exit<font color="#000080">;
        </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
        </font>getpalette<font color="#000080">(</font>palette<font color="#000080">);
        </font><font color="#FF0000"><b>if </b></font>palette<font color="#000080">.</font>size <font color="#000080">= </font><font color="#800000">16 </font><font color="#FF0000"><b>then for </b></font>i<font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font><font color="#800000">15 </font><font color="#FF0000"><b>do begin
          </b></font>dbyte<font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
          </font><font color="#FF0000"><b>if </b></font>rgbpalette<font color="#000080">[</font>i<font color="#000080">,</font><font color="#800000">2</font><font color="#000080">] </font><font color="#FF0000"><b>and </b></font><font color="#800000">$80 </font><font color="#000080">= </font><font color="#800000">$80 </font><font color="#FF0000"><b>then </b></font>dbyte<font color="#000080">:= </font>dbyte <font color="#FF0000"><b>or </b></font><font color="#800000">$04</font><font color="#000080">;
          </font><font color="#FF0000"><b>if </b></font>rgbpalette<font color="#000080">[</font>i<font color="#000080">,</font><font color="#800000">2</font><font color="#000080">] </font><font color="#FF0000"><b>and </b></font><font color="#800000">$40 </font><font color="#000080">= </font><font color="#800000">$40 </font><font color="#FF0000"><b>then </b></font>dbyte<font color="#000080">:= </font>dbyte <font color="#FF0000"><b>or </b></font><font color="#800000">$20</font><font color="#000080">;
          </font><font color="#FF0000"><b>if </b></font>rgbpalette<font color="#000080">[</font>i<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">] </font><font color="#FF0000"><b>and </b></font><font color="#800000">$80 </font><font color="#000080">= </font><font color="#800000">$80 </font><font color="#FF0000"><b>then </b></font>dbyte<font color="#000080">:= </font>dbyte <font color="#FF0000"><b>or </b></font><font color="#800000">$02</font><font color="#000080">;
          </font><font color="#FF0000"><b>if </b></font>rgbpalette<font color="#000080">[</font>i<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">] </font><font color="#FF0000"><b>and </b></font><font color="#800000">$40 </font><font color="#000080">= </font><font color="#800000">$40 </font><font color="#FF0000"><b>then </b></font>dbyte<font color="#000080">:= </font>dbyte <font color="#FF0000"><b>or </b></font><font color="#800000">$10</font><font color="#000080">;
          </font><font color="#FF0000"><b>if </b></font>rgbpalette<font color="#000080">[</font>i<font color="#000080">,</font><font color="#800000">0</font><font color="#000080">] </font><font color="#FF0000"><b>and </b></font><font color="#800000">$80 </font><font color="#000080">= </font><font color="#800000">$80 </font><font color="#FF0000"><b>then </b></font>dbyte<font color="#000080">:= </font>dbyte <font color="#FF0000"><b>or </b></font><font color="#800000">$01</font><font color="#000080">;
          </font><font color="#FF0000"><b>if </b></font>rgbpalette<font color="#000080">[</font>i<font color="#000080">,</font><font color="#800000">0</font><font color="#000080">] </font><font color="#FF0000"><b>and </b></font><font color="#800000">$40 </font><font color="#000080">= </font><font color="#800000">$40 </font><font color="#FF0000"><b>then </b></font>dbyte<font color="#000080">:= </font>dbyte <font color="#FF0000"><b>or </b></font><font color="#800000">$08</font><font color="#000080">;
          </font>palette<font color="#000080">.</font>colors<font color="#000080">[</font>i<font color="#000080">]:= </font>dbyte<font color="#000080">;
        </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>graphics<font color="#000080">=</font><font color="#800000">4</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>bibitcount<font color="#000080">=</font><font color="#800000">1</font><font color="#000080">) </font><font color="#FF0000"><b>then begin
        </b></font>getpalette<font color="#000080">(</font>palette<font color="#000080">);
        </font><font color="#FF0000"><b>if </b></font>palette<font color="#000080">.</font>size <font color="#000080">= </font><font color="#800000">16 </font><font color="#FF0000"><b>then </b></font>move<font color="#000080">(</font>defaultcolors<font color="#000080">,</font>palette<font color="#000080">.</font>colors<font color="#000080">,</font><font color="#800000">16</font><font color="#000080">);
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>if </b></font>graphics<font color="#000080">=</font><font color="#800000">1 </font><font color="#FF0000"><b>then </b></font>getpalette<font color="#000080">(</font>palette<font color="#000080">);

      </font><font color="#008000"><i>{$I-}
      </i></font>seek<font color="#000080">(</font>f<font color="#000080">,</font>bfoffbits<font color="#000080">);
      </font><font color="#008000"><i>{$I+}
      </i></font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>ioresult<font color="#000080">&lt;&gt;</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>or </b></font><font color="#000080">(</font>fs<font color="#000080">-</font>filepos<font color="#000080">(</font>f<font color="#000080">) &lt;&gt; </font>bw<font color="#000080">*</font>biheight<font color="#000080">) </font><font color="#FF0000"><b>then begin
        </b></font>errs<font color="#000080">:= </font><font color="#800000">'bad bmp file length, doesn''t match image size parameters'</font><font color="#000080">;
        </font>close<font color="#000080">(</font>f<font color="#000080">);
        </font>freemem<font color="#000080">(</font>datapointer<font color="#000080">,</font>size<font color="#000080">);
        </font>exit<font color="#000080">;
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font><font color="#008000"><i>{$I-}                        { !! bmp's are saved from bottom up !! }
      </i></font>seek<font color="#000080">(</font>f<font color="#000080">,</font>bfoffbits <font color="#000080">+ (</font>biheight<font color="#000080">-</font>dh<font color="#000080">-</font>dy<font color="#000080">)*</font>bw <font color="#000080">+ </font>dx<font color="#000080">);
      </font><font color="#008000"><i>{$I+}
      </i></font><font color="#FF0000"><b>if </b></font>ioresult<font color="#000080">&lt;&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>then goto </b></font>badread<font color="#000080">;
      </font>fillchar<font color="#000080">(</font>buf<font color="#000080">^,</font>size<font color="#000080">,</font><font color="#800000">#0</font><font color="#000080">);
      </font>buf<font color="#000080">^.</font>iw<font color="#000080">:= </font>dw<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">;         </font><font color="#008000"><i>{ bgi putimage data has width &amp; height values }
      </i></font>buf<font color="#000080">^.</font>ih<font color="#000080">:= </font>dh<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">;         </font><font color="#008000"><i>{ stored as width-1, height-1 }
      </i></font><font color="#FF0000"><b>for </b></font>y<font color="#000080">:= </font>dh<font color="#000080">-</font><font color="#800000">1 </font><font color="#FF0000"><b>downto </b></font><font color="#800000">0 </font><font color="#FF0000"><b>do begin
        </b></font>bit<font color="#000080">:= </font>startbit<font color="#000080">;
        </font>blockread<font color="#000080">(</font>f<font color="#000080">,</font>dbyte<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font>num<font color="#000080">);
        </font><font color="#FF0000"><b>if </b></font>num <font color="#000080">&lt;&gt; </font><font color="#800000">1 </font><font color="#FF0000"><b>then goto </b></font>badread<font color="#000080">;
        </font>loc<font color="#000080">:= </font>bw1<font color="#000080">*</font>y<font color="#000080">*</font>graphics<font color="#000080">;
        </font>bit1<font color="#000080">:= </font><font color="#800000">$80</font><font color="#000080">;
        </font>x1<font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
        </font><font color="#FF0000"><b>for </b></font>x<font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font>dw<font color="#000080">-</font><font color="#800000">1 </font><font color="#FF0000"><b>do begin
          </b></font>loc1<font color="#000080">:= </font>loc<font color="#000080">+</font>x1<font color="#000080">;
          </font><font color="#FF0000"><b>if </b></font>graphics <font color="#000080">&lt;&gt; </font>bibitcount <font color="#FF0000"><b>then </b></font>dbyte<font color="#000080">:= (</font>dbyte <font color="#FF0000"><b>and </b></font><font color="#800000">$FF</font><font color="#000080">) </font><font color="#FF0000"><b>shl </b></font><font color="#800000">1</font><font color="#000080">;
          </font><font color="#FF0000"><b>for </b></font>i<font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font>graphics<font color="#000080">-</font><font color="#800000">1 </font><font color="#FF0000"><b>do begin
            if </b></font>graphics <font color="#000080">= </font>bibitcount <font color="#FF0000"><b>then </b></font>dbyte<font color="#000080">:= (</font>dbyte <font color="#FF0000"><b>and </b></font><font color="#800000">$FF</font><font color="#000080">) </font><font color="#FF0000"><b>shl </b></font><font color="#800000">1</font><font color="#000080">;
            </font><font color="#FF0000"><b>if </b></font>hi<font color="#000080">(</font>dbyte<font color="#000080">)=</font><font color="#800000">1 </font><font color="#FF0000"><b>then </b></font>buf<font color="#000080">^.</font>data<font color="#000080">[</font>loc1<font color="#000080">]:= </font>buf<font color="#000080">^.</font>data<font color="#000080">[</font>loc1<font color="#000080">] </font><font color="#FF0000"><b>or </b></font>bit1<font color="#000080">;
            </font>loc1<font color="#000080">:= </font>loc1<font color="#000080">+</font>bw1<font color="#000080">;
          </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
          </font>bit1<font color="#000080">:= </font>bit1 <font color="#FF0000"><b>shr </b></font><font color="#800000">1</font><font color="#000080">;
          </font><font color="#FF0000"><b>if </b></font>bit1<font color="#000080">=</font><font color="#800000">0 </font><font color="#FF0000"><b>then begin
            </b></font>bit1<font color="#000080">:= </font><font color="#800000">$80</font><font color="#000080">;
            </font>x1<font color="#000080">:= </font>x1<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">;
          </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
          </font>bit<font color="#000080">:= </font>bit<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">;
          </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>bit <font color="#000080">&gt;= </font>n<font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>x<font color="#000080">&lt;</font>dw<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">) </font><font color="#FF0000"><b>then begin
            </b></font>bit<font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
            </font>blockread<font color="#000080">(</font>f<font color="#000080">,</font>dbyte<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font>num<font color="#000080">);
            </font><font color="#FF0000"><b>if </b></font>num <font color="#000080">&lt;&gt; </font><font color="#800000">1 </font><font color="#FF0000"><b>then goto </b></font>badread<font color="#000080">;
          </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
        </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
        </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>byteskip<font color="#000080">&gt;</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>y<font color="#000080">&gt;</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>then begin
          </b></font><font color="#008000"><i>{$I-}
          </i></font>seek<font color="#000080">(</font>f<font color="#000080">,</font>filepos<font color="#000080">(</font>f<font color="#000080">)+</font>byteskip<font color="#000080">);
          </font><font color="#008000"><i>{$I+}
          </i></font><font color="#FF0000"><b>if </b></font>ioresult<font color="#000080">&lt;&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>then begin
            </b></font>badread<font color="#000080">:
            </font>errs<font color="#000080">:= </font><font color="#800000">'error reading bmp data'</font><font color="#000080">;
            </font>close<font color="#000080">(</font>f<font color="#000080">);
            </font>freemem<font color="#000080">(</font>datapointer<font color="#000080">,</font>size<font color="#000080">);
            </font>exit<font color="#000080">;
          </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
        </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
      </font>close<font color="#000080">(</font>f<font color="#000080">);
      </font>loc1<font color="#000080">:= </font>dh<font color="#000080">*</font>bw1<font color="#000080">*</font>graphics<font color="#000080">;    </font><font color="#008000"><i>{ set number of bitplanes parameter }
      </i></font>buf<font color="#000080">^.</font>data<font color="#000080">[</font>loc1<font color="#000080">+</font><font color="#800000">1</font><font color="#000080">]:= </font><font color="#800000">0</font><font color="#000080">;
      </font><font color="#FF0000"><b>if </b></font>bibitcount <font color="#000080">= </font><font color="#800000">4 </font><font color="#FF0000"><b>then </b></font>buf<font color="#000080">^.</font>data<font color="#000080">[</font>loc1<font color="#000080">]:= </font><font color="#800000">$F </font><font color="#FF0000"><b>else </b></font>buf<font color="#000080">^.</font>data<font color="#000080">[</font>loc1<font color="#000080">]:= </font><font color="#800000">0</font><font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;  </font><font color="#008000"><i>{ bmpgetimage }



</i></font><font color="#FF0000"><b>procedure </b></font>example<font color="#000080">;
  </font><font color="#FF0000"><b>var
    </b></font>p<font color="#000080">: </font>pointer<font color="#000080">;
    </font>i<font color="#000080">,</font>x<font color="#000080">,</font>y<font color="#000080">,</font>w<font color="#000080">,</font>h<font color="#000080">,</font>size<font color="#000080">: </font>word<font color="#000080">;
    </font>errs<font color="#000080">: </font>string80<font color="#000080">;
    </font>grmode<font color="#000080">,</font>grdriver<font color="#000080">,</font>errcode<font color="#000080">: </font>integer<font color="#000080">;
    </font>palette<font color="#000080">,</font>origpalette<font color="#000080">: </font>palettetype<font color="#000080">;

  </font><font color="#FF0000"><b>begin
    </b></font>grdriver<font color="#000080">:= </font>detect<font color="#000080">;
    </font>initgraph<font color="#000080">(</font>grdriver<font color="#000080">,</font>grmode<font color="#000080">,</font><font color="#800000">'e:\bp\bgi'</font><font color="#000080">);
    </font>errcode<font color="#000080">:= </font>graphresult<font color="#000080">;
    </font><font color="#FF0000"><b>if </b></font>errcode <font color="#000080">&lt;&gt; </font>grok <font color="#FF0000"><b>then begin
      </b></font>writeln<font color="#000080">(</font><font color="#800000">'Graphics error: '</font><font color="#000080">,</font>grapherrormsg <font color="#000080">(</font>errcode<font color="#000080">));
      </font>halt<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font>x<font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;   </font><font color="#008000"><i>{ start reading the bmp data from 0,0 }
    </i></font>y<font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
    </font>w<font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;   </font><font color="#008000"><i>{ w=0 means tells bmpgetimage to use maximum width of bmp }
    </i></font>h<font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;   </font><font color="#008000"><i>{ h=0 same here }
    </i></font>bmpgetimage<font color="#000080">(</font><font color="#800000">'d:\windows\winlogo.bmp'</font><font color="#000080">,</font>p<font color="#000080">,</font>x<font color="#000080">,</font>y<font color="#000080">,</font>w<font color="#000080">,</font>h<font color="#000080">,</font>errs<font color="#000080">,</font>palette<font color="#000080">,</font>size<font color="#000080">);
    </font><font color="#FF0000"><b>if </b></font>errs<font color="#000080">=</font><font color="#800000">'' </font><font color="#FF0000"><b>then begin       </b></font><font color="#008000"><i>{ test error string for possible error }
      </i></font>getpalette<font color="#000080">(</font>origpalette<font color="#000080">);
      </font>setallpalette<font color="#000080">(</font>palette<font color="#000080">);
      </font>putimage<font color="#000080">(</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font>p<font color="#000080">^,</font>normalput<font color="#000080">);
      </font>readln<font color="#000080">;
      </font>setallpalette<font color="#000080">(</font>origpalette<font color="#000080">);
      </font>closegraph<font color="#000080">;
      </font>freemem<font color="#000080">(</font>p<font color="#000080">,</font>size<font color="#000080">);
    </font><font color="#FF0000"><b>end
    else begin
      </b></font>closegraph<font color="#000080">;
      </font>writeln<font color="#000080">(</font>errs<font color="#000080">);
      </font>readln<font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;


</font><font color="#FF0000"><b>begin
  </b></font>example<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">.

</font><font color="#008000"><i>{
------------- end first program, begin second program --------------
}
{ makes a test pattern bmp file with correct palette, 640x128, 4 bits/pixel }
</i></font><font color="#FF0000"><b>program </b></font>makebmptestpattern<font color="#000080">;
</font><font color="#FF0000"><b>type
  </b></font>bmpheadtype <font color="#000080">= </font><font color="#FF0000"><b>record

           </b></font><font color="#008000"><i>{ bit map file header }
           </i></font>bftype<font color="#000080">: </font>word<font color="#000080">;                   </font><font color="#008000"><i>{ &quot;BM&quot; or $4D42 }
           </i></font>bfsize<font color="#000080">: </font>longint<font color="#000080">;                </font><font color="#008000"><i>{ size of file in bytes }
           </i></font>bfreserved1<font color="#000080">: </font>word<font color="#000080">;
           </font>bfreserved2<font color="#000080">: </font>word<font color="#000080">;
           </font>bfoffbits<font color="#000080">: </font>longint<font color="#000080">;             </font><font color="#008000"><i>{ ^ where graphic data begins }

           { bit map information header }
           </i></font>bisize<font color="#000080">: </font>longint<font color="#000080">;                </font><font color="#008000"><i>{ length of this header, $28 }
           </i></font>biwidth<font color="#000080">: </font>longint<font color="#000080">;               </font><font color="#008000"><i>{ pixel width }
           </i></font>biheight<font color="#000080">: </font>longint<font color="#000080">;              </font><font color="#008000"><i>{ pixel height }
           </i></font>biplanes<font color="#000080">: </font>word<font color="#000080">;                 </font><font color="#008000"><i>{ = 1 }
           </i></font>bibitcount<font color="#000080">: </font>word<font color="#000080">;               </font><font color="#008000"><i>{ color bits per pixel }
           </i></font>bicompression<font color="#000080">: </font>longint<font color="#000080">;         </font><font color="#008000"><i>{ = 0 for no compression }
           </i></font>bisizeimage<font color="#000080">: </font>longint<font color="#000080">;           </font><font color="#008000"><i>{ = bfsize - bfoffbits }
           </i></font>bixpelspermeter<font color="#000080">: </font>longint<font color="#000080">;       </font><font color="#008000"><i>{ x pixels per meter }
           </i></font>biypelspermeter<font color="#000080">: </font>longint<font color="#000080">;       </font><font color="#008000"><i>{ y pixels per meter }
           </i></font>biclrused<font color="#000080">: </font>longint<font color="#000080">;             </font><font color="#008000"><i>{ \ I have never seen these }
           </i></font>biclrimportant<font color="#000080">: </font>longint<font color="#000080">;        </font><font color="#008000"><i>{ / two used for anything }
         </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>type
  </b></font>paltype <font color="#000080">= </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">15</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">3</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">;
  </font>bodytype <font color="#000080">= </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">127</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">319</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">;
  </font>buftype <font color="#000080">= </font><font color="#FF0000"><b>record
              </b></font>head<font color="#000080">: </font>bmpheadtype<font color="#000080">;
              </font>pal <font color="#000080">: </font>paltype<font color="#000080">;
              </font>body<font color="#000080">: </font>bodytype<font color="#000080">;
            </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>colorstype <font color="#000080">= </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">15</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">;

</font><font color="#FF0000"><b>const
  </b></font>colors<font color="#000080">: </font>colorstype <font color="#000080">= (</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">2</font><font color="#000080">,</font><font color="#800000">3</font><font color="#000080">,</font><font color="#800000">4</font><font color="#000080">,</font><font color="#800000">5</font><font color="#000080">,</font><font color="#800000">20</font><font color="#000080">,</font><font color="#800000">7</font><font color="#000080">,</font><font color="#800000">56</font><font color="#000080">,</font><font color="#800000">57</font><font color="#000080">,</font><font color="#800000">58</font><font color="#000080">,</font><font color="#800000">59</font><font color="#000080">,</font><font color="#800000">60</font><font color="#000080">,</font><font color="#800000">61</font><font color="#000080">,</font><font color="#800000">62</font><font color="#000080">,</font><font color="#800000">63</font><font color="#000080">);


</font><font color="#FF0000"><b>var
  </b></font>f<font color="#000080">: </font><font color="#FF0000"><b>file</b></font><font color="#000080">;
  </font>buf<font color="#000080">: ^</font>buftype<font color="#000080">;
  </font>r<font color="#000080">,</font>g<font color="#000080">,</font>b<font color="#000080">,</font>i<font color="#000080">,</font>x<font color="#000080">,</font>y<font color="#000080">,</font>c<font color="#000080">: </font>integer<font color="#000080">;


</font><font color="#FF0000"><b>begin
  </b></font>new<font color="#000080">(</font>buf<font color="#000080">);
  </font><font color="#FF0000"><b>with </b></font>buf<font color="#000080">^,</font>buf<font color="#000080">^.</font>head <font color="#FF0000"><b>do begin
    for </b></font>i<font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font><font color="#800000">15 </font><font color="#FF0000"><b>do begin
      </b></font>r<font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;  </font>g<font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;  </font>b<font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
      </font><font color="#FF0000"><b>if </b></font>colors<font color="#000080">[</font>i<font color="#000080">] </font><font color="#FF0000"><b>and </b></font><font color="#800000">1 </font><font color="#000080">= </font><font color="#800000">1 </font><font color="#FF0000"><b>then </b></font>b<font color="#000080">:= </font>b <font color="#000080">+ </font><font color="#800000">128</font><font color="#000080">;
      </font><font color="#FF0000"><b>if </b></font>colors<font color="#000080">[</font>i<font color="#000080">] </font><font color="#FF0000"><b>and </b></font><font color="#800000">2 </font><font color="#000080">= </font><font color="#800000">2 </font><font color="#FF0000"><b>then </b></font>g<font color="#000080">:= </font>g <font color="#000080">+ </font><font color="#800000">128</font><font color="#000080">;
      </font><font color="#FF0000"><b>if </b></font>colors<font color="#000080">[</font>i<font color="#000080">] </font><font color="#FF0000"><b>and </b></font><font color="#800000">4 </font><font color="#000080">= </font><font color="#800000">4 </font><font color="#FF0000"><b>then </b></font>r<font color="#000080">:= </font>r <font color="#000080">+ </font><font color="#800000">128</font><font color="#000080">;
      </font><font color="#FF0000"><b>if </b></font>colors<font color="#000080">[</font>i<font color="#000080">] </font><font color="#FF0000"><b>and </b></font><font color="#800000">8 </font><font color="#000080">= </font><font color="#800000">8 </font><font color="#FF0000"><b>then </b></font>b<font color="#000080">:= </font>b <font color="#000080">+ </font><font color="#800000">64</font><font color="#000080">;
      </font><font color="#FF0000"><b>if </b></font>colors<font color="#000080">[</font>i<font color="#000080">] </font><font color="#FF0000"><b>and </b></font><font color="#800000">16 </font><font color="#000080">= </font><font color="#800000">16 </font><font color="#FF0000"><b>then </b></font>g<font color="#000080">:= </font>g <font color="#000080">+ </font><font color="#800000">64</font><font color="#000080">;
      </font><font color="#FF0000"><b>if </b></font>colors<font color="#000080">[</font>i<font color="#000080">] </font><font color="#FF0000"><b>and </b></font><font color="#800000">32 </font><font color="#000080">= </font><font color="#800000">32 </font><font color="#FF0000"><b>then </b></font>r<font color="#000080">:= </font>r <font color="#000080">+ </font><font color="#800000">64</font><font color="#000080">;
      </font>pal<font color="#000080">[</font>i<font color="#000080">,</font><font color="#800000">0</font><font color="#000080">]:= </font>b<font color="#000080">;
      </font>pal<font color="#000080">[</font>i<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">]:= </font>g<font color="#000080">;
      </font>pal<font color="#000080">[</font>i<font color="#000080">,</font><font color="#800000">2</font><font color="#000080">]:= </font>r<font color="#000080">;
      </font>pal<font color="#000080">[</font>i<font color="#000080">,</font><font color="#800000">3</font><font color="#000080">]:= </font><font color="#800000">0</font><font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font><font color="#FF0000"><b>for </b></font>y<font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font><font color="#800000">127 </font><font color="#FF0000"><b>do
      for </b></font>x<font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font><font color="#800000">319 </font><font color="#FF0000"><b>do begin
        </b></font>c<font color="#000080">:= (</font>x <font color="#FF0000"><b>div </b></font><font color="#800000">10</font><font color="#000080">) </font><font color="#FF0000"><b>mod </b></font><font color="#800000">16</font><font color="#000080">;
        </font>c<font color="#000080">:= (</font>c <font color="#FF0000"><b>shl </b></font><font color="#800000">4</font><font color="#000080">) + </font>c<font color="#000080">;
        </font>body<font color="#000080">[</font>y<font color="#000080">,</font>x<font color="#000080">]:= </font>c<font color="#000080">;
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font>bftype<font color="#000080">:= </font><font color="#800000">$4D42</font><font color="#000080">;                 </font><font color="#008000"><i>{ &quot;BM&quot; or $4D42 }
    </i></font>bfsize<font color="#000080">:= </font>sizeof<font color="#000080">(</font>buf<font color="#000080">^);          </font><font color="#008000"><i>{ size of file in bytes }
    </i></font>bfreserved1<font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
    </font>bfreserved2<font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
    </font>bfoffbits<font color="#000080">:= </font><font color="#800000">14</font><font color="#000080">+</font><font color="#800000">40</font><font color="#000080">+</font><font color="#800000">64</font><font color="#000080">;           </font><font color="#008000"><i>{ where graphic data begins }
    </i></font>bisize<font color="#000080">:= </font><font color="#800000">40</font><font color="#000080">;                    </font><font color="#008000"><i>{ length of this header }
    </i></font>biwidth<font color="#000080">:= </font><font color="#800000">640</font><font color="#000080">;                  </font><font color="#008000"><i>{ pixel width }
    </i></font>biheight<font color="#000080">:= </font><font color="#800000">128</font><font color="#000080">;                 </font><font color="#008000"><i>{ pixel height }
    </i></font>biplanes<font color="#000080">:= </font><font color="#800000">1</font><font color="#000080">;                   </font><font color="#008000"><i>{ =1 }
    </i></font>bibitcount<font color="#000080">:= </font><font color="#800000">4</font><font color="#000080">;                 </font><font color="#008000"><i>{ color bits per pixel }
    </i></font>bicompression<font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;              </font><font color="#008000"><i>{ =0 for no compression }
    </i></font>bisizeimage<font color="#000080">:= </font>bfsize<font color="#000080">-</font>bfoffbits<font color="#000080">;
    </font>bixpelspermeter<font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
    </font>biypelspermeter<font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
    </font>biclrused<font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
    </font>biclrimportant<font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>assign<font color="#000080">(</font>f<font color="#000080">,</font><font color="#800000">'testpat.bmp'</font><font color="#000080">);
  </font>rewrite<font color="#000080">(</font>f<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">);
  </font>blockwrite<font color="#000080">(</font>f<font color="#000080">,</font>buf<font color="#000080">^,</font>sizeof<font color="#000080">(</font>buf<font color="#000080">^));
  </font>close<font color="#000080">(</font>f<font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">.

</font><font color="#008000"><i>{
--------------- end of programs ---------------
}</i></font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to EGAVGA SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0140.PAS">Original</a><b>]</b></p></body>
</html>
