<html>
<head><title> "Hardware Scrolling" by ARNE DE.BRUIJN</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to EGAVGA SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0211.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
&gt; You can't scroll bits with pageflips, you can, however, do a hardware
&gt; pixel by pixel scroll (pixel panning).

{ Example for hardware scroll, Arne de Bruijn, 1994, PD }
</i></font><font color="#FF0000"><b>uses </b></font>Graph<font color="#000080">,</font>Crt<font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>SetStart<font color="#000080">(</font>X<font color="#000080">,</font>Y<font color="#000080">:</font>word<font color="#000080">); </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>asm
 </b></font><font color="#FF00FF">mov dx,3dah          </font><font color="#008000"><i>{ Port $3DA }
 </i></font><font color="#FF00FF">in al,dx             </font><font color="#008000"><i>{ Read = clear $3C0 to index }
 </i></font><font color="#FF00FF">mov dl,0c0h          </font><font color="#008000"><i>{ Port $3C0 }
 </i></font><font color="#FF00FF">mov al,33h           </font><font color="#008000"><i>{ Index $13 = Horiz Pixel Panning, +$20 = enable disp }
 </i></font><font color="#FF00FF">out dx,al            </font><font color="#008000"><i>{ Send index }
 </i></font><font color="#FF00FF">mov bx,X             </font><font color="#008000"><i>{ Calculate pixel number (lower 3 bits) }
 </i></font><font color="#FF00FF">mov al,bl
 and al,7
 out dx,al            </font><font color="#008000"><i>{ Send pixel number }
 </i></font><font color="#FF00FF">mov ax,80
 mul Y                </font><font color="#008000"><i>{ Offset is Y*80+(X div 8) }
 </i></font><font color="#FF00FF">shr bx,1
 shr bx,1
 shr bx,1             </font><font color="#008000"><i>{ bx shr 3, is bx div 8 }
 </i></font><font color="#FF00FF">add bx,ax
 mov dx,03d4h         </font><font color="#008000"><i>{ Port $3D4 }
 </i></font><font color="#FF00FF">mov al,0ch           </font><font color="#008000"><i>{ Index $0C, high start }
 </i></font><font color="#FF00FF">mov ah,bh            </font><font color="#008000"><i>{ Data  high byte of BX, is high byte of offset }
 </i></font><font color="#FF00FF">out dx,ax            </font><font color="#008000"><i>{ Send to VGA }
 </i></font><font color="#FF00FF">inc ax               </font><font color="#008000"><i>{ Index $0D, low start }
 </i></font><font color="#FF00FF">mov ah,bl            </font><font color="#008000"><i>{ Data  low byte of BX, is low byte of offset }
 </i></font><font color="#FF00FF">out dx,ax            </font><font color="#008000"><i>{ Send to VGA }
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>SetWidth<font color="#000080">(</font>B<font color="#000080">:</font>byte<font color="#000080">); </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>asm
 </b></font><font color="#FF00FF">mov dx,3d4h          </font><font color="#008000"><i>{ Port $3D4 }
 </i></font><font color="#FF00FF">mov al,13h           </font><font color="#008000"><i>{ Index $13, set display memory width }
 </i></font><font color="#FF00FF">mov ah,B             </font><font color="#008000"><i>{ Data  B   }
 </i></font><font color="#FF00FF">out dx,ax            </font><font color="#008000"><i>{ Send to VGA }
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>var
 </b></font>SX<font color="#000080">,</font>SY<font color="#000080">,</font>I<font color="#000080">:</font>word<font color="#000080">;
 </font>gd<font color="#000080">,</font>gm<font color="#000080">:</font>integer<font color="#000080">;
 </font>a<font color="#000080">:</font>char<font color="#000080">;
</font><font color="#FF0000"><b>begin
 </b></font>gd<font color="#000080">:=</font>vga<font color="#000080">; </font>gm<font color="#000080">:=</font>vgahi<font color="#000080">;
 </font>InitGraph<font color="#000080">(</font>gd<font color="#000080">,</font>gm<font color="#000080">,</font><font color="#800000">'e\bp\bgi'</font><font color="#000080">); </font><font color="#008000"><i>{ Init BGI and VGA to 640x480x16 }
 </i></font><font color="#FF0000"><b>asm
  </b></font><font color="#FF00FF">mov ax,0dh          </font><font color="#008000"><i>{ Change VGA to 320x200x16 to show scrolling }
  </i></font><font color="#FF00FF">int 10h             </font><font color="#008000"><i>{ (BGI still thinks 640x480x16, so we can scroll) }
 </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;
 </font>SetWidth<font color="#000080">(</font><font color="#800000">40</font><font color="#000080">);           </font><font color="#008000"><i>{ Set video display memory width at 640 }
 </i></font><font color="#FF0000"><b>for </b></font>I<font color="#000080">:=</font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font><font color="#800000">100 </font><font color="#FF0000"><b>do
  begin
   </b></font>SetColor<font color="#000080">(</font>Random<font color="#000080">(</font><font color="#800000">16</font><font color="#000080">));
   </font>Line<font color="#000080">(</font>Random<font color="#000080">(</font><font color="#800000">640</font><font color="#000080">),</font>Random<font color="#000080">(</font><font color="#800000">480</font><font color="#000080">),</font>Random<font color="#000080">(</font><font color="#800000">640</font><font color="#000080">),</font>Random<font color="#000080">(</font><font color="#800000">480</font><font color="#000080">));
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
 </font>SX<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">; </font>SY<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
 </font><font color="#FF0000"><b>repeat
  </b></font>SetStart<font color="#000080">(</font>SX<font color="#000080">,</font>SY<font color="#000080">);
  </font>a<font color="#000080">:=</font>readkey<font color="#000080">;
  </font><font color="#FF0000"><b>case </b></font>a <font color="#FF0000"><b>of
   </b></font><font color="#800000">#0</font><font color="#000080">:
    </font><font color="#FF0000"><b>case </b></font>readkey <font color="#FF0000"><b>of
     </b></font><font color="#800000">#75</font><font color="#000080">:</font><font color="#FF0000"><b>if </b></font>SX<font color="#000080">&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>Dec<font color="#000080">(</font>SX<font color="#000080">);
     </font><font color="#800000">#77</font><font color="#000080">:</font><font color="#FF0000"><b>if </b></font>SX<font color="#000080">&lt;</font><font color="#800000">639 </font><font color="#FF0000"><b>then </b></font>Inc<font color="#000080">(</font>SX<font color="#000080">);
     </font><font color="#800000">#72</font><font color="#000080">:</font><font color="#FF0000"><b>if </b></font>SY<font color="#000080">&gt;</font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>Dec<font color="#000080">(</font>SY<font color="#000080">);
     </font><font color="#800000">#80</font><font color="#000080">:</font><font color="#FF0000"><b>if </b></font>SY<font color="#000080">&lt;</font><font color="#800000">479 </font><font color="#FF0000"><b>then </b></font>Inc<font color="#000080">(</font>SY<font color="#000080">);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
 </font><font color="#FF0000"><b>until </b></font>A<font color="#000080">=</font><font color="#800000">#27</font><font color="#000080">;
 </font>CloseGraph<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to EGAVGA SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0211.PAS">Original</a><b>]</b></p></body>
</html>
