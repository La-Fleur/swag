<html>
<head><title> "Snow Screen Saver" by ERIC COOLMAN</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to EGAVGA SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0124.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
NB&gt;{Hello All! I've recently coded this screen saver.It really looks like
NB&gt;snow is falling all over, don't you think?

Yeah, it looked pretty neat!

NB&gt;However, I did not set out to do a snow screen saver and if you exp
NB&gt;with it a little you will see that it can even turn out to be a fir
NB&gt;If anyone can improve this code or make anything out of it, I would
NB&gt;very pleased to have a copy of the source.

Ok, I played around with it a bit today, and following is my modified
version.  I pretty much just cleaned it up, got rid of all the unused
variables and stuff (there were quite a few &lt;G&gt;) for readability,
simplified a the calculations, and removed a lot of the overhead, and
removed most of the global variables.  You will see that now you can
have a lot more snowflakes without it bogging out.  I also removed the
custom palette because you can get pretty much the same colours using
the default palette (indexes 19-31).  It can probably be simplified
even further (ie. remove the x and y tables and just use newPos table).
Oh yeah, I threw in a little snowflake explosion at the start too :-).

(********************************************************************
 Originally by    : Nick Batalas, 14-6-1994
 Modifications by : Eric Coolman, 19-6-1994
********************************************************************)
}

</i></font><font color="#FF0000"><b>Program </b></font>SnowFall<font color="#000080">;
</font><font color="#FF0000"><b>Uses </b></font>crt<font color="#000080">;                                  </font><font color="#008000"><i>{ for keypressed only }

</i></font><font color="#FF0000"><b>const
  </b></font>Flakes <font color="#000080">= </font><font color="#800000">500</font><font color="#000080">;            </font><font color="#008000"><i>{ try less flakes for faster snowfall }

{---------------- Stuff not specific to snowfall ----------------}
</i></font><font color="#FF0000"><b>Procedure </b></font>vidMode<font color="#000080">(</font>mode <font color="#000080">: </font>byte<font color="#000080">);</font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>asm </b></font><font color="#FF00FF">mov ah,$00;  mov al,mode; int 10h; </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>setPixel<font color="#000080">(</font>pixPos <font color="#000080">: </font>word<font color="#000080">; </font>color <font color="#000080">: </font>byte<font color="#000080">);
</font><font color="#FF0000"><b>begin
    </b></font>mem<font color="#000080">[</font><font color="#800000">$A000</font><font color="#000080">:</font>pixPos<font color="#000080">] := </font>color<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{---------------------------MAIN PROGRAM-------------------------}

</i></font><font color="#FF0000"><b>var
  </b></font>CurFlake <font color="#000080">: </font>integer<font color="#000080">;                        </font><font color="#008000"><i>{ snowflake counter }
  </i></font>i <font color="#000080">: </font>longint<font color="#000080">;                       </font><font color="#008000"><i>{ to add velocity to flakes }
  </i></font>x<font color="#000080">,</font>y<font color="#000080">, </font>newPos<font color="#000080">: </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font>Flakes<font color="#000080">] </font><font color="#FF0000"><b>of </b></font>word<font color="#000080">;         </font><font color="#008000"><i>{ lookup tables }
</i></font><font color="#FF0000"><b>BEGIN
  </b></font>randomize<font color="#000080">;
  </font><font color="#FF0000"><b>for </b></font>curFlake<font color="#000080">:=</font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font>Flakes <font color="#FF0000"><b>do        </b></font><font color="#008000"><i>{ set up snow lookup table }
  </i></font><font color="#FF0000"><b>begin
    </b></font>x<font color="#000080">[</font>curFlake<font color="#000080">]:=</font>random<font color="#000080">(</font><font color="#800000">319</font><font color="#000080">);
    </font>y<font color="#000080">[</font>curFlake<font color="#000080">]:=</font>random<font color="#000080">(</font><font color="#800000">199</font><font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font>vidMode<font color="#000080">(</font><font color="#800000">$13</font><font color="#000080">);                       </font><font color="#008000"><i>{ 320x200x256 graphics mode }

  </i></font>i <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">; </font><font color="#008000"><i>{ change to 100 or higher to get rid of start explosion }

  </i></font><font color="#FF0000"><b>repeat
    </b></font>inc<font color="#000080">(</font>i<font color="#000080">);

    </font><font color="#FF0000"><b>for </b></font>curFlake<font color="#000080">:=</font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font>Flakes <font color="#FF0000"><b>do
      begin
        </b></font>setPixel<font color="#000080">(</font>newPos<font color="#000080">[</font>curFlake<font color="#000080">], </font><font color="#800000">0</font><font color="#000080">);     </font><font color="#008000"><i>{ erase old snowflake }
        </i></font>newPos<font color="#000080">[</font>curFlake<font color="#000080">] :=      </font><font color="#008000"><i>{ set up and draw new snowflake }
          </i></font>round<font color="#000080">(</font>x<font color="#000080">[</font>curFlake<font color="#000080">]*(</font>i<font color="#000080">*</font><font color="#800000">0.01</font><font color="#000080">)) +                  </font><font color="#008000"><i>{ new X }
          </i></font>round<font color="#000080">(</font>y<font color="#000080">[</font>curFlake<font color="#000080">]*(</font>i<font color="#000080">*</font><font color="#800000">0.01</font><font color="#000080">)) * </font><font color="#800000">320</font><font color="#000080">;             </font><font color="#008000"><i>{ new Y }
        </i></font>setPixel<font color="#000080">(</font>newPos<font color="#000080">[</font>curFlake<font color="#000080">], (</font>curFlake <font color="#FF0000"><b>mod </b></font><font color="#800000">13</font><font color="#000080">) + </font><font color="#800000">19</font><font color="#000080">);
      </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

    </font><font color="#FF0000"><b>while </b></font><font color="#000080">(</font>port<font color="#000080">[</font><font color="#800000">$3da</font><font color="#000080">] </font><font color="#FF0000"><b>and </b></font><font color="#800000">$08</font><font color="#000080">) = </font><font color="#800000">$08 </font><font color="#FF0000"><b>do</b></font><font color="#000080">;  </font><font color="#008000"><i>{ wait for vRetrace to }
    </i></font><font color="#FF0000"><b>while </b></font><font color="#000080">(</font>port<font color="#000080">[</font><font color="#800000">$3da</font><font color="#000080">] </font><font color="#FF0000"><b>and </b></font><font color="#800000">$08</font><font color="#000080">) = </font><font color="#800000">$00 </font><font color="#FF0000"><b>do</b></font><font color="#000080">;  </font><font color="#008000"><i>{ start and end        }
  </i></font><font color="#FF0000"><b>until </b></font>keypressed<font color="#000080">;

  </font>vidMode<font color="#000080">(</font><font color="#800000">$03</font><font color="#000080">);                       </font><font color="#008000"><i>{ return to 80x25 textmode }
</i></font><font color="#FF0000"><b>end</b></font><font color="#000080">.

</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to EGAVGA SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0124.PAS">Original</a><b>]</b></p></body>
</html>
