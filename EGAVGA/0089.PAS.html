<html>
<head><title> "Reding VGA Palettes" by COLIN BUCKLEY</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to EGAVGA SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0089.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
&gt;thanks for the example -- do you have any idea how to read the whole
&gt;palette at one time, etc?

Here you go...  It will work on all computers.  I do not use the 286
string instructions, as they go too fast for some VL-Bus video cards causing
incorrect colours.  The first part waits for a full vertical retrace
before changing the colours to prevent &quot;snow&quot; at the top of the display on
slower computers.  The only time you'll see the snow is if you continuously
get or set the palette such as in a screen fade.
}

</i></font><font color="#FF0000"><b>Procedure </b></font>VGAGetPalette<font color="#000080">(</font>Pal<font color="#000080">:</font>Pointer<font color="#000080">); </font><font color="#FF0000"><b>Assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Asm
  </b></font><font color="#008000"><i>{ Wait for Vertical Retrace }
  </i></font><font color="#FF00FF">MOV   DX,3DAh
@@WaitNotVSync:
  IN    AL,DX
(91 min left), (H)elp, More?   AND   AL,00001000b
  JNZ   @@WaitNotVSync
@@WaitVSync:
  IN    AL,DX
  AND   AL,00001000b
  JZ    @@WaitVSync

  LES   DI,[Pal]                    </font><font color="#008000"><i>{;ES:DI:=Palette Pointer           }
  </i></font><font color="#FF00FF">XOR   AX,AX                       </font><font color="#008000"><i>{;Start with DAC 0                 }
  </i></font><font color="#FF00FF">MOV   CX,256                      </font><font color="#008000"><i>{;End with DAC 255                 }
  </i></font><font color="#FF00FF">MOV   DX,3C7h                     </font><font color="#008000"><i>{; |Send Starting DAC register     }
  </i></font><font color="#FF00FF">OUT   DX,AL                       </font><font color="#008000"><i>{;/                                }
  </i></font><font color="#FF00FF">INC   DX                          </font><font color="#008000"><i>{; |DX:=DAC Data register          }
  </i></font><font color="#FF00FF">INC   DX                          </font><font color="#008000"><i>{;/                                }
  </i></font><font color="#FF00FF">CLD
@@DACLoop:
  IN    AL,DX                       </font><font color="#008000"><i>{;Read Red Byte                    }
  </i></font><font color="#FF00FF">STOSB                             </font><font color="#008000"><i>{;Store Red Byte                   }
  </i></font><font color="#FF00FF">IN    AL,DX                       </font><font color="#008000"><i>{;Read Green Byte                  }
  </i></font><font color="#FF00FF">STOSB                             </font><font color="#008000"><i>{;Store Green Byte                 }
  </i></font><font color="#FF00FF">IN    AL,DX                       </font><font color="#008000"><i>{;Read Blue Byte                   }
  </i></font><font color="#FF00FF">STOSB                             </font><font color="#008000"><i>{;Store Blue Byte                  }
  </i></font><font color="#FF00FF">LOOP  @@DACLoop                   </font><font color="#008000"><i>{;Loop until CX=0                  }
</i></font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to EGAVGA SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0089.PAS">Original</a><b>]</b></p></body>
</html>
