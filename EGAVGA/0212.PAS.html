<html>
<head><title> "Morphing!" by NIK DRONET</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to EGAVGA SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0212.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>(*
&gt; Could anyone explain how morphing works? I think i don't need
&gt; the source code, but somekind of formula would be nice :)

I just finished writing Morph! (I'm taking a Graphics Class). It's simpler
than I thought (but still complicated)
Morphing = Reverse Warping + Cross Disolve

Cross dissolving: fading an image to another image.

frame1   frame2   frame3  ...  frame10 image1   100%      90%      80%
0% image2     0%      10%      20%        100%

Warping: Distorting an image. To explain: a line exists on a source image, if
that line is pulled, then the pixels around it get pulled also -- like &quot;Silly
Puddy.&quot;
Now imagine a source image with lots of lines and a dest with lots of lines.
The lines must gradually move from on position to the other. For example in 8
steps (or frames). A WARP of the source image is performed from the
source_lines to the moved_lines, then a WARP on the destination image is
performed from the destination_lines to the SAME moved_lines. This produces
two distorted images. The source is distorted a lottle, the destination is
distorted a lot. For each frame Warps are calculated. Now the only thing left
is to fade.  Assume these 20 images are saved as source.002 ... source.009
and dest.002 ... dest.009
The source and dest images are named out.000 and out.010

Now each pixel color in source.001 is multplied by 90%, and dest.001 by 10%.
Each pixel of the two images are added tegether to produce out.001 This is
done for each frame (percentages as in above cross dissolve def.)

Now if you display out.000 through out.011 fast enough, it &quot;Morphs&quot;
{----------} The following program Warps an F; However it's SLOW , because it
uses REALs. Floating point math is awfully slow, and I have a lot of procedure
calls in this version.  I suggest a 486. EGA or + suggested.  My Full morph
that Morphs One image into another does it in 10 frames, it took over 48 hours
on a 486sx25.  This Warp example should be abouts 5 minutes on a 486sx25... 1
hour on an 8088.
This example Puts an 'F' on the screen and warps it.  you may change the P &amp; Q
values.  I appologize for tremendous lack of comments. I'll insert A few
before I add it to this message..... There that may help.
*)
</i></font><font color="#FF0000"><b>program </b></font>morph_example<font color="#000080">;
</font><font color="#FF0000"><b>uses </b></font>graph<font color="#000080">, </font>crt<font color="#000080">; </font><font color="#FF0000"><b>const  </b></font>MAXX       <font color="#000080">=</font><font color="#800000">199</font><font color="#000080">;
  </font>MAXY       <font color="#000080">=</font><font color="#800000">199</font><font color="#000080">;
  </font>MaxLines   <font color="#000080">=</font><font color="#800000">2</font><font color="#000080">;
  </font>Lines      <font color="#000080">=</font><font color="#800000">2</font><font color="#000080">;
  </font>little_p   <font color="#000080">=</font><font color="#800000">0.5</font><font color="#000080">;
  </font>little_a   <font color="#000080">=</font><font color="#800000">0.001</font><font color="#000080">;
  </font>little_b   <font color="#000080">=</font><font color="#800000">2</font><font color="#000080">;
</font><font color="#FF0000"><b>type
  </b></font>vector_type <font color="#000080">= </font><font color="#FF0000"><b>record  </b></font><font color="#008000"><i>{for this prog a vector is simply an x,y coord}
                  </i></font>x<font color="#000080">, </font>y <font color="#000080">: </font>real<font color="#000080">;
                </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font>Vector_Array_Type <font color="#000080">= </font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font>maxlines<font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Vector_Type<font color="#000080">;
  </font>f_type <font color="#000080">= </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">10</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>PointType<font color="#000080">;  </font><font color="#008000"><i>{THIS IS TO DRAW THE LETTER 'F'} </i></font><font color="#FF0000"><b>var
  </b></font>graph_driver<font color="#000080">, </font>graph_mode<font color="#000080">, </font>error_code <font color="#000080">: </font>integer<font color="#000080">;
  </font>f <font color="#000080">: </font>f_type<font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>set_f<font color="#000080">(</font><font color="#FF0000"><b>var </b></font>f <font color="#000080">: </font>f_type<font color="#000080">); </font><font color="#008000"><i>{THIS IS TO DRAW THE LETTER 'F'} </i></font><font color="#FF0000"><b>var
 </b></font>i <font color="#000080">: </font>integer<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>f<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">].</font>x <font color="#000080">:= </font><font color="#800000">30</font><font color="#000080">;
  </font>f<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">].</font>y <font color="#000080">:= </font><font color="#800000">20</font><font color="#000080">;
  </font>f<font color="#000080">[</font><font color="#800000">2</font><font color="#000080">].</font>x <font color="#000080">:= </font><font color="#800000">30</font><font color="#000080">;
  </font>f<font color="#000080">[</font><font color="#800000">2</font><font color="#000080">].</font>y <font color="#000080">:= </font><font color="#800000">80</font><font color="#000080">;
  </font>f<font color="#000080">[</font><font color="#800000">3</font><font color="#000080">].</font>x <font color="#000080">:= </font><font color="#800000">70</font><font color="#000080">;
  </font>f<font color="#000080">[</font><font color="#800000">3</font><font color="#000080">].</font>y <font color="#000080">:= </font><font color="#800000">80</font><font color="#000080">;
  </font>f<font color="#000080">[</font><font color="#800000">4</font><font color="#000080">].</font>x <font color="#000080">:= </font><font color="#800000">70</font><font color="#000080">;
  </font>f<font color="#000080">[</font><font color="#800000">4</font><font color="#000080">].</font>y <font color="#000080">:= </font><font color="#800000">70</font><font color="#000080">;
  </font>f<font color="#000080">[</font><font color="#800000">5</font><font color="#000080">].</font>x <font color="#000080">:= </font><font color="#800000">40</font><font color="#000080">;
  </font>f<font color="#000080">[</font><font color="#800000">5</font><font color="#000080">].</font>y <font color="#000080">:= </font><font color="#800000">70</font><font color="#000080">;
  </font>f<font color="#000080">[</font><font color="#800000">6</font><font color="#000080">].</font>x <font color="#000080">:= </font><font color="#800000">40</font><font color="#000080">;
  </font>f<font color="#000080">[</font><font color="#800000">6</font><font color="#000080">].</font>y <font color="#000080">:= </font><font color="#800000">60</font><font color="#000080">;
  </font>f<font color="#000080">[</font><font color="#800000">7</font><font color="#000080">].</font>x <font color="#000080">:= </font><font color="#800000">60</font><font color="#000080">;
  </font>f<font color="#000080">[</font><font color="#800000">7</font><font color="#000080">].</font>y <font color="#000080">:= </font><font color="#800000">60</font><font color="#000080">;
  </font>f<font color="#000080">[</font><font color="#800000">8</font><font color="#000080">].</font>x <font color="#000080">:= </font><font color="#800000">60</font><font color="#000080">;
  </font>f<font color="#000080">[</font><font color="#800000">8</font><font color="#000080">].</font>y <font color="#000080">:= </font><font color="#800000">50</font><font color="#000080">;
  </font>f<font color="#000080">[</font><font color="#800000">9</font><font color="#000080">].</font>x <font color="#000080">:= </font><font color="#800000">40</font><font color="#000080">;
  </font>f<font color="#000080">[</font><font color="#800000">9</font><font color="#000080">].</font>y <font color="#000080">:= </font><font color="#800000">50</font><font color="#000080">;
  </font>f<font color="#000080">[</font><font color="#800000">10</font><font color="#000080">].</font>x <font color="#000080">:= </font><font color="#800000">40</font><font color="#000080">;
  </font>f<font color="#000080">[</font><font color="#800000">10</font><font color="#000080">].</font>y <font color="#000080">:= </font><font color="#800000">20</font><font color="#000080">;
  </font><font color="#FF0000"><b>for </b></font>i <font color="#000080">:= </font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font><font color="#800000">10 </font><font color="#FF0000"><b>do
    begin
      </b></font>f<font color="#000080">[</font>i<font color="#000080">].</font>y <font color="#000080">:= </font><font color="#800000">150 </font><font color="#000080">- </font>f<font color="#000080">[</font>i<font color="#000080">].</font>y<font color="#000080">;
      </font>f<font color="#000080">[</font>i<font color="#000080">].</font>x <font color="#000080">:= </font>f<font color="#000080">[</font>i<font color="#000080">].</font>x <font color="#000080">+ </font><font color="#800000">40</font><font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>initialize<font color="#000080">;</font><font color="#008000"><i>{THIS IS TO DRAW THE LETTER 'F' IN A GRID} </i></font><font color="#FF0000"><b>var
  </b></font>x<font color="#000080">, </font>y <font color="#000080">: </font>integer<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>x <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font>y <font color="#000080">:= </font><font color="#800000">0</font><font color="#000080">;
  </font>SetColor<font color="#000080">(</font>blue<font color="#000080">);
  </font><font color="#FF0000"><b>while </b></font>x <font color="#000080">&lt; </font>MAXX <font color="#FF0000"><b>do
    begin
      </b></font>Line<font color="#000080">(</font>x<font color="#000080">, </font><font color="#800000">0</font><font color="#000080">, </font>x<font color="#000080">, </font>MAXY <font color="#000080">- </font><font color="#800000">10</font><font color="#000080">);
      </font>x <font color="#000080">:= </font>x <font color="#000080">+ </font><font color="#800000">10</font><font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>while </b></font>y <font color="#000080">&lt; </font>MAXY <font color="#FF0000"><b>do
    begin
      </b></font>Line<font color="#000080">(</font><font color="#800000">0</font><font color="#000080">, </font>y<font color="#000080">, </font>MAXX <font color="#000080">- </font><font color="#800000">10</font><font color="#000080">, </font>y<font color="#000080">);
      </font>y <font color="#000080">:= </font>y <font color="#000080">+ </font><font color="#800000">10</font><font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>SetFillStyle<font color="#000080">(</font>SolidFill<font color="#000080">, </font>white<font color="#000080">);
  </font>FillPoly<font color="#000080">(</font><font color="#800000">10</font><font color="#000080">, </font>f<font color="#000080">);</font><font color="#008000"><i>{THIS IS TO DRAW THE LETTER 'F'} </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{--------------------------------------------------------} </i></font><font color="#FF0000"><b>Procedure
</b></font>VectorAdd<font color="#000080">(</font>A<font color="#000080">,</font>B<font color="#000080">:</font>Vector_Type<font color="#000080">;</font><font color="#FF0000"><b>Var </b></font>C<font color="#000080">:</font>Vector_Type<font color="#000080">); </font><font color="#FF0000"><b>Begin   </b></font>C<font color="#000080">.</font>x<font color="#000080">:=</font>A<font color="#000080">.</font>x<font color="#000080">+</font>B<font color="#000080">.</font>x<font color="#000080">;
   </font>C<font color="#000080">.</font>y<font color="#000080">:=</font>A<font color="#000080">.</font>y<font color="#000080">+</font>B<font color="#000080">.</font>y<font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;
</font><font color="#008000"><i>{--------------------------------------------------------} </i></font><font color="#FF0000"><b>Procedure
</b></font>VectorSubtract<font color="#000080">(</font>A<font color="#000080">,</font>B<font color="#000080">:</font>Vector_Type<font color="#000080">; </font><font color="#FF0000"><b>Var </b></font>C<font color="#000080">:</font>Vector_Type<font color="#000080">); </font><font color="#FF0000"><b>Begin   </b></font>C<font color="#000080">.</font>x<font color="#000080">:=</font>A<font color="#000080">.</font>x<font color="#000080">-</font>B<font color="#000080">.</font>x<font color="#000080">;
   </font>C<font color="#000080">.</font>y<font color="#000080">:=</font>A<font color="#000080">.</font>y<font color="#000080">-</font>B<font color="#000080">.</font>y<font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;
</font><font color="#008000"><i>{--------------------------------------------------------} </i></font><font color="#FF0000"><b>Procedure
</b></font>ScaleMult<font color="#000080">(</font>A<font color="#000080">:</font>Vector_Type<font color="#000080">; </font>S<font color="#000080">:</font>Real<font color="#000080">; </font><font color="#FF0000"><b>Var </b></font>C<font color="#000080">:</font>Vector_Type<font color="#000080">); </font><font color="#FF0000"><b>Begin
   </b></font>C<font color="#000080">.</font>x<font color="#000080">:=</font>A<font color="#000080">.</font>x<font color="#000080">*</font>s<font color="#000080">;
   </font>C<font color="#000080">.</font>y<font color="#000080">:=</font>A<font color="#000080">.</font>y<font color="#000080">*</font>s<font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;
</font><font color="#008000"><i>{--------------------------------------------------------} </i></font><font color="#FF0000"><b>Procedure
</b></font>ScaleDiv<font color="#000080">(</font>A<font color="#000080">:</font>Vector_Type<font color="#000080">; </font>S<font color="#000080">:</font>Real<font color="#000080">; </font><font color="#FF0000"><b>Var </b></font>C<font color="#000080">:</font>Vector_Type<font color="#000080">); </font><font color="#FF0000"><b>Begin   </b></font>C<font color="#000080">.</font>x<font color="#000080">:=</font>A<font color="#000080">.</font>x<font color="#000080">/</font>s<font color="#000080">;
   </font>C<font color="#000080">.</font>y<font color="#000080">:=</font>A<font color="#000080">.</font>y<font color="#000080">/</font>s<font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;
</font><font color="#008000"><i>{--------------------------------------------------------} </i></font><font color="#FF0000"><b>Procedure
</b></font>ScaleAdd<font color="#000080">(</font>A<font color="#000080">:</font>Vector_Type<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>S<font color="#000080">:</font>Real<font color="#000080">; </font><font color="#FF0000"><b>Var </b></font>C<font color="#000080">:</font>Vector_Type<font color="#000080">); </font><font color="#FF0000"><b>Begin
   </b></font>C<font color="#000080">.</font>x<font color="#000080">:=</font>A<font color="#000080">.</font>x<font color="#000080">+</font>s<font color="#000080">;
   </font>C<font color="#000080">.</font>y<font color="#000080">:=</font>A<font color="#000080">.</font>y<font color="#000080">+</font>s<font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;
</font><font color="#008000"><i>{--------------------------------------------------------} </i></font><font color="#FF0000"><b>Procedure
</b></font>Perpendicular<font color="#000080">(</font>A<font color="#000080">:</font>Vector_Type<font color="#000080">; </font><font color="#FF0000"><b>Var </b></font>C<font color="#000080">:</font>Vector_Type<font color="#000080">); </font><font color="#FF0000"><b>Begin   </b></font>C<font color="#000080">.</font>x<font color="#000080">:=-</font>A<font color="#000080">.</font>y<font color="#000080">;
   </font>C<font color="#000080">.</font>y<font color="#000080">:=</font>A<font color="#000080">.</font>x<font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;
</font><font color="#008000"><i>{--------------------------------------------------------} </i></font><font color="#FF0000"><b>Function
</b></font>DotProduct<font color="#000080">(</font>A<font color="#000080">,</font>B<font color="#000080">:</font>Vector_Type<font color="#000080">):</font>Real<font color="#000080">; </font><font color="#FF0000"><b>Begin   </b></font>DotProduct<font color="#000080">:=(</font>A<font color="#000080">.</font>x<font color="#000080">*</font>B<font color="#000080">.</font>x<font color="#000080">)+(</font>A<font color="#000080">.</font>y<font color="#000080">*</font>B<font color="#000080">.</font>y<font color="#000080">);
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;
</font><font color="#008000"><i>{--------------------------------------------------------} </i></font><font color="#FF0000"><b>Function
</b></font>Power<font color="#000080">(</font>a<font color="#000080">,</font>b<font color="#000080">:</font>real<font color="#000080">):</font>Real<font color="#000080">; </font><font color="#FF0000"><b>Begin   if </b></font>a<font color="#000080">=</font><font color="#800000">0 </font><font color="#FF0000"><b>then </b></font>power<font color="#000080">:=</font><font color="#800000">0
   </font><font color="#FF0000"><b>else </b></font>Power<font color="#000080">:=</font>exp<font color="#000080">(</font>ln<font color="#000080">(</font>a<font color="#000080">)*</font>b<font color="#000080">);
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;
</font><font color="#008000"><i>{--------------------------------------------------------} </i></font><font color="#FF0000"><b>Function
</b></font>Magnitude<font color="#000080">(</font>A<font color="#000080">:</font>Vector_Type<font color="#000080">):</font>Real<font color="#000080">; </font><font color="#FF0000"><b>Begin   </b></font>Magnitude<font color="#000080">:=</font>Sqrt<font color="#000080">((</font>A<font color="#000080">.</font>x<font color="#000080">*</font>A<font color="#000080">.</font>x<font color="#000080">)+(</font>A<font color="#000080">.</font>y<font color="#000080">*</font>A<font color="#000080">.</font>y<font color="#000080">));
</font><font color="#FF0000"><b>End</b></font><font color="#000080">; </font><font color="#008000"><i>{--------------------------------------------------------} </i></font><font color="#FF0000"><b>Function
</b></font>LineLength<font color="#000080">(</font>A<font color="#000080">,</font>B<font color="#000080">:</font>Vector_Type<font color="#000080">):</font>Real<font color="#000080">; </font><font color="#FF0000"><b>Begin
</b></font>LineLength<font color="#000080">:=</font>Sqrt<font color="#000080">((</font>power<font color="#000080">(</font>abs<font color="#000080">(</font>b<font color="#000080">.</font>x<font color="#000080">-</font>a<font color="#000080">.</font>x<font color="#000080">),</font><font color="#800000">2</font><font color="#000080">))+(</font>Power<font color="#000080">(</font>abs<font color="#000080">(</font>b<font color="#000080">.</font>y<font color="#000080">-</font>a<font color="#000080">.</font>y<font color="#000080">),</font><font color="#800000">2</font><font color="#000080">))); </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
</font><font color="#008000"><i>{--------------------------------------------------------} </i></font><font color="#FF0000"><b>Function
</b></font>MagnitudeSqr<font color="#000080">(</font>A<font color="#000080">:</font>Vector_Type<font color="#000080">):</font>Real<font color="#000080">; </font><font color="#FF0000"><b>var </b></font>result<font color="#000080">:</font>real<font color="#000080">; </font><font color="#FF0000"><b>Begin
</b></font>MagnitudeSqr<font color="#000080">:=(</font>A<font color="#000080">.</font>x<font color="#000080">*</font>A<font color="#000080">.</font>x<font color="#000080">)+(</font>A<font color="#000080">.</font>y<font color="#000080">*</font>A<font color="#000080">.</font>y<font color="#000080">);</font><font color="#FF0000"><b>End</b></font><font color="#000080">;
</font><font color="#008000"><i>{--------------------------------------------------------} </i></font><font color="#FF0000"><b>Function
</b></font>Distance<font color="#000080">(</font>A<font color="#000080">,</font>B<font color="#000080">:</font>Vector_Type<font color="#000080">):</font>Real<font color="#000080">; </font><font color="#FF0000"><b>Begin
</b></font>Distance<font color="#000080">:=</font>Sqrt<font color="#000080">((</font>power<font color="#000080">(</font>abs<font color="#000080">(</font>b<font color="#000080">.</font>x<font color="#000080">-</font>a<font color="#000080">.</font>x<font color="#000080">),</font><font color="#800000">2</font><font color="#000080">))+(</font>Power<font color="#000080">(</font>abs<font color="#000080">(</font>b<font color="#000080">.</font>y<font color="#000080">-</font>a<font color="#000080">.</font>y<font color="#000080">),</font><font color="#800000">2</font><font color="#000080">))); </font><font color="#FF0000"><b>End</b></font><font color="#000080">;
</font><font color="#008000"><i>{--------------------------------------------------------} </i></font><font color="#FF0000"><b>Function
</b></font>PointDist<font color="#000080">(</font>Pixel<font color="#000080">,</font>P<font color="#000080">,</font>Q<font color="#000080">:</font>Vector_Type<font color="#000080">; </font>u<font color="#000080">,</font>v<font color="#000080">:</font>Real<font color="#000080">):</font>Real<font color="#000080">; </font><font color="#FF0000"><b>Begin  If </b></font><font color="#000080">(</font>u<font color="#000080">&gt;</font><font color="#800000">0.0</font><font color="#000080">) </font><font color="#FF0000"><b>and </b></font><font color="#000080">(</font>u<font color="#000080">&lt;</font><font color="#800000">1.0</font><font color="#000080">)
</font><font color="#FF0000"><b>then </b></font>PointDist<font color="#000080">:=</font>Abs<font color="#000080">(</font>v<font color="#000080">)  </font><font color="#FF0000"><b>else if </b></font><font color="#000080">(</font>u<font color="#000080">&lt;</font><font color="#800000">0.0</font><font color="#000080">) </font><font color="#FF0000"><b>then </b></font>PointDist<font color="#000080">:=</font>Distance<font color="#000080">(</font>Pixel<font color="#000080">,</font>P<font color="#000080">)
  </font><font color="#FF0000"><b>else </b></font>PointDist<font color="#000080">:=</font>Distance<font color="#000080">(</font>Pixel<font color="#000080">,</font>Q<font color="#000080">);
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;
</font><font color="#008000"><i>{--------------------------------------------------------} </i></font><font color="#FF0000"><b>Procedure
</b></font>InitVectors<font color="#000080">(</font><font color="#FF0000"><b>Var </b></font>P<font color="#000080">,</font>Q<font color="#000080">,</font>P_prime<font color="#000080">,</font>Q_prime<font color="#000080">:</font>Vector_Array_Type<font color="#000080">); </font><font color="#FF0000"><b>Begin

  </b></font><font color="#008000"><i>{P &amp; Q are vectors on the destination -- thus PQ is a line on the
destination}  {p_prime &amp; q_prime are vectors on the source -- ... a line on the
source}
{ example top horizontal line pulled up on right side} {
  q_prime[1].x := 65;
  q_prime[1].y := 70;
  p_prime[1].x := 65;
  p_prime[1].y := 130;
  q_prime[2].x := 70;
  q_prime[2].y := 65;
  p_prime[2].x := 110;
  p_prime[2].y := 65;
  q[1].x := q_prime[1].x;
  q[1].y := q_prime[1].y;
  p[1].x := p_prime[1].x;
  p[1].y := p_prime[1].y;
  q[2].x := q_prime[2].x;
  q[2].y := q_prime[2].y;
  p[2].x := p_prime[2].x;
  p[2].y := p_prime[2].y-20;
}

{ two verticle lines, then bent open at top}

  </i></font>q_prime<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">].</font>x <font color="#000080">:= </font><font color="#800000">60</font><font color="#000080">;
  </font>q_prime<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">].</font>y <font color="#000080">:= </font><font color="#800000">70</font><font color="#000080">;
  </font>p_prime<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">].</font>x <font color="#000080">:= </font><font color="#800000">60</font><font color="#000080">;
  </font>p_prime<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">].</font>y <font color="#000080">:= </font><font color="#800000">100</font><font color="#000080">;
  </font>q_prime<font color="#000080">[</font><font color="#800000">2</font><font color="#000080">].</font>x <font color="#000080">:= </font><font color="#800000">120</font><font color="#000080">;
  </font>q_prime<font color="#000080">[</font><font color="#800000">2</font><font color="#000080">].</font>y <font color="#000080">:= </font><font color="#800000">70</font><font color="#000080">;
  </font>p_prime<font color="#000080">[</font><font color="#800000">2</font><font color="#000080">].</font>x <font color="#000080">:= </font><font color="#800000">120</font><font color="#000080">;
  </font>p_prime<font color="#000080">[</font><font color="#800000">2</font><font color="#000080">].</font>y <font color="#000080">:= </font><font color="#800000">100</font><font color="#000080">;
  </font>q<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">].</font>x <font color="#000080">:= </font>q_prime<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">].</font>x<font color="#000080">-</font><font color="#800000">10</font><font color="#000080">;
  </font>q<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">].</font>y <font color="#000080">:= </font>q_prime<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">].</font>y<font color="#000080">;
  </font>p<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">].</font>x <font color="#000080">:= </font>p_prime<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">].</font>x<font color="#000080">+</font><font color="#800000">5</font><font color="#000080">;
  </font>p<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">].</font>y <font color="#000080">:= </font>p_prime<font color="#000080">[</font><font color="#800000">1</font><font color="#000080">].</font>y<font color="#000080">;
  </font>q<font color="#000080">[</font><font color="#800000">2</font><font color="#000080">].</font>x <font color="#000080">:= </font>q_prime<font color="#000080">[</font><font color="#800000">2</font><font color="#000080">].</font>x<font color="#000080">+</font><font color="#800000">10</font><font color="#000080">;
  </font>q<font color="#000080">[</font><font color="#800000">2</font><font color="#000080">].</font>y <font color="#000080">:= </font>q_prime<font color="#000080">[</font><font color="#800000">2</font><font color="#000080">].</font>y<font color="#000080">;
  </font>p<font color="#000080">[</font><font color="#800000">2</font><font color="#000080">].</font>x <font color="#000080">:= </font>p_prime<font color="#000080">[</font><font color="#800000">2</font><font color="#000080">].</font>x<font color="#000080">-</font><font color="#800000">5</font><font color="#000080">;
  </font>p<font color="#000080">[</font><font color="#800000">2</font><font color="#000080">].</font>y <font color="#000080">:= </font>p_prime<font color="#000080">[</font><font color="#800000">2</font><font color="#000080">].</font>y<font color="#000080">;


</font><font color="#008000"><i>{ another example
  q_prime[1].x := 70;
  q_prime[1].y := 20;
  p_prime[1].x := 120;
  p_prime[1].y := 20;
  q_prime[2].x := 70;
  q_prime[2].y := 180;
  p_prime[2].x := 120;
  p_prime[2].y := 180;
  q[1].x := q_prime[1].x+20;
  q[1].y := q_prime[1].y;
  p[1].x := p_prime[1].x-20;
  p[1].y := p_prime[1].y;
  q[2].x := q_prime[2].x;
  q[2].y := q_prime[2].y;
  p[2].x := p_prime[2].x;
  p[2].y := p_prime[2].y;
}
</i></font><font color="#FF0000"><b>End</b></font><font color="#000080">;

</font><font color="#008000"><i>{==================================================================} </i></font><font color="#FF0000"><b>procedure
</b></font>WARP<font color="#000080">;
</font><font color="#FF0000"><b>CONST
  </b></font>Xoffset<font color="#000080">=</font><font color="#800000">300</font><font color="#000080">;
  </font>StrColor<font color="#000080">=</font>yellow<font color="#000080">;

</font><font color="#FF0000"><b>var
  </b></font>x<font color="#000080">, </font>y<font color="#000080">, </font>i<font color="#000080">, </font>ii <font color="#000080">: </font>integer<font color="#000080">;
  </font>u<font color="#000080">, </font>v <font color="#000080">: </font>real<font color="#000080">;

  </font><font color="#008000"><i>{P &amp; Q are vectors on the destination -- thus PQ is a line on the
destination}  {p_prime &amp; q_prime are vectors on the source -- ... a line on the
source}  </i></font>p<font color="#000080">, </font>p_prime<font color="#000080">, </font>q<font color="#000080">, </font>q_prime<font color="#000080">: </font>Vector_Array_Type<font color="#000080">;

  </font>X_Prime<font color="#000080">,
  </font>Pixel<font color="#000080">,</font>q_minus_p<font color="#000080">, </font>pixel_minus_p<font color="#000080">, </font>per_q_minus_p<font color="#000080">, </font>q_prime_minus_p_prime<font color="#000080">,
  </font>per_q_prime_minus_p_prime <font color="#000080">: </font>vector_type<font color="#000080">;

  </font>D<font color="#000080">,</font>DSum<font color="#000080">:</font>Vector_Type<font color="#000080">;   </font><font color="#008000"><i>{This stuff is to weigh the lines}
  </i></font>SD<font color="#000080">,</font>SM<font color="#000080">:</font>Vector_Type<font color="#000080">;   </font><font color="#008000"><i>{temp vars}

  </i></font>str_out<font color="#000080">, </font>str_out2 <font color="#000080">: </font><font color="#FF0000"><b>string</b></font><font color="#000080">;

  </font>mt1<font color="#000080">,</font>mt2<font color="#000080">,</font>mt3<font color="#000080">,</font>mt4<font color="#000080">:</font>vector_type<font color="#000080">; </font><font color="#008000"><i>{temp vars}
  </i></font>WeightSum<font color="#000080">,</font>Weight<font color="#000080">,</font>Dist<font color="#000080">,</font>Length<font color="#000080">:</font>Real<font color="#000080">;  </font><font color="#008000"><i>{to weigh lines}

</i></font><font color="#FF0000"><b>begin
  </b></font>InitVectors<font color="#000080">(</font>P<font color="#000080">,</font>Q<font color="#000080">,</font>P_prime<font color="#000080">,</font>Q_prime<font color="#000080">);</font><font color="#008000"><i>{ init the source &amp; destination &quot;lines&quot;}

  </i></font><font color="#FF0000"><b>for </b></font>x <font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font>MAXX <font color="#FF0000"><b>do       </b></font><font color="#008000"><i>{for every pixel do}
    </i></font><font color="#FF0000"><b>begin
    for </b></font>y <font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font>MAXY <font color="#FF0000"><b>do
      begin
        </b></font>pixel<font color="#000080">.</font>x <font color="#000080">:= </font>x<font color="#000080">;
        </font>pixel<font color="#000080">.</font>y <font color="#000080">:= </font>y<font color="#000080">;

        </font><font color="#008000"><i>{calculate X_PRIME point }
        </i></font>DSUM<font color="#000080">.</font>x<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
        </font>DSUM<font color="#000080">.</font>y<font color="#000080">:=</font><font color="#800000">0</font><font color="#000080">;
        </font>WeightSum<font color="#000080">:=</font><font color="#800000">0.0</font><font color="#000080">;

 </font><font color="#008000"><i>{**} </i></font><font color="#FF0000"><b>For </b></font>i<font color="#000080">:=</font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>Lines <font color="#FF0000"><b>do Begin
        </b></font>setcolor<font color="#000080">(</font>StrColor<font color="#000080">);
        </font>line<font color="#000080">(</font>round<font color="#000080">(</font>p_prime<font color="#000080">[</font>i<font color="#000080">].</font>x<font color="#000080">),</font>round<font color="#000080">(</font>p_prime<font color="#000080">[</font>i<font color="#000080">].</font>y<font color="#000080">),
             </font>round<font color="#000080">(</font>q_prime<font color="#000080">[</font>i<font color="#000080">].</font>x<font color="#000080">),</font>round<font color="#000080">(</font>q_prime<font color="#000080">[</font>i<font color="#000080">].</font>y<font color="#000080">));

        </font>line<font color="#000080">(</font>round<font color="#000080">(</font>p<font color="#000080">[</font>i<font color="#000080">].</font>x<font color="#000080">+</font>Xoffset<font color="#000080">),</font>round<font color="#000080">(</font>p<font color="#000080">[</font>i<font color="#000080">].</font>y<font color="#000080">),
             </font>round<font color="#000080">(</font>q<font color="#000080">[</font>i<font color="#000080">].</font>x<font color="#000080">+</font>Xoffset<font color="#000080">),</font>round<font color="#000080">(</font>q<font color="#000080">[</font>i<font color="#000080">].</font>y<font color="#000080">));

</font><font color="#008000"><i>{ FORMULAS: X' is pixel of source.   X is current pixel being calc'd
            P &amp; Q are destination points(current)     P' &amp; Q' are source
points.            remember if P and Q are points, then PQ is a line

         (X-P)(Q-P)                      (X-P)Perpindicular(Q-P)
  u =  ---------------               v =  ------------------------
       (magnitude(Q-P))^2                     magnitude(QP)


                           v  Perpindicular(Q'-P')
  X' = P' + u  (Q'-P') + ---------------------------
                               Magnitude(Q'-P')

}

        </i></font>VectorSubtract<font color="#000080">(</font>pixel<font color="#000080">,</font>P<font color="#000080">[</font>i<font color="#000080">],</font>Pixel_minus_P<font color="#000080">);
        </font>VectorSubtract<font color="#000080">(</font>Q<font color="#000080">[</font>i<font color="#000080">],</font>P<font color="#000080">[</font>i<font color="#000080">],</font>Q_minus_P<font color="#000080">);

        </font>u<font color="#000080">:=</font>DotProduct<font color="#000080">(</font>Pixel_minus_P<font color="#000080">,</font>Q_minus_P<font color="#000080">)/
           </font>MagnitudeSqr<font color="#000080">(</font>Q_minus_P<font color="#000080">);

        </font>Perpendicular<font color="#000080">(</font>Q_minus_P<font color="#000080">,</font>Per_Q_minus_P<font color="#000080">);
        </font>VectorSubtract<font color="#000080">(</font>Q_prime<font color="#000080">[</font>i<font color="#000080">],</font>P_prime<font color="#000080">[</font>i<font color="#000080">],</font>Q_prime_minus_P_prime<font color="#000080">);
        </font>v<font color="#000080">:=</font>DotProduct<font color="#000080">(</font>Pixel_minus_P<font color="#000080">,</font>Per_Q_minus_P<font color="#000080">)/
           </font>magnitude<font color="#000080">(</font>Q_minus_P<font color="#000080">);

        </font>Perpendicular<font color="#000080">(</font>Q_prime_minus_P_prime<font color="#000080">,</font>Per_Q_prime_minus_P_prime<font color="#000080">);
        </font>ScaleMult<font color="#000080">(</font>Per_Q_prime_minus_P_prime<font color="#000080">,</font>v<font color="#000080">,</font>mt1<font color="#000080">);
        </font>ScaleDiv<font color="#000080">(</font>mt1<font color="#000080">,</font>magnitude<font color="#000080">(</font>Q_prime_minus_P_prime<font color="#000080">),</font>mt2<font color="#000080">);
        </font>ScaleMult<font color="#000080">(</font>Q_prime_minus_P_prime<font color="#000080">,</font>u<font color="#000080">,</font>mt3<font color="#000080">);
        </font>VectorAdd<font color="#000080">(</font>P_prime<font color="#000080">[</font>i<font color="#000080">],</font>mt3<font color="#000080">,</font>mt4<font color="#000080">);
        </font>VectorAdd<font color="#000080">(</font>mt4<font color="#000080">,</font>mt2<font color="#000080">,</font>x_prime<font color="#000080">);

        </font>VectorSubtract<font color="#000080">(</font>X_Prime<font color="#000080">,</font>Pixel<font color="#000080">,</font>D<font color="#000080">);
        </font>dist<font color="#000080">:=</font>PointDist<font color="#000080">(</font>Pixel<font color="#000080">,</font>P<font color="#000080">[</font>i<font color="#000080">],</font>Q<font color="#000080">[</font>i<font color="#000080">],</font>u<font color="#000080">,</font>v<font color="#000080">);

        </font>Weight<font color="#000080">:=</font>power<font color="#000080">(
           </font>power<font color="#000080">(</font>LineLength<font color="#000080">(</font>P<font color="#000080">[</font>i<font color="#000080">],</font>Q<font color="#000080">[</font>i<font color="#000080">]),</font>little_p<font color="#000080">)/(</font>little_a<font color="#000080">+</font>dist<font color="#000080">),
           </font>little_b<font color="#000080">);

        </font>ScaleMult<font color="#000080">(</font>D<font color="#000080">,</font>Weight<font color="#000080">,</font>SM<font color="#000080">);
        </font>VectorAdd<font color="#000080">(</font>DSUM<font color="#000080">,</font>SM<font color="#000080">,</font>DSUM<font color="#000080">);
        </font>WeightSum<font color="#000080">:=</font>WeightSum<font color="#000080">+</font>Weight<font color="#000080">;
 </font><font color="#008000"><i>{**} </i></font><font color="#FF0000"><b>End</b></font><font color="#000080">;
        </font>ScaleDiv<font color="#000080">(</font>DSUM<font color="#000080">,</font>WeightSum<font color="#000080">,</font>SD<font color="#000080">);
        </font>VectorAdd<font color="#000080">(</font>Pixel<font color="#000080">,</font>SD<font color="#000080">,</font>X_Prime<font color="#000080">);

        </font>putpixel<font color="#000080">(</font>x<font color="#000080">+</font>Xoffset<font color="#000080">, </font>y<font color="#000080">, </font>getpixel<font color="#000080">(</font>round<font color="#000080">(</font>x_prime<font color="#000080">.</font>x<font color="#000080">), </font>round<font color="#000080">(</font>x_prime<font color="#000080">.</font>y<font color="#000080">)));
</font><font color="#008000"><i>{        screen[x, y] := getpixel(round(x_prime.x), round(x_prime.y));
        putpixel(x+Xoffset, y, screen[x, y]);
}    </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{ALL THOSE PROCEDURE CALLS AND TEMP VARs SLOW IT DOWN}

    </i></font>setcolor<font color="#000080">(</font>black<font color="#000080">);
    </font>str<font color="#000080">(</font>x<font color="#000080">-</font><font color="#800000">1</font><font color="#000080">, </font>str_out<font color="#000080">);
    </font>str_out <font color="#000080">:= </font><font color="#800000">'x= ' </font><font color="#000080">+ </font>str_out<font color="#000080">;
    </font>OutTextXY<font color="#000080">(</font><font color="#800000">250</font><font color="#000080">, </font><font color="#800000">100</font><font color="#000080">, </font>str_out<font color="#000080">);

    </font>setcolor<font color="#000080">(</font>StrColor<font color="#000080">);
    </font>str<font color="#000080">(</font>x<font color="#000080">, </font>str_out<font color="#000080">);
    </font>str_out <font color="#000080">:= </font><font color="#800000">'x= ' </font><font color="#000080">+ </font>str_out<font color="#000080">;
    </font>OutTextXY<font color="#000080">(</font><font color="#800000">250</font><font color="#000080">, </font><font color="#800000">100</font><font color="#000080">, </font>str_out<font color="#000080">);

</font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#008000"><i>{==================================================================} </i></font><font color="#FF0000"><b>begin
  </b></font>graph_driver <font color="#000080">:= </font>Detect<font color="#000080">;
  </font>InitGraph<font color="#000080">(</font>graph_driver<font color="#000080">, </font>graph_mode<font color="#000080">, </font><font color="#800000">'e:\bp\bgi'</font><font color="#000080">); </font><font color="#008000"><i>{CHANGE TO YOUR DIR}
  </i></font>error_code <font color="#000080">:= </font>GraphResult<font color="#000080">;
  </font><font color="#FF0000"><b>if </b></font>error_code <font color="#000080">&lt;&gt; </font>GrOK <font color="#FF0000"><b>then
    begin
      </b></font>writeln<font color="#000080">(</font><font color="#800000">'Error Graphic Driver not found'</font><font color="#000080">);
      </font>writeln<font color="#000080">(</font><font color="#800000">'Error('</font><font color="#000080">, </font>error_code<font color="#000080">, </font><font color="#800000">')'</font><font color="#000080">);
      </font>exit<font color="#000080">;
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>set_f<font color="#000080">(</font>f<font color="#000080">);
  </font>initialize<font color="#000080">;
  </font>WARP<font color="#000080">;
  </font>readln<font color="#000080">;
  </font>closegraph<font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">.


</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to EGAVGA SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0212.PAS">Original</a><b>]</b></p></body>
</html>
