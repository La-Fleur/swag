<html>
<head><title> "Starfield" by SCOTT STONE</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to EGAVGA SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0188.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code>
<font color="#008000"><i>{ Updated EGAVGA.SWG on May 26, 1995 }

{
From: Scott Stone &lt;Scott.Stone@m.cc.utah.edu&gt;

Ok, here's that 3-D starfield code that I promised.  (it works)
}

</i></font><font color="#FF0000"><b>Program </b></font>Starfield_3D<font color="#000080">;
</font><font color="#FF0000"><b>Uses </b></font>dos<font color="#000080">,</font>crt<font color="#000080">;
</font><font color="#FF0000"><b>Const
  </b></font>NumStars<font color="#000080">=</font><font color="#800000">100</font><font color="#000080">;
  </font>StarSpeed<font color="#000080">=</font><font color="#800000">20</font><font color="#000080">;
</font><font color="#008000"><i>{change these to change the # of stars/speed, then recompile}
</i></font><font color="#FF0000"><b>Type
  </b></font>Starrec<font color="#000080">=</font><font color="#FF0000"><b>record
    </b></font>x <font color="#000080">: </font>integer<font color="#000080">;
    </font>y <font color="#000080">: </font>integer<font color="#000080">;
    </font>z <font color="#000080">: </font>integer
  <font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>Var
  </b></font>a<font color="#000080">,</font>b<font color="#000080">,</font>c <font color="#000080">: </font>integer<font color="#000080">;
  </font>ch <font color="#000080">: </font>char<font color="#000080">;
  </font>stars <font color="#000080">: </font><font color="#FF0000"><b>array </b></font><font color="#000080">[</font><font color="#800000">1</font><font color="#000080">..</font>numstars<font color="#000080">] </font><font color="#FF0000"><b>of </b></font>starrec<font color="#000080">;
  </font>p2<font color="#000080">,</font>p3 <font color="#000080">: </font>pointer<font color="#000080">; </font><font color="#008000"><i>{Pointers to &quot;virtual&quot; VGA screens}

</i></font><font color="#FF0000"><b>Procedure </b></font>InitVGA<font color="#000080">;
</font><font color="#FF0000"><b>Begin
  asm
    </b></font><font color="#FF00FF">mov ax,13h
    int 10h
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{Moves the 320x200x256 mode identifier, 13 hexadecimal, into
      the AX system register then calls interrupt 10 hex, which handles
      the video card.  Basically, it sets up the video mode}

</i></font><font color="#FF0000"><b>Procedure </b></font>Restoretext<font color="#000080">;
</font><font color="#FF0000"><b>begin
  asm
    </b></font><font color="#FF00FF">mov ax,03h
    int 10h
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{restores textmode - text mode is mode 03 hex}

</i></font><font color="#FF0000"><b>Procedure </b></font>AllocatePages<font color="#000080">;
</font><font color="#FF0000"><b>Begin
  </b></font>getmem<font color="#000080">(</font>p2<font color="#000080">,</font><font color="#800000">64000</font><font color="#000080">);
  </font>getmem<font color="#000080">(</font>p3<font color="#000080">,</font><font color="#800000">64000</font><font color="#000080">);
</font><font color="#FF0000"><b>End</b></font><font color="#000080">; </font><font color="#008000"><i>{gets 64k for each of the 2 pointer variables, p2 and p3}
     {These pointers represent &quot;imaginary&quot; vga pages, for swapping}

</i></font><font color="#FF0000"><b>Procedure </b></font>ClearPage3<font color="#000080">;
</font><font color="#FF0000"><b>var
  </b></font>i <font color="#000080">: </font>longint<font color="#000080">;
</font><font color="#FF0000"><b>Begin
  for </b></font>i<font color="#000080">:=</font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font><font color="#800000">63999 </font><font color="#FF0000"><b>do
  begin
    </b></font>mem<font color="#000080">[</font>seg<font color="#000080">(</font>p3<font color="#000080">^):</font>i<font color="#000080">]:=</font><font color="#800000">0</font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>Procedure </b></font>Deallocatepages<font color="#000080">;
</font><font color="#FF0000"><b>begin
  </b></font>freemem<font color="#000080">(</font>p2<font color="#000080">,</font><font color="#800000">64000</font><font color="#000080">);
  </font>freemem<font color="#000080">(</font>p3<font color="#000080">,</font><font color="#800000">64000</font><font color="#000080">);
</font><font color="#FF0000"><b>End</b></font><font color="#000080">; </font><font color="#008000"><i>{frees system memory so you don't get a heap overflow later}

</i></font><font color="#FF0000"><b>Procedure </b></font>SwapPages<font color="#000080">;
</font><font color="#FF0000"><b>Begin
  </b></font>move<font color="#000080">(</font>mem<font color="#000080">[</font>seg<font color="#000080">(</font>p2<font color="#000080">^):</font><font color="#800000">0</font><font color="#000080">],</font>mem<font color="#000080">[</font><font color="#800000">$A000</font><font color="#000080">:</font><font color="#800000">0</font><font color="#000080">],</font><font color="#800000">64000</font><font color="#000080">);
  </font>move<font color="#000080">(</font>mem<font color="#000080">[</font>seg<font color="#000080">(</font>p3<font color="#000080">^):</font><font color="#800000">0</font><font color="#000080">],</font>mem<font color="#000080">[</font>seg<font color="#000080">(</font>p2<font color="#000080">^):</font><font color="#800000">0</font><font color="#000080">],</font><font color="#800000">64000</font><font color="#000080">);
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;
    </font><font color="#008000"><i>{Moves the data from the imaginary &quot;page 2&quot; to the visible page #1,}
    {Then moves the blank page 3 over to page 2, to start over.  this}
    {is how you do smooth animation.}

</i></font><font color="#FF0000"><b>Procedure </b></font>PutPixel<font color="#000080">(</font>x<font color="#000080">,</font>y <font color="#000080">: </font>integer<font color="#000080">; </font>c <font color="#000080">: </font>integer<font color="#000080">);
</font><font color="#FF0000"><b>Begin
  </b></font>mem<font color="#000080">[</font><font color="#800000">$A000</font><font color="#000080">:((</font><font color="#800000">320</font><font color="#000080">*</font>y<font color="#000080">)+</font>x<font color="#000080">)]:=</font>c<font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;
    </font><font color="#008000"><i>{A000 Hex is the VGA segment address - the thing after the colon is
     the offset - imagine a 320x200 array, that's how you'd find the
     &quot;linear&quot; address in the array.  After finding the right byte, it simply
     sets it equal to c, the color of the pixel you want}

</i></font><font color="#FF0000"><b>Procedure </b></font>PP2<font color="#000080">(</font>x<font color="#000080">,</font>y <font color="#000080">: </font>integer<font color="#000080">; </font>c<font color="#000080">: </font>integer<font color="#000080">);
</font><font color="#FF0000"><b>begin
  </b></font>mem<font color="#000080">[</font>seg<font color="#000080">(</font>p2<font color="#000080">^):((</font><font color="#800000">320</font><font color="#000080">*</font>y<font color="#000080">)+</font>x<font color="#000080">)]:=</font>c<font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">;
    </font><font color="#008000"><i>{Same as putpixel, but puts it on the imaginary page #2 instead of the
     visual page}

</i></font><font color="#FF0000"><b>Procedure </b></font>CalculateStars<font color="#000080">;
</font><font color="#FF0000"><b>Begin
  for </b></font>a<font color="#000080">:=</font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>numstars <font color="#FF0000"><b>do
  begin
    </b></font>stars<font color="#000080">[</font>a<font color="#000080">].</font>x<font color="#000080">:=(</font>random<font color="#000080">(</font><font color="#800000">2000</font><font color="#000080">)-</font><font color="#800000">1000</font><font color="#000080">);
    </font><font color="#008000"><i>{this produces a range from -1000 to +1000}
    </i></font>stars<font color="#000080">[</font>a<font color="#000080">].</font>y<font color="#000080">:=(</font>random<font color="#000080">(</font><font color="#800000">2000</font><font color="#000080">)-</font><font color="#800000">1000</font><font color="#000080">);
    </font>stars<font color="#000080">[</font>a<font color="#000080">].</font>z<font color="#000080">:=(</font>random<font color="#000080">(</font><font color="#800000">400</font><font color="#000080">)+</font><font color="#800000">1</font><font color="#000080">); </font><font color="#008000"><i>{don't want Z to ever be negative -you'll see}
  </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font><font color="#008000"><i>{Basically, we've calculated the stars' initial positions}

</i></font><font color="#FF0000"><b>Procedure </b></font>DisplayStars<font color="#000080">;
</font><font color="#FF0000"><b>Const
  </b></font>expf<font color="#000080">=</font><font color="#800000">75</font><font color="#000080">; </font><font color="#008000"><i>{local constant} {play with this value for some interesting FX}
</i></font><font color="#FF0000"><b>Var
  </b></font>sx<font color="#000080">,</font>sy <font color="#000080">: </font>integer<font color="#000080">; </font><font color="#008000"><i>{these are variables defined only for THIS procedure}
  </i></font>tempcolor <font color="#000080">: </font>integer<font color="#000080">;
  </font>okshow <font color="#000080">: </font>boolean<font color="#000080">;
</font><font color="#FF0000"><b>Begin
  for </b></font>a<font color="#000080">:=</font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>numstars <font color="#FF0000"><b>do
  begin
    </b></font>okshow<font color="#000080">:=</font>true<font color="#000080">;
    </font><font color="#008000"><i>{remember - positive Z is AWAY from you}
    </i></font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>stars<font color="#000080">[</font>a<font color="#000080">].</font>z<font color="#000080">&lt;</font><font color="#800000">200</font><font color="#000080">) </font><font color="#FF0000"><b>then </b></font>tempcolor<font color="#000080">:=</font><font color="#800000">7</font><font color="#000080">;  </font><font color="#008000"><i>{light gray}
    </i></font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>stars<font color="#000080">[</font>a<font color="#000080">].</font>z<font color="#000080">&lt;</font><font color="#800000">100</font><font color="#000080">) </font><font color="#FF0000"><b>then </b></font>tempcolor<font color="#000080">:=</font><font color="#800000">15</font><font color="#000080">; </font><font color="#008000"><i>{white}
    </i></font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>stars<font color="#000080">[</font>a<font color="#000080">].</font>z<font color="#000080">&gt;=</font><font color="#800000">200</font><font color="#000080">) </font><font color="#FF0000"><b>then </b></font>tempcolor<font color="#000080">:=</font><font color="#800000">8</font><font color="#000080">; </font><font color="#008000"><i>{dark gray}
    </i></font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>stars<font color="#000080">[</font>a<font color="#000080">].</font>z<font color="#000080">&gt;</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>then </b></font><font color="#008000"><i>{have to do this or get div by 0 error}
    </i></font><font color="#FF0000"><b>begin
      </b></font>sx<font color="#000080">:=</font>round<font color="#000080">((</font>stars<font color="#000080">[</font>a<font color="#000080">].</font>x<font color="#000080">*</font>expf<font color="#000080">)/</font>stars<font color="#000080">[</font>a<font color="#000080">].</font>z<font color="#000080">);
      </font>sy<font color="#000080">:=</font>round<font color="#000080">((</font>stars<font color="#000080">[</font>a<font color="#000080">].</font>y<font color="#000080">*</font>expf<font color="#000080">)/</font>stars<font color="#000080">[</font>a<font color="#000080">].</font>z<font color="#000080">);
      </font>sx<font color="#000080">:=</font>sx<font color="#000080">+</font><font color="#800000">160</font><font color="#000080">;
      </font>sy<font color="#000080">:=</font>sy<font color="#000080">+</font><font color="#800000">100</font><font color="#000080">; </font><font color="#008000"><i>{put the origin at the center, not upper-left}
      </i></font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>sx<font color="#000080">&lt;</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>then </b></font>okshow<font color="#000080">:=</font>false<font color="#000080">;
      </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>sx<font color="#000080">&gt;</font><font color="#800000">319</font><font color="#000080">) </font><font color="#FF0000"><b>then </b></font>okshow<font color="#000080">:=</font>false<font color="#000080">;
      </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>sy<font color="#000080">&lt;</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>then </b></font>okshow<font color="#000080">:=</font>false<font color="#000080">;
      </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>sy<font color="#000080">&gt;</font><font color="#800000">199</font><font color="#000080">) </font><font color="#FF0000"><b>then </b></font>okshow<font color="#000080">:=</font>false<font color="#000080">;
      </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>okshow<font color="#000080">=</font>true<font color="#000080">) </font><font color="#FF0000"><b>then </b></font>pp2<font color="#000080">(</font>sx<font color="#000080">,</font>sy<font color="#000080">,</font>tempcolor<font color="#000080">);
    </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>end</b></font><font color="#000080">; </font><font color="#008000"><i>{Displays one frame of the starfield, basically}

</i></font><font color="#FF0000"><b>Procedure </b></font>MoveStars<font color="#000080">;
</font><font color="#FF0000"><b>Begin
  for </b></font>a<font color="#000080">:=</font><font color="#800000">1 </font><font color="#FF0000"><b>to </b></font>numstars <font color="#FF0000"><b>do
  begin
    </b></font>stars<font color="#000080">[</font>a<font color="#000080">].</font>z<font color="#000080">:=(</font>stars<font color="#000080">[</font>a<font color="#000080">].</font>z<font color="#000080">-</font>starspeed<font color="#000080">);
    </font><font color="#FF0000"><b>if </b></font><font color="#000080">(</font>stars<font color="#000080">[</font>a<font color="#000080">].</font>z<font color="#000080">&lt;=</font><font color="#800000">0</font><font color="#000080">) </font><font color="#FF0000"><b>then </b></font>stars<font color="#000080">[</font>a<font color="#000080">].</font>z<font color="#000080">:=</font><font color="#800000">400</font><font color="#000080">; </font><font color="#008000"><i>{can't have 0 or negative value}
  </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;
</font><font color="#FF0000"><b>End</b></font><font color="#000080">; </font><font color="#008000"><i>{Updates the position of the stars}

</i></font><font color="#FF0000"><b>Begin </b></font><font color="#008000"><i>{main program execution begins here}
  </i></font>initvga<font color="#000080">; </font><font color="#008000"><i>{first, setup the screen - we have lots of predef procedures now!}
  </i></font>allocatepages<font color="#000080">; </font><font color="#008000"><i>{get the virtual pages set up}
  </i></font>clearpage3<font color="#000080">; </font><font color="#008000"><i>{make sure page 3 is blank}
  </i></font>calculatestars<font color="#000080">; </font><font color="#008000"><i>{setup initial positions}
  </i></font><font color="#FF0000"><b>repeat
    </b></font>displaystars<font color="#000080">; </font><font color="#008000"><i>{display one frame}
    </i></font>swappages<font color="#000080">; </font><font color="#008000"><i>{copy frame to visual page and erase working page}
    </i></font>movestars<font color="#000080">; </font><font color="#008000"><i>{update star data}
  </i></font><font color="#FF0000"><b>until </b></font>keypressed<font color="#000080">; </font><font color="#008000"><i>{repeats the loop until you hit a key}
  </i></font>restoretext<font color="#000080">; </font><font color="#008000"><i>{put the video card back in 80x25 text mode}
  </i></font>deallocatepages<font color="#000080">; </font><font color="#008000"><i>{free up the system RAM we used}
</i></font><font color="#FF0000"><b>End</b></font><font color="#000080">. </font><font color="#008000"><i>{end the program execution}
</i></font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to EGAVGA SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0188.PAS">Original</a><b>]</b></p></body>
</html>
