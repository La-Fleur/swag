<html>
<head><title> "Svga stuff" by DAVID HENNINGSSON</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to EGAVGA SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0266.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code>
<font color="#FF0000"><b>uses </b></font>crt<font color="#000080">;
</font><font color="#008000"><i>{
  Public Domain Code By David Henningsson 1996 (DIWIC)
  Spread it and use it, if you like.
  Written in Turbo Pascal 6.0
  Warning: This stuff is very slow and inoptimal.
  Do some &quot;brain physics&quot; and speed it up yourself!
}


</i></font><font color="#FF0000"><b>const </b></font>Svgatext<font color="#000080">:</font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">4</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">15</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Byte <font color="#000080">= (
(</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">),
(</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">),
(</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">),
(</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">),
(</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">,</font><font color="#800000">1</font><font color="#000080">,</font><font color="#800000">0</font><font color="#000080">));


</font><font color="#FF0000"><b>var </b></font>Pro<font color="#000080">:</font><font color="#FF0000"><b>Procedure</b></font><font color="#000080">;
    </font>CurBank<font color="#000080">:</font>Byte<font color="#000080">;

</font><font color="#008000"><i>{ Only for 640x480x256 }
</i></font><font color="#FF0000"><b>Procedure </b></font>PutVpixel<font color="#000080">(</font>X<font color="#000080">,</font>Y<font color="#000080">:</font>Word<font color="#000080">;</font>F<font color="#000080">:</font>Byte<font color="#000080">); </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>asm
  </b></font><font color="#FF00FF">mov ax,640
  mul Y
  add ax,X     </font><font color="#008000"><i>{ If this putpixel routine seems to skip parts of the screen }
  </i></font><font color="#FF00FF">adc dx,0     </font><font color="#008000"><i>{ or overwrites stuff already written }
  </i></font><font color="#FF00FF">mov bx,4096  </font><font color="#008000"><i>{ &lt;- try changing this number (to another power of two) }
  </i></font><font color="#FF00FF">div bx   </font><font color="#008000"><i>{ This line is inoptimal... }
  </i></font><font color="#FF00FF">xchg ax,dx
  push ax
  cmp dl,CurBank
  je @@DontSwitchBanks
  mov CurBank,dl
  mov ax,$4F05
  mov bx,0
  Call Pro
@@DontSwitchBanks:
  pop di
  mov ax,0A000h
  mov es,ax
  mov al,F
  stosb
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{ Goes a little bit faster, inline bank switching, only for Cirrus Logic }
{ Have tried to optimize it a bit }
</i></font><font color="#FF0000"><b>Procedure </b></font>PutVpixel2<font color="#000080">(</font>X<font color="#000080">,</font>Y<font color="#000080">:</font>Word<font color="#000080">;</font>F<font color="#000080">:</font>Byte<font color="#000080">); </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;
</font><font color="#FF0000"><b>asm
  </b></font><font color="#FF00FF">mov ax,640
  mul Y
  add ax,X
  adc dx,0
  mov di,ax
  mov ah,dl
  shl ah,4
  cmp ah,CurBank
  je @@DontSwitchBanks
  mov CurBank,ah
  mov dx,$3CE
</font><font color="#008000"><i>{  in al,dx  }     { These four lines don't seem to be needed. If there is }
{  mov bl,al }     { trouble, try putting them back in business.}
  </i></font><font color="#FF00FF">mov al,9
  out dx,ax
</font><font color="#008000"><i>{  mov al,bl }
{  out dx,al }
</i></font><font color="#FF00FF">@@DontSwitchBanks:
  mov ax,0A000h
  mov es,ax
  mov al,F
  stosb
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>var </b></font>I<font color="#000080">,</font>J<font color="#000080">:</font>Integer<font color="#000080">;
    </font>K<font color="#000080">,</font>L<font color="#000080">,</font>M<font color="#000080">:</font>Byte<font color="#000080">;
    </font>Pal<font color="#000080">:</font><font color="#FF0000"><b>Array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">255</font><font color="#000080">,</font><font color="#800000">1</font><font color="#000080">..</font><font color="#800000">3</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>Byte<font color="#000080">;

</font><font color="#FF0000"><b>begin
  asm
    </b></font><font color="#FF00FF">mov ax,$4F02
    mov bx,$101
    int 10h     </font><font color="#008000"><i>{ Set SVGA mode: 640x480x256 }
    </i></font><font color="#FF00FF">mov ax,$4F01
    mov cx,$101
    push ds
    pop es
    mov di,OFFSET Pal
    int 10h
    mov di,OFFSET Pal+12
    mov bx,[di]
    mov cx,[di+2]
    mov WORD [Pro],bx
    mov WORD [Pro+2],cx  </font><font color="#008000"><i>{ Look up pointer to bank switcher }
  </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>CurBank <font color="#000080">:= </font><font color="#800000">255</font><font color="#000080">; </font><font color="#008000"><i>{ Will always switch banks the first time }
  </i></font>Fillchar<font color="#000080">(</font>Pal<font color="#000080">,</font>Sizeof<font color="#000080">(</font>Pal<font color="#000080">),</font><font color="#800000">0</font><font color="#000080">);
  </font><font color="#FF0000"><b>For </b></font>I <font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font><font color="#800000">63 </font><font color="#FF0000"><b>do begin
    </b></font>Pal<font color="#000080">[</font>I<font color="#000080">,</font><font color="#800000">1</font><font color="#000080">] := </font>I<font color="#000080">;
    </font>Pal<font color="#000080">[</font>I<font color="#000080">+</font><font color="#800000">64</font><font color="#000080">,</font><font color="#800000">1</font><font color="#000080">] := </font><font color="#800000">63</font><font color="#000080">-</font>I<font color="#000080">;
    </font>Pal<font color="#000080">[</font>I<font color="#000080">+</font><font color="#800000">64</font><font color="#000080">,</font><font color="#800000">2</font><font color="#000080">] := </font>I<font color="#000080">;
    </font>Pal<font color="#000080">[</font>I<font color="#000080">+</font><font color="#800000">128</font><font color="#000080">,</font><font color="#800000">2</font><font color="#000080">] := </font><font color="#800000">63</font><font color="#000080">-</font>I<font color="#000080">;
    </font>Pal<font color="#000080">[</font>I<font color="#000080">+</font><font color="#800000">128</font><font color="#000080">,</font><font color="#800000">3</font><font color="#000080">] := </font>I<font color="#000080">;
    </font>Pal<font color="#000080">[</font>I<font color="#000080">+</font><font color="#800000">192</font><font color="#000080">,</font><font color="#800000">3</font><font color="#000080">] := </font><font color="#800000">63</font><font color="#000080">-</font>I<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font><font color="#FF0000"><b>asm
    </b></font><font color="#FF00FF">cld
    mov si,OFFSET Pal
    mov cx,256*3
    mov dx,$3C8
    mov al,0
    out dx,al
    inc dx
    rep outsb </font><font color="#008000"><i>{ Set palette }
  </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#008000"><i>{ K is random, since it is uninitialized! }
  </i></font><font color="#FF0000"><b>For </b></font>J <font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font><font color="#800000">479 </font><font color="#FF0000"><b>div </b></font><font color="#800000">6 </font><font color="#FF0000"><b>do begin
    For </b></font>I <font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font><font color="#800000">639 </font><font color="#FF0000"><b>div </b></font><font color="#800000">16 </font><font color="#FF0000"><b>do begin
      </b></font>Inc<font color="#000080">(</font>K<font color="#000080">);
      </font><font color="#FF0000"><b>For </b></font>L <font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font><font color="#800000">4 </font><font color="#FF0000"><b>do
        For </b></font>M <font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font><font color="#800000">15 </font><font color="#FF0000"><b>do
          If </b></font>Svgatext<font color="#000080">[</font>L<font color="#000080">,</font>M<font color="#000080">] &lt;&gt; </font><font color="#800000">0 </font><font color="#FF0000"><b>then
            </b></font>PutVPixel<font color="#000080">(</font>I<font color="#000080">*</font><font color="#800000">16</font><font color="#000080">+</font>M<font color="#000080">,</font>J<font color="#000080">*</font><font color="#800000">6</font><font color="#000080">+</font>L<font color="#000080">,</font>K<font color="#000080">); </font><font color="#008000"><i>{ Here is the inoptimal stuff lying }
    </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;
    </font>Dec<font color="#000080">(</font>K<font color="#000080">,</font><font color="#800000">43</font><font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;
  </font>Directvideo <font color="#000080">:= </font>FALSE<font color="#000080">;
  </font>Textattr <font color="#000080">:= </font><font color="#800000">128</font><font color="#000080">;
  </font>WindMax <font color="#000080">:= </font><font color="#800000">30</font><font color="#000080">*</font><font color="#800000">256</font><font color="#000080">+</font><font color="#800000">80</font><font color="#000080">; </font><font color="#008000"><i>{ Sets up the CRT unit }
  </i></font>GotoXY<font color="#000080">(</font><font color="#800000">28</font><font color="#000080">,</font><font color="#800000">15</font><font color="#000080">);
  </font>Writeln<font color="#000080">(</font><font color="#800000">'Is this SVGA or aint it?'</font><font color="#000080">);
  </font>GotoXY<font color="#000080">(</font><font color="#800000">25</font><font color="#000080">,</font><font color="#800000">17</font><font color="#000080">);
  </font>Writeln<font color="#000080">(</font><font color="#800000">'Is this 640x480x256 or aint it?'</font><font color="#000080">);
  </font>REadkey<font color="#000080">;
  </font>Textmode<font color="#000080">(</font><font color="#800000">3</font><font color="#000080">);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">.
</font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to EGAVGA SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0266.PAS">Original</a><b>]</b></p></body>
</html>
