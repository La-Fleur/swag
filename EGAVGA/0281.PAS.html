<html>
<head><title> "Another GetMem > 64k" by GERHARD PIRAN</title><link rel="STYLESHEET" type="text/css" href="../swagsource.css"></head>
<body><p align="center"><b>[</b><a href="index.html">Back to EGAVGA SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0281.PAS">Original</a><b>]</b></p><!--StartFragment--><pre><code><font color="#008000"><i>{
example 0064.pas of egavga.swg is buggy.
please replace it with the corrected attachment.
(gerhard piran is my pseudonym ;-) so please don't change! )

  thanx for great work on SWAG
  have fun, Gerd


{$Q-,R-}
{
JAMES SAITO

&gt; I wonder if I can allocate With GetMem more than 64K, though. You see, I'm
&gt; interested in creating games With my own code, and the most important part
&gt; of games is Graphics. You don't want to play some dumb monochrome Text
&gt; adventure With a little man (@). :) Do you have any tips For outputting a
&gt; screen of information such as a part of a dungeon? I'd sorta like to keep
&gt; the Character centered like in Nintendo games.

Well.  if you want to make a 320x200x256 game, I know the right stuff.  if you
would like to make the Character centered, and when you press
up/down/left/right, the whole screen scrolls.  Here is an example on a playing
field that is umm.  Let's say 1000x200 (200K).

GERHARD PIRAN
  correted and accelerated
}
</i></font><font color="#FF0000"><b>uses </b></font>crt<font color="#000080">;

</font><font color="#FF0000"><b>procedure </b></font>DMove <font color="#000080">(</font><font color="#FF0000"><b>var </b></font>source<font color="#000080">, </font>dest<font color="#000080">; </font>count<font color="#000080">: </font>word<font color="#000080">); </font><font color="#FF0000"><b>assembler</b></font><font color="#000080">;

</font><font color="#FF0000"><b>asm
  </b></font><font color="#FF00FF">push ds
  lds  si,source      </font><font color="#008000"><i>{ds,si = source}
  </i></font><font color="#FF00FF">les  di,dest        </font><font color="#008000"><i>{es,di = dest}
  </i></font><font color="#FF00FF">mov  cx,count       </font><font color="#008000"><i>{cx = count}
  </i></font><font color="#FF00FF">mov  ax,cx          </font><font color="#008000"><i>{ax = count}
  </i></font><font color="#FF00FF">cld
  shr  cx,2           </font><font color="#008000"><i>{cx = count / 4}
  </i></font><font color="#FF00FF">db   66h
  rep  movsw          </font><font color="#008000"><i>{copy double words}
  </i></font><font color="#FF00FF">mov  cl,al          </font><font color="#008000"><i>{get rest bytes}
  </i></font><font color="#FF00FF">and  cl,3
  rep  movsb          </font><font color="#008000"><i>{copy rest}
  </i></font><font color="#FF00FF">pop  ds
</font><font color="#FF0000"><b>end</b></font><font color="#000080">;

</font><font color="#FF0000"><b>const </b></font>maxY <font color="#000080">= </font><font color="#800000">199</font><font color="#000080">;
      </font>maxL <font color="#000080">= </font><font color="#800000">999</font><font color="#000080">;

</font><font color="#FF0000"><b>type  </b></font>line <font color="#000080">= </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font>maxL<font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">;
      </font>linePtr <font color="#000080">= ^</font>line<font color="#000080">;
      </font>vga <font color="#000080">= </font><font color="#FF0000"><b>array</b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font><font color="#800000">63999</font><font color="#000080">] </font><font color="#FF0000"><b>of </b></font>byte<font color="#000080">;
</font><font color="#FF0000"><b>Var
  </b></font>ws<font color="#000080">: </font><font color="#FF0000"><b>array </b></font><font color="#000080">[</font><font color="#800000">0</font><font color="#000080">..</font>maxY<font color="#000080">] </font><font color="#FF0000"><b>of </b></font>linePtr<font color="#000080">;  </font><font color="#008000"><i>{work space}
  </i></font>lp   <font color="#000080">: </font>linePtr<font color="#000080">;
  </font>vp   <font color="#000080">: ^</font>vga<font color="#000080">;    </font><font color="#008000"><i>{pointer to vga buffer}
  </i></font>vm   <font color="#000080">: </font>vga <font color="#FF0000"><b>absolute </b></font><font color="#800000">$A000</font><font color="#000080">:</font><font color="#800000">0</font><font color="#000080">;
  </font>x<font color="#000080">,</font>y  <font color="#000080">: </font>word<font color="#000080">;

</font><font color="#FF0000"><b>begin
  </b></font><font color="#008000"><i>{Init The Graphics}
  </i></font><font color="#FF0000"><b>Asm
    </b></font><font color="#FF00FF">MOV AH,00H  </font><font color="#008000"><i>{AH = 0}
    </i></font><font color="#FF00FF">MOV AL,13H  </font><font color="#008000"><i>{AL = 13H,which is the Graphics mode 320x200x256}
    </i></font><font color="#FF00FF">INT 10H     </font><font color="#008000"><i>{Call the Graphics bios services}
  </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>if </b></font>Mem<font color="#000080">[</font><font color="#800000">$40</font><font color="#000080">:</font><font color="#800000">$49</font><font color="#000080">] &lt;&gt; </font><font color="#800000">$13 </font><font color="#FF0000"><b>Then
  begin
    </b></font>WriteLn<font color="#000080">(</font><font color="#800000">'VGA Graphics Required For this game'</font><font color="#000080">);
    </font>Halt<font color="#000080">(</font><font color="#800000">1</font><font color="#000080">);
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#FF0000"><b>For </b></font>y <font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font>maxY <font color="#FF0000"><b>do
  begin
    </b></font>new <font color="#000080">(</font>lp<font color="#000080">);   </font><font color="#008000"><i>{Find a chunk of memory For the field}
    </i></font><font color="#FF0000"><b>if </b></font>lp <font color="#000080">= </font><font color="#FF0000"><b>nil then </b></font>RunError <font color="#000080">(</font><font color="#800000">203</font><font color="#000080">);
    </font>ws<font color="#000080">[</font>y<font color="#000080">] := </font>lp<font color="#000080">;   </font><font color="#008000"><i>{Find a chunk of memory For the field}
    </i></font><font color="#FF0000"><b>For </b></font>x <font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font>maxL <font color="#FF0000"><b>do
      </b></font>lp<font color="#000080">^[</font>x<font color="#000080">] := </font>random<font color="#000080">(</font><font color="#800000">256</font><font color="#000080">);     </font><font color="#008000"><i>{Create a random field}
  </i></font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font>new<font color="#000080">(</font>vp<font color="#000080">);
  </font><font color="#FF0000"><b>if </b></font>vp <font color="#000080">= </font><font color="#FF0000"><b>nil then </b></font>RunError <font color="#000080">(</font><font color="#800000">203</font><font color="#000080">);
  </font><font color="#FF0000"><b>For </b></font>x <font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font><font color="#800000">679 </font><font color="#FF0000"><b>do
  begin
    For </b></font>y <font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font>maxY <font color="#FF0000"><b>do
      </b></font>move <font color="#000080">(</font>ws<font color="#000080">[</font>y<font color="#000080">]^[</font>x<font color="#000080">], </font>vp<font color="#000080">^[</font>y<font color="#000080">*</font><font color="#800000">320</font><font color="#000080">], </font><font color="#800000">320</font><font color="#000080">);
    </font><font color="#008000"><i>{Now do put your player on, supposing it's a white block}
    </i></font><font color="#FF0000"><b>For </b></font>y <font color="#000080">:= </font><font color="#800000">90 </font><font color="#FF0000"><b>to </b></font><font color="#800000">110 </font><font color="#FF0000"><b>do
      </b></font>FillChar<font color="#000080">(</font>vp<font color="#000080">^[</font>y<font color="#000080">*</font><font color="#800000">320 </font><font color="#000080">+ </font><font color="#800000">150</font><font color="#000080">], </font><font color="#800000">20</font><font color="#000080">, </font><font color="#800000">15</font><font color="#000080">);
    </font><font color="#008000"><i>{WaitVRetrace}
    </i></font><font color="#FF0000"><b>repeat until </b></font><font color="#000080">(</font>port<font color="#000080">[</font><font color="#800000">$03DA</font><font color="#000080">] </font><font color="#FF0000"><b>and </b></font><font color="#800000">$08</font><font color="#000080">) = </font><font color="#800000">0</font><font color="#000080">;
    </font><font color="#FF0000"><b>repeat until </b></font><font color="#000080">(</font>port<font color="#000080">[</font><font color="#800000">$03DA</font><font color="#000080">] </font><font color="#FF0000"><b>and </b></font><font color="#800000">$08</font><font color="#000080">) &lt;&gt; </font><font color="#800000">0</font><font color="#000080">;
    </font><font color="#008000"><i>{Now copy that workspace into the video memory}
    </i></font>DMove <font color="#000080">(</font>vp<font color="#000080">^, </font>vm<font color="#000080">, </font><font color="#800000">64000</font><font color="#000080">);
    </font><font color="#FF0000"><b>if </b></font>keypressed <font color="#FF0000"><b>then </b></font>break<font color="#000080">;
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#008000"><i>{Now time to close the Graphics}
  </i></font><font color="#FF0000"><b>Asm
    </b></font><font color="#FF00FF">MOV AH,$00;
    MOV AL,$03;
    INT 10H
  </font><font color="#FF0000"><b>end</b></font><font color="#000080">;

  </font><font color="#008000"><i>{Free all blocks}
  </i></font>dispose<font color="#000080">(</font>vp<font color="#000080">);
  </font><font color="#FF0000"><b>For </b></font>y <font color="#000080">:= </font><font color="#800000">0 </font><font color="#FF0000"><b>to </b></font>maxY <font color="#FF0000"><b>do </b></font>dispose<font color="#000080">(</font>ws<font color="#000080">[</font>y<font color="#000080">]);
</font><font color="#FF0000"><b>end</b></font><font color="#000080">.
</font><font color="#008000"><i>{
  Well.  That's it.  It actually took me 20 minutes to Type this whole thing
right in the message base.  I guess there's a bit of errors.  - James Saito
}
</i></font>
</code></pre><!--EndFragment--><p align="center"><b>[</b><a href="index.html">Back to EGAVGA SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="../index.html">Back to Main SWAG index</a><b>]</b>&nbsp;&nbsp;<b>[</b><a href="0281.PAS">Original</a><b>]</b></p></body>
</html>
